var Yg=Object.defineProperty;var Xg=(t,e,n)=>e in t?Yg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var zt=(t,e,n)=>Xg(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();var Lo,Jt,Tp,Pa,hh,Ip,Pp,Op,ld,Cu,Tu,Rp,Ml={},Ul=[],Zg=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Co=Array.isArray;function gi(t,e){for(var n in e)t[n]=e[n];return t}function cd(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Fp(t,e,n){var r,i,a,o={};for(a in e)a=="key"?r=e[a]:a=="ref"?i=e[a]:o[a]=e[a];if(arguments.length>2&&(o.children=arguments.length>3?Lo.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(a in t.defaultProps)o[a]===void 0&&(o[a]=t.defaultProps[a]);return co(t,o,r,i,null)}function co(t,e,n,r,i){var a={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Tp,__i:-1,__u:0};return i==null&&Jt.vnode!=null&&Jt.vnode(a),a}function At(t){return t.children}function uo(t,e){this.props=t,this.context=e}function xs(t,e){if(e==null)return t.__?xs(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?xs(t):null}function Qg(t){if(t.__P&&t.__d){var e=t.__v,n=e.__e,r=[],i=[],a=gi({},e);a.__v=e.__v+1,Jt.vnode&&Jt.vnode(a),ud(t.__P,a,e,t.__n,t.__P.namespaceURI,32&e.__u?[n]:null,r,n??xs(e),!!(32&e.__u),i),a.__v=e.__v,a.__.__k[a.__i]=a,Mp(r,a,i),e.__e=e.__=null,a.__e!=n&&Dp(a)}}function Dp(t){if((t=t.__)!=null&&t.__c!=null)return t.__e=t.__c.base=null,t.__k.some(function(e){if(e!=null&&e.__e!=null)return t.__e=t.__c.base=e.__e}),Dp(t)}function Iu(t){(!t.__d&&(t.__d=!0)&&Pa.push(t)&&!$l.__r++||hh!=Jt.debounceRendering)&&((hh=Jt.debounceRendering)||Ip)($l)}function $l(){for(var t,e=1;Pa.length;)Pa.length>e&&Pa.sort(Pp),t=Pa.shift(),e=Pa.length,Qg(t);$l.__r=0}function jp(t,e,n,r,i,a,o,l,c,d,h){var g,b,p,y,w,S,x,C=r&&r.__k||Ul,P=e.length;for(c=e0(n,e,C,c,P),g=0;g<P;g++)(p=n.__k[g])!=null&&(b=p.__i!=-1&&C[p.__i]||Ml,p.__i=g,S=ud(t,p,b,i,a,o,l,c,d,h),y=p.__e,p.ref&&b.ref!=p.ref&&(b.ref&&dd(b.ref,null,p),h.push(p.ref,p.__c||y,p)),w==null&&y!=null&&(w=y),(x=!!(4&p.__u))||b.__k===p.__k?c=Bp(p,c,t,x):typeof p.type=="function"&&S!==void 0?c=S:y&&(c=y.nextSibling),p.__u&=-7);return n.__e=w,c}function e0(t,e,n,r,i){var a,o,l,c,d,h=n.length,g=h,b=0;for(t.__k=new Array(i),a=0;a<i;a++)(o=e[a])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=t.__k[a]=co(null,o,null,null,null):Co(o)?o=t.__k[a]=co(At,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?o=t.__k[a]=co(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):t.__k[a]=o,c=a+b,o.__=t,o.__b=t.__b+1,l=null,(d=o.__i=t0(o,n,c,g))!=-1&&(g--,(l=n[d])&&(l.__u|=2)),l==null||l.__v==null?(d==-1&&(i>h?b--:i<h&&b++),typeof o.type!="function"&&(o.__u|=4)):d!=c&&(d==c-1?b--:d==c+1?b++:(d>c?b--:b++,o.__u|=4))):t.__k[a]=null;if(g)for(a=0;a<h;a++)(l=n[a])!=null&&(2&l.__u)==0&&(l.__e==r&&(r=xs(l)),$p(l,l));return r}function Bp(t,e,n,r){var i,a;if(typeof t.type=="function"){for(i=t.__k,a=0;i&&a<i.length;a++)i[a]&&(i[a].__=t,e=Bp(i[a],e,n,r));return e}t.__e!=e&&(r&&(e&&t.type&&!e.parentNode&&(e=xs(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Pu(t,e){return e=e||[],t==null||typeof t=="boolean"||(Co(t)?t.some(function(n){Pu(n,e)}):e.push(t)),e}function t0(t,e,n,r){var i,a,o,l=t.key,c=t.type,d=e[n],h=d!=null&&(2&d.__u)==0;if(d===null&&l==null||h&&l==d.key&&c==d.type)return n;if(r>(h?1:0)){for(i=n-1,a=n+1;i>=0||a<e.length;)if((d=e[o=i>=0?i--:a++])!=null&&(2&d.__u)==0&&l==d.key&&c==d.type)return o}return-1}function fh(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Zg.test(e)?n:n+"px"}function cl(t,e,n,r,i){var a,o;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||fh(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||fh(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")a=e!=(e=e.replace(Op,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+a]=n,n?r?n.u=r.u:(n.u=ld,t.addEventListener(e,a?Tu:Cu,a)):t.removeEventListener(e,a?Tu:Cu,a);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function ph(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=ld++;else if(e.t<n.u)return;return n(Jt.event?Jt.event(e):e)}}}function ud(t,e,n,r,i,a,o,l,c,d){var h,g,b,p,y,w,S,x,C,P,L,U,ee,V,X,D=e.type;if(e.constructor!==void 0)return null;128&n.__u&&(c=!!(32&n.__u),a=[l=e.__e=n.__e]),(h=Jt.__b)&&h(e);e:if(typeof D=="function")try{if(x=e.props,C="prototype"in D&&D.prototype.render,P=(h=D.contextType)&&r[h.__c],L=h?P?P.props.value:h.__:r,n.__c?S=(g=e.__c=n.__c).__=g.__E:(C?e.__c=g=new D(x,L):(e.__c=g=new uo(x,L),g.constructor=D,g.render=r0),P&&P.sub(g),g.state||(g.state={}),g.__n=r,b=g.__d=!0,g.__h=[],g._sb=[]),C&&g.__s==null&&(g.__s=g.state),C&&D.getDerivedStateFromProps!=null&&(g.__s==g.state&&(g.__s=gi({},g.__s)),gi(g.__s,D.getDerivedStateFromProps(x,g.__s))),p=g.props,y=g.state,g.__v=e,b)C&&D.getDerivedStateFromProps==null&&g.componentWillMount!=null&&g.componentWillMount(),C&&g.componentDidMount!=null&&g.__h.push(g.componentDidMount);else{if(C&&D.getDerivedStateFromProps==null&&x!==p&&g.componentWillReceiveProps!=null&&g.componentWillReceiveProps(x,L),e.__v==n.__v||!g.__e&&g.shouldComponentUpdate!=null&&g.shouldComponentUpdate(x,g.__s,L)===!1){e.__v!=n.__v&&(g.props=x,g.state=g.__s,g.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(I){I&&(I.__=e)}),Ul.push.apply(g.__h,g._sb),g._sb=[],g.__h.length&&o.push(g);break e}g.componentWillUpdate!=null&&g.componentWillUpdate(x,g.__s,L),C&&g.componentDidUpdate!=null&&g.__h.push(function(){g.componentDidUpdate(p,y,w)})}if(g.context=L,g.props=x,g.__P=t,g.__e=!1,U=Jt.__r,ee=0,C)g.state=g.__s,g.__d=!1,U&&U(e),h=g.render(g.props,g.state,g.context),Ul.push.apply(g.__h,g._sb),g._sb=[];else do g.__d=!1,U&&U(e),h=g.render(g.props,g.state,g.context),g.state=g.__s;while(g.__d&&++ee<25);g.state=g.__s,g.getChildContext!=null&&(r=gi(gi({},r),g.getChildContext())),C&&!b&&g.getSnapshotBeforeUpdate!=null&&(w=g.getSnapshotBeforeUpdate(p,y)),V=h!=null&&h.type===At&&h.key==null?Up(h.props.children):h,l=jp(t,Co(V)?V:[V],e,n,r,i,a,o,l,c,d),g.base=e.__e,e.__u&=-161,g.__h.length&&o.push(g),S&&(g.__E=g.__=null)}catch(I){if(e.__v=null,c||a!=null)if(I.then){for(e.__u|=c?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;a[a.indexOf(l)]=null,e.__e=l}else{for(X=a.length;X--;)cd(a[X]);Ou(e)}else e.__e=n.__e,e.__k=n.__k,I.then||Ou(e);Jt.__e(I,e,n)}else a==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):l=e.__e=n0(n.__e,e,n,r,i,a,o,c,d);return(h=Jt.diffed)&&h(e),128&e.__u?void 0:l}function Ou(t){t&&(t.__c&&(t.__c.__e=!0),t.__k&&t.__k.some(Ou))}function Mp(t,e,n){for(var r=0;r<n.length;r++)dd(n[r],n[++r],n[++r]);Jt.__c&&Jt.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(a){a.call(i)})}catch(a){Jt.__e(a,i.__v)}})}function Up(t){return typeof t!="object"||t==null||t.__b>0?t:Co(t)?t.map(Up):gi({},t)}function n0(t,e,n,r,i,a,o,l,c){var d,h,g,b,p,y,w,S=n.props||Ml,x=e.props,C=e.type;if(C=="svg"?i="http://www.w3.org/2000/svg":C=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),a!=null){for(d=0;d<a.length;d++)if((p=a[d])&&"setAttribute"in p==!!C&&(C?p.localName==C:p.nodeType==3)){t=p,a[d]=null;break}}if(t==null){if(C==null)return document.createTextNode(x);t=document.createElementNS(i,C,x.is&&x),l&&(Jt.__m&&Jt.__m(e,a),l=!1),a=null}if(C==null)S===x||l&&t.data==x||(t.data=x);else{if(a=a&&Lo.call(t.childNodes),!l&&a!=null)for(S={},d=0;d<t.attributes.length;d++)S[(p=t.attributes[d]).name]=p.value;for(d in S)p=S[d],d=="dangerouslySetInnerHTML"?g=p:d=="children"||d in x||d=="value"&&"defaultValue"in x||d=="checked"&&"defaultChecked"in x||cl(t,d,null,p,i);for(d in x)p=x[d],d=="children"?b=p:d=="dangerouslySetInnerHTML"?h=p:d=="value"?y=p:d=="checked"?w=p:l&&typeof p!="function"||S[d]===p||cl(t,d,p,S[d],i);if(h)l||g&&(h.__html==g.__html||h.__html==t.innerHTML)||(t.innerHTML=h.__html),e.__k=[];else if(g&&(t.innerHTML=""),jp(e.type=="template"?t.content:t,Co(b)?b:[b],e,n,r,C=="foreignObject"?"http://www.w3.org/1999/xhtml":i,a,o,a?a[0]:n.__k&&xs(n,0),l,c),a!=null)for(d=a.length;d--;)cd(a[d]);l||(d="value",C=="progress"&&y==null?t.removeAttribute("value"):y!=null&&(y!==t[d]||C=="progress"&&!y||C=="option"&&y!=S[d])&&cl(t,d,y,S[d],i),d="checked",w!=null&&w!=t[d]&&cl(t,d,w,S[d],i))}return t}function dd(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(i){Jt.__e(i,n)}}function $p(t,e,n){var r,i;if(Jt.unmount&&Jt.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||dd(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(a){Jt.__e(a,e)}r.base=r.__P=null}if(r=t.__k)for(i=0;i<r.length;i++)r[i]&&$p(r[i],e,n||typeof t.type!="function");n||cd(t.__e),t.__c=t.__=t.__e=void 0}function r0(t,e,n){return this.constructor(t,n)}function i0(t,e,n){var r,i,a,o;e==document&&(e=document.documentElement),Jt.__&&Jt.__(t,e),i=(r=!1)?null:e.__k,a=[],o=[],ud(e,t=e.__k=Fp(At,null,[t]),i||Ml,Ml,e.namespaceURI,i?null:e.firstChild?Lo.call(e.childNodes):null,a,i?i.__e:e.firstChild,r,o),Mp(a,t,o)}function a0(t,e,n){var r,i,a,o,l=gi({},t.props);for(a in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),e)a=="key"?r=e[a]:a=="ref"?i=e[a]:l[a]=e[a]===void 0&&o!=null?o[a]:e[a];return arguments.length>2&&(l.children=arguments.length>3?Lo.call(arguments,2):n),co(t.type,l,r||t.key,i||t.ref,null)}function hd(t){function e(n){var r,i;return this.getChildContext||(r=new Set,(i={})[e.__c]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){r=null},this.shouldComponentUpdate=function(a){this.props.value!=a.value&&r.forEach(function(o){o.__e=!0,Iu(o)})},this.sub=function(a){r.add(a);var o=a.componentWillUnmount;a.componentWillUnmount=function(){r&&r.delete(a),o&&o.call(a)}}),n.children}return e.__c="__cC"+Rp++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,r){return n.children(r)}).contextType=e,e}Lo=Ul.slice,Jt={__e:function(t,e,n,r){for(var i,a,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((a=i.constructor)&&a.getDerivedStateFromError!=null&&(i.setState(a.getDerivedStateFromError(t)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,r||{}),o=i.__d),o)return i.__E=i}catch(l){t=l}throw t}},Tp=0,uo.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=gi({},this.state),typeof t=="function"&&(t=t(gi({},n),this.props)),t&&gi(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),Iu(this))},uo.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Iu(this))},uo.prototype.render=At,Pa=[],Ip=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Pp=function(t,e){return t.__v.__b-e.__v.__b},$l.__r=0,Op=/(PointerCapture)$|Capture$/i,ld=0,Cu=ph(!1),Tu=ph(!0),Rp=0;var s0=0;function s(t,e,n,r,i,a){e||(e={});var o,l,c=e;if("ref"in c)for(l in c={},e)l=="ref"?o=e[l]:c[l]=e[l];var d={type:t,props:c,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--s0,__i:-1,__u:0,__source:i,__self:a};if(typeof t=="function"&&(o=t.defaultProps))for(l in o)c[l]===void 0&&(c[l]=o[l]);return Jt.vnode&&Jt.vnode(d),d}var Ss,ln,qc,mh,vo=0,qp=[],Ln=Jt,gh=Ln.__b,vh=Ln.__r,bh=Ln.diffed,yh=Ln.__c,_h=Ln.unmount,wh=Ln.__;function Zl(t,e){Ln.__h&&Ln.__h(ln,t,vo||e),vo=0;var n=ln.__H||(ln.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function me(t){return vo=1,o0(Gp,t)}function o0(t,e,n){var r=Zl(Ss++,2);if(r.t=t,!r.__c&&(r.__=[Gp(void 0,e),function(l){var c=r.__N?r.__N[0]:r.__[0],d=r.t(c,l);c!==d&&(r.__N=[d,r.__[1]],r.__c.setState({}))}],r.__c=ln,!ln.__f)){var i=function(l,c,d){if(!r.__c.__H)return!0;var h=r.__c.__H.__.filter(function(b){return b.__c});if(h.every(function(b){return!b.__N}))return!a||a.call(this,l,c,d);var g=r.__c.props!==l;return h.some(function(b){if(b.__N){var p=b.__[0];b.__=b.__N,b.__N=void 0,p!==b.__[0]&&(g=!0)}}),a&&a.call(this,l,c,d)||g};ln.__f=!0;var a=ln.shouldComponentUpdate,o=ln.componentWillUpdate;ln.componentWillUpdate=function(l,c,d){if(this.__e){var h=a;a=void 0,i(l,c,d),a=h}o&&o.call(this,l,c,d)},ln.shouldComponentUpdate=i}return r.__N||r.__}function Mt(t,e){var n=Zl(Ss++,3);!Ln.__s&&Wp(n.__H,e)&&(n.__=t,n.u=e,ln.__H.__h.push(n))}function zp(t){return vo=5,ho(function(){return{current:t}},[])}function ho(t,e){var n=Zl(Ss++,7);return Wp(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function Nt(t,e){return vo=8,ho(function(){return t},e)}function Hp(t){var e=ln.context[t.__c],n=Zl(Ss++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(ln)),e.props.value):t.__}function l0(){for(var t;t=qp.shift();){var e=t.__H;if(t.__P&&e)try{e.__h.some(Tl),e.__h.some(Ru),e.__h=[]}catch(n){e.__h=[],Ln.__e(n,t.__v)}}}Ln.__b=function(t){ln=null,gh&&gh(t)},Ln.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),wh&&wh(t,e)},Ln.__r=function(t){vh&&vh(t),Ss=0;var e=(ln=t.__c).__H;e&&(qc===ln?(e.__h=[],ln.__h=[],e.__.some(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.some(Tl),e.__h.some(Ru),e.__h=[],Ss=0)),qc=ln},Ln.diffed=function(t){bh&&bh(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(qp.push(e)!==1&&mh===Ln.requestAnimationFrame||((mh=Ln.requestAnimationFrame)||c0)(l0)),e.__H.__.some(function(n){n.u&&(n.__H=n.u),n.u=void 0})),qc=ln=null},Ln.__c=function(t,e){e.some(function(n){try{n.__h.some(Tl),n.__h=n.__h.filter(function(r){return!r.__||Ru(r)})}catch(r){e.some(function(i){i.__h&&(i.__h=[])}),e=[],Ln.__e(r,n.__v)}}),yh&&yh(t,e)},Ln.unmount=function(t){_h&&_h(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.some(function(r){try{Tl(r)}catch(i){e=i}}),n.__H=void 0,e&&Ln.__e(e,n.__v))};var xh=typeof requestAnimationFrame=="function";function c0(t){var e,n=function(){clearTimeout(r),xh&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,35);xh&&(e=requestAnimationFrame(n))}function Tl(t){var e=ln,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),ln=e}function Ru(t){var e=ln;t.__c=t.__(),ln=e}function Wp(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function Gp(t,e){return typeof e=="function"?e(t):e}function Ql(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function u0(t,e,n,r){function i(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function l(h){try{d(r.next(h))}catch(g){o(g)}}function c(h){try{d(r.throw(h))}catch(g){o(g)}}function d(h){h.done?a(h.value):i(h.value).then(l,c)}d((r=r.apply(t,e||[])).next())})}const d0=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class fd extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class h0 extends fd{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Sh extends fd{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ah extends fd{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Fu;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Fu||(Fu={}));class f0{constructor(e,{headers:n={},customFetch:r,region:i=Fu.Any}={}){this.url=e,this.headers=n,this.region=i,this.fetch=d0(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return u0(this,arguments,void 0,function*(n,r={}){var i;let a,o;try{const{headers:l,method:c,body:d,signal:h,timeout:g}=r;let b={},{region:p}=r;p||(p=this.region);const y=new URL(`${this.url}/${n}`);p&&p!=="any"&&(b["x-region"]=p,y.searchParams.set("forceFunctionRegion",p));let w;d&&(l&&!Object.prototype.hasOwnProperty.call(l,"Content-Type")||!l)?typeof Blob<"u"&&d instanceof Blob||d instanceof ArrayBuffer?(b["Content-Type"]="application/octet-stream",w=d):typeof d=="string"?(b["Content-Type"]="text/plain",w=d):typeof FormData<"u"&&d instanceof FormData?w=d:(b["Content-Type"]="application/json",w=JSON.stringify(d)):d&&typeof d!="string"&&!(typeof Blob<"u"&&d instanceof Blob)&&!(d instanceof ArrayBuffer)&&!(typeof FormData<"u"&&d instanceof FormData)?w=JSON.stringify(d):w=d;let S=h;g&&(o=new AbortController,a=setTimeout(()=>o.abort(),g),h?(S=o.signal,h.addEventListener("abort",()=>o.abort())):S=o.signal);const x=yield this.fetch(y.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},b),this.headers),l),body:w,signal:S}).catch(U=>{throw new h0(U)}),C=x.headers.get("x-relay-error");if(C&&C==="true")throw new Sh(x);if(!x.ok)throw new Ah(x);let P=((i=x.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),L;return P==="application/json"?L=yield x.json():P==="application/octet-stream"||P==="application/pdf"?L=yield x.blob():P==="text/event-stream"?L=x:P==="multipart/form-data"?L=yield x.formData():L=yield x.text(),{data:L,error:null,response:x}}catch(l){return{data:null,error:l,response:l instanceof Ah||l instanceof Sh?l.context:void 0}}finally{a&&clearTimeout(a)}})}}var p0=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},m0=class{constructor(t){var e,n,r;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,this.urlLengthLimit=(r=t.urlLengthLimit)!==null&&r!==void 0?r:8e3,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let i=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async a=>{let o=null,l=null,c=null,d=a.status,h=a.statusText;if(a.ok){var g,b;if(n.method!=="HEAD"){var p;const x=await a.text();x===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((p=n.headers.get("Accept"))===null||p===void 0)&&p.includes("application/vnd.pgrst.plan+text"))?l=x:l=JSON.parse(x))}const w=(g=n.headers.get("Prefer"))===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),S=(b=a.headers.get("content-range"))===null||b===void 0?void 0:b.split("/");w&&S&&S.length>1&&(c=parseInt(S[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(l)&&(l.length>1?(o={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,c=null,d=406,h="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{var y;const w=await a.text();try{o=JSON.parse(w),Array.isArray(o)&&a.status===404&&(l=[],o=null,d=200,h="OK")}catch{a.status===404&&w===""?(d=204,h="No Content"):o={message:w}}if(o&&n.isMaybeSingle&&(!(o==null||(y=o.details)===null||y===void 0)&&y.includes("0 rows"))&&(o=null,d=200,h="OK"),o&&n.shouldThrowOnError)throw new p0(o)}return{error:o,data:l,count:c,status:d,statusText:h}});return this.shouldThrowOnError||(i=i.catch(a=>{var o;let l="",c="",d="";const h=a==null?void 0:a.cause;if(h){var g,b,p,y;const x=(g=h==null?void 0:h.message)!==null&&g!==void 0?g:"",C=(b=h==null?void 0:h.code)!==null&&b!==void 0?b:"";l=`${(p=a==null?void 0:a.name)!==null&&p!==void 0?p:"FetchError"}: ${a==null?void 0:a.message}`,l+=`

Caused by: ${(y=h==null?void 0:h.name)!==null&&y!==void 0?y:"Error"}: ${x}`,C&&(l+=` (${C})`),h!=null&&h.stack&&(l+=`
${h.stack}`)}else{var w;l=(w=a==null?void 0:a.stack)!==null&&w!==void 0?w:""}const S=this.url.toString().length;return(a==null?void 0:a.name)==="AbortError"||(a==null?void 0:a.code)==="ABORT_ERR"?(d="",c="Request was aborted (timeout or manual cancellation)",S>this.urlLengthLimit&&(c+=`. Note: Your request URL is ${S} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((h==null?void 0:h.name)==="HeadersOverflowError"||(h==null?void 0:h.code)==="UND_ERR_HEADERS_OVERFLOW")&&(d="",c="HTTP headers exceeded server limits (typically 16KB)",S>this.urlLengthLimit&&(c+=`. Your request URL is ${S} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(o=a==null?void 0:a.name)!==null&&o!==void 0?o:"FetchError"}: ${a==null?void 0:a.message}`,details:l,hint:c,code:d},data:null,count:null,status:0,statusText:""}})),i.then(t,e)}returns(){return this}overrideTypes(){return this}},g0=class extends m0{select(t){let e=!1;const n=(t??"*").split("").map(r=>/\s/.test(r)&&!e?"":(r==='"'&&(e=!e),r)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:r,referencedTable:i=r}={}){const a=i?`${i}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:r=n}={}){const i=typeof r>"u"?"offset":`${r}.offset`,a=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${t}`),this.url.searchParams.set(a,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:r=!1,wal:i=!1,format:a="text"}={}){var o;const l=[t?"analyze":null,e?"verbose":null,n?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${a}; for="${c}"; options=${l};`),a==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const kh=new RegExp("[,()]");var us=class extends g0{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&kh.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}notIn(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&kh.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`not.in.(${n})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:r}={}){let i="";r==="plain"?i="pl":r==="phrase"?i="ph":r==="websearch"&&(i="w");const a=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${i}fts${a}.${e}`),this}match(t){return Object.entries(t).forEach(([e,n])=>{this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}},v0=class{constructor(t,{headers:e={},schema:n,fetch:r,urlLengthLimit:i=8e3}){this.url=t,this.headers=new Headers(e),this.schema=n,this.fetch=r,this.urlLengthLimit=i}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,e){const{head:n=!1,count:r}=e??{},i=n?"HEAD":"GET";let a=!1;const o=(t??"*").split("").map(d=>/\s/.test(d)&&!a?"":(d==='"'&&(a=!a),d)).join(""),{url:l,headers:c}=this.cloneRequestState();return l.searchParams.set("select",o),r&&c.append("Prefer",`count=${r}`),new us({method:i,url:l,headers:c,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(t,{count:e,defaultToNull:n=!0}={}){var r;const i="POST",{url:a,headers:o}=this.cloneRequestState();if(e&&o.append("Prefer",`count=${e}`),n||o.append("Prefer","missing=default"),Array.isArray(t)){const l=t.reduce((c,d)=>c.concat(Object.keys(d)),[]);if(l.length>0){const c=[...new Set(l)].map(d=>`"${d}"`);a.searchParams.set("columns",c.join(","))}}return new us({method:i,url:a,headers:o,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:r,defaultToNull:i=!0}={}){var a;const o="POST",{url:l,headers:c}=this.cloneRequestState();if(c.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),e!==void 0&&l.searchParams.set("on_conflict",e),r&&c.append("Prefer",`count=${r}`),i||c.append("Prefer","missing=default"),Array.isArray(t)){const d=t.reduce((h,g)=>h.concat(Object.keys(g)),[]);if(d.length>0){const h=[...new Set(d)].map(g=>`"${g}"`);l.searchParams.set("columns",h.join(","))}}return new us({method:o,url:l,headers:c,schema:this.schema,body:t,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch,urlLengthLimit:this.urlLengthLimit})}update(t,{count:e}={}){var n;const r="PATCH",{url:i,headers:a}=this.cloneRequestState();return e&&a.append("Prefer",`count=${e}`),new us({method:r,url:i,headers:a,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:t}={}){var e;const n="DELETE",{url:r,headers:i}=this.cloneRequestState();return t&&i.append("Prefer",`count=${t}`),new us({method:n,url:r,headers:i,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}};function bo(t){"@babel/helpers - typeof";return bo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bo(t)}function b0(t,e){if(bo(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(bo(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function y0(t){var e=b0(t,"string");return bo(e)=="symbol"?e:e+""}function _0(t,e,n){return(e=y0(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Nh(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ul(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Nh(Object(n),!0).forEach(function(r){_0(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Nh(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var w0=class Vp{constructor(e,{headers:n={},schema:r,fetch:i,timeout:a,urlLengthLimit:o=8e3}={}){this.url=e,this.headers=new Headers(n),this.schemaName=r,this.urlLengthLimit=o;const l=i??globalThis.fetch;a!==void 0&&a>0?this.fetch=(c,d)=>{const h=new AbortController,g=setTimeout(()=>h.abort(),a),b=d==null?void 0:d.signal;if(b){if(b.aborted)return clearTimeout(g),l(c,d);const p=()=>{clearTimeout(g),h.abort()};return b.addEventListener("abort",p,{once:!0}),l(c,ul(ul({},d),{},{signal:h.signal})).finally(()=>{clearTimeout(g),b.removeEventListener("abort",p)})}return l(c,ul(ul({},d),{},{signal:h.signal})).finally(()=>clearTimeout(g))}:this.fetch=l}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new v0(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(e){return new Vp(this.url,{headers:this.headers,schema:e,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,n={},{head:r=!1,get:i=!1,count:a}={}){var o;let l;const c=new URL(`${this.url}/rpc/${e}`);let d;const h=p=>p!==null&&typeof p=="object"&&(!Array.isArray(p)||p.some(h)),g=r&&Object.values(n).some(h);g?(l="POST",d=n):r||i?(l=r?"HEAD":"GET",Object.entries(n).filter(([p,y])=>y!==void 0).map(([p,y])=>[p,Array.isArray(y)?`{${y.join(",")}}`:`${y}`]).forEach(([p,y])=>{c.searchParams.append(p,y)})):(l="POST",d=n);const b=new Headers(this.headers);return g?b.set("Prefer",a?`count=${a},return=minimal`:"return=minimal"):a&&b.set("Prefer",`count=${a}`),new us({method:l,url:c,headers:b,schema:this.schemaName,body:d,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}};class x0{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const n=globalThis.process;if(n){const r=n.versions;if(r&&r.node){const i=r.node,a=parseInt(i.replace(/^v/,"").split(".")[0]);return a>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${a} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${a} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const S0="2.97.0",A0=`realtime-js/${S0}`,k0="1.0.0",Kp="2.0.0",Eh=Kp,Du=1e4,N0=1e3,E0=100;var sa;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(sa||(sa={}));var Dn;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Dn||(Dn={}));var ei;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(ei||(ei={}));var ju;(function(t){t.websocket="websocket"})(ju||(ju={}));var Oa;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Oa||(Oa={}));class L0{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r;const i=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,i)}_encodeJsonUserBroadcastPush(e){var n,r;const i=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},o=new TextEncoder().encode(JSON.stringify(i)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,n,r){var i,a;const o=e.topic,l=(i=e.ref)!==null&&i!==void 0?i:"",c=(a=e.join_ref)!==null&&a!==void 0?a:"",d=e.payload.event,h=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},g=Object.keys(h).length===0?"":JSON.stringify(h);if(c.length>255)throw new Error(`joinRef length ${c.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`ref length ${l.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`userEvent length ${d.length} exceeds maximum of 255`);if(g.length>255)throw new Error(`metadata length ${g.length} exceeds maximum of 255`);const b=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+l.length+o.length+d.length+g.length,p=new ArrayBuffer(this.HEADER_LENGTH+b);let y=new DataView(p),w=0;y.setUint8(w++,this.KINDS.userBroadcastPush),y.setUint8(w++,c.length),y.setUint8(w++,l.length),y.setUint8(w++,o.length),y.setUint8(w++,d.length),y.setUint8(w++,g.length),y.setUint8(w++,n),Array.from(c,x=>y.setUint8(w++,x.charCodeAt(0))),Array.from(l,x=>y.setUint8(w++,x.charCodeAt(0))),Array.from(o,x=>y.setUint8(w++,x.charCodeAt(0))),Array.from(d,x=>y.setUint8(w++,x.charCodeAt(0))),Array.from(g,x=>y.setUint8(w++,x.charCodeAt(0)));var S=new Uint8Array(p.byteLength+r.byteLength);return S.set(new Uint8Array(p),0),S.set(new Uint8Array(r),p.byteLength),S.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[i,a,o,l,c]=r;return n({join_ref:i,ref:a,topic:o,event:l,payload:c})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),i=new TextDecoder;switch(r){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,i)}}_decodeUserBroadcast(e,n,r){const i=n.getUint8(1),a=n.getUint8(2),o=n.getUint8(3),l=n.getUint8(4);let c=this.HEADER_LENGTH+4;const d=r.decode(e.slice(c,c+i));c=c+i;const h=r.decode(e.slice(c,c+a));c=c+a;const g=r.decode(e.slice(c,c+o));c=c+o;const b=e.slice(c,e.byteLength),p=l===this.JSON_ENCODING?JSON.parse(r.decode(b)):b,y={type:this.BROADCAST_EVENT,event:h,payload:p};return o>0&&(y.meta=JSON.parse(g)),{join_ref:null,ref:null,topic:d,event:this.BROADCAST_EVENT,payload:y}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([r])=>n.includes(r)))}}class Jp{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Qt;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Qt||(Qt={}));const Lh=(t,e,n={})=>{var r;const i=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((a,o)=>(a[o]=C0(o,t,e,i),a),{}):{}},C0=(t,e,n,r)=>{const i=e.find(l=>l.name===t),a=i==null?void 0:i.type,o=n[t];return a&&!r.includes(a)?Yp(a,o):Bu(o)},Yp=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return O0(e,n)}switch(t){case Qt.bool:return T0(e);case Qt.float4:case Qt.float8:case Qt.int2:case Qt.int4:case Qt.int8:case Qt.numeric:case Qt.oid:return I0(e);case Qt.json:case Qt.jsonb:return P0(e);case Qt.timestamp:return R0(e);case Qt.abstime:case Qt.date:case Qt.daterange:case Qt.int4range:case Qt.int8range:case Qt.money:case Qt.reltime:case Qt.text:case Qt.time:case Qt.timestamptz:case Qt.timetz:case Qt.tsrange:case Qt.tstzrange:return Bu(e);default:return Bu(e)}},Bu=t=>t,T0=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},I0=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},P0=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},O0=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let a;const o=t.slice(1,n);try{a=JSON.parse("["+o+"]")}catch{a=o?o.split(","):[]}return a.map(l=>Yp(e,l))}return t},R0=t=>typeof t=="string"?t.replace(" ","T"):t,Xp=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class zc{constructor(e,n,r={},i=Du){this.channel=e,this.event=n,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ch;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Ch||(Ch={}));class fo{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:a,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=fo.syncState(this.state,i,a,o),this.pendingDiffs.forEach(c=>{this.state=fo.syncDiff(this.state,c,a,o)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},i=>{const{onJoin:a,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=fo.syncDiff(this.state,i,a,o),l())}),this.onJoin((i,a,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:a,newPresences:o})}),this.onLeave((i,a,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:a,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,i){const a=this.cloneDeep(e),o=this.transformState(n),l={},c={};return this.map(a,(d,h)=>{o[d]||(c[d]=h)}),this.map(o,(d,h)=>{const g=a[d];if(g){const b=h.map(S=>S.presence_ref),p=g.map(S=>S.presence_ref),y=h.filter(S=>p.indexOf(S.presence_ref)<0),w=g.filter(S=>b.indexOf(S.presence_ref)<0);y.length>0&&(l[d]=y),w.length>0&&(c[d]=w)}else l[d]=h}),this.syncDiff(a,{joins:l,leaves:c},r,i)}static syncDiff(e,n,r,i){const{joins:a,leaves:o}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(a,(l,c)=>{var d;const h=(d=e[l])!==null&&d!==void 0?d:[];if(e[l]=this.cloneDeep(c),h.length>0){const g=e[l].map(p=>p.presence_ref),b=h.filter(p=>g.indexOf(p.presence_ref)<0);e[l].unshift(...b)}r(l,h,c)}),this.map(o,(l,c)=>{let d=e[l];if(!d)return;const h=c.map(g=>g.presence_ref);d=d.filter(g=>h.indexOf(g.presence_ref)<0),e[l]=d,i(l,d,c),d.length===0&&delete e[l]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const i=e[r];return"metas"in i?n[r]=i.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):n[r]=i,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Th;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Th||(Th={}));var po;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(po||(po={}));var ji;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(ji||(ji={}));class ms{constructor(e,n={config:{}},r){var i,a;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=Dn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new zc(this,ei.join,this.params,this.timeout),this.rejoinTimer=new Jp(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Dn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Dn.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Dn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Dn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Dn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ei.reply,{},(o,l)=>{this._trigger(this._replyEventName(l),o)}),this.presence=new fo(this),this.broadcastEndpointURL=Xp(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((a=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||a===void 0)&&a.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,i,a;if(this.socket.isConnected()||this.socket.connect(),this.state==Dn.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,d=(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(p=>p.filter))!==null&&i!==void 0?i:[],h=!!this.bindings[po.PRESENCE]&&this.bindings[po.PRESENCE].length>0||((a=this.params.config.presence)===null||a===void 0?void 0:a.enabled)===!0,g={},b={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:h}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(g.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(ji.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(ji.CLOSED)),this.updateJoinPayload(Object.assign({config:b},g)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:p})=>{var y;if(this.socket._isManualToken()||this.socket.setAuth(),p===void 0){e==null||e(ji.SUBSCRIBED);return}else{const w=this.bindings.postgres_changes,S=(y=w==null?void 0:w.length)!==null&&y!==void 0?y:0,x=[];for(let C=0;C<S;C++){const P=w[C],{filter:{event:L,schema:U,table:ee,filter:V}}=P,X=p&&p[C];if(X&&X.event===L&&ms.isFilterValueEqual(X.schema,U)&&ms.isFilterValueEqual(X.table,ee)&&ms.isFilterValueEqual(X.filter,V))x.push(Object.assign(Object.assign({},P),{id:X.id}));else{this.unsubscribe(),this.state=Dn.errored,e==null||e(ji.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=x,e&&e(ji.SUBSCRIBED);return}}).receive("error",p=>{this.state=Dn.errored,e==null||e(ji.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(ji.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===Dn.joined&&e===po.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var i;if(n==null)return Promise.reject("Payload is required for httpSend()");const a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},l=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(i=r.timeout)!==null&&i!==void 0?i:this.timeout);if(l.status===202)return{success:!0};let c=l.statusText;try{const d=await l.json();c=d.error||d.message||c}catch{}return Promise.reject(new Error(c))}async send(e,n={}){var r,i;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:a,payload:o}=e,l={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(l.Authorization=`Bearer ${this.socket.accessTokenValue}`);const c={method:"POST",headers:l,body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:o,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((i=d.body)===null||i===void 0?void 0:i.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(a=>{var o,l,c;const d=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&a("ok"),d.receive("ok",()=>a("ok")),d.receive("error",()=>a("error")),d.receive("timeout",()=>a("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Dn.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ei.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(i=>{r=new zc(this,ei.leave,{},e),r.receive("ok",()=>{n(),i("ok")}).receive("timeout",()=>{n(),i("timed out")}).receive("error",()=>{i("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Dn.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const i=new AbortController,a=setTimeout(()=>i.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:i.signal}));return clearTimeout(a),o}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new zc(this,e,n,r);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>E0){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var i,a;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:d,join:h}=ei;if(r&&[l,c,d,h].indexOf(o)>=0&&r!==this._joinRef())return;let b=this._onMessage(o,n,r);if(n&&!b)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(p=>{var y,w,S;return((y=p.filter)===null||y===void 0?void 0:y.event)==="*"||((S=(w=p.filter)===null||w===void 0?void 0:w.event)===null||S===void 0?void 0:S.toLocaleLowerCase())===o}).map(p=>p.callback(b,r)):(a=this.bindings[o])===null||a===void 0||a.filter(p=>{var y,w,S,x,C,P;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const L=p.id,U=(y=p.filter)===null||y===void 0?void 0:y.event;return L&&((w=n.ids)===null||w===void 0?void 0:w.includes(L))&&(U==="*"||(U==null?void 0:U.toLocaleLowerCase())===((S=n.data)===null||S===void 0?void 0:S.type.toLocaleLowerCase()))}else{const L=(C=(x=p==null?void 0:p.filter)===null||x===void 0?void 0:x.event)===null||C===void 0?void 0:C.toLocaleLowerCase();return L==="*"||L===((P=n==null?void 0:n.event)===null||P===void 0?void 0:P.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof b=="object"&&"ids"in b){const y=b.data,{schema:w,table:S,commit_timestamp:x,type:C,errors:P}=y;b=Object.assign(Object.assign({},{schema:w,table:S,commit_timestamp:x,eventType:C,new:{},old:{},errors:P}),this._getPayloadRecords(y))}p.callback(b,r)})}_isClosed(){return this.state===Dn.closed}_isJoined(){return this.state===Dn.joined}_isJoining(){return this.state===Dn.joining}_isLeaving(){return this.state===Dn.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const i=e.toLocaleLowerCase(),a={type:i,filter:n,callback:r};return this.bindings[i]?this.bindings[i].push(a):this.bindings[i]=[a],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(i=>{var a;return!(((a=i.type)===null||a===void 0?void 0:a.toLocaleLowerCase())===r&&ms.isEqual(i.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}static isFilterValueEqual(e,n){return(e??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ei.close,{},e)}_onError(e){this._on(ei.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Dn.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=Lh(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=Lh(e.columns,e.old_record)),n}}const Hc=()=>{},dl={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},F0=[1e3,2e3,5e3,1e4],D0=1e4,j0=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class B0{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Du,this.transport=null,this.heartbeatIntervalMs=dl.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Hc,this.ref=0,this.reconnectTimer=null,this.vsn=Eh,this.logger=Hc,this.conn=null,this.sendBuffer=[],this.serializer=new L0,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=i=>i?(...a)=>i(...a):(...a)=>fetch(...a),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${ju.websocket}`,this.httpEndpoint=Xp(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=x0.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case sa.connecting:return Oa.Connecting;case sa.open:return Oa.Open;case sa.closing:return Oa.Closing;default:return Oa.Closed}}isConnected(){return this.connectionState()===Oa.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,i=this.getChannels().find(a=>a.topic===r);if(i)return i;{const a=new ms(`realtime:${e}`,n,this);return this.channels.push(a),a}}push(e){const{topic:n,event:r,payload:i,ref:a}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${n} ${r} (${a})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(N0,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},dl.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply"&&n.ref&&n.ref===this.pendingHeartbeatRef){const d=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error",d)}catch(h){this.log("error","error in heartbeat callback",h)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:r,event:i,payload:a,ref:o}=n,l=o?`(${o})`:"",c=a.status||"";this.log("receive",`${c} ${r} ${i} ${l}`.trim(),a),this.channels.filter(d=>d._isMember(r)).forEach(d=>d._trigger(i,a,o)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===sa.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===sa.open||this.conn.readyState===sa.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(n){this.log("error","error in heartbeat callback",n)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(ei.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(n);return`${e}${r}${i}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([j0],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n,r=!1;if(e)n=e,r=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(i){this.log("error","Error fetching access token from callback",i),n=this.accessTokenValue}else n=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(i=>{const a={access_token:n,version:A0};n&&i.updateJoinPayload(a),i.joinedOnce&&i._isJoined()&&i._push(ei.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Jp(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},dl.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,i,a,o,l,c,d,h,g,b,p;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:Du,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:dl.HEARTBEAT_INTERVAL,this.worker=(a=e==null?void 0:e.worker)!==null&&a!==void 0?a:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=e==null?void 0:e.heartbeatCallback)!==null&&l!==void 0?l:Hc,this.vsn=(c=e==null?void 0:e.vsn)!==null&&c!==void 0?c:Eh,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(d=e==null?void 0:e.reconnectAfterMs)!==null&&d!==void 0?d:(y=>F0[y-1]||D0),this.vsn){case k0:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:((y,w)=>w(JSON.stringify(y))),this.decode=(g=e==null?void 0:e.decode)!==null&&g!==void 0?g:((y,w)=>w(JSON.parse(y)));break;case Kp:this.encode=(b=e==null?void 0:e.encode)!==null&&b!==void 0?b:this.serializer.encode.bind(this.serializer),this.decode=(p=e==null?void 0:e.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var yo=class extends Error{constructor(t,e){var n;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((n=e.icebergType)==null?void 0:n.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function M0(t,e,n){const r=new URL(e,t);if(n)for(const[i,a]of Object.entries(n))a!==void 0&&r.searchParams.set(i,a);return r.toString()}async function U0(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function $0(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:r,query:i,body:a,headers:o}){const l=M0(t.baseUrl,r,i),c=await U0(t.auth),d=await e(l,{method:n,headers:{...a?{"Content-Type":"application/json"}:{},...c,...o},body:a?JSON.stringify(a):void 0}),h=await d.text(),g=(d.headers.get("content-type")||"").includes("application/json"),b=g&&h?JSON.parse(h):h;if(!d.ok){const p=g?b:void 0,y=p==null?void 0:p.error;throw new yo((y==null?void 0:y.message)??`Request failed with status ${d.status}`,{status:d.status,icebergType:y==null?void 0:y.type,icebergCode:y==null?void 0:y.code,details:p})}return{status:d.status,headers:d.headers,data:b}}}}function hl(t){return t.join("")}var q0=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:hl(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${hl(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${hl(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${hl(t.namespace)}`}),!0}catch(e){if(e instanceof yo&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof yo&&n.status===409)return;throw n}}};function ts(t){return t.join("")}var z0=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ts(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ts(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ts(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ts(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ts(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ts(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof yo&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof yo&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},H0=class{constructor(t){var r;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=$0({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(r=t.accessDelegation)==null?void 0:r.join(","),this.namespaceOps=new q0(this.client,e),this.tableOps=new z0(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},ec=class extends Error{constructor(t,e="storage",n,r){super(t),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=n,this.statusCode=r}};function tc(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var fl=class extends ec{constructor(t,e,n,r="storage"){super(t,r,e,n),this.name=r==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Zp=class extends ec{constructor(t,e,n="storage"){super(t,n),this.name=n==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const W0=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),G0=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Mu=t=>{if(Array.isArray(t))return t.map(n=>Mu(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const i=n.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""));e[i]=Mu(r)}),e},V0=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function _o(t){"@babel/helpers - typeof";return _o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_o(t)}function K0(t,e){if(_o(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(_o(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function J0(t){var e=K0(t,"string");return _o(e)=="symbol"?e:e+""}function Y0(t,e,n){return(e=J0(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ih(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ot(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ih(Object(n),!0).forEach(function(r){Y0(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ih(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const Ph=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},X0=async(t,e,n,r)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const i=t,a=i.status||500;if(typeof i.json=="function")i.json().then(o=>{const l=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||a+"";e(new fl(Ph(o),a,l,r))}).catch(()=>{if(r==="vectors"){const o=a+"";e(new fl(i.statusText||`HTTP ${a} error`,a,o,r))}else{const o=a+"";e(new fl(i.statusText||`HTTP ${a} error`,a,o,r))}});else{const o=a+"";e(new fl(i.statusText||`HTTP ${a} error`,a,o,r))}}else e(new Zp(Ph(t),t,r))},Z0=(t,e,n,r)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||t==="HEAD"||!r?ot(ot({},i),n):(G0(r)?(i.headers=ot({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(r)):i.body=r,e!=null&&e.duplex&&(i.duplex=e.duplex),ot(ot({},i),n))};async function Zs(t,e,n,r,i,a,o){return new Promise((l,c)=>{t(n,Z0(e,r,i,a)).then(d=>{if(!d.ok)throw d;if(r!=null&&r.noResolveJson)return d;if(o==="vectors"){const h=d.headers.get("content-type");if(d.headers.get("content-length")==="0"||d.status===204)return{};if(!h||!h.includes("application/json"))return{}}return d.json()}).then(d=>l(d)).catch(d=>X0(d,c,r,o))})}function Qp(t="storage"){return{get:async(e,n,r,i)=>Zs(e,"GET",n,r,i,void 0,t),post:async(e,n,r,i,a)=>Zs(e,"POST",n,i,a,r,t),put:async(e,n,r,i,a)=>Zs(e,"PUT",n,i,a,r,t),head:async(e,n,r,i)=>Zs(e,"HEAD",n,ot(ot({},r),{},{noResolveJson:!0}),i,void 0,t),remove:async(e,n,r,i,a)=>Zs(e,"DELETE",n,i,a,r,t)}}const Q0=Qp("storage"),{get:wo,post:Qr,put:Uu,head:e1,remove:pd}=Q0,Lr=Qp("vectors");var ks=class{constructor(t,e={},n,r="storage"){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.fetch=W0(n),this.namespace=r}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=ot(ot({},this.headers),{},{[t]:e}),this}async handleOperation(t){var e=this;try{return{data:await t(),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(tc(n))return{data:null,error:n};throw n}}},t1=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(tc(e))return{data:null,error:e};throw e}}};let em;em=Symbol.toStringTag;var n1=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[em]="BlobDownloadBuilder",this.promise=null}asStream(){return new t1(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(tc(e))return{data:null,error:e};throw e}}};const r1={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Oh={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var i1=class extends ks{constructor(t,e={},n,r){super(t,e,r,"storage"),this.bucketId=n}async uploadOrUpdate(t,e,n,r){var i=this;return i.handleOperation(async()=>{let a;const o=ot(ot({},Oh),r);let l=ot(ot({},i.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&n instanceof Blob?(a=new FormData,a.append("cacheControl",o.cacheControl),c&&a.append("metadata",i.encodeMetadata(c)),a.append("",n)):typeof FormData<"u"&&n instanceof FormData?(a=n,a.has("cacheControl")||a.append("cacheControl",o.cacheControl),c&&!a.has("metadata")&&a.append("metadata",i.encodeMetadata(c))):(a=n,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=i.toBase64(i.encodeMetadata(c))),(typeof ReadableStream<"u"&&a instanceof ReadableStream||a&&typeof a=="object"&&"pipe"in a&&typeof a.pipe=="function")&&!o.duplex&&(o.duplex="half")),r!=null&&r.headers&&(l=ot(ot({},l),r.headers));const d=i._removeEmptyFolders(e),h=i._getFinalPath(d),g=await(t=="PUT"?Uu:Qr)(i.fetch,`${i.url}/object/${h}`,a,ot({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{path:d,id:g.Id,fullPath:g.Key}})}async upload(t,e,n){return this.uploadOrUpdate("POST",t,e,n)}async uploadToSignedUrl(t,e,n,r){var i=this;const a=i._removeEmptyFolders(t),o=i._getFinalPath(a),l=new URL(i.url+`/object/upload/sign/${o}`);return l.searchParams.set("token",e),i.handleOperation(async()=>{let c;const d=ot({upsert:Oh.upsert},r),h=ot(ot({},i.headers),{"x-upsert":String(d.upsert)});return typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",d.cacheControl)):(c=n,h["cache-control"]=`max-age=${d.cacheControl}`,h["content-type"]=d.contentType),{path:a,fullPath:(await Uu(i.fetch,l.toString(),c,{headers:h})).Key}})}async createSignedUploadUrl(t,e){var n=this;return n.handleOperation(async()=>{let r=n._getFinalPath(t);const i=ot({},n.headers);e!=null&&e.upsert&&(i["x-upsert"]="true");const a=await Qr(n.fetch,`${n.url}/object/upload/sign/${r}`,{},{headers:i}),o=new URL(n.url+a.url),l=o.searchParams.get("token");if(!l)throw new ec("No token returned by API");return{signedUrl:o.toString(),path:t,token:l}})}async update(t,e,n){return this.uploadOrUpdate("PUT",t,e,n)}async move(t,e,n){var r=this;return r.handleOperation(async()=>await Qr(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers}))}async copy(t,e,n){var r=this;return r.handleOperation(async()=>({path:(await Qr(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers})).Key}))}async createSignedUrl(t,e,n){var r=this;return r.handleOperation(async()=>{let i=r._getFinalPath(t),a=await Qr(r.fetch,`${r.url}/object/sign/${i}`,ot({expiresIn:e},n!=null&&n.transform?{transform:n.transform}:{}),{headers:r.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{signedUrl:encodeURI(`${r.url}${a.signedURL}${o}`)}})}async createSignedUrls(t,e,n){var r=this;return r.handleOperation(async()=>{const i=await Qr(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:e,paths:t},{headers:r.headers}),a=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i.map(o=>ot(ot({},o),{},{signedUrl:o.signedURL?encodeURI(`${r.url}${o.signedURL}${a}`):null}))})}download(t,e,n){const r=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),a=i?`?${i}`:"",o=this._getFinalPath(t),l=()=>wo(this.fetch,`${this.url}/${r}/${o}${a}`,{headers:this.headers,noResolveJson:!0},n);return new n1(l,this.shouldThrowOnError)}async info(t){var e=this;const n=e._getFinalPath(t);return e.handleOperation(async()=>Mu(await wo(e.fetch,`${e.url}/object/info/${n}`,{headers:e.headers})))}async exists(t){var e=this;const n=e._getFinalPath(t);try{return await e1(e.fetch,`${e.url}/object/${n}`,{headers:e.headers}),{data:!0,error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(tc(r)&&r instanceof Zp){const i=r.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:r}}throw r}}getPublicUrl(t,e){const n=this._getFinalPath(t),r=[],i=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&r.push(i);const a=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});o!==""&&r.push(o);let l=r.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${l}`)}}}async remove(t){var e=this;return e.handleOperation(async()=>await pd(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}))}async list(t,e,n){var r=this;return r.handleOperation(async()=>{const i=ot(ot(ot({},r1),e),{},{prefix:t||""});return await Qr(r.fetch,`${r.url}/object/list/${r.bucketId}`,i,{headers:r.headers},n)})}async listV2(t,e){var n=this;return n.handleOperation(async()=>{const r=ot({},t);return await Qr(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,r,{headers:n.headers},e)})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const a1="2.97.0",To={"X-Client-Info":`storage-js/${a1}`};var s1=class extends ks{constructor(t,e={},n,r){const i=new URL(t);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase."));const a=i.href.replace(/\/$/,""),o=ot(ot({},To),e);super(a,o,n,"storage")}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const n=e.listBucketOptionsToQueryString(t);return await wo(e.fetch,`${e.url}/bucket${n}`,{headers:e.headers})})}async getBucket(t){var e=this;return e.handleOperation(async()=>await wo(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}))}async createBucket(t,e={public:!1}){var n=this;return n.handleOperation(async()=>await Qr(n.fetch,`${n.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}))}async updateBucket(t,e){var n=this;return n.handleOperation(async()=>await Uu(n.fetch,`${n.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}))}async emptyBucket(t){var e=this;return e.handleOperation(async()=>await Qr(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await pd(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},o1=class extends ks{constructor(t,e={},n){const r=t.replace(/\/$/,""),i=ot(ot({},To),e);super(r,i,n,"storage")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Qr(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}))}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const n=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&n.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&n.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&n.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&n.set("sortOrder",t.sortOrder),t!=null&&t.search&&n.set("search",t.search);const r=n.toString(),i=r?`${e.url}/bucket?${r}`:`${e.url}/bucket`;return await wo(e.fetch,i,{headers:e.headers})})}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await pd(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}from(t){var e=this;if(!V0(t))throw new ec("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new H0({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(i,a){const o=i[a];return typeof o!="function"?o:async(...l)=>{try{return{data:await o.apply(i,l),error:null}}catch(c){if(r)throw c;return{data:null,error:c}}}}})}},l1=class extends ks{constructor(t,e={},n){const r=t.replace(/\/$/,""),i=ot(ot({},To),{},{"Content-Type":"application/json"},e);super(r,i,n,"vectors")}async createIndex(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{})}async getIndex(t,e){var n=this;return n.handleOperation(async()=>await Lr.post(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers}))}async listIndexes(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}))}async deleteIndex(t,e){var n=this;return n.handleOperation(async()=>await Lr.post(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers})||{})}},c1=class extends ks{constructor(t,e={},n){const r=t.replace(/\/$/,""),i=ot(ot({},To),{},{"Content-Type":"application/json"},e);super(r,i,n,"vectors")}async putVectors(t){var e=this;if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{})}async getVectors(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}))}async listVectors(t){var e=this;if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}))}async queryVectors(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}))}async deleteVectors(t){var e=this;if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{})}},u1=class extends ks{constructor(t,e={},n){const r=t.replace(/\/$/,""),i=ot(ot({},To),{},{"Content-Type":"application/json"},e);super(r,i,n,"vectors")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}async getBucket(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}))}async listBuckets(t={}){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}},d1=class extends u1{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new h1(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,n=this;return e().call(n,t)}async getBucket(t){var e=()=>super.getBucket,n=this;return e().call(n,t)}async listBuckets(t={}){var e=()=>super.listBuckets,n=this;return e().call(n,t)}async deleteBucket(t){var e=()=>super.deleteBucket,n=this;return e().call(n,t)}},h1=class extends l1{constructor(t,e,n,r){super(t,e,r),this.vectorBucketName=n}async createIndex(t){var e=()=>super.createIndex,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,n=this;return e().call(n,n.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,n=this;return e().call(n,n.vectorBucketName,t)}index(t){return new f1(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},f1=class extends c1{constructor(t,e,n,r,i){super(t,e,i),this.vectorBucketName=n,this.indexName=r}async putVectors(t){var e=()=>super.putVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(t){var e=()=>super.getVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},p1=class extends s1{constructor(t,e={},n,r){super(t,e,n,r)}from(t){return new i1(this.url,this.headers,t,this.fetch)}get vectors(){return new d1(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new o1(this.url+"/iceberg",this.headers,this.fetch)}};const tm="2.97.0",ds=30*1e3,$u=3,Wc=$u*ds,m1="http://localhost:9999",g1="supabase.auth.token",v1={"X-Client-Info":`gotrue-js/${tm}`},qu="X-Supabase-Api-Version",nm={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},b1=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,y1=600*1e3;class xo extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Ye(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class _1 extends xo{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function w1(t){return Ye(t)&&t.name==="AuthApiError"}class Ra extends xo{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class Ui extends xo{constructor(e,n,r,i){super(e,r,i),this.name=n,this.status=r}}class Nr extends Ui{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Gc(t){return Ye(t)&&t.name==="AuthSessionMissingError"}class ns extends Ui{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class pl extends Ui{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ml extends Ui{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function x1(t){return Ye(t)&&t.name==="AuthImplicitGrantRedirectError"}class Rh extends Ui{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class S1 extends Ui{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class zu extends Ui{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function Vc(t){return Ye(t)&&t.name==="AuthRetryableFetchError"}class Fh extends Ui{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Hu extends Ui{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const ql="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Dh=` 	
\r=`.split(""),A1=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Dh.length;e+=1)t[Dh[e].charCodeAt(0)]=-2;for(let e=0;e<ql.length;e+=1)t[ql[e].charCodeAt(0)]=e;return t})();function jh(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(ql[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(ql[r]),e.queuedBits-=6}}function rm(t,e,n){const r=A1[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Bh(t){const e=[],n=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},a=o=>{E1(o,r,n)};for(let o=0;o<t.length;o+=1)rm(t.charCodeAt(o),i,a);return e.join("")}function k1(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function N1(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const i=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|i)+65536,n+=1}k1(r,e)}}function E1(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if((t>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function vs(t){const e=[],n={queue:0,queuedBits:0},r=i=>{e.push(i)};for(let i=0;i<t.length;i+=1)rm(t.charCodeAt(i),n,r);return new Uint8Array(e)}function L1(t){const e=[];return N1(t,n=>e.push(n)),new Uint8Array(e)}function Da(t){const e=[],n={queue:0,queuedBits:0},r=i=>{e.push(i)};return t.forEach(i=>jh(i,n,r)),jh(null,n,r),e.join("")}function C1(t){return Math.round(Date.now()/1e3)+t}function T1(){return Symbol("auth-callback")}const Wn=()=>typeof window<"u"&&typeof document<"u",Ea={tested:!1,writable:!1},im=()=>{if(!Wn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ea.tested)return Ea.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Ea.tested=!0,Ea.writable=!0}catch{Ea.tested=!0,Ea.writable=!1}return Ea.writable};function I1(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((i,a)=>{e[a]=i})}catch{}return n.searchParams.forEach((r,i)=>{e[i]=r}),e}const am=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),P1=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",hs=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},La=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Hn=async(t,e)=>{await t.removeItem(e)};class nc{constructor(){this.promise=new nc.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}nc.promiseConstructor=Promise;function gl(t){const e=t.split(".");if(e.length!==3)throw new Hu("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!b1.test(e[r]))throw new Hu("JWT not in base64url format");return{header:JSON.parse(Bh(e[0])),payload:JSON.parse(Bh(e[1])),signature:vs(e[2]),raw:{header:e[0],payload:e[1]}}}async function O1(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function R1(t,e){return new Promise((r,i)=>{(async()=>{for(let a=0;a<1/0;a++)try{const o=await t(a);if(!e(a,null,o)){r(o);return}}catch(o){if(!e(a,o)){i(o);return}}})()})}function F1(t){return("0"+t.toString(16)).substr(-2)}function D1(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let i="";for(let a=0;a<56;a++)i+=n.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(e),Array.from(e,F1).join("")}async function j1(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),i=new Uint8Array(r);return Array.from(i).map(a=>String.fromCharCode(a)).join("")}async function B1(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await j1(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function rs(t,e,n=!1){const r=D1();let i=r;n&&(i+="/PASSWORD_RECOVERY"),await hs(t,`${e}-code-verifier`,i);const a=await B1(r);return[a,r===a?"plain":"s256"]}const M1=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function U1(t){const e=t.headers.get(qu);if(!e||!e.match(M1))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function $1(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function q1(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const z1=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function is(t){if(!z1.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Kc(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function H1(t,e){return new Proxy(t,{get:(n,r,i)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const a=r.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)"||a==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,i)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,i)}})}function Mh(t){return JSON.parse(JSON.stringify(t))}const Ta=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),W1=[502,503,504];async function Uh(t){var e;if(!P1(t))throw new zu(Ta(t),0);if(W1.includes(t.status))throw new zu(Ta(t),t.status);let n;try{n=await t.json()}catch(a){throw new Ra(Ta(a),a)}let r;const i=U1(t);if(i&&i.getTime()>=nm["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new Fh(Ta(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Nr}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((a,o)=>a&&typeof o=="string",!0))throw new Fh(Ta(n),t.status,n.weak_password.reasons);throw new _1(Ta(n),t.status||500,r)}const G1=(t,e,n,r)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),n))};async function lt(t,e,n,r){var i;const a=Object.assign({},r==null?void 0:r.headers);a[qu]||(a[qu]=nm["2024-01-01"].name),r!=null&&r.jwt&&(a.Authorization=`Bearer ${r.jwt}`);const o=(i=r==null?void 0:r.query)!==null&&i!==void 0?i:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await V1(t,e,n+l,{headers:a,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function V1(t,e,n,r,i,a){const o=G1(e,r,i,a);let l;try{l=await t(n,Object.assign({},o))}catch(c){throw console.error(c),new zu(Ta(c),0)}if(l.ok||await Uh(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(c){await Uh(c)}}function Yr(t){var e;let n=null;Y1(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=C1(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function $h(t){const e=Yr(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function oa(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function K1(t){return{data:t,error:null}}function J1(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:i,verification_type:a}=t,o=Ql(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:n,hashed_token:r,redirect_to:i,verification_type:a},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function qh(t){return t}function Y1(t){return t.access_token&&t.refresh_token&&t.expires_in}const Jc=["global","local","others"];class X1{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=am(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=Jc[0]){if(Jc.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Jc.join(", ")}`);try{return await lt(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Ye(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await lt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:oa})}catch(r){if(Ye(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=Ql(e,["options"]),i=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(i.new_email=r==null?void 0:r.newEmail,delete i.newEmail),await lt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:J1,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(Ye(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await lt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:oa})}catch(n){if(Ye(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,i,a,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},h=await lt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(a=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:""},xform:qh});if(h.error)throw h.error;const g=await h.json(),b=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(y=>{const w=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(y.split(";")[1].split("=")[1]);d[`${S}Page`]=w}),d.total=parseInt(b)),{data:Object.assign(Object.assign({},g),d),error:null}}catch(d){if(Ye(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){is(e);try{return await lt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:oa})}catch(n){if(Ye(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){is(e);try{return await lt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:oa})}catch(r){if(Ye(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){is(e);try{return await lt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:oa})}catch(r){if(Ye(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){is(e.userId);try{const{data:n,error:r}=await lt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:n,error:r}}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _deleteFactor(e){is(e.userId),is(e.id);try{return{data:await lt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,i,a,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},h=await lt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(a=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:""},xform:qh});if(h.error)throw h.error;const g=await h.json(),b=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(y=>{const w=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(y.split(";")[1].split("=")[1]);d[`${S}Page`]=w}),d.total=parseInt(b)),{data:Object.assign(Object.assign({},g),d),error:null}}catch(d){if(Ye(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(e){try{return await lt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await lt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await lt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ye(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await lt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await lt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ye(n))return{data:null,error:n};throw n}}}function zh(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const as={debug:!!(globalThis&&im()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class sm extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Hh extends sm{}async function Z1(t,e,n){as.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;e>0&&setTimeout(()=>{r.abort(),as.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve();try{return await globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async i=>{if(i){as.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,i.name);try{return await n()}finally{as.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,i.name)}}else{if(e===0)throw as.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Hh(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(as.debug)try{const a=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(a,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}})}catch(i){throw(i==null?void 0:i.name)==="AbortError"?new Hh(`Acquiring an exclusive Navigator LockManager lock "${t}" timed out waiting ${e}ms`):i}}function Q1(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function om(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function ev(t){return parseInt(t,16)}function tv(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function nv(t){var e;const{chainId:n,domain:r,expirationTime:i,issuedAt:a=new Date,nonce:o,notBefore:l,requestId:c,resources:d,scheme:h,uri:g,version:b}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!g)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(b!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${b}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const p=om(t.address),y=h?`${h}://${r}`:r,w=t.statement?`${t.statement}
`:"",S=`${y} wants you to sign in with your Ethereum account:
${p}

${w}`;let x=`URI: ${g}
Version: ${b}
Chain ID: ${n}${o?`
Nonce: ${o}`:""}
Issued At: ${a.toISOString()}`;if(i&&(x+=`
Expiration Time: ${i.toISOString()}`),l&&(x+=`
Not Before: ${l.toISOString()}`),c&&(x+=`
Request ID: ${c}`),d){let C=`
Resources:`;for(const P of d){if(!P||typeof P!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${P}`);C+=`
- ${P}`}x+=C}return`${S}
${x}`}class En extends Error{constructor({message:e,code:n,cause:r,name:i}){var a;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(a=i??(r instanceof Error?r.name:void 0))!==null&&a!==void 0?a:"Unknown Error",this.code=n}}class zl extends En{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function rv({error:t,options:e}){var n,r,i;const{publicKey:a}=e;if(!a)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new En({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=a.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new En({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=a.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new En({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((i=a.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new En({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new En({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new En({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return a.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new En({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new En({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(lm(o)){if(a.rp.id!==o)return new En({message:`The RP ID "${a.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new En({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(a.user.id.byteLength<1||a.user.id.byteLength>64)return new En({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new En({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new En({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function iv({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new En({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new En({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(lm(r)){if(n.rpId!==r)return new En({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new En({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new En({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new En({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class av{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const sv=new av;function ov(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,i=Ql(t,["challenge","user","excludeCredentials"]),a=vs(e).buffer,o=Object.assign(Object.assign({},n),{id:vs(n.id).buffer}),l=Object.assign(Object.assign({},i),{challenge:a,user:o});if(r&&r.length>0){l.excludeCredentials=new Array(r.length);for(let c=0;c<r.length;c++){const d=r[c];l.excludeCredentials[c]=Object.assign(Object.assign({},d),{id:vs(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return l}function lv(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=Ql(t,["challenge","allowCredentials"]),i=vs(e).buffer,a=Object.assign(Object.assign({},r),{challenge:i});if(n&&n.length>0){a.allowCredentials=new Array(n.length);for(let o=0;o<n.length;o++){const l=n[o];a.allowCredentials[o]=Object.assign(Object.assign({},l),{id:vs(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return a}function cv(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:Da(new Uint8Array(t.response.attestationObject)),clientDataJSON:Da(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function uv(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),i=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Da(new Uint8Array(i.authenticatorData)),clientDataJSON:Da(new Uint8Array(i.clientDataJSON)),signature:Da(new Uint8Array(i.signature)),userHandle:i.userHandle?Da(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function lm(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function Wh(){var t,e;return!!(Wn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function dv(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new zl("Browser returned unexpected credential type",e)}:{data:null,error:new zl("Empty credential response",e)}}catch(e){return{data:null,error:rv({error:e,options:t})}}}async function hv(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new zl("Browser returned unexpected credential type",e)}:{data:null,error:new zl("Empty credential response",e)}}catch(e){return{data:null,error:iv({error:e,options:t})}}}const fv={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},pv={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Hl(...t){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),n=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),r={};for(const i of t)if(i)for(const a in i){const o=i[a];if(o!==void 0)if(Array.isArray(o))r[a]=o;else if(n(o))r[a]=o;else if(e(o)){const l=r[a];e(l)?r[a]=Hl(l,o):r[a]=Hl(o)}else r[a]=o}return r}function mv(t,e){return Hl(fv,t,e||{})}function gv(t,e){return Hl(pv,t,e||{})}class vv{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:i},a){var o;try{const{data:l,error:c}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!l)return{data:null,error:c};const d=i??sv.createNewAbortSignal();if(l.webauthn.type==="create"){const{user:h}=l.webauthn.credential_options.publicKey;if(!h.name){const g=r;if(g)h.name=`${h.id}:${g}`;else{const p=(await this.client.getUser()).data.user,y=((o=p==null?void 0:p.user_metadata)===null||o===void 0?void 0:o.name)||(p==null?void 0:p.email)||(p==null?void 0:p.id)||"User";h.name=`${h.id}:${y}`}}h.displayName||(h.displayName=h.name)}switch(l.webauthn.type){case"create":{const h=mv(l.webauthn.credential_options.publicKey,a==null?void 0:a.create),{data:g,error:b}=await dv({publicKey:h,signal:d});return g?{data:{factorId:e,challengeId:l.id,webauthn:{type:l.webauthn.type,credential_response:g}},error:null}:{data:null,error:b}}case"request":{const h=gv(l.webauthn.credential_options.publicKey,a==null?void 0:a.request),{data:g,error:b}=await hv(Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:h,signal:d}));return g?{data:{factorId:e,challengeId:l.id,webauthn:{type:l.webauthn.type,credential_response:g}},error:null}:{data:null,error:b}}}}catch(l){return Ye(l)?{data:null,error:l}:{data:null,error:new Ra("Unexpected error in challenge",l)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},a){if(!n)return{data:null,error:new xo("rpId is required for WebAuthn authentication")};try{if(!Wh())return{data:null,error:new Ra("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:i},{request:a});if(!o)return{data:null,error:l};const{webauthn:c}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:c.type,rpId:n,rpOrigins:r,credential_response:c.credential_response}})}catch(o){return Ye(o)?{data:null,error:o}:{data:null,error:new Ra("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},a){if(!n)return{data:null,error:new xo("rpId is required for WebAuthn registration")};try{if(!Wh())return{data:null,error:new Ra("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(h=>{var g;return(g=h.data)===null||g===void 0?void 0:g.all.find(b=>b.factor_type==="webauthn"&&b.friendly_name===e&&b.status!=="unverified")}).then(h=>h?this.client.mfa.unenroll({factorId:h==null?void 0:h.id}):void 0),{data:null,error:l};const{data:c,error:d}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:i},{create:a});return c?this._verify({factorId:o.id,challengeId:c.challengeId,webauthn:{rpId:n,rpOrigins:r,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:d}}catch(o){return Ye(o)?{data:null,error:o}:{data:null,error:new Ra("Unexpected error in register",o)}}}}Q1();const bv={url:m1,storageKey:g1,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:v1,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function Gh(t,e,n){return await n()}const ss={};class So{get jwks(){var e,n;return(n=(e=ss[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){ss[this.storageKey]=Object.assign(Object.assign({},ss[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=ss[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ss[this.storageKey]=Object.assign(Object.assign({},ss[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const a=Object.assign(Object.assign({},bv),e);if(this.storageKey=a.storageKey,this.instanceID=(n=So.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,So.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.instanceID>0&&Wn()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=a.persistSession,this.autoRefreshToken=a.autoRefreshToken,this.admin=new X1({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=am(a.fetch),this.lock=a.lock||Gh,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,this.throwOnError=a.throwOnError,this.lockAcquireTimeout=a.lockAcquireTimeout,a.lock?this.lock=a.lock:this.persistSession&&Wn()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=Z1:this.lock=Gh,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new vv(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:im()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=zh(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=zh(this.memoryStorage)),Wn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o);try{await this._notifyAllSubscribers(o.data.event,o.data.session,!1)}catch(l){this._debug("#broadcastChannel","error",l)}})}a.skipAutoInitialize||this.initialize().catch(o=>{this._debug("#initialize()","error",o)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${tm}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(Wn()&&(n=I1(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),Wn()&&this.detectSessionInUrl&&r!=="none"){const{data:i,error:a}=await this._getSessionFromURL(n,r);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),x1(a)){const c=(e=a.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:a}}return{error:a}}const{session:o,redirectType:l}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Ye(n)?this._returnResult({error:n}):this._returnResult({error:new Ra("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,i;try{const a=await lt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:Yr}),{data:o,error:l}=a;if(l||!o)return this._returnResult({data:{user:null,session:null},error:l});const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(a){if(Ye(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signUp(e){var n,r,i;try{let a;if("email"in e){const{email:h,password:g,options:b}=e;let p=null,y=null;this.flowType==="pkce"&&([p,y]=await rs(this.storage,this.storageKey)),a=await lt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:b==null?void 0:b.emailRedirectTo,body:{email:h,password:g,data:(n=b==null?void 0:b.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:b==null?void 0:b.captchaToken},code_challenge:p,code_challenge_method:y},xform:Yr})}else if("phone"in e){const{phone:h,password:g,options:b}=e;a=await lt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:g,data:(r=b==null?void 0:b.data)!==null&&r!==void 0?r:{},channel:(i=b==null?void 0:b.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:b==null?void 0:b.captchaToken}},xform:Yr})}else throw new pl("You must provide either an email or phone number and a password");const{data:o,error:l}=a;if(l||!o)return await Hn(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:l});const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(a){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithPassword(e){try{let n;if("email"in e){const{email:a,password:o,options:l}=e;n=await lt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:$h})}else if("phone"in e){const{phone:a,password:o,options:l}=e;n=await lt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:$h})}else throw new pl("You must provide either an email or phone number and a password");const{data:r,error:i}=n;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!r||!r.session||!r.user){const a=new ns;return this._returnResult({data:{user:null,session:null},error:a})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(n){if(Ye(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,i,a;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(a=e.options)===null||a===void 0?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,i,a,o,l,c,d,h,g,b;let p,y;if("message"in e)p=e.message,y=e.signature;else{const{chain:w,wallet:S,statement:x,options:C}=e;let P;if(Wn())if(typeof S=="object")P=S;else{const D=window;if("ethereum"in D&&typeof D.ethereum=="object"&&"request"in D.ethereum&&typeof D.ethereum.request=="function")P=D.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!(C!=null&&C.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");P=S}const L=new URL((n=C==null?void 0:C.url)!==null&&n!==void 0?n:window.location.href),U=await P.request({method:"eth_requestAccounts"}).then(D=>D).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!U||U.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const ee=om(U[0]);let V=(r=C==null?void 0:C.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!V){const D=await P.request({method:"eth_chainId"});V=ev(D)}const X={domain:L.host,address:ee,statement:x,uri:L.href,version:"1",chainId:V,nonce:(i=C==null?void 0:C.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(o=(a=C==null?void 0:C.signInWithEthereum)===null||a===void 0?void 0:a.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(l=C==null?void 0:C.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=C==null?void 0:C.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=C==null?void 0:C.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(h=C==null?void 0:C.signInWithEthereum)===null||h===void 0?void 0:h.resources};p=nv(X),y=await P.request({method:"personal_sign",params:[tv(p),ee]})}try{const{data:w,error:S}=await lt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:y},!((g=e.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(b=e.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:Yr});if(S)throw S;if(!w||!w.session||!w.user){const x=new ns;return this._returnResult({data:{user:null,session:null},error:x})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:S})}catch(w){if(Ye(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async signInWithSolana(e){var n,r,i,a,o,l,c,d,h,g,b,p;let y,w;if("message"in e)y=e.message,w=e.signature;else{const{chain:S,wallet:x,statement:C,options:P}=e;let L;if(Wn())if(typeof x=="object")L=x;else{const ee=window;if("solana"in ee&&typeof ee.solana=="object"&&("signIn"in ee.solana&&typeof ee.solana.signIn=="function"||"signMessage"in ee.solana&&typeof ee.solana.signMessage=="function"))L=ee.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof x!="object"||!(P!=null&&P.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");L=x}const U=new URL((n=P==null?void 0:P.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in L&&L.signIn){const ee=await L.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},P==null?void 0:P.signInWithSolana),{version:"1",domain:U.host,uri:U.href}),C?{statement:C}:null));let V;if(Array.isArray(ee)&&ee[0]&&typeof ee[0]=="object")V=ee[0];else if(ee&&typeof ee=="object"&&"signedMessage"in ee&&"signature"in ee)V=ee;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in V&&"signature"in V&&(typeof V.signedMessage=="string"||V.signedMessage instanceof Uint8Array)&&V.signature instanceof Uint8Array)y=typeof V.signedMessage=="string"?V.signedMessage:new TextDecoder().decode(V.signedMessage),w=V.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in L)||typeof L.signMessage!="function"||!("publicKey"in L)||typeof L!="object"||!L.publicKey||!("toBase58"in L.publicKey)||typeof L.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${U.host} wants you to sign in with your Solana account:`,L.publicKey.toBase58(),...C?["",C,""]:[""],"Version: 1",`URI: ${U.href}`,`Issued At: ${(i=(r=P==null?void 0:P.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((a=P==null?void 0:P.signInWithSolana)===null||a===void 0)&&a.notBefore?[`Not Before: ${P.signInWithSolana.notBefore}`]:[],...!((o=P==null?void 0:P.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${P.signInWithSolana.expirationTime}`]:[],...!((l=P==null?void 0:P.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${P.signInWithSolana.chainId}`]:[],...!((c=P==null?void 0:P.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${P.signInWithSolana.nonce}`]:[],...!((d=P==null?void 0:P.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${P.signInWithSolana.requestId}`]:[],...!((g=(h=P==null?void 0:P.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||g===void 0)&&g.length?["Resources",...P.signInWithSolana.resources.map(V=>`- ${V}`)]:[]].join(`
`);const ee=await L.signMessage(new TextEncoder().encode(y),"utf8");if(!ee||!(ee instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");w=ee}}try{const{data:S,error:x}=await lt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:Da(w)},!((b=e.options)===null||b===void 0)&&b.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Yr});if(x)throw x;if(!S||!S.session||!S.user){const C=new ns;return this._returnResult({data:{user:null,session:null},error:C})}return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),this._returnResult({data:Object.assign({},S),error:x})}catch(S){if(Ye(S))return this._returnResult({data:{user:null,session:null},error:S});throw S}}async _exchangeCodeForSession(e){const n=await La(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(n??"").split("/");try{if(!r&&this.flowType==="pkce")throw new S1;const{data:a,error:o}=await lt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Yr});if(await Hn(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!a||!a.session||!a.user){const l=new ns;return this._returnResult({data:{user:null,session:null,redirectType:null},error:l})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign(Object.assign({},a),{redirectType:i??null}),error:o})}catch(a){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(a))return this._returnResult({data:{user:null,session:null,redirectType:null},error:a});throw a}}async signInWithIdToken(e){try{const{options:n,provider:r,token:i,access_token:a,nonce:o}=e,l=await lt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:a,nonce:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Yr}),{data:c,error:d}=l;if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!c||!c.session||!c.user){const h=new ns;return this._returnResult({data:{user:null,session:null},error:h})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:d})}catch(n){if(Ye(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,i,a,o;try{if("email"in e){const{email:l,options:c}=e;let d=null,h=null;this.flowType==="pkce"&&([d,h]=await rs(this.storage,this.storageKey));const{error:g}=await lt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:h},redirectTo:c==null?void 0:c.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:g})}if("phone"in e){const{phone:l,options:c}=e,{data:d,error:h}=await lt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(i=c==null?void 0:c.data)!==null&&i!==void 0?i:{},create_user:(a=c==null?void 0:c.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:h})}throw new pl("You must provide either an email or phone number.")}catch(l){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async verifyOtp(e){var n,r;try{let i,a;"options"in e&&(i=(n=e.options)===null||n===void 0?void 0:n.redirectTo,a=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:l}=await lt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:i,xform:Yr});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,d=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(Ye(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(e){var n,r,i,a,o;try{let l=null,c=null;this.flowType==="pkce"&&([l,c]=await rs(this.storage,this.storageKey));const d=await lt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:c}),headers:this.headers,xform:K1});return!((a=d.data)===null||a===void 0)&&a.url&&Wn()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(d.data.url),this._returnResult(d)}catch(l){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(l))return this._returnResult({data:null,error:l});throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Nr;const{error:i}=await lt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(e){if(Ye(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:i,options:a}=e,{error:o}=await lt(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},redirectTo:a==null?void 0:a.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:r,type:i,options:a}=e,{data:o,error:l}=await lt(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l})}throw new pl("You must provide either an email or phone number and a type")}catch(n){if(Ye(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await La(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Wc:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await La(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=Kc()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=H1(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:i,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{session:null},error:a}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const n=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(e){try{return e?await lt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:oa}):await this._useSession(async n=>{var r,i,a;const{data:o,error:l}=n;if(l)throw l;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Nr}:await lt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(a=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&a!==void 0?a:void 0,xform:oa})})}catch(n){if(Ye(n))return Gc(n)&&(await this._removeSession(),await Hn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:i,error:a}=r;if(a)throw a;if(!i.session)throw new Nr;const o=i.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await rs(this.storage,this.storageKey));const{data:d,error:h}=await lt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:oa});if(h)throw h;return o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Nr;const n=Date.now()/1e3;let r=n,i=!0,a=null;const{payload:o}=gl(e.access_token);if(o.exp&&(r=o.exp,i=r<=n),i){const{data:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l)return{data:{user:null,session:null},error:null};a=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});a={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return this._returnResult({data:{user:a.user,session:a},error:null})}catch(n){if(Ye(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:o,error:l}=n;if(l)throw l;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Nr;const{data:i,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{user:null,session:null},error:a}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Ye(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Wn())throw new ml("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ml(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new Rh("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ml("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Rh("No code detected.");const{data:C,error:P}=await this._exchangeCodeForSession(e.code);if(P)throw P;const L=new URL(window.location.href);return L.searchParams.delete("code"),window.history.replaceState(window.history.state,"",L.toString()),{data:{session:C.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:a,refresh_token:o,expires_in:l,expires_at:c,token_type:d}=e;if(!a||!l||!o||!d)throw new ml("No session defined in URL");const h=Math.round(Date.now()/1e3),g=parseInt(l);let b=h+g;c&&(b=parseInt(c));const p=b-h;p*1e3<=ds&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${g}s`);const y=b-g;h-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,b,h):h-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,b,h);const{data:w,error:S}=await this._getUser(a);if(S)throw S;const x={provider_token:r,provider_refresh_token:i,access_token:a,expires_in:g,expires_at:b,refresh_token:o,token_type:d,user:w.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:x,redirectType:e.type},error:null})}catch(r){if(Ye(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await La(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:i,error:a}=n;if(a&&!Gc(a))return this._returnResult({error:a});const o=(r=i.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(w1(l)&&(l.status===404||l.status===401||l.status===403)||Gc(l)))return this._returnResult({error:l})}return e!=="others"&&(await this._removeSession(),await Hn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=T1(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,i;try{const{data:{session:a},error:o}=n;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",e,"session",a)}catch(a){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}})}async resetPasswordForEmail(e,n={}){let r=null,i=null;this.flowType==="pkce"&&([r,i]=await rs(this.storage,this.storageKey,!0));try{return await lt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(a){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(a))return this._returnResult({data:null,error:a});throw a}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:i}=await this._useSession(async a=>{var o,l,c,d,h;const{data:g,error:b}=a;if(b)throw b;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await lt(this.fetch,"GET",p,{headers:this.headers,jwt:(h=(d=g.session)===null||d===void 0?void 0:d.access_token)!==null&&h!==void 0?h:void 0})});if(i)throw i;return Wn()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(Ye(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:i,data:{session:a}}=n;if(i)throw i;const{options:o,provider:l,token:c,access_token:d,nonce:h}=e,g=await lt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=a==null?void 0:a.access_token)!==null&&r!==void 0?r:void 0,body:{provider:l,id_token:c,access_token:d,nonce:h,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Yr}),{data:b,error:p}=g;return p?this._returnResult({data:{user:null,session:null},error:p}):!b||!b.session||!b.user?this._returnResult({data:{user:null,session:null},error:new ns}):(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("USER_UPDATED",b.session)),this._returnResult({data:b,error:p}))}catch(i){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,i;const{data:a,error:o}=n;if(o)throw o;return await lt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(r=a.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0})})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await R1(async i=>(i>0&&await O1(200*Math.pow(2,i-1)),this._debug(n,"refreshing attempt",i),await lt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Yr})),(i,a)=>{const o=200*Math.pow(2,i);return a&&Vc(a)&&Date.now()+o-r<ds})}catch(r){if(this._debug(n,"error",r),Ye(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Wn()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const i=await La(this.storage,this.storageKey);if(i&&this.userStorage){let o=await La(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:i.user},await hs(this.userStorage,this.storageKey+"-user",o)),i.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:Kc()}else if(i&&!i.user&&!i.user){const o=await La(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(i.user=o.user,await Hn(this.storage,this.storageKey+"-user"),await hs(this.storage,this.storageKey,i)):i.user=Kc()}if(this._debug(r,"session from storage",i),!this._isValidSession(i)){this._debug(r,"session is not valid"),i!==null&&await this._removeSession();return}const a=((n=i.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Wc;if(this._debug(r,`session has${a?"":" not"} expired with margin of ${Wc}s`),a){if(this.autoRefreshToken&&i.refresh_token){const{error:o}=await this._callRefreshToken(i.refresh_token);o&&(console.error(o),Vc(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(i.access_token);!l&&(o!=null&&o.user)?(i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(r,"error",i),console.error(i);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Nr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new nc;const{data:a,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!a.session)throw new Nr;await this._saveSession(a.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const l={data:a.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(a){if(this._debug(i,"error",a),Ye(a)){const o={data:null,error:a};return Vc(a)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(a),a}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,n,r=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const a=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,n)}catch(c){a.push(c)}});if(await Promise.all(o),a.length>0){for(let l=0;l<a.length;l+=1)console.error(a[l]);throw a[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Hn(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await hs(this.userStorage,this.storageKey+"-user",{user:n.user});const i=Object.assign({},n);delete i.user;const a=Mh(i);await hs(this.storage,this.storageKey,a)}else{const i=Mh(n);await hs(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Hn(this.storage,this.storageKey),await Hn(this.storage,this.storageKey+"-code-verifier"),await Hn(this.storage,this.storageKey+"-user"),this.userStorage&&await Hn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Wn()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ds);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const n=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const n=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,n&&clearTimeout(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-e)/ds);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${ds}ms, refresh threshold is ${$u} ticks`),i<=$u&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof sm)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Wn()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const i=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[a,o]=await rs(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(l.toString())}if(r!=null&&r.queryParams){const a=new URLSearchParams(r.queryParams);i.push(a.toString())}return r!=null&&r.skipBrowserRedirect&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:i,error:a}=n;return a?this._returnResult({data:null,error:a}):await lt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,i;const{data:a,error:o}=n;if(o)return this._returnResult({data:null,error:o});const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:d}=await lt(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});return d?this._returnResult({data:null,error:d}):(e.factorType==="totp"&&c.type==="totp"&&(!((i=c==null?void 0:c.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var r;const{data:i,error:a}=n;if(a)return this._returnResult({data:null,error:a});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?cv(e.webauthn.credential_response):uv(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:c}=await lt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:c}))})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var r;const{data:i,error:a}=n;if(a)return this._returnResult({data:null,error:a});const o=await lt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:l}=o;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:ov(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:lv(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const i={all:[],phone:[],totp:[],webauthn:[]};for(const a of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])i.all.push(a),a.status==="verified"&&i[a.factor_type].push(a);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(e){var n,r,i,a;if(e)try{const{payload:p}=gl(e);let y=null;p.aal&&(y=p.aal);let w=y;const{data:{user:S},error:x}=await this.getUser(e);if(x)return this._returnResult({data:null,error:x});((r=(n=S==null?void 0:S.factors)===null||n===void 0?void 0:n.filter(L=>L.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(w="aal2");const P=p.amr||[];return{data:{currentLevel:y,nextLevel:w,currentAuthenticationMethods:P},error:null}}catch(p){if(Ye(p))return this._returnResult({data:null,error:p});throw p}const{data:{session:o},error:l}=await this.getSession();if(l)return this._returnResult({data:null,error:l});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:c}=gl(o.access_token);let d=null;c.aal&&(d=c.aal);let h=d;((a=(i=o.user.factors)===null||i===void 0?void 0:i.filter(p=>p.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(h="aal2");const b=c.amr||[];return{data:{currentLevel:d,nextLevel:h,currentAuthenticationMethods:b},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:i}=n;return i?this._returnResult({data:null,error:i}):r?await lt(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new Nr})})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:i},error:a}=r;if(a)return this._returnResult({data:null,error:a});if(!i)return this._returnResult({data:null,error:new Nr});const o=await lt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&Wn()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Ye(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:i},error:a}=r;if(a)return this._returnResult({data:null,error:a});if(!i)return this._returnResult({data:null,error:new Nr});const o=await lt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&Wn()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Ye(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;return r?this._returnResult({data:null,error:r}):n?await lt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Nr})})}catch(e){if(Ye(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:r},error:i}=n;return i?this._returnResult({data:null,error:i}):r?(await lt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Nr})})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(l=>l.kid===e);if(r)return r;const i=Date.now();if(r=this.jwks.keys.find(l=>l.kid===e),r&&this.jwks_cached_at+y1>i)return r;const{data:a,error:o}=await lt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!a.keys||a.keys.length===0||(this.jwks=a,this.jwks_cached_at=i,r=a.keys.find(l=>l.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:p,error:y}=await this.getSession();if(y||!p.session)return this._returnResult({data:null,error:y});r=p.session.access_token}const{header:i,payload:a,signature:o,raw:{header:l,payload:c}}=gl(r);n!=null&&n.allowExpired||$1(a.exp);const d=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!d){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:a,header:i,signature:o},error:null}}const h=q1(i.alg),g=await crypto.subtle.importKey("jwk",d,h,!0,["verify"]);if(!await crypto.subtle.verify(h,g,o,L1(`${l}.${c}`)))throw new Hu("Invalid JWT signature");return{data:{claims:a,header:i,signature:o},error:null}}catch(r){if(Ye(r))return this._returnResult({data:null,error:r});throw r}}}So.nextInstanceID={};const yv=So,_v="2.97.0";let lo="";typeof Deno<"u"?lo="deno":typeof document<"u"?lo="web":typeof navigator<"u"&&navigator.product==="ReactNative"?lo="react-native":lo="node";const wv={"X-Client-Info":`supabase-js-${lo}/${_v}`},xv={headers:wv},Sv={schema:"public"},Av={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},kv={};function Ao(t){"@babel/helpers - typeof";return Ao=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ao(t)}function Nv(t,e){if(Ao(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Ao(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Ev(t){var e=Nv(t,"string");return Ao(e)=="symbol"?e:e+""}function Lv(t,e,n){return(e=Ev(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Vh(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function pn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Vh(Object(n),!0).forEach(function(r){Lv(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Vh(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const Cv=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Tv=()=>Headers,Iv=(t,e,n)=>{const r=Cv(n),i=Tv();return async(a,o)=>{var l;const c=(l=await e())!==null&&l!==void 0?l:t;let d=new i(o==null?void 0:o.headers);return d.has("apikey")||d.set("apikey",t),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),r(a,pn(pn({},o),{},{headers:d}))}};function Pv(t){return t.endsWith("/")?t:t+"/"}function Ov(t,e){var n,r;const{db:i,auth:a,realtime:o,global:l}=t,{db:c,auth:d,realtime:h,global:g}=e,b={db:pn(pn({},c),i),auth:pn(pn({},d),a),realtime:pn(pn({},h),o),storage:{},global:pn(pn(pn({},g),l),{},{headers:pn(pn({},(n=g==null?void 0:g.headers)!==null&&n!==void 0?n:{}),(r=l==null?void 0:l.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?b.accessToken=t.accessToken:delete b.accessToken,b}function Rv(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Pv(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Fv=class extends yv{constructor(t){super(t)}},Dv=class{constructor(t,e,n){var r,i;this.supabaseUrl=t,this.supabaseKey=e;const a=Rv(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const o=`sb-${a.hostname.split(".")[0]}-auth-token`,l={db:Sv,realtime:kv,auth:pn(pn({},Av),{},{storageKey:o}),global:xv},c=Ov(n??{},l);if(this.storageKey=(r=c.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(i=c.global.headers)!==null&&i!==void 0?i:{},c.accessToken)this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(h,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}});else{var d;this.auth=this._initSupabaseAuthClient((d=c.auth)!==null&&d!==void 0?d:{},this.headers,c.global.fetch)}this.fetch=Iv(e,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(pn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new w0(new URL("rest/v1",a).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch,timeout:c.db.timeout,urlLengthLimit:c.db.urlLengthLimit}),this.storage=new p1(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new f0(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,n;if(t.accessToken)return await t.accessToken();const{data:r}=await t.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:i,storageKey:a,flowType:o,lock:l,debug:c,throwOnError:d},h,g){const b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Fv({url:this.authUrl.href,headers:pn(pn({},b),h),storageKey:a,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:i,flowType:o,lock:l,debug:c,throwOnError:d,fetch:g,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new B0(this.realtimeUrl.href,pn(pn({},t),{},{params:pn(pn({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(t,e,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const jv=(t,e,n)=>new Dv(t,e,n);function Bv(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const e=t.version;if(e==null)return!1;const n=e.match(/^v(\d+)\./);return n?parseInt(n[1],10)<=18:!1}Bv()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Mv="https://ujuxhijcomgkqfwaovow.supabase.co",Uv="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdXhoaWpjb21na3Fmd2Fvdm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3NTg0NzgsImV4cCI6MjA4NzMzNDQ3OH0.pZuqL4HDtt5Z8yFf7tQNe5hTEz_W0_zyIV-lPebV_1Q",Le=jv(Mv,Uv),cm=hd(null);function $v({children:t}){const[e,n]=me(null),[r,i]=me(!0);Mt(()=>{Le.auth.getSession().then(({data:{session:c}})=>{n((c==null?void 0:c.user)??null),i(!1)});const{data:{subscription:l}}=Le.auth.onAuthStateChange((c,d)=>{n((d==null?void 0:d.user)??null)});return()=>l.unsubscribe()},[]);const a=Nt(async(l,c)=>{const{error:d}=await Le.auth.signInWithPassword({email:l,password:c});if(d)throw d},[]),o=Nt(async()=>{await Le.auth.signOut()},[]);return s(cm.Provider,{value:{user:e,loading:r,signIn:a,signOut:o},children:t})}function rc(){const t=Hp(cm);if(!t)throw new Error("useAuth must be used within AuthProvider");return t}const um=hd(null);function qv({children:t}){const[e,n]=me([]),r=Nt((a,o="info")=>{const l=Date.now();n(c=>[...c,{id:l,message:a,type:o}]),setTimeout(()=>{n(c=>c.filter(d=>d.id!==l))},3e3)},[]),i={success:a=>r(a,"success"),error:a=>r(a,"error"),info:a=>r(a,"info")};return s(um.Provider,{value:i,children:[t,s("div",{class:"toast-container",children:e.map(a=>s("div",{class:`toast toast-${a.type}`,children:a.message},a.id))})]})}function Qn(){return Hp(um)}var zv={};function vl(t,e){for(var n in e)t[n]=e[n];return t}function Hv(t,e,n){var r,i=/(?:\?([^#]*))?(#.*)?$/,a=t.match(i),o={};if(a&&a[1])for(var l=a[1].split("&"),c=0;c<l.length;c++){var d=l[c].split("=");o[decodeURIComponent(d[0])]=decodeURIComponent(d.slice(1).join("="))}t=Wu(t.replace(i,"")),e=Wu(e||"");for(var h=Math.max(t.length,e.length),g=0;g<h;g++)if(e[g]&&e[g].charAt(0)===":"){var b=e[g].replace(/(^:|[+*?]+$)/g,""),p=(e[g].match(/[+*?]+$/)||zv)[0]||"",y=~p.indexOf("+"),w=~p.indexOf("*"),S=t[g]||"";if(!S&&!w&&(p.indexOf("?")<0||y)){r=!1;break}if(o[b]=decodeURIComponent(S),y||w){o[b]=t.slice(g).map(decodeURIComponent).join("/");break}}else if(e[g]!==t[g]){r=!1;break}return(n.default===!0||r!==!1)&&o}function Wv(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:t.index-e.index}function Gv(t,e){return t.index=e,t.rank=(function(n){return n.props.default?0:Wu(n.props.path).map(Vv).join("")})(t),t.props}function Wu(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function Vv(t){return t.charAt(0)==":"?1+"*+?".indexOf(t.charAt(t.length-1))||4:5}var Kv={},ja=[],Kh=[],Er=null,dm={url:md()},Jv=hd(dm);function md(){var t;return""+((t=Er&&Er.location?Er.location:Er&&Er.getCurrentLocation?Er.getCurrentLocation():typeof location<"u"?location:Kv).pathname||"")+(t.search||"")}function ze(t,e){return e===void 0&&(e=!1),typeof t!="string"&&t.url&&(e=t.replace,t=t.url),(function(n){for(var r=ja.length;r--;)if(ja[r].canRoute(n))return!0;return!1})(t)&&(function(n,r){r===void 0&&(r="push"),Er&&Er[r]?Er[r](n):typeof history<"u"&&history[r+"State"]&&history[r+"State"](null,null,n)})(t,e?"replace":"push"),hm(t)}function hm(t){for(var e=!1,n=0;n<ja.length;n++)ja[n].routeTo(t)&&(e=!0);return e}function Yv(t){if(t&&t.getAttribute){var e=t.getAttribute("href"),n=t.getAttribute("target");if(e&&e.match(/^\//g)&&(!n||n.match(/^_?self$/i)))return ze(e)}}function Xv(t){return t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),!1}function Zv(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button)){var e=t.target;do if(e.localName==="a"&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))return;if(Yv(e))return Xv(t)}while(e=e.parentNode)}}var Jh=!1;function fm(t){t.history&&(Er=t.history),this.state={url:t.url||md()}}vl(fm.prototype=new uo,{shouldComponentUpdate:function(t){return t.static!==!0||t.url!==this.props.url||t.onChange!==this.props.onChange},canRoute:function(t){var e=Pu(this.props.children);return this.g(e,t)!==void 0},routeTo:function(t){this.setState({url:t});var e=this.canRoute(t);return this.p||this.forceUpdate(),e},componentWillMount:function(){this.p=!0},componentDidMount:function(){var t=this;Jh||(Jh=!0,Er||addEventListener("popstate",function(){hm(md())}),addEventListener("click",Zv)),ja.push(this),Er&&(this.u=Er.listen(function(e){var n=e.location||e;t.routeTo(""+(n.pathname||"")+(n.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),ja.splice(ja.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(t,e){t=t.filter(Gv).sort(Wv);for(var n=0;n<t.length;n++){var r=t[n],i=Hv(e,r.props.path,r.props);if(i)return[r,i]}},render:function(t,e){var n,r,i=t.onChange,a=e.url,o=this.c,l=this.g(Pu(t.children),a);if(l&&(r=a0(l[0],vl(vl({url:a,matches:n=l[1]},n),{key:void 0,ref:void 0}))),a!==(o&&o.url)){vl(dm,o=this.c={url:a,previous:o&&o.url,current:r,path:r?r.props.path:null,matches:n}),o.router=this,o.active=r?[r]:[];for(var c=Kh.length;c--;)Kh[c]({});typeof i=="function"&&i(o)}return Fp(Jv.Provider,{value:o},r)}});function Qv({children:t}){const{signOut:e}=rc(),[n,r]=me(!1),[i,a]=me(typeof window<"u"?window.location.pathname:"/crm/");Mt(()=>{const c=()=>a(window.location.pathname);return window.addEventListener("popstate",c),()=>window.removeEventListener("popstate",c)},[]);function o(c){r(!1),ze(c),a(c)}return s("div",{class:"app-layout",children:[s("button",{class:"mobile-toggle",onClick:()=>r(!n),"aria-label":"Menu",children:n?"":""}),s("aside",{class:`sidebar ${n?"open":""}`,children:[s("div",{class:"sidebar-brand",onClick:()=>o("/crm/"),style:"cursor:pointer",children:"Beck360 CRM"}),s("nav",{class:"sidebar-nav",children:[{path:"/crm/",label:"Dashboard",icon:""},{path:"/crm/pipeline",label:"Pipeline",icon:""},{path:"/crm/contacts",label:"Kontakte",icon:""},{path:"/crm/companies",label:"Firmen",icon:""},{path:"/crm/invoices",label:"Rechnungen",icon:""},{path:"/crm/expenses",label:"Ausgaben",icon:""},{path:"/crm/reports",label:"Berichte",icon:""},{path:"/crm/campaigns",label:"Kampagnen",icon:""},{path:"/crm/settings",label:"Einstellungen",icon:""}].map(c=>s("a",{class:`nav-item ${(c.path==="/crm/"?i==="/crm/":i.startsWith(c.path))?"active":""}`,href:c.path,onClick:d=>{d.preventDefault(),o(c.path)},children:[s("span",{class:"nav-icon",children:c.icon}),c.label]},c.path))}),s("div",{class:"sidebar-footer",children:s("button",{class:"btn btn-secondary btn-sm",style:"width: 100%",onClick:e,children:"Abmelden"})})]}),n&&s("div",{style:"position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:99",onClick:()=>r(!1)}),s("main",{class:"main-content",children:t})]})}function e2(){const{signIn:t}=rc(),[e,n]=me(""),[r,i]=me(""),[a,o]=me(null),[l,c]=me(!1);async function d(h){h.preventDefault(),o(null),c(!0);try{await t(e,r)}catch(g){o(g.message==="Invalid login credentials"?"Ungueltige Anmeldedaten":g.message)}c(!1)}return s("div",{class:"login-page",children:s("form",{class:"login-card",onSubmit:d,children:[s("div",{class:"login-title",children:"Beck360 CRM"}),s("div",{class:"login-subtitle",children:"Anmelden"}),a&&s("div",{class:"login-error",children:a}),s("div",{class:"form-group",children:[s("label",{for:"login-email",children:"E-Mail"}),s("input",{id:"login-email",type:"email",value:e,onInput:h=>n(h.target.value),required:!0,autocomplete:"email"})]}),s("div",{class:"form-group",children:[s("label",{for:"login-password",children:"Passwort"}),s("input",{id:"login-password",type:"password",value:r,onInput:h=>i(h.target.value),required:!0,autocomplete:"current-password"})]}),s("button",{type:"submit",class:"btn btn-primary",style:"width: 100%; justify-content: center",disabled:l,children:l?"Anmelden...":"Anmelden"})]})})}function t2(){const[t,e]=me({totalContacts:0,newLeadsThisMonth:0,pipelineValue:0,wonDeals:0,conversionRate:0,dealsByStage:{}}),[n,r]=me([]),[i,a]=me(!0),o=Nt(async()=>{a(!0);const l=new Date,c=new Date(l.getFullYear(),l.getMonth(),1).toISOString(),[{count:d},{count:h},{data:g},{data:b},{data:p},{data:y}]=await Promise.all([Le.from("contacts").select("*",{count:"exact",head:!0}).is("deleted_at",null),Le.from("contacts").select("*",{count:"exact",head:!0}).is("deleted_at",null).gte("created_at",c),Le.from("deals").select("value, stage").is("deleted_at",null).not("stage","in",'("won","lost")'),Le.from("deals").select("value").is("deleted_at",null).eq("stage","won"),Le.from("deals").select("stage").is("deleted_at",null),Le.from("activities").select("*").order("created_at",{ascending:!1}).limit(10)]),w=(g||[]).reduce((L,U)=>L+(U.value||0),0),S=(b||[]).length,x=(p||[]).length,C=x>0?Math.round(S/x*100):0,P={};for(const L of p||[])P[L.stage]=(P[L.stage]||0)+1;e({totalContacts:d||0,newLeadsThisMonth:h||0,pipelineValue:w,wonDeals:S,conversionRate:C,dealsByStage:P}),r(y||[]),a(!1)},[]);return Mt(()=>{o()},[o]),{stats:t,recentActivities:n,loading:i,refetch:o}}const As={invoice:{label:"Rechnung",prefix:"R"},quote:{label:"Angebot",prefix:"A"}},Zn={draft:{label:"Entwurf",color:"#6366f1"},sent:{label:"Versendet",color:"#f59e0b"},paid:{label:"Bezahlt",color:"#10b981"},overdue:{label:"Ueberfaellig",color:"#ef4444"},cancelled:{label:"Storniert",color:"#64748b"}};function Il(t,e,n){var d;const r=new Date,i=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),o=String(r.getDate()).padStart(2,"0"),l=((d=As[t])==null?void 0:d.prefix)||"R",c=Yh(e)||Yh(n)||"XX";return`${l}-${i}-${a}-${o}-${c}`}function Yh(t){if(!t||!t.trim())return"";const e=t.trim(),n=e.split(/\s+/);return n.length>=2?n.map(r=>r[0]).join("").toUpperCase().slice(0,4):e.slice(0,3).toUpperCase()}function n2(t,e=0,n=19){const r=t.reduce((c,d)=>c+(parseFloat(d.quantity)||0)*(parseFloat(d.unit_price)||0),0),i=r*(parseFloat(e)||0)/100,a=r-i,o=a*(parseFloat(n)||0)/100,l=a+o;return{subtotal:Qs(r),discount_amount:Qs(i),net_amount:Qs(a),vat_amount:Qs(o),total_amount:Qs(l)}}function Qs(t){return Math.round(t*100)/100}function gd({type:t=null,status:e=null,companyId:n=null,dealId:r=null}={}){const[i,a]=me([]),[o,l]=me(!0),c=Nt(async()=>{l(!0);let d=Le.from("invoices").select(`
        *,
        company:companies(id, name),
        contact:contacts(id, first_name, last_name)
      `).is("deleted_at",null).order("created_at",{ascending:!1});t&&(d=d.eq("type",t)),e&&(d=d.eq("status",e)),n&&(d=d.eq("company_id",n)),r&&(d=d.eq("deal_id",r));const{data:h,error:g}=await d;g||a(h||[]),l(!1)},[t,e,n,r]);return Mt(()=>{c()},[c]),{invoices:i,loading:o,refetch:c}}function pm(t){const[e,n]=me(null),[r,i]=me([]),[a,o]=me(!0),[l,c]=me(null),d=Nt(async()=>{if(!t)return;o(!0),c(null);const[g,b]=await Promise.all([Le.from("invoices").select(`
          *,
          company:companies(id, name),
          contact:contacts(id, first_name, last_name, email, phone)
        `).eq("id",t).is("deleted_at",null).single(),Le.from("invoice_items").select("*").eq("invoice_id",t).order("position",{ascending:!0})]);g.error&&(console.error("useInvoice fetch error:",g.error),c(g.error)),b.error&&console.error("useInvoice items error:",b.error),n(g.data),i(b.data||[]),o(!1)},[t]);Mt(()=>{d()},[d]);const h=Nt(async g=>{const{error:b}=await Le.from("invoices").update(g).eq("id",t);return b||await d(),{error:b}},[t,d]);return{invoice:e,items:r,loading:a,fetchError:l,refetch:d,update:h}}async function r2(t,e){var d;const{data:n,error:r}=await Le.auth.getUser();if(r||!((d=n==null?void 0:n.user)!=null&&d.id))return{error:{message:"Nicht authentifiziert. Bitte erneut einloggen."}};const i=n.user.id,{data:a,error:o}=await Le.from("invoices").insert({...t,owner_id:i}).select().single();if(o)return{error:o};if(!a)return{error:{message:"Rechnung wurde nicht gespeichert."}};if(e&&e.length>0){const h=e.map((b,p)=>({invoice_id:a.id,position:p+1,description:b.description,sub_description:b.sub_description||null,quantity:parseFloat(b.quantity)||1,unit_price:parseFloat(b.unit_price)||0})),{error:g}=await Le.from("invoice_items").insert(h);if(g)return{data:a,error:g}}const l=t.type==="quote"?"quote_created":"invoice_created",c=t.type==="quote"?"Angebot":"Rechnung";return await Le.from("activities").insert({owner_id:i,deal_id:t.deal_id||null,contact_id:t.contact_id||null,company_id:t.company_id||null,type:l,description:`${c} erstellt: ${t.invoice_number}`,metadata:{invoice_id:a.id,invoice_number:t.invoice_number}}),{data:a,error:null}}async function i2(t,e,n){const{error:r}=await Le.from("invoices").update(e).eq("id",t);if(r)return{error:r};if(await Le.from("invoice_items").delete().eq("invoice_id",t),n&&n.length>0){const i=n.map((o,l)=>({invoice_id:t,position:l+1,description:o.description,sub_description:o.sub_description||null,quantity:parseFloat(o.quantity)||1,unit_price:parseFloat(o.unit_price)||0})),{error:a}=await Le.from("invoice_items").insert(i);if(a)return{error:a}}return{error:null}}async function a2(t){const{data:e}=await Le.auth.getUser(),n=e.user.id,[{data:r},{data:i}]=await Promise.all([Le.from("invoices").select("*").eq("id",t).single(),Le.from("invoice_items").select("*").eq("invoice_id",t).order("position")]);if(!r)return{error:{message:"Angebot nicht gefunden"}};const a=new Date,o=Il("invoice",r.customer_company,r.customer_name),{id:l,created_at:c,updated_at:d,...h}=r,{data:g,error:b}=await Le.from("invoices").insert({...h,type:"invoice",invoice_number:o,status:"draft",invoice_date:a.toISOString().slice(0,10),due_date:new Date(a.getTime()+14*864e5).toISOString().slice(0,10),converted_from_quote_id:t,paid_date:null,paid_amount:0}).select().single();if(b)return{error:b};if(i&&i.length>0){const p=i.map(y=>({invoice_id:g.id,position:y.position,description:y.description,sub_description:y.sub_description,quantity:y.quantity,unit_price:y.unit_price}));await Le.from("invoice_items").insert(p)}return await Le.from("activities").insert({owner_id:n,deal_id:r.deal_id||null,contact_id:r.contact_id||null,company_id:r.company_id||null,type:"quote_converted",description:`Angebot ${r.invoice_number} in Rechnung ${o} umgewandelt`,metadata:{quote_id:t,invoice_id:g.id}}),{data:g,error:null}}function ic(){const[t,e]=me(null),[n,r]=me(!0),i=Nt(async()=>{r(!0);const{data:o}=await Le.from("business_settings").select("*").limit(1).single();e(o),r(!1)},[]);Mt(()=>{i()},[i]);const a=Nt(async o=>{const{data:l}=await Le.auth.getUser();if(t){const{error:c}=await Le.from("business_settings").update(o).eq("id",t.id);return c||await i(),{error:c}}else{const{error:c}=await Le.from("business_settings").insert({...o,owner_id:l.user.id});return c||await i(),{error:c}}},[t,i]);return{settings:t,loading:n,save:a,refetch:i}}function s2(){const[t,e]=me({openCount:0,openAmount:0,monthRevenue:0}),[n,r]=me(!0),i=Nt(async()=>{r(!0);const a=new Date,o=new Date(a.getFullYear(),a.getMonth(),1).toISOString().slice(0,10),[{data:l},{data:c}]=await Promise.all([Le.from("invoices").select("total_amount").eq("type","invoice").is("deleted_at",null).in("status",["sent","overdue"]),Le.from("invoices").select("total_amount").eq("type","invoice").is("deleted_at",null).eq("status","paid").gte("paid_date",o)]),d=(l||[]).length,h=(l||[]).reduce((b,p)=>b+(parseFloat(p.total_amount)||0),0),g=(c||[]).reduce((b,p)=>b+(parseFloat(p.total_amount)||0),0);e({openCount:d,openAmount:h,monthRevenue:g}),r(!1)},[]);return Mt(()=>{i()},[i]),{stats:t,loading:n}}async function mm(t){const{error:e}=await Le.from("invoices").update({deleted_at:new Date().toISOString()}).eq("id",t);return{error:e}}function vd({contactId:t=null,dealId:e=null,companyId:n=null,limit:r=50}={}){const[i,a]=me([]),[o,l]=me(!0),c=Nt(async()=>{l(!0);let d=Le.from("activities").select("*").order("created_at",{ascending:!1}).limit(r);t&&(d=d.eq("contact_id",t)),e&&(d=d.eq("deal_id",e)),n&&(d=d.eq("company_id",n));const{data:h,error:g}=await d;g||a(h||[]),l(!1)},[t,e,n,r]);return Mt(()=>{c()},[c]),{activities:i,loading:o,refetch:c}}async function gm(t){const{data:e}=await Le.auth.getUser();return Le.from("activities").insert({...t,owner_id:e.user.id}).select().single()}function o2(){const[t,e]=me([]),[n,r]=me(!0),i=Nt(async()=>{r(!0);const{data:o}=await Le.from("activities").select(`
        *,
        contact:contacts(id, first_name, last_name),
        deal:deals(id, title)
      `).eq("type","task").eq("completed",!1).not("due_date","is",null).order("due_date",{ascending:!0});e(o||[]),r(!1)},[]);Mt(()=>{i()},[i]);const a=Nt(async o=>{const{error:l}=await Le.from("activities").update({completed:!0}).eq("id",o);return l||await i(),{error:l}},[i]);return{tasks:t,loading:n,refetch:i,complete:a}}function Ca({label:t,value:e,color:n}){return s("div",{class:"card",children:[s("div",{class:"kpi-value",style:n?`color: ${n}`:"",children:e}),s("div",{class:"kpi-label",children:t})]})}function jn(t){return t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):""}function bl(t){return t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function je(t){return t==null?"":new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)}function l2(t){if(!t)return"";const e=new Date,n=new Date(t),r=e-n,i=Math.floor(r/6e4),a=Math.floor(r/36e5),o=Math.floor(r/864e5);return i<1?"gerade eben":i<60?`vor ${i} Min.`:a<24?`vor ${a} Std.`:o<7?`vor ${o} Tag${o>1?"en":""}`:jn(t)}const Mi={new:{label:"Neu",color:"#6366f1"},contacted:{label:"Kontaktiert",color:"#f59e0b"},qualified:{label:"Qualifiziert",color:"#3b82f6"},proposal:{label:"Angebot",color:"#8b5cf6"},won:{label:"Gewonnen",color:"#10b981"},lost:{label:"Verloren",color:"#ef4444"}},Gu={"360-tour":"360 Rundgang","drone-photo":"Drohnenfoto","drone-video":"Drohnenvideo","drone-inspection":"PV-Inspektion",streetview:"Google Street View",bundle:"Paket",other:"Sonstiges"},ko={"360-rundgang":"360-Rundgang",firmenrundgang:"Firmenrundgang",manual:"Manuell",referral:"Empfehlung",other:"Sonstiges"},bd={note:{label:"Notiz",icon:""},call:{label:"Anruf",icon:""},email:{label:"E-Mail",icon:""},meeting:{label:"Treffen",icon:""},form_submission:{label:"Formular",icon:""},stage_change:{label:"Stage",icon:""},created:{label:"Erstellt",icon:""},task:{label:"Aufgabe",icon:""},invoice_created:{label:"Rechnung",icon:""},invoice_sent:{label:"Rechnung versendet",icon:""},quote_created:{label:"Angebot",icon:""},quote_converted:{label:"Angebot umgewandelt",icon:""}},la={draft:{label:"Entwurf",color:"#6366f1"},sending:{label:"Wird gesendet",color:"#f59e0b"},sent:{label:"Versendet",color:"#10b981"}},Xh=[{id:"follow-up",name:"Angebot nachfassen",icon:"",preview:"Offenes Angebot freundlich nachfassen",subject:"Ihr 360-Rundgang  Noch Fragen offen?",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"></head>
<body style="margin:0;padding:0;font-family:Inter,system-ui,sans-serif;background:#f8fafc;">
<div style="max-width:600px;margin:0 auto;padding:32px 24px;">
  <div style="background:#1a5c6b;padding:24px;border-radius:12px 12px 0 0;text-align:center;">
    <h1 style="color:#fff;margin:0;font-size:20px;">Beck360</h1>
  </div>
  <div style="background:#fff;padding:32px 24px;border-radius:0 0 12px 12px;line-height:1.6;color:#334155;">
    <p>Hallo {{vorname}},</p>
    <p>vor Kurzem haben wir ueber einen 360-Rundgang fuer {{firma}} gesprochen. Haben Sie noch Fragen zu unserem Angebot?</p>
    <p>Ich stehe Ihnen gerne fuer ein kurzes Gespraech zur Verfuegung.</p>
    <p style="margin-top:24px;">
      <a href="https://360-rundgang-karlsruhe.de" style="background:#1a5c6b;color:#fff;padding:12px 24px;border-radius:8px;text-decoration:none;display:inline-block;">Termin vereinbaren</a>
    </p>
    <p style="margin-top:24px;">Beste Gruesse<br><strong>Eugen Beck</strong><br>Beck360  360 Rundgaenge & Drohnenaufnahmen<br>+49 173 468 2501</p>
  </div>
  <div style="text-align:center;padding:16px;font-size:11px;color:#94a3b8;">
    Beck360 | Eichenweg 1, 76275 Ettlingen | <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#94a3b8;">Impressum</a>
  </div>
</div>
</body></html>`},{id:"new-service",name:"Neue Dienstleistung",icon:"",preview:"Neues Angebot oder Service vorstellen",subject:"Neu bei Beck360: Erweiterte 360-Loesungen",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"></head>
<body style="margin:0;padding:0;font-family:Inter,system-ui,sans-serif;background:#f8fafc;">
<div style="max-width:600px;margin:0 auto;padding:32px 24px;">
  <div style="background:#1a5c6b;padding:24px;border-radius:12px 12px 0 0;text-align:center;">
    <h1 style="color:#fff;margin:0;font-size:20px;">Beck360</h1>
  </div>
  <div style="background:#fff;padding:32px 24px;border-radius:0 0 12px 12px;line-height:1.6;color:#334155;">
    <p>Hallo {{vorname}},</p>
    <p>wir haben unser Angebot erweitert! Neben professionellen 360-Rundgaengen bieten wir jetzt auch Drohnenaufnahmen und virtuelle Touren an.</p>
    <p><strong>Ihre Vorteile:</strong></p>
    <ul>
      <li>Interaktive 360-Rundgaenge fuer Ihre Raeumlichkeiten</li>
      <li>Professionelle Drohnenfotos und -videos</li>
      <li>Google Street View Integration</li>
    </ul>
    <p style="margin-top:24px;">
      <a href="https://360-rundgang-karlsruhe.de" style="background:#1a5c6b;color:#fff;padding:12px 24px;border-radius:8px;text-decoration:none;display:inline-block;">Mehr erfahren</a>
    </p>
    <p style="margin-top:24px;">Beste Gruesse<br><strong>Eugen Beck</strong><br>Beck360<br>+49 173 468 2501</p>
  </div>
  <div style="text-align:center;padding:16px;font-size:11px;color:#94a3b8;">
    Beck360 | Eichenweg 1, 76275 Ettlingen | <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#94a3b8;">Impressum</a>
  </div>
</div>
</body></html>`},{id:"review",name:"Um Bewertung bitten",icon:"",preview:"Kunden um Google-Bewertung bitten",subject:"Wie war Ihre Erfahrung mit Beck360?",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"></head>
<body style="margin:0;padding:0;font-family:Inter,system-ui,sans-serif;background:#f8fafc;">
<div style="max-width:600px;margin:0 auto;padding:32px 24px;">
  <div style="background:#1a5c6b;padding:24px;border-radius:12px 12px 0 0;text-align:center;">
    <h1 style="color:#fff;margin:0;font-size:20px;">Beck360</h1>
  </div>
  <div style="background:#fff;padding:32px 24px;border-radius:0 0 12px 12px;line-height:1.6;color:#334155;">
    <p>Hallo {{vorname}},</p>
    <p>vielen Dank, dass Sie sich fuer Beck360 entschieden haben! Wir hoffen, Sie sind mit dem Ergebnis zufrieden.</p>
    <p>Wuerden Sie uns mit einer kurzen Google-Bewertung unterstuetzen? Das dauert nur 1 Minute und hilft uns enorm.</p>
    <p style="margin-top:24px;">
      <a href="https://www.google.com/maps/place/Beck360/@48.9408,8.4072,17z/?entry=ttu&action=write-review" style="background:#1a5c6b;color:#fff;padding:12px 24px;border-radius:8px;text-decoration:none;display:inline-block;">Jetzt bewerten</a>
    </p>
    <p style="margin-top:24px;">Herzlichen Dank!<br><strong>Eugen Beck</strong><br>Beck360<br>+49 173 468 2501</p>
  </div>
  <div style="text-align:center;padding:16px;font-size:11px;color:#94a3b8;">
    Beck360 | Eichenweg 1, 76275 Ettlingen | <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#94a3b8;">Impressum</a>
  </div>
</div>
</body></html>`},{id:"seasonal",name:"Saisonales Angebot",icon:"",preview:"Zeitlich begrenztes Angebot bewerben",subject:"Exklusives Angebot fuer {{firma}}  Nur fuer kurze Zeit",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"></head>
<body style="margin:0;padding:0;font-family:Inter,system-ui,sans-serif;background:#f8fafc;">
<div style="max-width:600px;margin:0 auto;padding:32px 24px;">
  <div style="background:#1a5c6b;padding:24px;border-radius:12px 12px 0 0;text-align:center;">
    <h1 style="color:#fff;margin:0;font-size:20px;">Beck360</h1>
  </div>
  <div style="background:#fff;padding:32px 24px;border-radius:0 0 12px 12px;line-height:1.6;color:#334155;">
    <p>Hallo {{vorname}},</p>
    <p>wir haben ein exklusives Angebot fuer Sie:</p>
    <div style="background:#f0fdf4;border:1px solid #bbf7d0;border-radius:8px;padding:20px;margin:16px 0;text-align:center;">
      <p style="font-size:18px;font-weight:700;color:#166534;margin:0 0 8px 0;">Fruehlings-Aktion 2026</p>
      <p style="font-size:14px;color:#15803d;margin:0;">360-Rundgang zum Sonderpreis  nur bis Ende des Monats!</p>
    </div>
    <p>Ob fuer Ihre Geschaeftsraeume, Ihr Hotel oder Ihre Immobilie  ein professioneller 360-Rundgang bringt Ihre Raeumlichkeiten online zum Leben.</p>
    <p style="margin-top:24px;">
      <a href="https://360-rundgang-karlsruhe.de" style="background:#1a5c6b;color:#fff;padding:12px 24px;border-radius:8px;text-decoration:none;display:inline-block;">Jetzt Angebot sichern</a>
    </p>
    <p style="margin-top:24px;">Beste Gruesse<br><strong>Eugen Beck</strong><br>Beck360  360 Rundgaenge & Drohnenaufnahmen<br>+49 173 468 2501</p>
  </div>
  <div style="text-align:center;padding:16px;font-size:11px;color:#94a3b8;">
    Beck360 | Eichenweg 1, 76275 Ettlingen | <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#94a3b8;">Impressum</a>
  </div>
</div>
</body></html>`},{id:"blank",name:"Leere Vorlage",icon:"",preview:"Leeres Template mit Beck360-Layout",subject:"",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"></head>
<body style="margin:0;padding:0;font-family:Inter,system-ui,sans-serif;background:#f8fafc;">
<div style="max-width:600px;margin:0 auto;padding:32px 24px;">
  <div style="background:#1a5c6b;padding:24px;border-radius:12px 12px 0 0;text-align:center;">
    <h1 style="color:#fff;margin:0;font-size:20px;">Beck360</h1>
  </div>
  <div style="background:#fff;padding:32px 24px;border-radius:0 0 12px 12px;line-height:1.6;color:#334155;">
    <p>Hallo {{vorname}},</p>
    <p><!-- Ihr Inhalt hier --></p>
    <p style="margin-top:24px;">Beste Gruesse<br><strong>Eugen Beck</strong><br>Beck360  360 Rundgaenge & Drohnenaufnahmen<br>+49 173 468 2501</p>
  </div>
  <div style="text-align:center;padding:16px;font-size:11px;color:#94a3b8;">
    Beck360 | Eichenweg 1, 76275 Ettlingen | <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#94a3b8;">Impressum</a>
  </div>
</div>
</body></html>`}],Wl={office:"Buero & Ausstattung",software:"Software & Lizenzen",marketing:"Marketing & Werbung",travel:"Reise & Fahrtkosten",equipment:"Geraete & Technik",insurance:"Versicherungen",telecom:"Telefon & Internet",professional:"Beratung & Dienstleistung",vehicle:"Fahrzeug",training:"Weiterbildung",other:"Sonstiges"},c2={bank_transfer:"Ueberweisung",cash:"Bar",credit_card:"Kreditkarte",paypal:"PayPal",direct_debit:"Lastschrift"},Gl=["Januar","Februar","Maerz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],yd=["Hotel / Pension","Gastronomie","Fitnessstudio","Einzelhandel","Autohaus","Gesundheit / Arztpraxis","Eventlocation","Coworking","Immobilien","Handwerk","Bildung","Sonstige"];function _d({activity:t}){const e=bd[t.type]||{label:t.type,icon:""};return s("div",{class:"timeline-item",children:s("div",{class:"timeline-content",children:[s("div",{class:"timeline-header",children:[s("span",{class:"timeline-icon",children:e.icon}),s("span",{class:"timeline-type",children:e.label}),s("span",{class:"timeline-time",children:l2(t.created_at)})]}),s("div",{class:"timeline-text",children:t.description})]})})}function ac({stage:t}){const e=Mi[t]||{label:t,color:"#64748b"};return s("span",{class:"stage-badge",style:`color: ${e.color}; background: ${e.color}1a`,children:e.label})}function Zh(){const{stats:t,recentActivities:e,loading:n}=t2(),{stats:r}=s2(),{tasks:i,complete:a}=o2();return n?s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Dashboard"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]}):s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Dashboard"}),s("div",{style:"display:flex;gap:0.5rem",children:[s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze("/crm/contacts/new"),children:"+ Kontakt"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/deals/new"),children:"+ Deal"})]})]}),s("div",{class:"page-body",children:[s("div",{class:"grid-4",style:"margin-bottom: 1.5rem",children:[s(Ca,{label:"Kontakte gesamt",value:t.totalContacts}),s(Ca,{label:"Neue Leads (Monat)",value:t.newLeadsThisMonth,color:"var(--info)"}),s(Ca,{label:"Pipeline-Wert",value:je(t.pipelineValue),color:"var(--primary-light)"}),s(Ca,{label:"Conversion-Rate",value:`${t.conversionRate}%`,color:"var(--success)"})]}),s("div",{class:"grid-3",style:"margin-bottom: 1.5rem",children:[s(Ca,{label:"Offene Rechnungen",value:r.openCount,color:"var(--warning)"}),s(Ca,{label:"Offener Betrag",value:je(r.openAmount),color:"var(--error)"}),s(Ca,{label:"Umsatz (Monat)",value:je(r.monthRevenue),color:"var(--success)"})]}),s("div",{class:"grid-2",style:"margin-bottom: 1.5rem",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Pipeline-Uebersicht"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/pipeline"),children:"Oeffnen"})]}),s("div",{style:"display:flex;flex-direction:column;gap:0.5rem",children:Object.entries(Mi).filter(([o])=>o!=="won"&&o!=="lost").map(([o,l])=>s("div",{style:"display:flex;align-items:center;justify-content:space-between;padding:0.4rem 0",children:[s(ac,{stage:o}),s("span",{style:"font-weight:600",children:t.dealsByStage[o]||0})]},o))})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Faellige Aufgaben"})}),i.length===0?s("div",{class:"empty-state",style:"padding:1rem",children:s("div",{class:"empty-state-text",children:"Keine faelligen Aufgaben"})}):s("div",{style:"display:flex;flex-direction:column;gap:0.5rem",children:i.slice(0,5).map(o=>s("div",{style:"display:flex;align-items:center;justify-content:space-between;padding:0.4rem 0;border-bottom:1px solid var(--border)",children:[s("div",{children:[s("div",{style:"font-size:0.85rem",children:o.description}),s("div",{style:"font-size:0.75rem;color:var(--text-dim)",children:["Faellig: ",jn(o.due_date),o.contact&&`  ${o.contact.first_name} ${o.contact.last_name}`]})]}),s("button",{class:"btn btn-sm btn-secondary",onClick:()=>a(o.id),children:"Erledigt"})]},o.id))})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Letzte Aktivitaeten"})}),e.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Noch keine Aktivitaeten"})]}):s("div",{class:"timeline",children:e.map(o=>s(_d,{activity:o},o.id))})]})]})]})}function wd({stage:t=null,contactId:e=null,companyId:n=null}={}){const[r,i]=me([]),[a,o]=me(!0),l=Nt(async()=>{o(!0);let c=Le.from("deals").select(`
        *,
        contact:contacts(id, first_name, last_name, email),
        company:companies(id, name)
      `).is("deleted_at",null).order("created_at",{ascending:!1});t&&(c=c.eq("stage",t)),e&&(c=c.eq("contact_id",e)),n&&(c=c.eq("company_id",n));const{data:d,error:h}=await c;h||i((d||[]).map(g=>{var b;return{...g,contact_name:g.contact?`${g.contact.first_name||""} ${g.contact.last_name||""}`.trim()||g.contact.email:null,company_name:((b=g.company)==null?void 0:b.name)||null}})),o(!1)},[t,e,n]);return Mt(()=>{l()},[l]),{deals:r,loading:a,refetch:l}}function u2(t){const[e,n]=me(null),[r,i]=me(!0),a=Nt(async()=>{if(!t)return;i(!0);const{data:c}=await Le.from("deals").select(`
        *,
        contact:contacts(id, first_name, last_name, email, phone),
        company:companies(id, name)
      `).eq("id",t).single();n(c),i(!1)},[t]);Mt(()=>{a()},[a]);const o=Nt(async c=>{const{error:d}=await Le.from("deals").update(c).eq("id",t);return d||await a(),{error:d}},[t,a]),l=Nt(async c=>{const d=e==null?void 0:e.stage,{error:h}=await Le.from("deals").update({stage:c,stage_changed_at:new Date().toISOString()}).eq("id",t);if(!h){const{data:g}=await Le.auth.getUser();await Le.from("activities").insert({owner_id:g.user.id,deal_id:t,contact_id:e==null?void 0:e.contact_id,type:"stage_change",description:`Stage geaendert: ${d}  ${c}`,metadata:{old_stage:d,new_stage:c}}),await a()}return{error:h}},[t,e,a]);return{deal:e,loading:r,refetch:a,update:o,changeStage:l}}async function d2(t){const{data:e}=await Le.auth.getUser(),{data:n,error:r}=await Le.from("deals").insert({...t,owner_id:e.user.id}).select().single();return r||await Le.from("activities").insert({owner_id:e.user.id,deal_id:n.id,contact_id:t.contact_id||null,type:"created",description:`Deal erstellt: ${t.title}`}),{data:n,error:r}}async function Qh(t,e,n,r){const{error:i}=await Le.from("deals").update({stage:e,stage_changed_at:new Date().toISOString()}).eq("id",t);if(!i){const{data:a}=await Le.auth.getUser();await Le.from("activities").insert({owner_id:a.user.id,deal_id:t,contact_id:r||null,type:"stage_change",description:`Stage geaendert: ${n}  ${e}`,metadata:{old_stage:n,new_stage:e}})}return{error:i}}const h2=["new","contacted","qualified","proposal","won","lost"];function f2({deal:t,onDragStart:e,onClick:n,onStageChange:r}){return s("div",{class:"deal-card",draggable:!0,onDragStart:i=>{i.dataTransfer.setData("text/plain",t.id),i.currentTarget.classList.add("dragging"),e&&e(t)},onDragEnd:i=>i.currentTarget.classList.remove("dragging"),onClick:()=>n&&n(t),children:[s("div",{class:"deal-card-title",children:t.title}),s("div",{class:"deal-card-meta",children:[s("span",{children:t.contact_name||""}),s("span",{children:t.value?je(t.value):""})]}),r&&s("select",{class:"deal-card-stage-select",value:t.stage,onClick:i=>i.stopPropagation(),onChange:i=>{i.stopPropagation(),r(t,i.target.value)},children:h2.map(i=>s("option",{value:i,children:Mi[i].label},i))})]})}const ef=["new","contacted","qualified","proposal","won","lost"];function p2(){const{deals:t,loading:e,refetch:n}=wd(),r=Qn(),[i,a]=me(null),o={};for(const d of ef)o[d]=t.filter(h=>h.stage===d);const l=Nt(async(d,h)=>{d.preventDefault(),a(null);const g=d.dataTransfer.getData("text/plain"),b=t.find(y=>y.id===g);if(!b||b.stage===h)return;const{error:p}=await Qh(g,h,b.stage,b.contact_id);p?r.error("Fehler beim Aendern der Stage"):(r.success(`Deal nach "${Mi[h].label}" verschoben`),n())},[t,n,r]),c=Nt(async(d,h)=>{if(d.stage===h)return;const{error:g}=await Qh(d.id,h,d.stage,d.contact_id);g?r.error("Fehler beim Aendern der Stage"):(r.success(`Deal nach "${Mi[h].label}" verschoben`),n())},[n,r]);return e?s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Pipeline"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]}):s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Pipeline"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze("/crm/deals/new"),children:"+ Neuer Deal"})]}),s("div",{class:"page-body",children:s("div",{class:"pipeline",children:ef.map(d=>s("div",{class:"pipeline-column",children:[s("div",{class:"pipeline-column-header",style:`border-top: 3px solid ${Mi[d].color}`,children:[s("span",{children:Mi[d].label}),s("span",{class:"pipeline-column-count",children:o[d].length})]}),s("div",{class:`pipeline-column-body ${i===d?"drag-over":""}`,onDragOver:h=>{h.preventDefault(),a(d)},onDragLeave:()=>a(null),onDrop:h=>l(h,d),children:o[d].length===0?s("div",{style:"text-align:center;padding:1rem;color:var(--text-dim);font-size:0.8rem",children:"Keine Deals"}):o[d].map(h=>s(f2,{deal:h,onClick:()=>ze(`/crm/deals/${h.id}`),onStageChange:c},h.id))})]},d))})})]})}function sc({search:t="",source:e=null}={}){const[n,r]=me([]),[i,a]=me(!0),o=Nt(async()=>{a(!0);let l=Le.from("contacts").select("*, company:companies(id, name)").is("deleted_at",null).order("created_at",{ascending:!1});e&&(l=l.eq("source",e)),t&&(l=l.or(`first_name.ilike.%${t}%,last_name.ilike.%${t}%,email.ilike.%${t}%`));const{data:c,error:d}=await l;d||r(c||[]),a(!1)},[t,e]);return Mt(()=>{o()},[o]),{contacts:n,loading:i,refetch:o}}function m2(t){const[e,n]=me(null),[r,i]=me(!0),a=Nt(async()=>{if(!t)return;i(!0);const{data:c}=await Le.from("contacts").select("*, company:companies(id, name)").eq("id",t).single();n(c),i(!1)},[t]);Mt(()=>{a()},[a]);const o=Nt(async c=>{const{error:d}=await Le.from("contacts").update(c).eq("id",t);return d||await a(),{error:d}},[t,a]),l=Nt(async()=>Le.from("contacts").update({deleted_at:new Date().toISOString()}).eq("id",t),[t]);return{contact:e,loading:r,refetch:a,update:o,softDelete:l}}async function xd(t){const{data:e}=await Le.auth.getUser(),{data:n,error:r}=await Le.from("contacts").insert({...t,owner_id:e.user.id}).select().single();return r||await Le.from("activities").insert({owner_id:e.user.id,contact_id:n.id,type:"created",description:"Kontakt manuell erstellt"}),{data:n,error:r}}function vm({value:t,onInput:e,placeholder:n="Suchen..."}){return s("input",{type:"search",class:"search-input",placeholder:n,value:t,onInput:r=>e(r.target.value)})}function Sd({filters:t,active:e,onSelect:n}){return s("div",{class:"filter-pills",children:[s("button",{class:`filter-pill ${e?"":"active"}`,onClick:()=>n(null),children:"Alle"}),t.map(r=>s("button",{class:`filter-pill ${e===r.value?"active":""}`,onClick:()=>n(r.value),children:r.label},r.value))]})}function Ma({title:t,onClose:e,children:n,footer:r,className:i}){const a=Nt(o=>{o.key==="Escape"&&e()},[e]);return Mt(()=>(document.addEventListener("keydown",a),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",a),document.body.style.overflow=""}),[a]),s("div",{class:"modal-overlay",onClick:o=>{o.target===o.currentTarget&&e()},children:s("div",{class:`modal${i?" "+i:""}`,role:"dialog","aria-modal":"true",children:[s("div",{class:"modal-header",children:[s("span",{children:t}),s("button",{class:"btn-icon",onClick:e,"aria-label":"Schliessen",children:""})]}),s("div",{class:"modal-body",children:n}),r&&s("div",{class:"modal-footer",children:r})]})})}function oc({search:t="",industry:e=null}={}){const[n,r]=me([]),[i,a]=me(!0),o=Nt(async()=>{a(!0);let l=Le.from("companies").select("*").is("deleted_at",null).order("created_at",{ascending:!1});e&&(l=l.eq("industry",e)),t&&(l=l.or(`name.ilike.%${t}%,city.ilike.%${t}%`));const{data:c,error:d}=await l;d||r(c||[]),a(!1)},[t,e]);return Mt(()=>{o()},[o]),{companies:n,loading:i,refetch:o}}function g2(t){const[e,n]=me(null),[r,i]=me(!0),a=Nt(async()=>{if(!t)return;i(!0);const{data:c}=await Le.from("companies").select("*").eq("id",t).is("deleted_at",null).single();n(c),i(!1)},[t]);Mt(()=>{a()},[a]);const o=Nt(async c=>{const{error:d}=await Le.from("companies").update(c).eq("id",t);return d||await a(),{error:d}},[t,a]),l=Nt(async()=>{const{error:c}=await Le.from("companies").update({deleted_at:new Date().toISOString()}).eq("id",t);return{error:c}},[t]);return{company:e,loading:r,refetch:a,update:o,softDelete:l}}async function lc(t){const{data:e}=await Le.auth.getUser();return Le.from("companies").insert({...t,owner_id:e.user.id}).select().single()}function tf(t,e){const n=[];let r="",i=!1;for(let a=0;a<t.length;a++){const o=t[a];i?o==='"'&&t[a+1]==='"'?(r+='"',a++):o==='"'?i=!1:r+=o:o==='"'?i=!0:o===e?(n.push(r.trim()),r=""):r+=o}return n.push(r.trim()),n}function v2(t){const e=(t.match(/;/g)||[]).length,n=(t.match(/,/g)||[]).length;return e>=n?";":","}function b2(t,e){const n={};return t.forEach((r,i)=>{n[r]=e[i]||""}),{companyName:n.Firma||"",firstName:n["Ansprechpartner Vorname"]||"",lastName:n["Ansprechpartner Nachname"]||"",email:n["E-Mail"]||n.Email||"",street:n.Strasse||"",zip:n.PLZ||"",city:n.Stadt||"",industry:n.Branche||"",vatId:n["USt-IdNr"]||"",notes:n.Notiz||""}}function y2(){const[t,e]=me(null),[n,r]=me(!1),[i,a]=me({current:0,total:0}),[o,l]=me(null),c=Nt(g=>{const b=g.split(/\r?\n/).filter(P=>P.trim());if(b.length<2)return null;const p=v2(b[0]),y=tf(b[0],p),w=b.slice(1).map(P=>b2(y,tf(P,p))),S=[...new Set(w.map(P=>P.companyName).filter(Boolean))],x=w.filter(P=>P.firstName||P.lastName),C={rows:w,companyNames:S,contactCount:x.length};return e(C),l(null),C},[]),d=Nt(async()=>{if(!t)return;r(!0),l(null);const{rows:g,companyNames:b}=t,p=b.length+g.filter(D=>D.firstName||D.lastName).length;a({current:0,total:p});let y={companies:0,contacts:0},w={companies:0,contacts:0},S=[],x=0;const{data:C}=await Le.from("companies").select("id, name").is("deleted_at",null),P=new Map((C||[]).map(D=>[D.name.toLowerCase(),D.id])),L=new Map;for(const D of b){const I=D.toLowerCase();if(P.has(I))L.set(D,P.get(I)),w.companies++;else{const k=g.find(J=>J.companyName===D),A=[k.street,k.zip,k.city].filter(Boolean).join(", "),{data:M,error:B}=await lc({name:D,address:A||null,city:k.city||null,industry:k.industry||null});B?S.push(`Firma "${D}": ${B.message}`):(L.set(D,M.id),y.companies++)}x++,a({current:x,total:p})}const{data:U}=await Le.from("contacts").select("id, first_name, last_name, company_id").is("deleted_at",null),ee=(D,I,k)=>`${(D||"").toLowerCase()}|${(I||"").toLowerCase()}|${k||""}`,V=new Set((U||[]).map(D=>ee(D.first_name,D.last_name,D.company_id)));for(const D of g){if(!D.firstName&&!D.lastName)continue;const I=L.get(D.companyName)||null,k=ee(D.firstName,D.lastName,I);if(V.has(k)){w.contacts++,x++,a({current:x,total:p});continue}const A=D.email||`${(D.firstName||"kontakt").toLowerCase()}.${(D.lastName||"").toLowerCase()}@platzhalter.de`.replace(/\s+/g,""),{error:M}=await xd({first_name:D.firstName||null,last_name:D.lastName||null,email:A,company_id:I,source:"manual"});M?S.push(`Kontakt "${D.firstName} ${D.lastName}": ${M.message}`):(y.contacts++,V.add(k)),x++,a({current:x,total:p})}const X={created:y,skipped:w,errors:S};return l(X),r(!1),X},[t]),h=Nt(()=>{e(null),l(null),a({current:0,total:0})},[]);return{parseCSV:c,importContacts:d,parsed:t,importing:n,progress:i,results:o,reset:h}}function _2({onClose:t,onSuccess:e}){const n=zp(null),[r,i]=me(""),{parseCSV:a,importContacts:o,parsed:l,importing:c,progress:d,results:h,reset:g}=y2(),b=S=>{const x=S.target.files[0];if(!x)return;i(x.name);const C=new FileReader;C.onload=P=>a(P.target.result),C.readAsText(x,"UTF-8")},p=async()=>{const S=await o();S&&S.errors.length===0&&(e==null||e())},y=()=>{g(),t()};return s(Ma,{title:"CSV Import",onClose:y,footer:h?s("button",{class:"btn btn-primary btn-sm",onClick:y,children:"Schliessen"}):s(At,{children:[s("button",{class:"btn btn-secondary btn-sm",onClick:y,disabled:c,children:"Abbrechen"}),l&&s("button",{class:"btn btn-primary btn-sm",onClick:p,disabled:c,children:c?"Importiere...":"Importieren"})]}),className:"modal-wide",children:[!l&&!h&&s("div",{children:[s("p",{style:"font-size:0.85rem;color:var(--text-muted);margin-bottom:1rem",children:"CSV-Datei mit Semikolon- oder Komma-Trennung hochladen. Erwartete Spalten: Firma, Ansprechpartner Vorname/Nachname, Strasse, PLZ, Stadt, Branche, Notiz."}),s("label",{class:"import-file-label",style:"display:flex;align-items:center;justify-content:center;gap:0.5rem;padding:2rem;border:2px dashed var(--border);border-radius:var(--radius-lg);cursor:pointer;color:var(--text-muted);font-size:0.85rem;transition:border-color 0.15s",children:[s("span",{children:r||"CSV-Datei auswaehlen..."}),s("input",{ref:n,type:"file",accept:".csv,.txt",onChange:b,style:"display:none"})]})]}),l&&!h&&s("div",{children:[s("div",{style:"display:flex;gap:1rem;margin-bottom:1rem",children:[s("div",{class:"card",style:"flex:1;padding:0.75rem;text-align:center",children:[s("div",{style:"font-size:1.25rem;font-weight:700;color:var(--primary)",children:l.companyNames.length}),s("div",{style:"font-size:0.75rem;color:var(--text-muted)",children:"Firmen"})]}),s("div",{class:"card",style:"flex:1;padding:0.75rem;text-align:center",children:[s("div",{style:"font-size:1.25rem;font-weight:700;color:var(--primary)",children:l.contactCount}),s("div",{style:"font-size:0.75rem;color:var(--text-muted)",children:"Kontakte"})]})]}),c&&s("div",{style:"margin-bottom:1rem",children:[s("div",{style:"display:flex;justify-content:space-between;font-size:0.75rem;color:var(--text-muted);margin-bottom:0.25rem",children:[s("span",{children:"Importiere..."}),s("span",{children:[d.current,"/",d.total]})]}),s("div",{style:"height:6px;background:var(--border);border-radius:3px;overflow:hidden",children:s("div",{style:`height:100%;background:var(--primary);border-radius:3px;transition:width 0.2s;width:${d.total?d.current/d.total*100:0}%`})})]}),s("div",{class:"card",style:"padding:0;max-height:240px;overflow-y:auto",children:s("table",{style:"font-size:0.8rem",children:[s("thead",{children:s("tr",{children:[s("th",{style:"padding:0.5rem 0.6rem",children:"Firma"}),s("th",{style:"padding:0.5rem 0.6rem",children:"Vorname"}),s("th",{style:"padding:0.5rem 0.6rem",children:"Nachname"}),s("th",{style:"padding:0.5rem 0.6rem",children:"Stadt"}),s("th",{style:"padding:0.5rem 0.6rem",children:"Branche"})]})}),s("tbody",{children:l.rows.map((S,x)=>s("tr",{children:[s("td",{style:"padding:0.4rem 0.6rem",children:S.companyName}),s("td",{style:"padding:0.4rem 0.6rem",children:S.firstName||""}),s("td",{style:"padding:0.4rem 0.6rem",children:S.lastName||""}),s("td",{style:"padding:0.4rem 0.6rem",children:S.city}),s("td",{style:"padding:0.4rem 0.6rem",children:S.industry})]},x))})]})})]}),h&&s("div",{children:[s("div",{style:"display:flex;gap:1rem;margin-bottom:1rem",children:[s("div",{class:"card",style:"flex:1;padding:0.75rem;text-align:center",children:[s("div",{style:"font-size:1.25rem;font-weight:700;color:var(--success)",children:h.created.companies}),s("div",{style:"font-size:0.75rem;color:var(--text-muted)",children:"Firmen erstellt"})]}),s("div",{class:"card",style:"flex:1;padding:0.75rem;text-align:center",children:[s("div",{style:"font-size:1.25rem;font-weight:700;color:var(--success)",children:h.created.contacts}),s("div",{style:"font-size:0.75rem;color:var(--text-muted)",children:"Kontakte erstellt"})]})]}),(h.skipped.companies>0||h.skipped.contacts>0)&&s("p",{style:"font-size:0.8rem;color:var(--text-muted);margin-bottom:0.5rem",children:[[h.skipped.companies>0&&`${h.skipped.companies} Firma(en)`,h.skipped.contacts>0&&`${h.skipped.contacts} Kontakt(e)`].filter(Boolean).join(" und ")," bereits vorhanden (uebersprungen)"]}),h.errors.length>0&&s("div",{style:"margin-top:0.75rem",children:[s("p",{style:"font-size:0.8rem;color:var(--error);font-weight:600;margin-bottom:0.25rem",children:"Fehler:"}),h.errors.map((S,x)=>s("p",{style:"font-size:0.8rem;color:var(--error)",children:S},x))]})]})]})}const w2=Object.entries(ko).map(([t,e])=>({value:t,label:e}));function x2(){const[t,e]=me(""),[n,r]=me(null),[i,a]=me(!1),[o,l]=me(new Set),[c,d]=me(!1),{contacts:h,loading:g,refetch:b}=sc({search:t,source:n}),p=Qn(),y=(C,P)=>{P.stopPropagation(),l(L=>{const U=new Set(L);return U.has(C)?U.delete(C):U.add(C),U})},w=()=>{o.size===h.length?l(new Set):l(new Set(h.map(C=>C.id)))},S=async()=>{if(o.size===0)return;const C=o.size;if(!confirm(`${C} Kontakt(e) wirklich loeschen?`))return;d(!0);const P=[...o],L=new Date().toISOString(),{error:U}=await Le.from("contacts").update({deleted_at:L}).in("id",P);U?p.error("Fehler beim Loeschen"):(p.success(`${C} Kontakt(e) geloescht`),l(new Set),b()),d(!1)};function x(){if(h.length===0)return;const C=";",P=["Vorname","Nachname","E-Mail","Telefon","Position","Firma","Quelle","Erstellt"],L=h.map(D=>{var I;return[D.first_name||"",D.last_name||"",D.email||"",D.phone||"",D.position||"",((I=D.company)==null?void 0:I.name)||"",ko[D.source]||D.source||"",D.created_at?D.created_at.slice(0,10):""].map(k=>`"${String(k).replace(/"/g,'""')}"`).join(C)}),U="\uFEFF"+[P.join(C),...L].join(`\r
`),ee=new Blob([U],{type:"text/csv;charset=utf-8;"}),V=URL.createObjectURL(ee),X=document.createElement("a");X.href=V,X.download=`kontakte-${new Date().toISOString().slice(0,10)}.csv`,X.click(),URL.revokeObjectURL(V)}return s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Kontakte"}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap;justify-content:flex-end",children:[o.size>0&&s("button",{class:"btn btn-danger btn-sm",onClick:S,disabled:c,children:c?"Loesche...":`${o.size} loeschen`}),s("button",{class:"btn btn-secondary btn-sm hide-mobile-sm",onClick:x,disabled:h.length===0,children:"CSV Export"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>a(!0),children:"Import"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze("/crm/contacts/new"),children:"+ Neu"})]})]}),s("div",{class:"page-body",children:[s("div",{class:"search-bar",children:s(vm,{value:t,onInput:e,placeholder:"Name oder E-Mail suchen..."})}),s("div",{style:"margin-bottom: 1rem",children:s(Sd,{filters:w2,active:n,onSelect:r})}),g?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):h.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Kontakte gefunden"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{style:"width:40px",children:s("input",{type:"checkbox",checked:o.size===h.length&&h.length>0,onChange:w,style:"width:16px;height:16px;cursor:pointer"})}),s("th",{children:"Name"}),s("th",{children:"E-Mail"}),s("th",{children:"Firma"}),s("th",{children:"Quelle"}),s("th",{children:"Erstellt"})]})}),s("tbody",{children:h.map(C=>{var P,L;return s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/contacts/${C.id}`),children:[s("td",{"data-label":"",onClick:U=>U.stopPropagation(),style:"width:40px",children:s("input",{type:"checkbox",checked:o.has(C.id),onChange:U=>y(C.id,U),style:"width:16px;height:16px;cursor:pointer"})}),s("td",{"data-label":"Name",style:"font-weight:500",children:C.first_name||C.last_name?`${C.first_name||""} ${C.last_name||""}`.trim():""}),s("td",{"data-label":"E-Mail",children:(P=C.email)!=null&&P.endsWith("@platzhalter.de")?s("span",{style:"color:var(--text-dim);font-style:italic",children:C.email}):C.email}),s("td",{"data-label":"Firma",children:((L=C.company)==null?void 0:L.name)||""}),s("td",{"data-label":"Quelle",children:s("span",{class:"filter-pill",style:"cursor:default;font-size:0.7rem;padding:0.15rem 0.5rem",children:ko[C.source]||C.source})}),s("td",{"data-label":"Erstellt",style:"color:var(--text-dim)",children:jn(C.created_at)})]},C.id)})})]})})})]}),i&&s(_2,{onClose:()=>a(!1),onSuccess:()=>{p.success("Import abgeschlossen"),b()}})]})}function S2({id:t}){var k;const{contact:e,loading:n,update:r,softDelete:i}=m2(t),{companies:a}=oc(),{deals:o}=wd({contactId:t}),{activities:l,refetch:c}=vd({contactId:t}),d=Qn(),[h,g]=me(!1),[b,p]=me({}),[y,w]=me("keep"),[S,x]=me(""),[C,P]=me(!1),[L,U]=me({type:"note",description:"",due_date:""});if(n)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Kontakt"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Nicht gefunden"})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Kontakt nicht gefunden"})})})]});function ee(){p({first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",phone:e.phone||"",position:e.position||"",company_id:e.company_id||""}),w("keep"),x(""),g(!0)}async function V(){try{const A={...b};if(y==="new"&&S.trim()){const{data:B,error:J}=await lc({name:S.trim()});if(J)throw J;A.company_id=B.id}else y==="remove"&&(A.company_id=null);const{error:M}=await r(A);if(M)throw M;d.success("Kontakt aktualisiert"),g(!1)}catch(A){d.error(A.message||"Fehler beim Speichern")}}async function X(){const A=o.length,M=A>0?`Dieser Kontakt hat ${A} verknuepfte(n) Deal(s). Kontakt wirklich loeschen?`:"Kontakt wirklich loeschen?";if(!confirm(M))return;const{error:B}=await i();B?d.error("Fehler beim Loeschen"):(d.success("Kontakt geloescht"),ze("/crm/contacts"))}async function D(A){A.preventDefault();const{error:M}=await gm({contact_id:t,type:L.type,description:L.description,due_date:L.type==="task"&&L.due_date?L.due_date:null});M?d.error("Fehler beim Erstellen"):(d.success("Aktivitaet hinzugefuegt"),P(!1),U({type:"note",description:"",due_date:""}),c())}const I=`${e.first_name||""} ${e.last_name||""}`.trim()||e.email;return s(At,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/contacts"),children:""}),s("h1",{class:"page-title",children:I})]}),s("div",{style:"display:flex;gap:0.5rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>P(!0),children:"+ Aktivitaet"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze(`/crm/deals/new?contact_id=${t}`),children:"+ Deal"}),!h&&s("button",{class:"btn btn-secondary btn-sm",onClick:ee,children:"Bearbeiten"}),s("button",{class:"btn btn-danger btn-sm",onClick:X,children:"Loeschen"})]})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Stammdaten"})}),h?s("div",{children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Vorname"}),s("input",{value:b.first_name,onInput:A=>p({...b,first_name:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Nachname"}),s("input",{value:b.last_name,onInput:A=>p({...b,last_name:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"E-Mail"}),s("input",{type:"email",value:b.email,onInput:A=>p({...b,email:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Telefon"}),s("input",{value:b.phone,onInput:A=>p({...b,phone:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Position"}),s("input",{value:b.position,onInput:A=>p({...b,position:A.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Firma"}),s("div",{style:"display:flex;gap:0.25rem;margin-bottom:0.5rem",children:[s("button",{type:"button",class:`filter-pill ${y==="keep"?"active":""}`,onClick:()=>w("keep"),children:e.company?"Beibehalten":"Keine"}),s("button",{type:"button",class:`filter-pill ${y==="change"?"active":""}`,onClick:()=>w("change"),children:"Andere waehlen"}),s("button",{type:"button",class:`filter-pill ${y==="new"?"active":""}`,onClick:()=>w("new"),children:"Neue"}),e.company&&s("button",{type:"button",class:`filter-pill ${y==="remove"?"active":""}`,onClick:()=>w("remove"),children:"Entfernen"})]}),y==="keep"&&e.company&&s("div",{style:"font-size:0.85rem;color:var(--text-dim)",children:e.company.name}),y==="change"&&s("select",{value:b.company_id,onChange:A=>p({...b,company_id:A.target.value}),children:[s("option",{value:"",children:" Firma waehlen "}),a.map(A=>s("option",{value:A.id,children:A.name},A.id))]}),y==="new"&&s("input",{value:S,onInput:A=>x(A.target.value),placeholder:"Neuer Firmenname"}),y==="remove"&&s("div",{style:"font-size:0.85rem;color:var(--text-dim)",children:"Firma-Verknuepfung wird entfernt"})]})]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>g(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary btn-sm",onClick:V,children:"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Vorname"}),s("span",{class:"detail-value",children:e.first_name||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Nachname"}),s("span",{class:"detail-value",children:e.last_name||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"E-Mail"}),s("span",{class:"detail-value",children:(k=e.email)!=null&&k.endsWith("@platzhalter.de")?s("span",{style:"color:var(--text-dim);font-style:italic",title:"Platzhalter  bitte echte E-Mail eintragen",children:e.email}):s("a",{href:`mailto:${e.email}`,children:e.email})})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Telefon"}),s("span",{class:"detail-value",children:e.phone?s("a",{href:`tel:${e.phone}`,children:e.phone}):""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Position"}),s("span",{class:"detail-value",children:e.position||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Firma"}),s("span",{class:"detail-value",children:e.company?s("a",{href:"#",onClick:A=>{A.preventDefault(),ze(`/crm/companies/${e.company.id}`)},children:e.company.name}):""})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Deals (",o.length,")"]})}),o.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Deals"}):s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Titel"}),s("th",{children:"Stage"}),s("th",{children:"Wert"})]})}),s("tbody",{children:o.map(A=>s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/deals/${A.id}`),children:[s("td",{children:A.title}),s("td",{children:s(ac,{stage:A.stage})}),s("td",{children:A.value?je(A.value):""})]},A.id))})]})})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Aktivitaeten"})}),l.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Aktivitaeten"}):s("div",{class:"timeline",children:l.map(A=>s(_d,{activity:A},A.id))})]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Quelle"}),s("span",{class:"detail-value",children:ko[e.source]||e.source})]}),e.source_detail&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Detail"}),s("span",{class:"detail-value",children:e.source_detail})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"DSGVO-Einwilligung"}),s("span",{class:"detail-value",children:e.gdpr_consent?"Ja":"Nein"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:jn(e.created_at)})]})]})})]})}),C&&s(Ma,{title:"Aktivitaet hinzufuegen",onClose:()=>P(!1),children:s("form",{onSubmit:D,children:[s("div",{class:"form-group",children:[s("label",{children:"Typ"}),s("select",{value:L.type,onChange:A=>U({...L,type:A.target.value}),children:Object.entries(bd).filter(([A])=>!["form_submission","stage_change","created"].includes(A)).map(([A,M])=>s("option",{value:A,children:[M.icon," ",M.label]},A))})]}),s("div",{class:"form-group",children:[s("label",{children:"Beschreibung"}),s("textarea",{value:L.description,onInput:A=>U({...L,description:A.target.value}),required:!0})]}),L.type==="task"&&s("div",{class:"form-group",children:[s("label",{children:"Faellig am"}),s("input",{type:"date",value:L.due_date,onInput:A=>U({...L,due_date:A.target.value})})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>P(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",children:"Speichern"})]})]})})]})}function A2(){const t=Qn(),{companies:e}=oc(),[n,r]=me(!1),[i,a]=me("none"),[o,l]=me({first_name:"",last_name:"",email:"",phone:"",position:"",source:"manual",source_detail:"",company_id:"",new_company_name:"",gdpr_consent:!1});function c(h,g){l(b=>({...b,[h]:g}))}async function d(h){h.preventDefault(),r(!0);try{let g=null;if(i==="existing"&&o.company_id)g=o.company_id;else if(i==="new"&&o.new_company_name.trim()){const{data:y,error:w}=await lc({name:o.new_company_name.trim()});if(w)throw w;g=y.id}const{data:b,error:p}=await xd({first_name:o.first_name,last_name:o.last_name,email:o.email,phone:o.phone||null,position:o.position||null,source:o.source,source_detail:o.source_detail||null,company_id:g,gdpr_consent:o.gdpr_consent,gdpr_consent_at:o.gdpr_consent?new Date().toISOString():null});if(p)throw p;t.success("Kontakt erstellt"),ze(`/crm/contacts/${b.id}`)}catch(g){t.error(g.message||"Fehler beim Erstellen")}r(!1)}return s(At,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/contacts"),children:""}),s("h1",{class:"page-title",children:"Neuer Kontakt"})]})}),s("div",{class:"page-body",children:s("div",{class:"card",style:"max-width: 640px",children:s("form",{onSubmit:d,children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Vorname"}),s("input",{value:o.first_name,onInput:h=>c("first_name",h.target.value)})]}),s("div",{class:"form-group",children:[s("label",{children:"Nachname"}),s("input",{value:o.last_name,onInput:h=>c("last_name",h.target.value)})]}),s("div",{class:"form-group",children:[s("label",{children:"E-Mail *"}),s("input",{type:"email",required:!0,value:o.email,onInput:h=>c("email",h.target.value)})]}),s("div",{class:"form-group",children:[s("label",{children:"Telefon"}),s("input",{type:"tel",value:o.phone,onInput:h=>c("phone",h.target.value)})]}),s("div",{class:"form-group",children:[s("label",{children:"Position"}),s("input",{value:o.position,onInput:h=>c("position",h.target.value),placeholder:"z.B. Geschaeftsfuehrer"})]}),s("div",{class:"form-group",children:[s("label",{children:"Firma"}),s("div",{style:"display:flex;gap:0.25rem;margin-bottom:0.5rem",children:[s("button",{type:"button",class:`filter-pill ${i==="none"?"active":""}`,onClick:()=>a("none"),children:"Keine"}),s("button",{type:"button",class:`filter-pill ${i==="existing"?"active":""}`,onClick:()=>a("existing"),children:"Bestehende"}),s("button",{type:"button",class:`filter-pill ${i==="new"?"active":""}`,onClick:()=>a("new"),children:"Neue"})]}),i==="existing"&&s("select",{value:o.company_id,onChange:h=>c("company_id",h.target.value),children:[s("option",{value:"",children:" Firma waehlen "}),e.map(h=>s("option",{value:h.id,children:h.name},h.id))]}),i==="new"&&s("input",{value:o.new_company_name,onInput:h=>c("new_company_name",h.target.value),placeholder:"Neuer Firmenname"})]}),s("div",{class:"form-group",children:[s("label",{children:"Quelle"}),s("select",{value:o.source,onChange:h=>c("source",h.target.value),children:Object.entries(ko).map(([h,g])=>s("option",{value:h,children:g},h))})]}),s("div",{class:"form-group",children:[s("label",{children:"Quelle (Detail)"}),s("input",{value:o.source_detail,onInput:h=>c("source_detail",h.target.value),placeholder:"z.B. Blog: Hotels"})]}),s("div",{class:"form-group form-group-full",children:s("label",{style:"display:flex;align-items:center;gap:0.5rem;text-transform:none;font-size:0.85rem;cursor:pointer",children:[s("input",{type:"checkbox",checked:o.gdpr_consent,onChange:h=>c("gdpr_consent",h.target.checked),style:"width:auto"}),"DSGVO-Einwilligung erteilt"]})})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>ze("/crm/contacts"),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",disabled:n,children:n?"Erstelle...":"Kontakt erstellen"})]})]})})})]})}const k2=yd.map(t=>({value:t,label:t}));function N2(){const[t,e]=me(""),[n,r]=me(null),{companies:i,loading:a,refetch:o}=oc({search:t,industry:n}),[l,c]=me(!1),[d,h]=me({name:"",industry:"",city:"",website:""}),[g,b]=me(new Set),[p,y]=me(!1),w=Qn(),S=(L,U)=>{U.stopPropagation(),b(ee=>{const V=new Set(ee);return V.has(L)?V.delete(L):V.add(L),V})},x=()=>{g.size===i.length?b(new Set):b(new Set(i.map(L=>L.id)))},C=async()=>{if(g.size===0)return;const L=g.size,U=[...g],{data:ee}=await Le.from("contacts").select("id").in("company_id",U).is("deleted_at",null),V=(ee||[]).length,X=V>0?`${L} Firma(en) loeschen? ${V} verknuepfte(r) Kontakt(e) verlieren die Firmenzuordnung.`:`${L} Firma(en) wirklich loeschen?`;if(!confirm(X))return;y(!0);const D=new Date().toISOString(),{error:I}=await Le.from("companies").update({deleted_at:D}).in("id",U);I?w.error("Fehler beim Loeschen"):(w.success(`${L} Firma(en) geloescht`),b(new Set),o()),y(!1)};async function P(L){L.preventDefault();const{data:U,error:ee}=await lc({name:d.name,industry:d.industry||null,city:d.city||null,website:d.website||null});ee?w.error("Fehler beim Erstellen"):(w.success("Firma erstellt"),c(!1),h({name:"",industry:"",city:"",website:""}),o())}return s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Firmen"}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap;justify-content:flex-end",children:[g.size>0&&s("button",{class:"btn btn-danger btn-sm",onClick:C,disabled:p,children:p?"Loesche...":`${g.size} loeschen`}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>c(!0),children:"+ Neue Firma"})]})]}),s("div",{class:"page-body",children:[s("div",{class:"search-bar",children:s(vm,{value:t,onInput:e,placeholder:"Firma oder Stadt suchen..."})}),s("div",{style:"margin-bottom: 1rem",children:s(Sd,{filters:k2,active:n,onSelect:r})}),a?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):i.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Firmen gefunden"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{style:"width:40px",children:s("input",{type:"checkbox",checked:g.size===i.length&&i.length>0,onChange:x,style:"width:16px;height:16px;cursor:pointer"})}),s("th",{children:"Name"}),s("th",{children:"Branche"}),s("th",{children:"Stadt"}),s("th",{children:"Website"}),s("th",{children:"Erstellt"})]})}),s("tbody",{children:i.map(L=>s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/companies/${L.id}`),children:[s("td",{"data-label":"",onClick:U=>U.stopPropagation(),style:"width:40px",children:s("input",{type:"checkbox",checked:g.has(L.id),onChange:U=>S(L.id,U),style:"width:16px;height:16px;cursor:pointer"})}),s("td",{"data-label":"Name",style:"font-weight:500",children:L.name}),s("td",{"data-label":"Branche",children:L.industry||""}),s("td",{"data-label":"Stadt",children:L.city||""}),s("td",{"data-label":"Website",children:L.website?s("a",{href:L.website,target:"_blank",rel:"noopener",onClick:U=>U.stopPropagation(),children:L.website}):""}),s("td",{"data-label":"Erstellt",style:"color:var(--text-dim)",children:jn(L.created_at)})]},L.id))})]})})})]}),l&&s(Ma,{title:"Neue Firma",onClose:()=>c(!1),children:s("form",{onSubmit:P,children:[s("div",{class:"form-group",children:[s("label",{children:"Firmenname *"}),s("input",{required:!0,value:d.name,onInput:L=>h({...d,name:L.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Branche"}),s("select",{value:d.industry,onChange:L=>h({...d,industry:L.target.value}),children:[s("option",{value:"",children:" Auswaehlen "}),yd.map(L=>s("option",{value:L,children:L},L))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Stadt"}),s("input",{value:d.city,onInput:L=>h({...d,city:L.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Website"}),s("input",{value:d.website,onInput:L=>h({...d,website:L.target.value}),placeholder:"https://"})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>c(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",children:"Erstellen"})]})]})})]})}function E2({id:t}){const{company:e,loading:n,update:r,softDelete:i}=g2(t),{contacts:a,refetch:o}=sc(),{deals:l}=wd({companyId:t}),{invoices:c}=gd({companyId:t});vd({companyId:t});const d=Qn(),[h,g]=me(!1),[b,p]=me({}),[y,w]=me(!1),[S,x]=me(!1),[C,P]=me(""),[L,U]=me({first_name:"",last_name:"",email:"",phone:"",source:"manual"}),ee=a.filter(A=>A.company_id===t);if(n)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Firma"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Nicht gefunden"})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Firma nicht gefunden"})})})]});function V(){p({name:e.name||"",industry:e.industry||"",website:e.website||"",address:e.address||"",city:e.city||"",notes:e.notes||""}),g(!0)}async function X(A){A.preventDefault();const{error:M}=await xd({first_name:L.first_name||null,last_name:L.last_name||null,email:L.email||null,phone:L.phone||null,source:L.source||"manual",company_id:t});M?d.error("Fehler beim Erstellen"):(d.success("Kontakt erstellt"),w(!1),U({first_name:"",last_name:"",email:"",phone:"",source:"manual"}),o())}async function D(){if(!C)return;const{error:A}=await Le.from("contacts").update({company_id:t}).eq("id",C);A?d.error("Fehler beim Verknuepfen"):(d.success("Kontakt verknuepft"),x(!1),P(""),o())}async function I(){const{error:A}=await r(b);A?d.error("Fehler beim Speichern"):(d.success("Firma aktualisiert"),g(!1))}async function k(){const A=ee.length,M=A>0?`Firma "${e.name}" hat ${A} verknuepfte(n) Kontakt(e). Wirklich loeschen?`:`Firma "${e.name}" wirklich loeschen?`;if(!confirm(M))return;const{error:B}=await i();B?d.error("Fehler beim Loeschen"):(d.success("Firma geloescht"),ze("/crm/companies"))}return s(At,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/companies"),children:""}),s("h1",{class:"page-title",children:e.name})]}),s("div",{style:"display:flex;gap:0.5rem",children:[!h&&s("button",{class:"btn btn-secondary btn-sm",onClick:V,children:"Bearbeiten"}),s("button",{class:"btn btn-danger btn-sm",onClick:k,children:"Loeschen"})]})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Firmendaten"})}),h?s("div",{children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Name"}),s("input",{value:b.name,onInput:A=>p({...b,name:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Branche"}),s("select",{value:b.industry,onChange:A=>p({...b,industry:A.target.value}),children:[s("option",{value:"",children:""}),yd.map(A=>s("option",{value:A,children:A},A))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Website"}),s("input",{value:b.website,onInput:A=>p({...b,website:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Stadt"}),s("input",{value:b.city,onInput:A=>p({...b,city:A.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Adresse"}),s("input",{value:b.address,onInput:A=>p({...b,address:A.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Notizen"}),s("textarea",{value:b.notes,onInput:A=>p({...b,notes:A.target.value})})]})]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>g(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary btn-sm",onClick:I,children:"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Name"}),s("span",{class:"detail-value",children:e.name})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Branche"}),s("span",{class:"detail-value",children:e.industry||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Website"}),s("span",{class:"detail-value",children:e.website?s("a",{href:e.website,target:"_blank",rel:"noopener",children:e.website}):""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Stadt"}),s("span",{class:"detail-value",children:e.city||""})]}),s("div",{class:"detail-field form-group-full",children:[s("span",{class:"detail-label",children:"Adresse"}),s("span",{class:"detail-value",children:e.address||""})]}),e.notes&&s("div",{class:"detail-field form-group-full",children:[s("span",{class:"detail-label",children:"Notizen"}),s("span",{class:"detail-value",children:e.notes})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:["Kontakte (",ee.length,")"]}),!y&&!S&&s("div",{style:"display:flex;gap:0.25rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>x(!0),children:"Verknuepfen"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>w(!0),children:"+ Neu"})]})]}),S&&s("div",{style:"margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid var(--border)",children:[s("div",{class:"form-grid",children:s("div",{class:"form-group form-group-full",children:[s("label",{children:"Bestehenden Kontakt waehlen"}),s("select",{value:C,onChange:A=>P(A.target.value),children:[s("option",{value:"",children:" Kontakt waehlen "}),a.filter(A=>A.company_id!==t).map(A=>s("option",{value:A.id,children:[`${A.first_name||""} ${A.last_name||""}`.trim()||A.email,A.company?` (${A.company.name})`:""]},A.id))]})]})}),s("div",{class:"form-actions",style:"margin-top:0.5rem;border-top:none;padding-top:0",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:()=>{x(!1),P("")},children:"Abbrechen"}),s("button",{type:"button",class:"btn btn-primary btn-sm",onClick:D,disabled:!C,children:"Verknuepfen"})]})]}),y&&s("form",{onSubmit:X,style:"margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid var(--border)",children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Vorname"}),s("input",{value:L.first_name,onInput:A=>U({...L,first_name:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Nachname"}),s("input",{value:L.last_name,onInput:A=>U({...L,last_name:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"E-Mail"}),s("input",{type:"email",value:L.email,onInput:A=>U({...L,email:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Telefon"}),s("input",{value:L.phone,onInput:A=>U({...L,phone:A.target.value})})]})]}),s("div",{class:"form-actions",style:"margin-top:0.5rem;border-top:none;padding-top:0",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:()=>w(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary btn-sm",children:"Erstellen"})]})]}),ee.length===0&&!y?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Kontakte"}):ee.length>0&&s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Name"}),s("th",{children:"E-Mail"}),s("th",{children:"Position"})]})}),s("tbody",{children:ee.map(A=>s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/contacts/${A.id}`),children:[s("td",{children:`${A.first_name||""} ${A.last_name||""}`.trim()||""}),s("td",{children:A.email}),s("td",{children:A.position||""})]},A.id))})]})})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Deals (",l.length,")"]})}),l.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Deals"}):s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Titel"}),s("th",{children:"Stage"}),s("th",{children:"Wert"})]})}),s("tbody",{children:l.map(A=>s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/deals/${A.id}`),children:[s("td",{children:A.title}),s("td",{children:s(ac,{stage:A.stage})}),s("td",{children:A.value?je(A.value):""})]},A.id))})]})})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Rechnungen / Angebote (",c.length,")"]})}),c.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Rechnungen"}):s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Nummer"}),s("th",{children:"Typ"}),s("th",{children:"Status"}),s("th",{style:"text-align:right",children:"Betrag"})]})}),s("tbody",{children:c.map(A=>{var M,B,J,oe;return s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/invoices/${A.id}`),children:[s("td",{style:"font-weight:600",children:A.invoice_number}),s("td",{children:(M=As[A.type])==null?void 0:M.label}),s("td",{children:s("span",{class:"stage-badge",style:`color:${(B=Zn[A.status])==null?void 0:B.color};background:${(J=Zn[A.status])==null?void 0:J.color}20`,children:(oe=Zn[A.status])==null?void 0:oe.label})}),s("td",{style:"text-align:right",children:je(A.total_amount)})]},A.id)})})]})})]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:jn(e.created_at)})]})})})]})})]})}function L2({id:t}){const{deal:e,loading:n,update:r,changeStage:i}=u2(t),{activities:a,refetch:o}=vd({dealId:t}),{invoices:l}=gd({dealId:t}),c=Qn(),[d,h]=me(!1),[g,b]=me({}),[p,y]=me(!1),[w,S]=me({type:"note",description:"",due_date:""});if(n)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Deal"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Nicht gefunden"})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Deal nicht gefunden"})})})]});function x(){b({title:e.title||"",value:e.value||"",service_type:e.service_type||"",expected_close:e.expected_close||"",lost_reason:e.lost_reason||""}),h(!0)}async function C(){const{error:U}=await r({...g,value:g.value?parseFloat(g.value):null,service_type:g.service_type||null,expected_close:g.expected_close||null,lost_reason:g.lost_reason||null});U?c.error("Fehler beim Speichern"):(c.success("Deal aktualisiert"),h(!1))}async function P(U){const{error:ee}=await i(U);ee?c.error("Fehler beim Aendern"):(c.success(`Stage auf "${Mi[U].label}" geaendert`),o())}async function L(U){U.preventDefault();const{error:ee}=await gm({deal_id:t,contact_id:e.contact_id||null,type:w.type,description:w.description,due_date:w.type==="task"&&w.due_date?w.due_date:null});ee?c.error("Fehler beim Erstellen"):(c.success("Aktivitaet hinzugefuegt"),y(!1),S({type:"note",description:"",due_date:""}),o())}return s(At,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/pipeline"),children:""}),s("h1",{class:"page-title",children:e.title}),s(ac,{stage:e.stage})]}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>y(!0),children:"+ Aktivitaet"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze(`/crm/invoices/new?type=quote&deal_id=${t}`),children:"+ Angebot"}),e.stage==="won"&&s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze(`/crm/invoices/new?type=invoice&deal_id=${t}`),children:"+ Rechnung"}),!d&&s("button",{class:"btn btn-secondary btn-sm",onClick:x,children:"Bearbeiten"})]})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Deal-Infos"})}),d?s("div",{children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group form-group-full",children:[s("label",{children:"Titel"}),s("input",{value:g.title,onInput:U=>b({...g,title:U.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Wert (EUR)"}),s("input",{type:"number",step:"0.01",value:g.value,onInput:U=>b({...g,value:U.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Service-Typ"}),s("select",{value:g.service_type,onChange:U=>b({...g,service_type:U.target.value}),children:[s("option",{value:"",children:""}),Object.entries(Gu).map(([U,ee])=>s("option",{value:U,children:ee},U))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Erwarteter Abschluss"}),s("input",{type:"date",value:g.expected_close,onInput:U=>b({...g,expected_close:U.target.value})})]}),e.stage==="lost"&&s("div",{class:"form-group",children:[s("label",{children:"Verlustgrund"}),s("input",{value:g.lost_reason,onInput:U=>b({...g,lost_reason:U.target.value})})]})]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>h(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary btn-sm",onClick:C,children:"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Titel"}),s("span",{class:"detail-value",children:e.title})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Wert"}),s("span",{class:"detail-value",children:e.value?je(e.value):""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Service"}),s("span",{class:"detail-value",children:e.service_type?Gu[e.service_type]:""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erwarteter Abschluss"}),s("span",{class:"detail-value",children:jn(e.expected_close)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Kontakt"}),s("span",{class:"detail-value",children:e.contact?s("a",{href:"#",onClick:U=>{U.preventDefault(),ze(`/crm/contacts/${e.contact.id}`)},children:`${e.contact.first_name||""} ${e.contact.last_name||""}`.trim()||e.contact.email}):""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Firma"}),s("span",{class:"detail-value",children:e.company?s("a",{href:"#",onClick:U=>{U.preventDefault(),ze(`/crm/companies/${e.company.id}`)},children:e.company.name}):""})]}),e.lost_reason&&s("div",{class:"detail-field form-group-full",children:[s("span",{class:"detail-label",children:"Verlustgrund"}),s("span",{class:"detail-value",children:e.lost_reason})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Stage aendern"})}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap",children:Object.entries(Mi).map(([U,ee])=>s("button",{class:`btn btn-sm ${e.stage===U?"btn-primary":"btn-secondary"}`,onClick:()=>e.stage!==U&&P(U),disabled:e.stage===U,style:e.stage===U?`background:${ee.color}`:"",children:ee.label},U))})]}),l.length>0&&s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Rechnungen / Angebote (",l.length,")"]})}),s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Nummer"}),s("th",{children:"Typ"}),s("th",{children:"Status"}),s("th",{style:"text-align:right",children:"Betrag"})]})}),s("tbody",{children:l.map(U=>{var ee,V,X,D;return s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/invoices/${U.id}`),children:[s("td",{style:"font-weight:600",children:U.invoice_number}),s("td",{children:(ee=As[U.type])==null?void 0:ee.label}),s("td",{children:s("span",{class:"stage-badge",style:`color:${(V=Zn[U.status])==null?void 0:V.color};background:${(X=Zn[U.status])==null?void 0:X.color}20`,children:(D=Zn[U.status])==null?void 0:D.label})}),s("td",{style:"text-align:right",children:je(U.total_amount)})]},U.id)})})]})})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Aktivitaeten"})}),a.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Aktivitaeten"}):s("div",{class:"timeline",children:a.map(U=>s(_d,{activity:U},U.id))})]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Stage geaendert am"}),s("span",{class:"detail-value",children:jn(e.stage_changed_at)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:jn(e.created_at)})]})]})})]})}),p&&s(Ma,{title:"Aktivitaet hinzufuegen",onClose:()=>y(!1),children:s("form",{onSubmit:L,children:[s("div",{class:"form-group",children:[s("label",{children:"Typ"}),s("select",{value:w.type,onChange:U=>S({...w,type:U.target.value}),children:Object.entries(bd).filter(([U])=>!["form_submission","stage_change","created"].includes(U)).map(([U,ee])=>s("option",{value:U,children:[ee.icon," ",ee.label]},U))})]}),s("div",{class:"form-group",children:[s("label",{children:"Beschreibung"}),s("textarea",{value:w.description,onInput:U=>S({...w,description:U.target.value}),required:!0})]}),w.type==="task"&&s("div",{class:"form-group",children:[s("label",{children:"Faellig am"}),s("input",{type:"date",value:w.due_date,onInput:U=>S({...w,due_date:U.target.value})})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>y(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",children:"Speichern"})]})]})})]})}function C2(){const t=Qn(),{contacts:e}=sc(),[n,r]=me(!1),a=new URLSearchParams(typeof window<"u"?window.location.search:"").get("contact_id")||"",[o,l]=me({title:"",contact_id:a,service_type:"",value:"",expected_close:""});function c(h,g){l(b=>({...b,[h]:g}))}async function d(h){h.preventDefault(),r(!0);try{let g=null;if(o.contact_id){const y=e.find(w=>w.id===o.contact_id);g=(y==null?void 0:y.company_id)||null}const{data:b,error:p}=await d2({title:o.title,contact_id:o.contact_id||null,company_id:g,service_type:o.service_type||null,value:o.value?parseFloat(o.value):null,expected_close:o.expected_close||null});if(p)throw p;t.success("Deal erstellt"),ze(`/crm/deals/${b.id}`)}catch(g){t.error(g.message||"Fehler beim Erstellen")}r(!1)}return s(At,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/pipeline"),children:""}),s("h1",{class:"page-title",children:"Neuer Deal"})]})}),s("div",{class:"page-body",children:s("div",{class:"card",style:"max-width: 640px",children:s("form",{onSubmit:d,children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group form-group-full",children:[s("label",{children:"Titel *"}),s("input",{required:!0,value:o.title,onInput:h=>c("title",h.target.value),placeholder:"z.B. 360-Tour Restaurant Bellini"})]}),s("div",{class:"form-group",children:[s("label",{children:"Kontakt"}),s("select",{value:o.contact_id,onChange:h=>c("contact_id",h.target.value),children:[s("option",{value:"",children:" Auswaehlen "}),e.map(h=>s("option",{value:h.id,children:`${h.first_name||""} ${h.last_name||""}`.trim()||h.email},h.id))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Service-Typ"}),s("select",{value:o.service_type,onChange:h=>c("service_type",h.target.value),children:[s("option",{value:"",children:" Auswaehlen "}),Object.entries(Gu).map(([h,g])=>s("option",{value:h,children:g},h))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Wert (EUR)"}),s("input",{type:"number",step:"0.01",min:"0",value:o.value,onInput:h=>c("value",h.target.value),placeholder:"z.B. 1200"})]}),s("div",{class:"form-group",children:[s("label",{children:"Erwarteter Abschluss"}),s("input",{type:"date",value:o.expected_close,onInput:h=>c("expected_close",h.target.value)})]})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>ze("/crm/pipeline"),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",disabled:n,children:n?"Erstelle...":"Deal erstellen"})]})]})})})]})}function T2(){const{user:t}=rc(),e=Qn(),{settings:n,save:r,loading:i}=ic(),[a,o]=me({password:"",confirm:""}),[l,c]=me(!1),[d,h]=me({}),[g,b]=me(!1),[p,y]=me(!1),[w,S]=me(!1),[x,C]=me(!1),[P,L]=me({default_invoice_intro:"",default_quote_intro:"",payment_reference_note:""});Mt(()=>{n&&(h({company_name:n.company_name||"",owner_name:n.owner_name||"",address_line1:n.address_line1||"",address_zip:n.address_zip||"",address_city:n.address_city||"",phone:n.phone||"",email:n.email||"",website:n.website||"",tax_id:n.tax_id||"",vat_id:n.vat_id||"",bank_name:n.bank_name||"",bank_iban:n.bank_iban||"",bank_bic:n.bank_bic||"",default_payment_days:n.default_payment_days||14,vat_rate:n.vat_rate||19,default_closing_text:n.default_closing_text||""}),L({default_invoice_intro:n.default_invoice_intro||"Vielen Dank fuer Ihren Auftrag. Ich berechne Ihnen fuer folgende Leistungen:",default_quote_intro:n.default_quote_intro||"Vielen Dank fuer Ihr Interesse. Gerne unterbreite ich Ihnen folgendes Angebot:",payment_reference_note:n.payment_reference_note||"Bitte verwenden Sie die Rechnungsnummer als Verwendungszweck."}))},[n]);async function U(I){I.preventDefault(),y(!0);const{error:k}=await r({...d,default_payment_days:parseInt(d.default_payment_days)||14,vat_rate:parseFloat(d.vat_rate)||19});k?e.error("Fehler: "+k.message):(e.success("Geschaeftsdaten gespeichert"),b(!1)),y(!1)}async function ee(I){I.preventDefault(),C(!0);const{error:k}=await r(P);k?e.error("Fehler: "+k.message):(e.success("Rechnungsvorlage gespeichert"),S(!1)),C(!1)}async function V(I){if(I.preventDefault(),a.password!==a.confirm){e.error("Passwoerter stimmen nicht ueberein");return}if(a.password.length<8){e.error("Passwort muss mindestens 8 Zeichen lang sein");return}c(!0);const{error:k}=await Le.auth.updateUser({password:a.password});k?e.error("Fehler: "+k.message):(e.success("Passwort geaendert"),o({password:"",confirm:""})),c(!1)}async function X(){const{data:I,error:k}=await Le.from("contacts").select("first_name, last_name, email, phone, source, created_at").is("deleted_at",null).order("created_at",{ascending:!1});if(k){e.error("Export fehlgeschlagen");return}const A=["Vorname,Nachname,E-Mail,Telefon,Quelle,Erstellt",...I.map(oe=>[oe.first_name,oe.last_name,oe.email,oe.phone,oe.source,oe.created_at].map(ue=>`"${(ue||"").toString().replace(/"/g,'""')}"`).join(","))].join(`
`),M=new Blob(["\uFEFF"+A],{type:"text/csv;charset=utf-8"}),B=URL.createObjectURL(M),J=document.createElement("a");J.href=B,J.download=`beck360-kontakte-${new Date().toISOString().slice(0,10)}.csv`,J.click(),URL.revokeObjectURL(B),e.success("Export erstellt")}async function D(){if(!confirm("Alle geloeschten Kontakte endgueltig entfernen? Dies kann nicht rueckgaengig gemacht werden."))return;const{error:I}=await Le.from("contacts").delete().not("deleted_at","is",null);I?e.error("Fehler: "+I.message):e.success("Geloeschte Kontakte endgueltig entfernt")}return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Einstellungen"})}),s("div",{class:"page-body",children:s("div",{style:"display:flex;flex-direction:column;gap:1.5rem;max-width:640px",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Konto"})}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"E-Mail"}),s("span",{class:"detail-value",children:t==null?void 0:t.email})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"User ID"}),s("span",{class:"detail-value",style:"font-size:0.75rem;color:var(--text-dim);word-break:break-all",children:t==null?void 0:t.id})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Geschaeftsdaten"}),!g&&s("button",{class:"btn btn-secondary btn-sm",onClick:()=>b(!0),children:"Bearbeiten"})]}),i?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):g?s("form",{onSubmit:U,children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Firmenname"}),s("input",{value:d.company_name,onInput:I=>h({...d,company_name:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Inhaber"}),s("input",{value:d.owner_name,onInput:I=>h({...d,owner_name:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Adresse"}),s("input",{value:d.address_line1,onInput:I=>h({...d,address_line1:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"PLZ"}),s("input",{value:d.address_zip,onInput:I=>h({...d,address_zip:I.target.value}),style:"max-width:120px"})]}),s("div",{class:"form-group",children:[s("label",{children:"Stadt"}),s("input",{value:d.address_city,onInput:I=>h({...d,address_city:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Telefon"}),s("input",{value:d.phone,onInput:I=>h({...d,phone:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"E-Mail"}),s("input",{type:"email",value:d.email,onInput:I=>h({...d,email:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Website"}),s("input",{value:d.website,onInput:I=>h({...d,website:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Steuernummer"}),s("input",{value:d.tax_id,onInput:I=>h({...d,tax_id:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"USt-IdNr."}),s("input",{value:d.vat_id,onInput:I=>h({...d,vat_id:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Bank"}),s("input",{value:d.bank_name,onInput:I=>h({...d,bank_name:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"IBAN"}),s("input",{value:d.bank_iban,onInput:I=>h({...d,bank_iban:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"BIC"}),s("input",{value:d.bank_bic,onInput:I=>h({...d,bank_bic:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Zahlungsziel (Tage)"}),s("input",{type:"number",value:d.default_payment_days,onInput:I=>h({...d,default_payment_days:I.target.value}),style:"max-width:100px"})]}),s("div",{class:"form-group",children:[s("label",{children:"MwSt-Satz (%)"}),s("input",{type:"number",step:"0.01",value:d.vat_rate,onInput:I=>h({...d,vat_rate:I.target.value}),style:"max-width:100px"})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Standard-Schlusstext"}),s("textarea",{value:d.default_closing_text,onInput:I=>h({...d,default_closing_text:I.target.value})})]})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:()=>b(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary btn-sm",disabled:p,children:p?"Speichern...":"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Firma"}),s("span",{class:"detail-value",children:(n==null?void 0:n.company_name)||"BECK360"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Inhaber"}),s("span",{class:"detail-value",children:(n==null?void 0:n.owner_name)||"Eugen Beck"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Adresse"}),s("span",{class:"detail-value",children:[(n==null?void 0:n.address_line1)||"Eichenweg 1",", ",(n==null?void 0:n.address_zip)||"76275"," ",(n==null?void 0:n.address_city)||"Ettlingen"]})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Telefon"}),s("span",{class:"detail-value",children:(n==null?void 0:n.phone)||"0173-4682501"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"IBAN"}),s("span",{class:"detail-value",children:(n==null?void 0:n.bank_iban)||"DE92 5486 2500 0001 1389 95"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"MwSt."}),s("span",{class:"detail-value",children:[(n==null?void 0:n.vat_rate)||19,"%"]})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Rechnungsvorlage"}),!w&&s("button",{class:"btn btn-secondary btn-sm",onClick:()=>S(!0),children:"Bearbeiten"})]}),i?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):w?s("form",{onSubmit:ee,children:[s("div",{class:"form-group",children:[s("label",{children:"Standard-Einleitung Rechnung"}),s("textarea",{value:P.default_invoice_intro,onInput:I=>L({...P,default_invoice_intro:I.target.value}),rows:2})]}),s("div",{class:"form-group",children:[s("label",{children:"Standard-Einleitung Angebot"}),s("textarea",{value:P.default_quote_intro,onInput:I=>L({...P,default_quote_intro:I.target.value}),rows:2})]}),s("div",{class:"form-group",children:[s("label",{children:"Verwendungszweck-Hinweis"}),s("input",{value:P.payment_reference_note,onInput:I=>L({...P,payment_reference_note:I.target.value})})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:()=>S(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary btn-sm",disabled:x,children:x?"Speichern...":"Speichern"})]})]}):s("div",{style:"display:flex;flex-direction:column;gap:0.75rem",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Einleitung Rechnung"}),s("span",{class:"detail-value",style:"white-space:pre-wrap",children:P.default_invoice_intro})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Einleitung Angebot"}),s("span",{class:"detail-value",style:"white-space:pre-wrap",children:P.default_quote_intro})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Verwendungszweck"}),s("span",{class:"detail-value",children:P.payment_reference_note})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Passwort aendern"})}),s("form",{onSubmit:V,children:[s("div",{class:"form-group",children:[s("label",{children:"Neues Passwort"}),s("input",{type:"password",value:a.password,onInput:I=>o({...a,password:I.target.value}),minLength:8,required:!0,autocomplete:"new-password"})]}),s("div",{class:"form-group",children:[s("label",{children:"Passwort bestaetigen"}),s("input",{type:"password",value:a.confirm,onInput:I=>o({...a,confirm:I.target.value}),minLength:8,required:!0,autocomplete:"new-password"})]}),s("button",{type:"submit",class:"btn btn-primary btn-sm",disabled:l,children:l?"Speichern...":"Passwort aendern"})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"DSGVO-Tools"})}),s("div",{style:"display:flex;flex-direction:column;gap:0.75rem",children:[s("div",{children:[s("div",{style:"font-size:0.85rem;margin-bottom:0.35rem",children:"Kontakte als CSV exportieren"}),s("button",{class:"btn btn-secondary btn-sm",onClick:X,children:"CSV Export"})]}),s("div",{children:[s("div",{style:"font-size:0.85rem;margin-bottom:0.35rem",children:"Geloeschte Kontakte endgueltig entfernen (Recht auf Loeschung)"}),s("button",{class:"btn btn-danger btn-sm",onClick:D,children:"Endgueltig loeschen"})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"System-Info"})}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Version"}),s("span",{class:"detail-value",children:"1.0.0"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Datenbank"}),s("span",{class:"detail-value",children:"Supabase (Frankfurt, EU)"})]})]})]})})]})}function I2({status:t=null}={}){const[e,n]=me([]),[r,i]=me(!0),a=Nt(async()=>{i(!0);let o=Le.from("campaigns").select("*").is("deleted_at",null).order("created_at",{ascending:!1});t&&(o=o.eq("status",t));const{data:l,error:c}=await o;c||n(l||[]),i(!1)},[t]);return Mt(()=>{a()},[a]),{campaigns:e,loading:r,refetch:a}}function P2(t){const[e,n]=me(null),[r,i]=me(!0),a=Nt(async()=>{if(!t)return;i(!0);const{data:c}=await Le.from("campaigns").select("*").eq("id",t).single();n(c),i(!1)},[t]);Mt(()=>{a()},[a]);const o=Nt(async c=>{const{error:d}=await Le.from("campaigns").update(c).eq("id",t);return d||await a(),{error:d}},[t,a]),l=Nt(async()=>Le.from("campaigns").update({deleted_at:new Date().toISOString()}).eq("id",t),[t]);return{campaign:e,loading:r,refetch:a,update:o,remove:l}}function O2(t){const[e,n]=me([]),[r,i]=me(!0),a=Nt(async()=>{if(!t)return;i(!0);const{data:o}=await Le.from("campaign_recipients").select("*, contact:contacts(first_name, last_name, email)").eq("campaign_id",t).order("created_at",{ascending:!1});n(o||[]),i(!1)},[t]);return Mt(()=>{a()},[a]),{recipients:e,loading:r,refetch:a}}async function Yc(t){const{data:e}=await Le.auth.getUser();return Le.from("campaigns").insert({...t,owner_id:e.user.id}).select().single()}async function nf(t,e){if(await Le.from("campaign_recipients").delete().eq("campaign_id",t),e.length===0)return{error:null};const n=e.map(r=>({campaign_id:t,contact_id:r.id,email:r.email}));return Le.from("campaign_recipients").insert(n)}async function Vu(t,{testEmail:e}={}){const{data:{session:n}}=await Le.auth.getSession();if(!n)throw new Error("Not authenticated");const r={campaign_id:t};e&&(r.test_email=e);const i=await fetch("/api/campaign-send",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify(r)}),a=await i.json();if(!i.ok)throw new Error(a.error||"Send failed");return a}const R2=Object.entries(la).map(([t,{label:e}])=>({value:t,label:e}));function F2(){const[t,e]=me(null),{campaigns:n,loading:r}=I2({status:t});return s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Kampagnen"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze("/crm/campaigns/new"),children:"+ Neue Kampagne"})]}),s("div",{class:"page-body",children:[s("div",{style:"margin-bottom: 1rem",children:s(Sd,{filters:R2,active:t,onSelect:e})}),r?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):n.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Kampagnen gefunden"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Name"}),s("th",{children:"Betreff"}),s("th",{children:"Status"}),s("th",{children:"Gesendet"}),s("th",{children:"Geoeffnet"}),s("th",{children:"Datum"})]})}),s("tbody",{children:n.map(i=>{var a,o,l;return s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/campaigns/${i.id}`),children:[s("td",{"data-label":"Name",style:"font-weight:500",children:i.name}),s("td",{"data-label":"Betreff",children:i.subject}),s("td",{"data-label":"Status",children:s("span",{class:"stage-badge",style:`background:${((a=la[i.status])==null?void 0:a.color)||"#6366f1"}15;color:${((o=la[i.status])==null?void 0:o.color)||"#6366f1"};`,children:((l=la[i.status])==null?void 0:l.label)||i.status})}),s("td",{"data-label":"Gesendet",children:i.total_sent||0}),s("td",{"data-label":"Geoeffnet",children:i.total_opened||0}),s("td",{"data-label":"Datum",style:"color:var(--text-dim)",children:jn(i.sent_at||i.created_at)})]},i.id)})})]})})})]})]})}/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:bm,setPrototypeOf:rf,isFrozen:D2,getPrototypeOf:j2,getOwnPropertyDescriptor:B2}=Object;let{freeze:or,seal:$r,create:Ku}=Object,{apply:Ju,construct:Yu}=typeof Reflect<"u"&&Reflect;or||(or=function(e){return e});$r||($r=function(e){return e});Ju||(Ju=function(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];return e.apply(n,i)});Yu||(Yu=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return new e(...r)});const yl=lr(Array.prototype.forEach),M2=lr(Array.prototype.lastIndexOf),af=lr(Array.prototype.pop),eo=lr(Array.prototype.push),U2=lr(Array.prototype.splice),Pl=lr(String.prototype.toLowerCase),Xc=lr(String.prototype.toString),Zc=lr(String.prototype.match),to=lr(String.prototype.replace),$2=lr(String.prototype.indexOf),q2=lr(String.prototype.trim),Xr=lr(Object.prototype.hasOwnProperty),sr=lr(RegExp.prototype.test),no=z2(TypeError);function lr(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return Ju(t,e,r)}}function z2(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Yu(t,n)}}function Lt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Pl;rf&&rf(t,null);let r=e.length;for(;r--;){let i=e[r];if(typeof i=="string"){const a=n(i);a!==i&&(D2(e)||(e[r]=a),i=a)}t[i]=!0}return t}function H2(t){for(let e=0;e<t.length;e++)Xr(t,e)||(t[e]=null);return t}function fi(t){const e=Ku(null);for(const[n,r]of bm(t))Xr(t,n)&&(Array.isArray(r)?e[n]=H2(r):r&&typeof r=="object"&&r.constructor===Object?e[n]=fi(r):e[n]=r);return e}function ro(t,e){for(;t!==null;){const r=B2(t,e);if(r){if(r.get)return lr(r.get);if(typeof r.value=="function")return lr(r.value)}t=j2(t)}function n(){return null}return n}const sf=or(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Qc=or(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),eu=or(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),W2=or(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),tu=or(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),G2=or(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),of=or(["#text"]),lf=or(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),nu=or(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),cf=or(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),_l=or(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),V2=$r(/\{\{[\w\W]*|[\w\W]*\}\}/gm),K2=$r(/<%[\w\W]*|[\w\W]*%>/gm),J2=$r(/\$\{[\w\W]*/gm),Y2=$r(/^data-[\-\w.\u00B7-\uFFFF]+$/),X2=$r(/^aria-[\-\w]+$/),ym=$r(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Z2=$r(/^(?:\w+script|data):/i),Q2=$r(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),_m=$r(/^html$/i),eb=$r(/^[a-z][.\w]*(-[.\w]+)+$/i);var uf=Object.freeze({__proto__:null,ARIA_ATTR:X2,ATTR_WHITESPACE:Q2,CUSTOM_ELEMENT:eb,DATA_ATTR:Y2,DOCTYPE_NAME:_m,ERB_EXPR:K2,IS_ALLOWED_URI:ym,IS_SCRIPT_OR_DATA:Z2,MUSTACHE_EXPR:V2,TMPLIT_EXPR:J2});const io={element:1,text:3,progressingInstruction:7,comment:8,document:9},tb=function(){return typeof window>"u"?null:window},nb=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const i="data-tt-policy-suffix";n&&n.hasAttribute(i)&&(r=n.getAttribute(i));const a="dompurify"+(r?"#"+r:"");try{return e.createPolicy(a,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+a+" could not be created."),null}},df=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function wm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:tb();const e=Ue=>wm(Ue);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==io.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const r=n,i=r.currentScript,{DocumentFragment:a,HTMLTemplateElement:o,Node:l,Element:c,NodeFilter:d,NamedNodeMap:h=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:g,DOMParser:b,trustedTypes:p}=t,y=c.prototype,w=ro(y,"cloneNode"),S=ro(y,"remove"),x=ro(y,"nextSibling"),C=ro(y,"childNodes"),P=ro(y,"parentNode");if(typeof o=="function"){const Ue=n.createElement("template");Ue.content&&Ue.content.ownerDocument&&(n=Ue.content.ownerDocument)}let L,U="";const{implementation:ee,createNodeIterator:V,createDocumentFragment:X,getElementsByTagName:D}=n,{importNode:I}=r;let k=df();e.isSupported=typeof bm=="function"&&typeof P=="function"&&ee&&ee.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:A,ERB_EXPR:M,TMPLIT_EXPR:B,DATA_ATTR:J,ARIA_ATTR:oe,IS_SCRIPT_OR_DATA:ue,ATTR_WHITESPACE:ae,CUSTOM_ELEMENT:fe}=uf;let{IS_ALLOWED_URI:ke}=uf,pe=null;const O=Lt({},[...sf,...Qc,...eu,...tu,...of]);let q=null;const K=Lt({},[...lf,...nu,...cf,..._l]);let Y=Object.seal(Ku(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Q=null,z=null;const re=Object.seal(Ku(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let ce=!0,ge=!0,Ae=!1,Pe=!0,Te=!1,Me=!0,$=!1,Ce=!1,ht=!1,He=!1,we=!1,Ke=!1,Re=!0,Qe=!1;const Ie="user-content-";let it=!0,nt=!1,at={},ut=null;const pt=Lt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let qe=null;const gt=Lt({},["audio","video","img","source","image","track"]);let We=null;const rn=Lt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Et="http://www.w3.org/1998/Math/MathML",bt="http://www.w3.org/2000/svg",ct="http://www.w3.org/1999/xhtml";let Dt=ct,et=!1,jt=null;const st=Lt({},[Et,bt,ct],Xc);let dt=Lt({},["mi","mo","mn","ms","mtext"]),Ut=Lt({},["annotation-xml"]);const kt=Lt({},["title","style","font","a","script"]);let tt=null;const Ft=["application/xhtml+xml","text/html"],yi="text/html";let Ct=null,Gn=null;const Tr=n.createElement("form"),rt=function(te){return te instanceof RegExp||te instanceof Function},gr=function(){let te=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Gn&&Gn===te)){if((!te||typeof te!="object")&&(te={}),te=fi(te),tt=Ft.indexOf(te.PARSER_MEDIA_TYPE)===-1?yi:te.PARSER_MEDIA_TYPE,Ct=tt==="application/xhtml+xml"?Xc:Pl,pe=Xr(te,"ALLOWED_TAGS")?Lt({},te.ALLOWED_TAGS,Ct):O,q=Xr(te,"ALLOWED_ATTR")?Lt({},te.ALLOWED_ATTR,Ct):K,jt=Xr(te,"ALLOWED_NAMESPACES")?Lt({},te.ALLOWED_NAMESPACES,Xc):st,We=Xr(te,"ADD_URI_SAFE_ATTR")?Lt(fi(rn),te.ADD_URI_SAFE_ATTR,Ct):rn,qe=Xr(te,"ADD_DATA_URI_TAGS")?Lt(fi(gt),te.ADD_DATA_URI_TAGS,Ct):gt,ut=Xr(te,"FORBID_CONTENTS")?Lt({},te.FORBID_CONTENTS,Ct):pt,Q=Xr(te,"FORBID_TAGS")?Lt({},te.FORBID_TAGS,Ct):fi({}),z=Xr(te,"FORBID_ATTR")?Lt({},te.FORBID_ATTR,Ct):fi({}),at=Xr(te,"USE_PROFILES")?te.USE_PROFILES:!1,ce=te.ALLOW_ARIA_ATTR!==!1,ge=te.ALLOW_DATA_ATTR!==!1,Ae=te.ALLOW_UNKNOWN_PROTOCOLS||!1,Pe=te.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Te=te.SAFE_FOR_TEMPLATES||!1,Me=te.SAFE_FOR_XML!==!1,$=te.WHOLE_DOCUMENT||!1,He=te.RETURN_DOM||!1,we=te.RETURN_DOM_FRAGMENT||!1,Ke=te.RETURN_TRUSTED_TYPE||!1,ht=te.FORCE_BODY||!1,Re=te.SANITIZE_DOM!==!1,Qe=te.SANITIZE_NAMED_PROPS||!1,it=te.KEEP_CONTENT!==!1,nt=te.IN_PLACE||!1,ke=te.ALLOWED_URI_REGEXP||ym,Dt=te.NAMESPACE||ct,dt=te.MATHML_TEXT_INTEGRATION_POINTS||dt,Ut=te.HTML_INTEGRATION_POINTS||Ut,Y=te.CUSTOM_ELEMENT_HANDLING||{},te.CUSTOM_ELEMENT_HANDLING&&rt(te.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Y.tagNameCheck=te.CUSTOM_ELEMENT_HANDLING.tagNameCheck),te.CUSTOM_ELEMENT_HANDLING&&rt(te.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Y.attributeNameCheck=te.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),te.CUSTOM_ELEMENT_HANDLING&&typeof te.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Y.allowCustomizedBuiltInElements=te.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Te&&(ge=!1),we&&(He=!0),at&&(pe=Lt({},of),q=[],at.html===!0&&(Lt(pe,sf),Lt(q,lf)),at.svg===!0&&(Lt(pe,Qc),Lt(q,nu),Lt(q,_l)),at.svgFilters===!0&&(Lt(pe,eu),Lt(q,nu),Lt(q,_l)),at.mathMl===!0&&(Lt(pe,tu),Lt(q,cf),Lt(q,_l))),te.ADD_TAGS&&(typeof te.ADD_TAGS=="function"?re.tagCheck=te.ADD_TAGS:(pe===O&&(pe=fi(pe)),Lt(pe,te.ADD_TAGS,Ct))),te.ADD_ATTR&&(typeof te.ADD_ATTR=="function"?re.attributeCheck=te.ADD_ATTR:(q===K&&(q=fi(q)),Lt(q,te.ADD_ATTR,Ct))),te.ADD_URI_SAFE_ATTR&&Lt(We,te.ADD_URI_SAFE_ATTR,Ct),te.FORBID_CONTENTS&&(ut===pt&&(ut=fi(ut)),Lt(ut,te.FORBID_CONTENTS,Ct)),te.ADD_FORBID_CONTENTS&&(ut===pt&&(ut=fi(ut)),Lt(ut,te.ADD_FORBID_CONTENTS,Ct)),it&&(pe["#text"]=!0),$&&Lt(pe,["html","head","body"]),pe.table&&(Lt(pe,["tbody"]),delete Q.tbody),te.TRUSTED_TYPES_POLICY){if(typeof te.TRUSTED_TYPES_POLICY.createHTML!="function")throw no('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof te.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw no('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');L=te.TRUSTED_TYPES_POLICY,U=L.createHTML("")}else L===void 0&&(L=nb(p,i)),L!==null&&typeof U=="string"&&(U=L.createHTML(""));or&&or(te),Gn=te}},Ir=Lt({},[...Qc,...eu,...W2]),er=Lt({},[...tu,...G2]),cr=function(te){let Ne=P(te);(!Ne||!Ne.tagName)&&(Ne={namespaceURI:Dt,tagName:"template"});const Fe=Pl(te.tagName),Wt=Pl(Ne.tagName);return jt[te.namespaceURI]?te.namespaceURI===bt?Ne.namespaceURI===ct?Fe==="svg":Ne.namespaceURI===Et?Fe==="svg"&&(Wt==="annotation-xml"||dt[Wt]):!!Ir[Fe]:te.namespaceURI===Et?Ne.namespaceURI===ct?Fe==="math":Ne.namespaceURI===bt?Fe==="math"&&Ut[Wt]:!!er[Fe]:te.namespaceURI===ct?Ne.namespaceURI===bt&&!Ut[Wt]||Ne.namespaceURI===Et&&!dt[Wt]?!1:!er[Fe]&&(kt[Fe]||!Ir[Fe]):!!(tt==="application/xhtml+xml"&&jt[te.namespaceURI]):!1},Pt=function(te){eo(e.removed,{element:te});try{P(te).removeChild(te)}catch{S(te)}},Yt=function(te,Ne){try{eo(e.removed,{attribute:Ne.getAttributeNode(te),from:Ne})}catch{eo(e.removed,{attribute:null,from:Ne})}if(Ne.removeAttribute(te),te==="is")if(He||we)try{Pt(Ne)}catch{}else try{Ne.setAttribute(te,"")}catch{}},xn=function(te){let Ne=null,Fe=null;if(ht)te="<remove></remove>"+te;else{const en=Zc(te,/^[\r\n\t ]+/);Fe=en&&en[0]}tt==="application/xhtml+xml"&&Dt===ct&&(te='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+te+"</body></html>");const Wt=L?L.createHTML(te):te;if(Dt===ct)try{Ne=new b().parseFromString(Wt,tt)}catch{}if(!Ne||!Ne.documentElement){Ne=ee.createDocument(Dt,"template",null);try{Ne.documentElement.innerHTML=et?U:Wt}catch{}}const cn=Ne.body||Ne.documentElement;return te&&Fe&&cn.insertBefore(n.createTextNode(Fe),cn.childNodes[0]||null),Dt===ct?D.call(Ne,$?"html":"body")[0]:$?Ne.documentElement:cn},ii=function(te){return V.call(te.ownerDocument||te,te,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},Pr=function(te){return te instanceof g&&(typeof te.nodeName!="string"||typeof te.textContent!="string"||typeof te.removeChild!="function"||!(te.attributes instanceof h)||typeof te.removeAttribute!="function"||typeof te.setAttribute!="function"||typeof te.namespaceURI!="string"||typeof te.insertBefore!="function"||typeof te.hasChildNodes!="function")},ur=function(te){return typeof l=="function"&&te instanceof l};function Sn(Ue,te,Ne){yl(Ue,Fe=>{Fe.call(e,te,Ne,Gn)})}const dr=function(te){let Ne=null;if(Sn(k.beforeSanitizeElements,te,null),Pr(te))return Pt(te),!0;const Fe=Ct(te.nodeName);if(Sn(k.uponSanitizeElement,te,{tagName:Fe,allowedTags:pe}),Me&&te.hasChildNodes()&&!ur(te.firstElementChild)&&sr(/<[/\w!]/g,te.innerHTML)&&sr(/<[/\w!]/g,te.textContent)||te.nodeType===io.progressingInstruction||Me&&te.nodeType===io.comment&&sr(/<[/\w]/g,te.data))return Pt(te),!0;if(!(re.tagCheck instanceof Function&&re.tagCheck(Fe))&&(!pe[Fe]||Q[Fe])){if(!Q[Fe]&&tr(Fe)&&(Y.tagNameCheck instanceof RegExp&&sr(Y.tagNameCheck,Fe)||Y.tagNameCheck instanceof Function&&Y.tagNameCheck(Fe)))return!1;if(it&&!ut[Fe]){const Wt=P(te)||te.parentNode,cn=C(te)||te.childNodes;if(cn&&Wt){const en=cn.length;for(let Cn=en-1;Cn>=0;--Cn){const un=w(cn[Cn],!0);un.__removalCount=(te.__removalCount||0)+1,Wt.insertBefore(un,x(te))}}}return Pt(te),!0}return te instanceof c&&!cr(te)||(Fe==="noscript"||Fe==="noembed"||Fe==="noframes")&&sr(/<\/no(script|embed|frames)/i,te.innerHTML)?(Pt(te),!0):(Te&&te.nodeType===io.text&&(Ne=te.textContent,yl([A,M,B],Wt=>{Ne=to(Ne,Wt," ")}),te.textContent!==Ne&&(eo(e.removed,{element:te.cloneNode()}),te.textContent=Ne)),Sn(k.afterSanitizeElements,te,null),!1)},hr=function(te,Ne,Fe){if(Re&&(Ne==="id"||Ne==="name")&&(Fe in n||Fe in Tr))return!1;if(!(ge&&!z[Ne]&&sr(J,Ne))){if(!(ce&&sr(oe,Ne))){if(!(re.attributeCheck instanceof Function&&re.attributeCheck(Ne,te))){if(!q[Ne]||z[Ne]){if(!(tr(te)&&(Y.tagNameCheck instanceof RegExp&&sr(Y.tagNameCheck,te)||Y.tagNameCheck instanceof Function&&Y.tagNameCheck(te))&&(Y.attributeNameCheck instanceof RegExp&&sr(Y.attributeNameCheck,Ne)||Y.attributeNameCheck instanceof Function&&Y.attributeNameCheck(Ne,te))||Ne==="is"&&Y.allowCustomizedBuiltInElements&&(Y.tagNameCheck instanceof RegExp&&sr(Y.tagNameCheck,Fe)||Y.tagNameCheck instanceof Function&&Y.tagNameCheck(Fe))))return!1}else if(!We[Ne]){if(!sr(ke,to(Fe,ae,""))){if(!((Ne==="src"||Ne==="xlink:href"||Ne==="href")&&te!=="script"&&$2(Fe,"data:")===0&&qe[te])){if(!(Ae&&!sr(ue,to(Fe,ae,"")))){if(Fe)return!1}}}}}}}return!0},tr=function(te){return te!=="annotation-xml"&&Zc(te,fe)},ai=function(te){Sn(k.beforeSanitizeAttributes,te,null);const{attributes:Ne}=te;if(!Ne||Pr(te))return;const Fe={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:q,forceKeepAttr:void 0};let Wt=Ne.length;for(;Wt--;){const cn=Ne[Wt],{name:en,namespaceURI:Cn,value:un}=cn,Rr=Ct(en),$i=un;let sn=en==="value"?$i:q2($i);if(Fe.attrName=Rr,Fe.attrValue=sn,Fe.keepAttr=!0,Fe.forceKeepAttr=void 0,Sn(k.uponSanitizeAttribute,te,Fe),sn=Fe.attrValue,Qe&&(Rr==="id"||Rr==="name")&&(Yt(en,te),sn=Ie+sn),Me&&sr(/((--!?|])>)|<\/(style|title|textarea)/i,sn)){Yt(en,te);continue}if(Rr==="attributename"&&Zc(sn,"href")){Yt(en,te);continue}if(Fe.forceKeepAttr)continue;if(!Fe.keepAttr){Yt(en,te);continue}if(!Pe&&sr(/\/>/i,sn)){Yt(en,te);continue}Te&&yl([A,M,B],ha=>{sn=to(sn,ha," ")});const da=Ct(te.nodeName);if(!hr(da,Rr,sn)){Yt(en,te);continue}if(L&&typeof p=="object"&&typeof p.getAttributeType=="function"&&!Cn)switch(p.getAttributeType(da,Rr)){case"TrustedHTML":{sn=L.createHTML(sn);break}case"TrustedScriptURL":{sn=L.createScriptURL(sn);break}}if(sn!==$i)try{Cn?te.setAttributeNS(Cn,en,sn):te.setAttribute(en,sn),Pr(te)?Pt(te):af(e.removed)}catch{Yt(en,te)}}Sn(k.afterSanitizeAttributes,te,null)},Or=function Ue(te){let Ne=null;const Fe=ii(te);for(Sn(k.beforeSanitizeShadowDOM,te,null);Ne=Fe.nextNode();)Sn(k.uponSanitizeShadowNode,Ne,null),dr(Ne),ai(Ne),Ne.content instanceof a&&Ue(Ne.content);Sn(k.afterSanitizeShadowDOM,te,null)};return e.sanitize=function(Ue){let te=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ne=null,Fe=null,Wt=null,cn=null;if(et=!Ue,et&&(Ue="<!-->"),typeof Ue!="string"&&!ur(Ue))if(typeof Ue.toString=="function"){if(Ue=Ue.toString(),typeof Ue!="string")throw no("dirty is not a string, aborting")}else throw no("toString is not a function");if(!e.isSupported)return Ue;if(Ce||gr(te),e.removed=[],typeof Ue=="string"&&(nt=!1),nt){if(Ue.nodeName){const un=Ct(Ue.nodeName);if(!pe[un]||Q[un])throw no("root node is forbidden and cannot be sanitized in-place")}}else if(Ue instanceof l)Ne=xn("<!---->"),Fe=Ne.ownerDocument.importNode(Ue,!0),Fe.nodeType===io.element&&Fe.nodeName==="BODY"||Fe.nodeName==="HTML"?Ne=Fe:Ne.appendChild(Fe);else{if(!He&&!Te&&!$&&Ue.indexOf("<")===-1)return L&&Ke?L.createHTML(Ue):Ue;if(Ne=xn(Ue),!Ne)return He?null:Ke?U:""}Ne&&ht&&Pt(Ne.firstChild);const en=ii(nt?Ue:Ne);for(;Wt=en.nextNode();)dr(Wt),ai(Wt),Wt.content instanceof a&&Or(Wt.content);if(nt)return Ue;if(He){if(we)for(cn=X.call(Ne.ownerDocument);Ne.firstChild;)cn.appendChild(Ne.firstChild);else cn=Ne;return(q.shadowroot||q.shadowrootmode)&&(cn=I.call(r,cn,!0)),cn}let Cn=$?Ne.outerHTML:Ne.innerHTML;return $&&pe["!doctype"]&&Ne.ownerDocument&&Ne.ownerDocument.doctype&&Ne.ownerDocument.doctype.name&&sr(_m,Ne.ownerDocument.doctype.name)&&(Cn="<!DOCTYPE "+Ne.ownerDocument.doctype.name+`>
`+Cn),Te&&yl([A,M,B],un=>{Cn=to(Cn,un," ")}),L&&Ke?L.createHTML(Cn):Cn},e.setConfig=function(){let Ue=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};gr(Ue),Ce=!0},e.clearConfig=function(){Gn=null,Ce=!1},e.isValidAttribute=function(Ue,te,Ne){Gn||gr({});const Fe=Ct(Ue),Wt=Ct(te);return hr(Fe,Wt,Ne)},e.addHook=function(Ue,te){typeof te=="function"&&eo(k[Ue],te)},e.removeHook=function(Ue,te){if(te!==void 0){const Ne=M2(k[Ue],te);return Ne===-1?void 0:U2(k[Ue],Ne,1)[0]}return af(k[Ue])},e.removeHooks=function(Ue){k[Ue]=[]},e.removeAllHooks=function(){k=df()},e}var Vl=wm();const rb=Object.freeze(Object.defineProperty({__proto__:null,default:Vl},Symbol.toStringTag,{value:"Module"})),hf=[{num:1,label:"Empfaenger"},{num:2,label:"Inhalt"},{num:3,label:"Vorschau & Senden"}],ib=[{tag:"{{vorname}}",label:"Vorname"},{tag:"{{nachname}}",label:"Nachname"},{tag:"{{firma}}",label:"Firma"},{tag:"{{email}}",label:"E-Mail"}];function ab(){var Q;const t=Qn(),{contacts:e}=sc(),{companies:n}=oc(),r=zp(null),[i,a]=me(1),[o,l]=me({name:"",subject:"",body_html:""}),[c,d]=me(new Set),[h,g]=me(""),[b,p]=me(""),[y,w]=me(!1),[S,x]=me(!1),[C,P]=me(!1),[L,U]=me(""),[ee,V]=me(!1);function X(z,re){l(ce=>({...ce,[z]:re}))}function D(z){const re=Xh.find(ce=>ce.id===z);re&&l(ce=>({...ce,subject:re.subject||ce.subject,body_html:re.body}))}function I(z){const re=r.current;if(!re){X("body_html",o.body_html+z);return}const ce=re.selectionStart,ge=re.selectionEnd,Ae=o.body_html,Pe=Ae.substring(0,ce)+z+Ae.substring(ge);X("body_html",Pe),requestAnimationFrame(()=>{re.focus(),re.selectionStart=re.selectionEnd=ce+z.length})}const k=ho(()=>e.filter(z=>z.email&&z.gdpr_consent),[e]),A=ho(()=>{let z=k;if(b&&(z=z.filter(re=>re.company_id===b)),h){const re=h.toLowerCase();z=z.filter(ce=>{var ge;return(ce.first_name||"").toLowerCase().includes(re)||(ce.last_name||"").toLowerCase().includes(re)||(ce.email||"").toLowerCase().includes(re)||(((ge=ce.company)==null?void 0:ge.name)||"").toLowerCase().includes(re)})}return z},[k,h,b]);function M(z){d(re=>{const ce=new Set(re);return ce.has(z)?ce.delete(z):ce.add(z),ce})}function B(){d(new Set(k.map(z=>z.id)))}function J(){d(new Set)}const oe=A.length>0&&A.every(z=>c.has(z.id));function ue(){d(oe?z=>{const re=new Set(z);return A.forEach(ce=>re.delete(ce.id)),re}:z=>{const re=new Set(z);return A.forEach(ce=>re.add(ce.id)),re})}const ae=ho(()=>k.filter(z=>c.has(z.id)),[k,c]),fe=ae.length>0?{vorname:ae[0].first_name||"Max",nachname:ae[0].last_name||"Mustermann",firma:((Q=ae[0].company)==null?void 0:Q.name)||"Musterfirma GmbH",email:ae[0].email}:{vorname:"Max",nachname:"Mustermann",firma:"Musterfirma GmbH",email:"max@example.de"},ke=o.body_html.replace(/\{\{vorname\}\}/gi,fe.vorname).replace(/\{\{nachname\}\}/gi,fe.nachname).replace(/\{\{firma\}\}/gi,fe.firma).replace(/\{\{email\}\}/gi,fe.email);async function pe(){if(!o.name||!o.subject||!o.body_html){t.error("Name, Betreff und Inhalt sind Pflichtfelder");return}w(!0);try{const{data:z,error:re}=await Yc({name:o.name,subject:o.subject,body_html:o.body_html,filters:{}});if(re)throw re;await nf(z.id,ae),t.success("Kampagne gespeichert"),ze(`/crm/campaigns/${z.id}`)}catch(z){t.error(z.message||"Fehler beim Speichern")}w(!1)}async function O(){if(!o.name||!o.subject||!o.body_html){t.error("Name, Betreff und Inhalt sind Pflichtfelder");return}if(ae.length===0){t.error("Keine Empfaenger ausgewaehlt");return}w(!0);try{const{data:z,error:re}=await Yc({name:o.name,subject:o.subject,body_html:o.body_html,filters:{}});if(re)throw re;await nf(z.id,ae);const ce=await Vu(z.id);t.success(`Kampagne gesendet an ${ce.total_sent} Empfaenger`),ze(`/crm/campaigns/${z.id}`)}catch(z){t.error(z.message||"Fehler beim Senden")}w(!1),P(!1)}async function q(){if(!L){t.error("Bitte Test-E-Mail-Adresse eingeben");return}if(!o.subject||!o.body_html){t.error("Betreff und Inhalt muessen ausgefuellt sein");return}V(!0);try{const{data:z,error:re}=await Yc({name:o.name||"Test-Kampagne",subject:o.subject,body_html:o.body_html,filters:{}});if(re)throw re;await Vu(z.id,{testEmail:L}),t.success(`Test-Mail an ${L} gesendet`)}catch(z){t.error(z.message||"Test-Mail fehlgeschlagen")}V(!1)}function K(){return c.size>0}function Y(){return o.name&&o.subject&&o.body_html}return s(At,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/campaigns"),children:""}),s("h1",{class:"page-title",children:"Neue Kampagne"})]})}),s("div",{class:"page-body",children:[s("div",{style:"display:flex;align-items:center;gap:0;margin-bottom:1.5rem;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;",children:hf.map((z,re)=>s("button",{onClick:()=>{z.num===2&&!K()||z.num===3&&(!K()||!Y())||a(z.num)},style:`
                flex:1;padding:0.875rem 1rem;border:none;cursor:pointer;
                font-size:0.875rem;font-weight:${i===z.num?"600":"500"};
                background:${i===z.num?"var(--primary)":i>z.num?"rgba(26,92,107,0.08)":"transparent"};
                color:${i===z.num?"#fff":i>z.num?"var(--primary)":"var(--text-muted)"};
                border-right:${re<hf.length-1?"1px solid var(--border)":"none"};
                transition:all 0.15s;
                display:flex;align-items:center;justify-content:center;gap:0.5rem;
              `,children:[s("span",{style:`
                width:24px;height:24px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;
                font-size:0.75rem;font-weight:700;
                background:${i===z.num?"rgba(255,255,255,0.2)":i>z.num?"var(--primary)":"var(--border)"};
                color:${i===z.num||i>z.num?"#fff":"var(--text-muted)"};
              `,children:i>z.num?"":z.num}),s("span",{class:"hide-mobile-sm",children:z.label})]},z.num))}),i===1&&s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Empfaenger waehlen"}),s("span",{style:"font-size:0.85rem;color:var(--text-muted)",children:[k.length," Kontakte mit DSGVO-Einwilligung"]})]}),s("div",{style:"display:flex;gap:0.75rem;margin-bottom:1rem;flex-wrap:wrap;align-items:end;",children:[s("div",{style:"flex:1;min-width:200px;",children:[s("label",{children:"Suche"}),s("input",{value:h,onInput:z=>g(z.target.value),placeholder:"Name, E-Mail oder Firma..."})]}),s("div",{style:"min-width:180px;",children:[s("label",{children:"Firma"}),s("select",{value:b,onChange:z=>p(z.target.value),children:[s("option",{value:"",children:"Alle Firmen"}),n.map(z=>s("option",{value:z.id,children:z.name},z.id))]})]}),s("div",{style:"display:flex;gap:0.5rem;",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:B,children:"Alle waehlen"}),s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:J,children:"Keine"})]})]}),A.length===0?s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:k.length===0?"Keine Kontakte mit DSGVO-Einwilligung und E-Mail":"Keine Treffer fuer diese Suche"})}):s("div",{style:"border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;",children:s("table",{style:"margin:0;",children:[s("thead",{children:s("tr",{children:[s("th",{style:"width:40px;padding:0.5rem 0.75rem;",children:s("input",{type:"checkbox",checked:oe,onChange:ue,style:"width:auto;"})}),s("th",{children:"Name"}),s("th",{children:"E-Mail"}),s("th",{class:"hide-mobile-sm",children:"Firma"})]})}),s("tbody",{children:A.map(z=>{var re;return s("tr",{onClick:()=>M(z.id),style:`cursor:pointer;${c.has(z.id)?"background:rgba(26,92,107,0.06);":""}`,children:[s("td",{style:"width:40px;padding:0.5rem 0.75rem;","data-label":"",children:s("input",{type:"checkbox",checked:c.has(z.id),onChange:()=>M(z.id),onClick:ce=>ce.stopPropagation(),style:"width:auto;"})}),s("td",{"data-label":"Name",children:s("span",{style:"font-weight:500;",children:`${z.first_name||""} ${z.last_name||""}`.trim()||""})}),s("td",{"data-label":"E-Mail",style:"color:var(--text-muted);",children:z.email}),s("td",{"data-label":"Firma",class:"hide-mobile-sm",style:"color:var(--text-muted);",children:((re=z.company)==null?void 0:re.name)||""})]},z.id)})})]})}),s("div",{style:"display:flex;align-items:center;justify-content:space-between;margin-top:1rem;flex-wrap:wrap;gap:0.75rem;",children:[s("div",{style:"padding:0.5rem 1rem;background:var(--bg-hover);border-radius:var(--radius);font-size:0.875rem;",children:[s("strong",{children:c.size})," von ",k.length," Empfaenger ausgewaehlt"]}),s("button",{class:"btn btn-primary",onClick:()=>a(2),disabled:!K(),children:"Weiter "})]})]}),i===2&&s("div",{style:"display:flex;flex-direction:column;gap:1.5rem;",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Kampagne"})}),s("div",{class:"form-group",style:"margin:0;",children:[s("label",{children:"Name (intern)"}),s("input",{value:o.name,onInput:z=>X("name",z.target.value),placeholder:"z.B. Follow-up Februar 2026"})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Vorlage waehlen"})}),s("div",{style:"display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:0.75rem;",children:Xh.map(z=>s("button",{onClick:()=>D(z.id),style:`
                      display:flex;flex-direction:column;align-items:center;gap:0.5rem;
                      padding:1rem;border-radius:var(--radius);border:1px solid var(--border);
                      background:var(--bg-card);cursor:pointer;transition:all 0.15s;text-align:center;
                    `,onMouseEnter:re=>{re.currentTarget.style.borderColor="var(--primary)",re.currentTarget.style.background="rgba(26,92,107,0.04)"},onMouseLeave:re=>{re.currentTarget.style.borderColor="var(--border)",re.currentTarget.style.background="var(--bg-card)"},children:[s("span",{style:"font-size:1.5rem;",children:z.icon||""}),s("span",{style:"font-weight:600;font-size:0.85rem;color:var(--text);",children:z.name}),z.preview&&s("span",{style:"font-size:0.75rem;color:var(--text-muted);line-height:1.3;",children:z.preview})]},z.id))})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Betreff"})}),s("input",{value:o.subject,onInput:z=>X("subject",z.target.value),placeholder:"Betreff der E-Mail"})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Inhalt (HTML)"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>x(!S),children:S?"Editor":"Vorschau"})]}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.75rem;",children:[s("span",{style:"font-size:0.75rem;color:var(--text-dim);display:flex;align-items:center;",children:"Platzhalter:"}),ib.map(z=>s("button",{type:"button",onClick:()=>I(z.tag),style:"padding:0.2rem 0.6rem;border-radius:999px;font-size:0.75rem;font-weight:500;background:rgba(26,92,107,0.08);color:var(--primary);border:1px solid rgba(26,92,107,0.2);cursor:pointer;transition:all 0.15s;",onMouseEnter:re=>{re.currentTarget.style.background="rgba(26,92,107,0.15)"},onMouseLeave:re=>{re.currentTarget.style.background="rgba(26,92,107,0.08)"},children:z.label},z.tag))]}),S?s("div",{style:"border:1px solid var(--border);border-radius:8px;padding:1rem;background:#fff;min-height:300px;",dangerouslySetInnerHTML:{__html:Vl.sanitize(ke)}}):s("textarea",{ref:r,value:o.body_html,onInput:z=>X("body_html",z.target.value),style:"width:100%;min-height:350px;font-family:monospace;font-size:0.8rem;border:1px solid var(--border);border-radius:8px;padding:0.75rem;",placeholder:"HTML-Inhalt der E-Mail..."})]}),s("div",{style:"display:flex;justify-content:space-between;",children:[s("button",{class:"btn btn-secondary",onClick:()=>a(1),children:" Zurueck"}),s("button",{class:"btn btn-primary",onClick:()=>a(3),disabled:!Y(),children:"Weiter "})]})]}),i===3&&s("div",{style:"display:flex;flex-direction:column;gap:1.5rem;",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Zusammenfassung"})}),s("div",{style:"display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;",children:[s("div",{style:"padding:1rem;background:var(--bg-hover);border-radius:var(--radius);text-align:center;",children:[s("div",{style:"font-size:1.75rem;font-weight:700;",children:c.size}),s("div",{style:"font-size:0.8rem;color:var(--text-muted);",children:"Empfaenger"})]}),s("div",{style:"padding:1rem;background:var(--bg-hover);border-radius:var(--radius);",children:[s("div",{style:"font-size:0.7rem;font-weight:600;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.25rem;",children:"Kampagne"}),s("div",{style:"font-weight:500;",children:o.name})]}),s("div",{style:"padding:1rem;background:var(--bg-hover);border-radius:var(--radius);",children:[s("div",{style:"font-size:0.7rem;font-weight:600;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.25rem;",children:"Betreff"}),s("div",{style:"font-weight:500;",children:o.subject})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"E-Mail-Vorschau"}),ae.length>0&&s("span",{style:"font-size:0.75rem;color:var(--text-dim);",children:["Personalisiert fuer: ",fe.vorname," ",fe.nachname]})]}),s("div",{style:"border:1px solid var(--border);border-radius:8px;padding:1rem;background:#fff;max-height:500px;overflow:auto;",dangerouslySetInnerHTML:{__html:Vl.sanitize(ke)}})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Test-Mail senden"})}),s("div",{style:"display:flex;gap:0.75rem;align-items:end;flex-wrap:wrap;",children:[s("div",{style:"flex:1;min-width:200px;",children:[s("label",{children:"E-Mail-Adresse"}),s("input",{type:"email",value:L,onInput:z=>U(z.target.value),placeholder:"rundgang@beck360.de"})]}),s("button",{class:"btn btn-secondary",onClick:q,disabled:ee,style:"white-space:nowrap;",children:ee?"Sende...":"Test senden"})]})]}),s("div",{style:"display:flex;justify-content:space-between;flex-wrap:wrap;gap:0.75rem;",children:[s("button",{class:"btn btn-secondary",onClick:()=>a(2),children:" Zurueck"}),s("div",{style:"display:flex;gap:0.75rem;",children:[s("button",{class:"btn btn-secondary",onClick:pe,disabled:y,children:y?"Speichere...":"Als Entwurf speichern"}),s("button",{class:"btn btn-primary",onClick:()=>P(!0),disabled:y||c.size===0,children:"Jetzt senden"})]})]})]})]}),C&&s(Ma,{title:"Kampagne senden?",onClose:()=>P(!1),children:[s("p",{style:"margin-bottom:1rem;",children:['Die Kampagne "',s("strong",{children:o.name}),'" wird an ',s("strong",{children:[c.size," Empfaenger"]})," gesendet. Dieser Vorgang kann nicht rueckgaengig gemacht werden."]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary",onClick:()=>P(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary",onClick:O,disabled:y,children:y?"Sende...":"Jetzt senden"})]})]})]})}const ru={pending:{label:"Ausstehend",color:"#6366f1"},sent:{label:"Gesendet",color:"#3b82f6"},opened:{label:"Geoeffnet",color:"#10b981"},clicked:{label:"Geklickt",color:"#059669"},bounced:{label:"Bounce",color:"#ef4444"},unsubscribed:{label:"Abgemeldet",color:"#94a3b8"}};function sb({id:t}){var I,k,A,M;const{campaign:e,loading:n,update:r,refetch:i,remove:a}=P2(t),{recipients:o,loading:l,refetch:c}=O2(t),d=Qn(),[h,g]=me(!1),[b,p]=me({}),[y,w]=me(!1),[S,x]=me(!1),[C,P]=me(!1);if(n)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Kampagne"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Nicht gefunden"})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Kampagne nicht gefunden"})})})]});function L(){p({name:e.name||"",subject:e.subject||"",body_html:e.body_html||""}),g(!0)}async function U(){const{error:B}=await r(b);B?d.error("Fehler beim Speichern"):(d.success("Kampagne aktualisiert"),g(!1))}async function ee(){x(!0);try{const B=await Vu(e.id);d.success(`Kampagne gesendet an ${B.total_sent} Empfaenger`),i(),c()}catch(B){d.error(B.message||"Senden fehlgeschlagen")}x(!1),w(!1)}async function V(){const{error:B}=await a();B?d.error("Fehler beim Loeschen"):(d.success("Kampagne geloescht"),ze("/crm/campaigns"))}const X=e.total_sent>0?Math.round(e.total_opened/e.total_sent*100):0,D=e.total_sent>0?Math.round(e.total_clicked/e.total_sent*100):0;return s(At,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/campaigns"),children:""}),s("h1",{class:"page-title",children:e.name}),s("span",{class:"stage-badge",style:`background:${((I=la[e.status])==null?void 0:I.color)||"#6366f1"}15;color:${((k=la[e.status])==null?void 0:k.color)||"#6366f1"};`,children:((A=la[e.status])==null?void 0:A.label)||e.status})]}),s("div",{style:"display:flex;gap:0.5rem",children:e.status==="draft"&&s(At,{children:[!h&&s("button",{class:"btn btn-secondary btn-sm",onClick:L,children:"Bearbeiten"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>w(!0),children:"Senden"}),s("button",{class:"btn btn-danger btn-sm",onClick:()=>P(!0),children:"Loeschen"})]})})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[e.status==="sent"&&s("div",{style:"display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1rem;",children:[s("div",{class:"card",style:"text-align:center;padding:1.25rem;",children:[s("div",{class:"kpi-value",children:e.total_sent}),s("div",{class:"kpi-label",children:"Gesendet"})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem;",children:[s("div",{class:"kpi-value",children:[e.total_opened," ",s("span",{style:"font-size:0.85rem;color:var(--text-dim)",children:["(",X,"%)"]})]}),s("div",{class:"kpi-label",children:"Geoeffnet"})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem;",children:[s("div",{class:"kpi-value",children:[e.total_clicked," ",s("span",{style:"font-size:0.85rem;color:var(--text-dim)",children:["(",D,"%)"]})]}),s("div",{class:"kpi-label",children:"Geklickt"})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Kampagnen-Details"})}),h?s("div",{children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group form-group-full",children:[s("label",{children:"Name"}),s("input",{value:b.name,onInput:B=>p({...b,name:B.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Betreff"}),s("input",{value:b.subject,onInput:B=>p({...b,subject:B.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Inhalt (HTML)"}),s("textarea",{value:b.body_html,onInput:B=>p({...b,body_html:B.target.value}),style:"width:100%;min-height:200px;font-family:monospace;font-size:0.8rem;"})]})]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>g(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary btn-sm",onClick:U,children:"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Betreff"}),s("span",{class:"detail-value",children:e.subject})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:bl(e.created_at)})]}),e.sent_at&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Gesendet am"}),s("span",{class:"detail-value",children:bl(e.sent_at)})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"E-Mail-Vorschau"})}),s("div",{style:"border:1px solid var(--border);border-radius:8px;padding:1rem;background:#fff;max-height:400px;overflow:auto;",dangerouslySetInnerHTML:{__html:Vl.sanitize(e.body_html)}})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Empfaenger (",o.length,")"]})}),l?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):o.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Empfaenger"}):s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Name"}),s("th",{children:"E-Mail"}),s("th",{children:"Status"}),s("th",{children:"Geoeffnet"}),s("th",{children:"Geklickt"})]})}),s("tbody",{children:o.map(B=>{var J,oe,ue;return s("tr",{children:[s("td",{children:B.contact?s("a",{href:"#",onClick:ae=>{ae.preventDefault(),ze(`/crm/contacts/${B.contact_id}`)},children:`${B.contact.first_name||""} ${B.contact.last_name||""}`.trim()||B.email}):B.email}),s("td",{children:B.email}),s("td",{children:s("span",{class:"stage-badge",style:`background:${((J=ru[B.status])==null?void 0:J.color)||"#6366f1"}15;color:${((oe=ru[B.status])==null?void 0:oe.color)||"#6366f1"};`,children:((ue=ru[B.status])==null?void 0:ue.label)||B.status})}),s("td",{style:"color:var(--text-dim)",children:B.opened_at?bl(B.opened_at):""}),s("td",{style:"color:var(--text-dim)",children:B.clicked_at?bl(B.clicked_at):""})]},B.id)})})]})})]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Status"}),s("span",{class:"detail-value",children:(M=la[e.status])==null?void 0:M.label})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt"}),s("span",{class:"detail-value",children:jn(e.created_at)})]}),e.sent_at&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Gesendet"}),s("span",{class:"detail-value",children:jn(e.sent_at)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Empfaenger"}),s("span",{class:"detail-value",children:o.length})]})]})})]})}),y&&s(Ma,{title:"Kampagne senden?",onClose:()=>w(!1),children:[s("p",{style:"margin-bottom:1rem;",children:['Die Kampagne "',s("strong",{children:e.name}),'" wird jetzt versendet. Nur Kontakte mit DSGVO-Einwilligung erhalten die E-Mail.']}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary",onClick:()=>w(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary",onClick:ee,disabled:S,children:S?"Sende...":"Jetzt senden"})]})]}),C&&s(Ma,{title:"Kampagne loeschen?",onClose:()=>P(!1),children:[s("p",{style:"margin-bottom:1rem;",children:['Die Kampagne "',s("strong",{children:e.name}),'" wird unwiderruflich geloescht.']}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary",onClick:()=>P(!1),children:"Abbrechen"}),s("button",{class:"btn btn-danger",onClick:V,children:"Loeschen"})]})]})]})}function ob(){const[t,e]=me(null),[n,r]=me(null),{invoices:i,loading:a,refetch:o}=gd({type:t,status:n}),[l,c]=me(new Set),[d,h]=me(!1),g=Qn();function b(w,S){S.stopPropagation(),c(x=>{const C=new Set(x);return C.has(w)?C.delete(w):C.add(w),C})}function p(){l.size===i.length?c(new Set):c(new Set(i.map(w=>w.id)))}async function y(){if(l.size===0||!confirm(`${l.size} Dokument${l.size>1?"e":""} wirklich loeschen?`))return;h(!0);let w=0;for(const S of l){const{error:x}=await mm(S);x&&w++}h(!1),c(new Set),await o(),w?g.error(`${w} Fehler beim Loeschen`):g.success(`${l.size===0?"":"Geloescht"}`)}return s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Rechnungen & Angebote"}),s("div",{style:"display:flex;gap:0.5rem;align-items:center",children:[l.size>0&&s("button",{class:"btn btn-danger btn-sm",onClick:y,disabled:d,children:d?"Loesche...":`${l.size} loeschen`}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze("/crm/invoices/new?type=invoice"),children:"+ Rechnung"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/invoices/new?type=quote"),children:"+ Angebot"})]})]}),s("div",{class:"page-body",children:[s("div",{class:"search-bar",children:[s("div",{class:"filter-pills",children:[s("button",{class:`filter-pill ${t?"":"active"}`,onClick:()=>e(null),children:"Alle"}),Object.entries(As).map(([w,S])=>s("button",{class:`filter-pill ${t===w?"active":""}`,onClick:()=>e(t===w?null:w),children:S.label},w))]}),s("div",{class:"filter-pills",children:Object.entries(Zn).map(([w,S])=>s("button",{class:`filter-pill ${n===w?"active":""}`,onClick:()=>r(n===w?null:w),children:S.label},w))})]}),a?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):i.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Rechnungen oder Angebote"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{style:"width:2.5rem;padding-right:0",children:s("input",{type:"checkbox",checked:l.size===i.length,onChange:p,style:"cursor:pointer"})}),s("th",{children:"Nummer"}),s("th",{children:"Typ"}),s("th",{children:"Kunde"}),s("th",{children:"Datum"}),s("th",{children:"Status"}),s("th",{style:"text-align:right",children:"Betrag"})]})}),s("tbody",{children:i.map(w=>{var S,x,C,P;return s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/invoices/${w.id}`),style:l.has(w.id)?"background:var(--brand-light, rgba(26,92,107,0.08))":"",children:[s("td",{style:"padding-right:0",onClick:L=>L.stopPropagation(),children:s("input",{type:"checkbox",checked:l.has(w.id),onChange:L=>b(w.id,L),style:"cursor:pointer"})}),s("td",{"data-label":"Nummer",style:"font-weight:600",children:w.invoice_number}),s("td",{"data-label":"Typ",children:s("span",{style:`font-size:0.75rem;padding:0.15rem 0.5rem;border-radius:999px;background:${w.type==="quote"?"rgba(139,92,246,0.15);color:#a78bfa":"rgba(59,130,246,0.15);color:#60a5fa"}`,children:(S=As[w.type])==null?void 0:S.label})}),s("td",{"data-label":"Kunde",children:w.customer_company||w.customer_name||""}),s("td",{"data-label":"Datum",children:jn(w.invoice_date)}),s("td",{"data-label":"Status",children:s("span",{class:"stage-badge",style:`color:${(x=Zn[w.status])==null?void 0:x.color};background:${(C=Zn[w.status])==null?void 0:C.color}20`,children:(P=Zn[w.status])==null?void 0:P.label})}),s("td",{"data-label":"Betrag",style:"text-align:right;font-weight:600",children:je(w.total_amount)})]},w.id)})})]})})})]})]})}function lb({items:t,onChange:e}){function n(o,l,c){const d=t.map((h,g)=>g===o?{...h,[l]:c}:h);e(d)}function r(){e([...t,{description:"",sub_description:"",quantity:1,unit_price:0}])}function i(o){e(t.filter((l,c)=>c!==o))}function a(o){return(parseFloat(o)||0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})+" "}return s("div",{children:[s("div",{class:"table-wrapper",children:s("table",{class:"line-items-table",children:[s("thead",{children:s("tr",{children:[s("th",{style:"width:40%",children:"Bezeichnung"}),s("th",{style:"width:15%",children:"Menge"}),s("th",{style:"width:20%",children:"Einzelpreis"}),s("th",{style:"width:15%;text-align:right",children:"Gesamt"}),s("th",{style:"width:10%"})]})}),s("tbody",{children:t.map((o,l)=>{const c=(parseFloat(o.quantity)||0)*(parseFloat(o.unit_price)||0);return s("tr",{children:[s("td",{children:[s("input",{value:o.description,onInput:d=>n(l,"description",d.target.value),placeholder:"Leistung / Produkt",required:!0}),s("input",{value:o.sub_description||"",onInput:d=>n(l,"sub_description",d.target.value),placeholder:"Zusatzinfo (optional)",style:"margin-top:0.25rem;font-size:0.8rem;color:var(--text-muted)"})]}),s("td",{children:s("input",{type:"number",step:"0.01",min:"0",value:o.quantity,onInput:d=>n(l,"quantity",d.target.value),style:"text-align:right"})}),s("td",{children:s("input",{type:"number",step:"0.01",min:"0",value:o.unit_price,onInput:d=>n(l,"unit_price",d.target.value),style:"text-align:right"})}),s("td",{style:"text-align:right;white-space:nowrap;font-weight:500",children:a(c)}),s("td",{style:"text-align:center",children:s("button",{type:"button",class:"btn btn-danger btn-sm",onClick:()=>i(l),title:"Entfernen",children:"x"})})]},l)})})]})}),s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:r,style:"margin-top:0.75rem",children:"+ Position"})]})}function cb(){const t=Qn(),{settings:e}=ic(),n=new URLSearchParams(window.location.search),r=n.get("type")||"invoice",i=n.get("deal_id"),a=n.get("quote_id"),o=n.get("edit"),{invoice:l,items:c,loading:d}=pm(o),[h,g]=me(!1),[b,p]=me([]),[y,w]=me([]),[S,x]=me({type:r,invoice_number:"",invoice_date:new Date().toISOString().slice(0,10),due_date:"",company_id:"",contact_id:"",deal_id:i||"",customer_company:"",customer_name:"",customer_street:"",customer_zip:"",customer_city:"",customer_number:"",discount_percent:0,vat_rate:19,payment_terms:"Diese Rechnung ist zahlbar innerhalb von 14 Tagen ohne Abzug auf das unten angegebene Bankkonto.",closing_message:"",intro_text:"",notes:""}),[C,P]=me([{description:"",sub_description:"",quantity:1,unit_price:0}]);Mt(()=>{Le.from("companies").select("id, name, address, city").is("deleted_at",null).order("name").then(({data:I})=>p(I||[])),Le.from("contacts").select("id, first_name, last_name, email, company_id").is("deleted_at",null).order("last_name").then(({data:I})=>w(I||[]))},[]),Mt(()=>{if(e&&!o&&!a){const I=new Date;I.setDate(I.getDate()+(e.default_payment_days||14)),x(k=>{const M=k.type==="quote"?e.default_quote_intro||"Vielen Dank fuer Ihr Interesse. Gerne unterbreite ich Ihnen folgendes Angebot:":e.default_invoice_intro||"Vielen Dank fuer Ihren Auftrag. Ich berechne Ihnen fuer folgende Leistungen:";return{...k,vat_rate:parseFloat(e.vat_rate)||19,due_date:k.due_date||I.toISOString().slice(0,10),closing_message:k.closing_message||e.default_closing_text||"",intro_text:k.intro_text||M}})}},[e,o,a]),Mt(()=>{!i||o||Le.from("deals").select("*, contact:contacts(id, first_name, last_name), company:companies(id, name, address, city)").eq("id",i).single().then(({data:I})=>{if(!I)return;const k=I.contact?`${I.contact.first_name||""} ${I.contact.last_name||""}`.trim():"";x(A=>{var M,B,J,oe,ue,ae;return{...A,deal_id:I.id,company_id:((M=I.company)==null?void 0:M.id)||"",contact_id:((B=I.contact)==null?void 0:B.id)||"",customer_company:((J=I.company)==null?void 0:J.name)||"",customer_name:k,customer_street:((oe=I.company)==null?void 0:oe.address)||"",customer_city:((ue=I.company)==null?void 0:ue.city)||"",invoice_number:Il(r,(ae=I.company)==null?void 0:ae.name,k)}})})},[i,r,o]),Mt(()=>{a&&Promise.all([Le.from("invoices").select("*").eq("id",a).single(),Le.from("invoice_items").select("*").eq("invoice_id",a).order("position")]).then(([{data:I},{data:k}])=>{I&&(x(A=>({...A,type:"invoice",invoice_number:Il("invoice",I.customer_company,I.customer_name),company_id:I.company_id||"",contact_id:I.contact_id||"",deal_id:I.deal_id||"",customer_company:I.customer_company||"",customer_name:I.customer_name||"",customer_street:I.customer_street||"",customer_zip:I.customer_zip||"",customer_city:I.customer_city||"",customer_number:I.customer_number||"",discount_percent:I.discount_percent||0,vat_rate:I.vat_rate||19,payment_terms:I.payment_terms||A.payment_terms,closing_message:I.closing_message||A.closing_message,intro_text:I.intro_text||"",notes:I.notes||""})),k&&k.length>0&&P(k.map(A=>({description:A.description,sub_description:A.sub_description||"",quantity:A.quantity,unit_price:A.unit_price}))))})},[a]),Mt(()=>{!o||d||!l||(x({type:l.type,invoice_number:l.invoice_number,invoice_date:l.invoice_date,due_date:l.due_date||"",company_id:l.company_id||"",contact_id:l.contact_id||"",deal_id:l.deal_id||"",customer_company:l.customer_company||"",customer_name:l.customer_name||"",customer_street:l.customer_street||"",customer_zip:l.customer_zip||"",customer_city:l.customer_city||"",customer_number:l.customer_number||"",discount_percent:l.discount_percent||0,vat_rate:l.vat_rate||19,payment_terms:l.payment_terms||"",closing_message:l.closing_message||"",intro_text:l.intro_text||"",notes:l.notes||""}),c.length>0&&P(c.map(I=>({description:I.description,sub_description:I.sub_description||"",quantity:I.quantity,unit_price:I.unit_price}))))},[o,d,l,c]),Mt(()=>{o||a||!S.customer_name&&!S.customer_company||x(I=>({...I,invoice_number:Il(I.type,I.customer_company,I.customer_name)}))},[S.type,S.customer_name,S.customer_company,o,a]);function L(I){const k=b.find(A=>A.id===I);x(A=>({...A,company_id:I,customer_company:(k==null?void 0:k.name)||A.customer_company,customer_street:(k==null?void 0:k.address)||A.customer_street,customer_city:(k==null?void 0:k.city)||A.customer_city}))}function U(I){const k=y.find(M=>M.id===I);if(!k)return;const A=`${k.first_name||""} ${k.last_name||""}`.trim();x(M=>({...M,contact_id:I,customer_name:A,company_id:k.company_id||M.company_id})),k.company_id&&!S.company_id&&L(k.company_id)}const ee=n2(C,S.discount_percent,S.vat_rate),V=S.type==="quote",X=o?`${V?"Angebot":"Rechnung"} bearbeiten`:a?"Rechnung aus Angebot erstellen":`Neue${V?"s Angebot":" Rechnung"} erstellen`;async function D(I){var k;if(I.preventDefault(),C.length===0||!C.some(A=>A.description)){t.error("Mindestens eine Position erforderlich");return}g(!0);try{const A={...S,company_id:S.company_id||null,contact_id:S.contact_id||null,deal_id:S.deal_id||null,subtotal:ee.subtotal,net_amount:ee.net_amount,vat_amount:ee.vat_amount,total_amount:ee.total_amount,due_date:S.due_date||null};let M;o?(M=await i2(o,A,C),M.error||(t.success("Gespeichert"),ze(`/crm/invoices/${o}`))):(a&&(A.converted_from_quote_id=a),M=await r2(A,C),!M.error&&((k=M.data)!=null&&k.id)?(t.success(`${V?"Angebot":"Rechnung"} erstellt`),ze(`/crm/invoices/${M.data.id}`)):M.error||t.error("Rechnung konnte nicht erstellt werden")),M.error&&t.error("Fehler: "+(M.error.message||JSON.stringify(M.error)))}catch(A){console.error("Invoice submit error:",A),t.error("Unerwarteter Fehler: "+A.message)}g(!1)}return o&&d?s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Laden..."})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]}):s(At,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/invoices"),children:""}),s("h1",{class:"page-title",children:X})]})}),s("div",{class:"page-body",children:s("form",{onSubmit:D,style:"max-width:900px",children:[s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Dokument"})}),s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Typ"}),s("select",{value:S.type,onChange:I=>x({...S,type:I.target.value}),disabled:!!o||!!a,children:[s("option",{value:"invoice",children:"Rechnung"}),s("option",{value:"quote",children:"Angebot"})]})]}),s("div",{class:"form-group",children:[s("label",{children:V?"Angebotsnr.":"Rechnungsnr."}),s("input",{value:S.invoice_number,onInput:I=>x({...S,invoice_number:I.target.value}),required:!0})]}),s("div",{class:"form-group",children:[s("label",{children:"Datum"}),s("input",{type:"date",value:S.invoice_date,onInput:I=>x({...S,invoice_date:I.target.value}),required:!0})]}),s("div",{class:"form-group",children:[s("label",{children:V?"Gueltig bis":"Faellig am"}),s("input",{type:"date",value:S.due_date,onInput:I=>x({...S,due_date:I.target.value})})]})]})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Kunde"})}),s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Firma (CRM)"}),s("select",{value:S.company_id,onChange:I=>L(I.target.value),children:[s("option",{value:"",children:" Firma waehlen "}),b.map(I=>s("option",{value:I.id,children:I.name},I.id))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Kontakt (CRM)"}),s("select",{value:S.contact_id,onChange:I=>U(I.target.value),children:[s("option",{value:"",children:" Kontakt waehlen "}),y.map(I=>s("option",{value:I.id,children:`${I.first_name||""} ${I.last_name||""}`.trim()||I.email},I.id))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Firmenname (Rechnung)"}),s("input",{value:S.customer_company,onInput:I=>x({...S,customer_company:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Ansprechpartner"}),s("input",{value:S.customer_name,onInput:I=>x({...S,customer_name:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Strasse"}),s("input",{value:S.customer_street,onInput:I=>x({...S,customer_street:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"PLZ"}),s("input",{value:S.customer_zip,onInput:I=>x({...S,customer_zip:I.target.value}),style:"max-width:120px"})]}),s("div",{class:"form-group",children:[s("label",{children:"Stadt"}),s("input",{value:S.customer_city,onInput:I=>x({...S,customer_city:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Kundennummer"}),s("input",{value:S.customer_number,onInput:I=>x({...S,customer_number:I.target.value}),placeholder:"Optional"})]})]})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Positionen"})}),s(lb,{items:C,onChange:P})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Betraege"})}),s("div",{style:"display:flex;gap:1.5rem;align-items:flex-start",children:[s("div",{style:"flex:1",children:[s("div",{class:"form-group",style:"max-width:200px",children:[s("label",{children:"Rabatt (%)"}),s("input",{type:"number",step:"0.01",min:"0",max:"100",value:S.discount_percent,onInput:I=>x({...S,discount_percent:I.target.value}),style:"text-align:right"})]}),s("div",{class:"form-group",style:"max-width:200px",children:[s("label",{children:"MwSt. (%)"}),s("input",{type:"number",step:"0.01",min:"0",value:S.vat_rate,onInput:I=>x({...S,vat_rate:I.target.value}),style:"text-align:right"})]})]}),s("div",{class:"invoice-totals",children:[s("div",{class:"invoice-totals-row",children:[s("span",{children:"Zwischensumme"}),s("span",{children:je(ee.subtotal)})]}),parseFloat(S.discount_percent)>0&&s("div",{class:"invoice-totals-row",children:[s("span",{children:["Rabatt (-",S.discount_percent,"%)"]}),s("span",{children:["-",je(ee.discount_amount)]})]}),s("div",{class:"invoice-totals-row",children:[s("span",{children:"Nettobetrag"}),s("span",{children:je(ee.net_amount)})]}),s("div",{class:"invoice-totals-row",children:[s("span",{children:[S.vat_rate,"% MwSt."]}),s("span",{children:je(ee.vat_amount)})]}),s("div",{class:"invoice-totals-row",style:"font-weight:700;font-size:1.1rem;border-top:2px solid var(--border);padding-top:0.5rem",children:[s("span",{children:"Gesamtbetrag"}),s("span",{children:je(ee.total_amount)})]})]})]})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Texte"})}),s("div",{class:"form-group",children:[s("label",{children:"Einleitungstext"}),s("textarea",{value:S.intro_text,onInput:I=>x({...S,intro_text:I.target.value}),rows:2,placeholder:V?"Angebots-Einleitung...":"Rechnungs-Einleitung..."})]}),s("div",{class:"form-group",children:[s("label",{children:"Zahlungsbedingungen"}),s("textarea",{value:S.payment_terms,onInput:I=>x({...S,payment_terms:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Schlussnachricht"}),s("textarea",{value:S.closing_message,onInput:I=>x({...S,closing_message:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Interne Notizen"}),s("textarea",{value:S.notes,onInput:I=>x({...S,notes:I.target.value}),placeholder:"Nur intern sichtbar"})]})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>ze("/crm/invoices"),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",disabled:h,children:h?"Speichern...":o?"Speichern":"Erstellen"})]})]})})]})}const ub="modulepreload",db=function(t){return"/crm/"+t},ff={},iu=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let o=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=o(n.map(d=>{if(d=db(d),d in ff)return;ff[d]=!0;const h=d.endsWith(".css"),g=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const b=document.createElement("link");if(b.rel=h?"stylesheet":ub,h||(b.as="script"),b.crossOrigin="",b.href=d,c&&b.setAttribute("nonce",c),document.head.appendChild(b),h)return new Promise((p,y)=>{b.addEventListener("load",p),b.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})};function Ht(t){"@babel/helpers - typeof";return Ht=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ht(t)}var ti=Uint8Array,Cr=Uint16Array,Ad=Int32Array,kd=new ti([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Nd=new ti([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),pf=new ti([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),xm=function(t,e){for(var n=new Cr(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var i=new Ad(n[30]),r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)i[a]=a-n[r]<<5|r;return{b:n,r:i}},Sm=xm(kd,2),hb=Sm.b,Xu=Sm.r;hb[28]=258,Xu[258]=28;var fb=xm(Nd,0),mf=fb.r,Zu=new Cr(32768);for(var nn=0;nn<32768;++nn){var ra=(nn&43690)>>1|(nn&21845)<<1;ra=(ra&52428)>>2|(ra&13107)<<2,ra=(ra&61680)>>4|(ra&3855)<<4,Zu[nn]=((ra&65280)>>8|(ra&255)<<8)>>1}var mo=(function(t,e,n){for(var r=t.length,i=0,a=new Cr(e);i<r;++i)t[i]&&++a[t[i]-1];var o=new Cr(e);for(i=1;i<e;++i)o[i]=o[i-1]+a[i-1]<<1;var l;if(n){l=new Cr(1<<e);var c=15-e;for(i=0;i<r;++i)if(t[i])for(var d=i<<4|t[i],h=e-t[i],g=o[t[i]-1]++<<h,b=g|(1<<h)-1;g<=b;++g)l[Zu[g]>>c]=d}else for(l=new Cr(r),i=0;i<r;++i)t[i]&&(l[i]=Zu[o[t[i]-1]++]>>15-t[i]);return l}),Ua=new ti(288);for(var nn=0;nn<144;++nn)Ua[nn]=8;for(var nn=144;nn<256;++nn)Ua[nn]=9;for(var nn=256;nn<280;++nn)Ua[nn]=7;for(var nn=280;nn<288;++nn)Ua[nn]=8;var Kl=new ti(32);for(var nn=0;nn<32;++nn)Kl[nn]=5;var pb=mo(Ua,9,0),mb=mo(Kl,5,0),Am=function(t){return(t+7)/8|0},gb=function(t,e,n){return(n==null||n>t.length)&&(n=t.length),new ti(t.subarray(e,n))},Fi=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8},ao=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8,t[r+2]|=n>>16},au=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var i=n.length,a=n.slice();if(!i)return{t:Nm,l:0};if(i==1){var o=new ti(n[0].s+1);return o[n[0].s]=1,{t:o,l:1}}n.sort(function(U,ee){return U.f-ee.f}),n.push({s:-1,f:25001});var l=n[0],c=n[1],d=0,h=1,g=2;for(n[0]={s:-1,f:l.f+c.f,l,r:c};h!=i-1;)l=n[n[d].f<n[g].f?d++:g++],c=n[d!=h&&n[d].f<n[g].f?d++:g++],n[h++]={s:-1,f:l.f+c.f,l,r:c};for(var b=a[0].s,r=1;r<i;++r)a[r].s>b&&(b=a[r].s);var p=new Cr(b+1),y=Qu(n[h-1],p,0);if(y>e){var r=0,w=0,S=y-e,x=1<<S;for(a.sort(function(ee,V){return p[V.s]-p[ee.s]||ee.f-V.f});r<i;++r){var C=a[r].s;if(p[C]>e)w+=x-(1<<y-p[C]),p[C]=e;else break}for(w>>=S;w>0;){var P=a[r].s;p[P]<e?w-=1<<e-p[P]++-1:++r}for(;r>=0&&w;--r){var L=a[r].s;p[L]==e&&(--p[L],++w)}y=e}return{t:new ti(p),l:y}},Qu=function(t,e,n){return t.s==-1?Math.max(Qu(t.l,e,n+1),Qu(t.r,e,n+1)):e[t.s]=n},gf=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new Cr(++e),r=0,i=t[0],a=1,o=function(c){n[r++]=c},l=1;l<=e;++l)if(t[l]==i&&l!=e)++a;else{if(!i&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(i),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(i);a=1,i=t[l]}return{c:n.subarray(0,r),n:e}},so=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},km=function(t,e,n){var r=n.length,i=Am(e+2);t[i]=r&255,t[i+1]=r>>8,t[i+2]=t[i]^255,t[i+3]=t[i+1]^255;for(var a=0;a<r;++a)t[i+a+4]=n[a];return(i+4+r)*8},vf=function(t,e,n,r,i,a,o,l,c,d,h){Fi(e,h++,n),++i[256];for(var g=au(i,15),b=g.t,p=g.l,y=au(a,15),w=y.t,S=y.l,x=gf(b),C=x.c,P=x.n,L=gf(w),U=L.c,ee=L.n,V=new Cr(19),X=0;X<C.length;++X)++V[C[X]&31];for(var X=0;X<U.length;++X)++V[U[X]&31];for(var D=au(V,7),I=D.t,k=D.l,A=19;A>4&&!I[pf[A-1]];--A);var M=d+5<<3,B=so(i,Ua)+so(a,Kl)+o,J=so(i,b)+so(a,w)+o+14+3*A+so(V,I)+2*V[16]+3*V[17]+7*V[18];if(c>=0&&M<=B&&M<=J)return km(e,h,t.subarray(c,c+d));var oe,ue,ae,fe;if(Fi(e,h,1+(J<B)),h+=2,J<B){oe=mo(b,p,0),ue=b,ae=mo(w,S,0),fe=w;var ke=mo(I,k,0);Fi(e,h,P-257),Fi(e,h+5,ee-1),Fi(e,h+10,A-4),h+=14;for(var X=0;X<A;++X)Fi(e,h+3*X,I[pf[X]]);h+=3*A;for(var pe=[C,U],O=0;O<2;++O)for(var q=pe[O],X=0;X<q.length;++X){var K=q[X]&31;Fi(e,h,ke[K]),h+=I[K],K>15&&(Fi(e,h,q[X]>>5&127),h+=q[X]>>12)}}else oe=pb,ue=Ua,ae=mb,fe=Kl;for(var X=0;X<l;++X){var Y=r[X];if(Y>255){var K=Y>>18&31;ao(e,h,oe[K+257]),h+=ue[K+257],K>7&&(Fi(e,h,Y>>23&31),h+=kd[K]);var Q=Y&31;ao(e,h,ae[Q]),h+=fe[Q],Q>3&&(ao(e,h,Y>>5&8191),h+=Nd[Q])}else ao(e,h,oe[Y]),h+=ue[Y]}return ao(e,h,oe[256]),h+ue[256]},vb=new Ad([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Nm=new ti(0),bb=function(t,e,n,r,i,a){var o=a.z||t.length,l=new ti(r+o+5*(1+Math.ceil(o/7e3))+i),c=l.subarray(r,l.length-i),d=a.l,h=(a.r||0)&7;if(e){h&&(c[0]=a.r>>3);for(var g=vb[e-1],b=g>>13,p=g&8191,y=(1<<n)-1,w=a.p||new Cr(32768),S=a.h||new Cr(y+1),x=Math.ceil(n/3),C=2*x,P=function(Me){return(t[Me]^t[Me+1]<<x^t[Me+2]<<C)&y},L=new Ad(25e3),U=new Cr(288),ee=new Cr(32),V=0,X=0,D=a.i||0,I=0,k=a.w||0,A=0;D+2<o;++D){var M=P(D),B=D&32767,J=S[M];if(w[B]=J,S[M]=B,k<=D){var oe=o-D;if((V>7e3||I>24576)&&(oe>423||!d)){h=vf(t,c,0,L,U,ee,X,I,A,D-A,h),I=V=X=0,A=D;for(var ue=0;ue<286;++ue)U[ue]=0;for(var ue=0;ue<30;++ue)ee[ue]=0}var ae=2,fe=0,ke=p,pe=B-J&32767;if(oe>2&&M==P(D-pe))for(var O=Math.min(b,oe)-1,q=Math.min(32767,D),K=Math.min(258,oe);pe<=q&&--ke&&B!=J;){if(t[D+ae]==t[D+ae-pe]){for(var Y=0;Y<K&&t[D+Y]==t[D+Y-pe];++Y);if(Y>ae){if(ae=Y,fe=pe,Y>O)break;for(var Q=Math.min(pe,Y-2),z=0,ue=0;ue<Q;++ue){var re=D-pe+ue&32767,ce=w[re],ge=re-ce&32767;ge>z&&(z=ge,J=re)}}}B=J,J=w[B],pe+=B-J&32767}if(fe){L[I++]=268435456|Xu[ae]<<18|mf[fe];var Ae=Xu[ae]&31,Pe=mf[fe]&31;X+=kd[Ae]+Nd[Pe],++U[257+Ae],++ee[Pe],k=D+ae,++V}else L[I++]=t[D],++U[t[D]]}}for(D=Math.max(D,k);D<o;++D)L[I++]=t[D],++U[t[D]];h=vf(t,c,d,L,U,ee,X,I,A,D-A,h),d||(a.r=h&7|c[h/8|0]<<3,h-=7,a.h=S,a.p=w,a.i=D,a.w=k)}else{for(var D=a.w||0;D<o+d;D+=65535){var Te=D+65535;Te>=o&&(c[h/8|0]=d,Te=o),h=km(c,h+1,t.subarray(D,Te))}a.i=o}return gb(l,0,r+Am(h)+i)},Em=function(){var t=1,e=0;return{p:function(n){for(var r=t,i=e,a=n.length|0,o=0;o!=a;){for(var l=Math.min(o+2655,a);o<l;++o)i+=r+=n[o];r=(r&65535)+15*(r>>16),i=(i&65535)+15*(i>>16)}t=r,e=i},d:function(){return t%=65521,e%=65521,(t&255)<<24|(t&65280)<<8|(e&255)<<8|e>>8}}},yb=function(t,e,n,r,i){if(!i&&(i={l:1},e.dictionary)){var a=e.dictionary.subarray(-32768),o=new ti(a.length+t.length);o.set(a),o.set(t,a.length),t=o,i.w=a.length}return bb(t,e.level==null?6:e.level,e.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,n,r,i)},Lm=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},_b=function(t,e){var n=e.level,r=n==0?0:n<6?1:n==9?3:2;if(t[0]=120,t[1]=r<<6|(e.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var i=Em();i.p(e.dictionary),Lm(t,2,i.d())}};function ed(t,e){e||(e={});var n=Em();n.p(t);var r=yb(t,e,e.dictionary?6:2,4);return _b(r,e),Lm(r,r.length-4,n.d()),r}var wb=typeof TextDecoder<"u"&&new TextDecoder,xb=0;try{wb.decode(Nm,{stream:!0}),xb=1}catch{}function Sb(t){if(Array.isArray(t))return t}function Ab(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,i,a,o,l=[],c=!0,d=!1;try{if(a=(n=n.call(t)).next,e!==0)for(;!(c=(r=a.call(n)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(h){d=!0,i=h}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(d)throw i}}return l}}function bf(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function kb(t,e){if(t){if(typeof t=="string")return bf(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bf(t,e):void 0}}function Nb(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yf(t,e){return Sb(t)||Ab(t,e)||kb(t,e)||Nb()}function _f(t,e="utf8"){return new TextDecoder(e).decode(t)}const Eb=new TextEncoder;function Lb(t){return Eb.encode(t)}const Cb=1024*8,Tb=(()=>{const t=new Uint8Array(4),e=new Uint32Array(t.buffer);return!((e[0]=1)&t[0])})(),su={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Ed{constructor(e=Cb,n={}){zt(this,"buffer");zt(this,"byteLength");zt(this,"byteOffset");zt(this,"length");zt(this,"offset");zt(this,"lastWrittenByte");zt(this,"littleEndian");zt(this,"_data");zt(this,"_mark");zt(this,"_marks");let r=!1;typeof e=="number"?e=new ArrayBuffer(e):(r=!0,this.lastWrittenByte=e.byteLength);const i=n.offset?n.offset>>>0:0,a=e.byteLength-i;let o=i;(ArrayBuffer.isView(e)||e instanceof Ed)&&(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+i),e=e.buffer),r?this.lastWrittenByte=a:this.lastWrittenByte=0,this.buffer=e,this.length=a,this.byteLength=a,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,a),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const r=(this.offset+e)*2,i=new Uint8Array(r);i.set(new Uint8Array(this.buffer)),this.buffer=i.buffer,this.length=r,this.byteLength=r,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,n){const r=su[n].BYTES_PER_ELEMENT*e,i=this.byteOffset+this.offset,a=this.buffer.slice(i,i+r);if(this.littleEndian===Tb&&n!=="uint8"&&n!=="int8"){const l=new Uint8Array(this.buffer.slice(i,i+r));l.reverse();const c=new su[n](l.buffer);return this.offset+=r,c.reverse(),c}const o=new su[n](a);return this.offset+=r,o}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let n="";for(let r=0;r<e;r++)n+=this.readChar();return n}readUtf8(e=1){return _f(this.readBytes(e))}decodeText(e=1,n="utf8"){return _f(this.readBytes(e),n)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let n=0;n<e.length;n++)this._data.setUint8(this.offset++,e[n]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let n=0;n<e.length;n++)this.writeUint8(e.charCodeAt(n));return this}writeUtf8(e){return this.writeBytes(Lb(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function Ns(t){let e=t.length;for(;--e>=0;)t[e]=0}const Ib=3,Pb=258,Cm=29,Ob=256,Rb=Ob+1+Cm,Tm=30,Fb=512,Db=new Array((Rb+2)*2);Ns(Db);const jb=new Array(Tm*2);Ns(jb);const Bb=new Array(Fb);Ns(Bb);const Mb=new Array(Pb-Ib+1);Ns(Mb);const Ub=new Array(Cm);Ns(Ub);const $b=new Array(Tm);Ns($b);const qb=(t,e,n,r)=>{let i=t&65535|0,a=t>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+e[r++]|0,a=a+i|0;while(--o);i%=65521,a%=65521}return i|a<<16|0};var td=qb;const zb=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e},Hb=new Uint32Array(zb()),Wb=(t,e,n,r)=>{const i=Hb,a=r+n;t^=-1;for(let o=r;o<a;o++)t=t>>>8^i[(t^e[o])&255];return t^-1};var hi=Wb,nd={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Im={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const Gb=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Vb=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)Gb(n,r)&&(t[r]=n[r])}}return t},Kb=t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,a=t.length;r<a;r++){let o=t[r];n.set(o,i),i+=o.length}return n},Pm={assign:Vb,flattenChunks:Kb};let Om=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Om=!1}const No=new Uint8Array(256);for(let t=0;t<256;t++)No[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;No[254]=No[254]=1;var Jb=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,i,a,o=t.length,l=0;for(i=0;i<o;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(l),a=0,i=0;a<l;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|n&63):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|n&63):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|n&63);return e};const Yb=(t,e)=>{if(e<65534&&t.subarray&&Om)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n};var Xb=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,i;const a=new Array(n*2);for(i=0,r=0;r<n;){let o=t[r++];if(o<128){a[i++]=o;continue}let l=No[o];if(l>4){a[i++]=65533,r+=l-1;continue}for(o&=l===2?31:l===3?15:7;l>1&&r<n;)o=o<<6|t[r++]&63,l--;if(l>1){a[i++]=65533;continue}o<65536?a[i++]=o:(o-=65536,a[i++]=55296|o>>10&1023,a[i++]=56320|o&1023)}return Yb(a,i)},Zb=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(t[n]&192)===128;)n--;return n<0||n===0?e:n+No[t[n]]>e?n:e},rd={string2buf:Jb,buf2string:Xb,utf8border:Zb};function Qb(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var e5=Qb;const wl=16209,t5=16191;var n5=function(e,n){let r,i,a,o,l,c,d,h,g,b,p,y,w,S,x,C,P,L,U,ee,V,X,D,I;const k=e.state;r=e.next_in,D=e.input,i=r+(e.avail_in-5),a=e.next_out,I=e.output,o=a-(n-e.avail_out),l=a+(e.avail_out-257),c=k.dmax,d=k.wsize,h=k.whave,g=k.wnext,b=k.window,p=k.hold,y=k.bits,w=k.lencode,S=k.distcode,x=(1<<k.lenbits)-1,C=(1<<k.distbits)-1;e:do{y<15&&(p+=D[r++]<<y,y+=8,p+=D[r++]<<y,y+=8),P=w[p&x];t:for(;;){if(L=P>>>24,p>>>=L,y-=L,L=P>>>16&255,L===0)I[a++]=P&65535;else if(L&16){U=P&65535,L&=15,L&&(y<L&&(p+=D[r++]<<y,y+=8),U+=p&(1<<L)-1,p>>>=L,y-=L),y<15&&(p+=D[r++]<<y,y+=8,p+=D[r++]<<y,y+=8),P=S[p&C];n:for(;;){if(L=P>>>24,p>>>=L,y-=L,L=P>>>16&255,L&16){if(ee=P&65535,L&=15,y<L&&(p+=D[r++]<<y,y+=8,y<L&&(p+=D[r++]<<y,y+=8)),ee+=p&(1<<L)-1,ee>c){e.msg="invalid distance too far back",k.mode=wl;break e}if(p>>>=L,y-=L,L=a-o,ee>L){if(L=ee-L,L>h&&k.sane){e.msg="invalid distance too far back",k.mode=wl;break e}if(V=0,X=b,g===0){if(V+=d-L,L<U){U-=L;do I[a++]=b[V++];while(--L);V=a-ee,X=I}}else if(g<L){if(V+=d+g-L,L-=g,L<U){U-=L;do I[a++]=b[V++];while(--L);if(V=0,g<U){L=g,U-=L;do I[a++]=b[V++];while(--L);V=a-ee,X=I}}}else if(V+=g-L,L<U){U-=L;do I[a++]=b[V++];while(--L);V=a-ee,X=I}for(;U>2;)I[a++]=X[V++],I[a++]=X[V++],I[a++]=X[V++],U-=3;U&&(I[a++]=X[V++],U>1&&(I[a++]=X[V++]))}else{V=a-ee;do I[a++]=I[V++],I[a++]=I[V++],I[a++]=I[V++],U-=3;while(U>2);U&&(I[a++]=I[V++],U>1&&(I[a++]=I[V++]))}}else if((L&64)===0){P=S[(P&65535)+(p&(1<<L)-1)];continue n}else{e.msg="invalid distance code",k.mode=wl;break e}break}}else if((L&64)===0){P=w[(P&65535)+(p&(1<<L)-1)];continue t}else if(L&32){k.mode=t5;break e}else{e.msg="invalid literal/length code",k.mode=wl;break e}break}}while(r<i&&a<l);U=y>>3,r-=U,y-=U<<3,p&=(1<<y)-1,e.next_in=r,e.next_out=a,e.avail_in=r<i?5+(i-r):5-(r-i),e.avail_out=a<l?257+(l-a):257-(a-l),k.hold=p,k.bits=y};const os=15,wf=852,xf=592,Sf=0,ou=1,Af=2,r5=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),i5=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),a5=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),s5=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),o5=(t,e,n,r,i,a,o,l)=>{const c=l.bits;let d=0,h=0,g=0,b=0,p=0,y=0,w=0,S=0,x=0,C=0,P,L,U,ee,V,X=null,D;const I=new Uint16Array(os+1),k=new Uint16Array(os+1);let A=null,M,B,J;for(d=0;d<=os;d++)I[d]=0;for(h=0;h<r;h++)I[e[n+h]]++;for(p=c,b=os;b>=1&&I[b]===0;b--);if(p>b&&(p=b),b===0)return i[a++]=1<<24|64<<16|0,i[a++]=1<<24|64<<16|0,l.bits=1,0;for(g=1;g<b&&I[g]===0;g++);for(p<g&&(p=g),S=1,d=1;d<=os;d++)if(S<<=1,S-=I[d],S<0)return-1;if(S>0&&(t===Sf||b!==1))return-1;for(k[1]=0,d=1;d<os;d++)k[d+1]=k[d]+I[d];for(h=0;h<r;h++)e[n+h]!==0&&(o[k[e[n+h]]++]=h);if(t===Sf?(X=A=o,D=20):t===ou?(X=r5,A=i5,D=257):(X=a5,A=s5,D=0),C=0,h=0,d=g,V=a,y=p,w=0,U=-1,x=1<<p,ee=x-1,t===ou&&x>wf||t===Af&&x>xf)return 1;for(;;){M=d-w,o[h]+1<D?(B=0,J=o[h]):o[h]>=D?(B=A[o[h]-D],J=X[o[h]-D]):(B=96,J=0),P=1<<d-w,L=1<<y,g=L;do L-=P,i[V+(C>>w)+L]=M<<24|B<<16|J|0;while(L!==0);for(P=1<<d-1;C&P;)P>>=1;if(P!==0?(C&=P-1,C+=P):C=0,h++,--I[d]===0){if(d===b)break;d=e[n+o[h]]}if(d>p&&(C&ee)!==U){for(w===0&&(w=p),V+=g,y=d-w,S=1<<y;y+w<b&&(S-=I[y+w],!(S<=0));)y++,S<<=1;if(x+=1<<y,t===ou&&x>wf||t===Af&&x>xf)return 1;U=C&ee,i[U]=p<<24|y<<16|V-a|0}}return C!==0&&(i[V+C]=d-w<<24|64<<16|0),l.bits=p,0};var go=o5;const l5=0,Rm=1,Fm=2,{Z_FINISH:kf,Z_BLOCK:c5,Z_TREES:xl,Z_OK:$a,Z_STREAM_END:u5,Z_NEED_DICT:d5,Z_STREAM_ERROR:qr,Z_DATA_ERROR:Dm,Z_MEM_ERROR:jm,Z_BUF_ERROR:h5,Z_DEFLATED:Nf}=Im,cc=16180,Ef=16181,Lf=16182,Cf=16183,Tf=16184,If=16185,Pf=16186,Of=16187,Rf=16188,Ff=16189,Jl=16190,Di=16191,lu=16192,Df=16193,cu=16194,jf=16195,Bf=16196,Mf=16197,Uf=16198,Sl=16199,Al=16200,$f=16201,qf=16202,zf=16203,Hf=16204,Wf=16205,uu=16206,Gf=16207,Vf=16208,an=16209,Bm=16210,Mm=16211,f5=852,p5=592,m5=15,g5=m5,Kf=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function v5(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const za=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<cc||e.mode>Mm?1:0},Um=t=>{if(za(t))return qr;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=cc,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(f5),e.distcode=e.distdyn=new Int32Array(p5),e.sane=1,e.back=-1,$a},$m=t=>{if(za(t))return qr;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Um(t)},qm=(t,e)=>{let n;if(za(t))return qr;const r=t.state;return e<0?(n=0,e=-e):(n=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?qr:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,$m(t))},zm=(t,e)=>{if(!t)return qr;const n=new v5;t.state=n,n.strm=t,n.window=null,n.mode=cc;const r=qm(t,e);return r!==$a&&(t.state=null),r},b5=t=>zm(t,g5);let Jf=!0,du,hu;const y5=t=>{if(Jf){du=new Int32Array(512),hu=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(go(Rm,t.lens,0,288,du,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;go(Fm,t.lens,0,32,hu,0,t.work,{bits:5}),Jf=!1}t.lencode=du,t.lenbits=9,t.distcode=hu,t.distbits=5},Hm=(t,e,n,r)=>{let i;const a=t.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(e.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>r&&(i=r),a.window.set(e.subarray(n-r,n-r+i),a.wnext),r-=i,r?(a.window.set(e.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0},_5=(t,e)=>{let n,r,i,a,o,l,c,d,h,g,b,p,y,w,S=0,x,C,P,L,U,ee,V,X;const D=new Uint8Array(4);let I,k;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(za(t)||!t.output||!t.input&&t.avail_in!==0)return qr;n=t.state,n.mode===Di&&(n.mode=lu),o=t.next_out,i=t.output,c=t.avail_out,a=t.next_in,r=t.input,l=t.avail_in,d=n.hold,h=n.bits,g=l,b=c,X=$a;e:for(;;)switch(n.mode){case cc:if(n.wrap===0){n.mode=lu;break}for(;h<16;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}if(n.wrap&2&&d===35615){n.wbits===0&&(n.wbits=15),n.check=0,D[0]=d&255,D[1]=d>>>8&255,n.check=hi(n.check,D,2,0),d=0,h=0,n.mode=Ef;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((d&255)<<8)+(d>>8))%31){t.msg="incorrect header check",n.mode=an;break}if((d&15)!==Nf){t.msg="unknown compression method",n.mode=an;break}if(d>>>=4,h-=4,V=(d&15)+8,n.wbits===0&&(n.wbits=V),V>15||V>n.wbits){t.msg="invalid window size",n.mode=an;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=d&512?Ff:Di,d=0,h=0;break;case Ef:for(;h<16;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}if(n.flags=d,(n.flags&255)!==Nf){t.msg="unknown compression method",n.mode=an;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=an;break}n.head&&(n.head.text=d>>8&1),n.flags&512&&n.wrap&4&&(D[0]=d&255,D[1]=d>>>8&255,n.check=hi(n.check,D,2,0)),d=0,h=0,n.mode=Lf;case Lf:for(;h<32;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}n.head&&(n.head.time=d),n.flags&512&&n.wrap&4&&(D[0]=d&255,D[1]=d>>>8&255,D[2]=d>>>16&255,D[3]=d>>>24&255,n.check=hi(n.check,D,4,0)),d=0,h=0,n.mode=Cf;case Cf:for(;h<16;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}n.head&&(n.head.xflags=d&255,n.head.os=d>>8),n.flags&512&&n.wrap&4&&(D[0]=d&255,D[1]=d>>>8&255,n.check=hi(n.check,D,2,0)),d=0,h=0,n.mode=Tf;case Tf:if(n.flags&1024){for(;h<16;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}n.length=d,n.head&&(n.head.extra_len=d),n.flags&512&&n.wrap&4&&(D[0]=d&255,D[1]=d>>>8&255,n.check=hi(n.check,D,2,0)),d=0,h=0}else n.head&&(n.head.extra=null);n.mode=If;case If:if(n.flags&1024&&(p=n.length,p>l&&(p=l),p&&(n.head&&(V=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+p),V)),n.flags&512&&n.wrap&4&&(n.check=hi(n.check,r,p,a)),l-=p,a+=p,n.length-=p),n.length))break e;n.length=0,n.mode=Pf;case Pf:if(n.flags&2048){if(l===0)break e;p=0;do V=r[a+p++],n.head&&V&&n.length<65536&&(n.head.name+=String.fromCharCode(V));while(V&&p<l);if(n.flags&512&&n.wrap&4&&(n.check=hi(n.check,r,p,a)),l-=p,a+=p,V)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=Of;case Of:if(n.flags&4096){if(l===0)break e;p=0;do V=r[a+p++],n.head&&V&&n.length<65536&&(n.head.comment+=String.fromCharCode(V));while(V&&p<l);if(n.flags&512&&n.wrap&4&&(n.check=hi(n.check,r,p,a)),l-=p,a+=p,V)break e}else n.head&&(n.head.comment=null);n.mode=Rf;case Rf:if(n.flags&512){for(;h<16;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}if(n.wrap&4&&d!==(n.check&65535)){t.msg="header crc mismatch",n.mode=an;break}d=0,h=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Di;break;case Ff:for(;h<32;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}t.adler=n.check=Kf(d),d=0,h=0,n.mode=Jl;case Jl:if(n.havedict===0)return t.next_out=o,t.avail_out=c,t.next_in=a,t.avail_in=l,n.hold=d,n.bits=h,d5;t.adler=n.check=1,n.mode=Di;case Di:if(e===c5||e===xl)break e;case lu:if(n.last){d>>>=h&7,h-=h&7,n.mode=uu;break}for(;h<3;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}switch(n.last=d&1,d>>>=1,h-=1,d&3){case 0:n.mode=Df;break;case 1:if(y5(n),n.mode=Sl,e===xl){d>>>=2,h-=2;break e}break;case 2:n.mode=Bf;break;case 3:t.msg="invalid block type",n.mode=an}d>>>=2,h-=2;break;case Df:for(d>>>=h&7,h-=h&7;h<32;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}if((d&65535)!==(d>>>16^65535)){t.msg="invalid stored block lengths",n.mode=an;break}if(n.length=d&65535,d=0,h=0,n.mode=cu,e===xl)break e;case cu:n.mode=jf;case jf:if(p=n.length,p){if(p>l&&(p=l),p>c&&(p=c),p===0)break e;i.set(r.subarray(a,a+p),o),l-=p,a+=p,c-=p,o+=p,n.length-=p;break}n.mode=Di;break;case Bf:for(;h<14;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}if(n.nlen=(d&31)+257,d>>>=5,h-=5,n.ndist=(d&31)+1,d>>>=5,h-=5,n.ncode=(d&15)+4,d>>>=4,h-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=an;break}n.have=0,n.mode=Mf;case Mf:for(;n.have<n.ncode;){for(;h<3;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}n.lens[A[n.have++]]=d&7,d>>>=3,h-=3}for(;n.have<19;)n.lens[A[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,I={bits:n.lenbits},X=go(l5,n.lens,0,19,n.lencode,0,n.work,I),n.lenbits=I.bits,X){t.msg="invalid code lengths set",n.mode=an;break}n.have=0,n.mode=Uf;case Uf:for(;n.have<n.nlen+n.ndist;){for(;S=n.lencode[d&(1<<n.lenbits)-1],x=S>>>24,C=S>>>16&255,P=S&65535,!(x<=h);){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}if(P<16)d>>>=x,h-=x,n.lens[n.have++]=P;else{if(P===16){for(k=x+2;h<k;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}if(d>>>=x,h-=x,n.have===0){t.msg="invalid bit length repeat",n.mode=an;break}V=n.lens[n.have-1],p=3+(d&3),d>>>=2,h-=2}else if(P===17){for(k=x+3;h<k;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}d>>>=x,h-=x,V=0,p=3+(d&7),d>>>=3,h-=3}else{for(k=x+7;h<k;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}d>>>=x,h-=x,V=0,p=11+(d&127),d>>>=7,h-=7}if(n.have+p>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=an;break}for(;p--;)n.lens[n.have++]=V}}if(n.mode===an)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=an;break}if(n.lenbits=9,I={bits:n.lenbits},X=go(Rm,n.lens,0,n.nlen,n.lencode,0,n.work,I),n.lenbits=I.bits,X){t.msg="invalid literal/lengths set",n.mode=an;break}if(n.distbits=6,n.distcode=n.distdyn,I={bits:n.distbits},X=go(Fm,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,I),n.distbits=I.bits,X){t.msg="invalid distances set",n.mode=an;break}if(n.mode=Sl,e===xl)break e;case Sl:n.mode=Al;case Al:if(l>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=a,t.avail_in=l,n.hold=d,n.bits=h,n5(t,b),o=t.next_out,i=t.output,c=t.avail_out,a=t.next_in,r=t.input,l=t.avail_in,d=n.hold,h=n.bits,n.mode===Di&&(n.back=-1);break}for(n.back=0;S=n.lencode[d&(1<<n.lenbits)-1],x=S>>>24,C=S>>>16&255,P=S&65535,!(x<=h);){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}if(C&&(C&240)===0){for(L=x,U=C,ee=P;S=n.lencode[ee+((d&(1<<L+U)-1)>>L)],x=S>>>24,C=S>>>16&255,P=S&65535,!(L+x<=h);){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}d>>>=L,h-=L,n.back+=L}if(d>>>=x,h-=x,n.back+=x,n.length=P,C===0){n.mode=Wf;break}if(C&32){n.back=-1,n.mode=Di;break}if(C&64){t.msg="invalid literal/length code",n.mode=an;break}n.extra=C&15,n.mode=$f;case $f:if(n.extra){for(k=n.extra;h<k;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}n.length+=d&(1<<n.extra)-1,d>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=qf;case qf:for(;S=n.distcode[d&(1<<n.distbits)-1],x=S>>>24,C=S>>>16&255,P=S&65535,!(x<=h);){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}if((C&240)===0){for(L=x,U=C,ee=P;S=n.distcode[ee+((d&(1<<L+U)-1)>>L)],x=S>>>24,C=S>>>16&255,P=S&65535,!(L+x<=h);){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}d>>>=L,h-=L,n.back+=L}if(d>>>=x,h-=x,n.back+=x,C&64){t.msg="invalid distance code",n.mode=an;break}n.offset=P,n.extra=C&15,n.mode=zf;case zf:if(n.extra){for(k=n.extra;h<k;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}n.offset+=d&(1<<n.extra)-1,d>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=an;break}n.mode=Hf;case Hf:if(c===0)break e;if(p=b-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=an;break}p>n.wnext?(p-=n.wnext,y=n.wsize-p):y=n.wnext-p,p>n.length&&(p=n.length),w=n.window}else w=i,y=o-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do i[o++]=w[y++];while(--p);n.length===0&&(n.mode=Al);break;case Wf:if(c===0)break e;i[o++]=n.length,c--,n.mode=Al;break;case uu:if(n.wrap){for(;h<32;){if(l===0)break e;l--,d|=r[a++]<<h,h+=8}if(b-=c,t.total_out+=b,n.total+=b,n.wrap&4&&b&&(t.adler=n.check=n.flags?hi(n.check,i,b,o-b):td(n.check,i,b,o-b)),b=c,n.wrap&4&&(n.flags?d:Kf(d))!==n.check){t.msg="incorrect data check",n.mode=an;break}d=0,h=0}n.mode=Gf;case Gf:if(n.wrap&&n.flags){for(;h<32;){if(l===0)break e;l--,d+=r[a++]<<h,h+=8}if(n.wrap&4&&d!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=an;break}d=0,h=0}n.mode=Vf;case Vf:X=u5;break e;case an:X=Dm;break e;case Bm:return jm;case Mm:default:return qr}return t.next_out=o,t.avail_out=c,t.next_in=a,t.avail_in=l,n.hold=d,n.bits=h,(n.wsize||b!==t.avail_out&&n.mode<an&&(n.mode<uu||e!==kf))&&Hm(t,t.output,t.next_out,b-t.avail_out),g-=t.avail_in,b-=t.avail_out,t.total_in+=g,t.total_out+=b,n.total+=b,n.wrap&4&&b&&(t.adler=n.check=n.flags?hi(n.check,i,b,t.next_out-b):td(n.check,i,b,t.next_out-b)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Di?128:0)+(n.mode===Sl||n.mode===cu?256:0),(g===0&&b===0||e===kf)&&X===$a&&(X=h5),X},w5=t=>{if(za(t))return qr;let e=t.state;return e.window&&(e.window=null),t.state=null,$a},x5=(t,e)=>{if(za(t))return qr;const n=t.state;return(n.wrap&2)===0?qr:(n.head=e,e.done=!1,$a)},S5=(t,e)=>{const n=e.length;let r,i,a;return za(t)||(r=t.state,r.wrap!==0&&r.mode!==Jl)?qr:r.mode===Jl&&(i=1,i=td(i,e,n,0),i!==r.check)?Dm:(a=Hm(t,e,n,n),a?(r.mode=Bm,jm):(r.havedict=1,$a))};var A5=$m,k5=qm,N5=Um,E5=b5,L5=zm,C5=_5,T5=w5,I5=x5,P5=S5,O5="pako inflate (from Nodeca project)",Bi={inflateReset:A5,inflateReset2:k5,inflateResetKeep:N5,inflateInit:E5,inflateInit2:L5,inflate:C5,inflateEnd:T5,inflateGetHeader:I5,inflateSetDictionary:P5,inflateInfo:O5};function R5(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var F5=R5;const Wm=Object.prototype.toString,{Z_NO_FLUSH:D5,Z_FINISH:j5,Z_OK:Eo,Z_STREAM_END:fu,Z_NEED_DICT:pu,Z_STREAM_ERROR:B5,Z_DATA_ERROR:Yf,Z_MEM_ERROR:M5}=Im;function Io(t){this.options=Pm.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new e5,this.strm.avail_out=0;let n=Bi.inflateInit2(this.strm,e.windowBits);if(n!==Eo)throw new Error(nd[n]);if(this.header=new F5,Bi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=rd.string2buf(e.dictionary):Wm.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Bi.inflateSetDictionary(this.strm,e.dictionary),n!==Eo)))throw new Error(nd[n])}Io.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let a,o,l;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?j5:D5,Wm.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),a=Bi.inflate(n,o),a===pu&&i&&(a=Bi.inflateSetDictionary(n,i),a===Eo?a=Bi.inflate(n,o):a===Yf&&(a=pu));n.avail_in>0&&a===fu&&n.state.wrap>0&&t[n.next_in]!==0;)Bi.inflateReset(n),a=Bi.inflate(n,o);switch(a){case B5:case Yf:case pu:case M5:return this.onEnd(a),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||a===fu))if(this.options.to==="string"){let c=rd.utf8border(n.output,n.next_out),d=n.next_out-c,h=rd.buf2string(n.output,c);n.next_out=d,n.avail_out=r-d,d&&n.output.set(n.output.subarray(c,c+d),0),this.onData(h)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(a===Eo&&l===0)){if(a===fu)return a=Bi.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(n.avail_in===0)break}}return!0};Io.prototype.onData=function(t){this.chunks.push(t)};Io.prototype.onEnd=function(t){t===Eo&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Pm.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function U5(t,e){const n=new Io(e);if(n.push(t),n.err)throw n.msg||nd[n.err];return n.result}var $5=Io,q5=U5,z5={Inflate:$5,inflate:q5};const{Inflate:H5,inflate:W5}=z5;var Xf=H5,G5=W5;const Gm=[];for(let t=0;t<256;t++){let e=t;for(let n=0;n<8;n++)e&1?e=3988292384^e>>>1:e=e>>>1;Gm[t]=e}const Zf=4294967295;function V5(t,e,n){let r=t;for(let i=0;i<n;i++)r=Gm[(r^e[i])&255]^r>>>8;return r}function K5(t,e){return(V5(Zf,t,e)^Zf)>>>0}function Qf(t,e,n){const r=t.readUint32(),i=K5(new Uint8Array(t.buffer,t.byteOffset+t.offset-e-4,e),e);if(i!==r)throw new Error(`CRC mismatch for chunk ${n}. Expected ${r}, found ${i}`)}function Vm(t,e,n){for(let r=0;r<n;r++)e[r]=t[r]}function Km(t,e,n,r){let i=0;for(;i<r;i++)e[i]=t[i];for(;i<n;i++)e[i]=t[i]+e[i-r]&255}function Jm(t,e,n,r){let i=0;if(n.length===0)for(;i<r;i++)e[i]=t[i];else for(;i<r;i++)e[i]=t[i]+n[i]&255}function Ym(t,e,n,r,i){let a=0;if(n.length===0){for(;a<i;a++)e[a]=t[a];for(;a<r;a++)e[a]=t[a]+(e[a-i]>>1)&255}else{for(;a<i;a++)e[a]=t[a]+(n[a]>>1)&255;for(;a<r;a++)e[a]=t[a]+(e[a-i]+n[a]>>1)&255}}function Xm(t,e,n,r,i){let a=0;if(n.length===0){for(;a<i;a++)e[a]=t[a];for(;a<r;a++)e[a]=t[a]+e[a-i]&255}else{for(;a<i;a++)e[a]=t[a]+n[a]&255;for(;a<r;a++)e[a]=t[a]+J5(e[a-i],n[a],n[a-i])&255}}function J5(t,e,n){const r=t+e-n,i=Math.abs(r-t),a=Math.abs(r-e),o=Math.abs(r-n);return i<=a&&i<=o?t:a<=o?e:n}function Y5(t,e,n,r,i,a){switch(t){case 0:Vm(e,n,i);break;case 1:Km(e,n,i,a);break;case 2:Jm(e,n,r,i);break;case 3:Ym(e,n,r,i,a);break;case 4:Xm(e,n,r,i,a);break;default:throw new Error(`Unsupported filter: ${t}`)}}const X5=new Uint16Array([255]),Z5=new Uint8Array(X5.buffer),Q5=Z5[0]===255;function ey(t){const{data:e,width:n,height:r,channels:i,depth:a}=t,o=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],l=Math.ceil(a/8)*i,c=new Uint8Array(r*n*l);let d=0;for(let h=0;h<7;h++){const g=o[h],b=Math.ceil((n-g.x)/g.xStep),p=Math.ceil((r-g.y)/g.yStep);if(b<=0||p<=0)continue;const y=b*l,w=new Uint8Array(y);for(let S=0;S<p;S++){const x=e[d++],C=e.subarray(d,d+y);d+=y;const P=new Uint8Array(y);Y5(x,C,P,w,y,l),w.set(P);for(let L=0;L<b;L++){const U=g.x+L*g.xStep,ee=g.y+S*g.yStep;if(!(U>=n||ee>=r))for(let V=0;V<l;V++)c[(ee*n+U)*l+V]=P[L*l+V]}}}if(a===16){const h=new Uint16Array(c.buffer);if(Q5)for(let g=0;g<h.length;g++)h[g]=ty(h[g]);return h}else return c}function ty(t){return(t&255)<<8|t>>8&255}const ny=new Uint16Array([255]),ry=new Uint8Array(ny.buffer),iy=ry[0]===255,ay=new Uint8Array(0);function ep(t){const{data:e,width:n,height:r,channels:i,depth:a}=t,o=Math.ceil(a/8)*i,l=Math.ceil(a/8*i*n),c=new Uint8Array(r*l);let d=ay,h=0,g,b;for(let p=0;p<r;p++){switch(g=e.subarray(h+1,h+1+l),b=c.subarray(p*l,(p+1)*l),e[h]){case 0:Vm(g,b,l);break;case 1:Km(g,b,l,o);break;case 2:Jm(g,b,d,l);break;case 3:Ym(g,b,d,l,o);break;case 4:Xm(g,b,d,l,o);break;default:throw new Error(`Unsupported filter: ${e[h]}`)}d=b,h+=l+1}if(a===16){const p=new Uint16Array(c.buffer);if(iy)for(let y=0;y<p.length;y++)p[y]=sy(p[y]);return p}else return c}function sy(t){return(t&255)<<8|t>>8&255}const Ol=Uint8Array.of(137,80,78,71,13,10,26,10);function tp(t){if(!oy(t.readBytes(Ol.length)))throw new Error("wrong PNG signature")}function oy(t){if(t.length<Ol.length)return!1;for(let e=0;e<Ol.length;e++)if(t[e]!==Ol[e])return!1;return!0}const ly="tEXt",cy=0,Zm=new TextDecoder("latin1");function uy(t){if(hy(t),t.length===0||t.length>79)throw new Error("keyword length must be between 1 and 79")}const dy=/^[\u0000-\u00FF]*$/;function hy(t){if(!dy.test(t))throw new Error("invalid latin1 text")}function fy(t,e,n){const r=Qm(e);t[r]=py(e,n-r.length-1)}function Qm(t){for(t.mark();t.readByte()!==cy;);const e=t.offset;t.reset();const n=Zm.decode(t.readBytes(e-t.offset-1));return t.skip(1),uy(n),n}function py(t,e){return Zm.decode(t.readBytes(e))}const kr={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},mu={UNKNOWN:-1,DEFLATE:0},np={UNKNOWN:-1,ADAPTIVE:0},gu={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},kl={NONE:0,BACKGROUND:1,PREVIOUS:2},vu={SOURCE:0,OVER:1};class my extends Ed{constructor(n,r={}){super(n);zt(this,"_checkCrc");zt(this,"_inflator");zt(this,"_png");zt(this,"_apng");zt(this,"_end");zt(this,"_hasPalette");zt(this,"_palette");zt(this,"_hasTransparency");zt(this,"_transparency");zt(this,"_compressionMethod");zt(this,"_filterMethod");zt(this,"_interlaceMethod");zt(this,"_colorType");zt(this,"_isAnimated");zt(this,"_numberOfFrames");zt(this,"_numberOfPlays");zt(this,"_frames");zt(this,"_writingDataChunks");const{checkCrc:i=!1}=r;this._checkCrc=i,this._inflator=new Xf,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=mu.UNKNOWN,this._filterMethod=np.UNKNOWN,this._interlaceMethod=gu.UNKNOWN,this._colorType=kr.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(tp(this);!this._end;){const n=this.readUint32(),r=this.readChars(4);this.decodeChunk(n,r)}return this.decodeImage(),this._png}decodeApng(){for(tp(this);!this._end;){const n=this.readUint32(),r=this.readChars(4);this.decodeApngChunk(n,r)}return this.decodeApngImage(),this._apng}decodeChunk(n,r){const i=this.offset;switch(r){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(n);break;case"IDAT":this.decodeIDAT(n);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(n);break;case"iCCP":this.decodeiCCP(n);break;case ly:fy(this._png.text,this,n);break;case"pHYs":this.decodepHYs();break;default:this.skip(n);break}if(this.offset-i!==n)throw new Error(`Length mismatch while decoding chunk ${r}`);this._checkCrc?Qf(this,n+4,r):this.skip(4)}decodeApngChunk(n,r){const i=this.offset;switch(r!=="fdAT"&&r!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),r){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(n);break;default:this.decodeChunk(n,r),this.offset=i+n;break}if(this.offset-i!==n)throw new Error(`Length mismatch while decoding chunk ${r}`);this._checkCrc?Qf(this,n+4,r):this.skip(4)}decodeIHDR(){const n=this._png;n.width=this.readUint32(),n.height=this.readUint32(),n.depth=gy(this.readUint8());const r=this.readUint8();this._colorType=r;let i;switch(r){case kr.GREYSCALE:i=1;break;case kr.TRUECOLOUR:i=3;break;case kr.INDEXED_COLOUR:i=1;break;case kr.GREYSCALE_ALPHA:i=2;break;case kr.TRUECOLOUR_ALPHA:i=4;break;case kr.UNKNOWN:default:throw new Error(`Unknown color type: ${r}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==mu.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const n={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(n)}decodePLTE(n){if(n%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${n}`);const r=n/3;this._hasPalette=!0;const i=[];this._palette=i;for(let a=0;a<r;a++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(n){this._writingDataChunks=!0;const r=n,i=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,i,r)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(n)}decodeFDAT(n){this._writingDataChunks=!0;let r=n,i=this.offset+this.byteOffset;if(i+=4,r-=4,this._inflator.push(new Uint8Array(this.buffer,i,r)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(n)}decodetRNS(n){switch(this._colorType){case kr.GREYSCALE:case kr.TRUECOLOUR:{if(n%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${n}`);if(n/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${n/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(n/2);for(let r=0;r<n/2;r++)this._transparency[r]=this.readUint16();break}case kr.INDEXED_COLOUR:{if(n>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${n} vs ${this._palette.length})`);let r=0;for(;r<n;r++){const i=this.readByte();this._palette[r].push(i)}for(;r<this._palette.length;r++)this._palette[r].push(255);break}case kr.UNKNOWN:case kr.GREYSCALE_ALPHA:case kr.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(n){const r=Qm(this),i=this.readUint8();if(i!==mu.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${i}`);const a=this.readBytes(n-r.length-2);this._png.iccEmbeddedProfile={name:r,profile:G5(a)}}decodepHYs(){const n=this.readUint32(),r=this.readUint32(),i=this.readByte();this._png.resolution={x:n,y:r,unit:i}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let n=0;n<this._numberOfFrames;n++){const r={sequenceNumber:this._frames[n].sequenceNumber,delayNumber:this._frames[n].delayNumber,delayDenominator:this._frames[n].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},i=this._frames.at(n);if(i){if(i.data=ep({data:i.data,width:i.width,height:i.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),n===0||i.xOffset===0&&i.yOffset===0&&i.width===this._png.width&&i.height===this._png.height)r.data=i.data;else{const a=this._apng.frames.at(n-1);this.disposeFrame(i,a,r),this.addFrameDataToCanvas(r,i)}this._apng.frames.push(r)}}return this._apng}disposeFrame(n,r,i){switch(n.disposeOp){case kl.NONE:break;case kl.BACKGROUND:for(let a=0;a<this._png.height;a++)for(let o=0;o<this._png.width;o++){const l=(a*n.width+o)*this._png.channels;for(let c=0;c<this._png.channels;c++)i.data[l+c]=0}break;case kl.PREVIOUS:i.data.set(r.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(n,r){const i=1<<this._png.depth,a=(o,l)=>{const c=((o+r.yOffset)*this._png.width+r.xOffset+l)*this._png.channels,d=(o*r.width+l)*this._png.channels;return{index:c,frameIndex:d}};switch(r.blendOp){case vu.SOURCE:for(let o=0;o<r.height;o++)for(let l=0;l<r.width;l++){const{index:c,frameIndex:d}=a(o,l);for(let h=0;h<this._png.channels;h++)n.data[c+h]=r.data[d+h]}break;case vu.OVER:for(let o=0;o<r.height;o++)for(let l=0;l<r.width;l++){const{index:c,frameIndex:d}=a(o,l);for(let h=0;h<this._png.channels;h++){const g=r.data[d+this._png.channels-1]/i,b=h%(this._png.channels-1)===0?1:r.data[d+h],p=Math.floor(g*b+(1-g)*n.data[c+h]);n.data[c+h]+=p}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var r;if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const n=this._isAnimated?((r=this._frames)==null?void 0:r.at(0)).data:this._inflator.result;if(this._filterMethod!==np.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===gu.NO_INTERLACE)this._png.data=ep({data:n,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===gu.ADAM7)this._png.data=ey({data:n,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const n=this._inflator.result,r=this._frames.at(-1);r?r.data=n:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:kl.NONE,blendOp:vu.SOURCE,data:n}),this._inflator=new Xf,this._writingDataChunks=!1}}function gy(t){if(t!==1&&t!==2&&t!==4&&t!==8&&t!==16)throw new Error(`invalid bit depth: ${t}`);return t}var rp;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"})(rp||(rp={}));function vy(t,e){return new my(t,e).decode()}var ft=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function bu(){ft.console&&typeof ft.console.log=="function"&&ft.console.log.apply(ft.console,arguments)}var Kt={log:bu,warn:function(t){ft.console&&(typeof ft.console.warn=="function"?ft.console.warn.apply(ft.console,arguments):bu.call(null,arguments))},error:function(t){ft.console&&(typeof ft.console.error=="function"?ft.console.error.apply(ft.console,arguments):bu(t))}};function yu(t,e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){Ia(r.response,e,n)},r.onerror=function(){Kt.error("could not download file")},r.send()}function ip(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function Nl(t){try{t.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var Ia=ft.saveAs||((typeof window>"u"?"undefined":Ht(window))!=="object"||window!==ft?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(t,e,n){var r=ft.URL||ft.webkitURL,i=document.createElement("a");e=e||t.name||"download",i.download=e,i.rel="noopener",typeof t=="string"?(i.href=t,i.origin!==location.origin?ip(i.href)?yu(t,e,n):Nl(i,i.target="_blank"):Nl(i)):(i.href=r.createObjectURL(t),setTimeout(function(){r.revokeObjectURL(i.href)},4e4),setTimeout(function(){Nl(i)},0))}:"msSaveOrOpenBlob"in navigator?function(t,e,n){if(e=e||t.name||"download",typeof t=="string")if(ip(t))yu(t,e,n);else{var r=document.createElement("a");r.href=t,r.target="_blank",setTimeout(function(){Nl(r)})}else navigator.msSaveOrOpenBlob((function(i,a){return a===void 0?a={autoBom:!1}:Ht(a)!=="object"&&(Kt.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i})(t,n),e)}:function(t,e,n,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),typeof t=="string")return yu(t,e,n);var i=t.type==="application/octet-stream",a=/constructor/i.test(ft.HTMLElement)||ft.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent);if((o||i&&a)&&(typeof FileReader>"u"?"undefined":Ht(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var h=l.result;h=o?h:h.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=h:location=h,r=null},l.readAsDataURL(t)}else{var c=ft.URL||ft.webkitURL,d=c.createObjectURL(t);r?r.location=d:location.href=d,r=null,setTimeout(function(){c.revokeObjectURL(d)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function eg(t){var e;t=t||"",this.ok=!1,t.charAt(0)=="#"&&(t=t.substr(1,6)),t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[t=(t=t.replace(/ /g,"")).toLowerCase()]||t;for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],r=0;r<n.length;r++){var i=n[r].re,a=n[r].process,o=i.exec(t);o&&(e=a(o),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),c=this.g.toString(16),d=this.b.toString(16);return l.length==1&&(l="0"+l),c.length==1&&(c="0"+c),d.length==1&&(d="0"+d),"#"+l+c+d}}var Rl=ft.atob.bind(ft),ap=ft.btoa.bind(ft);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function _u(t,e){var n=t[0],r=t[1],i=t[2],a=t[3];n=Kn(n,r,i,a,e[0],7,-680876936),a=Kn(a,n,r,i,e[1],12,-389564586),i=Kn(i,a,n,r,e[2],17,606105819),r=Kn(r,i,a,n,e[3],22,-1044525330),n=Kn(n,r,i,a,e[4],7,-176418897),a=Kn(a,n,r,i,e[5],12,1200080426),i=Kn(i,a,n,r,e[6],17,-1473231341),r=Kn(r,i,a,n,e[7],22,-45705983),n=Kn(n,r,i,a,e[8],7,1770035416),a=Kn(a,n,r,i,e[9],12,-1958414417),i=Kn(i,a,n,r,e[10],17,-42063),r=Kn(r,i,a,n,e[11],22,-1990404162),n=Kn(n,r,i,a,e[12],7,1804603682),a=Kn(a,n,r,i,e[13],12,-40341101),i=Kn(i,a,n,r,e[14],17,-1502002290),n=Jn(n,r=Kn(r,i,a,n,e[15],22,1236535329),i,a,e[1],5,-165796510),a=Jn(a,n,r,i,e[6],9,-1069501632),i=Jn(i,a,n,r,e[11],14,643717713),r=Jn(r,i,a,n,e[0],20,-373897302),n=Jn(n,r,i,a,e[5],5,-701558691),a=Jn(a,n,r,i,e[10],9,38016083),i=Jn(i,a,n,r,e[15],14,-660478335),r=Jn(r,i,a,n,e[4],20,-405537848),n=Jn(n,r,i,a,e[9],5,568446438),a=Jn(a,n,r,i,e[14],9,-1019803690),i=Jn(i,a,n,r,e[3],14,-187363961),r=Jn(r,i,a,n,e[8],20,1163531501),n=Jn(n,r,i,a,e[13],5,-1444681467),a=Jn(a,n,r,i,e[2],9,-51403784),i=Jn(i,a,n,r,e[7],14,1735328473),n=Yn(n,r=Jn(r,i,a,n,e[12],20,-1926607734),i,a,e[5],4,-378558),a=Yn(a,n,r,i,e[8],11,-2022574463),i=Yn(i,a,n,r,e[11],16,1839030562),r=Yn(r,i,a,n,e[14],23,-35309556),n=Yn(n,r,i,a,e[1],4,-1530992060),a=Yn(a,n,r,i,e[4],11,1272893353),i=Yn(i,a,n,r,e[7],16,-155497632),r=Yn(r,i,a,n,e[10],23,-1094730640),n=Yn(n,r,i,a,e[13],4,681279174),a=Yn(a,n,r,i,e[0],11,-358537222),i=Yn(i,a,n,r,e[3],16,-722521979),r=Yn(r,i,a,n,e[6],23,76029189),n=Yn(n,r,i,a,e[9],4,-640364487),a=Yn(a,n,r,i,e[12],11,-421815835),i=Yn(i,a,n,r,e[15],16,530742520),n=Xn(n,r=Yn(r,i,a,n,e[2],23,-995338651),i,a,e[0],6,-198630844),a=Xn(a,n,r,i,e[7],10,1126891415),i=Xn(i,a,n,r,e[14],15,-1416354905),r=Xn(r,i,a,n,e[5],21,-57434055),n=Xn(n,r,i,a,e[12],6,1700485571),a=Xn(a,n,r,i,e[3],10,-1894986606),i=Xn(i,a,n,r,e[10],15,-1051523),r=Xn(r,i,a,n,e[1],21,-2054922799),n=Xn(n,r,i,a,e[8],6,1873313359),a=Xn(a,n,r,i,e[15],10,-30611744),i=Xn(i,a,n,r,e[6],15,-1560198380),r=Xn(r,i,a,n,e[13],21,1309151649),n=Xn(n,r,i,a,e[4],6,-145523070),a=Xn(a,n,r,i,e[11],10,-1120210379),i=Xn(i,a,n,r,e[2],15,718787259),r=Xn(r,i,a,n,e[9],21,-343485551),t[0]=ca(n,t[0]),t[1]=ca(r,t[1]),t[2]=ca(i,t[2]),t[3]=ca(a,t[3])}function uc(t,e,n,r,i,a){return e=ca(ca(e,t),ca(r,a)),ca(e<<i|e>>>32-i,n)}function Kn(t,e,n,r,i,a,o){return uc(e&n|~e&r,t,e,i,a,o)}function Jn(t,e,n,r,i,a,o){return uc(e&r|n&~r,t,e,i,a,o)}function Yn(t,e,n,r,i,a,o){return uc(e^n^r,t,e,i,a,o)}function Xn(t,e,n,r,i,a,o){return uc(n^(e|~r),t,e,i,a,o)}function tg(t){var e,n=t.length,r=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)_u(r,by(t.substring(e-64,e)));t=t.substring(e-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)i[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(i[e>>2]|=128<<(e%4<<3),e>55)for(_u(r,i),e=0;e<16;e++)i[e]=0;return i[14]=8*n,_u(r,i),r}function by(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}var sp="0123456789abcdef".split("");function yy(t){for(var e="",n=0;n<4;n++)e+=sp[t>>8*n+4&15]+sp[t>>8*n&15];return e}function _y(t){return String.fromCharCode(255&t,(65280&t)>>8,(16711680&t)>>16,(4278190080&t)>>24)}function id(t){return tg(t).map(_y).join("")}var wy=(function(t){for(var e=0;e<t.length;e++)t[e]=yy(t[e]);return t.join("")})(tg("hello"))!="5d41402abc4b2a76b9719d911017c592";function ca(t,e){if(wy){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}return t+e&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function ad(t,e){var n,r,i,a;if(t!==n){for(var o=(i=t,a=1+(256/t.length|0),new Array(a+1).join(i)),l=[],c=0;c<256;c++)l[c]=c;var d=0;for(c=0;c<256;c++){var h=l[c];d=(d+h+o.charCodeAt(c))%256,l[c]=l[d],l[d]=h}n=t,r=l}else l=r;var g=e.length,b=0,p=0,y="";for(c=0;c<g;c++)p=(p+(h=l[b=(b+1)%256]))%256,l[b]=l[p],l[p]=h,o=l[(l[b]+l[p])%256],y+=String.fromCharCode(e.charCodeAt(c)^o);return y}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var op={print:4,modify:8,copy:16,"annot-forms":32};function fs(t,e,n,r){this.v=1,this.r=2;var i=192;t.forEach(function(l){if(op.perm!==void 0)throw new Error("Invalid permission: "+l);i+=op[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var a=(e+this.padding).substr(0,32),o=(n+this.padding).substr(0,32);this.O=this.processOwnerPassword(a,o),this.P=-(1+(255^i)),this.encryptionKey=id(a+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=ad(this.encryptionKey,this.padding)}function ps(t){if(/[^\u0000-\u00ff]/.test(t))throw new Error("Invalid PDF Name Object: "+t+", Only accept ASCII characters.");for(var e="",n=t.length,r=0;r<n;r++){var i=t.charCodeAt(r);e+=i<33||i===35||i===37||i===40||i===41||i===47||i===60||i===62||i===91||i===93||i===123||i===125||i>126?"#"+("0"+i.toString(16)).slice(-2):t[r]}return e}function lp(t){if(Ht(t)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(n,r,i){if(i=i||!1,typeof n!="string"||typeof r!="function"||typeof i!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(n)||(e[n]={});var a=Math.random().toString(35);return e[n][a]=[r,!!i],a},this.unsubscribe=function(n){for(var r in e)if(e[r][n])return delete e[r][n],Object.keys(e[r]).length===0&&delete e[r],!0;return!1},this.publish=function(n){if(e.hasOwnProperty(n)){var r=Array.prototype.slice.call(arguments,1),i=[];for(var a in e[n]){var o=e[n][a];try{o[0].apply(t,r)}catch(l){ft.console&&Kt.error("jsPDF PubSub Error",l.message,l)}o[1]&&i.push(a)}i.length&&i.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function Yl(t){if(!(this instanceof Yl))return new Yl(t);var e="opacity,stroke-opacity".split(",");for(var n in t)t.hasOwnProperty(n)&&e.indexOf(n)>=0&&(this[n]=t[n]);this.id="",this.objectNumber=-1}function ng(t,e){this.gState=t,this.matrix=e,this.id="",this.objectNumber=-1}function Fa(t,e,n,r,i){if(!(this instanceof Fa))return new Fa(t,e,n,r,i);this.type=t==="axial"?2:3,this.coords=e,this.colors=n,ng.call(this,r,i)}function gs(t,e,n,r,i){if(!(this instanceof gs))return new gs(t,e,n,r,i);this.boundingBox=t,this.xStep=e,this.yStep=n,this.stream="",this.cloneIndex=0,ng.call(this,r,i)}function Xe(t){var e,n=typeof arguments[0]=="string"?arguments[0]:"p",r=arguments[1],i=arguments[2],a=arguments[3],o=[],l=1,c=16,d="S",h=null;Ht(t=t||{})==="object"&&(n=t.orientation,r=t.unit||r,i=t.format||i,a=t.compress||t.compressPdf||a,(h=t.encryption||null)!==null&&(h.userPassword=h.userPassword||"",h.ownerPassword=h.ownerPassword||"",h.userPermissions=h.userPermissions||[]),l=typeof t.userUnit=="number"?Math.abs(t.userUnit):1,t.precision!==void 0&&(e=t.precision),t.floatPrecision!==void 0&&(c=t.floatPrecision),d=t.defaultPathOperation||"S"),o=t.filters||(a===!0?["FlateEncode"]:o),r=r||"mm",n=(""+(n||"P")).toLowerCase();var g=t.putOnlyUsedFonts||!1,b={},p={internal:{},__private__:{}};p.__private__.PubSub=lp;var y="1.3",w=p.__private__.getPdfVersion=function(){return y};p.__private__.setPdfVersion=function(m){y=m};var S={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};p.__private__.getPageFormats=function(){return S};var x=p.__private__.getPageFormat=function(m){return S[m]};i=i||"a4";var C="compat",P="advanced",L=C;function U(){this.saveGraphicsState(),$(new rt(gt,0,0,-gt,0,va()*gt).toString()+" cm"),this.setFontSize(this.getFontSize()/gt),d="n",L=P}function ee(){this.restoreGraphicsState(),d="S",L=C}var V=p.__private__.combineFontStyleAndFontWeight=function(m,N){if(m=="bold"&&N=="normal"||m=="bold"&&N==400||m=="normal"&&N=="italic"||m=="bold"&&N=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return N&&(m=N==400||N==="normal"?m==="italic"?"italic":"normal":N!=700&&N!=="bold"||m!=="normal"?(N==700?"bold":N)+""+m:"bold"),m};p.advancedAPI=function(m){var N=L===C;return N&&U.call(this),typeof m!="function"||(m(this),N&&ee.call(this)),this},p.compatAPI=function(m){var N=L===P;return N&&ee.call(this),typeof m!="function"||(m(this),N&&U.call(this)),this},p.isAdvancedAPI=function(){return L===P};var X,D=function(m){if(L!==P)throw new Error(m+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},I=p.roundToPrecision=p.__private__.roundToPrecision=function(m,N){var G=e||N;if(isNaN(m)||isNaN(G))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return m.toFixed(G).replace(/0+$/,"")};X=p.hpf=p.__private__.hpf=typeof c=="number"?function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.hpf");return I(m,c)}:c==="smart"?function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.hpf");return I(m,m>-1&&m<1?16:5)}:function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.hpf");return I(m,16)};var k=p.f2=p.__private__.f2=function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.f2");return I(m,2)},A=p.__private__.f3=function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.f3");return I(m,3)},M=p.scale=p.__private__.scale=function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.scale");return L===C?m*gt:L===P?m:void 0},B=function(m){return M((function(N){return L===C?va()-N:L===P?N:void 0})(m))};p.__private__.setPrecision=p.setPrecision=function(m){typeof parseInt(m,10)=="number"&&(e=parseInt(m,10))};var J,oe="00000000000000000000000000000000",ue=p.__private__.getFileId=function(){return oe},ae=p.__private__.setFileId=function(m){return oe=m!==void 0&&/^[a-fA-F0-9]{32}$/.test(m)?m.toUpperCase():oe.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),h!==null&&(Tn=new fs(h.userPermissions,h.userPassword,h.ownerPassword,oe)),oe};p.setFileId=function(m){return ae(m),this},p.getFileId=function(){return ue()};var fe=p.__private__.convertDateToPDFDate=function(m){var N=m.getTimezoneOffset(),G=N<0?"+":"-",Z=Math.floor(Math.abs(N/60)),se=Math.abs(N%60),ye=[G,K(Z),"'",K(se),"'"].join("");return["D:",m.getFullYear(),K(m.getMonth()+1),K(m.getDate()),K(m.getHours()),K(m.getMinutes()),K(m.getSeconds()),ye].join("")},ke=p.__private__.convertPDFDateToDate=function(m){var N=parseInt(m.substr(2,4),10),G=parseInt(m.substr(6,2),10)-1,Z=parseInt(m.substr(8,2),10),se=parseInt(m.substr(10,2),10),ye=parseInt(m.substr(12,2),10),xe=parseInt(m.substr(14,2),10);return new Date(N,G,Z,se,ye,xe,0)},pe=p.__private__.setCreationDate=function(m){var N;if(m===void 0&&(m=new Date),m instanceof Date)N=fe(m);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(m))throw new Error("Invalid argument passed to jsPDF.setCreationDate");N=m}return J=N},O=p.__private__.getCreationDate=function(m){var N=J;return m==="jsDate"&&(N=ke(J)),N};p.setCreationDate=function(m){return pe(m),this},p.getCreationDate=function(m){return O(m)};var q,K=p.__private__.padd2=function(m){return("0"+parseInt(m)).slice(-2)},Y=p.__private__.padd2Hex=function(m){return("00"+(m=m.toString())).substr(m.length)},Q=0,z=[],re=[],ce=0,ge=[],Ae=[],Pe=!1,Te=re;p.__private__.setCustomOutputDestination=function(m){Pe=!0,Te=m};var Me=function(m){Pe||(Te=m)};p.__private__.resetCustomOutputDestination=function(){Pe=!1,Te=re};var $=p.__private__.out=function(m){return m=m.toString(),ce+=m.length+1,Te.push(m),Te},Ce=p.__private__.write=function(m){return $(arguments.length===1?m.toString():Array.prototype.join.call(arguments," "))},ht=p.__private__.getArrayBuffer=function(m){for(var N=m.length,G=new ArrayBuffer(N),Z=new Uint8Array(G);N--;)Z[N]=m.charCodeAt(N);return G},He=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];p.__private__.getStandardFonts=function(){return He};var we=t.fontSize||16;p.__private__.setFontSize=p.setFontSize=function(m){return we=L===P?m/gt:m,this};var Ke,Re=p.__private__.getFontSize=p.getFontSize=function(){return L===C?we:we*gt},Qe=t.R2L||!1;p.__private__.setR2L=p.setR2L=function(m){return Qe=m,this},p.__private__.getR2L=p.getR2L=function(){return Qe};var Ie,it=p.__private__.setZoomMode=function(m){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(m))Ke=m;else if(isNaN(m)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(m)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+m+'" is not recognized.');Ke=m}else Ke=parseInt(m,10)};p.__private__.getZoomMode=function(){return Ke};var nt,at=p.__private__.setPageMode=function(m){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(m)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+m+'" is not recognized.');Ie=m};p.__private__.getPageMode=function(){return Ie};var ut=p.__private__.setLayoutMode=function(m){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(m)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+m+'" is not recognized.');nt=m};p.__private__.getLayoutMode=function(){return nt},p.__private__.setDisplayMode=p.setDisplayMode=function(m,N,G){return it(m),ut(N),at(G),this};var pt={title:"",subject:"",author:"",keywords:"",creator:""};p.__private__.getDocumentProperty=function(m){if(Object.keys(pt).indexOf(m)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return pt[m]},p.__private__.getDocumentProperties=function(){return pt},p.__private__.setDocumentProperties=p.setProperties=p.setDocumentProperties=function(m){for(var N in pt)pt.hasOwnProperty(N)&&m[N]&&(pt[N]=m[N]);return this},p.__private__.setDocumentProperty=function(m,N){if(Object.keys(pt).indexOf(m)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return pt[m]=N};var qe,gt,We,rn,Et,bt={},ct={},Dt=[],et={},jt={},st={},dt={},Ut=null,kt=0,tt=[],Ft=new lp(p),yi=t.hotfixes||[],Ct={},Gn={},Tr=[],rt=function m(N,G,Z,se,ye,xe){if(!(this instanceof m))return new m(N,G,Z,se,ye,xe);isNaN(N)&&(N=1),isNaN(G)&&(G=0),isNaN(Z)&&(Z=0),isNaN(se)&&(se=1),isNaN(ye)&&(ye=0),isNaN(xe)&&(xe=0),this._matrix=[N,G,Z,se,ye,xe]};Object.defineProperty(rt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(m){this._matrix[0]=m}}),Object.defineProperty(rt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(m){this._matrix[1]=m}}),Object.defineProperty(rt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(m){this._matrix[2]=m}}),Object.defineProperty(rt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(m){this._matrix[3]=m}}),Object.defineProperty(rt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(m){this._matrix[4]=m}}),Object.defineProperty(rt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(m){this._matrix[5]=m}}),Object.defineProperty(rt.prototype,"a",{get:function(){return this._matrix[0]},set:function(m){this._matrix[0]=m}}),Object.defineProperty(rt.prototype,"b",{get:function(){return this._matrix[1]},set:function(m){this._matrix[1]=m}}),Object.defineProperty(rt.prototype,"c",{get:function(){return this._matrix[2]},set:function(m){this._matrix[2]=m}}),Object.defineProperty(rt.prototype,"d",{get:function(){return this._matrix[3]},set:function(m){this._matrix[3]=m}}),Object.defineProperty(rt.prototype,"e",{get:function(){return this._matrix[4]},set:function(m){this._matrix[4]=m}}),Object.defineProperty(rt.prototype,"f",{get:function(){return this._matrix[5]},set:function(m){this._matrix[5]=m}}),Object.defineProperty(rt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(rt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(rt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(rt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),rt.prototype.join=function(m){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(X).join(m)},rt.prototype.multiply=function(m){var N=m.sx*this.sx+m.shy*this.shx,G=m.sx*this.shy+m.shy*this.sy,Z=m.shx*this.sx+m.sy*this.shx,se=m.shx*this.shy+m.sy*this.sy,ye=m.tx*this.sx+m.ty*this.shx+this.tx,xe=m.tx*this.shy+m.ty*this.sy+this.ty;return new rt(N,G,Z,se,ye,xe)},rt.prototype.decompose=function(){var m=this.sx,N=this.shy,G=this.shx,Z=this.sy,se=this.tx,ye=this.ty,xe=Math.sqrt(m*m+N*N),$e=(m/=xe)*G+(N/=xe)*Z;G-=m*$e,Z-=N*$e;var Je=Math.sqrt(G*G+Z*Z);return $e/=Je,m*(Z/=Je)<N*(G/=Je)&&(m=-m,N=-N,$e=-$e,xe=-xe),{scale:new rt(xe,0,0,Je,0,0),translate:new rt(1,0,0,1,se,ye),rotate:new rt(m,N,-N,m,0,0),skew:new rt(1,0,$e,1,0,0)}},rt.prototype.toString=function(m){return this.join(" ")},rt.prototype.inversed=function(){var m=this.sx,N=this.shy,G=this.shx,Z=this.sy,se=this.tx,ye=this.ty,xe=1/(m*Z-N*G),$e=Z*xe,Je=-N*xe,mt=-G*xe,wt=m*xe;return new rt($e,Je,mt,wt,-$e*se-mt*ye,-Je*se-wt*ye)},rt.prototype.applyToPoint=function(m){var N=m.x*this.sx+m.y*this.shx+this.tx,G=m.x*this.shy+m.y*this.sy+this.ty;return new Ai(N,G)},rt.prototype.applyToRectangle=function(m){var N=this.applyToPoint(m),G=this.applyToPoint(new Ai(m.x+m.w,m.y+m.h));return new Ps(N.x,N.y,G.x-N.x,G.y-N.y)},rt.prototype.clone=function(){var m=this.sx,N=this.shy,G=this.shx,Z=this.sy,se=this.tx,ye=this.ty;return new rt(m,N,G,Z,se,ye)},p.Matrix=rt;var gr=p.matrixMult=function(m,N){return N.multiply(m)},Ir=new rt(1,0,0,1,0,0);p.unitMatrix=p.identityMatrix=Ir;var er=function(m,N){if(!jt[m]){var G=(N instanceof Fa?"Sh":"P")+(Object.keys(et).length+1).toString(10);N.id=G,jt[m]=G,et[G]=N,Ft.publish("addPattern",N)}};p.ShadingPattern=Fa,p.TilingPattern=gs,p.addShadingPattern=function(m,N){return D("addShadingPattern()"),er(m,N),this},p.beginTilingPattern=function(m){D("beginTilingPattern()"),Os(m.boundingBox[0],m.boundingBox[1],m.boundingBox[2]-m.boundingBox[0],m.boundingBox[3]-m.boundingBox[1],m.matrix)},p.endTilingPattern=function(m,N){D("endTilingPattern()"),N.stream=Ae[q].join(`
`),er(m,N),Ft.publish("endTilingPattern",N),Tr.pop().restore()};var cr,Pt=p.__private__.newObject=function(){var m=Yt();return xn(m,!0),m},Yt=p.__private__.newObjectDeferred=function(){return Q++,z[Q]=function(){return ce},Q},xn=function(m,N){return N=typeof N=="boolean"&&N,z[m]=ce,N&&$(m+" 0 obj"),m},ii=p.__private__.newAdditionalObject=function(){var m={objId:Yt(),content:""};return ge.push(m),m},Pr=Yt(),ur=Yt(),Sn=p.__private__.decodeColorString=function(m){var N=m.split(" ");if(N.length!==2||N[1]!=="g"&&N[1]!=="G")N.length!==5||N[4]!=="k"&&N[4]!=="K"||(N=[(1-N[0])*(1-N[3]),(1-N[1])*(1-N[3]),(1-N[2])*(1-N[3]),"r"]);else{var G=parseFloat(N[0]);N=[G,G,G,"r"]}for(var Z="#",se=0;se<3;se++)Z+=("0"+Math.floor(255*parseFloat(N[se])).toString(16)).slice(-2);return Z},dr=p.__private__.encodeColorString=function(m){var N;typeof m=="string"&&(m={ch1:m});var G=m.ch1,Z=m.ch2,se=m.ch3,ye=m.ch4,xe=m.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof G=="string"&&G.charAt(0)!=="#"){var $e=new eg(G);if($e.ok)G=$e.toHex();else if(!/^\d*\.?\d*$/.test(G))throw new Error('Invalid color "'+G+'" passed to jsPDF.encodeColorString.')}if(typeof G=="string"&&/^#[0-9A-Fa-f]{3}$/.test(G)&&(G="#"+G[1]+G[1]+G[2]+G[2]+G[3]+G[3]),typeof G=="string"&&/^#[0-9A-Fa-f]{6}$/.test(G)){var Je=parseInt(G.substr(1),16);G=Je>>16&255,Z=Je>>8&255,se=255&Je}if(Z===void 0||ye===void 0&&G===Z&&Z===se)N=typeof G=="string"?G+" "+xe[0]:m.precision===2?k(G/255)+" "+xe[0]:A(G/255)+" "+xe[0];else if(ye===void 0||Ht(ye)==="object"){if(ye&&!isNaN(ye.a)&&ye.a===0)return["1.","1.","1.",xe[1]].join(" ");N=typeof G=="string"?[G,Z,se,xe[1]].join(" "):m.precision===2?[k(G/255),k(Z/255),k(se/255),xe[1]].join(" "):[A(G/255),A(Z/255),A(se/255),xe[1]].join(" ")}else N=typeof G=="string"?[G,Z,se,ye,xe[2]].join(" "):m.precision===2?[k(G),k(Z),k(se),k(ye),xe[2]].join(" "):[A(G),A(Z),A(se),A(ye),xe[2]].join(" ");return N},hr=p.__private__.getFilters=function(){return o},tr=p.__private__.putStream=function(m){var N=(m=m||{}).data||"",G=m.filters||hr(),Z=m.alreadyAppliedFilters||[],se=m.addLength1||!1,ye=N.length,xe=m.objectId,$e=function(In){return In};if(h!==null&&xe===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");h!==null&&($e=Tn.encryptor(xe,0));var Je={};G===!0&&(G=["FlateEncode"]);var mt=m.additionalKeyValues||[],wt=(Je=Xe.API.processDataByFilters!==void 0?Xe.API.processDataByFilters(N,G):{data:N,reverseChain:[]}).reverseChain+(Array.isArray(Z)?Z.join(" "):Z.toString());if(Je.data.length!==0&&(mt.push({key:"Length",value:Je.data.length}),se===!0&&mt.push({key:"Length1",value:ye})),wt.length!=0)if(wt.split("/").length-1==1)mt.push({key:"Filter",value:wt});else{mt.push({key:"Filter",value:"["+wt+"]"});for(var Ot=0;Ot<mt.length;Ot+=1)if(mt[Ot].key==="DecodeParms"){for(var on=[],kn=0;kn<Je.reverseChain.split("/").length-1;kn+=1)on.push("null");on.push(mt[Ot].value),mt[Ot].value="["+on.join(" ")+"]"}}$("<<");for(var Xt=0;Xt<mt.length;Xt++)$("/"+mt[Xt].key+" "+mt[Xt].value);$(">>"),Je.data.length!==0&&($("stream"),$($e(Je.data)),$("endstream"))},ai=p.__private__.putPage=function(m){var N=m.number,G=m.data,Z=m.objId,se=m.contentsObjId;xn(Z,!0),$("<</Type /Page"),$("/Parent "+m.rootDictionaryObjId+" 0 R"),$("/Resources "+m.resourceDictionaryObjId+" 0 R"),$("/MediaBox ["+parseFloat(X(m.mediaBox.bottomLeftX))+" "+parseFloat(X(m.mediaBox.bottomLeftY))+" "+X(m.mediaBox.topRightX)+" "+X(m.mediaBox.topRightY)+"]"),m.cropBox!==null&&$("/CropBox ["+X(m.cropBox.bottomLeftX)+" "+X(m.cropBox.bottomLeftY)+" "+X(m.cropBox.topRightX)+" "+X(m.cropBox.topRightY)+"]"),m.bleedBox!==null&&$("/BleedBox ["+X(m.bleedBox.bottomLeftX)+" "+X(m.bleedBox.bottomLeftY)+" "+X(m.bleedBox.topRightX)+" "+X(m.bleedBox.topRightY)+"]"),m.trimBox!==null&&$("/TrimBox ["+X(m.trimBox.bottomLeftX)+" "+X(m.trimBox.bottomLeftY)+" "+X(m.trimBox.topRightX)+" "+X(m.trimBox.topRightY)+"]"),m.artBox!==null&&$("/ArtBox ["+X(m.artBox.bottomLeftX)+" "+X(m.artBox.bottomLeftY)+" "+X(m.artBox.topRightX)+" "+X(m.artBox.topRightY)+"]"),typeof m.userUnit=="number"&&m.userUnit!==1&&$("/UserUnit "+m.userUnit),Ft.publish("putPage",{objId:Z,pageContext:tt[N],pageNumber:N,page:G}),$("/Contents "+se+" 0 R"),$(">>"),$("endobj");var ye=G.join(`
`);return L===P&&(ye+=`
Q`),xn(se,!0),tr({data:ye,filters:hr(),objectId:se}),$("endobj"),Z},Or=p.__private__.putPages=function(){var m,N,G=[];for(m=1;m<=kt;m++)tt[m].objId=Yt(),tt[m].contentsObjId=Yt();for(m=1;m<=kt;m++)G.push(ai({number:m,data:Ae[m],objId:tt[m].objId,contentsObjId:tt[m].contentsObjId,mediaBox:tt[m].mediaBox,cropBox:tt[m].cropBox,bleedBox:tt[m].bleedBox,trimBox:tt[m].trimBox,artBox:tt[m].artBox,userUnit:tt[m].userUnit,rootDictionaryObjId:Pr,resourceDictionaryObjId:ur}));xn(Pr,!0),$("<</Type /Pages");var Z="/Kids [";for(N=0;N<kt;N++)Z+=G[N]+" 0 R ";$(Z+"]"),$("/Count "+kt),$(">>"),$("endobj"),Ft.publish("postPutPages")},Ue=function(m){Ft.publish("putFont",{font:m,out:$,newObject:Pt,putStream:tr}),m.isAlreadyPutted!==!0&&(m.objectNumber=Pt(),$("<<"),$("/Type /Font"),$("/BaseFont /"+ps(m.postScriptName)),$("/Subtype /Type1"),typeof m.encoding=="string"&&$("/Encoding /"+m.encoding),$("/FirstChar 32"),$("/LastChar 255"),$(">>"),$("endobj"))},te=function(m){m.objectNumber=Pt();var N=[];N.push({key:"Type",value:"/XObject"}),N.push({key:"Subtype",value:"/Form"}),N.push({key:"BBox",value:"["+[X(m.x),X(m.y),X(m.x+m.width),X(m.y+m.height)].join(" ")+"]"}),N.push({key:"Matrix",value:"["+m.matrix.toString()+"]"});var G=m.pages[1].join(`
`);tr({data:G,additionalKeyValues:N,objectId:m.objectNumber}),$("endobj")},Ne=function(m,N){N||(N=21);var G=Pt(),Z=(function(xe,$e){var Je,mt=[],wt=1/($e-1);for(Je=0;Je<1;Je+=wt)mt.push(Je);if(mt.push(1),xe[0].offset!=0){var Ot={offset:0,color:xe[0].color};xe.unshift(Ot)}if(xe[xe.length-1].offset!=1){var on={offset:1,color:xe[xe.length-1].color};xe.push(on)}for(var kn="",Xt=0,In=0;In<mt.length;In++){for(Je=mt[In];Je>xe[Xt+1].offset;)Xt++;var Nn=xe[Xt].offset,Mn=(Je-Nn)/(xe[Xt+1].offset-Nn),Ei=xe[Xt].color,Hr=xe[Xt+1].color;kn+=Y(Math.round((1-Mn)*Ei[0]+Mn*Hr[0]).toString(16))+Y(Math.round((1-Mn)*Ei[1]+Mn*Hr[1]).toString(16))+Y(Math.round((1-Mn)*Ei[2]+Mn*Hr[2]).toString(16))}return kn.trim()})(m.colors,N),se=[];se.push({key:"FunctionType",value:"0"}),se.push({key:"Domain",value:"[0.0 1.0]"}),se.push({key:"Size",value:"["+N+"]"}),se.push({key:"BitsPerSample",value:"8"}),se.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),se.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),tr({data:Z,additionalKeyValues:se,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:G}),$("endobj"),m.objectNumber=Pt(),$("<< /ShadingType "+m.type),$("/ColorSpace /DeviceRGB");var ye="/Coords ["+X(parseFloat(m.coords[0]))+" "+X(parseFloat(m.coords[1]))+" ";m.type===2?ye+=X(parseFloat(m.coords[2]))+" "+X(parseFloat(m.coords[3])):ye+=X(parseFloat(m.coords[2]))+" "+X(parseFloat(m.coords[3]))+" "+X(parseFloat(m.coords[4]))+" "+X(parseFloat(m.coords[5])),$(ye+="]"),m.matrix&&$("/Matrix ["+m.matrix.toString()+"]"),$("/Function "+G+" 0 R"),$("/Extend [true true]"),$(">>"),$("endobj")},Fe=function(m,N){var G=Yt(),Z=Pt();N.push({resourcesOid:G,objectOid:Z}),m.objectNumber=Z;var se=[];se.push({key:"Type",value:"/Pattern"}),se.push({key:"PatternType",value:"1"}),se.push({key:"PaintType",value:"1"}),se.push({key:"TilingType",value:"1"}),se.push({key:"BBox",value:"["+m.boundingBox.map(X).join(" ")+"]"}),se.push({key:"XStep",value:X(m.xStep)}),se.push({key:"YStep",value:X(m.yStep)}),se.push({key:"Resources",value:G+" 0 R"}),m.matrix&&se.push({key:"Matrix",value:"["+m.matrix.toString()+"]"}),tr({data:m.stream,additionalKeyValues:se,objectId:m.objectNumber}),$("endobj")},Wt=function(m){for(var N in m.objectNumber=Pt(),$("<<"),m)switch(N){case"opacity":$("/ca "+k(m[N]));break;case"stroke-opacity":$("/CA "+k(m[N]))}$(">>"),$("endobj")},cn=function(m){xn(m.resourcesOid,!0),$("<<"),$("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var N in $("/Font <<"),bt)bt.hasOwnProperty(N)&&(g===!1||g===!0&&b.hasOwnProperty(N))&&$("/"+N+" "+bt[N].objectNumber+" 0 R");$(">>")})(),(function(){if(Object.keys(et).length>0){for(var N in $("/Shading <<"),et)et.hasOwnProperty(N)&&et[N]instanceof Fa&&et[N].objectNumber>=0&&$("/"+N+" "+et[N].objectNumber+" 0 R");Ft.publish("putShadingPatternDict"),$(">>")}})(),(function(N){if(Object.keys(et).length>0){for(var G in $("/Pattern <<"),et)et.hasOwnProperty(G)&&et[G]instanceof p.TilingPattern&&et[G].objectNumber>=0&&et[G].objectNumber<N&&$("/"+G+" "+et[G].objectNumber+" 0 R");Ft.publish("putTilingPatternDict"),$(">>")}})(m.objectOid),(function(){if(Object.keys(st).length>0){var N;for(N in $("/ExtGState <<"),st)st.hasOwnProperty(N)&&st[N].objectNumber>=0&&$("/"+N+" "+st[N].objectNumber+" 0 R");Ft.publish("putGStateDict"),$(">>")}})(),(function(){for(var N in $("/XObject <<"),Ct)Ct.hasOwnProperty(N)&&Ct[N].objectNumber>=0&&$("/"+N+" "+Ct[N].objectNumber+" 0 R");Ft.publish("putXobjectDict"),$(">>")})(),$(">>"),$("endobj")},en=function(m){ct[m.fontName]=ct[m.fontName]||{},ct[m.fontName][m.fontStyle]=m.id},Cn=function(m,N,G,Z,se){var ye={id:"F"+(Object.keys(bt).length+1).toString(10),postScriptName:m,fontName:N,fontStyle:G,encoding:Z,isStandardFont:se||!1,metadata:{}};return Ft.publish("addFont",{font:ye,instance:this}),bt[ye.id]=ye,en(ye),ye.id},un=p.__private__.pdfEscape=p.pdfEscape=function(m,N){return(function(G,Z){var se,ye,xe,$e,Je,mt,wt,Ot,on;if(xe=(Z=Z||{}).sourceEncoding||"Unicode",Je=Z.outputEncoding,(Z.autoencode||Je)&&bt[qe].metadata&&bt[qe].metadata[xe]&&bt[qe].metadata[xe].encoding&&($e=bt[qe].metadata[xe].encoding,!Je&&bt[qe].encoding&&(Je=bt[qe].encoding),!Je&&$e.codePages&&(Je=$e.codePages[0]),typeof Je=="string"&&(Je=$e[Je]),Je)){for(wt=!1,mt=[],se=0,ye=G.length;se<ye;se++)(Ot=Je[G.charCodeAt(se)])?mt.push(String.fromCharCode(Ot)):mt.push(G[se]),mt[se].charCodeAt(0)>>8&&(wt=!0);G=mt.join("")}for(se=G.length;wt===void 0&&se!==0;)G.charCodeAt(se-1)>>8&&(wt=!0),se--;if(!wt)return G;for(mt=Z.noBOM?[]:[254,255],se=0,ye=G.length;se<ye;se++){if((on=(Ot=G.charCodeAt(se))>>8)>>8)throw new Error("Character at position "+se+" of string '"+G+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");mt.push(on),mt.push(Ot-(on<<8))}return String.fromCharCode.apply(void 0,mt)})(m,N).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Rr=p.__private__.beginPage=function(m){Ae[++kt]=[],tt[kt]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(m[0]),topRightY:Number(m[1])}},da(kt),Me(Ae[q])},$i=function(m,N){var G,Z,se;switch(n=N||n,typeof m=="string"&&(G=x(m.toLowerCase()),Array.isArray(G)&&(Z=G[0],se=G[1])),Array.isArray(m)&&(Z=m[0]*gt,se=m[1]*gt),isNaN(Z)&&(Z=i[0],se=i[1]),(Z>14400||se>14400)&&(Kt.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Z=Math.min(14400,Z),se=Math.min(14400,se)),i=[Z,se],n.substr(0,1)){case"l":se>Z&&(i=[se,Z]);break;case"p":Z>se&&(i=[se,Z])}Rr(i),vt(Ls),$(Ka),Ts!==0&&$(Ts+" J"),Is!==0&&$(Is+" j"),Ft.publish("addPage",{pageNumber:kt})},sn=function(m){m>0&&m<=kt&&(Ae.splice(m,1),tt.splice(m,1),kt--,q>kt&&(q=kt),this.setPage(q))},da=function(m){m>0&&m<=kt&&(q=m)},ha=p.__private__.getNumberOfPages=p.getNumberOfPages=function(){return Ae.length-1},Po=function(m,N,G){var Z,se=void 0;return G=G||{},m=m!==void 0?m:bt[qe].fontName,N=N!==void 0?N:bt[qe].fontStyle,Z=m.toLowerCase(),ct[Z]!==void 0&&ct[Z][N]!==void 0?se=ct[Z][N]:ct[m]!==void 0&&ct[m][N]!==void 0?se=ct[m][N]:G.disableWarning===!1&&Kt.warn("Unable to look up font label for font '"+m+"', '"+N+"'. Refer to getFontList() for available fonts."),se||G.noFallback||(se=ct.times[N])==null&&(se=ct.times.normal),se},si=p.__private__.putInfo=function(){var m=Pt(),N=function(Z){return Z};for(var G in h!==null&&(N=Tn.encryptor(m,0)),$("<<"),$("/Producer ("+un(N("jsPDF "+Xe.version))+")"),pt)pt.hasOwnProperty(G)&&pt[G]&&$("/"+G.substr(0,1).toUpperCase()+G.substr(1)+" ("+un(N(pt[G]))+")");$("/CreationDate ("+un(N(J))+")"),$(">>"),$("endobj")},Wa=p.__private__.putCatalog=function(m){var N=(m=m||{}).rootDictionaryObjId||Pr;switch(Pt(),$("<<"),$("/Type /Catalog"),$("/Pages "+N+" 0 R"),Ke||(Ke="fullwidth"),Ke){case"fullwidth":$("/OpenAction [3 0 R /FitH null]");break;case"fullheight":$("/OpenAction [3 0 R /FitV null]");break;case"fullpage":$("/OpenAction [3 0 R /Fit]");break;case"original":$("/OpenAction [3 0 R /XYZ null null 1]");break;default:var G=""+Ke;G.substr(G.length-1)==="%"&&(Ke=parseInt(Ke)/100),typeof Ke=="number"&&$("/OpenAction [3 0 R /XYZ null null "+k(Ke)+"]")}switch(nt||(nt="continuous"),nt){case"continuous":$("/PageLayout /OneColumn");break;case"single":$("/PageLayout /SinglePage");break;case"two":case"twoleft":$("/PageLayout /TwoColumnLeft");break;case"tworight":$("/PageLayout /TwoColumnRight")}Ie&&$("/PageMode /"+Ie),Ft.publish("putCatalog"),$(">>"),$("endobj")},dc=p.__private__.putTrailer=function(){$("trailer"),$("<<"),$("/Size "+(Q+1)),$("/Root "+Q+" 0 R"),$("/Info "+(Q-1)+" 0 R"),h!==null&&$("/Encrypt "+Tn.oid+" 0 R"),$("/ID [ <"+oe+"> <"+oe+"> ]"),$(">>")},An=p.__private__.putHeader=function(){$("%PDF-"+y),$("%")},Oo=p.__private__.putXRef=function(){var m="0000000000";$("xref"),$("0 "+(Q+1)),$("0000000000 65535 f ");for(var N=1;N<=Q;N++)typeof z[N]=="function"?$((m+z[N]()).slice(-10)+" 00000 n "):z[N]!==void 0?$((m+z[N]).slice(-10)+" 00000 n "):$("0000000000 00000 n ")},oi=p.__private__.buildDocument=function(){var m;Q=0,ce=0,re=[],z=[],ge=[],Pr=Yt(),ur=Yt(),Me(re),Ft.publish("buildDocument"),An(),Or(),(function(){Ft.publish("putAdditionalObjects");for(var G=0;G<ge.length;G++){var Z=ge[G];xn(Z.objId,!0),$(Z.content),$("endobj")}Ft.publish("postPutAdditionalObjects")})(),m=[],(function(){for(var G in bt)bt.hasOwnProperty(G)&&(g===!1||g===!0&&b.hasOwnProperty(G))&&Ue(bt[G])})(),(function(){var G;for(G in st)st.hasOwnProperty(G)&&Wt(st[G])})(),(function(){for(var G in Ct)Ct.hasOwnProperty(G)&&te(Ct[G])})(),(function(G){var Z;for(Z in et)et.hasOwnProperty(Z)&&(et[Z]instanceof Fa?Ne(et[Z]):et[Z]instanceof gs&&Fe(et[Z],G))})(m),Ft.publish("putResources"),m.forEach(cn),cn({resourcesOid:ur,objectOid:Number.MAX_SAFE_INTEGER}),Ft.publish("postPutResources"),h!==null&&(Tn.oid=Pt(),$("<<"),$("/Filter /Standard"),$("/V "+Tn.v),$("/R "+Tn.r),$("/U <"+Tn.toHexString(Tn.U)+">"),$("/O <"+Tn.toHexString(Tn.O)+">"),$("/P "+Tn.P),$(">>"),$("endobj")),si(),Wa();var N=ce;return Oo(),dc(),$("startxref"),$(""+N),$("%%EOF"),Me(Ae[q]),re.join(`
`)},Ga=p.__private__.getBlob=function(m){return new Blob([ht(m)],{type:"application/pdf"})},Ro=p.output=p.__private__.output=(cr=function(m,N){switch(typeof(N=N||{})=="string"?N={filename:N}:N.filename=N.filename||"generated.pdf",m){case void 0:return oi();case"save":p.save(N.filename);break;case"arraybuffer":return ht(oi());case"blob":return Ga(oi());case"bloburi":case"bloburl":if(ft.URL!==void 0&&typeof ft.URL.createObjectURL=="function")return ft.URL&&ft.URL.createObjectURL(Ga(oi()))||void 0;Kt.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var G="",Z=oi();try{G=ap(Z)}catch{G=ap(unescape(encodeURIComponent(Z)))}return"data:application/pdf;filename="+N.filename+";base64,"+G;case"pdfobjectnewwindow":if(Object.prototype.toString.call(ft)==="[object Window]"){var se="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",ye=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';N.pdfObjectUrl&&(se=N.pdfObjectUrl,ye="");var xe='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+se+'"'+ye+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(N)+");<\/script></body></html>",$e=ft.open();return $e!==null&&$e.document.write(xe),$e}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(ft)==="[object Window]"){var Je='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(N.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+N.filename+'" width="500px" height="400px" /></body></html>',mt=ft.open();if(mt!==null){mt.document.write(Je);var wt=this;mt.document.documentElement.querySelector("#pdfViewer").onload=function(){mt.document.title=N.filename,mt.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(wt.output("bloburl"))}}return mt}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(ft)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Ot='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",N)+'"></iframe></body></html>',on=ft.open();if(on!==null&&(on.document.write(Ot),on.document.title=N.filename),on||typeof safari>"u")return on;break;case"datauri":case"dataurl":return ft.document.location.href=this.output("datauristring",N);default:return null}},cr.foo=function(){try{return cr.apply(this,arguments)}catch(G){var m=G.stack||"";~m.indexOf(" at ")&&(m=m.split(" at ")[1]);var N="Error in function "+m.split(`
`)[0].split("<")[0]+": "+G.message;if(!ft.console)throw new Error(N);ft.console.error(N,G),ft.alert&&alert(N)}},cr.foo.bar=cr,cr.foo),Fr=function(m){return Array.isArray(yi)===!0&&yi.indexOf(m)>-1};switch(r){case"pt":gt=1;break;case"mm":gt=72/25.4;break;case"cm":gt=72/2.54;break;case"in":gt=72;break;case"px":gt=Fr("px_scaling")==1?.75:96/72;break;case"pc":case"em":gt=12;break;case"ex":gt=6;break;default:if(typeof r!="number")throw new Error("Invalid unit: "+r);gt=r}var Tn=null;pe(),ae();var _i=p.__private__.getPageInfo=p.getPageInfo=function(m){if(isNaN(m)||m%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:tt[m].objId,pageNumber:m,pageContext:tt[m]}},Fo=p.__private__.getPageInfoByObjId=function(m){if(isNaN(m)||m%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var N in tt)if(tt[N].objId===m)break;return _i(N)},hc=p.__private__.getCurrentPageInfo=p.getCurrentPageInfo=function(){return{objId:tt[q].objId,pageNumber:q,pageContext:tt[q]}};p.addPage=function(){return $i.apply(this,arguments),this},p.setPage=function(){return da.apply(this,arguments),Me.call(this,Ae[q]),this},p.insertPage=function(m){return this.addPage(),this.movePage(q,m),this},p.movePage=function(m,N){var G,Z;if(m>N){G=Ae[m],Z=tt[m];for(var se=m;se>N;se--)Ae[se]=Ae[se-1],tt[se]=tt[se-1];Ae[N]=G,tt[N]=Z,this.setPage(N)}else if(m<N){G=Ae[m],Z=tt[m];for(var ye=m;ye<N;ye++)Ae[ye]=Ae[ye+1],tt[ye]=tt[ye+1];Ae[N]=G,tt[N]=Z,this.setPage(N)}return this},p.deletePage=function(){return sn.apply(this,arguments),this},p.__private__.text=p.text=function(m,N,G,Z,se){var ye,xe,$e,Je,mt,wt,Ot,on,kn,Xt=(Z=Z||{}).scope||this;if(typeof m=="number"&&typeof N=="number"&&(typeof G=="string"||Array.isArray(G))){var In=G;G=N,N=m,m=In}if(arguments[3]instanceof rt==0?($e=arguments[4],Je=arguments[5],Ht(Ot=arguments[3])==="object"&&Ot!==null||(typeof $e=="string"&&(Je=$e,$e=null),typeof Ot=="string"&&(Je=Ot,Ot=null),typeof Ot=="number"&&($e=Ot,Ot=null),Z={flags:Ot,angle:$e,align:Je})):(D("The transform parameter of text() with a Matrix value"),kn=se),isNaN(N)||isNaN(G)||m==null)throw new Error("Invalid arguments passed to jsPDF.text");if(m.length===0)return Xt;var Nn,Mn="",Ei=typeof Z.lineHeightFactor=="number"?Z.lineHeightFactor:pa,Hr=Xt.internal.scaleFactor;function Li(Bt){return Bt=Bt.split("	").join(Array(Z.TabLen||9).join(" ")),un(Bt,Ot)}function Fs(Bt){for(var Gt,gn=Bt.concat(),Pn=[],Ii=gn.length;Ii--;)typeof(Gt=gn.shift())=="string"?Pn.push(Gt):Array.isArray(Bt)&&(Gt.length===1||Gt[1]===void 0&&Gt[2]===void 0)?Pn.push(Gt[0]):Pn.push([Gt[0],Gt[1],Gt[2]]);return Pn}function Ya(Bt,Gt){var gn;if(typeof Bt=="string")gn=Gt(Bt)[0];else if(Array.isArray(Bt)){for(var Pn,Ii,Ws=Bt.concat(),Qa=[],Go=Ws.length;Go--;)typeof(Pn=Ws.shift())=="string"?Qa.push(Gt(Pn)[0]):Array.isArray(Pn)&&typeof Pn[0]=="string"&&(Ii=Gt(Pn[0],Pn[1],Pn[2]),Qa.push([Ii[0],Ii[1],Ii[2]]));gn=Qa}return gn}var qi=!1,ba=!0;if(typeof m=="string")qi=!0;else if(Array.isArray(m)){var ya=m.concat();xe=[];for(var zi,Un=ya.length;Un--;)(typeof(zi=ya.shift())!="string"||Array.isArray(zi)&&typeof zi[0]!="string")&&(ba=!1);qi=ba}if(qi===!1)throw new Error('Type of text must be string or Array. "'+m+'" is not recognized.');typeof m=="string"&&(m=m.match(/[\r?\n]/)?m.split(/\r\n|\r|\n/g):[m]);var _a=we/Xt.internal.scaleFactor,wa=_a*(Ei-1);switch(Z.baseline){case"bottom":G-=wa;break;case"top":G+=_a-wa;break;case"hanging":G+=_a-2*wa;break;case"middle":G+=_a/2-wa}if((wt=Z.maxWidth||0)>0&&(typeof m=="string"?m=Xt.splitTextToSize(m,wt):Object.prototype.toString.call(m)==="[object Array]"&&(m=m.reduce(function(Bt,Gt){return Bt.concat(Xt.splitTextToSize(Gt,wt))},[]))),ye={text:m,x:N,y:G,options:Z,mutex:{pdfEscape:un,activeFontKey:qe,fonts:bt,activeFontSize:we}},Ft.publish("preProcessText",ye),m=ye.text,$e=(Z=ye.options).angle,kn instanceof rt==0&&$e&&typeof $e=="number"){$e*=Math.PI/180,Z.rotationDirection===0&&($e=-$e),L===P&&($e=-$e);var Ds=Math.cos($e),js=Math.sin($e);kn=new rt(Ds,js,-js,Ds,0,0)}else $e&&$e instanceof rt&&(kn=$e);L!==P||kn||(kn=Ir),(mt=Z.charSpace||Si)!==void 0&&(Mn+=X(M(mt))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(on=Z.horizontalScale)!==void 0&&(Mn+=X(100*on)+` Tz
`),Z.lang;var nr=-1,Ci=Z.renderingMode!==void 0?Z.renderingMode:Z.stroke,Xa=Xt.internal.getCurrentPageInfo().pageContext;switch(Ci){case 0:case!1:case"fill":nr=0;break;case 1:case!0:case"stroke":nr=1;break;case 2:case"fillThenStroke":nr=2;break;case 3:case"invisible":nr=3;break;case 4:case"fillAndAddForClipping":nr=4;break;case 5:case"strokeAndAddPathForClipping":nr=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":nr=6;break;case 7:case"addToPathForClipping":nr=7}var Ho=Xa.usedRenderingMode!==void 0?Xa.usedRenderingMode:-1;nr!==-1?Mn+=nr+` Tr
`:Ho!==-1&&(Mn+=`0 Tr
`),nr!==-1&&(Xa.usedRenderingMode=nr),Je=Z.align||"left";var Dr,xa=we*Ei,Bs=Xt.internal.pageSize.getWidth(),Ms=bt[qe];mt=Z.charSpace||Si,wt=Z.maxWidth||0,Ot=Object.assign({autoencode:!0,noBOM:!0},Z.flags);var Hi=[],Sa=function(Bt){return Xt.getStringUnitWidth(Bt,{font:Ms,charSpace:mt,fontSize:we,doKerning:!1})*we/Hr};if(Object.prototype.toString.call(m)==="[object Array]"){var vr;xe=Fs(m),Je!=="left"&&(Dr=xe.map(Sa));var br,Wi=0;if(Je==="right"){N-=Dr[0],m=[],Un=xe.length;for(var Ti=0;Ti<Un;Ti++)Ti===0?(br=wi(N),vr=xi(G)):(br=M(Wi-Dr[Ti]),vr=-xa),m.push([xe[Ti],br,vr]),Wi=Dr[Ti]}else if(Je==="center"){N-=Dr[0]/2,m=[],Un=xe.length;for(var Gi=0;Gi<Un;Gi++)Gi===0?(br=wi(N),vr=xi(G)):(br=M((Wi-Dr[Gi])/2),vr=-xa),m.push([xe[Gi],br,vr]),Wi=Dr[Gi]}else if(Je==="left"){m=[],Un=xe.length;for(var Us=0;Us<Un;Us++)m.push(xe[Us])}else if(Je==="justify"&&Ms.encoding==="Identity-H"){m=[],Un=xe.length,wt=wt!==0?wt:Bs;for(var Za=0,mn=0;mn<Un;mn++)if(vr=mn===0?xi(G):-xa,br=mn===0?wi(N):Za,mn<Un-1){var Wo=M((wt-Dr[mn])/(xe[mn].split(" ").length-1)),ci=xe[mn].split(" ");m.push([ci[0]+" ",br,vr]),Za=0;for(var ui=1;ui<ci.length;ui++){var $s=(Sa(ci[ui-1]+" "+ci[ui])-Sa(ci[ui]))*Hr+Wo;ui==ci.length-1?m.push([ci[ui],$s,0]):m.push([ci[ui]+" ",$s,0]),Za-=$s}}else m.push([xe[mn],br,vr]);m.push(["",Za,0])}else{if(Je!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(m=[],Un=xe.length,wt=wt!==0?wt:Bs,mn=0;mn<Un;mn++){vr=mn===0?xi(G):-xa,br=mn===0?wi(N):0;var qs=xe[mn].split(" ").length-1,zs=qs>0?(wt-Dr[mn])/qs:0;mn<Un-1?Hi.push(X(M(zs))):Hi.push(0),m.push([xe[mn],br,vr])}}}(typeof Z.R2L=="boolean"?Z.R2L:Qe)===!0&&(m=Ya(m,function(Bt,Gt,gn){return[Bt.split("").reverse().join(""),Gt,gn]})),ye={text:m,x:N,y:G,options:Z,mutex:{pdfEscape:un,activeFontKey:qe,fonts:bt,activeFontSize:we}},Ft.publish("postProcessText",ye),m=ye.text,Nn=ye.mutex.isHex||!1;var Hs=bt[qe].encoding;Hs!=="WinAnsiEncoding"&&Hs!=="StandardEncoding"||(m=Ya(m,function(Bt,Gt,gn){return[Li(Bt),Gt,gn]})),xe=Fs(m),m=[];for(var Vi,Ki,Ji,Aa=Array.isArray(xe[0])?1:0,Yi="",ka=function(Bt,Gt,gn){var Pn="";return gn instanceof rt?(gn=typeof Z.angle=="number"?gr(gn,new rt(1,0,0,1,Bt,Gt)):gr(new rt(1,0,0,1,Bt,Gt),gn),L===P&&(gn=gr(new rt(1,0,0,-1,0,0),gn)),Pn=gn.join(" ")+` Tm
`):Pn=X(Bt)+" "+X(Gt)+` Td
`,Pn},jr=0;jr<xe.length;jr++){switch(Yi="",Aa){case 1:Ji=(Nn?"<":"(")+xe[jr][0]+(Nn?">":")"),Vi=parseFloat(xe[jr][1]),Ki=parseFloat(xe[jr][2]);break;case 0:Ji=(Nn?"<":"(")+xe[jr]+(Nn?">":")"),Vi=wi(N),Ki=xi(G)}Hi!==void 0&&Hi[jr]!==void 0&&(Yi=Hi[jr]+` Tw
`),jr===0?m.push(Yi+ka(Vi,Ki,kn)+Ji):Aa===0?m.push(Yi+Ji):Aa===1&&m.push(Yi+ka(Vi,Ki,kn)+Ji)}m=Aa===0?m.join(` Tj
T* `):m.join(` Tj
`),m+=` Tj
`;var di=`BT
/`;return di+=qe+" "+we+` Tf
`,di+=X(we*Ei)+` TL
`,di+=ma+`
`,di+=Mn,di+=m,$(di+="ET"),b[qe]=!0,Xt};var fc=p.__private__.clip=p.clip=function(m){return $(m==="evenodd"?"W*":"W"),this};p.clipEvenOdd=function(){return fc("evenodd")},p.__private__.discardPath=p.discardPath=function(){return $("n"),this};var li=p.__private__.isValidStyle=function(m){var N=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(m)!==-1&&(N=!0),N};p.__private__.setDefaultPathOperation=p.setDefaultPathOperation=function(m){return li(m)&&(d=m),this};var Do=p.__private__.getStyle=p.getStyle=function(m){var N=d;switch(m){case"D":case"S":N="S";break;case"F":N="f";break;case"FD":case"DF":N="B";break;case"f":case"f*":case"B":case"B*":N=m}return N},jo=p.close=function(){return $("h"),this};p.stroke=function(){return $("S"),this},p.fill=function(m){return Va("f",m),this},p.fillEvenOdd=function(m){return Va("f*",m),this},p.fillStroke=function(m){return Va("B",m),this},p.fillStrokeEvenOdd=function(m){return Va("B*",m),this};var Va=function(m,N){Ht(N)==="object"?mc(N,m):$(m)},fa=function(m){m===null||L===P&&m===void 0||(m=Do(m),$(m))};function pc(m,N,G,Z,se){var ye=new gs(N||this.boundingBox,G||this.xStep,Z||this.yStep,this.gState,se||this.matrix);ye.stream=this.stream;var xe=m+"$$"+this.cloneIndex+++"$$";return er(xe,ye),ye}var mc=function(m,N){var G=jt[m.key],Z=et[G];if(Z instanceof Fa)$("q"),$(gc(N)),Z.gState&&p.setGState(Z.gState),$(m.matrix.toString()+" cm"),$("/"+G+" sh"),$("Q");else if(Z instanceof gs){var se=new rt(1,0,0,-1,0,va());m.matrix&&(se=se.multiply(m.matrix||Ir),G=pc.call(Z,m.key,m.boundingBox,m.xStep,m.yStep,se).id),$("q"),$("/Pattern cs"),$("/"+G+" scn"),Z.gState&&p.setGState(Z.gState),$(N),$("Q")}},gc=function(m){switch(m){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Es=p.moveTo=function(m,N){return $(X(M(m))+" "+X(B(N))+" m"),this},Bo=p.lineTo=function(m,N){return $(X(M(m))+" "+X(B(N))+" l"),this},zr=p.curveTo=function(m,N,G,Z,se,ye){return $([X(M(m)),X(B(N)),X(M(G)),X(B(Z)),X(M(se)),X(B(ye)),"c"].join(" ")),this};p.__private__.line=p.line=function(m,N,G,Z,se){if(isNaN(m)||isNaN(N)||isNaN(G)||isNaN(Z)||!li(se))throw new Error("Invalid arguments passed to jsPDF.line");return L===C?this.lines([[G-m,Z-N]],m,N,[1,1],se||"S"):this.lines([[G-m,Z-N]],m,N,[1,1]).stroke()},p.__private__.lines=p.lines=function(m,N,G,Z,se,ye){var xe,$e,Je,mt,wt,Ot,on,kn,Xt,In,Nn,Mn;if(typeof m=="number"&&(Mn=G,G=N,N=m,m=Mn),Z=Z||[1,1],ye=ye||!1,isNaN(N)||isNaN(G)||!Array.isArray(m)||!Array.isArray(Z)||!li(se)||typeof ye!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Es(N,G),xe=Z[0],$e=Z[1],mt=m.length,In=N,Nn=G,Je=0;Je<mt;Je++)(wt=m[Je]).length===2?(In=wt[0]*xe+In,Nn=wt[1]*$e+Nn,Bo(In,Nn)):(Ot=wt[0]*xe+In,on=wt[1]*$e+Nn,kn=wt[2]*xe+In,Xt=wt[3]*$e+Nn,In=wt[4]*xe+In,Nn=wt[5]*$e+Nn,zr(Ot,on,kn,Xt,In,Nn));return ye&&jo(),fa(se),this},p.path=function(m){for(var N=0;N<m.length;N++){var G=m[N],Z=G.c;switch(G.op){case"m":Es(Z[0],Z[1]);break;case"l":Bo(Z[0],Z[1]);break;case"c":zr.apply(this,Z);break;case"h":jo()}}return this},p.__private__.rect=p.rect=function(m,N,G,Z,se){if(isNaN(m)||isNaN(N)||isNaN(G)||isNaN(Z)||!li(se))throw new Error("Invalid arguments passed to jsPDF.rect");return L===C&&(Z=-Z),$([X(M(m)),X(B(N)),X(M(G)),X(M(Z)),"re"].join(" ")),fa(se),this},p.__private__.triangle=p.triangle=function(m,N,G,Z,se,ye,xe){if(isNaN(m)||isNaN(N)||isNaN(G)||isNaN(Z)||isNaN(se)||isNaN(ye)||!li(xe))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[G-m,Z-N],[se-G,ye-Z],[m-se,N-ye]],m,N,[1,1],xe,!0),this},p.__private__.roundedRect=p.roundedRect=function(m,N,G,Z,se,ye,xe){if(isNaN(m)||isNaN(N)||isNaN(G)||isNaN(Z)||isNaN(se)||isNaN(ye)||!li(xe))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var $e=4/3*(Math.SQRT2-1);return se=Math.min(se,.5*G),ye=Math.min(ye,.5*Z),this.lines([[G-2*se,0],[se*$e,0,se,ye-ye*$e,se,ye],[0,Z-2*ye],[0,ye*$e,-se*$e,ye,-se,ye],[2*se-G,0],[-se*$e,0,-se,-ye*$e,-se,-ye],[0,2*ye-Z],[0,-ye*$e,se*$e,-ye,se,-ye]],m+se,N,[1,1],xe,!0),this},p.__private__.ellipse=p.ellipse=function(m,N,G,Z,se){if(isNaN(m)||isNaN(N)||isNaN(G)||isNaN(Z)||!li(se))throw new Error("Invalid arguments passed to jsPDF.ellipse");var ye=4/3*(Math.SQRT2-1)*G,xe=4/3*(Math.SQRT2-1)*Z;return Es(m+G,N),zr(m+G,N-xe,m+ye,N-Z,m,N-Z),zr(m-ye,N-Z,m-G,N-xe,m-G,N),zr(m-G,N+xe,m-ye,N+Z,m,N+Z),zr(m+ye,N+Z,m+G,N+xe,m+G,N),fa(se),this},p.__private__.circle=p.circle=function(m,N,G,Z){if(isNaN(m)||isNaN(N)||isNaN(G)||!li(Z))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(m,N,G,G,Z)},p.setFont=function(m,N,G){return G&&(N=V(N,G)),qe=Po(m,N,{disableWarning:!1}),this};var vc=p.__private__.getFont=p.getFont=function(){return bt[Po.apply(p,arguments)]};p.__private__.getFontList=p.getFontList=function(){var m,N,G={};for(m in ct)if(ct.hasOwnProperty(m))for(N in G[m]=[],ct[m])ct[m].hasOwnProperty(N)&&G[m].push(N);return G},p.addFont=function(m,N,G,Z,se){var ye=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&ye.indexOf(arguments[3])!==-1?se=arguments[3]:arguments[3]&&ye.indexOf(arguments[3])==-1&&(G=V(G,Z)),Cn.call(this,m,N,G,se=se||"Identity-H")};var pa,Ls=t.lineWidth||.200025,bc=p.__private__.getLineWidth=p.getLineWidth=function(){return Ls},vt=p.__private__.setLineWidth=p.setLineWidth=function(m){return Ls=m,$(X(M(m))+" w"),this};p.__private__.setLineDash=Xe.API.setLineDash=Xe.API.setLineDashPattern=function(m,N){if(m=m||[],N=N||0,isNaN(N)||!Array.isArray(m))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return m=m.map(function(G){return X(M(G))}).join(" "),N=X(M(N)),$("["+m+"] "+N+" d"),this};var yc=p.__private__.getLineHeight=p.getLineHeight=function(){return we*pa};p.__private__.getLineHeight=p.getLineHeight=function(){return we*pa};var _c=p.__private__.setLineHeightFactor=p.setLineHeightFactor=function(m){return typeof(m=m||1.15)=="number"&&(pa=m),this},wc=p.__private__.getLineHeightFactor=p.getLineHeightFactor=function(){return pa};_c(t.lineHeight);var wi=p.__private__.getHorizontalCoordinate=function(m){return M(m)},xi=p.__private__.getVerticalCoordinate=function(m){return L===P?m:tt[q].mediaBox.topRightY-tt[q].mediaBox.bottomLeftY-M(m)},xc=p.__private__.getHorizontalCoordinateString=p.getHorizontalCoordinateString=function(m){return X(wi(m))},Sc=p.__private__.getVerticalCoordinateString=p.getVerticalCoordinateString=function(m){return X(xi(m))},Ka=t.strokeColor||"0 G";p.__private__.getStrokeColor=p.getDrawColor=function(){return Sn(Ka)},p.__private__.setStrokeColor=p.setDrawColor=function(m,N,G,Z){return Ka=dr({ch1:m,ch2:N,ch3:G,ch4:Z,pdfColorType:"draw",precision:2}),$(Ka),this};var Cs=t.fillColor||"0 g";p.__private__.getFillColor=p.getFillColor=function(){return Sn(Cs)},p.__private__.setFillColor=p.setFillColor=function(m,N,G,Z){return Cs=dr({ch1:m,ch2:N,ch3:G,ch4:Z,pdfColorType:"fill",precision:2}),$(Cs),this};var ma=t.textColor||"0 g",Ac=p.__private__.getTextColor=p.getTextColor=function(){return Sn(ma)};p.__private__.setTextColor=p.setTextColor=function(m,N,G,Z){return ma=dr({ch1:m,ch2:N,ch3:G,ch4:Z,pdfColorType:"text",precision:3}),this};var Si=t.charSpace,kc=p.__private__.getCharSpace=p.getCharSpace=function(){return parseFloat(Si||0)};p.__private__.setCharSpace=p.setCharSpace=function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Si=m,this};var Ts=0;p.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},p.__private__.setLineCap=p.setLineCap=function(m){var N=p.CapJoinStyles[m];if(N===void 0)throw new Error("Line cap style of '"+m+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Ts=N,$(N+" J"),this};var Is=0;p.__private__.setLineJoin=p.setLineJoin=function(m){var N=p.CapJoinStyles[m];if(N===void 0)throw new Error("Line join style of '"+m+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Is=N,$(N+" j"),this},p.__private__.setLineMiterLimit=p.__private__.setMiterLimit=p.setLineMiterLimit=p.setMiterLimit=function(m){if(m=m||0,isNaN(m))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return $(X(M(m))+" M"),this},p.GState=Yl,p.setGState=function(m){(m=typeof m=="string"?st[dt[m]]:Mo(null,m)).equals(Ut)||($("/"+m.id+" gs"),Ut=m)};var Mo=function(m,N){if(!m||!dt[m]){var G=!1;for(var Z in st)if(st.hasOwnProperty(Z)&&st[Z].equals(N)){G=!0;break}if(G)N=st[Z];else{var se="GS"+(Object.keys(st).length+1).toString(10);st[se]=N,N.id=se}return m&&(dt[m]=N.id),Ft.publish("addGState",N),N}};p.addGState=function(m,N){return Mo(m,N),this},p.saveGraphicsState=function(){return $("q"),Dt.push({key:qe,size:we,color:ma}),this},p.restoreGraphicsState=function(){$("Q");var m=Dt.pop();return qe=m.key,we=m.size,ma=m.color,Ut=null,this},p.setCurrentTransformationMatrix=function(m){return $(m.toString()+" cm"),this},p.comment=function(m){return $("#"+m),this};var Ai=function(m,N){var G=m||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return G},set:function(ye){isNaN(ye)||(G=parseFloat(ye))}});var Z=N||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Z},set:function(ye){isNaN(ye)||(Z=parseFloat(ye))}});var se="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return se},set:function(ye){se=ye.toString()}}),this},Ps=function(m,N,G,Z){Ai.call(this,m,N),this.type="rect";var se=G||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return se},set:function(xe){isNaN(xe)||(se=parseFloat(xe))}});var ye=Z||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return ye},set:function(xe){isNaN(xe)||(ye=parseFloat(xe))}}),this},Ja=function(){this.page=kt,this.currentPage=q,this.pages=Ae.slice(0),this.pagesContext=tt.slice(0),this.x=We,this.y=rn,this.matrix=Et,this.width=Rs(q),this.height=$o(q),this.outputDestination=Te,this.id="",this.objectNumber=-1};Ja.prototype.restore=function(){kt=this.page,q=this.currentPage,tt=this.pagesContext,Ae=this.pages,We=this.x,rn=this.y,Et=this.matrix,Uo(q,this.width),ki(q,this.height),Te=this.outputDestination};var Os=function(m,N,G,Z,se){Tr.push(new Ja),kt=q=0,Ae=[],We=m,rn=N,Et=se,Rr([G,Z])};for(var ga in p.beginFormObject=function(m,N,G,Z,se){return Os(m,N,G,Z,se),this},p.endFormObject=function(m){return(function(N){if(Gn[N])Tr.pop().restore();else{var G=new Ja,Z="Xo"+(Object.keys(Ct).length+1).toString(10);G.id=Z,Gn[N]=Z,Ct[Z]=G,Ft.publish("addFormObject",G),Tr.pop().restore()}})(m),this},p.doFormObject=function(m,N){var G=Ct[Gn[m]];return $("q"),$(N.toString()+" cm"),$("/"+G.id+" Do"),$("Q"),this},p.getFormObject=function(m){var N=Ct[Gn[m]];return{x:N.x,y:N.y,width:N.width,height:N.height,matrix:N.matrix}},p.save=function(m,N){return m=m||"generated.pdf",(N=N||{}).returnPromise=N.returnPromise||!1,N.returnPromise===!1?(Ia(Ga(oi()),m),typeof Ia.unload=="function"&&ft.setTimeout&&setTimeout(Ia.unload,911),this):new Promise(function(G,Z){try{var se=Ia(Ga(oi()),m);typeof Ia.unload=="function"&&ft.setTimeout&&setTimeout(Ia.unload,911),G(se)}catch(ye){Z(ye.message)}})},Xe.API)Xe.API.hasOwnProperty(ga)&&(ga==="events"&&Xe.API.events.length?(function(m,N){var G,Z,se;for(se=N.length-1;se!==-1;se--)G=N[se][0],Z=N[se][1],m.subscribe.apply(m,[G].concat(typeof Z=="function"?[Z]:Z))})(Ft,Xe.API.events):p[ga]=Xe.API[ga]);function Rs(m){return tt[m].mediaBox.topRightX-tt[m].mediaBox.bottomLeftX}function Uo(m,N){tt[m].mediaBox.topRightX=N+tt[m].mediaBox.bottomLeftX}function $o(m){return tt[m].mediaBox.topRightY-tt[m].mediaBox.bottomLeftY}function ki(m,N){tt[m].mediaBox.topRightY=N+tt[m].mediaBox.bottomLeftY}var Ni=p.getPageWidth=function(m){return Rs(m=m||q)/gt},qo=p.setPageWidth=function(m,N){Uo(m,N*gt)},va=p.getPageHeight=function(m){return $o(m=m||q)/gt},zo=p.setPageHeight=function(m,N){ki(m,N*gt)};return p.internal={pdfEscape:un,getStyle:Do,getFont:vc,getFontSize:Re,getCharSpace:kc,getTextColor:Ac,getLineHeight:yc,getLineHeightFactor:wc,getLineWidth:bc,write:Ce,getHorizontalCoordinate:wi,getVerticalCoordinate:xi,getCoordinateString:xc,getVerticalCoordinateString:Sc,collections:{},newObject:Pt,newAdditionalObject:ii,newObjectDeferred:Yt,newObjectDeferredBegin:xn,getFilters:hr,putStream:tr,events:Ft,scaleFactor:gt,pageSize:{getWidth:function(){return Ni(q)},setWidth:function(m){qo(q,m)},getHeight:function(){return va(q)},setHeight:function(m){zo(q,m)}},encryptionOptions:h,encryption:Tn,getEncryptor:function(m){return h!==null?Tn.encryptor(m,0):function(N){return N}},output:Ro,getNumberOfPages:ha,get pages(){return Ae},out:$,f2:k,f3:A,getPageInfo:_i,getPageInfoByObjId:Fo,getCurrentPageInfo:hc,getPDFVersion:w,Point:Ai,Rectangle:Ps,Matrix:rt,hasHotfix:Fr},Object.defineProperty(p.internal.pageSize,"width",{get:function(){return Ni(q)},set:function(m){qo(q,m)},enumerable:!0,configurable:!0}),Object.defineProperty(p.internal.pageSize,"height",{get:function(){return va(q)},set:function(m){zo(q,m)},enumerable:!0,configurable:!0}),(function(m){for(var N=0,G=He.length;N<G;N++){var Z=Cn.call(this,m[N][0],m[N][1],m[N][2],He[N][3],!0);g===!1&&(b[Z]=!0);var se=m[N][0].split("-");en({id:Z,fontName:se[0],fontStyle:se[1]||""})}Ft.publish("addFonts",{fonts:bt,dictionary:ct})}).call(p,He),qe="F1",$i(i,n),Ft.publish("initialized"),p}fs.prototype.lsbFirstWord=function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)},fs.prototype.toHexString=function(t){return t.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},fs.prototype.hexToBytes=function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(String.fromCharCode(parseInt(t.substr(n,2),16)));return e.join("")},fs.prototype.processOwnerPassword=function(t,e){return ad(id(e).substr(0,5),t)},fs.prototype.encryptor=function(t,e){var n=id(this.encryptionKey+String.fromCharCode(255&t,t>>8&255,t>>16&255,255&e,e>>8&255)).substr(0,10);return function(r){return ad(n,r)}},Yl.prototype.equals=function(t){var e,n="id,objectNumber,equals";if(!t||Ht(t)!==Ht(this))return!1;var r=0;for(e in this)if(!(n.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!t.hasOwnProperty(e)||this[e]!==t[e])return!1;r++}for(e in t)t.hasOwnProperty(e)&&n.indexOf(e)<0&&r--;return r===0},Xe.API={events:[]},Xe.version="4.2.0";var fn=Xe.API,Ld=1,Ha=function(t){return t.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},ls=function(t){return t.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},qa=function(t){return t.toString().replace(/#/g,"#23").replace(/[\s\n\r()<>[\]{}\/%]/g,function(e){var n=e.charCodeAt(0).toString(16).toUpperCase();return"#"+(n.length===1?"0"+n:n)})},yt=function(t){return t.toFixed(2)},ia=function(t){return t.toFixed(5)};fn.__acroform__={};var mr=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},cp=function(t){return t*Ld},pi=function(t){var e=new ig,n=Be.internal.getHeight(t)||0,r=Be.internal.getWidth(t)||0;return e.BBox=[0,0,Number(yt(r)),Number(yt(n))],e},xy=fn.__acroform__.setBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return t|1<<e},Sy=fn.__acroform__.clearBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return t&~(1<<e)},Ay=fn.__acroform__.getBit=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return t&1<<e?1:0},yn=fn.__acroform__.getBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Ay(t,e-1)},_n=fn.__acroform__.setBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return xy(t,e-1)},wn=fn.__acroform__.clearBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Sy(t,e-1)},ky=fn.__acroform__.calculateCoordinates=function(t,e){var n=e.internal.getHorizontalCoordinate,r=e.internal.getVerticalCoordinate,i=t[0],a=t[1],o=t[2],l=t[3],c={};return c.lowerLeft_X=n(i)||0,c.lowerLeft_Y=r(a+l)||0,c.upperRight_X=n(i+o)||0,c.upperRight_Y=r(a)||0,[Number(yt(c.lowerLeft_X)),Number(yt(c.lowerLeft_Y)),Number(yt(c.upperRight_X)),Number(yt(c.upperRight_Y))]},Ny=function(t){if(t.appearanceStreamContent)return t.appearanceStreamContent;if(t.V||t.DV){var e=[],n=t._V||t.DV,r=sd(t,n),i=t.scope.internal.getFont(t.fontName,t.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(t.scope.__private__.encodeColorString(t.color)),e.push("/"+i+" "+yt(r.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(r.text),e.push("ET"),e.push("Q"),e.push("EMC");var a=pi(t);return a.scope=t.scope,a.stream=e.join(`
`),a}},sd=function(t,e){var n=t.fontSize===0?t.maxFontSize:t.fontSize,r={text:"",fontSize:""},i=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");i=t.multiline?i.map(function(k){return k.split(`
`)}):i.map(function(k){return[k]});var a=n,o=Be.internal.getHeight(t)||0;o=o<0?-o:o;var l=Be.internal.getWidth(t)||0;l=l<0?-l:l;var c=function(k,A,M){if(k+1<i.length){var B=A+" "+i[k+1][0];return El(B,t,M).width<=l-4}return!1};a++;e:for(;a>0;){e="",a--;var d,h,g=El("3",t,a).height,b=t.multiline?o-a:(o-g)/2,p=b+=2,y=0,w=0,S=0;if(a<=0){e=`(...) Tj
`,e+="% Width of Text: "+El(e,t,a=12).width+", FieldWidth:"+l+`
`;break}for(var x="",C=0,P=0;P<i.length;P++)if(i.hasOwnProperty(P)){var L=!1;if(i[P].length!==1&&S!==i[P].length-1){if((g+2)*(C+2)+2>o)continue e;x+=i[P][S],L=!0,w=P,P--}else{x=(x+=i[P][S]+" ").substr(x.length-1)==" "?x.substr(0,x.length-1):x;var U=parseInt(P),ee=c(U,x,a),V=P>=i.length-1;if(ee&&!V){x+=" ",S=0;continue}if(ee||V){if(V)w=U;else if(t.multiline&&(g+2)*(C+2)+2>o)continue e}else{if(!t.multiline||(g+2)*(C+2)+2>o)continue e;w=U}}for(var X="",D=y;D<=w;D++){var I=i[D];if(t.multiline){if(D===w){X+=I[S]+" ",S=(S+1)%I.length;continue}if(D===y){X+=I[I.length-1]+" ";continue}}X+=I[0]+" "}switch(X=X.substr(X.length-1)==" "?X.substr(0,X.length-1):X,h=El(X,t,a).width,t.textAlign){case"right":d=l-h-2;break;case"center":d=(l-h)/2;break;default:d=2}e+=yt(d)+" "+yt(p)+` Td
`,e+="("+Ha(X)+`) Tj
`,e+=-yt(d)+` 0 Td
`,p=-(a+2),h=0,y=L?w:w+1,C++,x=""}break}return r.text=e,r.fontSize=a,r},El=function(t,e,n){var r=e.scope.internal.getFont(e.fontName,e.fontStyle),i=e.scope.getStringUnitWidth(t,{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n);return{height:e.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n)*1.5,width:i}},Ey={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Ly=function(t,e){var n={type:"reference",object:t};e.internal.getPageInfo(t.page).pageContext.annotations.find(function(r){return r.type===n.type&&r.object===n.object})===void 0&&e.internal.getPageInfo(t.page).pageContext.annotations.push(n)},Cy=function(t,e){if(e.scope=t,t.internal!==void 0&&(t.internal.acroformPlugin===void 0||t.internal.acroformPlugin.isInitialized===!1)){if(ni.FieldNum=0,t.internal.acroformPlugin=JSON.parse(JSON.stringify(Ey)),t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Ld=t.internal.scaleFactor,t.internal.acroformPlugin.acroFormDictionaryRoot=new ag,t.internal.acroformPlugin.acroFormDictionaryRoot.scope=t,t.internal.acroformPlugin.acroFormDictionaryRoot._eventID=t.internal.events.subscribe("postPutResources",function(){(function(n){n.internal.events.unsubscribe(n.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete n.internal.acroformPlugin.acroFormDictionaryRoot._eventID,n.internal.acroformPlugin.printedOut=!0})(t)}),t.internal.events.subscribe("buildDocument",function(){(function(n){n.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var r=n.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var i in r)if(r.hasOwnProperty(i)){var a=r[i];a.objId=void 0,a.hasAnnotation&&Ly(a,n)}})(t)}),t.internal.events.subscribe("putCatalog",function(){(function(n){if(n.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");n.internal.write("/AcroForm "+n.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(t)}),t.internal.events.subscribe("postPutPages",function(n){(function(r,i){var a=!r;for(var o in r||(i.internal.newObjectDeferredBegin(i.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),i.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),r=r||i.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(r.hasOwnProperty(o)){var l=r[o],c=[],d=l.Rect;if(l.Rect&&(l.Rect=ky(l.Rect,i)),i.internal.newObjectDeferredBegin(l.objId,!0),l.DA=Be.createDefaultAppearanceStream(l),Ht(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(c=l.getKeyValueListForStream()),l.Rect=d,l.hasAppearanceStream&&!l.appearanceStreamContent){var h=Ny(l);c.push({key:"AP",value:"<</N "+h+">>"}),i.internal.acroformPlugin.xForms.push(h)}if(l.appearanceStreamContent){var g="";for(var b in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(b)){var p=l.appearanceStreamContent[b];if(g+="/"+b+" ",g+="<<",Object.keys(p).length>=1||Array.isArray(p)){for(var o in p)if(p.hasOwnProperty(o)){var y=p[o];typeof y=="function"&&(y=y.call(i,l)),g+="/"+o+" "+y+" ",i.internal.acroformPlugin.xForms.indexOf(y)>=0||i.internal.acroformPlugin.xForms.push(y)}}else typeof(y=p)=="function"&&(y=y.call(i,l)),g+="/"+o+" "+y,i.internal.acroformPlugin.xForms.indexOf(y)>=0||i.internal.acroformPlugin.xForms.push(y);g+=">>"}c.push({key:"AP",value:`<<
`+g+">>"})}i.internal.putStream({additionalKeyValues:c,objectId:l.objId}),i.internal.out("endobj")}a&&(function(w,S){for(var x in w)if(w.hasOwnProperty(x)){var C=x,P=w[x];S.internal.newObjectDeferredBegin(P.objId,!0),Ht(P)==="object"&&typeof P.putStream=="function"&&P.putStream(),delete w[C]}})(i.internal.acroformPlugin.xForms,i)})(n,t)}),t.internal.acroformPlugin.isInitialized=!0}},rg=fn.__acroform__.arrayToPdfArray=function(t,e,n){var r=function(o){return o};if(Array.isArray(t)){for(var i="[",a=0;a<t.length;a++)switch(a!==0&&(i+=" "),Ht(t[a])){case"boolean":case"number":case"object":i+=t[a].toString();break;case"string":t[a].substr(0,1)==="/"?i+="/"+qa(t[a].substr(1)):(e!==void 0&&n&&(r=n.internal.getEncryptor(e)),i+="("+Ha(r(t[a].toString()))+")")}return i+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},wu=function(t,e,n){var r=function(i){return i};return e!==void 0&&n&&(r=n.internal.getEncryptor(e)),(t=t||"").toString(),"("+Ha(r(t))+")"},vi=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(t){this._objId=t}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};vi.prototype.toString=function(){return this.objId+" 0 R"},vi.prototype.putStream=function(){var t=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:t,objectId:this.objId}),this.scope.internal.out("endobj")},vi.prototype.getKeyValueListForStream=function(){var t=[],e=Object.getOwnPropertyNames(this).filter(function(a){return a!="content"&&a!="appearanceStreamContent"&&a!="scope"&&a!="objId"&&a.substring(0,1)!="_"});for(var n in e)if(Object.getOwnPropertyDescriptor(this,e[n]).configurable===!1){var r=e[n],i=this[r];i&&(Array.isArray(i)?t.push({key:r,value:rg(i,this.objId,this.scope)}):i instanceof vi?(i.scope=this.scope,t.push({key:r,value:i.objId+" 0 R"})):typeof i!="function"&&t.push({key:r,value:i}))}return t};var ig=function(){vi.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var t,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(n){e=n}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(n){t=n.trim()},get:function(){return t||null}})};mr(ig,vi);var ag=function(){vi.call(this);var t,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(t){var n=function(r){return r};return this.scope&&(n=this.scope.internal.getEncryptor(this.objId)),"("+Ha(n(t))+")"}},set:function(n){t=n}})};mr(ag,vi);var ni=function t(){vi.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(x){if(isNaN(x))throw new Error('Invalid value "'+x+'" for attribute F supplied.');e=x}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!yn(e,3)},set:function(x){x?this.F=_n(e,3):this.F=wn(e,3)}});var n=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return n},set:function(x){if(isNaN(x))throw new Error('Invalid value "'+x+'" for attribute Ff supplied.');n=x}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(r.length!==0)return r},set:function(x){r=x!==void 0?x:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(x){r[0]=x}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(x){r[1]=x}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(x){r[2]=x}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(x){r[3]=x}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(x){switch(x){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=x;break;default:throw new Error('Invalid value "'+x+'" for attribute FT supplied.')}}});var a=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!a||a.length<1){if(this instanceof Xl)return;a="FieldObject"+t.FieldNum++}var x=function(C){return C};return this.scope&&(x=this.scope.internal.getEncryptor(this.objId)),"("+Ha(x(a))+")"},set:function(x){a=x.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return a},set:function(x){a=x}});var o="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return o},set:function(x){o=x}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(x){l=x}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(x){c=x}});var d=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return d===void 0?50/Ld:d},set:function(x){d=x}});var h="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return h},set:function(x){h=x}});var g="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!g||this instanceof Xl||this instanceof Ba))return wu(g,this.objId,this.scope)},set:function(x){x=x.toString(),g=x}});var b=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(b)return this instanceof Bn==0?wu(b,this.objId,this.scope):b},set:function(x){x=x.toString(),b=this instanceof Bn==0?x.substr(0,1)==="("?ls(x.substr(1,x.length-2)):ls(x):x}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Bn==1?ls(b.substr(1,b.length-1)):b},set:function(x){x=x.toString(),b=this instanceof Bn==1?"/"+qa(x):x}});var p=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(p)return p},set:function(x){this.V=x}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(p)return this instanceof Bn==0?wu(p,this.objId,this.scope):p},set:function(x){x=x.toString(),p=this instanceof Bn==0?x.substr(0,1)==="("?ls(x.substr(1,x.length-2)):ls(x):x}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Bn==1?ls(p.substr(1,p.length-1)):p},set:function(x){x=x.toString(),p=this instanceof Bn==1?"/"+qa(x):x}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var y,w=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return w},set:function(x){x=!!x,w=x}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(y)return y},set:function(x){y=x}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,1)},set:function(x){x?this.Ff=_n(this.Ff,1):this.Ff=wn(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,2)},set:function(x){x?this.Ff=_n(this.Ff,2):this.Ff=wn(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,3)},set:function(x){x?this.Ff=_n(this.Ff,3):this.Ff=wn(this.Ff,3)}});var S=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(S!==null)return S},set:function(x){if([0,1,2].indexOf(x)===-1)throw new Error('Invalid value "'+x+'" for attribute Q supplied.');S=x}}),Object.defineProperty(this,"textAlign",{get:function(){var x;switch(S){case 0:default:x="left";break;case 1:x="center";break;case 2:x="right"}return x},configurable:!0,enumerable:!0,set:function(x){switch(x){case"right":case 2:S=2;break;case"center":case 1:S=1;break;default:S=0}}})};mr(ni,vi);var bs=function(){ni.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var t=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return t},set:function(n){t=n}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return t},set:function(n){t=n}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return rg(e,this.objId,this.scope)},set:function(n){var r,i;i=[],typeof(r=n)=="string"&&(i=(function(a,o,l){l||(l=1);for(var c,d=[];c=o.exec(a);)d.push(c[l]);return d})(r,/\((.*?)\)/g)),e=i}}),this.getOptions=function(){return e},this.setOptions=function(n){e=n,this.sort&&e.sort()},this.addOption=function(n){n=(n=n||"").toString(),e.push(n),this.sort&&e.sort()},this.removeOption=function(n,r){for(r=r||!1,n=(n=n||"").toString();e.indexOf(n)!==-1&&(e.splice(e.indexOf(n),1),r!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,18)},set:function(n){n?this.Ff=_n(this.Ff,18):this.Ff=wn(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,19)},set:function(n){this.combo===!0&&(n?this.Ff=_n(this.Ff,19):this.Ff=wn(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,20)},set:function(n){n?(this.Ff=_n(this.Ff,20),e.sort()):this.Ff=wn(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,22)},set:function(n){n?this.Ff=_n(this.Ff,22):this.Ff=wn(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,23)},set:function(n){n?this.Ff=_n(this.Ff,23):this.Ff=wn(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,27)},set:function(n){n?this.Ff=_n(this.Ff,27):this.Ff=wn(this.Ff,27)}}),this.hasAppearanceStream=!1};mr(bs,ni);var ys=function(){bs.call(this),this.fontName="helvetica",this.combo=!1};mr(ys,bs);var _s=function(){ys.call(this),this.combo=!0};mr(_s,ys);var Fl=function(){_s.call(this),this.edit=!0};mr(Fl,_s);var Bn=function(){ni.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,15)},set:function(n){n?this.Ff=_n(this.Ff,15):this.Ff=wn(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,16)},set:function(n){n?this.Ff=_n(this.Ff,16):this.Ff=wn(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,17)},set:function(n){n?this.Ff=_n(this.Ff,17):this.Ff=wn(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,26)},set:function(n){n?this.Ff=_n(this.Ff,26):this.Ff=wn(this.Ff,26)}});var t,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var n=function(a){return a};if(this.scope&&(n=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var r,i=[];for(r in i.push("<<"),e)i.push("/"+r+" ("+Ha(n(e[r]))+")");return i.push(">>"),i.join(`
`)}},set:function(n){Ht(n)==="object"&&(e=n)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(n){typeof n=="string"&&(e.CA=n)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(n){var r=n==null?"":n.toString();r.substr(0,1)==="/"&&(r=r.substr(1)),t="/"+qa(r)}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(n){t="/"+qa(n)}})};mr(Bn,ni);var Dl=function(){Bn.call(this),this.pushButton=!0};mr(Dl,Bn);var ws=function(){Bn.call(this),this.radio=!0,this.pushButton=!1;var t=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e!==void 0?e:[]}})};mr(ws,Bn);var Xl=function(){var t,e;ni.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return t},set:function(i){t=i}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(i){e=i}});var n,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var i=function(l){return l};this.scope&&(i=this.scope.internal.getEncryptor(this.objId));var a,o=[];for(a in o.push("<<"),r)o.push("/"+a+" ("+Ha(i(r[a]))+")");return o.push(">>"),o.join(`
`)},set:function(i){Ht(i)==="object"&&(r=i)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(i){typeof i=="string"&&(r.CA=i)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(i){var a=i==null?"":i.toString();a.substr(0,1)==="/"&&(a=a.substr(1)),n="/"+qa(a)}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(i){var a=i==null?"":i.toString();a.substr(0,1)==="/"&&(a=a.substr(1)),n="/"+qa(a)}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Be.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};mr(Xl,ni),ws.prototype.setAppearance=function(t){if(!("createAppearanceStream"in t)||!("getCA"in t))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var n=this.Kids[e];n.appearanceStreamContent=t.createAppearanceStream(n.optionName),n.caption=t.getCA()}},ws.prototype.createOption=function(t){var e=new Xl;return e.Parent=this,e.optionName=t,this.Kids.push(e),Ty.call(this.scope,e),e};var jl=function(){Bn.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Be.CheckBox.createAppearanceStream()};mr(jl,Bn);var Ba=function(){ni.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,13)},set:function(e){e?this.Ff=_n(this.Ff,13):this.Ff=wn(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,21)},set:function(e){e?this.Ff=_n(this.Ff,21):this.Ff=wn(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,23)},set:function(e){e?this.Ff=_n(this.Ff,23):this.Ff=wn(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,24)},set:function(e){e?this.Ff=_n(this.Ff,24):this.Ff=wn(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,25)},set:function(e){e?this.Ff=_n(this.Ff,25):this.Ff=wn(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,26)},set:function(e){e?this.Ff=_n(this.Ff,26):this.Ff=wn(this.Ff,26)}});var t=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){Number.isInteger(e)&&(t=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};mr(Ba,ni);var Bl=function(){Ba.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,14)},set:function(t){t?this.Ff=_n(this.Ff,14):this.Ff=wn(this.Ff,14)}}),this.password=!0};mr(Bl,Ba);var Be={CheckBox:{createAppearanceStream:function(){return{N:{On:Be.CheckBox.YesNormal},D:{On:Be.CheckBox.YesPushDown,Off:Be.CheckBox.OffPushDown}}},YesPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=t.scope.internal.getFont(t.fontName,t.fontStyle).id,i=t.scope.__private__.encodeColorString(t.color),a=sd(t,t.caption);return n.push("0.749023 g"),n.push("0 0 "+yt(Be.internal.getWidth(t))+" "+yt(Be.internal.getHeight(t))+" re"),n.push("f"),n.push("BMC"),n.push("q"),n.push("0 0 1 rg"),n.push("/"+r+" "+yt(a.fontSize)+" Tf "+i),n.push("BT"),n.push(a.text),n.push("ET"),n.push("Q"),n.push("EMC"),e.stream=n.join(`
`),e},YesNormal:function(t){var e=pi(t);e.scope=t.scope;var n=t.scope.internal.getFont(t.fontName,t.fontStyle).id,r=t.scope.__private__.encodeColorString(t.color),i=[],a=Be.internal.getHeight(t),o=Be.internal.getWidth(t),l=sd(t,t.caption);return i.push("1 g"),i.push("0 0 "+yt(o)+" "+yt(a)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+yt(o-1)+" "+yt(a-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+n+" "+yt(l.fontSize)+" Tf "+r),i.push(l.text),i.push("ET"),i.push("Q"),e.stream=i.join(`
`),e},OffPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+yt(Be.internal.getWidth(t))+" "+yt(Be.internal.getHeight(t))+" re"),n.push("f"),e.stream=n.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(t){var e={D:{Off:Be.RadioButton.Circle.OffPushDown},N:{}};return e.N[t]=Be.RadioButton.Circle.YesNormal,e.D[t]=Be.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=Be.internal.getWidth(t)<=Be.internal.getHeight(t)?Be.internal.getWidth(t)/4:Be.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var i=Be.internal.Bezier_C,a=Number((r*i).toFixed(5));return n.push("q"),n.push("1 0 0 1 "+ia(Be.internal.getWidth(t)/2)+" "+ia(Be.internal.getHeight(t)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+a+" "+a+" "+r+" 0 "+r+" c"),n.push("-"+a+" "+r+" -"+r+" "+a+" -"+r+" 0 c"),n.push("-"+r+" -"+a+" -"+a+" -"+r+" 0 -"+r+" c"),n.push(a+" -"+r+" "+r+" -"+a+" "+r+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join(`
`),e},YesPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=Be.internal.getWidth(t)<=Be.internal.getHeight(t)?Be.internal.getWidth(t)/4:Be.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var i=Number((2*r).toFixed(5)),a=Number((i*Be.internal.Bezier_C).toFixed(5)),o=Number((r*Be.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+ia(Be.internal.getWidth(t)/2)+" "+ia(Be.internal.getHeight(t)/2)+" cm"),n.push(i+" 0 m"),n.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),n.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),n.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),n.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),n.push("f"),n.push("Q"),n.push("0 g"),n.push("q"),n.push("1 0 0 1 "+ia(Be.internal.getWidth(t)/2)+" "+ia(Be.internal.getHeight(t)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+o+" "+o+" "+r+" 0 "+r+" c"),n.push("-"+o+" "+r+" -"+r+" "+o+" -"+r+" 0 c"),n.push("-"+r+" -"+o+" -"+o+" -"+r+" 0 -"+r+" c"),n.push(o+" -"+r+" "+r+" -"+o+" "+r+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=Be.internal.getWidth(t)<=Be.internal.getHeight(t)?Be.internal.getWidth(t)/4:Be.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var i=Number((2*r).toFixed(5)),a=Number((i*Be.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+ia(Be.internal.getWidth(t)/2)+" "+ia(Be.internal.getHeight(t)/2)+" cm"),n.push(i+" 0 m"),n.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),n.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),n.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),n.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join(`
`),e}},Cross:{createAppearanceStream:function(t){var e={D:{Off:Be.RadioButton.Cross.OffPushDown},N:{}};return e.N[t]=Be.RadioButton.Cross.YesNormal,e.D[t]=Be.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=Be.internal.calculateCross(t);return n.push("q"),n.push("1 1 "+yt(Be.internal.getWidth(t)-2)+" "+yt(Be.internal.getHeight(t)-2)+" re"),n.push("W"),n.push("n"),n.push(yt(r.x1.x)+" "+yt(r.x1.y)+" m"),n.push(yt(r.x2.x)+" "+yt(r.x2.y)+" l"),n.push(yt(r.x4.x)+" "+yt(r.x4.y)+" m"),n.push(yt(r.x3.x)+" "+yt(r.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join(`
`),e},YesPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=Be.internal.calculateCross(t),r=[];return r.push("0.749023 g"),r.push("0 0 "+yt(Be.internal.getWidth(t))+" "+yt(Be.internal.getHeight(t))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+yt(Be.internal.getWidth(t)-2)+" "+yt(Be.internal.getHeight(t)-2)+" re"),r.push("W"),r.push("n"),r.push(yt(n.x1.x)+" "+yt(n.x1.y)+" m"),r.push(yt(n.x2.x)+" "+yt(n.x2.y)+" l"),r.push(yt(n.x4.x)+" "+yt(n.x4.y)+" m"),r.push(yt(n.x3.x)+" "+yt(n.x3.y)+" l"),r.push("s"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+yt(Be.internal.getWidth(t))+" "+yt(Be.internal.getHeight(t))+" re"),n.push("f"),e.stream=n.join(`
`),e}}},createDefaultAppearanceStream:function(t){var e=t.scope.internal.getFont(t.fontName,t.fontStyle).id,n=t.scope.__private__.encodeColorString(t.color);return"/"+e+" "+t.fontSize+" Tf "+n}};Be.internal={Bezier_C:.551915024494,calculateCross:function(t){var e=Be.internal.getWidth(t),n=Be.internal.getHeight(t),r=Math.min(e,n);return{x1:{x:(e-r)/2,y:(n-r)/2+r},x2:{x:(e-r)/2+r,y:(n-r)/2},x3:{x:(e-r)/2,y:(n-r)/2},x4:{x:(e-r)/2+r,y:(n-r)/2+r}}}},Be.internal.getWidth=function(t){var e=0;return Ht(t)==="object"&&(e=cp(t.Rect[2])),e},Be.internal.getHeight=function(t){var e=0;return Ht(t)==="object"&&(e=cp(t.Rect[3])),e};var Ty=fn.addField=function(t){if(Cy(this,t),!(t instanceof ni))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=t).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),t.page=t.scope.internal.getCurrentPageInfo().pageNumber,this};fn.AcroFormChoiceField=bs,fn.AcroFormListBox=ys,fn.AcroFormComboBox=_s,fn.AcroFormEditBox=Fl,fn.AcroFormButton=Bn,fn.AcroFormPushButton=Dl,fn.AcroFormRadioButton=ws,fn.AcroFormCheckBox=jl,fn.AcroFormTextField=Ba,fn.AcroFormPasswordField=Bl,fn.AcroFormAppearance=Be,fn.AcroForm={ChoiceField:bs,ListBox:ys,ComboBox:_s,EditBox:Fl,Button:Bn,PushButton:Dl,RadioButton:ws,CheckBox:jl,TextField:Ba,PasswordField:Bl,Appearance:Be},Xe.AcroForm={ChoiceField:bs,ListBox:ys,ComboBox:_s,EditBox:Fl,Button:Bn,PushButton:Dl,RadioButton:ws,CheckBox:jl,TextField:Ba,PasswordField:Bl,Appearance:Be};Xe.AcroForm;function sg(t){return t.reduce(function(e,n,r){return e[n]=r,e},{})}(function(t){var e="addImage_";t.__addimage__={};var n="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},i=t.__addimage__.getImageFileTypeByImageData=function(k,A){var M,B,J,oe,ue,ae=n;if((A=A||n)==="RGBA"||k.data!==void 0&&k.data instanceof Uint8ClampedArray&&"height"in k&&"width"in k)return"RGBA";if(ee(k))for(ue in r)for(J=r[ue],M=0;M<J.length;M+=1){for(oe=!0,B=0;B<J[M].length;B+=1)if(J[M][B]!==void 0&&J[M][B]!==k[B]){oe=!1;break}if(oe===!0){ae=ue;break}}else for(ue in r)for(J=r[ue],M=0;M<J.length;M+=1){for(oe=!0,B=0;B<J[M].length;B+=1)if(J[M][B]!==void 0&&J[M][B]!==k.charCodeAt(B)){oe=!1;break}if(oe===!0){ae=ue;break}}return ae===n&&A!==n&&(ae=A),ae},a=function k(A){for(var M=this.internal.write,B=this.internal.putStream,J=(0,this.internal.getFilters)();J.indexOf("FlateEncode")!==-1;)J.splice(J.indexOf("FlateEncode"),1);A.objectId=this.internal.newObject();var oe=[];if(oe.push({key:"Type",value:"/XObject"}),oe.push({key:"Subtype",value:"/Image"}),oe.push({key:"Width",value:A.width}),oe.push({key:"Height",value:A.height}),A.colorSpace===x.INDEXED?oe.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(A.palette.length/3-1)+" "+("sMask"in A&&A.sMask!==void 0?A.objectId+2:A.objectId+1)+" 0 R]"}):(oe.push({key:"ColorSpace",value:"/"+A.colorSpace}),A.colorSpace===x.DEVICE_CMYK&&oe.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),oe.push({key:"BitsPerComponent",value:A.bitsPerComponent}),"decodeParameters"in A&&A.decodeParameters!==void 0&&oe.push({key:"DecodeParms",value:"<<"+A.decodeParameters+">>"}),"transparency"in A&&Array.isArray(A.transparency)&&A.transparency.length>0){for(var ue="",ae=0,fe=A.transparency.length;ae<fe;ae++)ue+=A.transparency[ae]+" "+A.transparency[ae]+" ";oe.push({key:"Mask",value:"["+ue+"]"})}A.sMask!==void 0&&oe.push({key:"SMask",value:A.objectId+1+" 0 R"});var ke=A.filter!==void 0?["/"+A.filter]:void 0;if(B({data:A.data,additionalKeyValues:oe,alreadyAppliedFilters:ke,objectId:A.objectId}),M("endobj"),"sMask"in A&&A.sMask!==void 0){var pe,O=(pe=A.sMaskBitsPerComponent)!==null&&pe!==void 0?pe:A.bitsPerComponent,q={width:A.width,height:A.height,colorSpace:"DeviceGray",bitsPerComponent:O,data:A.sMask};"filter"in A&&(q.decodeParameters="/Predictor ".concat(A.predictor," /Colors 1 /BitsPerComponent ").concat(O," /Columns ").concat(A.width),q.filter=A.filter),k.call(this,q)}if(A.colorSpace===x.INDEXED){var K=this.internal.newObject();B({data:X(new Uint8Array(A.palette)),objectId:K}),M("endobj")}},o=function(){var k=this.internal.collections[e+"images"];for(var A in k)a.call(this,k[A])},l=function(){var k,A=this.internal.collections[e+"images"],M=this.internal.write;for(var B in A)M("/I"+(k=A[B]).index,k.objectId,"0","R")},c=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",l))},d=function(){var k=this.internal.collections[e+"images"];return c.call(this),k},h=function(){return Object.keys(this.internal.collections[e+"images"]).length},g=function(k){return typeof t["process"+k.toUpperCase()]=="function"},b=function(k){return Ht(k)==="object"&&k.nodeType===1},p=function(k,A){if(k.nodeName==="IMG"&&k.hasAttribute("src")){var M=""+k.getAttribute("src");if(M.indexOf("data:image/")===0)return Rl(unescape(M).split("base64,").pop());var B=t.loadFile(M,!0);if(B!==void 0)return B}if(k.nodeName==="CANVAS"){if(k.width===0||k.height===0)throw new Error("Given canvas must have data. Canvas width: "+k.width+", height: "+k.height);var J;switch(A){case"PNG":J="image/png";break;case"WEBP":J="image/webp";break;default:J="image/jpeg"}return Rl(k.toDataURL(J,1).split("base64,").pop())}},y=function(k){var A=this.internal.collections[e+"images"];if(A){for(var M in A)if(k===A[M].alias)return A[M]}},w=function(k,A,M){return k||A||(k=-96,A=-96),k<0&&(k=-1*M.width*72/k/this.internal.scaleFactor),A<0&&(A=-1*M.height*72/A/this.internal.scaleFactor),k===0&&(k=A*M.width/M.height),A===0&&(A=k*M.height/M.width),[k,A]},S=function(k,A,M,B,J,oe){var ue=w.call(this,M,B,J),ae=this.internal.getCoordinateString,fe=this.internal.getVerticalCoordinateString,ke=d.call(this);if(M=ue[0],B=ue[1],ke[J.index]=J,oe){oe*=Math.PI/180;var pe=Math.cos(oe),O=Math.sin(oe),q=function(Y){return Y.toFixed(4)},K=[q(pe),q(O),q(-1*O),q(pe),0,0,"cm"]}this.internal.write("q"),oe?(this.internal.write([1,"0","0",1,ae(k),fe(A+B),"cm"].join(" ")),this.internal.write(K.join(" ")),this.internal.write([ae(M),"0","0",ae(B),"0","0","cm"].join(" "))):this.internal.write([ae(M),"0","0",ae(B),ae(k),fe(A+B),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+J.index+" Do"),this.internal.write("Q")},x=t.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};t.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var C=t.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},P=t.__addimage__.sHashCode=function(k){var A,M,B=0;if(typeof k=="string")for(M=k.length,A=0;A<M;A++)B=(B<<5)-B+k.charCodeAt(A),B|=0;else if(ee(k))for(M=k.byteLength/2,A=0;A<M;A++)B=(B<<5)-B+k[A],B|=0;return B},L=t.__addimage__.validateStringAsBase64=function(k){(k=k||"").toString().trim();var A=!0;return k.length===0&&(A=!1),k.length%4!=0&&(A=!1),/^[A-Za-z0-9+/]+$/.test(k.substr(0,k.length-2))===!1&&(A=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(k.substr(-2))===!1&&(A=!1),A},U=t.__addimage__.extractImageFromDataUrl=function(k){if(k==null||!(k=k.trim()).startsWith("data:"))return null;var A=k.indexOf(",");return A<0?null:k.substring(0,A).trim().endsWith("base64")?k.substring(A+1):null};t.__addimage__.isArrayBuffer=function(k){return k instanceof ArrayBuffer};var ee=t.__addimage__.isArrayBufferView=function(k){return k instanceof Int8Array||k instanceof Uint8Array||k instanceof Uint8ClampedArray||k instanceof Int16Array||k instanceof Uint16Array||k instanceof Int32Array||k instanceof Uint32Array||k instanceof Float32Array||k instanceof Float64Array},V=t.__addimage__.binaryStringToUint8Array=function(k){for(var A=k.length,M=new Uint8Array(A),B=0;B<A;B++)M[B]=k.charCodeAt(B);return M},X=t.__addimage__.arrayBufferToBinaryString=function(k){for(var A="",M=ee(k)?k:new Uint8Array(k),B=0;B<M.length;B+=8192)A+=String.fromCharCode.apply(null,M.subarray(B,B+8192));return A};t.addImage=function(){var k,A,M,B,J,oe,ue,ae,fe;if(typeof arguments[1]=="number"?(A=n,M=arguments[1],B=arguments[2],J=arguments[3],oe=arguments[4],ue=arguments[5],ae=arguments[6],fe=arguments[7]):(A=arguments[1],M=arguments[2],B=arguments[3],J=arguments[4],oe=arguments[5],ue=arguments[6],ae=arguments[7],fe=arguments[8]),Ht(k=arguments[0])==="object"&&!b(k)&&"imageData"in k){var ke=k;k=ke.imageData,A=ke.format||A||n,M=ke.x||M||0,B=ke.y||B||0,J=ke.w||ke.width||J,oe=ke.h||ke.height||oe,ue=ke.alias||ue,ae=ke.compression||ae,fe=ke.rotation||ke.angle||fe}var pe=this.internal.getFilters();if(ae===void 0&&pe.indexOf("FlateEncode")!==-1&&(ae="SLOW"),isNaN(M)||isNaN(B))throw new Error("Invalid coordinates passed to jsPDF.addImage");c.call(this);var O=D.call(this,k,A,ue,ae);return S.call(this,M,B,J,oe,O,fe),this};var D=function(k,A,M,B){var J,oe,ue;if(typeof k=="string"&&i(k)===n){k=unescape(k);var ae=I(k,!1);(ae!==""||(ae=t.loadFile(k,!0))!==void 0)&&(k=ae)}if(b(k)&&(k=p(k,A)),A=i(k,A),!g(A))throw new Error("addImage does not support files of type '"+A+"', please ensure that a plugin for '"+A+"' support is added.");if(((ue=M)==null||ue.length===0)&&(M=(function(fe){return typeof fe=="string"||ee(fe)?P(fe):ee(fe.data)?P(fe.data):null})(k)),(J=y.call(this,M))||(k instanceof Uint8Array||A==="RGBA"||(oe=k,k=V(k)),J=this["process"+A.toUpperCase()](k,h.call(this),M,(function(fe){return fe&&typeof fe=="string"&&(fe=fe.toUpperCase()),fe in t.image_compression?fe:C.NONE})(B),oe)),!J)throw new Error("An unknown error occurred whilst processing the image.");return J},I=t.__addimage__.convertBase64ToBinaryString=function(k,A){A=typeof A!="boolean"||A;var M,B="";if(typeof k=="string"){var J;M=(J=U(k))!==null&&J!==void 0?J:k;try{B=Rl(M)}catch(oe){if(A)throw L(M)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+oe.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return B};t.getImageProperties=function(k){var A,M,B="";if(b(k)&&(k=p(k)),typeof k=="string"&&i(k)===n&&((B=I(k,!1))===""&&(B=t.loadFile(k)||""),k=B),M=i(k),!g(M))throw new Error("addImage does not support files of type '"+M+"', please ensure that a plugin for '"+M+"' support is added.");if(k instanceof Uint8Array||(k=V(k)),!(A=this["process"+M.toUpperCase()](k)))throw new Error("An unknown error occurred whilst processing the image");return A.fileType=M,A}})(Xe.API),(function(t){var e=function(n){if(n!==void 0&&n!="")return!0};Xe.API.events.push(["addPage",function(n){this.internal.getPageInfo(n.pageNumber).pageContext.annotations=[]}]),t.events.push(["putPage",function(n){for(var r,i,a,o=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,c=this.internal.getPageInfoByObjId(n.objId),d=n.pageContext.annotations,h=!1,g=0;g<d.length&&!h;g++)switch((r=d[g]).type){case"link":(e(r.options.url)||e(r.options.pageNumber))&&(h=!0);break;case"reference":case"text":case"freetext":h=!0}if(h!=0){this.internal.write("/Annots [");for(var b=0;b<d.length;b++){r=d[b];var p=this.internal.pdfEscape,y=this.internal.getEncryptor(n.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var w=this.internal.newAdditionalObject(),S=this.internal.newAdditionalObject(),x=this.internal.getEncryptor(w.objId),C=r.title||"Note";a="<</Type /Annot /Subtype /Text "+(i="/Rect ["+o(r.bounds.x)+" "+l(r.bounds.y+r.bounds.h)+" "+o(r.bounds.x+r.bounds.w)+" "+l(r.bounds.y)+"] ")+"/Contents ("+p(x(r.contents))+")",a+=" /Popup "+S.objId+" 0 R",a+=" /P "+c.objId+" 0 R",a+=" /T ("+p(x(C))+") >>",w.content=a;var P=w.objId+" 0 R";a="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+o(r.bounds.x+30)+" "+l(r.bounds.y+r.bounds.h)+" "+o(r.bounds.x+r.bounds.w+30)+" "+l(r.bounds.y)+"] ")+" /Parent "+P,r.open&&(a+=" /Open true"),a+=" >>",S.content=a,this.internal.write(w.objId,"0 R",S.objId,"0 R");break;case"freetext":i="/Rect ["+o(r.bounds.x)+" "+l(r.bounds.y)+" "+o(r.bounds.x+r.bounds.w)+" "+l(r.bounds.y+r.bounds.h)+"] ";var L=r.color||"#000000";a="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+p(y(r.contents))+")",a+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+L+")",a+=" /Border [0 0 0]",a+=" >>",this.internal.write(a);break;case"link":if(r.options.name){var U=this.annotations._nameMap[r.options.name];r.options.pageNumber=U.page,r.options.top=U.y}else r.options.top||(r.options.top=0);if(i="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",a="",r.options.url)a="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+p(y(r.options.url))+") >>";else if(r.options.pageNumber)switch(a="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":a+=" /Fit]";break;case"FitH":a+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,a+=" /FitV "+r.options.left+"]";break;default:var ee=l(r.options.top);r.options.left=r.options.left||0,r.options.zoom===void 0&&(r.options.zoom=0),a+=" /XYZ "+r.options.left+" "+ee+" "+r.options.zoom+"]"}a!=""&&(a+=" >>",this.internal.write(a))}}this.internal.write("]")}}]),t.createAnnotation=function(n){var r=this.internal.getCurrentPageInfo();switch(n.type){case"link":this.link(n.bounds.x,n.bounds.y,n.bounds.w,n.bounds.h,n);break;case"text":case"freetext":r.pageContext.annotations.push(n)}},t.link=function(n,r,i,a,o){var l=this.internal.getCurrentPageInfo(),c=this.internal.getCoordinateString,d=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:c(n),y:d(r),w:c(n+i),h:d(r+a)},options:o,type:"link"})},t.textWithLink=function(n,r,i,a){var o,l,c=this.getTextWidth(n),d=this.internal.getLineHeight()/this.internal.scaleFactor;if(a.maxWidth!==void 0){l=a.maxWidth;var h=this.splitTextToSize(n,l).length;o=Math.ceil(d*h)}else l=c,o=d;return this.text(n,r,i,a),i+=.2*d,a.align==="center"&&(r-=c/2),a.align==="right"&&(r-=c),this.link(r,i-d,l,o,a),c},t.getTextWidth=function(n){var r=this.internal.getFontSize();return this.getStringUnitWidth(n)*r/this.internal.scaleFactor}})(Xe.API),(function(t){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},n={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];t.__arabicParser__={};var a=t.__arabicParser__.isInArabicSubstitutionA=function(w){return e[w.charCodeAt(0)]!==void 0},o=t.__arabicParser__.isArabicLetter=function(w){return typeof w=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(w)},l=t.__arabicParser__.isArabicEndLetter=function(w){return o(w)&&a(w)&&e[w.charCodeAt(0)].length<=2},c=t.__arabicParser__.isArabicAlfLetter=function(w){return o(w)&&i.indexOf(w.charCodeAt(0))>=0};t.__arabicParser__.arabicLetterHasIsolatedForm=function(w){return o(w)&&a(w)&&e[w.charCodeAt(0)].length>=1};var d=t.__arabicParser__.arabicLetterHasFinalForm=function(w){return o(w)&&a(w)&&e[w.charCodeAt(0)].length>=2};t.__arabicParser__.arabicLetterHasInitialForm=function(w){return o(w)&&a(w)&&e[w.charCodeAt(0)].length>=3};var h=t.__arabicParser__.arabicLetterHasMedialForm=function(w){return o(w)&&a(w)&&e[w.charCodeAt(0)].length==4},g=t.__arabicParser__.resolveLigatures=function(w){var S=0,x=n,C="",P=0;for(S=0;S<w.length;S+=1)x[w.charCodeAt(S)]!==void 0?(P++,typeof(x=x[w.charCodeAt(S)])=="number"&&(C+=String.fromCharCode(x),x=n,P=0),S===w.length-1&&(x=n,C+=w.charAt(S-(P-1)),S-=P-1,P=0)):(x=n,C+=w.charAt(S-P),S-=P,P=0);return C};t.__arabicParser__.isArabicDiacritic=function(w){return w!==void 0&&r[w.charCodeAt(0)]!==void 0};var b=t.__arabicParser__.getCorrectForm=function(w,S,x){return o(w)?a(w)===!1?-1:!d(w)||!o(S)&&!o(x)||!o(x)&&l(S)||l(w)&&!o(S)||l(w)&&c(S)||l(w)&&l(S)?0:h(w)&&o(S)&&!l(S)&&o(x)&&d(x)?3:l(w)||!o(x)?1:2:-1},p=function(w){var S=0,x=0,C=0,P="",L="",U="",ee=(w=w||"").split("\\s+"),V=[];for(S=0;S<ee.length;S+=1){for(V.push(""),x=0;x<ee[S].length;x+=1)P=ee[S][x],L=ee[S][x-1],U=ee[S][x+1],o(P)?(C=b(P,L,U),V[S]+=C!==-1?String.fromCharCode(e[P.charCodeAt(0)][C]):P):V[S]+=P;V[S]=g(V[S])}return V.join(" ")},y=t.__arabicParser__.processArabic=t.processArabic=function(){var w,S=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,x=[];if(Array.isArray(S)){var C=0;for(x=[],C=0;C<S.length;C+=1)Array.isArray(S[C])?x.push([p(S[C][0]),S[C][1],S[C][2]]):x.push([p(S[C])]);w=x}else w=p(S);return typeof arguments[0]=="string"?w:(arguments[0].text=w,arguments[0])};t.events.push(["preProcessText",y])})(Xe.API),Xe.API.autoPrint=function(t){var e;return(t=t||{}).variant=t.variant||"non-conform",t.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},(function(t){var e=function(){var n=void 0;Object.defineProperty(this,"pdf",{get:function(){return n},set:function(l){n=l}});var r=150;Object.defineProperty(this,"width",{get:function(){return r},set:function(l){r=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=r+1)}});var i=300;Object.defineProperty(this,"height",{get:function(){return i},set:function(l){i=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=i+1)}});var a=[];Object.defineProperty(this,"childNodes",{get:function(){return a},set:function(l){a=l}});var o={};Object.defineProperty(this,"style",{get:function(){return o},set:function(l){o=l}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(n,r){var i;if((n=n||"2d")!=="2d")return null;for(i in r)this.pdf.context2d.hasOwnProperty(i)&&(this.pdf.context2d[i]=r[i]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},t.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])})(Xe.API),(function(t){var e={left:0,top:0,bottom:0,right:0},n=!1,r=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new a,this.internal.__cell__.pages=1},a=function(){var c=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return c},set:function(w){c=w}});var d=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return d},set:function(w){d=w}});var h=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return h},set:function(w){h=w}});var g=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return g},set:function(w){g=w}});var b=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return b},set:function(w){b=w}});var p=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return p},set:function(w){p=w}});var y=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return y},set:function(w){y=w}}),this};a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},a.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},t.setHeaderFunction=function(c){return r.call(this),this.internal.__cell__.headerFunction=typeof c=="function"?c:void 0,this},t.getTextDimensions=function(c,d){r.call(this);var h=(d=d||{}).fontSize||this.getFontSize(),g=d.font||this.getFont(),b=d.scaleFactor||this.internal.scaleFactor,p=0,y=0,w=0,S=this;if(!Array.isArray(c)&&typeof c!="string"){if(typeof c!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");c=String(c)}var x=d.maxWidth;x>0?typeof c=="string"?c=this.splitTextToSize(c,x):Object.prototype.toString.call(c)==="[object Array]"&&(c=c.reduce(function(P,L){return P.concat(S.splitTextToSize(L,x))},[])):c=Array.isArray(c)?c:[c];for(var C=0;C<c.length;C++)p<(w=this.getStringUnitWidth(c[C],{font:g})*h)&&(p=w);return p!==0&&(y=c.length),{w:p/=b,h:Math.max((y*h*this.getLineHeightFactor()-h*(this.getLineHeightFactor()-1))/b,0)}},t.cellAddPage=function(){r.call(this),this.addPage();var c=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new a(c.left,c.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var o=t.cell=function(){var c;c=arguments[0]instanceof a?arguments[0]:new a(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),r.call(this);var d=this.internal.__cell__.lastCell,h=this.internal.__cell__.padding,g=this.internal.__cell__.margins||e,b=this.internal.__cell__.tableHeaderRow,p=this.internal.__cell__.printHeaders;return d.lineNumber!==void 0&&(d.lineNumber===c.lineNumber?(c.x=(d.x||0)+(d.width||0),c.y=d.y||0):d.y+d.height+c.height+g.bottom>this.getPageHeight()?(this.cellAddPage(),c.y=g.top,p&&b&&(this.printHeaderRow(c.lineNumber,!0),c.y+=b[0].height)):c.y=d.y+d.height||c.y),c.text[0]!==void 0&&(this.rect(c.x,c.y,c.width,c.height,n===!0?"FD":void 0),c.align==="right"?this.text(c.text,c.x+c.width-h,c.y+h,{align:"right",baseline:"top"}):c.align==="center"?this.text(c.text,c.x+c.width/2,c.y+h,{align:"center",baseline:"top",maxWidth:c.width-h-h}):this.text(c.text,c.x+h,c.y+h,{align:"left",baseline:"top",maxWidth:c.width-h-h})),this.internal.__cell__.lastCell=c,this};t.table=function(c,d,h,g,b){if(r.call(this),!h)throw new Error("No data for PDF table.");var p,y,w,S,x=[],C=[],P=[],L={},U={},ee=[],V=[],X=(b=b||{}).autoSize||!1,D=b.printHeaders!==!1,I=b.css&&b.css["font-size"]!==void 0?16*b.css["font-size"]:b.fontSize||12,k=b.margins||Object.assign({width:this.getPageWidth()},e),A=typeof b.padding=="number"?b.padding:3,M=b.headerBackgroundColor||"#c8c8c8",B=b.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=D,this.internal.__cell__.margins=k,this.internal.__cell__.table_font_size=I,this.internal.__cell__.padding=A,this.internal.__cell__.headerBackgroundColor=M,this.internal.__cell__.headerTextColor=B,this.setFontSize(I),g==null)C=x=Object.keys(h[0]),P=x.map(function(){return"left"});else if(Array.isArray(g)&&Ht(g[0])==="object")for(x=g.map(function(ke){return ke.name}),C=g.map(function(ke){return ke.prompt||ke.name||""}),P=g.map(function(ke){return ke.align||"left"}),p=0;p<g.length;p+=1)U[g[p].name]=.7499990551181103*g[p].width;else Array.isArray(g)&&typeof g[0]=="string"&&(C=x=g,P=x.map(function(){return"left"}));if(X||Array.isArray(g)&&typeof g[0]=="string")for(p=0;p<x.length;p+=1){for(L[S=x[p]]=h.map(function(ke){return ke[S]}),this.setFont(void 0,"bold"),ee.push(this.getTextDimensions(C[p],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),y=L[S],this.setFont(void 0,"normal"),w=0;w<y.length;w+=1)ee.push(this.getTextDimensions(y[w],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);U[S]=Math.max.apply(null,ee)+A+A,ee=[]}if(D){var J={};for(p=0;p<x.length;p+=1)J[x[p]]={},J[x[p]].text=C[p],J[x[p]].align=P[p];var oe=l.call(this,J,U);V=x.map(function(ke){return new a(c,d,U[ke],oe,J[ke].text,void 0,J[ke].align)}),this.setTableHeaderRow(V),this.printHeaderRow(1,!1)}var ue=g.reduce(function(ke,pe){return ke[pe.name]=pe.align,ke},{});for(p=0;p<h.length;p+=1){"rowStart"in b&&b.rowStart instanceof Function&&b.rowStart({row:p,data:h[p]},this);var ae=l.call(this,h[p],U);for(w=0;w<x.length;w+=1){var fe=h[p][x[w]];"cellStart"in b&&b.cellStart instanceof Function&&b.cellStart({row:p,col:w,data:fe},this),o.call(this,new a(c,d,U[x[w]],ae,fe,p+2,ue[x[w]]))}}return this.internal.__cell__.table_x=c,this.internal.__cell__.table_y=d,this};var l=function(c,d){var h=this.internal.__cell__.padding,g=this.internal.__cell__.table_font_size,b=this.internal.scaleFactor;return Object.keys(c).map(function(p){var y=c[p];return this.splitTextToSize(y.hasOwnProperty("text")?y.text:y,d[p]-h-h)},this).map(function(p){return this.getLineHeightFactor()*p.length*g/b+h+h},this).reduce(function(p,y){return Math.max(p,y)},0)};t.setTableHeaderRow=function(c){r.call(this),this.internal.__cell__.tableHeaderRow=c},t.printHeaderRow=function(c,d){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var h;if(n=!0,typeof this.internal.__cell__.headerFunction=="function"){var g=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new a(g[0],g[1],g[2],g[3],void 0,-1)}this.setFont(void 0,"bold");for(var b=[],p=0;p<this.internal.__cell__.tableHeaderRow.length;p+=1){h=this.internal.__cell__.tableHeaderRow[p].clone(),d&&(h.y=this.internal.__cell__.margins.top||0,b.push(h)),h.lineNumber=c;var y=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),o.call(this,h),this.setTextColor(y)}b.length>0&&this.setTableHeaderRow(b),this.setFont(void 0,"normal"),n=!1}})(Xe.API);var og={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},lg=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],od=sg(lg),cg=[100,200,300,400,500,600,700,800,900],Iy=sg(cg);function xu(t){var e=t.family.replace(/"|'/g,"").toLowerCase(),n=(function(a){return og[a=a||"normal"]?a:"normal"})(t.style),r=(function(a){return a?typeof a=="number"?a>=100&&a<=900&&a%100==0?a:400:/^\d00$/.test(a)?parseInt(a):a==="bold"?700:400:400})(t.weight),i=(function(a){return typeof od[a=a||"normal"]=="number"?a:"normal"})(t.stretch);return{family:e,style:n,weight:r,stretch:i,src:t.src||[],ref:t.ref||{name:e,style:[i,n,r].join(" ")}}}function up(t,e,n,r){var i;for(i=n;i>=0&&i<e.length;i+=r)if(t[e[i]])return t[e[i]];for(i=n;i>=0&&i<e.length;i-=r)if(t[e[i]])return t[e[i]]}var Py={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},dp={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function hp(t){return[t.stretch,t.style,t.weight,t.family].join(" ")}function fp(t){return t.trimLeft()}function Oy(t,e){for(var n=0;n<t.length;){if(t.charAt(n)===e)return[t.substring(0,n),t.substring(n+1)];n+=1}return null}function Ry(t){var e=t.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],t.substring(e[0].length)]}var cs,Ll,pp,mp,gp,Su=["times"];function vp(t,e,n,r,i){var a=4,o=yp;switch(i){case Xe.API.image_compression.FAST:a=1,o=bp;break;case Xe.API.image_compression.MEDIUM:a=6,o=_p;break;case Xe.API.image_compression.SLOW:a=9,o=wp}t=(function(c,d,h,g){for(var b,p=c.length/d,y=new Uint8Array(c.length+p),w=[Fy,bp,yp,_p,wp],S=0;S<p;S+=1){var x=S*d,C=c.subarray(x,x+d);if(g)y.set(g(C,h,b),x+S);else{for(var P=w.length,L=[],U=0;U<P;U+=1)L[U]=w[U](C,h,b);var ee=jy(L.concat());y.set(L[ee],x+S)}b=C}return y})(t,e,Math.ceil(n*r/8),o);var l=ed(t,{level:a});return Xe.API.__addimage__.arrayBufferToBinaryString(l)}function Fy(t){var e=Array.apply([],t);return e.unshift(0),e}function bp(t,e){var n=t.length,r=[];r[0]=1;for(var i=0;i<n;i+=1){var a=t[i-e]||0;r[i+1]=t[i]-a+256&255}return r}function yp(t,e,n){var r=t.length,i=[];i[0]=2;for(var a=0;a<r;a+=1){var o=n&&n[a]||0;i[a+1]=t[a]-o+256&255}return i}function _p(t,e,n){var r=t.length,i=[];i[0]=3;for(var a=0;a<r;a+=1){var o=t[a-e]||0,l=n&&n[a]||0;i[a+1]=t[a]+256-(o+l>>>1)&255}return i}function wp(t,e,n){var r=t.length,i=[];i[0]=4;for(var a=0;a<r;a+=1){var o=Dy(t[a-e]||0,n&&n[a]||0,n&&n[a-e]||0);i[a+1]=t[a]-o+256&255}return i}function Dy(t,e,n){if(t===e&&e===n)return t;var r=Math.abs(e-n),i=Math.abs(t-n),a=Math.abs(t+e-n-n);return r<=i&&r<=a?t:i<=a?e:n}function jy(t){var e=t.map(function(n){return n.reduce(function(r,i){return r+Math.abs(i)},0)});return e.indexOf(Math.min.apply(null,e))}function Au(t,e,n){var r=e*n,i=Math.floor(r/8),a=16-(r-8*i+n),o=(1<<n)-1;return ug(t,i)>>a&o}function xp(t,e,n,r){var i=n*r,a=Math.floor(i/8),o=16-(i-8*a+r),l=(1<<r)-1,c=(e&l)<<o;(function(d,h,g){if(h+1<d.byteLength)d.setUint16(h,g,!1);else{var b=g>>8&255;d.setUint8(h,b)}})(t,a,ug(t,a)&~(l<<o)&65535|c)}function ug(t,e){return e+1<t.byteLength?t.getUint16(e,!1):t.getUint8(e)<<8}function By(t){var e=0;if(t[e++]!==71||t[e++]!==73||t[e++]!==70||t[e++]!==56||(t[e++]+1&253)!=56||t[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var n=t[e++]|t[e++]<<8,r=t[e++]|t[e++]<<8,i=t[e++],a=i>>7,o=1<<1+(7&i);t[e++],t[e++];var l=null,c=null;a&&(l=e,c=o,e+=3*o);var d=!0,h=[],g=0,b=null,p=0,y=null;for(this.width=n,this.height=r;d&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(t[e]!==11||t[e+1]==78&&t[e+2]==69&&t[e+3]==84&&t[e+4]==83&&t[e+5]==67&&t[e+6]==65&&t[e+7]==80&&t[e+8]==69&&t[e+9]==50&&t[e+10]==46&&t[e+11]==48&&t[e+12]==3&&t[e+13]==1&&t[e+16]==0)e+=14,y=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((k=t[e++])>=0))throw Error("Invalid block size");if(k===0)break;e+=k}break;case 249:if(t[e++]!==4||t[e+4]!==0)throw new Error("Invalid graphics extension block.");var w=t[e++];g=t[e++]|t[e++]<<8,b=t[e++],1&w||(b=null),p=w>>2&7,e++;break;case 254:for(;;){if(!((k=t[e++])>=0))throw Error("Invalid block size");if(k===0)break;e+=k}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var S=t[e++]|t[e++]<<8,x=t[e++]|t[e++]<<8,C=t[e++]|t[e++]<<8,P=t[e++]|t[e++]<<8,L=t[e++],U=L>>6&1,ee=1<<1+(7&L),V=l,X=c,D=!1;L>>7&&(D=!0,V=e,X=ee,e+=3*ee);var I=e;for(e++;;){var k;if(!((k=t[e++])>=0))throw Error("Invalid block size");if(k===0)break;e+=k}h.push({x:S,y:x,width:C,height:P,has_local_palette:D,palette_offset:V,palette_size:X,data_offset:I,data_length:e-I,transparent_index:b,interlaced:!!U,delay:g,disposal:p});break;case 59:d=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return h.length},this.loopCount=function(){return y},this.frameInfo=function(A){if(A<0||A>=h.length)throw new Error("Frame index out of range.");return h[A]},this.decodeAndBlitFrameBGRA=function(A,M){var B=this.frameInfo(A),J=B.width*B.height;if(J>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");var oe=new Uint8Array(J);Sp(t,B.data_offset,oe,J);var ue=B.palette_offset,ae=B.transparent_index;ae===null&&(ae=256);var fe=B.width,ke=n-fe,pe=fe,O=4*(B.y*n+B.x),q=4*((B.y+B.height)*n+B.x),K=O,Y=4*ke;B.interlaced===!0&&(Y+=4*n*7);for(var Q=8,z=0,re=oe.length;z<re;++z){var ce=oe[z];if(pe===0&&(pe=fe,(K+=Y)>=q&&(Y=4*ke+4*n*(Q-1),K=O+(fe+ke)*(Q<<1),Q>>=1)),ce===ae)K+=4;else{var ge=t[ue+3*ce],Ae=t[ue+3*ce+1],Pe=t[ue+3*ce+2];M[K++]=Pe,M[K++]=Ae,M[K++]=ge,M[K++]=255}--pe}},this.decodeAndBlitFrameRGBA=function(A,M){var B=this.frameInfo(A),J=B.width*B.height;if(J>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");var oe=new Uint8Array(J);Sp(t,B.data_offset,oe,J);var ue=B.palette_offset,ae=B.transparent_index;ae===null&&(ae=256);var fe=B.width,ke=n-fe,pe=fe,O=4*(B.y*n+B.x),q=4*((B.y+B.height)*n+B.x),K=O,Y=4*ke;B.interlaced===!0&&(Y+=4*n*7);for(var Q=8,z=0,re=oe.length;z<re;++z){var ce=oe[z];if(pe===0&&(pe=fe,(K+=Y)>=q&&(Y=4*ke+4*n*(Q-1),K=O+(fe+ke)*(Q<<1),Q>>=1)),ce===ae)K+=4;else{var ge=t[ue+3*ce],Ae=t[ue+3*ce+1],Pe=t[ue+3*ce+2];M[K++]=ge,M[K++]=Ae,M[K++]=Pe,M[K++]=255}--pe}}}function Sp(t,e,n,r){for(var i=t[e++],a=1<<i,o=a+1,l=o+1,c=i+1,d=(1<<c)-1,h=0,g=0,b=0,p=t[e++],y=new Int32Array(4096),w=null;;){for(;h<16&&p!==0;)g|=t[e++]<<h,h+=8,p===1?p=t[e++]:--p;if(h<c)break;var S=g&d;if(g>>=c,h-=c,S!==a){if(S===o)break;for(var x=S<l?S:w,C=0,P=x;P>a;)P=y[P]>>8,++C;var L=P;if(b+C+(x!==S?1:0)>r)return void Kt.log("Warning, gif stream longer than expected.");n[b++]=L;var U=b+=C;for(x!==S&&(n[b++]=L),P=x;C--;)P=y[P],n[--U]=255&P,P>>=8;w!==null&&l<4096&&(y[l++]=w<<8|L,l>=d+1&&c<12&&(++c,d=d<<1|1)),w=S}else l=o+1,d=(1<<(c=i+1))-1,w=null}return b!==r&&Kt.log("Warning, gif stream shorter than expected."),n}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function ku(t){var e,n,r,i,a,o=Math.floor,l=new Array(64),c=new Array(64),d=new Array(64),h=new Array(64),g=new Array(65535),b=new Array(65535),p=new Array(64),y=new Array(64),w=[],S=0,x=7,C=new Array(64),P=new Array(64),L=new Array(64),U=new Array(256),ee=new Array(2048),V=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],X=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],D=[0,1,2,3,4,5,6,7,8,9,10,11],I=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],k=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],A=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],M=[0,1,2,3,4,5,6,7,8,9,10,11],B=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],J=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function oe(O,q){for(var K=0,Y=0,Q=new Array,z=1;z<=16;z++){for(var re=1;re<=O[z];re++)Q[q[Y]]=[],Q[q[Y]][0]=K,Q[q[Y]][1]=z,Y++,K++;K*=2}return Q}function ue(O){for(var q=O[0],K=O[1]-1;K>=0;)q&1<<K&&(S|=1<<x),K--,--x<0&&(S==255?(ae(255),ae(0)):ae(S),x=7,S=0)}function ae(O){w.push(O)}function fe(O){ae(O>>8&255),ae(255&O)}function ke(O,q,K,Y,Q){for(var z,re=Q[0],ce=Q[240],ge=(function(we,Ke){var Re,Qe,Ie,it,nt,at,ut,pt,qe,gt,We=0;for(qe=0;qe<8;++qe){Re=we[We],Qe=we[We+1],Ie=we[We+2],it=we[We+3],nt=we[We+4],at=we[We+5],ut=we[We+6];var rn=Re+(pt=we[We+7]),Et=Re-pt,bt=Qe+ut,ct=Qe-ut,Dt=Ie+at,et=Ie-at,jt=it+nt,st=it-nt,dt=rn+jt,Ut=rn-jt,kt=bt+Dt,tt=bt-Dt;we[We]=dt+kt,we[We+4]=dt-kt;var Ft=.707106781*(tt+Ut);we[We+2]=Ut+Ft,we[We+6]=Ut-Ft;var yi=.382683433*((dt=st+et)-(tt=ct+Et)),Ct=.5411961*dt+yi,Gn=1.306562965*tt+yi,Tr=.707106781*(kt=et+ct),rt=Et+Tr,gr=Et-Tr;we[We+5]=gr+Ct,we[We+3]=gr-Ct,we[We+1]=rt+Gn,we[We+7]=rt-Gn,We+=8}for(We=0,qe=0;qe<8;++qe){Re=we[We],Qe=we[We+8],Ie=we[We+16],it=we[We+24],nt=we[We+32],at=we[We+40],ut=we[We+48];var Ir=Re+(pt=we[We+56]),er=Re-pt,cr=Qe+ut,Pt=Qe-ut,Yt=Ie+at,xn=Ie-at,ii=it+nt,Pr=it-nt,ur=Ir+ii,Sn=Ir-ii,dr=cr+Yt,hr=cr-Yt;we[We]=ur+dr,we[We+32]=ur-dr;var tr=.707106781*(hr+Sn);we[We+16]=Sn+tr,we[We+48]=Sn-tr;var ai=.382683433*((ur=Pr+xn)-(hr=Pt+er)),Or=.5411961*ur+ai,Ue=1.306562965*hr+ai,te=.707106781*(dr=xn+Pt),Ne=er+te,Fe=er-te;we[We+40]=Fe+Or,we[We+24]=Fe-Or,we[We+8]=Ne+Ue,we[We+56]=Ne-Ue,We++}for(qe=0;qe<64;++qe)gt=we[qe]*Ke[qe],p[qe]=gt>0?gt+.5|0:gt-.5|0;return p})(O,q),Ae=0;Ae<64;++Ae)y[V[Ae]]=ge[Ae];var Pe=y[0]-K;K=y[0],Pe==0?ue(Y[0]):(ue(Y[b[z=32767+Pe]]),ue(g[z]));for(var Te=63;Te>0&&y[Te]==0;)Te--;if(Te==0)return ue(re),K;for(var Me,$=1;$<=Te;){for(var Ce=$;y[$]==0&&$<=Te;)++$;var ht=$-Ce;if(ht>=16){Me=ht>>4;for(var He=1;He<=Me;++He)ue(ce);ht&=15}z=32767+y[$],ue(Q[(ht<<4)+b[z]]),ue(g[z]),$++}return Te!=63&&ue(re),K}function pe(O){O=Math.min(Math.max(O,1),100),a!=O&&((function(q){for(var K=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Y=0;Y<64;Y++){var Q=o((K[Y]*q+50)/100);Q=Math.min(Math.max(Q,1),255),l[V[Y]]=Q}for(var z=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],re=0;re<64;re++){var ce=o((z[re]*q+50)/100);ce=Math.min(Math.max(ce,1),255),c[V[re]]=ce}for(var ge=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Ae=0,Pe=0;Pe<8;Pe++)for(var Te=0;Te<8;Te++)d[Ae]=1/(l[V[Ae]]*ge[Pe]*ge[Te]*8),h[Ae]=1/(c[V[Ae]]*ge[Pe]*ge[Te]*8),Ae++})(O<50?Math.floor(5e3/O):Math.floor(200-2*O)),a=O)}this.encode=function(O,q){q&&pe(q),w=new Array,S=0,x=7,fe(65496),fe(65504),fe(16),ae(74),ae(70),ae(73),ae(70),ae(0),ae(1),ae(1),ae(0),fe(1),fe(1),ae(0),ae(0),(function(){fe(65499),fe(132),ae(0);for(var Qe=0;Qe<64;Qe++)ae(l[Qe]);ae(1);for(var Ie=0;Ie<64;Ie++)ae(c[Ie])})(),(function(Qe,Ie){fe(65472),fe(17),ae(8),fe(Ie),fe(Qe),ae(3),ae(1),ae(17),ae(0),ae(2),ae(17),ae(1),ae(3),ae(17),ae(1)})(O.width,O.height),(function(){fe(65476),fe(418),ae(0);for(var Qe=0;Qe<16;Qe++)ae(X[Qe+1]);for(var Ie=0;Ie<=11;Ie++)ae(D[Ie]);ae(16);for(var it=0;it<16;it++)ae(I[it+1]);for(var nt=0;nt<=161;nt++)ae(k[nt]);ae(1);for(var at=0;at<16;at++)ae(A[at+1]);for(var ut=0;ut<=11;ut++)ae(M[ut]);ae(17);for(var pt=0;pt<16;pt++)ae(B[pt+1]);for(var qe=0;qe<=161;qe++)ae(J[qe])})(),fe(65498),fe(12),ae(3),ae(1),ae(0),ae(2),ae(17),ae(3),ae(17),ae(0),ae(63),ae(0);var K=0,Y=0,Q=0;S=0,x=7,this.encode.displayName="_encode_";for(var z,re,ce,ge,Ae,Pe,Te,Me,$,Ce=O.data,ht=O.width,He=O.height,we=4*ht,Ke=0;Ke<He;){for(z=0;z<we;){for(Ae=we*Ke+z,Te=-1,Me=0,$=0;$<64;$++)Pe=Ae+(Me=$>>3)*we+(Te=4*(7&$)),Ke+Me>=He&&(Pe-=we*(Ke+1+Me-He)),z+Te>=we&&(Pe-=z+Te-we+4),re=Ce[Pe++],ce=Ce[Pe++],ge=Ce[Pe++],C[$]=(ee[re]+ee[ce+256|0]+ee[ge+512|0]>>16)-128,P[$]=(ee[re+768|0]+ee[ce+1024|0]+ee[ge+1280|0]>>16)-128,L[$]=(ee[re+1280|0]+ee[ce+1536|0]+ee[ge+1792|0]>>16)-128;K=ke(C,d,K,e,r),Y=ke(P,h,Y,n,i),Q=ke(L,h,Q,n,i),z+=32}Ke+=8}if(x>=0){var Re=[];Re[1]=x+1,Re[0]=(1<<x+1)-1,ue(Re)}return fe(65497),new Uint8Array(w)},t=t||50,(function(){for(var O=String.fromCharCode,q=0;q<256;q++)U[q]=O(q)})(),e=oe(X,D),n=oe(A,M),r=oe(I,k),i=oe(B,J),(function(){for(var O=1,q=2,K=1;K<=15;K++){for(var Y=O;Y<q;Y++)b[32767+Y]=K,g[32767+Y]=[],g[32767+Y][1]=K,g[32767+Y][0]=Y;for(var Q=-(q-1);Q<=-O;Q++)b[32767+Q]=K,g[32767+Q]=[],g[32767+Q][1]=K,g[32767+Q][0]=q-1+Q;O<<=1,q<<=1}})(),(function(){for(var O=0;O<256;O++)ee[O]=19595*O,ee[O+256|0]=38470*O,ee[O+512|0]=7471*O+32768,ee[O+768|0]=-11059*O,ee[O+1024|0]=-21709*O,ee[O+1280|0]=32768*O+8421375,ee[O+1536|0]=-27439*O,ee[O+1792|0]=-5329*O})(),pe(t)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Kr(t,e){if(this.pos=0,this.buffer=t,this.datav=new DataView(t.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Ap(t){function e(D){if(!D)throw Error("assert :P")}function n(D,I,k){for(var A=0;4>A;A++)if(D[I+A]!=k.charCodeAt(A))return!0;return!1}function r(D,I,k,A,M){for(var B=0;B<M;B++)D[I+B]=k[A+B]}function i(D,I,k,A){for(var M=0;M<A;M++)D[I+M]=k}function a(D){return new Int32Array(D)}function o(D,I){for(var k=[],A=0;A<D;A++)k.push(new I);return k}function l(D,I){var k=[];return(function A(M,B,J){for(var oe=J[B],ue=0;ue<oe&&(M.push(J.length>B+1?[]:new I),!(J.length<B+1));ue++)A(M[ue],B+1,J)})(k,0,D),k}var c=function(){var D=this;function I(u,f){for(var v=1<<f-1>>>0;u&v;)v>>>=1;return v?(u&v-1)+v:u}function k(u,f,v,_,E){e(!(_%v));do u[f+(_-=v)]=E;while(0<_)}function A(u,f,v,_,E){if(e(2328>=E),512>=E)var T=a(512);else if((T=a(E))==null)return 0;return(function(R,F,j,H,ne,he){var W,ie,le=F,ve=1<<j,de=a(16),be=a(16);for(e(ne!=0),e(H!=null),e(R!=null),e(0<j),ie=0;ie<ne;++ie){if(15<H[ie])return 0;++de[H[ie]]}if(de[0]==ne)return 0;for(be[1]=0,W=1;15>W;++W){if(de[W]>1<<W)return 0;be[W+1]=be[W]+de[W]}for(ie=0;ie<ne;++ie)W=H[ie],0<H[ie]&&(he[be[W]++]=ie);if(be[15]==1)return(H=new M).g=0,H.value=he[0],k(R,le,1,ve,H),ve;var _e,Ee=-1,Se=ve-1,Ze=0,De=1,xt=1,Ge=1<<j;for(ie=0,W=1,ne=2;W<=j;++W,ne<<=1){if(De+=xt<<=1,0>(xt-=de[W]))return 0;for(;0<de[W];--de[W])(H=new M).g=W,H.value=he[ie++],k(R,le+Ze,ne,Ge,H),Ze=I(Ze,W)}for(W=j+1,ne=2;15>=W;++W,ne<<=1){if(De+=xt<<=1,0>(xt-=de[W]))return 0;for(;0<de[W];--de[W]){if(H=new M,(Ze&Se)!=Ee){for(le+=Ge,_e=1<<(Ee=W)-j;15>Ee&&!(0>=(_e-=de[Ee]));)++Ee,_e<<=1;ve+=Ge=1<<(_e=Ee-j),R[F+(Ee=Ze&Se)].g=_e+j,R[F+Ee].value=le-F-Ee}H.g=W-j,H.value=he[ie++],k(R,le+(Ze>>j),ne,Ge,H),Ze=I(Ze,W)}}return De!=2*be[15]-1?0:ve})(u,f,v,_,E,T)}function M(){this.value=this.g=0}function B(){this.value=this.g=0}function J(){this.G=o(5,M),this.H=a(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=o(Sa,B)}function oe(u,f,v,_){e(u!=null),e(f!=null),e(2147483648>_),u.Ca=254,u.I=0,u.b=-8,u.Ka=0,u.oa=f,u.pa=v,u.Jd=f,u.Yc=v+_,u.Zc=4<=_?v+_-4+1:v,re(u)}function ue(u,f){for(var v=0;0<f--;)v|=ge(u,128)<<f;return v}function ae(u,f){var v=ue(u,f);return ce(u)?-v:v}function fe(u,f,v,_){var E,T=0;for(e(u!=null),e(f!=null),e(4294967288>_),u.Sb=_,u.Ra=0,u.u=0,u.h=0,4<_&&(_=4),E=0;E<_;++E)T+=f[v+E]<<8*E;u.Ra=T,u.bb=_,u.oa=f,u.pa=v}function ke(u){for(;8<=u.u&&u.bb<u.Sb;)u.Ra>>>=8,u.Ra+=u.oa[u.pa+u.bb]<<Wi-8>>>0,++u.bb,u.u-=8;Y(u)&&(u.h=1,u.u=0)}function pe(u,f){if(e(0<=f),!u.h&&f<=br){var v=K(u)&vr[f];return u.u+=f,ke(u),v}return u.h=1,u.u=0}function O(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function q(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function K(u){return u.Ra>>>(u.u&Wi-1)>>>0}function Y(u){return e(u.bb<=u.Sb),u.h||u.bb==u.Sb&&u.u>Wi}function Q(u,f){u.u=f,u.h=Y(u)}function z(u){u.u>=Ti&&(e(u.u>=Ti),ke(u))}function re(u){e(u!=null&&u.oa!=null),u.pa<u.Zc?(u.I=(u.oa[u.pa++]|u.I<<8)>>>0,u.b+=8):(e(u!=null&&u.oa!=null),u.pa<u.Yc?(u.b+=8,u.I=u.oa[u.pa++]|u.I<<8):u.Ka?u.b=0:(u.I<<=8,u.b+=8,u.Ka=1))}function ce(u){return ue(u,1)}function ge(u,f){var v=u.Ca;0>u.b&&re(u);var _=u.b,E=v*f>>>8,T=(u.I>>>_>E)+0;for(T?(v-=E,u.I-=E+1<<_>>>0):v=E+1,_=v,E=0;256<=_;)E+=8,_>>=8;return _=7^E+Gi[_],u.b-=_,u.Ca=(v<<_)-1,T}function Ae(u,f,v){u[f+0]=v>>24&255,u[f+1]=v>>16&255,u[f+2]=v>>8&255,u[f+3]=255&v}function Pe(u,f){return u[f+0]|u[f+1]<<8}function Te(u,f){return Pe(u,f)|u[f+2]<<16}function Me(u,f){return Pe(u,f)|Pe(u,f+2)<<16}function $(u,f){var v=1<<f;return e(u!=null),e(0<f),u.X=a(v),u.X==null?0:(u.Mb=32-f,u.Xa=f,1)}function Ce(u,f){e(u!=null),e(f!=null),e(u.Xa==f.Xa),r(f.X,0,u.X,0,1<<f.Xa)}function ht(){this.X=[],this.Xa=this.Mb=0}function He(u,f,v,_){e(v!=null),e(_!=null);var E=v[0],T=_[0];return E==0&&(E=(u*T+f/2)/f),T==0&&(T=(f*E+u/2)/u),0>=E||0>=T?0:(v[0]=E,_[0]=T,1)}function we(u,f){return u+(1<<f)-1>>>f}function Ke(u,f){return((4278255360&u)+(4278255360&f)>>>0&4278255360)+((16711935&u)+(16711935&f)>>>0&16711935)>>>0}function Re(u,f){D[f]=function(v,_,E,T,R,F,j){var H;for(H=0;H<R;++H){var ne=D[u](F[j+H-1],E,T+H);F[j+H]=Ke(v[_+H],ne)}}}function Qe(){this.ud=this.hd=this.jd=0}function Ie(u,f){return((4278124286&(u^f))>>>1)+(u&f)>>>0}function it(u){return 0<=u&&256>u?u:0>u?0:255<u?255:void 0}function nt(u,f){return it(u+(u-f+.5>>1))}function at(u,f,v){return Math.abs(f-v)-Math.abs(u-v)}function ut(u,f,v,_,E,T,R){for(_=T[R-1],v=0;v<E;++v)T[R+v]=_=Ke(u[f+v],_)}function pt(u,f,v,_,E){var T;for(T=0;T<v;++T){var R=u[f+T],F=R>>8&255,j=16711935&(j=(j=16711935&R)+((F<<16)+F));_[E+T]=(4278255360&R)+j>>>0}}function qe(u,f){f.jd=255&u,f.hd=u>>8&255,f.ud=u>>16&255}function gt(u,f,v,_,E,T){var R;for(R=0;R<_;++R){var F=f[v+R],j=F>>>8,H=F,ne=255&(ne=(ne=F>>>16)+((u.jd<<24>>24)*(j<<24>>24)>>>5));H=255&(H=(H+=(u.hd<<24>>24)*(j<<24>>24)>>>5)+((u.ud<<24>>24)*(ne<<24>>24)>>>5)),E[T+R]=(4278255360&F)+(ne<<16)+H}}function We(u,f,v,_,E){D[f]=function(T,R,F,j,H,ne,he,W,ie){for(j=he;j<W;++j)for(he=0;he<ie;++he)H[ne++]=E(F[_(T[R++])])},D[u]=function(T,R,F,j,H,ne,he){var W=8>>T.b,ie=T.Ea,le=T.K[0],ve=T.w;if(8>W)for(T=(1<<T.b)-1,ve=(1<<W)-1;R<F;++R){var de,be=0;for(de=0;de<ie;++de)de&T||(be=_(j[H++])),ne[he++]=E(le[be&ve]),be>>=W}else D["VP8LMapColor"+v](j,H,le,ve,ne,he,R,F,ie)}}function rn(u,f,v,_,E){for(v=f+v;f<v;){var T=u[f++];_[E++]=T>>16&255,_[E++]=T>>8&255,_[E++]=255&T}}function Et(u,f,v,_,E){for(v=f+v;f<v;){var T=u[f++];_[E++]=T>>16&255,_[E++]=T>>8&255,_[E++]=255&T,_[E++]=T>>24&255}}function bt(u,f,v,_,E){for(v=f+v;f<v;){var T=(R=u[f++])>>16&240|R>>12&15,R=240&R|R>>28&15;_[E++]=T,_[E++]=R}}function ct(u,f,v,_,E){for(v=f+v;f<v;){var T=(R=u[f++])>>16&248|R>>13&7,R=R>>5&224|R>>3&31;_[E++]=T,_[E++]=R}}function Dt(u,f,v,_,E){for(v=f+v;f<v;){var T=u[f++];_[E++]=255&T,_[E++]=T>>8&255,_[E++]=T>>16&255}}function et(u,f,v,_,E,T){if(T==0)for(v=f+v;f<v;)Ae(_,((T=u[f++])[0]>>24|T[1]>>8&65280|T[2]<<8&16711680|T[3]<<24)>>>0),E+=32;else r(_,E,u,f,v)}function jt(u,f){D[f][0]=D[u+"0"],D[f][1]=D[u+"1"],D[f][2]=D[u+"2"],D[f][3]=D[u+"3"],D[f][4]=D[u+"4"],D[f][5]=D[u+"5"],D[f][6]=D[u+"6"],D[f][7]=D[u+"7"],D[f][8]=D[u+"8"],D[f][9]=D[u+"9"],D[f][10]=D[u+"10"],D[f][11]=D[u+"11"],D[f][12]=D[u+"12"],D[f][13]=D[u+"13"],D[f][14]=D[u+"0"],D[f][15]=D[u+"0"]}function st(u){return u==Lc||u==Cc||u==Zo||u==Tc}function dt(){this.eb=[],this.size=this.A=this.fb=0}function Ut(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function kt(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new dt,this.f.kb=new Ut,this.sd=null}function tt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Ft(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function yi(u){return alert("todo:WebPSamplerProcessPlane"),u.T}function Ct(u,f){var v=u.T,_=f.ba.f.RGBA,E=_.eb,T=_.fb+u.ka*_.A,R=Mr[f.ba.S],F=u.y,j=u.O,H=u.f,ne=u.N,he=u.ea,W=u.W,ie=f.cc,le=f.dc,ve=f.Mc,de=f.Nc,be=u.ka,_e=u.ka+u.T,Ee=u.U,Se=Ee+1>>1;for(be==0?R(F,j,null,null,H,ne,he,W,H,ne,he,W,E,T,null,null,Ee):(R(f.ec,f.fc,F,j,ie,le,ve,de,H,ne,he,W,E,T-_.A,E,T,Ee),++v);be+2<_e;be+=2)ie=H,le=ne,ve=he,de=W,ne+=u.Rc,W+=u.Rc,T+=2*_.A,R(F,(j+=2*u.fa)-u.fa,F,j,ie,le,ve,de,H,ne,he,W,E,T-_.A,E,T,Ee);return j+=u.fa,u.j+_e<u.o?(r(f.ec,f.fc,F,j,Ee),r(f.cc,f.dc,H,ne,Se),r(f.Mc,f.Nc,he,W,Se),v--):1&_e||R(F,j,null,null,H,ne,he,W,H,ne,he,W,E,T+_.A,null,null,Ee),v}function Gn(u,f,v){var _=u.F,E=[u.J];if(_!=null){var T=u.U,R=f.ba.S,F=R==Xo||R==Zo;f=f.ba.f.RGBA;var j=[0],H=u.ka;j[0]=u.T,u.Kb&&(H==0?--j[0]:(--H,E[0]-=u.width),u.j+u.ka+u.T==u.o&&(j[0]=u.o-u.j-H));var ne=f.eb;H=f.fb+H*f.A,u=Dd(_,E[0],u.width,T,j,ne,H+(F?0:3),f.A),e(v==j),u&&st(R)&&Gs(ne,H,F,T,j,f.A)}return 0}function Tr(u){var f=u.ma,v=f.ba.S,_=11>v,E=v==Jo||v==Yo||v==Xo||v==Ec||v==12||st(v);if(f.memory=null,f.Ib=null,f.Jb=null,f.Nd=null,!Bs(f.Oa,u,E?11:12))return 0;if(E&&st(v)&&Fs(),u.da)alert("todo:use_scaling");else{if(_){if(f.Ib=yi,u.Kb){if(v=u.U+1>>1,f.memory=a(u.U+2*v),f.memory==null)return 0;f.ec=f.memory,f.fc=0,f.cc=f.ec,f.dc=f.fc+u.U,f.Mc=f.cc,f.Nc=f.dc+v,f.Ib=Ct,Fs()}}else alert("todo:EmitYUV");E&&(f.Jb=Gn,_&&Hr())}if(_&&!Zd){for(u=0;256>u;++u)Ig[u]=89858*(u-128)+el>>Qo,Rg[u]=-22014*(u-128)+el,Og[u]=-45773*(u-128),Pg[u]=113618*(u-128)+el>>Qo;for(u=Ks;u<Oc;++u)f=76283*(u-16)+el>>Qo,Fg[u-Ks]=si(f,255),Dg[u-Ks]=si(f+8>>4,15);Zd=1}return 1}function rt(u){var f=u.ma,v=u.U,_=u.T;return e(!(1&u.ka)),0>=v||0>=_?0:(v=f.Ib(u,f),f.Jb!=null&&f.Jb(u,f,v),f.Dc+=v,1)}function gr(u){u.ma.memory=null}function Ir(u,f,v,_){return pe(u,8)!=47?0:(f[0]=pe(u,14)+1,v[0]=pe(u,14)+1,_[0]=pe(u,1),pe(u,3)!=0?0:!u.h)}function er(u,f){if(4>u)return u+1;var v=u-2>>1;return(2+(1&u)<<v)+pe(f,v)+1}function cr(u,f){return 120<f?f-120:1<=(v=((v=vg[f-1])>>4)*u+(8-(15&v)))?v:1;var v}function Pt(u,f,v){var _=K(v),E=u[f+=255&_].g-8;return 0<E&&(Q(v,v.u+8),_=K(v),f+=u[f].value,f+=_&(1<<E)-1),Q(v,v.u+u[f].g),u[f].value}function Yt(u,f,v){return v.g+=u.g,v.value+=u.value<<f>>>0,e(8>=v.g),u.g}function xn(u,f,v){var _=u.xc;return e((f=_==0?0:u.vc[u.md*(v>>_)+(f>>_)])<u.Wb),u.Ya[f]}function ii(u,f,v,_){var E=u.ab,T=u.c*f,R=u.C;f=R+f;var F=v,j=_;for(_=u.Ta,v=u.Ua;0<E--;){var H=u.gc[E],ne=R,he=f,W=F,ie=j,le=(j=_,F=v,H.Ea);switch(e(ne<he),e(he<=H.nc),H.hc){case 2:mn(W,ie,(he-ne)*le,j,F);break;case 0:var ve=ne,de=he,be=j,_e=F,Ee=(Ge=H).Ea;ve==0&&(Us(W,ie,null,null,1,be,_e),ut(W,ie+1,0,0,Ee-1,be,_e+1),ie+=Ee,_e+=Ee,++ve);for(var Se=1<<Ge.b,Ze=Se-1,De=we(Ee,Ge.b),xt=Ge.K,Ge=Ge.w+(ve>>Ge.b)*De;ve<de;){var Tt=xt,On=Ge,St=1;for(Za(W,ie,be,_e-Ee,1,be,_e);St<Ee;){var Ve=(St&~Ze)+Se;Ve>Ee&&(Ve=Ee),(0,qs[Tt[On++]>>8&15])(W,ie+ +St,be,_e+St-Ee,Ve-St,be,_e+St),St=Ve}ie+=Ee,_e+=Ee,++ve&Ze||(Ge+=De)}he!=H.nc&&r(j,F-le,j,F+(he-ne-1)*le,le);break;case 1:for(le=W,de=ie,Ee=(W=H.Ea)-(_e=W&~(be=(ie=1<<H.b)-1)),ve=we(W,H.b),Se=H.K,H=H.w+(ne>>H.b)*ve;ne<he;){for(Ze=Se,De=H,xt=new Qe,Ge=de+_e,Tt=de+W;de<Ge;)qe(Ze[De++],xt),zs(xt,le,de,ie,j,F),de+=ie,F+=ie;de<Tt&&(qe(Ze[De++],xt),zs(xt,le,de,Ee,j,F),de+=Ee,F+=Ee),++ne&be||(H+=ve)}break;case 3:if(W==j&&ie==F&&0<H.b){for(de=j,W=le=F+(he-ne)*le-(_e=(he-ne)*we(H.Ea,H.b)),ie=j,be=F,ve=[],_e=(Ee=_e)-1;0<=_e;--_e)ve[_e]=ie[be+_e];for(_e=Ee-1;0<=_e;--_e)de[W+_e]=ve[_e];Wo(H,ne,he,j,le,j,F)}else Wo(H,ne,he,W,ie,j,F)}F=_,j=v}j!=v&&r(_,v,F,j,T)}function Pr(u,f){var v=u.V,_=u.Ba+u.c*u.C,E=f-u.C;if(e(f<=u.l.o),e(16>=E),0<E){var T=u.l,R=u.Ta,F=u.Ua,j=T.width;if(ii(u,E,v,_),E=F=[F],e((v=u.C)<(_=f)),e(T.v<T.va),_>T.o&&(_=T.o),v<T.j){var H=T.j-v;v=T.j,E[0]+=H*j}if(v>=_?v=0:(E[0]+=4*T.v,T.ka=v-T.j,T.U=T.va-T.v,T.T=_-v,v=1),v){if(F=F[0],11>(v=u.ca).S){var ne=v.f.RGBA,he=(_=v.S,E=T.U,T=T.T,H=ne.eb,ne.A),W=T;for(ne=ne.fb+u.Ma*ne.A;0<W--;){var ie=R,le=F,ve=E,de=H,be=ne;switch(_){case Ko:Hs(ie,le,ve,de,be);break;case Jo:Vi(ie,le,ve,de,be);break;case Lc:Vi(ie,le,ve,de,be),Gs(de,be,0,ve,1,0);break;case zd:Aa(ie,le,ve,de,be);break;case Yo:et(ie,le,ve,de,be,1);break;case Cc:et(ie,le,ve,de,be,1),Gs(de,be,0,ve,1,0);break;case Xo:et(ie,le,ve,de,be,0);break;case Zo:et(ie,le,ve,de,be,0),Gs(de,be,1,ve,1,0);break;case Ec:Ki(ie,le,ve,de,be);break;case Tc:Ki(ie,le,ve,de,be),Fd(de,be,ve,1,0);break;case Hd:Ji(ie,le,ve,de,be);break;default:e(0)}F+=j,ne+=he}u.Ma+=T}else alert("todo:EmitRescaledRowsYUVA");e(u.Ma<=v.height)}}u.C=f,e(u.C<=u.i)}function ur(u){var f;if(0<u.ua)return 0;for(f=0;f<u.Wb;++f){var v=u.Ya[f].G,_=u.Ya[f].H;if(0<v[1][_[1]+0].g||0<v[2][_[2]+0].g||0<v[3][_[3]+0].g)return 0}return 1}function Sn(u,f,v,_,E,T){if(u.Z!=0){var R=u.qd,F=u.rd;for(e(Zi[u.Z]!=null);f<v;++f)Zi[u.Z](R,F,_,E,_,E,T),R=_,F=E,E+=T;u.qd=R,u.rd=F}}function dr(u,f){var v=u.l.ma,_=v.Z==0||v.Z==1?u.l.j:u.C;if(_=u.C<_?_:u.C,e(f<=u.l.o),f>_){var E=u.l.width,T=v.ca,R=v.tb+E*_,F=u.V,j=u.Ba+u.c*_,H=u.gc;e(u.ab==1),e(H[0].hc==3),ui(H[0],_,f,F,j,T,R),Sn(v,_,f,T,R,E)}u.C=u.Ma=f}function hr(u,f,v,_,E,T,R){var F=u.$/_,j=u.$%_,H=u.m,ne=u.s,he=v+u.$,W=he;E=v+_*E;var ie=v+_*T,le=280+ne.ua,ve=u.Pb?F:16777216,de=0<ne.ua?ne.Wa:null,be=ne.wc,_e=he<ie?xn(ne,j,F):null;e(u.C<T),e(ie<=E);var Ee=!1;e:for(;;){for(;Ee||he<ie;){var Se=0;if(F>=ve){var Ze=he-v;e((ve=u).Pb),ve.wd=ve.m,ve.xd=Ze,0<ve.s.ua&&Ce(ve.s.Wa,ve.s.vb),ve=F+yg}if(j&be||(_e=xn(ne,j,F)),e(_e!=null),_e.Qb&&(f[he]=_e.qb,Ee=!0),!Ee)if(z(H),_e.jc){Se=H,Ze=f;var De=he,xt=_e.pd[K(Se)&Sa-1];e(_e.jc),256>xt.g?(Q(Se,Se.u+xt.g),Ze[De]=xt.value,Se=0):(Q(Se,Se.u+xt.g-256),e(256<=xt.value),Se=xt.value),Se==0&&(Ee=!0)}else Se=Pt(_e.G[0],_e.H[0],H);if(H.h)break;if(Ee||256>Se){if(!Ee)if(_e.nd)f[he]=(_e.qb|Se<<8)>>>0;else{if(z(H),Ee=Pt(_e.G[1],_e.H[1],H),z(H),Ze=Pt(_e.G[2],_e.H[2],H),De=Pt(_e.G[3],_e.H[3],H),H.h)break;f[he]=(De<<24|Ee<<16|Se<<8|Ze)>>>0}if(Ee=!1,++he,++j>=_&&(j=0,++F,R!=null&&F<=T&&!(F%16)&&R(u,F),de!=null))for(;W<he;)Se=f[W++],de.X[(506832829*Se&4294967295)>>>de.Mb]=Se}else if(280>Se){if(Se=er(Se-256,H),Ze=Pt(_e.G[4],_e.H[4],H),z(H),Ze=cr(_,Ze=er(Ze,H)),H.h)break;if(he-v<Ze||E-he<Se)break e;for(De=0;De<Se;++De)f[he+De]=f[he+De-Ze];for(he+=Se,j+=Se;j>=_;)j-=_,++F,R!=null&&F<=T&&!(F%16)&&R(u,F);if(e(he<=E),j&be&&(_e=xn(ne,j,F)),de!=null)for(;W<he;)Se=f[W++],de.X[(506832829*Se&4294967295)>>>de.Mb]=Se}else{if(!(Se<le))break e;for(Ee=Se-280,e(de!=null);W<he;)Se=f[W++],de.X[(506832829*Se&4294967295)>>>de.Mb]=Se;Se=he,e(!(Ee>>>(Ze=de).Xa)),f[Se]=Ze.X[Ee],Ee=!0}Ee||e(H.h==Y(H))}if(u.Pb&&H.h&&he<E)e(u.m.h),u.a=5,u.m=u.wd,u.$=u.xd,0<u.s.ua&&Ce(u.s.vb,u.s.Wa);else{if(H.h)break e;R!=null&&R(u,F>T?T:F),u.a=0,u.$=he-v}return 1}return u.a=3,0}function tr(u){e(u!=null),u.vc=null,u.yc=null,u.Ya=null;var f=u.Wa;f!=null&&(f.X=null),u.vb=null,e(u!=null)}function ai(){var u=new mt;return u==null?null:(u.a=0,u.xb=Vd,jt("Predictor","VP8LPredictors"),jt("Predictor","VP8LPredictors_C"),jt("PredictorAdd","VP8LPredictorsAdd"),jt("PredictorAdd","VP8LPredictorsAdd_C"),mn=pt,zs=gt,Hs=rn,Vi=Et,Ki=bt,Ji=ct,Aa=Dt,D.VP8LMapColor32b=ci,D.VP8LMapColor8b=$s,u)}function Or(u,f,v,_,E){var T=1,R=[u],F=[f],j=_.m,H=_.s,ne=null,he=0;e:for(;;){if(v)for(;T&&pe(j,1);){var W=R,ie=F,le=_,ve=1,de=le.m,be=le.gc[le.ab],_e=pe(de,2);if(le.Oc&1<<_e)T=0;else{switch(le.Oc|=1<<_e,be.hc=_e,be.Ea=W[0],be.nc=ie[0],be.K=[null],++le.ab,e(4>=le.ab),_e){case 0:case 1:be.b=pe(de,3)+2,ve=Or(we(be.Ea,be.b),we(be.nc,be.b),0,le,be.K),be.K=be.K[0];break;case 3:var Ee,Se=pe(de,8)+1,Ze=16<Se?0:4<Se?1:2<Se?2:3;if(W[0]=we(be.Ea,Ze),be.b=Ze,Ee=ve=Or(Se,1,0,le,be.K)){var De,xt=Se,Ge=be,Tt=1<<(8>>Ge.b),On=a(Tt);if(On==null)Ee=0;else{var St=Ge.K[0],Ve=Ge.w;for(On[0]=Ge.K[0][0],De=1;De<1*xt;++De)On[De]=Ke(St[Ve+De],On[De-1]);for(;De<4*Tt;++De)On[De]=0;Ge.K[0]=null,Ge.K[0]=On,Ee=1}}ve=Ee;break;case 2:break;default:e(0)}T=ve}}if(R=R[0],F=F[0],T&&pe(j,1)&&!(T=1<=(he=pe(j,4))&&11>=he)){_.a=3;break e}var Oe;if(Oe=T)t:{var vn,_t,It,tn=_,$n=R,rr=F,dn=he,Vn=v,ir=tn.m,Rn=tn.s,Rt=[null],$t=1,hn=0,qt=bg[dn];n:for(;;){if(Vn&&pe(ir,1)){var qn=pe(ir,3)+2,Gr=we($n,qn),bn=we(rr,qn),fr=Gr*bn;if(!Or(Gr,bn,0,tn,Rt))break n;for(Rt=Rt[0],Rn.xc=qn,vn=0;vn<fr;++vn){var Vt=Rt[vn]>>8&65535;Rt[vn]=Vt,Vt>=$t&&($t=Vt+1)}}if(ir.h)break n;for(_t=0;5>_t;++_t){var Fn=Wd[_t];!_t&&0<dn&&(Fn+=1<<dn),hn<Fn&&(hn=Fn)}var _r=o($t*qt,M),ar=$t,wr=o(ar,J);if(wr==null)var xr=null;else e(65536>=ar),xr=wr;var pr=a(hn);if(xr==null||pr==null||_r==null){tn.a=1;break n}var Sr=_r;for(vn=It=0;vn<$t;++vn){var Zt=xr[vn],Ar=Zt.G,Vr=Zt.H,Na=0,Oi=1,zn=0;for(_t=0;5>_t;++_t){Fn=Wd[_t],Ar[_t]=Sr,Vr[_t]=It,!_t&&0<dn&&(Fn+=1<<dn);i:{var nl,Rc=Fn,rl=tn,Js=pr,Mg=Sr,Ug=It,Fc=0,Qi=rl.m,$g=pe(Qi,1);if(i(Js,0,0,Rc),$g){var qg=pe(Qi,1)+1,zg=pe(Qi,1),th=pe(Qi,zg==0?1:8);Js[th]=1,qg==2&&(Js[th=pe(Qi,8)]=1);var il=1}else{var nh=a(19),rh=pe(Qi,4)+4;if(19<rh){rl.a=3;var al=0;break i}for(nl=0;nl<rh;++nl)nh[gg[nl]]=pe(Qi,3);var Dc=void 0,Ys=void 0,ih=rl,Hg=nh,sl=Rc,ah=Js,jc=0,ea=ih.m,sh=8,oh=o(128,M);r:for(;A(oh,0,7,Hg,19);){if(pe(ea,1)){var Wg=2+2*pe(ea,3);if((Dc=2+pe(ea,Wg))>sl)break r}else Dc=sl;for(Ys=0;Ys<sl&&Dc--;){z(ea);var lh=oh[0+(127&K(ea))];Q(ea,ea.u+lh.g);var es=lh.value;if(16>es)ah[Ys++]=es,es!=0&&(sh=es);else{var Gg=es==16,ch=es-16,Vg=pg[ch],uh=pe(ea,fg[ch])+Vg;if(Ys+uh>sl)break r;for(var Kg=Gg?sh:0;0<uh--;)ah[Ys++]=Kg}}jc=1;break r}jc||(ih.a=3),il=jc}(il=il&&!Qi.h)&&(Fc=A(Mg,Ug,8,Js,Rc)),il&&Fc!=0?al=Fc:(rl.a=3,al=0)}if(al==0)break n;if(Oi&&mg[_t]==1&&(Oi=Sr[It].g==0),Na+=Sr[It].g,It+=al,3>=_t){var Xs,Bc=pr[0];for(Xs=1;Xs<Fn;++Xs)pr[Xs]>Bc&&(Bc=pr[Xs]);zn+=Bc}}if(Zt.nd=Oi,Zt.Qb=0,Oi&&(Zt.qb=(Ar[3][Vr[3]+0].value<<24|Ar[1][Vr[1]+0].value<<16|Ar[2][Vr[2]+0].value)>>>0,Na==0&&256>Ar[0][Vr[0]+0].value&&(Zt.Qb=1,Zt.qb+=Ar[0][Vr[0]+0].value<<8)),Zt.jc=!Zt.Qb&&6>zn,Zt.jc){var ol,Ri=Zt;for(ol=0;ol<Sa;++ol){var ta=ol,na=Ri.pd[ta],ll=Ri.G[0][Ri.H[0]+ta];256<=ll.value?(na.g=ll.g+256,na.value=ll.value):(na.g=0,na.value=0,ta>>=Yt(ll,8,na),ta>>=Yt(Ri.G[1][Ri.H[1]+ta],16,na),ta>>=Yt(Ri.G[2][Ri.H[2]+ta],0,na),Yt(Ri.G[3][Ri.H[3]+ta],24,na))}}}Rn.vc=Rt,Rn.Wb=$t,Rn.Ya=xr,Rn.yc=_r,Oe=1;break t}Oe=0}if(!(T=Oe)){_.a=3;break e}if(0<he){if(H.ua=1<<he,!$(H.Wa,he)){_.a=1,T=0;break e}}else H.ua=0;var Mc=_,dh=R,Jg=F,Uc=Mc.s,$c=Uc.xc;if(Mc.c=dh,Mc.i=Jg,Uc.md=we(dh,$c),Uc.wc=$c==0?-1:(1<<$c)-1,v){_.xb=Ng;break e}if((ne=a(R*F))==null){_.a=1,T=0;break e}T=(T=hr(_,ne,0,R,F,F,null))&&!j.h;break e}return T?(E!=null?E[0]=ne:(e(ne==null),e(v)),_.$=0,v||tr(H)):tr(H),T}function Ue(u,f){var v=u.c*u.i,_=v+f+16*f;return e(u.c<=f),u.V=a(_),u.V==null?(u.Ta=null,u.Ua=0,u.a=1,0):(u.Ta=u.V,u.Ua=u.Ba+v+f,1)}function te(u,f){var v=u.C,_=f-v,E=u.V,T=u.Ba+u.c*v;for(e(f<=u.l.o);0<_;){var R=16<_?16:_,F=u.l.ma,j=u.l.width,H=j*R,ne=F.ca,he=F.tb+j*v,W=u.Ta,ie=u.Ua;ii(u,R,E,T),jd(W,ie,ne,he,H),Sn(F,v,v+R,ne,he,j),_-=R,E+=R*u.c,v+=R}e(v==f),u.C=u.Ma=f}function Ne(){this.ub=this.yd=this.td=this.Rb=0}function Fe(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Wt(){this.Fb=this.Bb=this.Cb=0,this.Zb=a(4),this.Lb=a(4)}function cn(){this.Yb=(function(){var u=[];return(function f(v,_,E){for(var T=E[_],R=0;R<T&&(v.push(E.length>_+1?[]:0),!(E.length<_+1));R++)f(v[R],_+1,E)})(u,0,[3,11]),u})()}function en(){this.jb=a(3),this.Wc=l([4,8],cn),this.Xc=l([4,17],cn)}function Cn(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new a(4),this.od=new a(4)}function un(){this.ld=this.La=this.dd=this.tc=0}function Rr(){this.Na=this.la=0}function $i(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function sn(){this.ad=a(384),this.Za=0,this.Ob=a(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function da(){this.uc=this.M=this.Nb=0,this.wa=Array(new un),this.Y=0,this.ya=Array(new sn),this.aa=0,this.l=new Wa}function ha(){this.y=a(16),this.f=a(8),this.ea=a(8)}function Po(){this.cb=this.a=0,this.sc="",this.m=new O,this.Od=new Ne,this.Kc=new Fe,this.ed=new Cn,this.Qa=new Wt,this.Ic=this.$c=this.Aa=0,this.D=new da,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=o(8,O),this.ia=0,this.pb=o(4,$i),this.Pa=new en,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new ha),this.Hd=0,this.rb=Array(new Rr),this.sb=0,this.wa=Array(new un),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new sn),this.L=this.aa=0,this.gd=l([4,2],un),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function si(u,f){return 0>u?0:u>f?f:u}function Wa(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function dc(){var u=new Po;return u!=null&&(u.a=0,u.sc="OK",u.cb=0,u.Xb=0,Vs||(Vs=Ga)),u}function An(u,f,v){return u.a==0&&(u.a=f,u.sc=v,u.cb=0),0}function Oo(u,f,v){return 3<=v&&u[f+0]==157&&u[f+1]==1&&u[f+2]==42}function oi(u,f){if(u==null)return 0;if(u.a=0,u.sc="OK",f==null)return An(u,2,"null VP8Io passed to VP8GetHeaders()");var v=f.data,_=f.w,E=f.ha;if(4>E)return An(u,7,"Truncated header.");var T=v[_+0]|v[_+1]<<8|v[_+2]<<16,R=u.Od;if(R.Rb=!(1&T),R.td=T>>1&7,R.yd=T>>4&1,R.ub=T>>5,3<R.td)return An(u,3,"Incorrect keyframe parameters.");if(!R.yd)return An(u,4,"Frame not displayable.");_+=3,E-=3;var F=u.Kc;if(R.Rb){if(7>E)return An(u,7,"cannot parse picture header");if(!Oo(v,_,E))return An(u,3,"Bad code word");F.c=16383&(v[_+4]<<8|v[_+3]),F.Td=v[_+4]>>6,F.i=16383&(v[_+6]<<8|v[_+5]),F.Ud=v[_+6]>>6,_+=7,E-=7,u.za=F.c+15>>4,u.Ub=F.i+15>>4,f.width=F.c,f.height=F.i,f.Da=0,f.j=0,f.v=0,f.va=f.width,f.o=f.height,f.da=0,f.ib=f.width,f.hb=f.height,f.U=f.width,f.T=f.height,i((T=u.Pa).jb,0,255,T.jb.length),e((T=u.Qa)!=null),T.Cb=0,T.Bb=0,T.Fb=1,i(T.Zb,0,0,T.Zb.length),i(T.Lb,0,0,T.Lb)}if(R.ub>E)return An(u,7,"bad partition length");oe(T=u.m,v,_,R.ub),_+=R.ub,E-=R.ub,R.Rb&&(F.Ld=ce(T),F.Kd=ce(T)),F=u.Qa;var j,H=u.Pa;if(e(T!=null),e(F!=null),F.Cb=ce(T),F.Cb){if(F.Bb=ce(T),ce(T)){for(F.Fb=ce(T),j=0;4>j;++j)F.Zb[j]=ce(T)?ae(T,7):0;for(j=0;4>j;++j)F.Lb[j]=ce(T)?ae(T,6):0}if(F.Bb)for(j=0;3>j;++j)H.jb[j]=ce(T)?ue(T,8):255}else F.Bb=0;if(T.Ka)return An(u,3,"cannot parse segment header");if((F=u.ed).zd=ce(T),F.Tb=ue(T,6),F.wb=ue(T,3),F.Pc=ce(T),F.Pc&&ce(T)){for(H=0;4>H;++H)ce(T)&&(F.vd[H]=ae(T,6));for(H=0;4>H;++H)ce(T)&&(F.od[H]=ae(T,6))}if(u.L=F.Tb==0?0:F.zd?1:2,T.Ka)return An(u,3,"cannot parse filter header");var ne=E;if(E=j=_,_=j+ne,F=ne,u.Xb=(1<<ue(u.m,2))-1,ne<3*(H=u.Xb))v=7;else{for(j+=3*H,F-=3*H,ne=0;ne<H;++ne){var he=v[E+0]|v[E+1]<<8|v[E+2]<<16;he>F&&(he=F),oe(u.Jc[+ne],v,j,he),j+=he,F-=he,E+=3}oe(u.Jc[+H],v,j,F),v=j<_?0:5}if(v!=0)return An(u,v,"cannot parse partitions");for(v=ue(j=u.m,7),E=ce(j)?ae(j,4):0,_=ce(j)?ae(j,4):0,F=ce(j)?ae(j,4):0,H=ce(j)?ae(j,4):0,j=ce(j)?ae(j,4):0,ne=u.Qa,he=0;4>he;++he){if(ne.Cb){var W=ne.Zb[he];ne.Fb||(W+=v)}else{if(0<he){u.pb[he]=u.pb[0];continue}W=v}var ie=u.pb[he];ie.Sc[0]=Ic[si(W+E,127)],ie.Sc[1]=Pc[si(W+0,127)],ie.Eb[0]=2*Ic[si(W+_,127)],ie.Eb[1]=101581*Pc[si(W+F,127)]>>16,8>ie.Eb[1]&&(ie.Eb[1]=8),ie.Qc[0]=Ic[si(W+H,117)],ie.Qc[1]=Pc[si(W+j,127)],ie.lc=W+j}if(!R.Rb)return An(u,4,"Not a key frame.");for(ce(T),R=u.Pa,v=0;4>v;++v){for(E=0;8>E;++E)for(_=0;3>_;++_)for(F=0;11>F;++F)H=ge(T,Ag[v][E][_][F])?ue(T,8):xg[v][E][_][F],R.Wc[v][E].Yb[_][F]=H;for(E=0;17>E;++E)R.Xc[v][E]=R.Wc[v][kg[E]]}return u.kc=ce(T),u.kc&&(u.Bd=ue(T,8)),u.cb=1}function Ga(u,f,v,_,E,T,R){var F=f[E].Yb[v];for(v=0;16>E;++E){if(!ge(u,F[v+0]))return E;for(;!ge(u,F[v+1]);)if(F=f[++E].Yb[0],v=0,E==16)return 16;var j=f[E+1].Yb;if(ge(u,F[v+2])){var H=u,ne=0;if(ge(H,(W=F)[(he=v)+3]))if(ge(H,W[he+6])){for(F=0,he=2*(ne=ge(H,W[he+8]))+(W=ge(H,W[he+9+ne])),ne=0,W=_g[he];W[F];++F)ne+=ne+ge(H,W[F]);ne+=3+(8<<he)}else ge(H,W[he+7])?(ne=7+2*ge(H,165),ne+=ge(H,145)):ne=5+ge(H,159);else ne=ge(H,W[he+4])?3+ge(H,W[he+5]):2;F=j[2]}else ne=1,F=j[1];j=R+wg[E],0>(H=u).b&&re(H);var he,W=H.b,ie=(he=H.Ca>>1)-(H.I>>W)>>31;--H.b,H.Ca+=ie,H.Ca|=1,H.I-=(he+1&ie)<<W,T[j]=((ne^ie)-ie)*_[(0<E)+0]}return 16}function Ro(u){var f=u.rb[u.sb-1];f.la=0,f.Na=0,i(u.zc,0,0,u.zc.length),u.ja=0}function Fr(u,f,v,_,E){E=u[f+v+32*_]+(E>>3),u[f+v+32*_]=-256&E?0>E?0:255:E}function Tn(u,f,v,_,E,T){Fr(u,f,0,v,_+E),Fr(u,f,1,v,_+T),Fr(u,f,2,v,_-T),Fr(u,f,3,v,_-E)}function _i(u){return(20091*u>>16)+u}function Fo(u,f,v,_){var E,T=0,R=a(16);for(E=0;4>E;++E){var F=u[f+0]+u[f+8],j=u[f+0]-u[f+8],H=(35468*u[f+4]>>16)-_i(u[f+12]),ne=_i(u[f+4])+(35468*u[f+12]>>16);R[T+0]=F+ne,R[T+1]=j+H,R[T+2]=j-H,R[T+3]=F-ne,T+=4,f++}for(E=T=0;4>E;++E)F=(u=R[T+0]+4)+R[T+8],j=u-R[T+8],H=(35468*R[T+4]>>16)-_i(R[T+12]),Fr(v,_,0,0,F+(ne=_i(R[T+4])+(35468*R[T+12]>>16))),Fr(v,_,1,0,j+H),Fr(v,_,2,0,j-H),Fr(v,_,3,0,F-ne),T++,_+=32}function hc(u,f,v,_){var E=u[f+0]+4,T=35468*u[f+4]>>16,R=_i(u[f+4]),F=35468*u[f+1]>>16;Tn(v,_,0,E+R,u=_i(u[f+1]),F),Tn(v,_,1,E+T,u,F),Tn(v,_,2,E-T,u,F),Tn(v,_,3,E-R,u,F)}function fc(u,f,v,_,E){Fo(u,f,v,_),E&&Fo(u,f+16,v,_+4)}function li(u,f,v,_){ka(u,f+0,v,_,1),ka(u,f+32,v,_+128,1)}function Do(u,f,v,_){var E;for(u=u[f+0]+4,E=0;4>E;++E)for(f=0;4>f;++f)Fr(v,_,f,E,u)}function jo(u,f,v,_){u[f+0]&&Bt(u,f+0,v,_),u[f+16]&&Bt(u,f+16,v,_+4),u[f+32]&&Bt(u,f+32,v,_+128),u[f+48]&&Bt(u,f+48,v,_+128+4)}function Va(u,f,v,_){var E,T=a(16);for(E=0;4>E;++E){var R=u[f+0+E]+u[f+12+E],F=u[f+4+E]+u[f+8+E],j=u[f+4+E]-u[f+8+E],H=u[f+0+E]-u[f+12+E];T[0+E]=R+F,T[8+E]=R-F,T[4+E]=H+j,T[12+E]=H-j}for(E=0;4>E;++E)R=(u=T[0+4*E]+3)+T[3+4*E],F=T[1+4*E]+T[2+4*E],j=T[1+4*E]-T[2+4*E],H=u-T[3+4*E],v[_+0]=R+F>>3,v[_+16]=H+j>>3,v[_+32]=R-F>>3,v[_+48]=H-j>>3,_+=64}function fa(u,f,v){var _,E=f-32,T=yr,R=255-u[E-1];for(_=0;_<v;++_){var F,j=T,H=R+u[f-1];for(F=0;F<v;++F)u[f+F]=j[H+u[E+F]];f+=32}}function pc(u,f){fa(u,f,4)}function mc(u,f){fa(u,f,8)}function gc(u,f){fa(u,f,16)}function Es(u,f){var v;for(v=0;16>v;++v)r(u,f+32*v,u,f-32,16)}function Bo(u,f){var v;for(v=16;0<v;--v)i(u,f,u[f-1],16),f+=32}function zr(u,f,v){var _;for(_=0;16>_;++_)i(f,v+32*_,u,16)}function vc(u,f){var v,_=16;for(v=0;16>v;++v)_+=u[f-1+32*v]+u[f+v-32];zr(_>>5,u,f)}function pa(u,f){var v,_=8;for(v=0;16>v;++v)_+=u[f-1+32*v];zr(_>>4,u,f)}function Ls(u,f){var v,_=8;for(v=0;16>v;++v)_+=u[f+v-32];zr(_>>4,u,f)}function bc(u,f){zr(128,u,f)}function vt(u,f,v){return u+2*f+v+2>>2}function yc(u,f){var v,_=f-32;for(_=new Uint8Array([vt(u[_-1],u[_+0],u[_+1]),vt(u[_+0],u[_+1],u[_+2]),vt(u[_+1],u[_+2],u[_+3]),vt(u[_+2],u[_+3],u[_+4])]),v=0;4>v;++v)r(u,f+32*v,_,0,_.length)}function _c(u,f){var v=u[f-1],_=u[f-1+32],E=u[f-1+64],T=u[f-1+96];Ae(u,f+0,16843009*vt(u[f-1-32],v,_)),Ae(u,f+32,16843009*vt(v,_,E)),Ae(u,f+64,16843009*vt(_,E,T)),Ae(u,f+96,16843009*vt(E,T,T))}function wc(u,f){var v,_=4;for(v=0;4>v;++v)_+=u[f+v-32]+u[f-1+32*v];for(_>>=3,v=0;4>v;++v)i(u,f+32*v,_,4)}function wi(u,f){var v=u[f-1+0],_=u[f-1+32],E=u[f-1+64],T=u[f-1-32],R=u[f+0-32],F=u[f+1-32],j=u[f+2-32],H=u[f+3-32];u[f+0+96]=vt(_,E,u[f-1+96]),u[f+1+96]=u[f+0+64]=vt(v,_,E),u[f+2+96]=u[f+1+64]=u[f+0+32]=vt(T,v,_),u[f+3+96]=u[f+2+64]=u[f+1+32]=u[f+0+0]=vt(R,T,v),u[f+3+64]=u[f+2+32]=u[f+1+0]=vt(F,R,T),u[f+3+32]=u[f+2+0]=vt(j,F,R),u[f+3+0]=vt(H,j,F)}function xi(u,f){var v=u[f+1-32],_=u[f+2-32],E=u[f+3-32],T=u[f+4-32],R=u[f+5-32],F=u[f+6-32],j=u[f+7-32];u[f+0+0]=vt(u[f+0-32],v,_),u[f+1+0]=u[f+0+32]=vt(v,_,E),u[f+2+0]=u[f+1+32]=u[f+0+64]=vt(_,E,T),u[f+3+0]=u[f+2+32]=u[f+1+64]=u[f+0+96]=vt(E,T,R),u[f+3+32]=u[f+2+64]=u[f+1+96]=vt(T,R,F),u[f+3+64]=u[f+2+96]=vt(R,F,j),u[f+3+96]=vt(F,j,j)}function xc(u,f){var v=u[f-1+0],_=u[f-1+32],E=u[f-1+64],T=u[f-1-32],R=u[f+0-32],F=u[f+1-32],j=u[f+2-32],H=u[f+3-32];u[f+0+0]=u[f+1+64]=T+R+1>>1,u[f+1+0]=u[f+2+64]=R+F+1>>1,u[f+2+0]=u[f+3+64]=F+j+1>>1,u[f+3+0]=j+H+1>>1,u[f+0+96]=vt(E,_,v),u[f+0+64]=vt(_,v,T),u[f+0+32]=u[f+1+96]=vt(v,T,R),u[f+1+32]=u[f+2+96]=vt(T,R,F),u[f+2+32]=u[f+3+96]=vt(R,F,j),u[f+3+32]=vt(F,j,H)}function Sc(u,f){var v=u[f+0-32],_=u[f+1-32],E=u[f+2-32],T=u[f+3-32],R=u[f+4-32],F=u[f+5-32],j=u[f+6-32],H=u[f+7-32];u[f+0+0]=v+_+1>>1,u[f+1+0]=u[f+0+64]=_+E+1>>1,u[f+2+0]=u[f+1+64]=E+T+1>>1,u[f+3+0]=u[f+2+64]=T+R+1>>1,u[f+0+32]=vt(v,_,E),u[f+1+32]=u[f+0+96]=vt(_,E,T),u[f+2+32]=u[f+1+96]=vt(E,T,R),u[f+3+32]=u[f+2+96]=vt(T,R,F),u[f+3+64]=vt(R,F,j),u[f+3+96]=vt(F,j,H)}function Ka(u,f){var v=u[f-1+0],_=u[f-1+32],E=u[f-1+64],T=u[f-1+96];u[f+0+0]=v+_+1>>1,u[f+2+0]=u[f+0+32]=_+E+1>>1,u[f+2+32]=u[f+0+64]=E+T+1>>1,u[f+1+0]=vt(v,_,E),u[f+3+0]=u[f+1+32]=vt(_,E,T),u[f+3+32]=u[f+1+64]=vt(E,T,T),u[f+3+64]=u[f+2+64]=u[f+0+96]=u[f+1+96]=u[f+2+96]=u[f+3+96]=T}function Cs(u,f){var v=u[f-1+0],_=u[f-1+32],E=u[f-1+64],T=u[f-1+96],R=u[f-1-32],F=u[f+0-32],j=u[f+1-32],H=u[f+2-32];u[f+0+0]=u[f+2+32]=v+R+1>>1,u[f+0+32]=u[f+2+64]=_+v+1>>1,u[f+0+64]=u[f+2+96]=E+_+1>>1,u[f+0+96]=T+E+1>>1,u[f+3+0]=vt(F,j,H),u[f+2+0]=vt(R,F,j),u[f+1+0]=u[f+3+32]=vt(v,R,F),u[f+1+32]=u[f+3+64]=vt(_,v,R),u[f+1+64]=u[f+3+96]=vt(E,_,v),u[f+1+96]=vt(T,E,_)}function ma(u,f){var v;for(v=0;8>v;++v)r(u,f+32*v,u,f-32,8)}function Ac(u,f){var v;for(v=0;8>v;++v)i(u,f,u[f-1],8),f+=32}function Si(u,f,v){var _;for(_=0;8>_;++_)i(f,v+32*_,u,8)}function kc(u,f){var v,_=8;for(v=0;8>v;++v)_+=u[f+v-32]+u[f-1+32*v];Si(_>>4,u,f)}function Ts(u,f){var v,_=4;for(v=0;8>v;++v)_+=u[f+v-32];Si(_>>3,u,f)}function Is(u,f){var v,_=4;for(v=0;8>v;++v)_+=u[f-1+32*v];Si(_>>3,u,f)}function Mo(u,f){Si(128,u,f)}function Ai(u,f,v){var _=u[f-v],E=u[f+0],T=3*(E-_)+Nc[1020+u[f-2*v]-u[f+v]],R=Vo[112+(T+4>>3)];u[f-v]=yr[255+_+Vo[112+(T+3>>3)]],u[f+0]=yr[255+E-R]}function Ps(u,f,v,_){var E=u[f+0],T=u[f+v];return Br[255+u[f-2*v]-u[f-v]]>_||Br[255+T-E]>_}function Ja(u,f,v,_){return 4*Br[255+u[f-v]-u[f+0]]+Br[255+u[f-2*v]-u[f+v]]<=_}function Os(u,f,v,_,E){var T=u[f-3*v],R=u[f-2*v],F=u[f-v],j=u[f+0],H=u[f+v],ne=u[f+2*v],he=u[f+3*v];return 4*Br[255+F-j]+Br[255+R-H]>_?0:Br[255+u[f-4*v]-T]<=E&&Br[255+T-R]<=E&&Br[255+R-F]<=E&&Br[255+he-ne]<=E&&Br[255+ne-H]<=E&&Br[255+H-j]<=E}function ga(u,f,v,_){var E=2*_+1;for(_=0;16>_;++_)Ja(u,f+_,v,E)&&Ai(u,f+_,v)}function Rs(u,f,v,_){var E=2*_+1;for(_=0;16>_;++_)Ja(u,f+_*v,1,E)&&Ai(u,f+_*v,1)}function Uo(u,f,v,_){var E;for(E=3;0<E;--E)ga(u,f+=4*v,v,_)}function $o(u,f,v,_){var E;for(E=3;0<E;--E)Rs(u,f+=4,v,_)}function ki(u,f,v,_,E,T,R,F){for(T=2*T+1;0<E--;){if(Os(u,f,v,T,R))if(Ps(u,f,v,F))Ai(u,f,v);else{var j=u,H=f,ne=v,he=j[H-2*ne],W=j[H-ne],ie=j[H+0],le=j[H+ne],ve=j[H+2*ne],de=27*(_e=Nc[1020+3*(ie-W)+Nc[1020+he-le]])+63>>7,be=18*_e+63>>7,_e=9*_e+63>>7;j[H-3*ne]=yr[255+j[H-3*ne]+_e],j[H-2*ne]=yr[255+he+be],j[H-ne]=yr[255+W+de],j[H+0]=yr[255+ie-de],j[H+ne]=yr[255+le-be],j[H+2*ne]=yr[255+ve-_e]}f+=_}}function Ni(u,f,v,_,E,T,R,F){for(T=2*T+1;0<E--;){if(Os(u,f,v,T,R))if(Ps(u,f,v,F))Ai(u,f,v);else{var j=u,H=f,ne=v,he=j[H-ne],W=j[H+0],ie=j[H+ne],le=Vo[112+(4+(ve=3*(W-he))>>3)],ve=Vo[112+(ve+3>>3)],de=le+1>>1;j[H-2*ne]=yr[255+j[H-2*ne]+de],j[H-ne]=yr[255+he+ve],j[H+0]=yr[255+W-le],j[H+ne]=yr[255+ie-de]}f+=_}}function qo(u,f,v,_,E,T){ki(u,f,v,1,16,_,E,T)}function va(u,f,v,_,E,T){ki(u,f,1,v,16,_,E,T)}function zo(u,f,v,_,E,T){var R;for(R=3;0<R;--R)Ni(u,f+=4*v,v,1,16,_,E,T)}function m(u,f,v,_,E,T){var R;for(R=3;0<R;--R)Ni(u,f+=4,1,v,16,_,E,T)}function N(u,f,v,_,E,T,R,F){ki(u,f,E,1,8,T,R,F),ki(v,_,E,1,8,T,R,F)}function G(u,f,v,_,E,T,R,F){ki(u,f,1,E,8,T,R,F),ki(v,_,1,E,8,T,R,F)}function Z(u,f,v,_,E,T,R,F){Ni(u,f+4*E,E,1,8,T,R,F),Ni(v,_+4*E,E,1,8,T,R,F)}function se(u,f,v,_,E,T,R,F){Ni(u,f+4,1,E,8,T,R,F),Ni(v,_+4,1,E,8,T,R,F)}function ye(){this.ba=new kt,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Ft,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function xe(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function $e(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Je(){this.ua=0,this.Wa=new ht,this.vb=new ht,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new J,this.yc=new M}function mt(){this.xb=this.a=0,this.l=new Wa,this.ca=new kt,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new q,this.Pb=0,this.wd=new q,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Je,this.ab=0,this.gc=o(4,$e),this.Oc=0}function wt(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Wa,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Ot(u,f,v,_,E,T,R){for(u=u==null?0:u[f+0],f=0;f<R;++f)E[T+f]=u+v[_+f]&255,u=E[T+f]}function on(u,f,v,_,E,T,R){var F;if(u==null)Ot(null,null,v,_,E,T,R);else for(F=0;F<R;++F)E[T+F]=u[f+F]+v[_+F]&255}function kn(u,f,v,_,E,T,R){if(u==null)Ot(null,null,v,_,E,T,R);else{var F,j=u[f+0],H=j,ne=j;for(F=0;F<R;++F)H=ne+(j=u[f+F])-H,ne=v[_+F]+(-256&H?0>H?0:255:H)&255,H=j,E[T+F]=ne}}function Xt(u,f,v,_){var E=f.width,T=f.o;if(e(u!=null&&f!=null),0>v||0>=_||v+_>T)return null;if(!u.Cc){if(u.ga==null){var R;if(u.ga=new wt,(R=u.ga==null)||(R=f.width*f.o,e(u.Gb.length==0),u.Gb=a(R),u.Uc=0,u.Gb==null?R=0:(u.mb=u.Gb,u.nb=u.Uc,u.rc=null,R=1),R=!R),!R){R=u.ga;var F=u.Fa,j=u.P,H=u.qc,ne=u.mb,he=u.nb,W=j+1,ie=H-1,le=R.l;if(e(F!=null&&ne!=null&&f!=null),Zi[0]=null,Zi[1]=Ot,Zi[2]=on,Zi[3]=kn,R.ca=ne,R.tb=he,R.c=f.width,R.i=f.height,e(0<R.c&&0<R.i),1>=H)f=0;else if(R.$a=3&F[j+0],R.Z=F[j+0]>>2&3,R.Lc=F[j+0]>>4&3,j=F[j+0]>>6&3,0>R.$a||1<R.$a||4<=R.Z||1<R.Lc||j)f=0;else if(le.put=rt,le.ac=Tr,le.bc=gr,le.ma=R,le.width=f.width,le.height=f.height,le.Da=f.Da,le.v=f.v,le.va=f.va,le.j=f.j,le.o=f.o,R.$a)e:{e(R.$a==1),f=ai();t:for(;;){if(f==null){f=0;break e}if(e(R!=null),R.mc=f,f.c=R.c,f.i=R.i,f.l=R.l,f.l.ma=R,f.l.width=R.c,f.l.height=R.i,f.a=0,fe(f.m,F,W,ie),!Or(R.c,R.i,1,f,null)||(f.ab==1&&f.gc[0].hc==3&&ur(f.s)?(R.ic=1,F=f.c*f.i,f.Ta=null,f.Ua=0,f.V=a(F),f.Ba=0,f.V==null?(f.a=1,f=0):f=1):(R.ic=0,f=Ue(f,R.c)),!f))break t;f=1;break e}R.mc=null,f=0}else f=ie>=R.c*R.i;R=!f}if(R)return null;u.ga.Lc!=1?u.Ga=0:_=T-v}e(u.ga!=null),e(v+_<=T);e:{if(f=(F=u.ga).c,T=F.l.o,F.$a==0){if(W=u.rc,ie=u.Vc,le=u.Fa,j=u.P+1+v*f,H=u.mb,ne=u.nb+v*f,e(j<=u.P+u.qc),F.Z!=0)for(e(Zi[F.Z]!=null),R=0;R<_;++R)Zi[F.Z](W,ie,le,j,H,ne,f),W=H,ie=ne,ne+=f,j+=f;else for(R=0;R<_;++R)r(H,ne,le,j,f),W=H,ie=ne,ne+=f,j+=f;u.rc=W,u.Vc=ie}else{if(e(F.mc!=null),f=v+_,e((R=F.mc)!=null),e(f<=R.i),R.C>=f)f=1;else if(F.ic||Hr(),F.ic){F=R.V,W=R.Ba,ie=R.c;var ve=R.i,de=(le=1,j=R.$/ie,H=R.$%ie,ne=R.m,he=R.s,R.$),be=ie*ve,_e=ie*f,Ee=he.wc,Se=de<_e?xn(he,H,j):null;e(de<=be),e(f<=ve),e(ur(he));t:for(;;){for(;!ne.h&&de<_e;){if(H&Ee||(Se=xn(he,H,j)),e(Se!=null),z(ne),256>(ve=Pt(Se.G[0],Se.H[0],ne)))F[W+de]=ve,++de,++H>=ie&&(H=0,++j<=f&&!(j%16)&&dr(R,j));else{if(!(280>ve)){le=0;break t}ve=er(ve-256,ne);var Ze,De=Pt(Se.G[4],Se.H[4],ne);if(z(ne),!(de>=(De=cr(ie,De=er(De,ne)))&&be-de>=ve)){le=0;break t}for(Ze=0;Ze<ve;++Ze)F[W+de+Ze]=F[W+de+Ze-De];for(de+=ve,H+=ve;H>=ie;)H-=ie,++j<=f&&!(j%16)&&dr(R,j);de<_e&&H&Ee&&(Se=xn(he,H,j))}e(ne.h==Y(ne))}dr(R,j>f?f:j);break t}!le||ne.h&&de<be?(le=0,R.a=ne.h?5:3):R.$=de,f=le}else f=hr(R,R.V,R.Ba,R.c,R.i,f,te);if(!f){_=0;break e}}v+_>=T&&(u.Cc=1),_=1}if(!_)return null;if(u.Cc&&((_=u.ga)!=null&&(_.mc=null),u.ga=null,0<u.Ga))return alert("todo:WebPDequantizeLevels"),null}return u.nb+v*E}function In(u,f,v,_,E,T){for(;0<E--;){var R,F=u,j=f+(v?1:0),H=u,ne=f+(v?0:3);for(R=0;R<_;++R){var he=H[ne+4*R];he!=255&&(he*=32897,F[j+4*R+0]=F[j+4*R+0]*he>>23,F[j+4*R+1]=F[j+4*R+1]*he>>23,F[j+4*R+2]=F[j+4*R+2]*he>>23)}f+=T}}function Nn(u,f,v,_,E){for(;0<_--;){var T;for(T=0;T<v;++T){var R=u[f+2*T+0],F=15&(H=u[f+2*T+1]),j=4369*F,H=(240&H|H>>4)*j>>16;u[f+2*T+0]=(240&R|R>>4)*j>>16&240|(15&R|R<<4)*j>>16>>4&15,u[f+2*T+1]=240&H|F}f+=E}}function Mn(u,f,v,_,E,T,R,F){var j,H,ne=255;for(H=0;H<E;++H){for(j=0;j<_;++j){var he=u[f+j];T[R+4*j]=he,ne&=he}f+=v,R+=F}return ne!=255}function Ei(u,f,v,_,E){var T;for(T=0;T<E;++T)v[_+T]=u[f+T]>>8}function Hr(){Gs=In,Fd=Nn,Dd=Mn,jd=Ei}function Li(u,f,v){D[u]=function(_,E,T,R,F,j,H,ne,he,W,ie,le,ve,de,be,_e,Ee){var Se,Ze=Ee-1>>1,De=F[j+0]|H[ne+0]<<16,xt=he[W+0]|ie[le+0]<<16;e(_!=null);var Ge=3*De+xt+131074>>2;for(f(_[E+0],255&Ge,Ge>>16,ve,de),T!=null&&(Ge=3*xt+De+131074>>2,f(T[R+0],255&Ge,Ge>>16,be,_e)),Se=1;Se<=Ze;++Se){var Tt=F[j+Se]|H[ne+Se]<<16,On=he[W+Se]|ie[le+Se]<<16,St=De+Tt+xt+On+524296,Ve=St+2*(Tt+xt)>>3;Ge=Ve+De>>1,De=(St=St+2*(De+On)>>3)+Tt>>1,f(_[E+2*Se-1],255&Ge,Ge>>16,ve,de+(2*Se-1)*v),f(_[E+2*Se-0],255&De,De>>16,ve,de+(2*Se-0)*v),T!=null&&(Ge=St+xt>>1,De=Ve+On>>1,f(T[R+2*Se-1],255&Ge,Ge>>16,be,_e+(2*Se-1)*v),f(T[R+2*Se+0],255&De,De>>16,be,_e+(2*Se+0)*v)),De=Tt,xt=On}1&Ee||(Ge=3*De+xt+131074>>2,f(_[E+Ee-1],255&Ge,Ge>>16,ve,de+(Ee-1)*v),T!=null&&(Ge=3*xt+De+131074>>2,f(T[R+Ee-1],255&Ge,Ge>>16,be,_e+(Ee-1)*v)))}}function Fs(){Mr[Ko]=Eg,Mr[Jo]=Kd,Mr[zd]=Lg,Mr[Yo]=Jd,Mr[Xo]=Yd,Mr[Ec]=Xd,Mr[Hd]=Cg,Mr[Lc]=Kd,Mr[Cc]=Jd,Mr[Zo]=Yd,Mr[Tc]=Xd}function Ya(u){return u&-16384?0>u?0:255:u>>Tg}function qi(u,f){return Ya((19077*u>>8)+(26149*f>>8)-14234)}function ba(u,f,v){return Ya((19077*u>>8)-(6419*f>>8)-(13320*v>>8)+8708)}function ya(u,f){return Ya((19077*u>>8)+(33050*f>>8)-17685)}function zi(u,f,v,_,E){_[E+0]=qi(u,v),_[E+1]=ba(u,f,v),_[E+2]=ya(u,f)}function Un(u,f,v,_,E){_[E+0]=ya(u,f),_[E+1]=ba(u,f,v),_[E+2]=qi(u,v)}function _a(u,f,v,_,E){var T=ba(u,f,v);f=T<<3&224|ya(u,f)>>3,_[E+0]=248&qi(u,v)|T>>5,_[E+1]=f}function wa(u,f,v,_,E){var T=240&ya(u,f)|15;_[E+0]=240&qi(u,v)|ba(u,f,v)>>4,_[E+1]=T}function Ds(u,f,v,_,E){_[E+0]=255,zi(u,f,v,_,E+1)}function js(u,f,v,_,E){Un(u,f,v,_,E),_[E+3]=255}function nr(u,f,v,_,E){zi(u,f,v,_,E),_[E+3]=255}function Ci(u,f,v){D[u]=function(_,E,T,R,F,j,H,ne,he){for(var W=ne+(-2&he)*v;ne!=W;)f(_[E+0],T[R+0],F[j+0],H,ne),f(_[E+1],T[R+0],F[j+0],H,ne+v),E+=2,++R,++j,ne+=2*v;1&he&&f(_[E+0],T[R+0],F[j+0],H,ne)}}function Xa(u,f,v){return v==0?u==0?f==0?6:5:f==0?4:0:v}function Ho(u,f,v,_,E){switch(u>>>30){case 3:ka(f,v,_,E,0);break;case 2:jr(f,v,_,E);break;case 1:Bt(f,v,_,E)}}function Dr(u,f){var v,_,E=f.M,T=f.Nb,R=u.oc,F=u.pc+40,j=u.oc,H=u.pc+584,ne=u.oc,he=u.pc+600;for(v=0;16>v;++v)R[F+32*v-1]=129;for(v=0;8>v;++v)j[H+32*v-1]=129,ne[he+32*v-1]=129;for(0<E?R[F-1-32]=j[H-1-32]=ne[he-1-32]=129:(i(R,F-32-1,127,21),i(j,H-32-1,127,9),i(ne,he-32-1,127,9)),_=0;_<u.za;++_){var W=f.ya[f.aa+_];if(0<_){for(v=-1;16>v;++v)r(R,F+32*v-4,R,F+32*v+12,4);for(v=-1;8>v;++v)r(j,H+32*v-4,j,H+32*v+4,4),r(ne,he+32*v-4,ne,he+32*v+4,4)}var ie=u.Gd,le=u.Hd+_,ve=W.ad,de=W.Hc;if(0<E&&(r(R,F-32,ie[le].y,0,16),r(j,H-32,ie[le].f,0,8),r(ne,he-32,ie[le].ea,0,8)),W.Za){var be=R,_e=F-32+16;for(0<E&&(_>=u.za-1?i(be,_e,ie[le].y[15],4):r(be,_e,ie[le+1].y,0,4)),v=0;4>v;v++)be[_e+128+v]=be[_e+256+v]=be[_e+384+v]=be[_e+0+v];for(v=0;16>v;++v,de<<=2)be=R,_e=F+Qd[v],Wr[W.Ob[v]](be,_e),Ho(de,ve,16*+v,be,_e)}else if(be=Xa(_,E,W.Ob[0]),Xi[be](R,F),de!=0)for(v=0;16>v;++v,de<<=2)Ho(de,ve,16*+v,R,F+Qd[v]);for(v=W.Gc,be=Xa(_,E,W.Dd),Pi[be](j,H),Pi[be](ne,he),de=ve,be=j,_e=H,255&(W=0|v)&&(170&W?di(de,256,be,_e):Gt(de,256,be,_e)),W=ne,de=he,255&(v>>=8)&&(170&v?di(ve,320,W,de):Gt(ve,320,W,de)),E<u.Ub-1&&(r(ie[le].y,0,R,F+480,16),r(ie[le].f,0,j,H+224,8),r(ie[le].ea,0,ne,he+224,8)),v=8*T*u.B,ie=u.sa,le=u.ta+16*_+16*T*u.R,ve=u.qa,W=u.ra+8*_+v,de=u.Ha,be=u.Ia+8*_+v,v=0;16>v;++v)r(ie,le+v*u.R,R,F+32*v,16);for(v=0;8>v;++v)r(ve,W+v*u.B,j,H+32*v,8),r(de,be+v*u.B,ne,he+32*v,8)}}function xa(u,f,v,_,E,T,R,F,j){var H=[0],ne=[0],he=0,W=j!=null?j.kd:0,ie=j??new xe;if(u==null||12>v)return 7;ie.data=u,ie.w=f,ie.ha=v,f=[f],v=[v],ie.gb=[ie.gb];e:{var le=f,ve=v,de=ie.gb;if(e(u!=null),e(ve!=null),e(de!=null),de[0]=0,12<=ve[0]&&!n(u,le[0],"RIFF")){if(n(u,le[0]+8,"WEBP")){de=3;break e}var be=Me(u,le[0]+4);if(12>be||4294967286<be){de=3;break e}if(W&&be>ve[0]-8){de=7;break e}de[0]=be,le[0]+=12,ve[0]-=12}de=0}if(de!=0)return de;for(be=0<ie.gb[0],v=v[0];;){e:{var _e=u;ve=f,de=v;var Ee=H,Se=ne,Ze=le=[0];if((Ge=he=[he])[0]=0,8>de[0])de=7;else{if(!n(_e,ve[0],"VP8X")){if(Me(_e,ve[0]+4)!=10){de=3;break e}if(18>de[0]){de=7;break e}var De=Me(_e,ve[0]+8),xt=1+Te(_e,ve[0]+12);if(2147483648<=xt*(_e=1+Te(_e,ve[0]+15))){de=3;break e}Ze!=null&&(Ze[0]=De),Ee!=null&&(Ee[0]=xt),Se!=null&&(Se[0]=_e),ve[0]+=18,de[0]-=18,Ge[0]=1}de=0}}if(he=he[0],le=le[0],de!=0)return de;if(ve=!!(2&le),!be&&he)return 3;if(T!=null&&(T[0]=!!(16&le)),R!=null&&(R[0]=ve),F!=null&&(F[0]=0),R=H[0],le=ne[0],he&&ve&&j==null){de=0;break}if(4>v){de=7;break}if(be&&he||!be&&!he&&!n(u,f[0],"ALPH")){v=[v],ie.na=[ie.na],ie.P=[ie.P],ie.Sa=[ie.Sa];e:{De=u,de=f,be=v;var Ge=ie.gb;Ee=ie.na,Se=ie.P,Ze=ie.Sa,xt=22,e(De!=null),e(be!=null),_e=de[0];var Tt=be[0];for(e(Ee!=null),e(Ze!=null),Ee[0]=null,Se[0]=null,Ze[0]=0;;){if(de[0]=_e,be[0]=Tt,8>Tt){de=7;break e}var On=Me(De,_e+4);if(4294967286<On){de=3;break e}var St=8+On+1&-2;if(xt+=St,0<Ge&&xt>Ge){de=3;break e}if(!n(De,_e,"VP8 ")||!n(De,_e,"VP8L")){de=0;break e}if(Tt[0]<St){de=7;break e}n(De,_e,"ALPH")||(Ee[0]=De,Se[0]=_e+8,Ze[0]=On),_e+=St,Tt-=St}}if(v=v[0],ie.na=ie.na[0],ie.P=ie.P[0],ie.Sa=ie.Sa[0],de!=0)break}v=[v],ie.Ja=[ie.Ja],ie.xa=[ie.xa];e:if(Ge=u,de=f,be=v,Ee=ie.gb[0],Se=ie.Ja,Ze=ie.xa,De=de[0],_e=!n(Ge,De,"VP8 "),xt=!n(Ge,De,"VP8L"),e(Ge!=null),e(be!=null),e(Se!=null),e(Ze!=null),8>be[0])de=7;else{if(_e||xt){if(Ge=Me(Ge,De+4),12<=Ee&&Ge>Ee-12){de=3;break e}if(W&&Ge>be[0]-8){de=7;break e}Se[0]=Ge,de[0]+=8,be[0]-=8,Ze[0]=xt}else Ze[0]=5<=be[0]&&Ge[De+0]==47&&!(Ge[De+4]>>5),Se[0]=be[0];de=0}if(v=v[0],ie.Ja=ie.Ja[0],ie.xa=ie.xa[0],f=f[0],de!=0)break;if(4294967286<ie.Ja)return 3;if(F==null||ve||(F[0]=ie.xa?2:1),R=[R],le=[le],ie.xa){if(5>v){de=7;break}F=R,W=le,ve=T,u==null||5>v?u=0:5<=v&&u[f+0]==47&&!(u[f+4]>>5)?(be=[0],Ge=[0],Ee=[0],fe(Se=new q,u,f,v),Ir(Se,be,Ge,Ee)?(F!=null&&(F[0]=be[0]),W!=null&&(W[0]=Ge[0]),ve!=null&&(ve[0]=Ee[0]),u=1):u=0):u=0}else{if(10>v){de=7;break}F=le,u==null||10>v||!Oo(u,f+3,v-3)?u=0:(W=u[f+0]|u[f+1]<<8|u[f+2]<<16,ve=16383&(u[f+7]<<8|u[f+6]),u=16383&(u[f+9]<<8|u[f+8]),1&W||3<(W>>1&7)||!(W>>4&1)||W>>5>=ie.Ja||!ve||!u?u=0:(R&&(R[0]=ve),F&&(F[0]=u),u=1))}if(!u||(R=R[0],le=le[0],he&&(H[0]!=R||ne[0]!=le)))return 3;j!=null&&(j[0]=ie,j.offset=f-j.w,e(4294967286>f-j.w),e(j.offset==j.ha-v));break}return de==0||de==7&&he&&j==null?(T!=null&&(T[0]|=ie.na!=null&&0<ie.na.length),_!=null&&(_[0]=R),E!=null&&(E[0]=le),0):de}function Bs(u,f,v){var _=f.width,E=f.height,T=0,R=0,F=_,j=E;if(f.Da=u!=null&&0<u.Da,f.Da&&(F=u.cd,j=u.bd,T=u.v,R=u.j,11>v||(T&=-2,R&=-2),0>T||0>R||0>=F||0>=j||T+F>_||R+j>E))return 0;if(f.v=T,f.j=R,f.va=T+F,f.o=R+j,f.U=F,f.T=j,f.da=u!=null&&0<u.da,f.da){if(!He(F,j,v=[u.ib],T=[u.hb]))return 0;f.ib=v[0],f.hb=T[0]}return f.ob=u!=null&&u.ob,f.Kb=u==null||!u.Sd,f.da&&(f.ob=f.ib<3*_/4&&f.hb<3*E/4,f.Kb=0),1}function Ms(u){if(u==null)return 2;if(11>u.S){var f=u.f.RGBA;f.fb+=(u.height-1)*f.A,f.A=-f.A}else f=u.f.kb,u=u.height,f.O+=(u-1)*f.fa,f.fa=-f.fa,f.N+=(u-1>>1)*f.Ab,f.Ab=-f.Ab,f.W+=(u-1>>1)*f.Db,f.Db=-f.Db,f.F!=null&&(f.J+=(u-1)*f.lb,f.lb=-f.lb);return 0}function Hi(u,f,v,_){if(_==null||0>=u||0>=f)return 2;if(v!=null){if(v.Da){var E=v.cd,T=v.bd,R=-2&v.v,F=-2&v.j;if(0>R||0>F||0>=E||0>=T||R+E>u||F+T>f)return 2;u=E,f=T}if(v.da){if(!He(u,f,E=[v.ib],T=[v.hb]))return 2;u=E[0],f=T[0]}}_.width=u,_.height=f;e:{var j=_.width,H=_.height;if(u=_.S,0>=j||0>=H||!(u>=Ko&&13>u))u=2;else{if(0>=_.Rd&&_.sd==null){R=T=E=f=0;var ne=(F=j*eh[u])*H;if(11>u||(T=(H+1)/2*(f=(j+1)/2),u==12&&(R=(E=j)*H)),(H=a(ne+2*T+R))==null){u=1;break e}_.sd=H,11>u?((j=_.f.RGBA).eb=H,j.fb=0,j.A=F,j.size=ne):((j=_.f.kb).y=H,j.O=0,j.fa=F,j.Fd=ne,j.f=H,j.N=0+ne,j.Ab=f,j.Cd=T,j.ea=H,j.W=0+ne+T,j.Db=f,j.Ed=T,u==12&&(j.F=H,j.J=0+ne+2*T),j.Tc=R,j.lb=E)}if(f=1,E=_.S,T=_.width,R=_.height,E>=Ko&&13>E)if(11>E)u=_.f.RGBA,f&=(F=Math.abs(u.A))*(R-1)+T<=u.size,f&=F>=T*eh[E],f&=u.eb!=null;else{u=_.f.kb,F=(T+1)/2,ne=(R+1)/2,j=Math.abs(u.fa),H=Math.abs(u.Ab);var he=Math.abs(u.Db),W=Math.abs(u.lb),ie=W*(R-1)+T;f&=j*(R-1)+T<=u.Fd,f&=H*(ne-1)+F<=u.Cd,f=(f&=he*(ne-1)+F<=u.Ed)&j>=T&H>=F&he>=F,f&=u.y!=null,f&=u.f!=null,f&=u.ea!=null,E==12&&(f&=W>=T,f&=ie<=u.Tc,f&=u.F!=null)}else f=0;u=f?0:2}}return u!=0||v!=null&&v.fd&&(u=Ms(_)),u}var Sa=64,vr=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],br=24,Wi=32,Ti=8,Gi=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Re("Predictor0","PredictorAdd0"),D.Predictor0=function(){return 4278190080},D.Predictor1=function(u){return u},D.Predictor2=function(u,f,v){return f[v+0]},D.Predictor3=function(u,f,v){return f[v+1]},D.Predictor4=function(u,f,v){return f[v-1]},D.Predictor5=function(u,f,v){return Ie(Ie(u,f[v+1]),f[v+0])},D.Predictor6=function(u,f,v){return Ie(u,f[v-1])},D.Predictor7=function(u,f,v){return Ie(u,f[v+0])},D.Predictor8=function(u,f,v){return Ie(f[v-1],f[v+0])},D.Predictor9=function(u,f,v){return Ie(f[v+0],f[v+1])},D.Predictor10=function(u,f,v){return Ie(Ie(u,f[v-1]),Ie(f[v+0],f[v+1]))},D.Predictor11=function(u,f,v){var _=f[v+0];return 0>=at(_>>24&255,u>>24&255,(f=f[v-1])>>24&255)+at(_>>16&255,u>>16&255,f>>16&255)+at(_>>8&255,u>>8&255,f>>8&255)+at(255&_,255&u,255&f)?_:u},D.Predictor12=function(u,f,v){var _=f[v+0];return(it((u>>24&255)+(_>>24&255)-((f=f[v-1])>>24&255))<<24|it((u>>16&255)+(_>>16&255)-(f>>16&255))<<16|it((u>>8&255)+(_>>8&255)-(f>>8&255))<<8|it((255&u)+(255&_)-(255&f)))>>>0},D.Predictor13=function(u,f,v){var _=f[v-1];return(nt((u=Ie(u,f[v+0]))>>24&255,_>>24&255)<<24|nt(u>>16&255,_>>16&255)<<16|nt(u>>8&255,_>>8&255)<<8|nt(255&u,255&_))>>>0};var Us=D.PredictorAdd0;D.PredictorAdd1=ut,Re("Predictor2","PredictorAdd2"),Re("Predictor3","PredictorAdd3"),Re("Predictor4","PredictorAdd4"),Re("Predictor5","PredictorAdd5"),Re("Predictor6","PredictorAdd6"),Re("Predictor7","PredictorAdd7"),Re("Predictor8","PredictorAdd8"),Re("Predictor9","PredictorAdd9"),Re("Predictor10","PredictorAdd10"),Re("Predictor11","PredictorAdd11"),Re("Predictor12","PredictorAdd12"),Re("Predictor13","PredictorAdd13");var Za=D.PredictorAdd2;We("ColorIndexInverseTransform","MapARGB","32b",function(u){return u>>8&255},function(u){return u}),We("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(u){return u},function(u){return u>>8&255});var mn,Wo=D.ColorIndexInverseTransform,ci=D.MapARGB,ui=D.VP8LColorIndexInverseTransformAlpha,$s=D.MapAlpha,qs=D.VP8LPredictorsAdd=[];qs.length=16,(D.VP8LPredictors=[]).length=16,(D.VP8LPredictorsAdd_C=[]).length=16,(D.VP8LPredictors_C=[]).length=16;var zs,Hs,Vi,Ki,Ji,Aa,Yi,ka,jr,di,Bt,Gt,gn,Pn,Ii,Ws,Qa,Go,Cd,Td,Id,Pd,Od,Rd,Gs,Fd,Dd,jd,Bd=a(511),Md=a(2041),Ud=a(225),$d=a(767),qd=0,Nc=Md,Vo=Ud,yr=$d,Br=Bd,Ko=0,Jo=1,zd=2,Yo=3,Xo=4,Ec=5,Hd=6,Lc=7,Cc=8,Zo=9,Tc=10,fg=[2,3,7],pg=[3,3,11],Wd=[280,256,256,256,40],mg=[0,1,1,1,0],gg=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],vg=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],bg=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],yg=8,Ic=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Pc=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Vs=null,_g=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],wg=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Gd=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],xg=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Sg=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Ag=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],kg=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Xi=[],Wr=[],Pi=[],Ng=1,Vd=2,Zi=[],Mr=[];Li("UpsampleRgbLinePair",zi,3),Li("UpsampleBgrLinePair",Un,3),Li("UpsampleRgbaLinePair",nr,4),Li("UpsampleBgraLinePair",js,4),Li("UpsampleArgbLinePair",Ds,4),Li("UpsampleRgba4444LinePair",wa,2),Li("UpsampleRgb565LinePair",_a,2);var Eg=D.UpsampleRgbLinePair,Lg=D.UpsampleBgrLinePair,Kd=D.UpsampleRgbaLinePair,Jd=D.UpsampleBgraLinePair,Yd=D.UpsampleArgbLinePair,Xd=D.UpsampleRgba4444LinePair,Cg=D.UpsampleRgb565LinePair,Qo=16,el=1<<Qo-1,Ks=-227,Oc=482,Tg=6,Zd=0,Ig=a(256),Pg=a(256),Og=a(256),Rg=a(256),Fg=a(Oc-Ks),Dg=a(Oc-Ks);Ci("YuvToRgbRow",zi,3),Ci("YuvToBgrRow",Un,3),Ci("YuvToRgbaRow",nr,4),Ci("YuvToBgraRow",js,4),Ci("YuvToArgbRow",Ds,4),Ci("YuvToRgba4444Row",wa,2),Ci("YuvToRgb565Row",_a,2);var Qd=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],tl=[0,2,8],jg=[8,7,6,4,4,2,2,2,1,1,1,1],Bg=1;this.WebPDecodeRGBA=function(u,f,v,_,E){var T=Jo,R=new ye,F=new kt;R.ba=F,F.S=T,F.width=[F.width],F.height=[F.height];var j=F.width,H=F.height,ne=new tt;if(ne==null||u==null)var he=2;else e(ne!=null),he=xa(u,f,v,ne.width,ne.height,ne.Pd,ne.Qd,ne.format,null);if(he!=0?j=0:(j!=null&&(j[0]=ne.width[0]),H!=null&&(H[0]=ne.height[0]),j=1),j){F.width=F.width[0],F.height=F.height[0],_!=null&&(_[0]=F.width),E!=null&&(E[0]=F.height);e:{if(_=new Wa,(E=new xe).data=u,E.w=f,E.ha=v,E.kd=1,f=[0],e(E!=null),((u=xa(E.data,E.w,E.ha,null,null,null,f,null,E))==0||u==7)&&f[0]&&(u=4),(f=u)==0){if(e(R!=null),_.data=E.data,_.w=E.w+E.offset,_.ha=E.ha-E.offset,_.put=rt,_.ac=Tr,_.bc=gr,_.ma=R,E.xa){if((u=ai())==null){R=1;break e}if((function(W,ie){var le=[0],ve=[0],de=[0];t:for(;;){if(W==null)return 0;if(ie==null)return W.a=2,0;if(W.l=ie,W.a=0,fe(W.m,ie.data,ie.w,ie.ha),!Ir(W.m,le,ve,de)){W.a=3;break t}if(W.xb=Vd,ie.width=le[0],ie.height=ve[0],!Or(le[0],ve[0],1,W,null))break t;return 1}return e(W.a!=0),0})(u,_)){if(_=(f=Hi(_.width,_.height,R.Oa,R.ba))==0){t:{_=u;n:for(;;){if(_==null){_=0;break t}if(e(_.s.yc!=null),e(_.s.Ya!=null),e(0<_.s.Wb),e((v=_.l)!=null),e((E=v.ma)!=null),_.xb!=0){if(_.ca=E.ba,_.tb=E.tb,e(_.ca!=null),!Bs(E.Oa,v,Yo)){_.a=2;break n}if(!Ue(_,v.width)||v.da)break n;if((v.da||st(_.ca.S))&&Hr(),11>_.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),_.ca.f.kb.F!=null&&Hr()),_.Pb&&0<_.s.ua&&_.s.vb.X==null&&!$(_.s.vb,_.s.Wa.Xa)){_.a=1;break n}_.xb=0}if(!hr(_,_.V,_.Ba,_.c,_.i,v.o,Pr))break n;E.Dc=_.Ma,_=1;break t}e(_.a!=0),_=0}_=!_}_&&(f=u.a)}else f=u.a}else{if((u=new dc)==null){R=1;break e}if(u.Fa=E.na,u.P=E.P,u.qc=E.Sa,oi(u,_)){if((f=Hi(_.width,_.height,R.Oa,R.ba))==0){if(u.Aa=0,v=R.Oa,e((E=u)!=null),v!=null){if(0<(j=0>(j=v.Md)?0:100<j?255:255*j/100)){for(H=ne=0;4>H;++H)12>(he=E.pb[H]).lc&&(he.ia=j*jg[0>he.lc?0:he.lc]>>3),ne|=he.ia;ne&&(alert("todo:VP8InitRandom"),E.ia=1)}E.Ga=v.Id,100<E.Ga?E.Ga=100:0>E.Ga&&(E.Ga=0)}(function(W,ie){if(W==null)return 0;if(ie==null)return An(W,2,"NULL VP8Io parameter in VP8Decode().");if(!W.cb&&!oi(W,ie))return 0;if(e(W.cb),ie.ac==null||ie.ac(ie)){ie.ob&&(W.L=0);var le=tl[W.L];if(W.L==2?(W.yb=0,W.zb=0):(W.yb=ie.v-le>>4,W.zb=ie.j-le>>4,0>W.yb&&(W.yb=0),0>W.zb&&(W.zb=0)),W.Va=ie.o+15+le>>4,W.Hb=ie.va+15+le>>4,W.Hb>W.za&&(W.Hb=W.za),W.Va>W.Ub&&(W.Va=W.Ub),0<W.L){var ve=W.ed;for(le=0;4>le;++le){var de;if(W.Qa.Cb){var be=W.Qa.Lb[le];W.Qa.Fb||(be+=ve.Tb)}else be=ve.Tb;for(de=0;1>=de;++de){var _e=W.gd[le][de],Ee=be;if(ve.Pc&&(Ee+=ve.vd[0],de&&(Ee+=ve.od[0])),0<(Ee=0>Ee?0:63<Ee?63:Ee)){var Se=Ee;0<ve.wb&&(Se=4<ve.wb?Se>>2:Se>>1)>9-ve.wb&&(Se=9-ve.wb),1>Se&&(Se=1),_e.dd=Se,_e.tc=2*Ee+Se,_e.ld=40<=Ee?2:15<=Ee?1:0}else _e.tc=0;_e.La=de}}}le=0}else An(W,6,"Frame setup failed"),le=W.a;if(le=le==0){if(le){W.$c=0,0<W.Aa||(W.Ic=Bg);t:{le=W.Ic,ve=4*(Se=W.za);var Ze=32*Se,De=Se+1,xt=0<W.L?Se*(0<W.Aa?2:1):0,Ge=(W.Aa==2?2:1)*Se;if((_e=ve+832+(de=3*(16*le+tl[W.L])/2*Ze)+(be=W.Fa!=null&&0<W.Fa.length?W.Kc.c*W.Kc.i:0))!=_e)le=0;else{if(_e>W.Vb){if(W.Vb=0,W.Ec=a(_e),W.Fc=0,W.Ec==null){le=An(W,1,"no memory during frame initialization.");break t}W.Vb=_e}_e=W.Ec,Ee=W.Fc,W.Ac=_e,W.Bc=Ee,Ee+=ve,W.Gd=o(Ze,ha),W.Hd=0,W.rb=o(De+1,Rr),W.sb=1,W.wa=xt?o(xt,un):null,W.Y=0,W.D.Nb=0,W.D.wa=W.wa,W.D.Y=W.Y,0<W.Aa&&(W.D.Y+=Se),e(!0),W.oc=_e,W.pc=Ee,Ee+=832,W.ya=o(Ge,sn),W.aa=0,W.D.ya=W.ya,W.D.aa=W.aa,W.Aa==2&&(W.D.aa+=Se),W.R=16*Se,W.B=8*Se,Se=(Ze=tl[W.L])*W.R,Ze=Ze/2*W.B,W.sa=_e,W.ta=Ee+Se,W.qa=W.sa,W.ra=W.ta+16*le*W.R+Ze,W.Ha=W.qa,W.Ia=W.ra+8*le*W.B+Ze,W.$c=0,Ee+=de,W.mb=be?_e:null,W.nb=be?Ee:null,e(Ee+be<=W.Fc+W.Vb),Ro(W),i(W.Ac,W.Bc,0,ve),le=1}}if(le){if(ie.ka=0,ie.y=W.sa,ie.O=W.ta,ie.f=W.qa,ie.N=W.ra,ie.ea=W.Ha,ie.Vd=W.Ia,ie.fa=W.R,ie.Rc=W.B,ie.F=null,ie.J=0,!qd){for(le=-255;255>=le;++le)Bd[255+le]=0>le?-le:le;for(le=-1020;1020>=le;++le)Md[1020+le]=-128>le?-128:127<le?127:le;for(le=-112;112>=le;++le)Ud[112+le]=-16>le?-16:15<le?15:le;for(le=-255;510>=le;++le)$d[255+le]=0>le?0:255<le?255:le;qd=1}Yi=Va,ka=fc,di=li,Bt=Do,Gt=jo,jr=hc,gn=qo,Pn=va,Ii=N,Ws=G,Qa=zo,Go=m,Cd=Z,Td=se,Id=ga,Pd=Rs,Od=Uo,Rd=$o,Wr[0]=wc,Wr[1]=pc,Wr[2]=yc,Wr[3]=_c,Wr[4]=wi,Wr[5]=xc,Wr[6]=xi,Wr[7]=Sc,Wr[8]=Cs,Wr[9]=Ka,Xi[0]=vc,Xi[1]=gc,Xi[2]=Es,Xi[3]=Bo,Xi[4]=pa,Xi[5]=Ls,Xi[6]=bc,Pi[0]=kc,Pi[1]=mc,Pi[2]=ma,Pi[3]=Ac,Pi[4]=Is,Pi[5]=Ts,Pi[6]=Mo,le=1}else le=0}le&&(le=(function(Tt,On){for(Tt.M=0;Tt.M<Tt.Va;++Tt.M){var St,Ve=Tt.Jc[Tt.M&Tt.Xb],Oe=Tt.m,vn=Tt;for(St=0;St<vn.za;++St){var _t=Oe,It=vn,tn=It.Ac,$n=It.Bc+4*St,rr=It.zc,dn=It.ya[It.aa+St];if(It.Qa.Bb?dn.$b=ge(_t,It.Pa.jb[0])?2+ge(_t,It.Pa.jb[2]):ge(_t,It.Pa.jb[1]):dn.$b=0,It.kc&&(dn.Ad=ge(_t,It.Bd)),dn.Za=!ge(_t,145)+0,dn.Za){var Vn=dn.Ob,ir=0;for(It=0;4>It;++It){var Rn,Rt=rr[0+It];for(Rn=0;4>Rn;++Rn){Rt=Sg[tn[$n+Rn]][Rt];for(var $t=Gd[ge(_t,Rt[0])];0<$t;)$t=Gd[2*$t+ge(_t,Rt[$t])];Rt=-$t,tn[$n+Rn]=Rt}r(Vn,ir,tn,$n,4),ir+=4,rr[0+It]=Rt}}else Rt=ge(_t,156)?ge(_t,128)?1:3:ge(_t,163)?2:0,dn.Ob[0]=Rt,i(tn,$n,Rt,4),i(rr,0,Rt,4);dn.Dd=ge(_t,142)?ge(_t,114)?ge(_t,183)?1:3:2:0}if(vn.m.Ka)return An(Tt,7,"Premature end-of-partition0 encountered.");for(;Tt.ja<Tt.za;++Tt.ja){if(vn=Ve,_t=(Oe=Tt).rb[Oe.sb-1],tn=Oe.rb[Oe.sb+Oe.ja],St=Oe.ya[Oe.aa+Oe.ja],$n=Oe.kc?St.Ad:0)_t.la=tn.la=0,St.Za||(_t.Na=tn.Na=0),St.Hc=0,St.Gc=0,St.ia=0;else{var hn,qt;if(_t=tn,tn=vn,$n=Oe.Pa.Xc,rr=Oe.ya[Oe.aa+Oe.ja],dn=Oe.pb[rr.$b],It=rr.ad,Vn=0,ir=Oe.rb[Oe.sb-1],Rt=Rn=0,i(It,Vn,0,384),rr.Za)var qn=0,Gr=$n[3];else{$t=a(16);var bn=_t.Na+ir.Na;if(bn=Vs(tn,$n[1],bn,dn.Eb,0,$t,0),_t.Na=ir.Na=(0<bn)+0,1<bn)Yi($t,0,It,Vn);else{var fr=$t[0]+3>>3;for($t=0;256>$t;$t+=16)It[Vn+$t]=fr}qn=1,Gr=$n[0]}var Vt=15&_t.la,Fn=15&ir.la;for($t=0;4>$t;++$t){var _r=1&Fn;for(fr=qt=0;4>fr;++fr)Vt=Vt>>1|(_r=(bn=Vs(tn,Gr,bn=_r+(1&Vt),dn.Sc,qn,It,Vn))>qn)<<7,qt=qt<<2|(3<bn?3:1<bn?2:It[Vn+0]!=0),Vn+=16;Vt>>=4,Fn=Fn>>1|_r<<7,Rn=(Rn<<8|qt)>>>0}for(Gr=Vt,qn=Fn>>4,hn=0;4>hn;hn+=2){for(qt=0,Vt=_t.la>>4+hn,Fn=ir.la>>4+hn,$t=0;2>$t;++$t){for(_r=1&Fn,fr=0;2>fr;++fr)bn=_r+(1&Vt),Vt=Vt>>1|(_r=0<(bn=Vs(tn,$n[2],bn,dn.Qc,0,It,Vn)))<<3,qt=qt<<2|(3<bn?3:1<bn?2:It[Vn+0]!=0),Vn+=16;Vt>>=2,Fn=Fn>>1|_r<<5}Rt|=qt<<4*hn,Gr|=Vt<<4<<hn,qn|=(240&Fn)<<hn}_t.la=Gr,ir.la=qn,rr.Hc=Rn,rr.Gc=Rt,rr.ia=43690&Rt?0:dn.ia,$n=!(Rn|Rt)}if(0<Oe.L&&(Oe.wa[Oe.Y+Oe.ja]=Oe.gd[St.$b][St.Za],Oe.wa[Oe.Y+Oe.ja].La|=!$n),vn.Ka)return An(Tt,7,"Premature end-of-file encountered.")}if(Ro(Tt),Oe=On,vn=1,St=(Ve=Tt).D,_t=0<Ve.L&&Ve.M>=Ve.zb&&Ve.M<=Ve.Va,Ve.Aa==0)t:{if(St.M=Ve.M,St.uc=_t,Dr(Ve,St),vn=1,St=(qt=Ve.D).Nb,_t=(Rt=tl[Ve.L])*Ve.R,tn=Rt/2*Ve.B,$t=16*St*Ve.R,fr=8*St*Ve.B,$n=Ve.sa,rr=Ve.ta-_t+$t,dn=Ve.qa,It=Ve.ra-tn+fr,Vn=Ve.Ha,ir=Ve.Ia-tn+fr,Fn=(Vt=qt.M)==0,Rn=Vt>=Ve.Va-1,Ve.Aa==2&&Dr(Ve,qt),qt.uc)for(_r=(bn=Ve).D.M,e(bn.D.uc),qt=bn.yb;qt<bn.Hb;++qt){qn=qt,Gr=_r;var ar=(wr=(zn=bn).D).Nb;hn=zn.R;var wr=wr.wa[wr.Y+qn],xr=zn.sa,pr=zn.ta+16*ar*hn+16*qn,Sr=wr.dd,Zt=wr.tc;if(Zt!=0)if(e(3<=Zt),zn.L==1)0<qn&&Pd(xr,pr,hn,Zt+4),wr.La&&Rd(xr,pr,hn,Zt),0<Gr&&Id(xr,pr,hn,Zt+4),wr.La&&Od(xr,pr,hn,Zt);else{var Ar=zn.B,Vr=zn.qa,Na=zn.ra+8*ar*Ar+8*qn,Oi=zn.Ha,zn=zn.Ia+8*ar*Ar+8*qn;ar=wr.ld,0<qn&&(Pn(xr,pr,hn,Zt+4,Sr,ar),Ws(Vr,Na,Oi,zn,Ar,Zt+4,Sr,ar)),wr.La&&(Go(xr,pr,hn,Zt,Sr,ar),Td(Vr,Na,Oi,zn,Ar,Zt,Sr,ar)),0<Gr&&(gn(xr,pr,hn,Zt+4,Sr,ar),Ii(Vr,Na,Oi,zn,Ar,Zt+4,Sr,ar)),wr.La&&(Qa(xr,pr,hn,Zt,Sr,ar),Cd(Vr,Na,Oi,zn,Ar,Zt,Sr,ar))}}if(Ve.ia&&alert("todo:DitherRow"),Oe.put!=null){if(qt=16*Vt,Vt=16*(Vt+1),Fn?(Oe.y=Ve.sa,Oe.O=Ve.ta+$t,Oe.f=Ve.qa,Oe.N=Ve.ra+fr,Oe.ea=Ve.Ha,Oe.W=Ve.Ia+fr):(qt-=Rt,Oe.y=$n,Oe.O=rr,Oe.f=dn,Oe.N=It,Oe.ea=Vn,Oe.W=ir),Rn||(Vt-=Rt),Vt>Oe.o&&(Vt=Oe.o),Oe.F=null,Oe.J=null,Ve.Fa!=null&&0<Ve.Fa.length&&qt<Vt&&(Oe.J=Xt(Ve,Oe,qt,Vt-qt),Oe.F=Ve.mb,Oe.F==null&&Oe.F.length==0)){vn=An(Ve,3,"Could not decode alpha data.");break t}qt<Oe.j&&(Rt=Oe.j-qt,qt=Oe.j,e(!(1&Rt)),Oe.O+=Ve.R*Rt,Oe.N+=Ve.B*(Rt>>1),Oe.W+=Ve.B*(Rt>>1),Oe.F!=null&&(Oe.J+=Oe.width*Rt)),qt<Vt&&(Oe.O+=Oe.v,Oe.N+=Oe.v>>1,Oe.W+=Oe.v>>1,Oe.F!=null&&(Oe.J+=Oe.v),Oe.ka=qt-Oe.j,Oe.U=Oe.va-Oe.v,Oe.T=Vt-qt,vn=Oe.put(Oe))}St+1!=Ve.Ic||Rn||(r(Ve.sa,Ve.ta-_t,$n,rr+16*Ve.R,_t),r(Ve.qa,Ve.ra-tn,dn,It+8*Ve.B,tn),r(Ve.Ha,Ve.Ia-tn,Vn,ir+8*Ve.B,tn))}if(!vn)return An(Tt,6,"Output aborted.")}return 1})(W,ie)),ie.bc!=null&&ie.bc(ie),le&=1}return le?(W.cb=0,le):0})(u,_)||(f=u.a)}}else f=u.a}f==0&&R.Oa!=null&&R.Oa.fd&&(f=Ms(R.ba))}R=f}T=R!=0?null:11>T?F.f.RGBA.eb:F.f.kb.y}else T=null;return T};var eh=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function d(D,I){for(var k="",A=0;A<4;A++)k+=String.fromCharCode(D[I++]);return k}function h(D,I){return D[I+0]|D[I+1]<<8}function g(D,I){return(D[I+0]|D[I+1]<<8|D[I+2]<<16)>>>0}function b(D,I){return(D[I+0]|D[I+1]<<8|D[I+2]<<16|D[I+3]<<24)>>>0}new c;var p=[0],y=[0],w=[],S=new c,x=t,C=(function(D,I){var k={},A=0,M=!1,B=0,J=0;if(k.frames=[],!(function(O,q){for(var K=0;K<4;K++)if(O[q+K]!="RIFF".charCodeAt(K))return!0;return!1})(D,I)){for(b(D,I+=4),I+=8;I<D.length;){var oe=d(D,I),ue=b(D,I+=4);I+=4;var ae=ue+(1&ue);switch(oe){case"VP8 ":case"VP8L":k.frames[A]===void 0&&(k.frames[A]={}),(pe=k.frames[A]).src_off=M?J:I-8,pe.src_size=B+ue+8,A++,M&&(M=!1,B=0,J=0);break;case"VP8X":(pe=k.header={}).feature_flags=D[I];var fe=I+4;pe.canvas_width=1+g(D,fe),fe+=3,pe.canvas_height=1+g(D,fe),fe+=3;break;case"ALPH":M=!0,B=ae+8,J=I-8;break;case"ANIM":(pe=k.header).bgcolor=b(D,I),fe=I+4,pe.loop_count=h(D,fe),fe+=2;break;case"ANMF":var ke,pe;(pe=k.frames[A]={}).offset_x=2*g(D,I),I+=3,pe.offset_y=2*g(D,I),I+=3,pe.width=1+g(D,I),I+=3,pe.height=1+g(D,I),I+=3,pe.duration=g(D,I),I+=3,ke=D[I++],pe.dispose=1&ke,pe.blend=ke>>1&1}oe!="ANMF"&&(I+=ae)}return k}})(x,0);C.response=x,C.rgbaoutput=!0,C.dataurl=!1;var P=C.header?C.header:null,L=C.frames?C.frames:null;if(P){P.loop_counter=P.loop_count,p=[P.canvas_height],y=[P.canvas_width];for(var U=0;U<L.length&&L[U].blend!=0;U++);}var ee=L[0],V=S.WebPDecodeRGBA(x,ee.src_off,ee.src_size,y,p);ee.rgba=V,ee.imgwidth=y[0],ee.imgheight=p[0];for(var X=0;X<y[0]*p[0]*4;X++)w[X]=V[X];return this.width=y,this.height=p,this.data=w,this}/** ====================================================================
 * @license
 * jsPDF XMP metadata plugin
 * Copyright (c) 2016 Jussi Utunen, u-jussi@suomi24.fi
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */function My(){var t,e=this.internal.__metadata__.metadata,n=unescape(encodeURIComponent(e));t=this.internal.__metadata__.rawXml?n:'<x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceUri+'"><jspdf:metadata>'+n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")+"</jspdf:metadata></rdf:Description></rdf:RDF></x:xmpmeta>",this.internal.__metadata__.metadataObjectNumber=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+t.length+" >>"),this.internal.write("stream"),this.internal.write(t),this.internal.write("endstream"),this.internal.write("endobj")}function Uy(){this.internal.__metadata__.metadataObjectNumber&&this.internal.write("/Metadata "+this.internal.__metadata__.metadataObjectNumber+" 0 R")}(function(t){var e,n,r,i,a,o,l,c,d,h=function(O){return O=O||{},this.isStrokeTransparent=O.isStrokeTransparent||!1,this.strokeOpacity=O.strokeOpacity||1,this.strokeStyle=O.strokeStyle||"#000000",this.fillStyle=O.fillStyle||"#000000",this.isFillTransparent=O.isFillTransparent||!1,this.fillOpacity=O.fillOpacity||1,this.font=O.font||"10px sans-serif",this.textBaseline=O.textBaseline||"alphabetic",this.textAlign=O.textAlign||"left",this.lineWidth=O.lineWidth||1,this.lineJoin=O.lineJoin||"miter",this.lineCap=O.lineCap||"butt",this.path=O.path||[],this.transform=O.transform!==void 0?O.transform.clone():new c,this.globalCompositeOperation=O.globalCompositeOperation||"normal",this.globalAlpha=O.globalAlpha||1,this.clip_path=O.clip_path||[],this.currentPoint=O.currentPoint||new o,this.miterLimit=O.miterLimit||10,this.lastPoint=O.lastPoint||new o,this.lineDashOffset=O.lineDashOffset||0,this.lineDash=O.lineDash||[],this.margin=O.margin||[0,0,0,0],this.prevPageLastElemOffset=O.prevPageLastElemOffset||0,this.ignoreClearRect=typeof O.ignoreClearRect!="boolean"||O.ignoreClearRect,this};t.events.push(["initialized",function(){this.context2d=new g(this),e=this.internal.f2,n=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,a=this.internal.getVerticalCoordinate,o=this.internal.Point,l=this.internal.Rectangle,c=this.internal.Matrix,d=new h}]);var g=function(O){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var q=O;Object.defineProperty(this,"pdf",{get:function(){return q}});var K=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return K},set:function($){K=!!$}});var Y=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Y},set:function($){Y=!!$}});var Q=0;Object.defineProperty(this,"posX",{get:function(){return Q},set:function($){isNaN($)||(Q=$)}});var z=0;Object.defineProperty(this,"posY",{get:function(){return z},set:function($){isNaN($)||(z=$)}}),Object.defineProperty(this,"margin",{get:function(){return d.margin},set:function($){var Ce;typeof $=="number"?Ce=[$,$,$,$]:((Ce=new Array(4))[0]=$[0],Ce[1]=$.length>=2?$[1]:Ce[0],Ce[2]=$.length>=3?$[2]:Ce[0],Ce[3]=$.length>=4?$[3]:Ce[1]),d.margin=Ce}});var re=!1;Object.defineProperty(this,"autoPaging",{get:function(){return re},set:function($){re=$}});var ce=0;Object.defineProperty(this,"lastBreak",{get:function(){return ce},set:function($){ce=$}});var ge=[];Object.defineProperty(this,"pageBreaks",{get:function(){return ge},set:function($){ge=$}}),Object.defineProperty(this,"ctx",{get:function(){return d},set:function($){$ instanceof h&&(d=$)}}),Object.defineProperty(this,"path",{get:function(){return d.path},set:function($){d.path=$}});var Ae=[];Object.defineProperty(this,"ctxStack",{get:function(){return Ae},set:function($){Ae=$}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function($){var Ce;Ce=b($),this.ctx.fillStyle=Ce.style,this.ctx.isFillTransparent=Ce.a===0,this.ctx.fillOpacity=Ce.a,this.pdf.setFillColor(Ce.r,Ce.g,Ce.b,{a:Ce.a}),this.pdf.setTextColor(Ce.r,Ce.g,Ce.b,{a:Ce.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function($){var Ce=b($);this.ctx.strokeStyle=Ce.style,this.ctx.isStrokeTransparent=Ce.a===0,this.ctx.strokeOpacity=Ce.a,Ce.a===0?this.pdf.setDrawColor(255,255,255):(Ce.a,this.pdf.setDrawColor(Ce.r,Ce.g,Ce.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function($){["butt","round","square"].indexOf($)!==-1&&(this.ctx.lineCap=$,this.pdf.setLineCap($))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function($){isNaN($)||(this.ctx.lineWidth=$,this.pdf.setLineWidth($))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function($){["bevel","round","miter"].indexOf($)!==-1&&(this.ctx.lineJoin=$,this.pdf.setLineJoin($))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function($){isNaN($)||(this.ctx.miterLimit=$,this.pdf.setMiterLimit($))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function($){this.ctx.textBaseline=$}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function($){["right","end","center","left","start"].indexOf($)!==-1&&(this.ctx.textAlign=$)}});var Pe=null,Te=null,Me=null;Object.defineProperty(this,"fontFaces",{get:function(){return Me},set:function($){Pe=null,Te=null,Me=$}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function($){var Ce;if(this.ctx.font=$,(Ce=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec($))!==null){var ht=Ce[1];Ce[2];var He=Ce[3],we=Ce[4];Ce[5];var Ke=Ce[6],Re=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(we)[2];we=Math.floor(Re==="px"?parseFloat(we)*this.pdf.internal.scaleFactor:Re==="em"?parseFloat(we)*this.pdf.getFontSize():parseFloat(we)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(we);var Qe=(function(We){var rn,Et,bt=[],ct=We.trim();if(ct==="")return Su;if(ct in dp)return[dp[ct]];for(;ct!=="";){switch(Et=null,rn=(ct=fp(ct)).charAt(0)){case'"':case"'":Et=Oy(ct.substring(1),rn);break;default:Et=Ry(ct)}if(Et===null||(bt.push(Et[0]),(ct=fp(Et[1]))!==""&&ct.charAt(0)!==","))return Su;ct=ct.replace(/^,/,"")}return bt})(Ke);if(this.fontFaces){var Ie=(function(We,rn){var Et=We.getFontList(),bt=JSON.stringify(Et);if(Pe===null||Te!==bt){var ct=(function(Dt){var et=[];return Object.keys(Dt).forEach(function(jt){Dt[jt].forEach(function(st){var dt=null;switch(st){case"bold":dt={family:jt,weight:"bold"};break;case"italic":dt={family:jt,style:"italic"};break;case"bolditalic":dt={family:jt,weight:"bold",style:"italic"};break;case"":case"normal":dt={family:jt}}dt!==null&&(dt.ref={name:jt,style:st},et.push(dt))})}),et})(Et);Pe=(function(Dt){for(var et={},jt=0;jt<Dt.length;++jt){var st=xu(Dt[jt]),dt=st.family,Ut=st.stretch,kt=st.style,tt=st.weight;et[dt]=et[dt]||{},et[dt][Ut]=et[dt][Ut]||{},et[dt][Ut][kt]=et[dt][Ut][kt]||{},et[dt][Ut][kt][tt]=st}return et})(ct.concat(rn)),Te=bt}return Pe})(this.pdf,this.fontFaces),it=Qe.map(function(We){return{family:We,stretch:"normal",weight:He,style:ht}}),nt=(function(We,rn,Et){for(var bt=(Et=Et||{}).defaultFontFamily||"times",ct=Object.assign({},Py,Et.genericFontFamilies||{}),Dt=null,et=null,jt=0;jt<rn.length;++jt)if(ct[(Dt=xu(rn[jt])).family]&&(Dt.family=ct[Dt.family]),We.hasOwnProperty(Dt.family)){et=We[Dt.family];break}if(!(et=et||We[bt]))throw new Error("Could not find a font-family for the rule '"+hp(Dt)+"' and default family '"+bt+"'.");if(et=(function(st,dt){if(dt[st])return dt[st];var Ut=od[st],kt=Ut<=od.normal?-1:1,tt=up(dt,lg,Ut,kt);if(!tt)throw new Error("Could not find a matching font-stretch value for "+st);return tt})(Dt.stretch,et),et=(function(st,dt){if(dt[st])return dt[st];for(var Ut=og[st],kt=0;kt<Ut.length;++kt)if(dt[Ut[kt]])return dt[Ut[kt]];throw new Error("Could not find a matching font-style for "+st)})(Dt.style,et),!(et=(function(st,dt){if(dt[st])return dt[st];if(st===400&&dt[500])return dt[500];if(st===500&&dt[400])return dt[400];var Ut=Iy[st],kt=up(dt,cg,Ut,st<400?-1:1);if(!kt)throw new Error("Could not find a matching font-weight for value "+st);return kt})(Dt.weight,et)))throw new Error("Failed to resolve a font for the rule '"+hp(Dt)+"'.");return et})(Ie,it);this.pdf.setFont(nt.ref.name,nt.ref.style)}else{var at="";(He==="bold"||parseInt(He,10)>=700||ht==="bold")&&(at="bold"),ht==="italic"&&(at+="italic"),at.length===0&&(at="normal");for(var ut="",pt={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},qe=0;qe<Qe.length;qe++){if(this.pdf.internal.getFont(Qe[qe],at,{noFallback:!0,disableWarning:!0})!==void 0){ut=Qe[qe];break}if(at==="bolditalic"&&this.pdf.internal.getFont(Qe[qe],"bold",{noFallback:!0,disableWarning:!0})!==void 0)ut=Qe[qe],at="bold";else if(this.pdf.internal.getFont(Qe[qe],"normal",{noFallback:!0,disableWarning:!0})!==void 0){ut=Qe[qe],at="normal";break}}if(ut===""){for(var gt=0;gt<Qe.length;gt++)if(pt[Qe[gt]]){ut=pt[Qe[gt]];break}}ut=ut===""?"Times":ut,this.pdf.setFont(ut,at)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function($){this.ctx.globalCompositeOperation=$}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function($){this.ctx.globalAlpha=$}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function($){this.ctx.lineDashOffset=$,pe.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function($){this.ctx.lineDash=$,pe.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function($){this.ctx.ignoreClearRect=!!$}})};g.prototype.setLineDash=function(O){this.lineDash=O},g.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},g.prototype.fill=function(){L.call(this,"fill",!1)},g.prototype.stroke=function(){L.call(this,"stroke",!1)},g.prototype.beginPath=function(){this.path=[{type:"begin"}]},g.prototype.moveTo=function(O,q){if(isNaN(O)||isNaN(q))throw Kt.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var K=this.ctx.transform.applyToPoint(new o(O,q));this.path.push({type:"mt",x:K.x,y:K.y}),this.ctx.lastPoint=new o(O,q)},g.prototype.closePath=function(){var O=new o(0,0),q=0;for(q=this.path.length-1;q!==-1;q--)if(this.path[q].type==="begin"&&Ht(this.path[q+1])==="object"&&typeof this.path[q+1].x=="number"){O=new o(this.path[q+1].x,this.path[q+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new o(O.x,O.y)},g.prototype.lineTo=function(O,q){if(isNaN(O)||isNaN(q))throw Kt.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var K=this.ctx.transform.applyToPoint(new o(O,q));this.path.push({type:"lt",x:K.x,y:K.y}),this.ctx.lastPoint=new o(K.x,K.y)},g.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),L.call(this,null,!0)},g.prototype.quadraticCurveTo=function(O,q,K,Y){if(isNaN(K)||isNaN(Y)||isNaN(O)||isNaN(q))throw Kt.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var Q=this.ctx.transform.applyToPoint(new o(K,Y)),z=this.ctx.transform.applyToPoint(new o(O,q));this.path.push({type:"qct",x1:z.x,y1:z.y,x:Q.x,y:Q.y}),this.ctx.lastPoint=new o(Q.x,Q.y)},g.prototype.bezierCurveTo=function(O,q,K,Y,Q,z){if(isNaN(Q)||isNaN(z)||isNaN(O)||isNaN(q)||isNaN(K)||isNaN(Y))throw Kt.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var re=this.ctx.transform.applyToPoint(new o(Q,z)),ce=this.ctx.transform.applyToPoint(new o(O,q)),ge=this.ctx.transform.applyToPoint(new o(K,Y));this.path.push({type:"bct",x1:ce.x,y1:ce.y,x2:ge.x,y2:ge.y,x:re.x,y:re.y}),this.ctx.lastPoint=new o(re.x,re.y)},g.prototype.arc=function(O,q,K,Y,Q,z){if(isNaN(O)||isNaN(q)||isNaN(K)||isNaN(Y)||isNaN(Q))throw Kt.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(z=!!z,!this.ctx.transform.isIdentity){var re=this.ctx.transform.applyToPoint(new o(O,q));O=re.x,q=re.y;var ce=this.ctx.transform.applyToPoint(new o(0,K)),ge=this.ctx.transform.applyToPoint(new o(0,0));K=Math.sqrt(Math.pow(ce.x-ge.x,2)+Math.pow(ce.y-ge.y,2))}Math.abs(Q-Y)>=2*Math.PI&&(Y=0,Q=2*Math.PI),this.path.push({type:"arc",x:O,y:q,radius:K,startAngle:Y,endAngle:Q,counterclockwise:z})},g.prototype.arcTo=function(O,q,K,Y,Q){throw new Error("arcTo not implemented.")},g.prototype.rect=function(O,q,K,Y){if(isNaN(O)||isNaN(q)||isNaN(K)||isNaN(Y))throw Kt.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(O,q),this.lineTo(O+K,q),this.lineTo(O+K,q+Y),this.lineTo(O,q+Y),this.lineTo(O,q),this.lineTo(O+K,q),this.lineTo(O,q)},g.prototype.fillRect=function(O,q,K,Y){if(isNaN(O)||isNaN(q)||isNaN(K)||isNaN(Y))throw Kt.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!p.call(this)){var Q={};this.lineCap!=="butt"&&(Q.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(Q.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(O,q,K,Y),this.fill(),Q.hasOwnProperty("lineCap")&&(this.lineCap=Q.lineCap),Q.hasOwnProperty("lineJoin")&&(this.lineJoin=Q.lineJoin)}},g.prototype.strokeRect=function(O,q,K,Y){if(isNaN(O)||isNaN(q)||isNaN(K)||isNaN(Y))throw Kt.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");y.call(this)||(this.beginPath(),this.rect(O,q,K,Y),this.stroke())},g.prototype.clearRect=function(O,q,K,Y){if(isNaN(O)||isNaN(q)||isNaN(K)||isNaN(Y))throw Kt.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(O,q,K,Y))},g.prototype.save=function(O){O=typeof O!="boolean"||O;for(var q=this.pdf.internal.getCurrentPageInfo().pageNumber,K=0;K<this.pdf.internal.getNumberOfPages();K++)this.pdf.setPage(K+1),this.pdf.internal.out("q");if(this.pdf.setPage(q),O){this.ctx.fontSize=this.pdf.internal.getFontSize();var Y=new h(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Y}},g.prototype.restore=function(O){O=typeof O!="boolean"||O;for(var q=this.pdf.internal.getCurrentPageInfo().pageNumber,K=0;K<this.pdf.internal.getNumberOfPages();K++)this.pdf.setPage(K+1),this.pdf.internal.out("Q");this.pdf.setPage(q),O&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},g.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var b=function(O){var q,K,Y,Q;if(O.isCanvasGradient===!0&&(O=O.getColor()),!O)return{r:0,g:0,b:0,a:0,style:O};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(O))q=0,K=0,Y=0,Q=0;else{var z=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(O);if(z!==null)q=parseInt(z[1]),K=parseInt(z[2]),Y=parseInt(z[3]),Q=1;else if((z=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(O))!==null)q=parseInt(z[1]),K=parseInt(z[2]),Y=parseInt(z[3]),Q=parseFloat(z[4]);else{if(Q=1,typeof O=="string"&&O.charAt(0)!=="#"){var re=new eg(O);O=re.ok?re.toHex():"#000000"}O.length===4?(q=O.substring(1,2),q+=q,K=O.substring(2,3),K+=K,Y=O.substring(3,4),Y+=Y):(q=O.substring(1,3),K=O.substring(3,5),Y=O.substring(5,7)),q=parseInt(q,16),K=parseInt(K,16),Y=parseInt(Y,16)}}return{r:q,g:K,b:Y,a:Q,style:O}},p=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},y=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};g.prototype.fillText=function(O,q,K,Y){if(isNaN(q)||isNaN(K)||typeof O!="string")throw Kt.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Y=isNaN(Y)?void 0:Y,!p.call(this)){var Q=ae(this.ctx.transform.rotation),z=this.ctx.transform.scaleX;A.call(this,{text:O,x:q,y:K,scale:z,angle:Q,align:this.textAlign,maxWidth:Y})}},g.prototype.strokeText=function(O,q,K,Y){if(isNaN(q)||isNaN(K)||typeof O!="string")throw Kt.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!y.call(this)){Y=isNaN(Y)?void 0:Y;var Q=ae(this.ctx.transform.rotation),z=this.ctx.transform.scaleX;A.call(this,{text:O,x:q,y:K,scale:z,renderingMode:"stroke",angle:Q,align:this.textAlign,maxWidth:Y})}},g.prototype.measureText=function(O){if(typeof O!="string")throw Kt.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var q=this.pdf,K=this.pdf.internal.scaleFactor,Y=q.internal.getFontSize(),Q=q.getStringUnitWidth(O)*Y/q.internal.scaleFactor;return new function(z){var re=(z=z||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return re}}),this}({width:Q*=Math.round(96*K/72*1e4)/1e4})},g.prototype.scale=function(O,q){if(isNaN(O)||isNaN(q))throw Kt.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var K=new c(O,0,0,q,0,0);this.ctx.transform=this.ctx.transform.multiply(K)},g.prototype.rotate=function(O){if(isNaN(O))throw Kt.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var q=new c(Math.cos(O),Math.sin(O),-Math.sin(O),Math.cos(O),0,0);this.ctx.transform=this.ctx.transform.multiply(q)},g.prototype.translate=function(O,q){if(isNaN(O)||isNaN(q))throw Kt.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var K=new c(1,0,0,1,O,q);this.ctx.transform=this.ctx.transform.multiply(K)},g.prototype.transform=function(O,q,K,Y,Q,z){if(isNaN(O)||isNaN(q)||isNaN(K)||isNaN(Y)||isNaN(Q)||isNaN(z))throw Kt.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var re=new c(O,q,K,Y,Q,z);this.ctx.transform=this.ctx.transform.multiply(re)},g.prototype.setTransform=function(O,q,K,Y,Q,z){O=isNaN(O)?1:O,q=isNaN(q)?0:q,K=isNaN(K)?0:K,Y=isNaN(Y)?1:Y,Q=isNaN(Q)?0:Q,z=isNaN(z)?0:z,this.ctx.transform=new c(O,q,K,Y,Q,z)};var w=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};g.prototype.drawImage=function(O,q,K,Y,Q,z,re,ce,ge){var Ae=this.pdf.getImageProperties(O),Pe=1,Te=1,Me=1,$=1;Y!==void 0&&ce!==void 0&&(Me=ce/Y,$=ge/Q,Pe=Ae.width/Y*ce/Y,Te=Ae.height/Q*ge/Q),z===void 0&&(z=q,re=K,q=0,K=0),Y!==void 0&&ce===void 0&&(ce=Y,ge=Q),Y===void 0&&ce===void 0&&(ce=Ae.width,ge=Ae.height);var Ce=this.ctx.transform.decompose(),ht=ae(Ce.rotate.shx),He=new c,we=(He=(He=(He=He.multiply(Ce.translate)).multiply(Ce.skew)).multiply(Ce.scale)).applyToRectangle(new l(z-q*Me,re-K*$,Y*Pe,Q*Te));if(this.autoPaging){for(var Ke,Re=S.call(this,we),Qe=[],Ie=0;Ie<Re.length;Ie+=1)Qe.indexOf(Re[Ie])===-1&&Qe.push(Re[Ie]);P(Qe);for(var it=Qe[0],nt=Qe[Qe.length-1],at=it;at<nt+1;at++){this.pdf.setPage(at);var ut=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],pt=at===1?this.posY+this.margin[0]:this.margin[0],qe=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],gt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],We=at===1?0:qe+(at-2)*gt;if(this.ctx.clip_path.length!==0){var rn=this.path;Ke=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=C(Ke,this.posX+this.margin[3],-We+pt+this.ctx.prevPageLastElemOffset),U.call(this,"fill",!0),this.path=rn}var Et=JSON.parse(JSON.stringify(we));Et=C([Et],this.posX+this.margin[3],-We+pt+this.ctx.prevPageLastElemOffset)[0];var bt=(at>it||at<nt)&&w.call(this);bt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ut,gt,null).clip().discardPath()),this.pdf.addImage(O,"JPEG",Et.x,Et.y,Et.w,Et.h,null,null,ht),bt&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(O,"JPEG",we.x,we.y,we.w,we.h,null,null,ht)};var S=function(O,q,K){var Y=[];q=q||this.pdf.internal.pageSize.width,K=K||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var Q=this.posY+this.ctx.prevPageLastElemOffset;switch(O.type){default:case"mt":case"lt":Y.push(Math.floor((O.y+Q)/K)+1);break;case"arc":Y.push(Math.floor((O.y+Q-O.radius)/K)+1),Y.push(Math.floor((O.y+Q+O.radius)/K)+1);break;case"qct":var z=fe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,O.x1,O.y1,O.x,O.y);Y.push(Math.floor((z.y+Q)/K)+1),Y.push(Math.floor((z.y+z.h+Q)/K)+1);break;case"bct":var re=ke(this.ctx.lastPoint.x,this.ctx.lastPoint.y,O.x1,O.y1,O.x2,O.y2,O.x,O.y);Y.push(Math.floor((re.y+Q)/K)+1),Y.push(Math.floor((re.y+re.h+Q)/K)+1);break;case"rect":Y.push(Math.floor((O.y+Q)/K)+1),Y.push(Math.floor((O.y+O.h+Q)/K)+1)}for(var ce=0;ce<Y.length;ce+=1)for(;this.pdf.internal.getNumberOfPages()<Y[ce];)x.call(this);return Y},x=function(){var O=this.fillStyle,q=this.strokeStyle,K=this.font,Y=this.lineCap,Q=this.lineWidth,z=this.lineJoin;this.pdf.addPage(),this.fillStyle=O,this.strokeStyle=q,this.font=K,this.lineCap=Y,this.lineWidth=Q,this.lineJoin=z},C=function(O,q,K){for(var Y=0;Y<O.length;Y++)switch(O[Y].type){case"bct":O[Y].x2+=q,O[Y].y2+=K;case"qct":O[Y].x1+=q,O[Y].y1+=K;default:O[Y].x+=q,O[Y].y+=K}return O},P=function(O){return O.sort(function(q,K){return q-K})},L=function(O,q){var K=this.fillStyle,Y=this.strokeStyle,Q=this.lineCap,z=this.lineWidth,re=Math.abs(z*this.ctx.transform.scaleX),ce=this.lineJoin;if(this.autoPaging){for(var ge,Ae,Pe=JSON.parse(JSON.stringify(this.path)),Te=JSON.parse(JSON.stringify(this.path)),Me=[],$=0;$<Te.length;$++)if(Te[$].x!==void 0)for(var Ce=S.call(this,Te[$]),ht=0;ht<Ce.length;ht+=1)Me.indexOf(Ce[ht])===-1&&Me.push(Ce[ht]);for(var He=0;He<Me.length;He++)for(;this.pdf.internal.getNumberOfPages()<Me[He];)x.call(this);P(Me);for(var we=Me[0],Ke=Me[Me.length-1],Re=we;Re<Ke+1;Re++){this.pdf.setPage(Re),this.fillStyle=K,this.strokeStyle=Y,this.lineCap=Q,this.lineWidth=re,this.lineJoin=ce;var Qe=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Ie=Re===1?this.posY+this.margin[0]:this.margin[0],it=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],nt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],at=Re===1?0:it+(Re-2)*nt;if(this.ctx.clip_path.length!==0){var ut=this.path;ge=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=C(ge,this.posX+this.margin[3],-at+Ie+this.ctx.prevPageLastElemOffset),U.call(this,O,!0),this.path=ut}if(Ae=JSON.parse(JSON.stringify(Pe)),this.path=C(Ae,this.posX+this.margin[3],-at+Ie+this.ctx.prevPageLastElemOffset),q===!1||Re===0){var pt=(Re>we||Re<Ke)&&w.call(this);pt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Qe,nt,null).clip().discardPath()),U.call(this,O,q),pt&&this.pdf.restoreGraphicsState()}this.lineWidth=z}this.path=Pe}else this.lineWidth=re,U.call(this,O,q),this.lineWidth=z},U=function(O,q){if((O!=="stroke"||q||!y.call(this))&&(O==="stroke"||q||!p.call(this))){for(var K,Y,Q=[],z=this.path,re=0;re<z.length;re++){var ce=z[re];switch(ce.type){case"begin":Q.push({begin:!0});break;case"close":Q.push({close:!0});break;case"mt":Q.push({start:ce,deltas:[],abs:[]});break;case"lt":var ge=Q.length;if(z[re-1]&&!isNaN(z[re-1].x)&&(K=[ce.x-z[re-1].x,ce.y-z[re-1].y],ge>0)){for(;ge>=0;ge--)if(Q[ge-1].close!==!0&&Q[ge-1].begin!==!0){Q[ge-1].deltas.push(K),Q[ge-1].abs.push(ce);break}}break;case"bct":K=[ce.x1-z[re-1].x,ce.y1-z[re-1].y,ce.x2-z[re-1].x,ce.y2-z[re-1].y,ce.x-z[re-1].x,ce.y-z[re-1].y],Q[Q.length-1].deltas.push(K);break;case"qct":var Ae=z[re-1].x+2/3*(ce.x1-z[re-1].x),Pe=z[re-1].y+2/3*(ce.y1-z[re-1].y),Te=ce.x+2/3*(ce.x1-ce.x),Me=ce.y+2/3*(ce.y1-ce.y),$=ce.x,Ce=ce.y;K=[Ae-z[re-1].x,Pe-z[re-1].y,Te-z[re-1].x,Me-z[re-1].y,$-z[re-1].x,Ce-z[re-1].y],Q[Q.length-1].deltas.push(K);break;case"arc":Q.push({deltas:[],abs:[],arc:!0}),Array.isArray(Q[Q.length-1].abs)&&Q[Q.length-1].abs.push(ce)}}Y=q?null:O==="stroke"?"stroke":"fill";for(var ht=!1,He=0;He<Q.length;He++)if(Q[He].arc)for(var we=Q[He].abs,Ke=0;Ke<we.length;Ke++){var Re=we[Ke];Re.type==="arc"?X.call(this,Re.x,Re.y,Re.radius,Re.startAngle,Re.endAngle,Re.counterclockwise,void 0,q,!ht):M.call(this,Re.x,Re.y),ht=!0}else if(Q[He].close===!0)this.pdf.internal.out("h"),ht=!1;else if(Q[He].begin!==!0){var Qe=Q[He].start.x,Ie=Q[He].start.y;B.call(this,Q[He].deltas,Qe,Ie),ht=!0}Y&&D.call(this,Y),q&&I.call(this)}},ee=function(O){var q=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,K=q*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return O-K;case"top":return O+q-K;case"hanging":return O+q-2*K;case"middle":return O+q/2-K;default:return O}},V=function(O){return O+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};g.prototype.createLinearGradient=function(){var O=function(){};return O.colorStops=[],O.addColorStop=function(q,K){this.colorStops.push([q,K])},O.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},O.isCanvasGradient=!0,O},g.prototype.createPattern=function(){return this.createLinearGradient()},g.prototype.createRadialGradient=function(){return this.createLinearGradient()};var X=function(O,q,K,Y,Q,z,re,ce,ge){for(var Ae=oe.call(this,K,Y,Q,z),Pe=0;Pe<Ae.length;Pe++){var Te=Ae[Pe];Pe===0&&(ge?k.call(this,Te.x1+O,Te.y1+q):M.call(this,Te.x1+O,Te.y1+q)),J.call(this,O,q,Te.x2,Te.y2,Te.x3,Te.y3,Te.x4,Te.y4)}ce?I.call(this):D.call(this,re)},D=function(O){switch(O){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},I=function(){this.pdf.clip(),this.pdf.discardPath()},k=function(O,q){this.pdf.internal.out(n(O)+" "+r(q)+" m")},A=function(O){var q;switch(O.align){case"right":case"end":q="right";break;case"center":q="center";break;default:q="left"}var K,Y,Q,z=this.pdf.getTextDimensions(O.text),re=ee.call(this,O.y),ce=V.call(this,re)-z.h,ge=this.ctx.transform.applyToPoint(new o(O.x,re));if(this.autoPaging){var Ae=this.ctx.transform.decompose(),Pe=new c;Pe=(Pe=(Pe=Pe.multiply(Ae.translate)).multiply(Ae.skew)).multiply(Ae.scale);for(var Te=this.ctx.transform.applyToRectangle(new l(O.x,re,z.w,z.h)),Me=Pe.applyToRectangle(new l(O.x,ce,z.w,z.h)),$=S.call(this,Me),Ce=[],ht=0;ht<$.length;ht+=1)Ce.indexOf($[ht])===-1&&Ce.push($[ht]);P(Ce);for(var He=Ce[0],we=Ce[Ce.length-1],Ke=He;Ke<we+1;Ke++){this.pdf.setPage(Ke);var Re=Ke===1?this.posY+this.margin[0]:this.margin[0],Qe=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ie=this.pdf.internal.pageSize.height-this.margin[2],it=Ie-this.margin[0],nt=this.pdf.internal.pageSize.width-this.margin[1],at=nt-this.margin[3],ut=Ke===1?0:Qe+(Ke-2)*it;if(this.ctx.clip_path.length!==0){var pt=this.path;K=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=C(K,this.posX+this.margin[3],-1*ut+Re),U.call(this,"fill",!0),this.path=pt}var qe=C([JSON.parse(JSON.stringify(Me))],this.posX+this.margin[3],-ut+Re+this.ctx.prevPageLastElemOffset)[0];O.scale>=.01&&(Y=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Y*O.scale),Q=this.lineWidth,this.lineWidth=Q*O.scale);var gt=this.autoPaging!=="text";if(gt||qe.y+qe.h<=Ie){if(gt||qe.y>=Re&&qe.x<=nt){var We=gt?O.text:this.pdf.splitTextToSize(O.text,O.maxWidth||nt-qe.x)[0],rn=C([JSON.parse(JSON.stringify(Te))],this.posX+this.margin[3],-ut+Re+this.ctx.prevPageLastElemOffset)[0],Et=gt&&(Ke>He||Ke<we)&&w.call(this);Et&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],at,it,null).clip().discardPath()),this.pdf.text(We,rn.x,rn.y,{angle:O.angle,align:q,renderingMode:O.renderingMode}),Et&&this.pdf.restoreGraphicsState()}}else qe.y<Ie&&(this.ctx.prevPageLastElemOffset+=Ie-qe.y);O.scale>=.01&&(this.pdf.setFontSize(Y),this.lineWidth=Q)}}else O.scale>=.01&&(Y=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Y*O.scale),Q=this.lineWidth,this.lineWidth=Q*O.scale),this.pdf.text(O.text,ge.x+this.posX,ge.y+this.posY,{angle:O.angle,align:q,renderingMode:O.renderingMode,maxWidth:O.maxWidth}),O.scale>=.01&&(this.pdf.setFontSize(Y),this.lineWidth=Q)},M=function(O,q,K,Y){K=K||0,Y=Y||0,this.pdf.internal.out(n(O+K)+" "+r(q+Y)+" l")},B=function(O,q,K){return this.pdf.lines(O,q,K,null,null)},J=function(O,q,K,Y,Q,z,re,ce){this.pdf.internal.out([e(i(K+O)),e(a(Y+q)),e(i(Q+O)),e(a(z+q)),e(i(re+O)),e(a(ce+q)),"c"].join(" "))},oe=function(O,q,K,Y){for(var Q=2*Math.PI,z=Math.PI/2;q>K;)q-=Q;var re=Math.abs(K-q);re<Q&&Y&&(re=Q-re);for(var ce=[],ge=Y?-1:1,Ae=q;re>1e-5;){var Pe=Ae+ge*Math.min(re,z);ce.push(ue.call(this,O,Ae,Pe)),re-=Math.abs(Pe-Ae),Ae=Pe}return ce},ue=function(O,q,K){var Y=(K-q)/2,Q=O*Math.cos(Y),z=O*Math.sin(Y),re=Q,ce=-z,ge=re*re+ce*ce,Ae=ge+re*Q+ce*z,Pe=4/3*(Math.sqrt(2*ge*Ae)-Ae)/(re*z-ce*Q),Te=re-Pe*ce,Me=ce+Pe*re,$=Te,Ce=-Me,ht=Y+q,He=Math.cos(ht),we=Math.sin(ht);return{x1:O*Math.cos(q),y1:O*Math.sin(q),x2:Te*He-Me*we,y2:Te*we+Me*He,x3:$*He-Ce*we,y3:$*we+Ce*He,x4:O*Math.cos(K),y4:O*Math.sin(K)}},ae=function(O){return 180*O/Math.PI},fe=function(O,q,K,Y,Q,z){var re=O+.5*(K-O),ce=q+.5*(Y-q),ge=Q+.5*(K-Q),Ae=z+.5*(Y-z),Pe=Math.min(O,Q,re,ge),Te=Math.max(O,Q,re,ge),Me=Math.min(q,z,ce,Ae),$=Math.max(q,z,ce,Ae);return new l(Pe,Me,Te-Pe,$-Me)},ke=function(O,q,K,Y,Q,z,re,ce){var ge,Ae,Pe,Te,Me,$,Ce,ht,He,we,Ke,Re,Qe,Ie,it=K-O,nt=Y-q,at=Q-K,ut=z-Y,pt=re-Q,qe=ce-z;for(Ae=0;Ae<41;Ae++)He=(Ce=(Pe=O+(ge=Ae/40)*it)+ge*((Me=K+ge*at)-Pe))+ge*(Me+ge*(Q+ge*pt-Me)-Ce),we=(ht=(Te=q+ge*nt)+ge*(($=Y+ge*ut)-Te))+ge*($+ge*(z+ge*qe-$)-ht),Ae==0?(Ke=He,Re=we,Qe=He,Ie=we):(Ke=Math.min(Ke,He),Re=Math.min(Re,we),Qe=Math.max(Qe,He),Ie=Math.max(Ie,we));return new l(Math.round(Ke),Math.round(Re),Math.round(Qe-Ke),Math.round(Ie-Re))},pe=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var O,q,K=(O=this.ctx.lineDash,q=this.ctx.lineDashOffset,JSON.stringify({lineDash:O,lineDashOffset:q}));this.prevLineDash!==K&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=K)}}})(Xe.API),(function(t){var e=function(o){var l,c,d,h,g,b,p,y,w,S;for(c=[],d=0,h=(o+=l="\0\0\0\0".slice(o.length%4||4)).length;h>d;d+=4)(g=(o.charCodeAt(d)<<24)+(o.charCodeAt(d+1)<<16)+(o.charCodeAt(d+2)<<8)+o.charCodeAt(d+3))!==0?(b=(g=((g=((g=((g=(g-(S=g%85))/85)-(w=g%85))/85)-(y=g%85))/85)-(p=g%85))/85)%85,c.push(b+33,p+33,y+33,w+33,S+33)):c.push(122);return(function(x,C){for(var P=C;P>0;P--)x.pop()})(c,l.length),String.fromCharCode.apply(String,c)+"~>"},n=function(o){var l,c,d,h,g,b=String,p="length",y=255,w="charCodeAt",S="slice",x="replace";for(o[S](-2),o=o[S](0,-2)[x](/\s/g,"")[x]("z","!!!!!"),d=[],h=0,g=(o+=l="uuuuu"[S](o[p]%5||5))[p];g>h;h+=5)c=52200625*(o[w](h)-33)+614125*(o[w](h+1)-33)+7225*(o[w](h+2)-33)+85*(o[w](h+3)-33)+(o[w](h+4)-33),d.push(y&c>>24,y&c>>16,y&c>>8,y&c);return(function(C,P){for(var L=P;L>0;L--)C.pop()})(d,l[p]),b.fromCharCode.apply(b,d)},r=function(o){return o.split("").map(function(l){return("0"+l.charCodeAt().toString(16)).slice(-2)}).join("")+">"},i=function(o){var l=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),l.test(o)===!1)return"";for(var c="",d=0;d<o.length;d+=2)c+=String.fromCharCode("0x"+(o[d]+o[d+1]));return c},a=function(o){for(var l=new Uint8Array(o.length),c=o.length;c--;)l[c]=o.charCodeAt(c);return(l=ed(l)).reduce(function(d,h){return d+String.fromCharCode(h)},"")};t.processDataByFilters=function(o,l){var c=0,d=o||"",h=[];for(typeof(l=l||[])=="string"&&(l=[l]),c=0;c<l.length;c+=1)switch(l[c]){case"ASCII85Decode":case"/ASCII85Decode":d=n(d),h.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":d=e(d),h.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":d=i(d),h.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":d=r(d),h.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":d=a(d),h.push("/FlateDecode");break;default:throw new Error('The filter: "'+l[c]+'" is not implemented')}return{data:d,reverseChain:h.reverse().join(" ")}}})(Xe.API),(function(t){t.loadFile=function(e,n,r){return(function(i,a,o){a=a!==!1,o=typeof o=="function"?o:function(){};var l=void 0;try{l=(function(c,d,h){var g=new XMLHttpRequest,b=0,p=function(y){var w=y.length,S=[],x=String.fromCharCode;for(b=0;b<w;b+=1)S.push(x(255&y.charCodeAt(b)));return S.join("")};if(g.open("GET",c,!d),g.overrideMimeType("text/plain; charset=x-user-defined"),d===!1&&(g.onload=function(){g.status===200?h(p(this.responseText)):h(void 0)}),g.send(null),d&&g.status===200)return p(g.responseText)})(i,a,o)}catch{}return l})(e,n,r)},t.allowFsRead=void 0,t.loadImageFile=t.loadFile})(Xe.API),(function(t){function e(){return(ft.html2canvas?Promise.resolve(ft.html2canvas):iu(()=>import("./html2canvas.esm-QH1iLAAe.js"),[])).catch(function(l){return Promise.reject(new Error("Could not load html2canvas: "+l))}).then(function(l){return l.default?l.default:l})}function n(){return(ft.DOMPurify?Promise.resolve(ft.DOMPurify):iu(()=>Promise.resolve().then(()=>rb),void 0)).catch(function(l){return Promise.reject(new Error("Could not load dompurify: "+l))}).then(function(l){return l.default?l.default:l})}var r=function(l){var c=Ht(l);return c==="undefined"?"undefined":c==="string"||l instanceof String?"string":c==="number"||l instanceof Number?"number":c==="function"||l instanceof Function?"function":l&&l.constructor===Array?"array":l&&l.nodeType===1?"element":c==="object"?"object":"unknown"},i=function(l,c){var d=document.createElement(l);for(var h in c.className&&(d.className=c.className),c.innerHTML&&c.dompurify&&(d.innerHTML=c.dompurify.sanitize(c.innerHTML)),c.style)d.style[h]=c.style[h];return d},a=function l(c,d){for(var h=c.nodeType===3?document.createTextNode(c.nodeValue):c.cloneNode(!1),g=c.firstChild;g;g=g.nextSibling)d!==!0&&g.nodeType===1&&g.nodeName==="SCRIPT"||h.appendChild(l(g,d));return c.nodeType===1&&(c.nodeName==="CANVAS"?(h.width=c.width,h.height=c.height,h.getContext("2d").drawImage(c,0,0)):c.nodeName!=="TEXTAREA"&&c.nodeName!=="SELECT"||(h.value=c.value),h.addEventListener("load",function(){h.scrollTop=c.scrollTop,h.scrollLeft=c.scrollLeft},!0)),h},o=function l(c){var d=Object.assign(l.convert(Promise.resolve()),JSON.parse(JSON.stringify(l.template))),h=l.convert(Promise.resolve(),d);return(h=h.setProgress(1,l,1,[l])).set(c)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(l,c){return l.__proto__=c||o.prototype,l},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(l,c){return this.then(function(){switch(c=c||(function(d){switch(r(d)){case"string":return"string";case"element":return d.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(l),c){case"string":return this.then(n).then(function(d){return this.set({src:i("div",{innerHTML:l,dompurify:d})})});case"element":return this.set({src:l});case"canvas":return this.set({canvas:l});case"img":return this.set({img:l});default:return this.error("Unknown source type.")}})},o.prototype.to=function(l){switch(l){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var l={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},c=a(this.prop.src,this.opt.html2canvas.javascriptEnabled);c.tagName==="BODY"&&(l.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:l}),this.prop.container.appendChild(c),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(c){var d=Object.assign({},this.opt.html2canvas);return delete d.onrendered,c(this.prop.container,d)}).then(function(c){(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(c){var d=this.opt.jsPDF,h=this.opt.fontFaces,g=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,b=Object.assign({async:!0,allowTaint:!0,scale:g,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete b.onrendered,d.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,d.context2d.posX=this.opt.x,d.context2d.posY=this.opt.y,d.context2d.margin=this.opt.margin,d.context2d.fontFaces=h,h)for(var p=0;p<h.length;++p){var y=h[p],w=y.src.find(function(S){return S.format==="truetype"});w&&d.addFont(w.url,y.ref.name,y.ref.style)}return b.windowHeight=b.windowHeight||0,b.windowHeight=b.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):b.windowHeight,d.context2d.save(!0),c(this.prop.container,b)}).then(function(c){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var l=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=l})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(l,c,d){return(d=d||"pdf").toLowerCase()==="img"||d.toLowerCase()==="image"?this.outputImg(l,c):this.outputPdf(l,c)},o.prototype.outputPdf=function(l,c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(l,c)})},o.prototype.outputImg=function(l){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(l){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+l+'" is not supported.'}})},o.prototype.save=function(l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(l?{filename:l}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(l){if(r(l)!=="object")return this;var c=Object.keys(l||{}).map(function(d){if(d in o.template.prop)return function(){this.prop[d]=l[d]};switch(d){case"margin":return this.setMargin.bind(this,l.margin);case"jsPDF":return function(){return this.opt.jsPDF=l.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,l.pageSize);default:return function(){this.opt[d]=l[d]}}},this);return this.then(function(){return this.thenList(c)})},o.prototype.get=function(l,c){return this.then(function(){var d=l in o.template.prop?this.prop[l]:this.opt[l];return c?c(d):d})},o.prototype.setMargin=function(l){return this.then(function(){switch(r(l)){case"number":l=[l,l,l,l];case"array":if(l.length===2&&(l=[l[0],l[1],l[0],l[1]]),l.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=l}).then(this.setPageSize)},o.prototype.setPageSize=function(l){function c(d,h){return Math.floor(d*h/72*96)}return this.then(function(){(l=l||Xe.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(l.inner={width:l.width-this.opt.margin[1]-this.opt.margin[3],height:l.height-this.opt.margin[0]-this.opt.margin[2]},l.inner.px={width:c(l.inner.width,l.k),height:c(l.inner.height,l.k)},l.inner.ratio=l.inner.height/l.inner.width),this.prop.pageSize=l})},o.prototype.setProgress=function(l,c,d,h){return l!=null&&(this.progress.val=l),c!=null&&(this.progress.state=c),d!=null&&(this.progress.n=d),h!=null&&(this.progress.stack=h),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(l,c,d,h){return this.setProgress(l?this.progress.val+l:null,c||null,d?this.progress.n+d:null,h?this.progress.stack.concat(h):null)},o.prototype.then=function(l,c){var d=this;return this.thenCore(l,c,function(h,g){return d.updateProgress(null,null,1,[h]),Promise.prototype.then.call(this,function(b){return d.updateProgress(null,h),b}).then(h,g).then(function(b){return d.updateProgress(1),b})})},o.prototype.thenCore=function(l,c,d){d=d||Promise.prototype.then;var h=this;l&&(l=l.bind(h)),c&&(c=c.bind(h));var g=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?h:o.convert(Object.assign({},h),Promise.prototype),b=d.call(g,l,c);return o.convert(b,h.__proto__)},o.prototype.thenExternal=function(l,c){return Promise.prototype.then.call(this,l,c)},o.prototype.thenList=function(l){var c=this;return l.forEach(function(d){c=c.thenCore(d)}),c},o.prototype.catch=function(l){l&&(l=l.bind(this));var c=Promise.prototype.catch.call(this,l);return o.convert(c,this)},o.prototype.catchExternal=function(l){return Promise.prototype.catch.call(this,l)},o.prototype.error=function(l){return this.then(function(){throw new Error(l)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,Xe.getPageSize=function(l,c,d){if(Ht(l)==="object"){var h=l;l=h.orientation,c=h.unit||c,d=h.format||d}c=c||"mm",d=d||"a4",l=(""+(l||"P")).toLowerCase();var g,b=(""+d).toLowerCase(),p={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(c){case"pt":g=1;break;case"mm":g=72/25.4;break;case"cm":g=72/2.54;break;case"in":g=72;break;case"px":g=.75;break;case"pc":case"em":g=12;break;case"ex":g=6;break;default:throw"Invalid unit: "+c}var y,w=0,S=0;if(p.hasOwnProperty(b))w=p[b][1]/g,S=p[b][0]/g;else try{w=d[1],S=d[0]}catch{throw new Error("Invalid format: "+d)}if(l==="p"||l==="portrait")l="p",S>w&&(y=S,S=w,w=y);else{if(l!=="l"&&l!=="landscape")throw"Invalid orientation: "+l;l="l",w>S&&(y=S,S=w,w=y)}return{width:S,height:w,unit:c,k:g,orientation:l}},t.html=function(l,c){(c=c||{}).callback=c.callback||function(){},c.html2canvas=c.html2canvas||{},c.html2canvas.canvas=c.html2canvas.canvas||this.canvas,c.jsPDF=c.jsPDF||this,c.fontFaces=c.fontFaces?c.fontFaces.map(xu):null;var d=new o(c);return c.worker?d:d.from(l).doCallback()}})(Xe.API),Xe.API.addJS=function(t){var e,n,r=(function(i){for(var a="",o=0;o<i.length;o++){var l=i[o];if(l==="("||l===")"){for(var c=0,d=o-1;d>=0&&i[d]==="\\";d--)c++;a+=c%2==0?"\\"+l:l}else a+=l}return a})(t);return this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(e+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),n=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+r+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){e!==void 0&&n!==void 0&&this.internal.out("/Names <</JavaScript "+e+" 0 R>>")}),this},(function(t){var e;t.events.push(["postPutResources",function(){var n=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var i=n.outline.render().split(/\r\n/),a=0;a<i.length;a++){var o=i[a],l=r.exec(o);if(l!=null){var c=l[1];n.internal.newObjectDeferredBegin(c,!1)}n.internal.write(o)}if(this.outline.createNamedDestinations){var d=this.internal.pages.length,h=[];for(a=0;a<d;a++){var g=n.internal.newObject();h.push(g);var b=n.internal.getPageInfo(a+1);n.internal.write("<< /D["+b.objId+" 0 R /XYZ null null null]>> endobj")}var p=n.internal.newObject();for(n.internal.write("<< /Names [ "),a=0;a<h.length;a++)n.internal.write("(page_"+(a+1)+")"+h[a]+" 0 R");n.internal.write(" ] >>","endobj"),e=n.internal.newObject(),n.internal.write("<< /Dests "+p+" 0 R"),n.internal.write(">>","endobj")}}]),t.events.push(["putCatalog",function(){var n=this;n.outline.root.children.length>0&&(n.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&n.internal.write("/Names "+e+" 0 R"))}]),t.events.push(["initialized",function(){var n=this;n.outline={createNamedDestinations:!1,root:{children:[]}},n.outline.add=function(r,i,a){var o={title:i,options:a,children:[]};return r==null&&(r=this.root),r.children.push(o),o},n.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=n,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},n.outline.genIds_r=function(r){r.id=n.internal.newObjectDeferred();for(var i=0;i<r.children.length;i++)this.genIds_r(r.children[i])},n.outline.renderRoot=function(r){this.objStart(r),this.line("/Type /Outlines"),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1]))),this.line("/Count "+this.count_r({count:0},r)),this.objEnd()},n.outline.renderItems=function(r){for(var i=this.ctx.pdf.internal.getVerticalCoordinateString,a=0;a<r.children.length;a++){var o=r.children[a];this.objStart(o),this.line("/Title "+this.makeString(o.title)),this.line("/Parent "+this.makeRef(r)),a>0&&this.line("/Prev "+this.makeRef(r.children[a-1])),a<r.children.length-1&&this.line("/Next "+this.makeRef(r.children[a+1])),o.children.length>0&&(this.line("/First "+this.makeRef(o.children[0])),this.line("/Last "+this.makeRef(o.children[o.children.length-1])));var l=this.count=this.count_r({count:0},o);if(l>0&&this.line("/Count "+l),o.options&&o.options.pageNumber){var c=n.internal.getPageInfo(o.options.pageNumber);this.line("/Dest ["+c.objId+" 0 R /XYZ 0 "+i(0)+" 0]")}this.objEnd()}for(var d=0;d<r.children.length;d++)this.renderItems(r.children[d])},n.outline.line=function(r){this.ctx.val+=r+`\r
`},n.outline.makeRef=function(r){return r.id+" 0 R"},n.outline.makeString=function(r){return"("+n.internal.pdfEscape(r)+")"},n.outline.objStart=function(r){this.ctx.val+=`\r
`+r.id+` 0 obj\r
<<\r
`},n.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},n.outline.count_r=function(r,i){for(var a=0;a<i.children.length;a++)r.count++,this.count_r(r,i.children[a]);return r.count}}])})(Xe.API),(function(t){var e=[192,193,194,195,196,197,198,199];t.processJPEG=function(n,r,i,a,o,l){var c,d=this.decode.DCT_DECODE,h=null;if(typeof n=="string"||this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n)){switch(n=o||n,n=this.__addimage__.isArrayBuffer(n)?new Uint8Array(n):n,c=(function(g){for(var b,p=256*g.charCodeAt(4)+g.charCodeAt(5),y=g.length,w={width:0,height:0,numcomponents:1},S=4;S<y;S+=2){if(S+=p,e.indexOf(g.charCodeAt(S+1))!==-1){b=256*g.charCodeAt(S+5)+g.charCodeAt(S+6),w={width:256*g.charCodeAt(S+7)+g.charCodeAt(S+8),height:b,numcomponents:g.charCodeAt(S+9)};break}p=256*g.charCodeAt(S+2)+g.charCodeAt(S+3)}return w})(n=this.__addimage__.isArrayBufferView(n)?this.__addimage__.arrayBufferToBinaryString(n):n),c.numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}h={data:n,width:c.width,height:c.height,colorSpace:l,bitsPerComponent:8,filter:d,index:r,alias:i}}return h}})(Xe.API),Xe.API.processPNG=function(t,e,n,r){if(this.__addimage__.isArrayBuffer(t)&&(t=new Uint8Array(t)),this.__addimage__.isArrayBufferView(t)){var i,a=vy(t,{checkCrc:!0}),o=a.width,l=a.height,c=a.channels,d=a.palette,h=a.depth;i=d&&c===1?(function(X){for(var D=X.width,I=X.height,k=X.data,A=X.palette,M=X.depth,B=!1,J=[],oe=[],ue=void 0,ae=!1,fe=0,ke=0;ke<A.length;ke++){var pe=yf(A[ke],4),O=pe[0],q=pe[1],K=pe[2],Y=pe[3];J.push(O,q,K),Y!=null&&(Y===0?(fe++,oe.length<1&&oe.push(ke)):Y<255&&(ae=!0))}if(ae||fe>1){B=!0,oe=void 0;var Q=D*I;ue=new Uint8Array(Q);for(var z=new DataView(k.buffer),re=0;re<Q;re++){var ce=Au(z,re,M),ge=yf(A[ce],4)[3];ue[re]=ge}}else fe===0&&(oe=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:B?8:void 0,colorBytes:k,alphaBytes:ue,needSMask:B,palette:J,mask:oe}})(a):c===2||c===4?(function(X){for(var D=X.data,I=X.width,k=X.height,A=X.channels,M=X.depth,B=A===2?"DeviceGray":"DeviceRGB",J=A-1,oe=I*k,ue=J,ae=oe*ue,fe=1*oe,ke=Math.ceil(ae*M/8),pe=Math.ceil(fe*M/8),O=new Uint8Array(ke),q=new Uint8Array(pe),K=new DataView(D.buffer),Y=new DataView(O.buffer),Q=new DataView(q.buffer),z=!1,re=0;re<oe;re++){for(var ce=re*A,ge=0;ge<ue;ge++)xp(Y,Au(K,ce+ge,M),re*ue+ge,M);var Ae=Au(K,ce+ue,M);Ae<(1<<M)-1&&(z=!0),xp(Q,Ae,1*re,M)}return{colorSpace:B,colorsPerPixel:J,sMaskBitsPerComponent:z?M:void 0,colorBytes:O,alphaBytes:q,needSMask:z}})(a):(function(X){var D=X.data,I=X.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:I,colorsPerPixel:I==="DeviceGray"?1:3,colorBytes:D instanceof Uint16Array?(function(k){for(var A=k.length,M=new Uint8Array(2*A),B=new DataView(M.buffer,M.byteOffset,M.byteLength),J=0;J<A;J++)B.setUint16(2*J,k[J],!1);return M})(D):D,needSMask:!1}})(a);var g,b,p,y=i,w=y.colorSpace,S=y.colorsPerPixel,x=y.sMaskBitsPerComponent,C=y.colorBytes,P=y.alphaBytes,L=y.needSMask,U=y.palette,ee=y.mask,V=null;return r!==Xe.API.image_compression.NONE&&typeof ed=="function"?(V=(function(X){var D;switch(X){case Xe.API.image_compression.FAST:D=11;break;case Xe.API.image_compression.MEDIUM:D=13;break;case Xe.API.image_compression.SLOW:D=14;break;default:D=12}return D})(r),g=this.decode.FLATE_DECODE,b="/Predictor ".concat(V," /Colors ").concat(S," /BitsPerComponent ").concat(h," /Columns ").concat(o),t=vp(C,Math.ceil(o*S*h/8),S,h,r),L&&(p=vp(P,Math.ceil(o*x/8),1,x,r))):(g=void 0,b=void 0,t=C,L&&(p=P)),(this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t))&&(t=this.__addimage__.arrayBufferToBinaryString(t)),(p&&this.__addimage__.isArrayBuffer(p)||this.__addimage__.isArrayBufferView(p))&&(p=this.__addimage__.arrayBufferToBinaryString(p)),{alias:n,data:t,index:e,filter:g,decodeParameters:b,transparency:ee,palette:U,sMask:p,predictor:V,width:o,height:l,bitsPerComponent:h,sMaskBitsPerComponent:x,colorSpace:w}}},(function(t){t.processGIF89A=function(e,n,r,i){var a=new By(e),o=a.width,l=a.height,c=[];a.decodeAndBlitFrameRGBA(0,c);var d={data:c,width:o,height:l},h=new ku(100).encode(d,100);return t.processJPEG.call(this,h,n,r,i)},t.processGIF87A=t.processGIF89A})(Xe.API),Kr.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var t=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var e=0;e<t;e++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:i,green:r,blue:n,quad:a}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Kr.prototype.parseBGR=function(){this.pos=this.offset;var t="bit"+this.bitPP,e=this.width*this.height*4;if(e>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");this.data=new Uint8Array(e);try{this[t]()}catch(n){Kt.log("bit decode error:"+n)}},Kr.prototype.bit1=function(){var t,e=Math.ceil(this.width/8),n=e%4;for(t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,i=0;i<e;i++)for(var a=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+8*i*4,l=0;l<8&&8*i+l<this.width;l++){var c=this.palette[a>>7-l&1];this.data[o+4*l]=c.blue,this.data[o+4*l+1]=c.green,this.data[o+4*l+2]=c.red,this.data[o+4*l+3]=255}n!==0&&(this.pos+=4-n)}},Kr.prototype.bit4=function(){for(var t=Math.ceil(this.width/2),e=t%4,n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,i=0;i<t;i++){var a=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+2*i*4,l=a>>4,c=15&a,d=this.palette[l];if(this.data[o]=d.blue,this.data[o+1]=d.green,this.data[o+2]=d.red,this.data[o+3]=255,2*i+1>=this.width)break;d=this.palette[c],this.data[o+4]=d.blue,this.data[o+4+1]=d.green,this.data[o+4+2]=d.red,this.data[o+4+3]=255}e!==0&&(this.pos+=4-e)}},Kr.prototype.bit8=function(){for(var t=this.width%4,e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var i=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+4*r;if(i<this.palette.length){var o=this.palette[i];this.data[a]=o.red,this.data[a+1]=o.green,this.data[a+2]=o.blue,this.data[a+3]=255}else this.data[a]=255,this.data[a+1]=255,this.data[a+2]=255,this.data[a+3]=255}t!==0&&(this.pos+=4-t)}},Kr.prototype.bit15=function(){for(var t=this.width%3,e=parseInt("11111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,i=0;i<this.width;i++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&e)/e*255|0,l=(a>>5&e)/e*255|0,c=(a>>10&e)/e*255|0,d=a>>15?255:0,h=r*this.width*4+4*i;this.data[h]=c,this.data[h+1]=l,this.data[h+2]=o,this.data[h+3]=d}this.pos+=t}},Kr.prototype.bit16=function(){for(var t=this.width%3,e=parseInt("11111",2),n=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var i=this.bottom_up?r:this.height-1-r,a=0;a<this.width;a++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(o&e)/e*255|0,c=(o>>5&n)/n*255|0,d=(o>>11)/e*255|0,h=i*this.width*4+4*a;this.data[h]=d,this.data[h+1]=c,this.data[h+2]=l,this.data[h+3]=255}this.pos+=t}},Kr.prototype.bit24=function(){for(var t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*n;this.data[o]=a,this.data[o+1]=i,this.data[o+2]=r,this.data[o+3]=255}this.pos+=this.width%4}},Kr.prototype.bit32=function(){for(var t=this.height-1;t>=0;t--)for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),l=e*this.width*4+4*n;this.data[l]=a,this.data[l+1]=i,this.data[l+2]=r,this.data[l+3]=o}},Kr.prototype.getData=function(){return this.data},(function(t){t.processBMP=function(e,n,r,i){var a=new Kr(e,!1),o=a.width,l=a.height,c={data:a.getData(),width:o,height:l},d=new ku(100).encode(c,100);return t.processJPEG.call(this,d,n,r,i)}})(Xe.API),Ap.prototype.getData=function(){return this.data},(function(t){t.processWEBP=function(e,n,r,i){var a=new Ap(e),o=a.width,l=a.height,c={data:a.getData(),width:o,height:l},d=new ku(100).encode(c,100);return t.processJPEG.call(this,d,n,r,i)}})(Xe.API),Xe.API.processRGBA=function(t,e,n){for(var r=t.data,i=r.length,a=new Uint8Array(i/4*3),o=new Uint8Array(i/4),l=0,c=0,d=0;d<i;d+=4){var h=r[d],g=r[d+1],b=r[d+2],p=r[d+3];a[l++]=h,a[l++]=g,a[l++]=b,o[c++]=p}var y=this.__addimage__.arrayBufferToBinaryString(a);return{alpha:this.__addimage__.arrayBufferToBinaryString(o),data:y,index:e,alias:n,colorSpace:"DeviceRGB",bitsPerComponent:8,width:t.width,height:t.height}},Xe.API.setLanguage=function(t){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[t]!==void 0&&(this.internal.languageSettings.languageCode=t,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},cs=Xe.API,Ll=cs.getCharWidthsArray=function(t,e){var n,r,i=(e=e||{}).font||this.internal.getFont(),a=e.fontSize||this.internal.getFontSize(),o=e.charSpace||this.internal.getCharSpace(),l=e.widths?e.widths:i.metadata.Unicode.widths,c=l.fof?l.fof:1,d=e.kerning?e.kerning:i.metadata.Unicode.kerning,h=d.fof?d.fof:1,g=e.doKerning!==!1,b=0,p=t.length,y=0,w=l[0]||c,S=[];for(n=0;n<p;n++)r=t.charCodeAt(n),typeof i.metadata.widthOfString=="function"?S.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(r))+o*(1e3/a)||0)/1e3):(b=g&&Ht(d[r])==="object"&&!isNaN(parseInt(d[r][y],10))?d[r][y]/h:0,S.push((l[r]||w)/c+b)),y=r;return S},pp=cs.getStringUnitWidth=function(t,e){var n=(e=e||{}).fontSize||this.internal.getFontSize(),r=e.font||this.internal.getFont(),i=e.charSpace||this.internal.getCharSpace();return cs.processArabic&&(t=cs.processArabic(t)),typeof r.metadata.widthOfString=="function"?r.metadata.widthOfString(t,n,i)/n:Ll.apply(this,arguments).reduce(function(a,o){return a+o},0)},mp=function(t,e,n,r){for(var i=[],a=0,o=t.length,l=0;a!==o&&l+e[a]<n;)l+=e[a],a++;i.push(t.slice(0,a));var c=a;for(l=0;a!==o;)l+e[a]>r&&(i.push(t.slice(c,a)),l=0,c=a),l+=e[a],a++;return c!==a&&i.push(t.slice(c,a)),i},gp=function(t,e,n){n||(n={});var r,i,a,o,l,c,d,h=[],g=[h],b=n.textIndent||0,p=0,y=0,w=t.split(" "),S=Ll.apply(this,[" ",n])[0];if(c=n.lineIndent===-1?w[0].length+2:n.lineIndent||0){var x=Array(c).join(" "),C=[];w.map(function(L){(L=L.split(/\s*\n/)).length>1?C=C.concat(L.map(function(U,ee){return(ee&&U.length?`
`:"")+U})):C.push(L[0])}),w=C,c=pp.apply(this,[x,n])}for(a=0,o=w.length;a<o;a++){var P=0;if(r=w[a],c&&r[0]==`
`&&(r=r.substr(1),P=1),b+p+(y=(i=Ll.apply(this,[r,n])).reduce(function(L,U){return L+U},0))>e||P){if(y>e){for(l=mp.apply(this,[r,i,e-(b+p),e]),h.push(l.shift()),h=[l.pop()];l.length;)g.push([l.shift()]);y=i.slice(r.length-(h[0]?h[0].length:0)).reduce(function(L,U){return L+U},0)}else h=[r];g.push(h),b=y+c,p=S}else h.push(r),b+=p+y,p=S}return d=c?function(L,U){return(U?x:"")+L.join(" ")}:function(L){return L.join(" ")},g.map(d)},cs.splitTextToSize=function(t,e,n){var r,i=(n=n||{}).fontSize||this.internal.getFontSize(),a=(function(h){if(h.widths&&h.kerning)return{widths:h.widths,kerning:h.kerning};var g=this.internal.getFont(h.fontName,h.fontStyle),b="Unicode";return g.metadata[b]?{widths:g.metadata[b].widths||{0:1},kerning:g.metadata[b].kerning||{}}:{font:g.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,n);r=Array.isArray(t)?t:String(t).split(/\r?\n/);var o=1*this.internal.scaleFactor*e/i;a.textIndent=n.textIndent?1*n.textIndent*this.internal.scaleFactor/i:0,a.lineIndent=n.lineIndent;var l,c,d=[];for(l=0,c=r.length;l<c;l++)d=d.concat(gp.apply(this,[r[l],o,a]));return d},(function(t){t.__fontmetrics__=t.__fontmetrics__||{};for(var e="0123456789abcdef",n="klmnopqrstuvwxyz",r={},i={},a=0;a<16;a++)r[n[a]]=e[a],i[e[a]]=n[a];var o=function(b){return"0x"+parseInt(b,10).toString(16)},l=t.__fontmetrics__.compress=function(b){var p,y,w,S,x=["{"];for(var C in b){if(p=b[C],isNaN(parseInt(C,10))?y="'"+C+"'":(C=parseInt(C,10),y=(y=o(C).slice(2)).slice(0,-1)+i[y.slice(-1)]),typeof p=="number")p<0?(w=o(p).slice(3),S="-"):(w=o(p).slice(2),S=""),w=S+w.slice(0,-1)+i[w.slice(-1)];else{if(Ht(p)!=="object")throw new Error("Don't know what to do with value type "+Ht(p)+".");w=l(p)}x.push(y+w)}return x.push("}"),x.join("")},c=t.__fontmetrics__.uncompress=function(b){if(typeof b!="string")throw new Error("Invalid argument passed to uncompress.");for(var p,y,w,S,x={},C=1,P=x,L=[],U="",ee="",V=b.length-1,X=1;X<V;X+=1)(S=b[X])=="'"?p?(w=p.join(""),p=void 0):p=[]:p?p.push(S):S=="{"?(L.push([P,w]),P={},w=void 0):S=="}"?((y=L.pop())[0][y[1]]=P,w=void 0,P=y[0]):S=="-"?C=-1:w===void 0?r.hasOwnProperty(S)?(U+=r[S],w=parseInt(U,16)*C,C=1,U=""):U+=S:r.hasOwnProperty(S)?(ee+=r[S],P[w]=parseInt(ee,16)*C,C=1,w=void 0,ee=""):ee+=S;return x},d={codePages:["WinAnsiEncoding"],WinAnsiEncoding:c("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},h={Unicode:{Courier:d,"Courier-Bold":d,"Courier-BoldOblique":d,"Courier-Oblique":d,Helvetica:d,"Helvetica-Bold":d,"Helvetica-BoldOblique":d,"Helvetica-Oblique":d,"Times-Roman":d,"Times-Bold":d,"Times-BoldItalic":d,"Times-Italic":d}},g={Unicode:{"Courier-Oblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":c("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":c("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:c("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:c("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":c("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":c("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};t.events.push(["addFont",function(b){var p=b.font,y=g.Unicode[p.postScriptName];y&&(p.metadata.Unicode={},p.metadata.Unicode.widths=y.widths,p.metadata.Unicode.kerning=y.kerning);var w=h.Unicode[p.postScriptName];w&&(p.metadata.Unicode.encoding=w,p.encoding=w.codePages[0])}])})(Xe.API),(function(t){var e=function(n){for(var r=n.length,i=new Uint8Array(r),a=0;a<r;a++)i[a]=n.charCodeAt(a);return i};t.API.events.push(["addFont",function(n){var r=void 0,i=n.font,a=n.instance;if(!i.isStandardFont){if(a===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if(typeof(r=a.existsFileInVFS(i.postScriptName)===!1?a.loadFile(i.postScriptName):a.getFileFromVFS(i.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");(function(o,l){l=/^\x00\x01\x00\x00/.test(l)?e(l):e(Rl(l)),o.metadata=t.API.TTFFont.open(l),o.metadata.Unicode=o.metadata.Unicode||{encoding:{},kerning:{},widths:[]},o.metadata.glyIdsUsed=[0]})(i,r)}}])})(Xe),Xe.API.addSvgAsImage=function(t,e,n,r,i,a,o,l){if(isNaN(e)||isNaN(n))throw Kt.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(r)||isNaN(i))throw Kt.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=r,c.height=i;var d=c.getContext("2d");d.fillStyle="#fff",d.fillRect(0,0,c.width,c.height);var h={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},g=this;return(ft.canvg?Promise.resolve(ft.canvg):iu(()=>import("./index.es-Bkowsb3T.js"),[])).catch(function(b){return Promise.reject(new Error("Could not load canvg: "+b))}).then(function(b){return b.default?b.default:b}).then(function(b){return b.fromString(d,t,h)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(b){return b.render(h)}).then(function(){g.addImage(c.toDataURL("image/jpeg",1),e,n,r,i,o,l)})},Xe.API.putTotalPages=function(t){var e,n=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(t,"g"),n=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(t,this.internal.getFont()),"g"),n=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var i=0;i<this.internal.pages[r].length;i++)this.internal.pages[r][i]=this.internal.pages[r][i].replace(e,n);return this},Xe.API.viewerPreferences=function(t,e){var n;t=t||{},e=e||!1;var r,i,a,o={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(o),c=[],d=0,h=0,g=0;function b(y,w){var S,x=!1;for(S=0;S<y.length;S+=1)y[S]===w&&(x=!0);return x}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(o)),this.internal.viewerpreferences.isSubscribed=!1),n=this.internal.viewerpreferences.configuration,t==="reset"||e===!0){var p=l.length;for(g=0;g<p;g+=1)n[l[g]].value=n[l[g]].defaultValue,n[l[g]].explicitSet=!1}if(Ht(t)==="object"){for(i in t)if(a=t[i],b(l,i)&&a!==void 0){if(n[i].type==="boolean"&&typeof a=="boolean")n[i].value=a;else if(n[i].type==="name"&&b(n[i].valueSet,a))n[i].value=a;else if(n[i].type==="integer"&&Number.isInteger(a))n[i].value=a;else if(n[i].type==="array"){for(d=0;d<a.length;d+=1)if(r=!0,a[d].length===1&&typeof a[d][0]=="number")c.push(String(a[d]-1));else if(a[d].length>1){for(h=0;h<a[d].length;h+=1)typeof a[d][h]!="number"&&(r=!1);r===!0&&c.push([a[d][0]-1,a[d][1]-1].join(" "))}n[i].value="["+c.join(" ")+"]"}else n[i].value=n[i].defaultValue;n[i].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var y,w=[];for(y in n)n[y].explicitSet===!0&&(n[y].type==="name"?w.push("/"+y+" /"+n[y].value):w.push("/"+y+" "+n[y].value));w.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+w.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=n,this},Xe.API.addMetadata=function(t,e){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:t,namespaceUri:e??"http://jspdf.default.namespaceuri/",rawXml:typeof e=="boolean"&&e},this.internal.events.subscribe("putCatalog",Uy),this.internal.events.subscribe("postPutResources",My)),this},(function(t){var e=t.API,n=e.pdfEscape16=function(a,o){for(var l,c=o.metadata.Unicode.widths,d=["","0","00","000","0000"],h=[""],g=0,b=a.length;g<b;++g){if(l=o.metadata.characterToGlyph(a.charCodeAt(g)),o.metadata.glyIdsUsed.push(l),o.metadata.toUnicode[l]=a.charCodeAt(g),c.indexOf(l)==-1&&(c.push(l),c.push([parseInt(o.metadata.widthOfGlyph(l),10)])),l=="0")return h.join("");l=l.toString(16),h.push(d[4-l.length],l)}return h.join("")},r=function(a){var o,l,c,d,h,g,b;for(h=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,c=[],g=0,b=(l=Object.keys(a).sort(function(p,y){return p-y})).length;g<b;g++)o=l[g],c.length>=100&&(h+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar`,c=[]),a[o]!==void 0&&a[o]!==null&&typeof a[o].toString=="function"&&(d=("0000"+a[o].toString(16)).slice(-4),o=("0000"+(+o).toString(16)).slice(-4),c.push("<"+o+"><"+d+">"));return c.length&&(h+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar
`),h+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(a){(function(o){var l=o.font,c=o.out,d=o.newObject,h=o.putStream;if(l.metadata instanceof t.API.TTFFont&&l.encoding==="Identity-H"){for(var g=l.metadata.Unicode.widths,b=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),p="",y=0;y<b.length;y++)p+=String.fromCharCode(b[y]);var w=d();h({data:p,addLength1:!0,objectId:w}),c("endobj");var S=d();h({data:r(l.metadata.toUnicode),addLength1:!0,objectId:S}),c("endobj");var x=d();c("<<"),c("/Type /FontDescriptor"),c("/FontName /"+ps(l.fontName)),c("/FontFile2 "+w+" 0 R"),c("/FontBBox "+t.API.PDFObject.convert(l.metadata.bbox)),c("/Flags "+l.metadata.flags),c("/StemV "+l.metadata.stemV),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c(">>"),c("endobj");var C=d();c("<<"),c("/Type /Font"),c("/BaseFont /"+ps(l.fontName)),c("/FontDescriptor "+x+" 0 R"),c("/W "+t.API.PDFObject.convert(g)),c("/CIDToGIDMap /Identity"),c("/DW 1000"),c("/Subtype /CIDFontType2"),c("/CIDSystemInfo"),c("<<"),c("/Supplement 0"),c("/Registry (Adobe)"),c("/Ordering ("+l.encoding+")"),c(">>"),c(">>"),c("endobj"),l.objectNumber=d(),c("<<"),c("/Type /Font"),c("/Subtype /Type0"),c("/ToUnicode "+S+" 0 R"),c("/BaseFont /"+ps(l.fontName)),c("/Encoding /"+l.encoding),c("/DescendantFonts ["+C+" 0 R]"),c(">>"),c("endobj"),l.isAlreadyPutted=!0}})(a)}]),e.events.push(["putFont",function(a){(function(o){var l=o.font,c=o.out,d=o.newObject,h=o.putStream;if(l.metadata instanceof t.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var g=l.metadata.rawData,b="",p=0;p<g.length;p++)b+=String.fromCharCode(g[p]);var y=d();h({data:b,addLength1:!0,objectId:y}),c("endobj");var w=d();h({data:r(l.metadata.toUnicode),addLength1:!0,objectId:w}),c("endobj");var S=d();c("<<"),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c("/StemV "+l.metadata.stemV),c("/Type /FontDescriptor"),c("/FontFile2 "+y+" 0 R"),c("/Flags 96"),c("/FontBBox "+t.API.PDFObject.convert(l.metadata.bbox)),c("/FontName /"+ps(l.fontName)),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c(">>"),c("endobj"),l.objectNumber=d();for(var x=0;x<l.metadata.hmtx.widths.length;x++)l.metadata.hmtx.widths[x]=parseInt(l.metadata.hmtx.widths[x]*(1e3/l.metadata.head.unitsPerEm));c("<</Subtype/TrueType/Type/Font/ToUnicode "+w+" 0 R/BaseFont/"+ps(l.fontName)+"/FontDescriptor "+S+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+t.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),c("endobj"),l.isAlreadyPutted=!0}})(a)}]);var i=function(a){var o,l=a.text||"",c=a.x,d=a.y,h=a.options||{},g=a.mutex||{},b=g.pdfEscape,p=g.activeFontKey,y=g.fonts,w=p,S="",x=0,C="",P=y[w].encoding;if(y[w].encoding!=="Identity-H")return{text:l,x:c,y:d,options:h,mutex:g};for(C=l,w=p,Array.isArray(l)&&(C=l[0]),x=0;x<C.length;x+=1)y[w].metadata.hasOwnProperty("cmap")&&(o=y[w].metadata.cmap.unicode.codeMap[C[x].charCodeAt(0)]),o||C[x].charCodeAt(0)<256&&y[w].metadata.hasOwnProperty("Unicode")?S+=C[x]:S+="";var L="";return parseInt(w.slice(1))<14||P==="WinAnsiEncoding"?L=b(S,w).split("").map(function(U){return U.charCodeAt(0).toString(16)}).join(""):P==="Identity-H"&&(L=n(S,y[w])),g.isHex=!0,{text:L,x:c,y:d,options:h,mutex:g}};e.events.push(["postProcessText",function(a){var o=a.text||"",l=[],c={text:o,x:a.x,y:a.y,options:a.options,mutex:a.mutex};if(Array.isArray(o)){var d=0;for(d=0;d<o.length;d+=1)Array.isArray(o[d])&&o[d].length===3?l.push([i(Object.assign({},c,{text:o[d][0]})).text,o[d][1],o[d][2]]):l.push(i(Object.assign({},c,{text:o[d]})).text);a.text=l}else a.text=i(Object.assign({},c,{text:o})).text}])})(Xe),(function(t){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};t.existsFileInVFS=function(n){return e.call(this),this.internal.vFS[n]!==void 0},t.addFileToVFS=function(n,r){return e.call(this),this.internal.vFS[n]=r,this},t.getFileFromVFS=function(n){return e.call(this),this.internal.vFS[n]!==void 0?this.internal.vFS[n]:null}})(Xe.API),(function(t){t.__bidiEngine__=t.prototype.__bidiEngine__=function(r){var i,a,o,l,c,d,h,g=e,b=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],p=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],y={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},w={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},S=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],x=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),C=!1,P=0;this.__bidiEngine__={};var L=function(k){var A=k.charCodeAt(),M=A>>8,B=w[M];return B!==void 0?g[256*B+(255&A)]:M===252||M===253?"AL":x.test(M)?"L":M===8?"R":"N"},U=function(k){for(var A,M=0;M<k.length;M++){if((A=L(k.charAt(M)))==="L")return!1;if(A==="R")return!0}return!1},ee=function(k,A,M,B){var J,oe,ue,ae,fe=A[B];switch(fe){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":C=!1;break;case"N":case"AN":break;case"EN":C&&(fe="AN");break;case"AL":C=!0,fe="R";break;case"WS":case"BN":fe="N";break;case"CS":B<1||B+1>=A.length||(J=M[B-1])!=="EN"&&J!=="AN"||(oe=A[B+1])!=="EN"&&oe!=="AN"?fe="N":C&&(oe="AN"),fe=oe===J?oe:"N";break;case"ES":fe=(J=B>0?M[B-1]:"B")==="EN"&&B+1<A.length&&A[B+1]==="EN"?"EN":"N";break;case"ET":if(B>0&&M[B-1]==="EN"){fe="EN";break}if(C){fe="N";break}for(ue=B+1,ae=A.length;ue<ae&&A[ue]==="ET";)ue++;fe=ue<ae&&A[ue]==="EN"?"EN":"N";break;case"NSM":if(o&&!l){for(ae=A.length,ue=B+1;ue<ae&&A[ue]==="NSM";)ue++;if(ue<ae){var ke=k[B],pe=ke>=1425&&ke<=2303||ke===64286;if(J=A[ue],pe&&(J==="R"||J==="AL")){fe="R";break}}}fe=B<1||(J=A[B-1])==="B"?"N":M[B-1];break;case"B":C=!1,i=!0,fe=P;break;case"S":a=!0,fe="N"}return fe},V=function(k,A,M){var B=k.split("");return M&&X(B,M,{hiLevel:P}),B.reverse(),A&&A.reverse(),B.join("")},X=function(k,A,M){var B,J,oe,ue,ae,fe=-1,ke=k.length,pe=0,O=[],q=P?p:b,K=[];for(C=!1,i=!1,a=!1,J=0;J<ke;J++)K[J]=L(k[J]);for(oe=0;oe<ke;oe++){if(ae=pe,O[oe]=ee(k,K,O,oe),B=240&(pe=q[ae][y[O[oe]]]),pe&=15,A[oe]=ue=q[pe][5],B>0)if(B===16){for(J=fe;J<oe;J++)A[J]=1;fe=-1}else fe=-1;if(q[pe][6])fe===-1&&(fe=oe);else if(fe>-1){for(J=fe;J<oe;J++)A[J]=ue;fe=-1}K[oe]==="B"&&(A[oe]=0),M.hiLevel|=ue}a&&(function(Y,Q,z){for(var re=0;re<z;re++)if(Y[re]==="S"){Q[re]=P;for(var ce=re-1;ce>=0&&Y[ce]==="WS";ce--)Q[ce]=P}})(K,A,ke)},D=function(k,A,M,B,J){if(!(J.hiLevel<k)){if(k===1&&P===1&&!i)return A.reverse(),void(M&&M.reverse());for(var oe,ue,ae,fe,ke=A.length,pe=0;pe<ke;){if(B[pe]>=k){for(ae=pe+1;ae<ke&&B[ae]>=k;)ae++;for(fe=pe,ue=ae-1;fe<ue;fe++,ue--)oe=A[fe],A[fe]=A[ue],A[ue]=oe,M&&(oe=M[fe],M[fe]=M[ue],M[ue]=oe);pe=ae}pe++}}},I=function(k,A,M){var B=k.split(""),J={hiLevel:P};return M||(M=[]),X(B,M,J),(function(oe,ue,ae){if(ae.hiLevel!==0&&h)for(var fe,ke=0;ke<oe.length;ke++)ue[ke]===1&&(fe=S.indexOf(oe[ke]))>=0&&(oe[ke]=S[fe+1])})(B,M,J),D(2,B,A,M,J),D(1,B,A,M,J),B.join("")};return this.__bidiEngine__.doBidiReorder=function(k,A,M){if((function(J,oe){if(oe)for(var ue=0;ue<J.length;ue++)oe[ue]=ue;l===void 0&&(l=U(J)),d===void 0&&(d=U(J))})(k,A),o||!c||d)if(o&&c&&l^d)P=l?1:0,k=V(k,A,M);else if(!o&&c&&d)P=l?1:0,k=I(k,A,M),k=V(k,A);else if(!o||l||c||d){if(o&&!c&&l^d)k=V(k,A),l?(P=0,k=I(k,A,M)):(P=1,k=I(k,A,M),k=V(k,A));else if(o&&l&&!c&&d)P=1,k=I(k,A,M),k=V(k,A);else if(!o&&!c&&l^d){var B=h;l?(P=1,k=I(k,A,M),P=0,h=!1,k=I(k,A,M),h=B):(P=0,k=I(k,A,M),k=V(k,A),P=1,h=!1,k=I(k,A,M),h=B,k=V(k,A))}}else P=0,k=I(k,A,M);else P=l?1:0,k=I(k,A,M);return k},this.__bidiEngine__.setOptions=function(k){k&&(o=k.isInputVisual,c=k.isOutputVisual,l=k.isInputRtl,d=k.isOutputRtl,h=k.isSymmetricSwapping)},this.__bidiEngine__.setOptions(r),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],n=new t.__bidiEngine__({isInputVisual:!0});t.API.events.push(["postProcessText",function(r){var i=r.text;r.x,r.y;var a=r.options||{};r.mutex,a.lang;var o=[];if(a.isInputVisual=typeof a.isInputVisual!="boolean"||a.isInputVisual,n.setOptions(a),Object.prototype.toString.call(i)==="[object Array]"){var l=0;for(o=[],l=0;l<i.length;l+=1)Object.prototype.toString.call(i[l])==="[object Array]"?o.push([n.doBidiReorder(i[l][0]),i[l][1],i[l][2]]):o.push([n.doBidiReorder(i[l])]);r.text=o}else r.text=n.doBidiReorder(i);n.setOptions({isInputVisual:!0})}])})(Xe),Xe.API.TTFFont=(function(){function t(e){var n;if(this.rawData=e,n=this.contents=new ua(e),this.contents.pos=4,n.readString(4)==="ttcf")throw new Error("TTCF not supported.");n.pos=0,this.parse(),this.subset=new t_(this),this.registerTTF()}return t.open=function(e){return new t(e)},t.prototype.parse=function(){return this.directory=new $y(this.contents),this.head=new zy(this),this.name=new Ky(this),this.cmap=new dg(this),this.toUnicode={},this.hhea=new Hy(this),this.maxp=new Jy(this),this.hmtx=new Yy(this),this.post=new Gy(this),this.os2=new Wy(this),this.loca=new e_(this),this.glyf=new Xy(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},t.prototype.registerTTF=function(){var e,n,r,i,a;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var o,l,c,d;for(d=[],o=0,l=(c=this.bbox).length;o<l;o++)e=c[o],d.push(Math.round(e*this.scaleFactor));return d}).call(this),this.stemV=0,this.post.exists?(r=255&(i=this.post.italic_angle),32768&(n=i>>16)&&(n=-(1+(65535^n))),this.italicAngle=+(n+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(a=this.familyClass)===1||a===2||a===3||a===4||a===5||a===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},t.prototype.characterToGlyph=function(e){var n;return((n=this.cmap.unicode)!=null?n.codeMap[e]:void 0)||0},t.prototype.widthOfGlyph=function(e){var n;return n=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*n},t.prototype.widthOfString=function(e,n,r){var i,a,o,l;for(o=0,a=0,l=(e=""+e).length;0<=l?a<l:a>l;a=0<=l?++a:--a)i=e.charCodeAt(a),o+=this.widthOfGlyph(this.characterToGlyph(i))+r*(1e3/n)||0;return o*(n/1e3)},t.prototype.lineHeight=function(e,n){var r;return n==null&&(n=!1),r=n?this.lineGap:0,(this.ascender+r-this.decender)/1e3*e},t})();var ri,ua=(function(){function t(e){this.data=e??[],this.pos=0,this.length=this.data.length}return t.prototype.readByte=function(){return this.data[this.pos++]},t.prototype.writeByte=function(e){return this.data[this.pos++]=e},t.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},t.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},t.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},t.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},t.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},t.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},t.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},t.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},t.prototype.readString=function(e){var n,r;for(r=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)r[n]=String.fromCharCode(this.readByte());return r.join("")},t.prototype.writeString=function(e){var n,r,i;for(i=[],n=0,r=e.length;0<=r?n<r:n>r;n=0<=r?++n:--n)i.push(this.writeByte(e.charCodeAt(n)));return i},t.prototype.readShort=function(){return this.readInt16()},t.prototype.writeShort=function(e){return this.writeInt16(e)},t.prototype.readLongLong=function(){var e,n,r,i,a,o,l,c;return e=this.readByte(),n=this.readByte(),r=this.readByte(),i=this.readByte(),a=this.readByte(),o=this.readByte(),l=this.readByte(),c=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^n)+1099511627776*(255^r)+4294967296*(255^i)+16777216*(255^a)+65536*(255^o)+256*(255^l)+(255^c)+1):72057594037927940*e+281474976710656*n+1099511627776*r+4294967296*i+16777216*a+65536*o+256*l+c},t.prototype.writeLongLong=function(e){var n,r;return n=Math.floor(e/4294967296),r=4294967295&e,this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},t.prototype.readInt=function(){return this.readInt32()},t.prototype.writeInt=function(e){return this.writeInt32(e)},t.prototype.read=function(e){var n,r;for(n=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)n.push(this.readByte());return n},t.prototype.write=function(e){var n,r,i,a;for(a=[],r=0,i=e.length;r<i;r++)n=e[r],a.push(this.writeByte(n));return a},t})(),$y=(function(){var t;function e(n){var r,i,a;for(this.scalarType=n.readInt(),this.tableCount=n.readShort(),this.searchRange=n.readShort(),this.entrySelector=n.readShort(),this.rangeShift=n.readShort(),this.tables={},i=0,a=this.tableCount;0<=a?i<a:i>a;i=0<=a?++i:--i)r={tag:n.readString(4),checksum:n.readInt(),offset:n.readInt(),length:n.readInt()},this.tables[r.tag]=r}return e.prototype.encode=function(n){var r,i,a,o,l,c,d,h,g,b,p,y,w;for(w in p=Object.keys(n).length,c=Math.log(2),g=16*Math.floor(Math.log(p)/c),o=Math.floor(g/c),h=16*p-g,(i=new ua).writeInt(this.scalarType),i.writeShort(p),i.writeShort(g),i.writeShort(o),i.writeShort(h),a=16*p,d=i.pos+a,l=null,y=[],n)for(b=n[w],i.writeString(w),i.writeInt(t(b)),i.writeInt(d),i.writeInt(b.length),y=y.concat(b),w==="head"&&(l=d),d+=b.length;d%4;)y.push(0),d++;return i.write(y),r=2981146554-t(i.data),i.pos=l+8,i.writeUInt32(r),i.data},t=function(n){var r,i,a,o;for(n=hg.call(n);n.length%4;)n.push(0);for(a=new ua(n),i=0,r=0,o=n.length;r<o;r=r+=4)i+=a.readUInt32();return 4294967295&i},e})(),qy={}.hasOwnProperty,bi=function(t,e){for(var n in e)qy.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};ri=(function(){function t(e){var n;this.file=e,n=this.file.directory.tables[this.tag],this.exists=!!n,n&&(this.offset=n.offset,this.length=n.length,this.parse(this.file.contents))}return t.prototype.parse=function(){},t.prototype.encode=function(){},t.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},t})();var zy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="head",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},t.prototype.encode=function(e){var n;return(n=new ua).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(e),n.writeShort(this.glyphDataFormat),n.data},t})(),kp=(function(){function t(e,n){var r,i,a,o,l,c,d,h,g,b,p,y,w,S,x,C,P;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=n+e.readInt(),g=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(c=0;c<256;++c)this.codeMap[c]=e.readByte();break;case 4:for(p=e.readUInt16(),b=p/2,e.pos+=6,a=(function(){var L,U;for(U=[],c=L=0;0<=b?L<b:L>b;c=0<=b?++L:--L)U.push(e.readUInt16());return U})(),e.pos+=2,w=(function(){var L,U;for(U=[],c=L=0;0<=b?L<b:L>b;c=0<=b?++L:--L)U.push(e.readUInt16());return U})(),d=(function(){var L,U;for(U=[],c=L=0;0<=b?L<b:L>b;c=0<=b?++L:--L)U.push(e.readUInt16());return U})(),h=(function(){var L,U;for(U=[],c=L=0;0<=b?L<b:L>b;c=0<=b?++L:--L)U.push(e.readUInt16());return U})(),i=(this.length-e.pos+this.offset)/2,l=(function(){var L,U;for(U=[],c=L=0;0<=i?L<i:L>i;c=0<=i?++L:--L)U.push(e.readUInt16());return U})(),c=x=0,P=a.length;x<P;c=++x)for(S=a[c],r=C=y=w[c];y<=S?C<=S:C>=S;r=y<=S?++C:--C)h[c]===0?o=r+d[c]:(o=l[h[c]/2+(r-y)-(b-c)]||0)!==0&&(o+=d[c]),this.codeMap[r]=65535&o}e.pos=g}return t.encode=function(e,n){var r,i,a,o,l,c,d,h,g,b,p,y,w,S,x,C,P,L,U,ee,V,X,D,I,k,A,M,B,J,oe,ue,ae,fe,ke,pe,O,q,K,Y,Q,z,re,ce,ge,Ae,Pe;switch(B=new ua,o=Object.keys(e).sort(function(Te,Me){return Te-Me}),n){case"macroman":for(w=0,S=(function(){var Te=[];for(y=0;y<256;++y)Te.push(0);return Te})(),C={0:0},a={},J=0,fe=o.length;J<fe;J++)C[ce=e[i=o[J]]]==null&&(C[ce]=++w),a[i]={old:e[i],new:C[e[i]]},S[i]=C[e[i]];return B.writeUInt16(1),B.writeUInt16(0),B.writeUInt32(12),B.writeUInt16(0),B.writeUInt16(262),B.writeUInt16(0),B.write(S),{charMap:a,subtable:B.data,maxGlyphID:w+1};case"unicode":for(A=[],g=[],P=0,C={},r={},x=d=null,oe=0,ke=o.length;oe<ke;oe++)C[U=e[i=o[oe]]]==null&&(C[U]=++P),r[i]={old:U,new:C[U]},l=C[U]-i,x!=null&&l===d||(x&&g.push(x),A.push(i),d=l),x=i;for(x&&g.push(x),g.push(65535),A.push(65535),I=2*(D=A.length),X=2*Math.pow(Math.log(D)/Math.LN2,2),b=Math.log(X/2)/Math.LN2,V=2*D-X,c=[],ee=[],p=[],y=ue=0,pe=A.length;ue<pe;y=++ue){if(k=A[y],h=g[y],k===65535){c.push(0),ee.push(0);break}if(k-(M=r[k].new)>=32768)for(c.push(0),ee.push(2*(p.length+D-y)),i=ae=k;k<=h?ae<=h:ae>=h;i=k<=h?++ae:--ae)p.push(r[i].new);else c.push(M-k),ee.push(0)}for(B.writeUInt16(3),B.writeUInt16(1),B.writeUInt32(12),B.writeUInt16(4),B.writeUInt16(16+8*D+2*p.length),B.writeUInt16(0),B.writeUInt16(I),B.writeUInt16(X),B.writeUInt16(b),B.writeUInt16(V),z=0,O=g.length;z<O;z++)i=g[z],B.writeUInt16(i);for(B.writeUInt16(0),re=0,q=A.length;re<q;re++)i=A[re],B.writeUInt16(i);for(ge=0,K=c.length;ge<K;ge++)l=c[ge],B.writeUInt16(l);for(Ae=0,Y=ee.length;Ae<Y;Ae++)L=ee[Ae],B.writeUInt16(L);for(Pe=0,Q=p.length;Pe<Q;Pe++)w=p[Pe],B.writeUInt16(w);return{charMap:r,subtable:B.data,maxGlyphID:P+1}}},t})(),dg=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="cmap",t.prototype.parse=function(e){var n,r,i;for(e.pos=this.offset,this.version=e.readUInt16(),i=e.readUInt16(),this.tables=[],this.unicode=null,r=0;0<=i?r<i:r>i;r=0<=i?++r:--r)n=new kp(e,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},t.encode=function(e,n){var r,i;return n==null&&(n="macroman"),r=kp.encode(e,n),(i=new ua).writeUInt16(0),i.writeUInt16(1),r.table=i.data.concat(r.subtable),r},t})(),Hy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="hhea",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},t})(),Wy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="OS/2",t.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=(function(){var n,r;for(r=[],n=0;n<10;++n)r.push(e.readByte());return r})(),this.charRange=(function(){var n,r;for(r=[],n=0;n<4;++n)r.push(e.readInt());return r})(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=(function(){var n,r;for(r=[],n=0;n<2;n=++n)r.push(e.readInt());return r})(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},t})(),Gy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="post",t.prototype.parse=function(e){var n,r,i;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var a;for(r=e.readUInt16(),this.glyphNameIndex=[],a=0;0<=r?a<r:a>r;a=0<=r?++a:--a)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],i=[];e.pos<this.offset+this.length;)n=e.readByte(),i.push(this.names.push(e.readString(n)));return i;case 151552:return r=e.readUInt16(),this.offsets=e.read(r);case 262144:return this.map=(function(){var o,l,c;for(c=[],a=o=0,l=this.file.maxp.numGlyphs;0<=l?o<l:o>l;a=0<=l?++o:--o)c.push(e.readUInt32());return c}).call(this)}},t})(),Vy=function(t,e){this.raw=t,this.length=t.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},Ky=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="name",t.prototype.parse=function(e){var n,r,i,a,o,l,c,d,h,g,b;for(e.pos=this.offset,e.readShort(),n=e.readShort(),l=e.readShort(),r=[],a=0;0<=n?a<n:a>n;a=0<=n?++a:--a)r.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+l+e.readShort()});for(c={},a=h=0,g=r.length;h<g;a=++h)i=r[a],e.pos=i.offset,d=e.readString(i.length),o=new Vy(d,i),c[b=i.nameID]==null&&(c[b]=[]),c[i.nameID].push(o);this.strings=c,this.copyright=c[0],this.fontFamily=c[1],this.fontSubfamily=c[2],this.uniqueSubfamily=c[3],this.fontName=c[4],this.version=c[5];try{this.postscriptName=c[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=c[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=c[7],this.manufacturer=c[8],this.designer=c[9],this.description=c[10],this.vendorUrl=c[11],this.designerUrl=c[12],this.license=c[13],this.licenseUrl=c[14],this.preferredFamily=c[15],this.preferredSubfamily=c[17],this.compatibleFull=c[18],this.sampleText=c[19]},t})(),Jy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="maxp",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},t})(),Yy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="hmtx",t.prototype.parse=function(e){var n,r,i,a,o,l,c;for(e.pos=this.offset,this.metrics=[],n=0,l=this.file.hhea.numberOfMetrics;0<=l?n<l:n>l;n=0<=l?++n:--n)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(i=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var d,h;for(h=[],n=d=0;0<=i?d<i:d>i;n=0<=i?++d:--d)h.push(e.readInt16());return h})(),this.widths=(function(){var d,h,g,b;for(b=[],d=0,h=(g=this.metrics).length;d<h;d++)a=g[d],b.push(a.advance);return b}).call(this),r=this.widths[this.widths.length-1],c=[],n=o=0;0<=i?o<i:o>i;n=0<=i?++o:--o)c.push(this.widths.push(r));return c},t.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},t})(),hg=[].slice,Xy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(e){var n,r,i,a,o,l,c,d,h,g;return e in this.cache?this.cache[e]:(a=this.file.loca,n=this.file.contents,r=a.indexOf(e),(i=a.lengthOf(e))===0?this.cache[e]=null:(n.pos=this.offset+r,o=(l=new ua(n.read(i))).readShort(),d=l.readShort(),g=l.readShort(),c=l.readShort(),h=l.readShort(),this.cache[e]=o===-1?new Qy(l,d,g,c,h):new Zy(l,o,d,g,c,h),this.cache[e]))},t.prototype.encode=function(e,n,r){var i,a,o,l,c;for(o=[],a=[],l=0,c=n.length;l<c;l++)i=e[n[l]],a.push(o.length),i&&(o=o.concat(i.encode(r)));return a.push(o.length),{table:o,offsets:a}},t})(),Zy=(function(){function t(e,n,r,i,a,o){this.raw=e,this.numberOfContours=n,this.xMin=r,this.yMin=i,this.xMax=a,this.yMax=o,this.compound=!1}return t.prototype.encode=function(){return this.raw.data},t})(),Qy=(function(){function t(e,n,r,i,a){var o,l;for(this.raw=e,this.xMin=n,this.yMin=r,this.xMax=i,this.yMax=a,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],o=this.raw;l=o.readShort(),this.glyphOffsets.push(o.pos),this.glyphIDs.push(o.readUInt16()),32&l;)o.pos+=1&l?4:2,128&l?o.pos+=8:64&l?o.pos+=4:8&l&&(o.pos+=2)}return t.prototype.encode=function(){var e,n,r;for(n=new ua(hg.call(this.raw.data)),e=0,r=this.glyphIDs.length;e<r;++e)n.pos=this.glyphOffsets[e];return n.data},t})(),e_=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="loca",t.prototype.parse=function(e){var n,r;return e.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var i,a;for(a=[],r=0,i=this.length;r<i;r+=2)a.push(2*e.readUInt16());return a}).call(this):(function(){var i,a;for(a=[],r=0,i=this.length;r<i;r+=4)a.push(e.readUInt32());return a}).call(this)},t.prototype.indexOf=function(e){return this.offsets[e]},t.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},t.prototype.encode=function(e,n){for(var r=new Uint32Array(this.offsets.length),i=0,a=0,o=0;o<r.length;++o)if(r[o]=i,a<n.length&&n[a]==o){++a,r[o]=i;var l=this.offsets[o],c=this.offsets[o+1]-l;c>0&&(i+=c)}for(var d=new Array(4*r.length),h=0;h<r.length;++h)d[4*h+3]=255&r[h],d[4*h+2]=(65280&r[h])>>8,d[4*h+1]=(16711680&r[h])>>16,d[4*h]=(4278190080&r[h])>>24;return d},t})(),t_=(function(){function t(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return t.prototype.generateCmap=function(){var e,n,r,i,a;for(n in i=this.font.cmap.tables[0].codeMap,e={},a=this.subset)r=a[n],e[n]=i[r];return e},t.prototype.glyphsFor=function(e){var n,r,i,a,o,l,c;for(i={},o=0,l=e.length;o<l;o++)i[a=e[o]]=this.font.glyf.glyphFor(a);for(a in n=[],i)(r=i[a])!=null&&r.compound&&n.push.apply(n,r.glyphIDs);if(n.length>0)for(a in c=this.glyphsFor(n))r=c[a],i[a]=r;return i},t.prototype.encode=function(e,n){var r,i,a,o,l,c,d,h,g,b,p,y,w,S,x;for(i in r=dg.encode(this.generateCmap(),"unicode"),o=this.glyphsFor(e),p={0:0},x=r.charMap)p[(c=x[i]).old]=c.new;for(y in b=r.maxGlyphID,o)y in p||(p[y]=b++);return h=(function(C){var P,L;for(P in L={},C)L[C[P]]=P;return L})(p),g=Object.keys(h).sort(function(C,P){return C-P}),w=(function(){var C,P,L;for(L=[],C=0,P=g.length;C<P;C++)l=g[C],L.push(h[l]);return L})(),a=this.font.glyf.encode(o,w,p),d=this.font.loca.encode(a.offsets,w),S={cmap:this.font.cmap.raw(),glyf:a.table,loca:d,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(n)},this.font.os2.exists&&(S["OS/2"]=this.font.os2.raw()),this.font.directory.encode(S)},t})();Xe.API.PDFObject=(function(){var t;function e(){}return t=function(n,r){return(Array(r+1).join("0")+n).slice(-r)},e.convert=function(n){var r,i,a,o;if(Array.isArray(n))return"["+(function(){var l,c,d;for(d=[],l=0,c=n.length;l<c;l++)r=n[l],d.push(e.convert(r));return d})().join(" ")+"]";if(typeof n=="string")return"/"+n;if(n!=null&&n.isString)return"("+n+")";if(n instanceof Date)return"(D:"+t(n.getUTCFullYear(),4)+t(n.getUTCMonth(),2)+t(n.getUTCDate(),2)+t(n.getUTCHours(),2)+t(n.getUTCMinutes(),2)+t(n.getUTCSeconds(),2)+"Z)";if({}.toString.call(n)==="[object Object]"){for(i in a=["<<"],n)o=n[i],a.push("/"+i+" "+e.convert(o));return a.push(">>"),a.join(`
`)}return""+n},e})();const Zr=[26,92,107],n_=[240,247,248],Ur=[0,0,0],mi=[100,100,100],Np=[200,200,200],r_=[248,249,250],Ep=[255,255,255];function aa(t){return(parseFloat(t)||0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})+" "}function Nu(t){return t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):""}function Lp(t,e,n,r){const i=new Xe("p","mm","a4"),a=210,o=25,l=25,c=a-o-l,d=n||{},h=d.company_name||"BECK360",g=d.owner_name||"Eugen Beck",b=d.address_line1||"Eichenweg 1",p=d.address_zip||"76275",y=d.address_city||"Ettlingen",w=d.phone||"0173-4682501",S=d.email||"rundgang@beck360.de",x=d.website||"www.beck360.de",C=d.tax_id||"31205/27003",P=d.vat_id||"DE321274049",L=d.bank_name||"VR Bank Suedpfalz",U=d.bank_iban||"DE92 5486 2500 0001 1389 95",ee=d.bank_bic||"GEN0DE61SUW",V=d.payment_reference_note||"Bitte verwenden Sie die Rechnungsnummer als Verwendungszweck.",X=d.default_invoice_intro||"Vielen Dank fuer Ihren Auftrag. Ich berechne Ihnen fuer folgende Leistungen:",D=d.default_quote_intro||"Vielen Dank fuer Ihr Interesse. Gerne unterbreite ich Ihnen folgendes Angebot:",I=t.type==="quote",k=I?"ANGEBOT":"RECHNUNG",A=I?"Angebotsnr.":"Rechnungsnr.",M=I?"Angebotsdatum":"Rechnungsdatum",B=I?"Gueltig bis":"Faellig am";i.setFillColor(...Zr),i.rect(0,0,a,4,"F");let J=16;i.setFont("helvetica","bold"),i.setFontSize(18),i.setTextColor(...Zr),i.text("Beck360",o,J),i.setFontSize(22),i.setTextColor(...Ur),i.text(k,a-l,J,{align:"right"}),J+=14,i.setFontSize(7),i.setTextColor(...mi),i.setFont("helvetica","normal");const oe=`${h}  ${g}  ${b}  ${p} ${y}`;i.text(oe,o,J);const ue=i.getTextWidth(oe);i.setDrawColor(...Np),i.setLineWidth(.2),i.line(o,J+1,o+ue,J+1),J+=8;const ae=J;i.setFontSize(10),i.setTextColor(...Ur),t.customer_company&&(i.setFont("helvetica","bold"),i.text(t.customer_company,o,J),J+=5),t.customer_name&&(i.setFont("helvetica",t.customer_company?"normal":"bold"),i.text(t.customer_name,o,J),J+=5),i.setFont("helvetica","normal"),t.customer_street&&(i.text(t.customer_street,o,J),J+=5);const fe=`${t.customer_zip||""} ${t.customer_city||""}`.trim();fe&&(i.text(fe,o,J),J+=5);const ke=65,pe=a-l-ke,O=4,q=5.5,K=[[A,t.invoice_number],[M,Nu(t.invoice_date)]];t.due_date&&K.push([B,Nu(t.due_date)]),t.customer_number&&K.push(["Kundennr.",t.customer_number]),t.service_date&&K.push(["Leistungsdatum",Nu(t.service_date)]);const Y=O*2+K.length*q,Q=ae-2;i.setFillColor(...n_),i.roundedRect(pe,Q,ke,Y,1.5,1.5,"F"),i.setFillColor(...Zr),i.rect(pe,Q,1,Y,"F"),i.setFontSize(8.5);let z=Q+O+4;for(const[Ie,it]of K)i.setFont("helvetica","normal"),i.setTextColor(...mi),i.text(Ie,pe+O+2,z),i.setFont("helvetica","bold"),i.setTextColor(...Ur),i.text(it||"",pe+ke-O,z,{align:"right"}),z+=q;J=Math.max(J,Q+Y+8),J+=4;const re=t.intro_text||(I?D:X);{i.setFont("helvetica","normal"),i.setFontSize(9.5),i.setTextColor(...Ur);const Ie=i.splitTextToSize(re,c);i.text(Ie,o,J),J+=Ie.length*4.5+6}const ce=o,ge=o+12,Ae=o+c*.58,Pe=o+c*.76,Te=a-l,Me=6,$=8;i.setFillColor(...Zr),i.rect(o,J,c,$,"F"),i.setFont("helvetica","bold"),i.setFontSize(8.5),i.setTextColor(...Ep);const Ce=J+5.5;i.text("Pos.",ce+2,Ce),i.text("Bezeichnung",ge,Ce),i.text("Menge",Ae,Ce,{align:"right"}),i.text("Einzelpreis",Pe,Ce,{align:"right"}),i.text("Gesamt",Te-2,Ce,{align:"right"}),J+=$,i.setFont("helvetica","normal"),i.setFontSize(9);for(let Ie=0;Ie<e.length;Ie++){const it=e[Ie];let nt=Me;it.sub_description&&(nt+=4.5),J+nt>245&&(Cl(i,a,o,l,h,g,b,p,y,w,S,x,C,P,U,ee,L),i.addPage(),i.setFillColor(...Zr),i.rect(0,0,a,4,"F"),J=16),Ie%2===1&&(i.setFillColor(...r_),i.rect(o,J,c,nt,"F"));const at=(parseFloat(it.quantity)||0)*(parseFloat(it.unit_price)||0),ut=parseFloat(it.quantity)%1===0?`${parseInt(it.quantity)} Stk.`:`${parseFloat(it.quantity).toLocaleString("de-DE")}`,pt=J+4.5;i.setTextColor(...Ur),i.setFont("helvetica","normal"),i.setFontSize(9),i.setTextColor(...mi),i.text(`${Ie+1}`,ce+2,pt),i.setTextColor(...Ur),i.text(it.description||"",ge,pt),i.text(ut,Ae,pt,{align:"right"}),i.text(aa(it.unit_price),Pe,pt,{align:"right"}),i.setFont("helvetica","bold"),i.text(aa(at),Te-2,pt,{align:"right"}),J+=Me,it.sub_description&&(i.setFont("helvetica","italic"),i.setFontSize(8),i.setTextColor(...mi),i.text(it.sub_description,ge,J+1),J+=4.5)}i.setDrawColor(...Zr),i.setLineWidth(.4),i.line(o,J,a-l,J),J+=10;const ht=75,He=a-l-ht,we=He+3,Ke=a-l-3;function Re(Ie,it,nt={}){if(nt.highlight){i.setFillColor(...Zr),i.roundedRect(He,J-4,ht,9,1,1,"F"),i.setFont("helvetica","bold"),i.setFontSize(10),i.setTextColor(...Ep),i.text(Ie,we,J+1),i.text(it,Ke,J+1,{align:"right"}),J+=10;return}i.setFont("helvetica",nt.bold?"bold":"normal"),nt.italic&&i.setFont("helvetica","italic"),i.setFontSize(nt.size||9),i.setTextColor(...nt.color||Ur),i.text(Ie,we,J),i.text(it,Ke,J,{align:"right"}),J+=nt.spacing||6}if(i.setDrawColor(...Np),i.setLineWidth(.2),Re("Zwischensumme",aa(t.subtotal)),parseFloat(t.discount_percent)>0){const Ie=parseFloat(t.subtotal)-parseFloat(t.net_amount);Re(`Rabatt (- ${t.discount_percent}%)`,`-${aa(Ie)}`,{color:mi})}if(Re("Nettobetrag",aa(t.net_amount)),Re(`${t.vat_rate} % MwSt.`,aa(t.vat_amount),{italic:!0,color:mi}),Re("Gesamtbetrag",aa(t.total_amount),{highlight:!0}),t.status==="paid"&&Re("Bezahlt",aa(t.paid_amount||t.total_amount),{bold:!0,size:10,color:[22,163,74]}),J+=4,t.payment_terms){J>245&&(Cl(i,a,o,l,h,g,b,p,y,w,S,x,C,P,U,ee,L),i.addPage(),i.setFillColor(...Zr),i.rect(0,0,a,4,"F"),J=16),i.setFont("helvetica","normal"),i.setFontSize(9),i.setTextColor(...Ur);const Ie=i.splitTextToSize(t.payment_terms,c);i.text(Ie,o,J),J+=Ie.length*4.5+3}if(!I&&V&&(i.setFont("helvetica","normal"),i.setFontSize(8.5),i.setTextColor(...mi),i.text(V,o,J),J+=8),t.closing_message){J>250&&(Cl(i,a,o,l,h,g,b,p,y,w,S,x,C,P,U,ee,L),i.addPage(),i.setFillColor(...Zr),i.rect(0,0,a,4,"F"),J=16),i.setFont("helvetica","normal"),i.setFontSize(9),i.setTextColor(...Ur);const Ie=i.splitTextToSize(t.closing_message,c);i.text(Ie,o,J),J+=Ie.length*4.5}if(Cl(i,a,o,l,h,g,b,p,y,w,S,x,C,P,U,ee,L),r!=null&&r.preview){const Ie=i.output("blob"),it=URL.createObjectURL(Ie);window.open(it,"_blank");return}const Qe=`${t.invoice_number}.pdf`;i.save(Qe)}function Cl(t,e,n,r,i,a,o,l,c,d,h,g,b,p,y,w,S){t.setDrawColor(...Zr),t.setLineWidth(.3),t.line(n,268,e-r,268),t.setFontSize(7);const C=n;t.setFont("helvetica","bold"),t.setTextColor(...Zr),t.text(i,C,272),t.setTextColor(...Ur),t.text(a,C,272+3.5),t.setFont("helvetica","normal"),t.setTextColor(...mi),t.text(o,C,279),t.text(`${l} ${c}`,C,272+10.5),t.text(g,C,286),t.text(`St.-Nr.: ${b}`,C,272+17.5);const P=n+55;t.setFont("helvetica","bold"),t.setTextColor(...Ur),t.text("Kontakt",P,272),t.setFont("helvetica","normal"),t.setTextColor(...mi),t.text(`Tel.: ${d}`,P,272+3.5),t.text(`E-Mail: ${h}`,P,279),t.text(`USt-IdNr.: ${p}`,P,272+10.5);const L=n+110;t.setFont("helvetica","bold"),t.setTextColor(...Ur),t.text("Bankverbindung",L,272),t.setFont("helvetica","normal"),t.setTextColor(...mi),t.text(S,L,272+3.5),t.text(`IBAN: ${y}`,L,279),t.text(`BIC: ${w}`,L,272+10.5)}function i_({id:t}){var S,x,C,P,L,U,ee;const{invoice:e,items:n,loading:r,update:i}=pm(t),{settings:a}=ic(),o=Qn();if(r)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Rechnung"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(At,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/invoices"),children:""}),s("h1",{class:"page-title",children:"Nicht gefunden"})]})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Dokument nicht gefunden"})})})]});const l=e.type==="quote",c=((S=As[e.type])==null?void 0:S.label)||"Dokument";async function d(){const{error:V}=await i({status:"sent"});V?o.error("Fehler"):o.success("Als versendet markiert")}async function h(){const{error:V}=await i({status:"paid",paid_date:new Date().toISOString().slice(0,10),paid_amount:e.total_amount});V?o.error("Fehler"):o.success("Als bezahlt markiert")}async function g(){const{data:V,error:X}=await a2(t);X?o.error("Fehler: "+X.message):(o.success("In Rechnung umgewandelt"),ze(`/crm/invoices/${V.id}`))}async function b(){if(!confirm(`${c} "${e.invoice_number}" wirklich loeschen?`))return;const{error:V}=await mm(t);V?o.error("Fehler"):(o.success("Geloescht"),ze("/crm/invoices"))}function p(){Lp(e,n,a)}function y(){Lp(e,n,a,{preview:!0})}function w(){ze(`/crm/invoices/new?edit=${t}`)}return s(At,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/invoices"),children:""}),s("h1",{class:"page-title",children:e.invoice_number}),s("span",{class:"stage-badge",style:`color:${(x=Zn[e.status])==null?void 0:x.color};background:${(C=Zn[e.status])==null?void 0:C.color}20`,children:(P=Zn[e.status])==null?void 0:P.label})]}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:y,children:"Vorschau"}),s("button",{class:"btn btn-primary btn-sm",onClick:p,children:"PDF herunterladen"}),e.status==="draft"&&s(At,{children:[s("button",{class:"btn btn-secondary btn-sm",onClick:w,children:"Bearbeiten"}),s("button",{class:"btn btn-secondary btn-sm",onClick:d,children:"Als versendet markieren"}),l&&s("button",{class:"btn btn-primary btn-sm",onClick:g,children:"In Rechnung umwandeln"}),s("button",{class:"btn btn-danger btn-sm",onClick:b,children:"Loeschen"})]}),e.status==="sent"&&!l&&s("button",{class:"btn btn-primary btn-sm",onClick:h,children:"Als bezahlt markieren"})]})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:c})}),s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:l?"Angebotsnr.":"Rechnungsnr."}),s("span",{class:"detail-value",children:e.invoice_number})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Typ"}),s("span",{class:"detail-value",children:c})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Datum"}),s("span",{class:"detail-value",children:jn(e.invoice_date)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:l?"Gueltig bis":"Faellig am"}),s("span",{class:"detail-value",children:jn(e.due_date)})]}),e.paid_date&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Bezahlt am"}),s("span",{class:"detail-value",children:jn(e.paid_date)})]}),e.converted_from_quote_id&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt aus Angebot"}),s("span",{class:"detail-value",children:s("a",{href:"#",onClick:V=>{V.preventDefault(),ze(`/crm/invoices/${e.converted_from_quote_id}`)},children:"Angebot anzeigen"})})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Kunde"})}),s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Firma"}),s("span",{class:"detail-value",children:e.company_id?s("a",{href:"#",onClick:V=>{V.preventDefault(),ze(`/crm/companies/${e.company_id}`)},children:e.customer_company||""}):e.customer_company||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Ansprechpartner"}),s("span",{class:"detail-value",children:e.customer_name||""})]}),s("div",{class:"detail-field form-group-full",children:[s("span",{class:"detail-label",children:"Adresse"}),s("span",{class:"detail-value",children:[e.customer_street,`${e.customer_zip||""} ${e.customer_city||""}`.trim()].filter(Boolean).join(", ")||""})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Positionen"})}),s("div",{class:"table-wrapper",children:s("table",{class:"line-items-table",children:[s("thead",{children:s("tr",{children:[s("th",{children:"Bezeichnung"}),s("th",{style:"text-align:right",children:"Menge"}),s("th",{style:"text-align:right",children:"Einzelpreis"}),s("th",{style:"text-align:right",children:"Gesamt"})]})}),s("tbody",{children:n.map(V=>s("tr",{children:[s("td",{"data-label":"Bezeichnung",children:[s("div",{children:V.description}),V.sub_description&&s("div",{style:"font-size:0.8rem;color:var(--text-muted)",children:V.sub_description})]}),s("td",{"data-label":"Menge",children:V.quantity}),s("td",{"data-label":"Einzelpreis",children:je(V.unit_price)}),s("td",{"data-label":"Gesamt",style:"font-weight:500",children:je(V.total)})]},V.id))})]})}),s("div",{class:"invoice-totals",style:"margin-top:1rem",children:[s("div",{class:"invoice-totals-row",children:[s("span",{children:"Zwischensumme"}),s("span",{children:je(e.subtotal)})]}),parseFloat(e.discount_percent)>0&&s("div",{class:"invoice-totals-row",children:[s("span",{children:["Rabatt (-",e.discount_percent,"%)"]}),s("span",{children:["-",je(e.subtotal-e.net_amount)]})]}),s("div",{class:"invoice-totals-row",children:[s("span",{children:"Nettobetrag"}),s("span",{children:je(e.net_amount)})]}),s("div",{class:"invoice-totals-row",children:[s("span",{children:[e.vat_rate,"% MwSt."]}),s("span",{children:je(e.vat_amount)})]}),s("div",{class:"invoice-totals-row",style:"font-weight:700;font-size:1.1rem;border-top:2px solid var(--border);padding-top:0.5rem",children:[s("span",{children:"Gesamtbetrag"}),s("span",{children:je(e.total_amount)})]}),e.status==="paid"&&s("div",{class:"invoice-totals-row",style:"font-weight:700;color:var(--success)",children:[s("span",{children:"Bezahlt"}),s("span",{children:je(e.paid_amount)})]})]})]}),(e.payment_terms||e.closing_message)&&s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Texte"})}),e.payment_terms&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Zahlungsbedingungen"}),s("span",{class:"detail-value",style:"white-space:pre-wrap",children:e.payment_terms})]}),e.closing_message&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Schlussnachricht"}),s("span",{class:"detail-value",style:"white-space:pre-wrap",children:e.closing_message})]})]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Status"}),s("span",{class:"detail-value",children:s("span",{class:"stage-badge",style:`color:${(L=Zn[e.status])==null?void 0:L.color};background:${(U=Zn[e.status])==null?void 0:U.color}20`,children:(ee=Zn[e.status])==null?void 0:ee.label})})]}),e.deal_id&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Deal"}),s("span",{class:"detail-value",children:s("a",{href:"#",onClick:V=>{V.preventDefault(),ze(`/crm/deals/${e.deal_id}`)},children:"Deal anzeigen"})})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:jn(e.created_at)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Aktualisiert"}),s("span",{class:"detail-value",children:jn(e.updated_at)})]}),e.notes&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Interne Notizen"}),s("span",{class:"detail-value",style:"white-space:pre-wrap;font-size:0.8rem",children:e.notes})]})]})})]})})]})}function a_({month:t=null,year:e=null,category:n=null}={}){const[r,i]=me([]),[a,o]=me(!0),l=Nt(async()=>{o(!0);let c=Le.from("expenses").select("*").is("deleted_at",null).order("date",{ascending:!1});if(e&&(c=c.gte("date",`${e}-01-01`).lte("date",`${e}-12-31`)),t){const g=String(t).padStart(2,"0"),b=e||new Date().getFullYear();c=c.gte("date",`${b}-${g}-01`).lte("date",`${b}-${g}-31`)}n&&(c=c.eq("category",n));const{data:d,error:h}=await c;h||i(d||[]),o(!1)},[t,e,n]);return Mt(()=>{l()},[l]),{expenses:r,loading:a,refetch:l}}function s_(t){const[e,n]=me(null),[r,i]=me(!0),a=Nt(async()=>{if(!t)return;i(!0);const{data:o}=await Le.from("expenses").select("*").eq("id",t).single();n(o),i(!1)},[t]);return Mt(()=>{a()},[a]),{expense:e,loading:r,refetch:a}}async function o_(t){const{data:e}=await Le.auth.getUser(),n=e.user.id,{data:r,error:i}=await Le.from("expenses").insert({...t,owner_id:n}).select().single();return{data:r,error:i}}async function l_(t,e){const{error:n}=await Le.from("expenses").update({...e,updated_at:new Date().toISOString()}).eq("id",t);return{error:n}}async function c_(t){const{error:e}=await Le.from("expenses").update({deleted_at:new Date().toISOString()}).eq("id",t);return{error:e}}function u_(){const t=new Date,[e,n]=me(t.getFullYear()),[r,i]=me(null),[a,o]=me(null),{expenses:l,loading:c}=a_({year:e,month:r,category:a}),d=l.reduce((p,y)=>p+(parseFloat(y.amount)||0),0),h=l.reduce((p,y)=>p+(parseFloat(y.amount)||0),0),g=l.length,b=[];for(let p=t.getFullYear();p>=t.getFullYear()-5;p--)b.push(p);return s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Ausgaben"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze("/crm/expenses/new"),children:"+ Ausgabe"})]}),s("div",{class:"page-body",children:[s("div",{class:"search-bar",style:"flex-wrap:wrap;gap:0.75rem",children:[s("select",{value:e,onChange:p=>n(parseInt(p.target.value)),style:"width:auto",children:b.map(p=>s("option",{value:p,children:p},p))}),s("select",{value:r||"",onChange:p=>i(p.target.value?parseInt(p.target.value):null),style:"width:auto",children:[s("option",{value:"",children:"Alle Monate"}),Gl.map((p,y)=>s("option",{value:y+1,children:p},y))]}),s("div",{class:"filter-pills",children:[s("button",{class:`filter-pill ${a?"":"active"}`,onClick:()=>o(null),children:"Alle"}),Object.entries(Wl).map(([p,y])=>s("button",{class:`filter-pill ${a===p?"active":""}`,onClick:()=>o(a===p?null:p),children:y},p))]})]}),s("div",{class:"grid-3",style:"margin-bottom:1.5rem",children:[s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:["Ausgaben ",r?Gl[r-1]:"Zeitraum"]}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#ef4444",children:je(d)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:["Ausgaben ",e]}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#ef4444",children:je(h)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Anzahl Belege"}),s("div",{style:"font-size:1.5rem;font-weight:700",children:g})]})]}),c?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):l.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Ausgaben gefunden"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Datum"}),s("th",{children:"Kategorie"}),s("th",{children:"Beschreibung"}),s("th",{children:"Lieferant"}),s("th",{style:"text-align:right",children:"Betrag"})]})}),s("tbody",{children:l.map(p=>s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/expenses/new?edit=${p.id}`),children:[s("td",{"data-label":"Datum",children:jn(p.date)}),s("td",{"data-label":"Kategorie",children:s("span",{style:"font-size:0.75rem;padding:0.15rem 0.5rem;border-radius:999px;background:rgba(239,68,68,0.12);color:#ef4444",children:Wl[p.category]||p.category})}),s("td",{"data-label":"Beschreibung",children:p.description}),s("td",{"data-label":"Lieferant",children:p.vendor||""}),s("td",{"data-label":"Betrag",style:"text-align:right;font-weight:600",children:je(p.amount)})]},p.id))})]})})})]})]})}function d_(){const t=Qn(),n=new URLSearchParams(window.location.search).get("edit"),{expense:r,loading:i}=s_(n),[a,o]=me(!1),[l,c]=me({date:new Date().toISOString().slice(0,10),category:"other",description:"",amount:"",vat_rate:19,vendor:"",receipt_ref:"",payment_method:"bank_transfer",notes:""});Mt(()=>{!n||i||!r||c({date:r.date||"",category:r.category||"other",description:r.description||"",amount:r.amount||"",vat_rate:r.vat_rate!=null?r.vat_rate:19,vendor:r.vendor||"",receipt_ref:r.receipt_ref||"",payment_method:r.payment_method||"bank_transfer",notes:r.notes||""})},[n,i,r]);const d=parseFloat(l.amount)||0,h=parseFloat(l.vat_rate)||0,g=h>0?d/(1+h/100):d,b=d-g;async function p(w){if(w.preventDefault(),!l.description||!l.amount){t.error("Beschreibung und Betrag sind Pflichtfelder");return}o(!0);const S={date:l.date,category:l.category,description:l.description,amount:parseFloat(l.amount)||0,net_amount:Math.round(g*100)/100,vat_amount:Math.round(b*100)/100,vat_rate:parseFloat(l.vat_rate)||0,vendor:l.vendor||null,receipt_ref:l.receipt_ref||null,payment_method:l.payment_method,notes:l.notes||null};let x;n?(x=await l_(n,S),x.error||(t.success("Ausgabe gespeichert"),ze("/crm/expenses"))):(x=await o_(S),x.error||(t.success("Ausgabe erstellt"),ze("/crm/expenses"))),x.error&&t.error("Fehler: "+x.error.message),o(!1)}async function y(){if(!confirm("Ausgabe wirklich loeschen?"))return;const{error:w}=await c_(n);w?t.error("Fehler: "+w.message):(t.success("Ausgabe geloescht"),ze("/crm/expenses"))}return n&&i?s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Laden..."})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]}):s(At,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/expenses"),children:""}),s("h1",{class:"page-title",children:n?"Ausgabe bearbeiten":"Neue Ausgabe"})]}),n&&s("button",{class:"btn btn-danger btn-sm",onClick:y,children:"Loeschen"})]}),s("div",{class:"page-body",children:s("form",{onSubmit:p,style:"max-width:640px",children:[s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Ausgabe"})}),s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Datum"}),s("input",{type:"date",value:l.date,onInput:w=>c({...l,date:w.target.value}),required:!0})]}),s("div",{class:"form-group",children:[s("label",{children:"Kategorie"}),s("select",{value:l.category,onChange:w=>c({...l,category:w.target.value}),children:Object.entries(Wl).map(([w,S])=>s("option",{value:w,children:S},w))})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Beschreibung"}),s("input",{value:l.description,onInput:w=>c({...l,description:w.target.value}),required:!0,placeholder:"z.B. Matterport-Lizenz, Bueroeinrichtung..."})]}),s("div",{class:"form-group",children:[s("label",{children:"Betrag brutto"}),s("input",{type:"number",step:"0.01",min:"0",value:l.amount,onInput:w=>c({...l,amount:w.target.value}),required:!0,style:"text-align:right"})]}),s("div",{class:"form-group",children:[s("label",{children:"MwSt-Satz (%)"}),s("input",{type:"number",step:"0.01",min:"0",value:l.vat_rate,onInput:w=>c({...l,vat_rate:w.target.value}),style:"max-width:100px;text-align:right"})]}),s("div",{class:"form-group",children:[s("label",{children:"Lieferant"}),s("input",{value:l.vendor,onInput:w=>c({...l,vendor:w.target.value}),placeholder:"Optional"})]}),s("div",{class:"form-group",children:[s("label",{children:"Belegnummer"}),s("input",{value:l.receipt_ref,onInput:w=>c({...l,receipt_ref:w.target.value}),placeholder:"Optional"})]}),s("div",{class:"form-group",children:[s("label",{children:"Zahlungsart"}),s("select",{value:l.payment_method,onChange:w=>c({...l,payment_method:w.target.value}),children:Object.entries(c2).map(([w,S])=>s("option",{value:w,children:S},w))})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Notizen"}),s("textarea",{value:l.notes,onInput:w=>c({...l,notes:w.target.value}),placeholder:"Optional"})]})]}),d>0&&s("div",{style:"margin-top:1rem;padding:1rem;background:var(--bg-secondary);border-radius:8px",children:[s("div",{style:"display:flex;justify-content:space-between;font-size:0.85rem;margin-bottom:0.25rem",children:[s("span",{children:"Nettobetrag"}),s("span",{children:je(g)})]}),s("div",{style:"display:flex;justify-content:space-between;font-size:0.85rem;margin-bottom:0.25rem",children:[s("span",{children:[l.vat_rate,"% MwSt."]}),s("span",{children:je(b)})]}),s("div",{style:"display:flex;justify-content:space-between;font-size:0.95rem;font-weight:700;border-top:1px solid var(--border);padding-top:0.5rem;margin-top:0.25rem",children:[s("span",{children:"Bruttobetrag"}),s("span",{children:je(d)})]})]})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>ze("/crm/expenses"),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",disabled:a,children:a?"Speichern...":n?"Speichern":"Erstellen"})]})]})})]})}function h_({year:t}={}){const[e,n]=me(null),[r,i]=me([]),[a,o]=me([]),[l,c]=me({}),[d,h]=me(!0),g=Nt(async()=>{if(!t)return;h(!0);const b=`${t}-01-01`,p=`${t}-12-31`,[{data:y},{data:w},{data:S}]=await Promise.all([Le.from("invoices").select("total_amount, net_amount, vat_amount, paid_date").eq("type","invoice").eq("status","paid").gte("paid_date",b).lte("paid_date",p),Le.from("invoices").select("total_amount").eq("type","invoice").in("status",["sent","overdue"]),Le.from("expenses").select("date, category, amount, net_amount, vat_amount").is("deleted_at",null).gte("date",b).lte("date",p)]),x=y||[],C=S||[],P=Array.from({length:12},(M,B)=>{const J=B+1,oe=String(J).padStart(2,"0"),ue=`${t}-${oe}`,ae=x.filter(Q=>Q.paid_date&&Q.paid_date.startsWith(ue)),fe=C.filter(Q=>Q.date&&Q.date.startsWith(ue)),ke=ae.reduce((Q,z)=>Q+(parseFloat(z.total_amount)||0),0),pe=ae.reduce((Q,z)=>Q+(parseFloat(z.net_amount)||0),0),O=ae.reduce((Q,z)=>Q+(parseFloat(z.vat_amount)||0),0),q=fe.reduce((Q,z)=>Q+(parseFloat(z.amount)||0),0),K=fe.reduce((Q,z)=>Q+(parseFloat(z.net_amount)||0),0),Y=fe.reduce((Q,z)=>Q+(parseFloat(z.vat_amount)||0),0);return{month:J,incomeBrutto:ke,incomeNetto:pe,vatCollected:O,expensesBrutto:q,expensesNetto:K,vatPaid:Y,profit:pe-K}});i(P);const L=[0,1,2,3].map(M=>{const B=P.slice(M*3,M*3+3);return{quarter:M+1,incomeBrutto:B.reduce((J,oe)=>J+oe.incomeBrutto,0),incomeNetto:B.reduce((J,oe)=>J+oe.incomeNetto,0),vatCollected:B.reduce((J,oe)=>J+oe.vatCollected,0),expensesBrutto:B.reduce((J,oe)=>J+oe.expensesBrutto,0),expensesNetto:B.reduce((J,oe)=>J+oe.expensesNetto,0),vatPaid:B.reduce((J,oe)=>J+oe.vatPaid,0),profit:B.reduce((J,oe)=>J+oe.profit,0)}});o(L);const U={};C.forEach(M=>{const B=M.category||"other";U[B]=(U[B]||0)+(parseFloat(M.amount)||0)}),c(U);const ee=x.reduce((M,B)=>M+(parseFloat(B.total_amount)||0),0),V=x.reduce((M,B)=>M+(parseFloat(B.net_amount)||0),0),X=C.reduce((M,B)=>M+(parseFloat(B.amount)||0),0),D=C.reduce((M,B)=>M+(parseFloat(B.net_amount)||0),0),I=x.reduce((M,B)=>M+(parseFloat(B.vat_amount)||0),0),k=C.reduce((M,B)=>M+(parseFloat(B.vat_amount)||0),0),A=(w||[]).reduce((M,B)=>M+(parseFloat(B.total_amount)||0),0);n({yearRevenue:ee,yearRevenueNetto:V,yearExpenses:X,yearExpensesNetto:D,yearProfit:V-D,openInvoices:A,vatCollected:I,vatPaid:k,vatPayable:I-k}),h(!1)},[t]);return Mt(()=>{g()},[g]),{stats:e,monthlyData:r,quarterlyData:a,expensesByCategory:l,loading:d,refetch:g}}const Eu=[26,92,107],oo=[0,0,0],Lu=[100,100,100],Cp=[200,200,200];function Jr(t){return(parseFloat(t)||0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})+" "}const f_=["Januar","Februar","Maerz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"];function p_({year:t,monthlyData:e,quarterlyData:n,stats:r,settings:i}){const a=new Xe("p","mm","a4"),o=210,l=25,c=25,d=i||{},h=d.company_name||"BECK360",g=d.owner_name||"Eugen Beck",b=d.address_line1||"Eichenweg 1",p=d.address_zip||"76275",y=d.address_city||"Ettlingen",w=d.phone||"0173-4682501",S=d.email||"rundgang@beck360.de",x=d.website||"www.beck360.de",C=d.tax_id||"31205/27003",P=d.vat_id||"DE321274049",L=d.bank_name||"VR Bank Suedpfalz",U=d.bank_iban||"DE92 5486 2500 0001 1389 95",ee=d.bank_bic||"GEN0DE61SUW";let V=20;a.setFont("helvetica","bold"),a.setFontSize(18),a.setTextColor(...Eu),a.text("Beck360",l,V),a.setFontSize(16),a.setTextColor(...oo),a.text("EINNAHMEN-UEBERSCHUSS-RECHNUNG",o-c,V,{align:"right"}),V+=8,a.setFontSize(12),a.setTextColor(...Lu),a.text(`Geschaeftsjahr ${t}`,o-c,V,{align:"right"}),V+=5,a.setFontSize(7),a.setTextColor(...Lu);const X=`${h} - ${g} - ${b} - ${p} ${y}`;a.text(X,l,V);const D=a.getTextWidth(X);a.setDrawColor(...Lu),a.setLineWidth(.2),a.line(l,V+.5,l+D,V+.5),V+=12,a.setFont("helvetica","bold"),a.setFontSize(11),a.setTextColor(...Eu),a.text("Monatsuebersicht",l,V),V+=6;const I=[{label:"Monat",x:l,align:"left",w:28},{label:"Einnahmen",x:l+30,align:"right"},{label:"Ausg. netto",x:l+58,align:"right"},{label:"MwSt erh.",x:l+84,align:"right"},{label:"MwSt gez.",x:l+108,align:"right"},{label:"Gewinn",x:l+136,align:"right"}];a.setFont("helvetica","bold"),a.setFontSize(7.5),a.setTextColor(...oo),a.setDrawColor(...oo),a.setLineWidth(.3),a.line(l,V,o-c,V),V+=4,I.forEach(ue=>{const ae=ue.align==="right"?{align:"right"}:{};a.text(ue.label,ue.x,V,ae)}),V+=2,a.line(l,V,o-c,V),V+=4,a.setFont("helvetica","normal"),a.setFontSize(7.5);const k={incomeNetto:0,expensesNetto:0,vatCollected:0,vatPaid:0,profit:0};e.forEach(ue=>{a.text(f_[ue.month-1],I[0].x,V),a.text(Jr(ue.incomeNetto),I[1].x,V,{align:"right"}),a.text(Jr(ue.expensesNetto),I[2].x,V,{align:"right"}),a.text(Jr(ue.vatCollected),I[3].x,V,{align:"right"}),a.text(Jr(ue.vatPaid),I[4].x,V,{align:"right"}),a.text(Jr(ue.profit),I[5].x,V,{align:"right"}),k.incomeNetto+=ue.incomeNetto,k.expensesNetto+=ue.expensesNetto,k.vatCollected+=ue.vatCollected,k.vatPaid+=ue.vatPaid,k.profit+=ue.profit,V+=4.5}),a.line(l,V-1,o-c,V-1),V+=2,a.setFont("helvetica","bold"),a.text("Summe",I[0].x,V),a.text(Jr(k.incomeNetto),I[1].x,V,{align:"right"}),a.text(Jr(k.expensesNetto),I[2].x,V,{align:"right"}),a.text(Jr(k.vatCollected),I[3].x,V,{align:"right"}),a.text(Jr(k.vatPaid),I[4].x,V,{align:"right"}),a.text(Jr(k.profit),I[5].x,V,{align:"right"}),V+=3,a.line(l,V,o-c,V),V+=15,a.setFont("helvetica","bold"),a.setFontSize(11),a.setTextColor(...Eu),a.text("EUER-Zusammenfassung",l,V),V+=8,a.setFontSize(9),a.setTextColor(...oo);function A(ue,ae,fe={}){fe.bold?a.setFont("helvetica","bold"):a.setFont("helvetica","normal"),a.text(ue,l,V),a.text(Jr(ae),o-c,V,{align:"right"}),V+=fe.spacing||6}A("Betriebseinnahmen (netto)",r.yearRevenueNetto),A("Betriebsausgaben (netto)",r.yearExpensesNetto),a.setDrawColor(...Cp),a.setLineWidth(.3),a.line(l,V-2,o-c,V-2),A("Gewinn vor Steuern",r.yearProfit,{bold:!0,spacing:10}),A("MwSt. erhalten",r.vatCollected),A("MwSt. gezahlt (Vorsteuer)",r.vatPaid),a.line(l,V-2,o-c,V-2),A("MwSt.-Zahllast",r.vatPayable,{bold:!0});const M=270;a.setDrawColor(...Cp),a.setLineWidth(.3),a.line(l,M-3,o-c,M-3),a.setFontSize(7),a.setTextColor(...oo);const B=l;a.setFont("helvetica","bold"),a.text(h,B,M),a.text(g,B,M+3.5),a.setFont("helvetica","normal"),a.text(b,B,M+7),a.text(`${p} ${y}`,B,M+10.5),a.text(x,B,M+14),a.text(`Steuernummer: ${C}`,B,M+17.5),a.text(`USt-IdNr.: ${P}`,B,M+21);const J=l+55;a.setFont("helvetica","bold"),a.text("Kontakt:",J,M),a.setFont("helvetica","normal"),a.text(`Tel.: ${w}`,J,M+3.5),a.text(`E-Mail: ${S}`,J,M+7);const oe=l+110;a.setFont("helvetica","bold"),a.text("Zahlungsinformationen:",oe,M),a.setFont("helvetica","normal"),a.text(`IBAN: ${U}`,oe,M+3.5),a.text(`BIC: ${ee}`,oe,M+7),a.text(L,oe,M+10.5),a.save(`EUER-${t}-Beck360.pdf`)}function m_(){const t=Qn(),e=new Date,[n,r]=me(e.getFullYear()),{stats:i,monthlyData:a,quarterlyData:o,expensesByCategory:l,loading:c}=h_({year:n}),{settings:d}=ic(),h=[];for(let y=e.getFullYear();y>=e.getFullYear()-5;y--)h.push(y);function g(){i&&(p_({year:n,monthlyData:a,quarterlyData:o,stats:i,settings:d}),t.success("PDF erstellt"))}function b(){if(!a.length)return;const y="Monat,Einnahmen Brutto,Einnahmen Netto,MwSt erhalten,Ausgaben Brutto,Ausgaben Netto,MwSt gezahlt,Gewinn",w=a.map(U=>[Gl[U.month-1],U.incomeBrutto.toFixed(2).replace(".",","),U.incomeNetto.toFixed(2).replace(".",","),U.vatCollected.toFixed(2).replace(".",","),U.expensesBrutto.toFixed(2).replace(".",","),U.expensesNetto.toFixed(2).replace(".",","),U.vatPaid.toFixed(2).replace(".",","),U.profit.toFixed(2).replace(".",",")].map(ee=>`"${ee}"`).join(";")),S=a.reduce((U,ee)=>({ib:U.ib+ee.incomeBrutto,in_:U.in_+ee.incomeNetto,vc:U.vc+ee.vatCollected,eb:U.eb+ee.expensesBrutto,en:U.en+ee.expensesNetto,vp:U.vp+ee.vatPaid,p:U.p+ee.profit}),{ib:0,in_:0,vc:0,eb:0,en:0,vp:0,p:0});w.push(["Summe",S.ib.toFixed(2).replace(".",","),S.in_.toFixed(2).replace(".",","),S.vc.toFixed(2).replace(".",","),S.eb.toFixed(2).replace(".",","),S.en.toFixed(2).replace(".",","),S.vp.toFixed(2).replace(".",","),S.p.toFixed(2).replace(".",",")].map(U=>`"${U}"`).join(";"));const x=[y.split(",").map(U=>`"${U}"`).join(";"),...w].join(`
`),C=new Blob(["\uFEFF"+x],{type:"text/csv;charset=utf-8"}),P=URL.createObjectURL(C),L=document.createElement("a");L.href=P,L.download=`EUER-${n}-Beck360.csv`,L.click(),URL.revokeObjectURL(P),t.success("CSV erstellt")}const p=Object.values(l).reduce((y,w)=>y+w,0);return s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Berichte"}),s("div",{style:"display:flex;gap:0.5rem;align-items:center;flex-wrap:wrap",children:[s("select",{value:n,onChange:y=>r(parseInt(y.target.value)),style:"width:auto",children:h.map(y=>s("option",{value:y,children:y},y))}),s("button",{class:"btn btn-primary btn-sm",onClick:g,disabled:c,children:"PDF Export"}),s("button",{class:"btn btn-secondary btn-sm",onClick:b,disabled:c,children:"CSV Export"})]})]}),s("div",{class:"page-body",children:c?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):i?s(At,{children:[s("div",{class:"grid-4",style:"margin-bottom:1.5rem",children:[s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Jahresumsatz brutto"}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#10b981",children:je(i.yearRevenue)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Ausgaben gesamt"}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#ef4444",children:je(i.yearExpenses)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Gewinn (netto)"}),s("div",{style:"font-size:1.5rem;font-weight:700;color:var(--brand)",children:je(i.yearProfit)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Offene Rechnungen"}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#f59e0b",children:je(i.openInvoices)})]})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Monatsuebersicht ",n]})}),s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Monat"}),s("th",{style:"text-align:right",children:"Einnahmen brutto"}),s("th",{style:"text-align:right",children:"Einnahmen netto"}),s("th",{style:"text-align:right",children:"Ausgaben brutto"}),s("th",{style:"text-align:right",children:"MwSt erh."}),s("th",{style:"text-align:right",children:"MwSt gez."}),s("th",{style:"text-align:right",children:"Gewinn"})]})}),s("tbody",{children:[a.map(y=>s("tr",{children:[s("td",{"data-label":"Monat",style:"font-weight:600",children:Gl[y.month-1]}),s("td",{"data-label":"Einnahmen brutto",children:je(y.incomeBrutto)}),s("td",{"data-label":"Einnahmen netto",children:je(y.incomeNetto)}),s("td",{"data-label":"Ausgaben brutto",children:je(y.expensesBrutto)}),s("td",{"data-label":"MwSt erh.",children:je(y.vatCollected)}),s("td",{"data-label":"MwSt gez.",children:je(y.vatPaid)}),s("td",{"data-label":"Gewinn",style:`font-weight:600;color:${y.profit>=0?"#10b981":"#ef4444"}`,children:je(y.profit)})]},y.month)),s("tr",{style:"font-weight:700;border-top:2px solid var(--border)",children:[s("td",{"data-label":"Monat",children:"Summe"}),s("td",{"data-label":"Einnahmen brutto",children:je(a.reduce((y,w)=>y+w.incomeBrutto,0))}),s("td",{"data-label":"Einnahmen netto",children:je(a.reduce((y,w)=>y+w.incomeNetto,0))}),s("td",{"data-label":"Ausgaben brutto",children:je(a.reduce((y,w)=>y+w.expensesBrutto,0))}),s("td",{"data-label":"MwSt erh.",children:je(a.reduce((y,w)=>y+w.vatCollected,0))}),s("td",{"data-label":"MwSt gez.",children:je(a.reduce((y,w)=>y+w.vatPaid,0))}),s("td",{"data-label":"Gewinn",style:`color:${i.yearProfit>=0?"#10b981":"#ef4444"}`,children:je(i.yearProfit)})]})]})]})})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Quartalsuebersicht ",n]})}),s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Quartal"}),s("th",{style:"text-align:right",children:"Einnahmen brutto"}),s("th",{style:"text-align:right",children:"Einnahmen netto"}),s("th",{style:"text-align:right",children:"Ausgaben brutto"}),s("th",{style:"text-align:right",children:"MwSt erh."}),s("th",{style:"text-align:right",children:"MwSt gez."}),s("th",{style:"text-align:right",children:"Gewinn"})]})}),s("tbody",{children:[o.map(y=>s("tr",{children:[s("td",{"data-label":"Quartal",style:"font-weight:600",children:["Q",y.quarter]}),s("td",{"data-label":"Einnahmen brutto",children:je(y.incomeBrutto)}),s("td",{"data-label":"Einnahmen netto",children:je(y.incomeNetto)}),s("td",{"data-label":"Ausgaben brutto",children:je(y.expensesBrutto)}),s("td",{"data-label":"MwSt erh.",children:je(y.vatCollected)}),s("td",{"data-label":"MwSt gez.",children:je(y.vatPaid)}),s("td",{"data-label":"Gewinn",style:`font-weight:600;color:${y.profit>=0?"#10b981":"#ef4444"}`,children:je(y.profit)})]},y.quarter)),s("tr",{style:"font-weight:700;border-top:2px solid var(--border)",children:[s("td",{"data-label":"Quartal",children:"Summe"}),s("td",{"data-label":"Einnahmen brutto",children:je(i.yearRevenue)}),s("td",{"data-label":"Einnahmen netto",children:je(i.yearRevenueNetto)}),s("td",{"data-label":"Ausgaben brutto",children:je(i.yearExpenses)}),s("td",{"data-label":"MwSt erh.",children:je(i.vatCollected)}),s("td",{"data-label":"MwSt gez.",children:je(i.vatPaid)}),s("td",{"data-label":"Gewinn",style:`color:${i.yearProfit>=0?"#10b981":"#ef4444"}`,children:je(i.yearProfit)})]})]})]})})]}),Object.keys(l).length>0&&s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Ausgaben nach Kategorie"})}),s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Kategorie"}),s("th",{style:"text-align:right",children:"Betrag"}),s("th",{style:"text-align:right",children:"Anteil"})]})}),s("tbody",{children:[Object.entries(l).sort(([,y],[,w])=>w-y).map(([y,w])=>s("tr",{children:[s("td",{"data-label":"Kategorie",style:"font-weight:500",children:Wl[y]||y}),s("td",{"data-label":"Betrag",children:je(w)}),s("td",{"data-label":"Anteil",children:[p>0?(w/p*100).toFixed(1):0," %"]})]},y)),s("tr",{style:"font-weight:700;border-top:2px solid var(--border)",children:[s("td",{"data-label":"Kategorie",children:"Gesamt"}),s("td",{"data-label":"Betrag",children:je(p)}),s("td",{"data-label":"Anteil",children:"100 %"})]})]})]})})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["EUER-Zusammenfassung ",n]})}),s("div",{style:"padding:0.5rem 0",children:[s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--border)",children:[s("span",{children:"Betriebseinnahmen (netto)"}),s("span",{style:"font-weight:600",children:je(i.yearRevenueNetto)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--border)",children:[s("span",{children:"Betriebsausgaben (netto)"}),s("span",{style:"font-weight:600;color:#ef4444",children:je(i.yearExpensesNetto)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:2px solid var(--border);font-weight:700;font-size:1.1rem",children:[s("span",{children:"Gewinn vor Steuern"}),s("span",{style:`color:${i.yearProfit>=0?"#10b981":"#ef4444"}`,children:je(i.yearProfit)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--border);margin-top:0.5rem",children:[s("span",{children:"MwSt. erhalten"}),s("span",{children:je(i.vatCollected)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--border)",children:[s("span",{children:"MwSt. gezahlt (Vorsteuer)"}),s("span",{children:je(i.vatPaid)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;font-weight:700",children:[s("span",{children:"MwSt.-Zahllast"}),s("span",{children:je(i.vatPayable)})]})]})]})]}):s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Daten verfuegbar"})]})})]})}function g_(){const{user:t,loading:e}=rc();return e?s("div",{class:"loading-center",style:"min-height: 100vh",children:s("div",{class:"spinner"})}):t?s(Qv,{children:s(fm,{children:[s(Zh,{path:"/crm/"}),s(p2,{path:"/crm/pipeline"}),s(x2,{path:"/crm/contacts"}),s(A2,{path:"/crm/contacts/new"}),s(S2,{path:"/crm/contacts/:id"}),s(N2,{path:"/crm/companies"}),s(E2,{path:"/crm/companies/:id"}),s(C2,{path:"/crm/deals/new"}),s(L2,{path:"/crm/deals/:id"}),s(ob,{path:"/crm/invoices"}),s(cb,{path:"/crm/invoices/new"}),s(i_,{path:"/crm/invoices/:id"}),s(u_,{path:"/crm/expenses"}),s(d_,{path:"/crm/expenses/new"}),s(m_,{path:"/crm/reports"}),s(F2,{path:"/crm/campaigns"}),s(ab,{path:"/crm/campaigns/new"}),s(sb,{path:"/crm/campaigns/:id"}),s(T2,{path:"/crm/settings"}),s(Zh,{default:!0})]})}):s(e2,{})}i0(s($v,{children:s(qv,{children:s(g_,{})})}),document.getElementById("app"));export{Ht as _};
