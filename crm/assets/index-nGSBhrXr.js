var Jm=Object.defineProperty;var Ym=(t,e,n)=>e in t?Jm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var zt=(t,e,n)=>Ym(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();var Lo,Jt,Cp,Oa,uh,Tp,Pp,Ip,sd,Lu,Cu,Op,Bl={},Ml=[],Xm=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Co=Array.isArray;function mi(t,e){for(var n in e)t[n]=e[n];return t}function od(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Rp(t,e,n){var r,a,i,o={};for(i in e)i=="key"?r=e[i]:i=="ref"?a=e[i]:o[i]=e[i];if(arguments.length>2&&(o.children=arguments.length>3?Lo.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)o[i]===void 0&&(o[i]=t.defaultProps[i]);return uo(t,o,r,a,null)}function uo(t,e,n,r,a){var i={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:a??++Cp,__i:-1,__u:0};return a==null&&Jt.vnode!=null&&Jt.vnode(i),i}function xt(t){return t.children}function ho(t,e){this.props=t,this.context=e}function xs(t,e){if(e==null)return t.__?xs(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?xs(t):null}function Zm(t){if(t.__P&&t.__d){var e=t.__v,n=e.__e,r=[],a=[],i=mi({},e);i.__v=e.__v+1,Jt.vnode&&Jt.vnode(i),ld(t.__P,i,e,t.__n,t.__P.namespaceURI,32&e.__u?[n]:null,r,n??xs(e),!!(32&e.__u),a),i.__v=e.__v,i.__.__k[i.__i]=i,Bp(r,i,a),e.__e=e.__=null,i.__e!=n&&Fp(i)}}function Fp(t){if((t=t.__)!=null&&t.__c!=null)return t.__e=t.__c.base=null,t.__k.some(function(e){if(e!=null&&e.__e!=null)return t.__e=t.__c.base=e.__e}),Fp(t)}function Tu(t){(!t.__d&&(t.__d=!0)&&Oa.push(t)&&!Ul.__r++||uh!=Jt.debounceRendering)&&((uh=Jt.debounceRendering)||Tp)(Ul)}function Ul(){for(var t,e=1;Oa.length;)Oa.length>e&&Oa.sort(Pp),t=Oa.shift(),e=Oa.length,Zm(t);Ul.__r=0}function Dp(t,e,n,r,a,i,o,l,c,u,h){var g,b,p,y,_,S,x,T=r&&r.__k||Ml,O=e.length;for(c=Qm(n,e,T,c,O),g=0;g<O;g++)(p=n.__k[g])!=null&&(b=p.__i!=-1&&T[p.__i]||Bl,p.__i=g,S=ld(t,p,b,a,i,o,l,c,u,h),y=p.__e,p.ref&&b.ref!=p.ref&&(b.ref&&cd(b.ref,null,p),h.push(p.ref,p.__c||y,p)),_==null&&y!=null&&(_=y),(x=!!(4&p.__u))||b.__k===p.__k?c=jp(p,c,t,x):typeof p.type=="function"&&S!==void 0?c=S:y&&(c=y.nextSibling),p.__u&=-7);return n.__e=_,c}function Qm(t,e,n,r,a){var i,o,l,c,u,h=n.length,g=h,b=0;for(t.__k=new Array(a),i=0;i<a;i++)(o=e[i])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=t.__k[i]=uo(null,o,null,null,null):Co(o)?o=t.__k[i]=uo(xt,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?o=t.__k[i]=uo(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):t.__k[i]=o,c=i+b,o.__=t,o.__b=t.__b+1,l=null,(u=o.__i=e0(o,n,c,g))!=-1&&(g--,(l=n[u])&&(l.__u|=2)),l==null||l.__v==null?(u==-1&&(a>h?b--:a<h&&b++),typeof o.type!="function"&&(o.__u|=4)):u!=c&&(u==c-1?b--:u==c+1?b++:(u>c?b--:b++,o.__u|=4))):t.__k[i]=null;if(g)for(i=0;i<h;i++)(l=n[i])!=null&&(2&l.__u)==0&&(l.__e==r&&(r=xs(l)),Up(l,l));return r}function jp(t,e,n,r){var a,i;if(typeof t.type=="function"){for(a=t.__k,i=0;a&&i<a.length;i++)a[i]&&(a[i].__=t,e=jp(a[i],e,n,r));return e}t.__e!=e&&(r&&(e&&t.type&&!e.parentNode&&(e=xs(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Pu(t,e){return e=e||[],t==null||typeof t=="boolean"||(Co(t)?t.some(function(n){Pu(n,e)}):e.push(t)),e}function e0(t,e,n,r){var a,i,o,l=t.key,c=t.type,u=e[n],h=u!=null&&(2&u.__u)==0;if(u===null&&l==null||h&&l==u.key&&c==u.type)return n;if(r>(h?1:0)){for(a=n-1,i=n+1;a>=0||i<e.length;)if((u=e[o=a>=0?a--:i++])!=null&&(2&u.__u)==0&&l==u.key&&c==u.type)return o}return-1}function dh(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Xm.test(e)?n:n+"px"}function cl(t,e,n,r,a){var i,o;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||dh(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||dh(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")i=e!=(e=e.replace(Ip,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=n,n?r?n.u=r.u:(n.u=sd,t.addEventListener(e,i?Cu:Lu,i)):t.removeEventListener(e,i?Cu:Lu,i);else{if(a=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function hh(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=sd++;else if(e.t<n.u)return;return n(Jt.event?Jt.event(e):e)}}}function ld(t,e,n,r,a,i,o,l,c,u){var h,g,b,p,y,_,S,x,T,O,E,M,ee,G,X,F=e.type;if(e.constructor!==void 0)return null;128&n.__u&&(c=!!(32&n.__u),i=[l=e.__e=n.__e]),(h=Jt.__b)&&h(e);e:if(typeof F=="function")try{if(x=e.props,T="prototype"in F&&F.prototype.render,O=(h=F.contextType)&&r[h.__c],E=h?O?O.props.value:h.__:r,n.__c?S=(g=e.__c=n.__c).__=g.__E:(T?e.__c=g=new F(x,E):(e.__c=g=new ho(x,E),g.constructor=F,g.render=n0),O&&O.sub(g),g.state||(g.state={}),g.__n=r,b=g.__d=!0,g.__h=[],g._sb=[]),T&&g.__s==null&&(g.__s=g.state),T&&F.getDerivedStateFromProps!=null&&(g.__s==g.state&&(g.__s=mi({},g.__s)),mi(g.__s,F.getDerivedStateFromProps(x,g.__s))),p=g.props,y=g.state,g.__v=e,b)T&&F.getDerivedStateFromProps==null&&g.componentWillMount!=null&&g.componentWillMount(),T&&g.componentDidMount!=null&&g.__h.push(g.componentDidMount);else{if(T&&F.getDerivedStateFromProps==null&&x!==p&&g.componentWillReceiveProps!=null&&g.componentWillReceiveProps(x,E),e.__v==n.__v||!g.__e&&g.shouldComponentUpdate!=null&&g.shouldComponentUpdate(x,g.__s,E)===!1){e.__v!=n.__v&&(g.props=x,g.state=g.__s,g.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(I){I&&(I.__=e)}),Ml.push.apply(g.__h,g._sb),g._sb=[],g.__h.length&&o.push(g);break e}g.componentWillUpdate!=null&&g.componentWillUpdate(x,g.__s,E),T&&g.componentDidUpdate!=null&&g.__h.push(function(){g.componentDidUpdate(p,y,_)})}if(g.context=E,g.props=x,g.__P=t,g.__e=!1,M=Jt.__r,ee=0,T)g.state=g.__s,g.__d=!1,M&&M(e),h=g.render(g.props,g.state,g.context),Ml.push.apply(g.__h,g._sb),g._sb=[];else do g.__d=!1,M&&M(e),h=g.render(g.props,g.state,g.context),g.state=g.__s;while(g.__d&&++ee<25);g.state=g.__s,g.getChildContext!=null&&(r=mi(mi({},r),g.getChildContext())),T&&!b&&g.getSnapshotBeforeUpdate!=null&&(_=g.getSnapshotBeforeUpdate(p,y)),G=h!=null&&h.type===xt&&h.key==null?Mp(h.props.children):h,l=Dp(t,Co(G)?G:[G],e,n,r,a,i,o,l,c,u),g.base=e.__e,e.__u&=-161,g.__h.length&&o.push(g),S&&(g.__E=g.__=null)}catch(I){if(e.__v=null,c||i!=null)if(I.then){for(e.__u|=c?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;i[i.indexOf(l)]=null,e.__e=l}else{for(X=i.length;X--;)od(i[X]);Iu(e)}else e.__e=n.__e,e.__k=n.__k,I.then||Iu(e);Jt.__e(I,e,n)}else i==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):l=e.__e=t0(n.__e,e,n,r,a,i,o,c,u);return(h=Jt.diffed)&&h(e),128&e.__u?void 0:l}function Iu(t){t&&(t.__c&&(t.__c.__e=!0),t.__k&&t.__k.some(Iu))}function Bp(t,e,n){for(var r=0;r<n.length;r++)cd(n[r],n[++r],n[++r]);Jt.__c&&Jt.__c(e,t),t.some(function(a){try{t=a.__h,a.__h=[],t.some(function(i){i.call(a)})}catch(i){Jt.__e(i,a.__v)}})}function Mp(t){return typeof t!="object"||t==null||t.__b>0?t:Co(t)?t.map(Mp):mi({},t)}function t0(t,e,n,r,a,i,o,l,c){var u,h,g,b,p,y,_,S=n.props||Bl,x=e.props,T=e.type;if(T=="svg"?a="http://www.w3.org/2000/svg":T=="math"?a="http://www.w3.org/1998/Math/MathML":a||(a="http://www.w3.org/1999/xhtml"),i!=null){for(u=0;u<i.length;u++)if((p=i[u])&&"setAttribute"in p==!!T&&(T?p.localName==T:p.nodeType==3)){t=p,i[u]=null;break}}if(t==null){if(T==null)return document.createTextNode(x);t=document.createElementNS(a,T,x.is&&x),l&&(Jt.__m&&Jt.__m(e,i),l=!1),i=null}if(T==null)S===x||l&&t.data==x||(t.data=x);else{if(i=i&&Lo.call(t.childNodes),!l&&i!=null)for(S={},u=0;u<t.attributes.length;u++)S[(p=t.attributes[u]).name]=p.value;for(u in S)p=S[u],u=="dangerouslySetInnerHTML"?g=p:u=="children"||u in x||u=="value"&&"defaultValue"in x||u=="checked"&&"defaultChecked"in x||cl(t,u,null,p,a);for(u in x)p=x[u],u=="children"?b=p:u=="dangerouslySetInnerHTML"?h=p:u=="value"?y=p:u=="checked"?_=p:l&&typeof p!="function"||S[u]===p||cl(t,u,p,S[u],a);if(h)l||g&&(h.__html==g.__html||h.__html==t.innerHTML)||(t.innerHTML=h.__html),e.__k=[];else if(g&&(t.innerHTML=""),Dp(e.type=="template"?t.content:t,Co(b)?b:[b],e,n,r,T=="foreignObject"?"http://www.w3.org/1999/xhtml":a,i,o,i?i[0]:n.__k&&xs(n,0),l,c),i!=null)for(u=i.length;u--;)od(i[u]);l||(u="value",T=="progress"&&y==null?t.removeAttribute("value"):y!=null&&(y!==t[u]||T=="progress"&&!y||T=="option"&&y!=S[u])&&cl(t,u,y,S[u],a),u="checked",_!=null&&_!=t[u]&&cl(t,u,_,S[u],a))}return t}function cd(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(a){Jt.__e(a,n)}}function Up(t,e,n){var r,a;if(Jt.unmount&&Jt.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||cd(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){Jt.__e(i,e)}r.base=r.__P=null}if(r=t.__k)for(a=0;a<r.length;a++)r[a]&&Up(r[a],e,n||typeof t.type!="function");n||od(t.__e),t.__c=t.__=t.__e=void 0}function n0(t,e,n){return this.constructor(t,n)}function r0(t,e,n){var r,a,i,o;e==document&&(e=document.documentElement),Jt.__&&Jt.__(t,e),a=(r=!1)?null:e.__k,i=[],o=[],ld(e,t=e.__k=Rp(xt,null,[t]),a||Bl,Bl,e.namespaceURI,a?null:e.firstChild?Lo.call(e.childNodes):null,i,a?a.__e:e.firstChild,r,o),Bp(i,t,o)}function i0(t,e,n){var r,a,i,o,l=mi({},t.props);for(i in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),e)i=="key"?r=e[i]:i=="ref"?a=e[i]:l[i]=e[i]===void 0&&o!=null?o[i]:e[i];return arguments.length>2&&(l.children=arguments.length>3?Lo.call(arguments,2):n),uo(t.type,l,r||t.key,a||t.ref,null)}function ud(t){function e(n){var r,a;return this.getChildContext||(r=new Set,(a={})[e.__c]=this,this.getChildContext=function(){return a},this.componentWillUnmount=function(){r=null},this.shouldComponentUpdate=function(i){this.props.value!=i.value&&r.forEach(function(o){o.__e=!0,Tu(o)})},this.sub=function(i){r.add(i);var o=i.componentWillUnmount;i.componentWillUnmount=function(){r&&r.delete(i),o&&o.call(i)}}),n.children}return e.__c="__cC"+Op++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,r){return n.children(r)}).contextType=e,e}Lo=Ml.slice,Jt={__e:function(t,e,n,r){for(var a,i,o;e=e.__;)if((a=e.__c)&&!a.__)try{if((i=a.constructor)&&i.getDerivedStateFromError!=null&&(a.setState(i.getDerivedStateFromError(t)),o=a.__d),a.componentDidCatch!=null&&(a.componentDidCatch(t,r||{}),o=a.__d),o)return a.__E=a}catch(l){t=l}throw t}},Cp=0,ho.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=mi({},this.state),typeof t=="function"&&(t=t(mi({},n),this.props)),t&&mi(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),Tu(this))},ho.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Tu(this))},ho.prototype.render=xt,Oa=[],Tp=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Pp=function(t,e){return t.__v.__b-e.__v.__b},Ul.__r=0,Ip=/(PointerCapture)$|Capture$/i,sd=0,Lu=hh(!1),Cu=hh(!0),Op=0;var a0=0;function s(t,e,n,r,a,i){e||(e={});var o,l,c=e;if("ref"in c)for(l in c={},e)l=="ref"?o=e[l]:c[l]=e[l];var u={type:t,props:c,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--a0,__i:-1,__u:0,__source:a,__self:i};if(typeof t=="function"&&(o=t.defaultProps))for(l in o)c[l]===void 0&&(c[l]=o[l]);return Jt.vnode&&Jt.vnode(u),u}var Ss,ln,qc,fh,bo=0,$p=[],Ln=Jt,ph=Ln.__b,gh=Ln.__r,mh=Ln.diffed,vh=Ln.__c,bh=Ln.unmount,yh=Ln.__;function Zl(t,e){Ln.__h&&Ln.__h(ln,t,bo||e),bo=0;var n=ln.__H||(ln.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function me(t){return bo=1,s0(Wp,t)}function s0(t,e,n){var r=Zl(Ss++,2);if(r.t=t,!r.__c&&(r.__=[Wp(void 0,e),function(l){var c=r.__N?r.__N[0]:r.__[0],u=r.t(c,l);c!==u&&(r.__N=[u,r.__[1]],r.__c.setState({}))}],r.__c=ln,!ln.__f)){var a=function(l,c,u){if(!r.__c.__H)return!0;var h=r.__c.__H.__.filter(function(b){return b.__c});if(h.every(function(b){return!b.__N}))return!i||i.call(this,l,c,u);var g=r.__c.props!==l;return h.some(function(b){if(b.__N){var p=b.__[0];b.__=b.__N,b.__N=void 0,p!==b.__[0]&&(g=!0)}}),i&&i.call(this,l,c,u)||g};ln.__f=!0;var i=ln.shouldComponentUpdate,o=ln.componentWillUpdate;ln.componentWillUpdate=function(l,c,u){if(this.__e){var h=i;i=void 0,a(l,c,u),i=h}o&&o.call(this,l,c,u)},ln.shouldComponentUpdate=a}return r.__N||r.__}function Mt(t,e){var n=Zl(Ss++,3);!Ln.__s&&Hp(n.__H,e)&&(n.__=t,n.u=e,ln.__H.__h.push(n))}function qp(t){return bo=5,fo(function(){return{current:t}},[])}function fo(t,e){var n=Zl(Ss++,7);return Hp(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function Nt(t,e){return bo=8,fo(function(){return t},e)}function zp(t){var e=ln.context[t.__c],n=Zl(Ss++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(ln)),e.props.value):t.__}function o0(){for(var t;t=$p.shift();){var e=t.__H;if(t.__P&&e)try{e.__h.some(Cl),e.__h.some(Ou),e.__h=[]}catch(n){e.__h=[],Ln.__e(n,t.__v)}}}Ln.__b=function(t){ln=null,ph&&ph(t)},Ln.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),yh&&yh(t,e)},Ln.__r=function(t){gh&&gh(t),Ss=0;var e=(ln=t.__c).__H;e&&(qc===ln?(e.__h=[],ln.__h=[],e.__.some(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.some(Cl),e.__h.some(Ou),e.__h=[],Ss=0)),qc=ln},Ln.diffed=function(t){mh&&mh(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&($p.push(e)!==1&&fh===Ln.requestAnimationFrame||((fh=Ln.requestAnimationFrame)||l0)(o0)),e.__H.__.some(function(n){n.u&&(n.__H=n.u),n.u=void 0})),qc=ln=null},Ln.__c=function(t,e){e.some(function(n){try{n.__h.some(Cl),n.__h=n.__h.filter(function(r){return!r.__||Ou(r)})}catch(r){e.some(function(a){a.__h&&(a.__h=[])}),e=[],Ln.__e(r,n.__v)}}),vh&&vh(t,e)},Ln.unmount=function(t){bh&&bh(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.some(function(r){try{Cl(r)}catch(a){e=a}}),n.__H=void 0,e&&Ln.__e(e,n.__v))};var _h=typeof requestAnimationFrame=="function";function l0(t){var e,n=function(){clearTimeout(r),_h&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,35);_h&&(e=requestAnimationFrame(n))}function Cl(t){var e=ln,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),ln=e}function Ou(t){var e=ln;t.__c=t.__(),ln=e}function Hp(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function Wp(t,e){return typeof e=="function"?e(t):e}function Ql(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]]);return n}function c0(t,e,n,r){function a(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(h){try{u(r.next(h))}catch(g){o(g)}}function c(h){try{u(r.throw(h))}catch(g){o(g)}}function u(h){h.done?i(h.value):a(h.value).then(l,c)}u((r=r.apply(t,e||[])).next())})}const u0=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class dd extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class d0 extends dd{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class wh extends dd{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class xh extends dd{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ru;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Ru||(Ru={}));class h0{constructor(e,{headers:n={},customFetch:r,region:a=Ru.Any}={}){this.url=e,this.headers=n,this.region=a,this.fetch=u0(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return c0(this,arguments,void 0,function*(n,r={}){var a;let i,o;try{const{headers:l,method:c,body:u,signal:h,timeout:g}=r;let b={},{region:p}=r;p||(p=this.region);const y=new URL(`${this.url}/${n}`);p&&p!=="any"&&(b["x-region"]=p,y.searchParams.set("forceFunctionRegion",p));let _;u&&(l&&!Object.prototype.hasOwnProperty.call(l,"Content-Type")||!l)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(b["Content-Type"]="application/octet-stream",_=u):typeof u=="string"?(b["Content-Type"]="text/plain",_=u):typeof FormData<"u"&&u instanceof FormData?_=u:(b["Content-Type"]="application/json",_=JSON.stringify(u)):u&&typeof u!="string"&&!(typeof Blob<"u"&&u instanceof Blob)&&!(u instanceof ArrayBuffer)&&!(typeof FormData<"u"&&u instanceof FormData)?_=JSON.stringify(u):_=u;let S=h;g&&(o=new AbortController,i=setTimeout(()=>o.abort(),g),h?(S=o.signal,h.addEventListener("abort",()=>o.abort())):S=o.signal);const x=yield this.fetch(y.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},b),this.headers),l),body:_,signal:S}).catch(M=>{throw new d0(M)}),T=x.headers.get("x-relay-error");if(T&&T==="true")throw new wh(x);if(!x.ok)throw new xh(x);let O=((a=x.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),E;return O==="application/json"?E=yield x.json():O==="application/octet-stream"||O==="application/pdf"?E=yield x.blob():O==="text/event-stream"?E=x:O==="multipart/form-data"?E=yield x.formData():E=yield x.text(),{data:E,error:null,response:x}}catch(l){return{data:null,error:l,response:l instanceof xh||l instanceof wh?l.context:void 0}}finally{i&&clearTimeout(i)}})}}var f0=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},p0=class{constructor(t){var e,n,r;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,this.urlLengthLimit=(r=t.urlLengthLimit)!==null&&r!==void 0?r:8e3,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let a=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,l=null,c=null,u=i.status,h=i.statusText;if(i.ok){var g,b;if(n.method!=="HEAD"){var p;const x=await i.text();x===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((p=n.headers.get("Accept"))===null||p===void 0)&&p.includes("application/vnd.pgrst.plan+text"))?l=x:l=JSON.parse(x))}const _=(g=n.headers.get("Prefer"))===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),S=(b=i.headers.get("content-range"))===null||b===void 0?void 0:b.split("/");_&&S&&S.length>1&&(c=parseInt(S[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(l)&&(l.length>1?(o={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,c=null,u=406,h="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{var y;const _=await i.text();try{o=JSON.parse(_),Array.isArray(o)&&i.status===404&&(l=[],o=null,u=200,h="OK")}catch{i.status===404&&_===""?(u=204,h="No Content"):o={message:_}}if(o&&n.isMaybeSingle&&(!(o==null||(y=o.details)===null||y===void 0)&&y.includes("0 rows"))&&(o=null,u=200,h="OK"),o&&n.shouldThrowOnError)throw new f0(o)}return{error:o,data:l,count:c,status:u,statusText:h}});return this.shouldThrowOnError||(a=a.catch(i=>{var o;let l="",c="",u="";const h=i==null?void 0:i.cause;if(h){var g,b,p,y;const x=(g=h==null?void 0:h.message)!==null&&g!==void 0?g:"",T=(b=h==null?void 0:h.code)!==null&&b!==void 0?b:"";l=`${(p=i==null?void 0:i.name)!==null&&p!==void 0?p:"FetchError"}: ${i==null?void 0:i.message}`,l+=`

Caused by: ${(y=h==null?void 0:h.name)!==null&&y!==void 0?y:"Error"}: ${x}`,T&&(l+=` (${T})`),h!=null&&h.stack&&(l+=`
${h.stack}`)}else{var _;l=(_=i==null?void 0:i.stack)!==null&&_!==void 0?_:""}const S=this.url.toString().length;return(i==null?void 0:i.name)==="AbortError"||(i==null?void 0:i.code)==="ABORT_ERR"?(u="",c="Request was aborted (timeout or manual cancellation)",S>this.urlLengthLimit&&(c+=`. Note: Your request URL is ${S} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((h==null?void 0:h.name)==="HeadersOverflowError"||(h==null?void 0:h.code)==="UND_ERR_HEADERS_OVERFLOW")&&(u="",c="HTTP headers exceeded server limits (typically 16KB)",S>this.urlLengthLimit&&(c+=`. Your request URL is ${S} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:l,hint:c,code:u},data:null,count:null,status:0,statusText:""}})),a.then(t,e)}returns(){return this}overrideTypes(){return this}},g0=class extends p0{select(t){let e=!1;const n=(t??"*").split("").map(r=>/\s/.test(r)&&!e?"":(r==='"'&&(e=!e),r)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:r,referencedTable:a=r}={}){const i=a?`${a}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:r=n}={}){const a=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${t}`),this.url.searchParams.set(i,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:r=!1,wal:a=!1,format:i="text"}={}){var o;const l=[t?"analyze":null,e?"verbose":null,n?"settings":null,r?"buffers":null,a?"wal":null].filter(Boolean).join("|"),c=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${c}"; options=${l};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const Sh=new RegExp("[,()]");var us=class extends g0{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&Sh.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}notIn(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&Sh.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`not.in.(${n})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:r}={}){let a="";r==="plain"?a="pl":r==="phrase"?a="ph":r==="websearch"&&(a="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${a}fts${i}.${e}`),this}match(t){return Object.entries(t).forEach(([e,n])=>{this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}},m0=class{constructor(t,{headers:e={},schema:n,fetch:r,urlLengthLimit:a=8e3}){this.url=t,this.headers=new Headers(e),this.schema=n,this.fetch=r,this.urlLengthLimit=a}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,e){const{head:n=!1,count:r}=e??{},a=n?"HEAD":"GET";let i=!1;const o=(t??"*").split("").map(u=>/\s/.test(u)&&!i?"":(u==='"'&&(i=!i),u)).join(""),{url:l,headers:c}=this.cloneRequestState();return l.searchParams.set("select",o),r&&c.append("Prefer",`count=${r}`),new us({method:a,url:l,headers:c,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(t,{count:e,defaultToNull:n=!0}={}){var r;const a="POST",{url:i,headers:o}=this.cloneRequestState();if(e&&o.append("Prefer",`count=${e}`),n||o.append("Prefer","missing=default"),Array.isArray(t)){const l=t.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);i.searchParams.set("columns",c.join(","))}}return new us({method:a,url:i,headers:o,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:r,defaultToNull:a=!0}={}){var i;const o="POST",{url:l,headers:c}=this.cloneRequestState();if(c.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),e!==void 0&&l.searchParams.set("on_conflict",e),r&&c.append("Prefer",`count=${r}`),a||c.append("Prefer","missing=default"),Array.isArray(t)){const u=t.reduce((h,g)=>h.concat(Object.keys(g)),[]);if(u.length>0){const h=[...new Set(u)].map(g=>`"${g}"`);l.searchParams.set("columns",h.join(","))}}return new us({method:o,url:l,headers:c,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}update(t,{count:e}={}){var n;const r="PATCH",{url:a,headers:i}=this.cloneRequestState();return e&&i.append("Prefer",`count=${e}`),new us({method:r,url:a,headers:i,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:t}={}){var e;const n="DELETE",{url:r,headers:a}=this.cloneRequestState();return t&&a.append("Prefer",`count=${t}`),new us({method:n,url:r,headers:a,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}};function yo(t){"@babel/helpers - typeof";return yo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yo(t)}function v0(t,e){if(yo(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(yo(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function b0(t){var e=v0(t,"string");return yo(e)=="symbol"?e:e+""}function y0(t,e,n){return(e=b0(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ah(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function ul(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ah(Object(n),!0).forEach(function(r){y0(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ah(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var _0=class Gp{constructor(e,{headers:n={},schema:r,fetch:a,timeout:i,urlLengthLimit:o=8e3}={}){this.url=e,this.headers=new Headers(n),this.schemaName=r,this.urlLengthLimit=o;const l=a??globalThis.fetch;i!==void 0&&i>0?this.fetch=(c,u)=>{const h=new AbortController,g=setTimeout(()=>h.abort(),i),b=u==null?void 0:u.signal;if(b){if(b.aborted)return clearTimeout(g),l(c,u);const p=()=>{clearTimeout(g),h.abort()};return b.addEventListener("abort",p,{once:!0}),l(c,ul(ul({},u),{},{signal:h.signal})).finally(()=>{clearTimeout(g),b.removeEventListener("abort",p)})}return l(c,ul(ul({},u),{},{signal:h.signal})).finally(()=>clearTimeout(g))}:this.fetch=l}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new m0(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(e){return new Gp(this.url,{headers:this.headers,schema:e,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,n={},{head:r=!1,get:a=!1,count:i}={}){var o;let l;const c=new URL(`${this.url}/rpc/${e}`);let u;const h=p=>p!==null&&typeof p=="object"&&(!Array.isArray(p)||p.some(h)),g=r&&Object.values(n).some(h);g?(l="POST",u=n):r||a?(l=r?"HEAD":"GET",Object.entries(n).filter(([p,y])=>y!==void 0).map(([p,y])=>[p,Array.isArray(y)?`{${y.join(",")}}`:`${y}`]).forEach(([p,y])=>{c.searchParams.append(p,y)})):(l="POST",u=n);const b=new Headers(this.headers);return g?b.set("Prefer",i?`count=${i},return=minimal`:"return=minimal"):i&&b.set("Prefer",`count=${i}`),new us({method:l,url:c,headers:b,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}};class w0{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const n=globalThis.process;if(n){const r=n.versions;if(r&&r.node){const a=r.node,i=parseInt(a.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const x0="2.97.0",S0=`realtime-js/${x0}`,A0="1.0.0",Vp="2.0.0",kh=Vp,Fu=1e4,k0=1e3,N0=100;var sa;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(sa||(sa={}));var Dn;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Dn||(Dn={}));var ei;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(ei||(ei={}));var Du;(function(t){t.websocket="websocket"})(Du||(Du={}));var Ra;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Ra||(Ra={}));class E0{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r;const a=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,a)}_encodeJsonUserBroadcastPush(e){var n,r;const a=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},o=new TextEncoder().encode(JSON.stringify(a)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,n,r){var a,i;const o=e.topic,l=(a=e.ref)!==null&&a!==void 0?a:"",c=(i=e.join_ref)!==null&&i!==void 0?i:"",u=e.payload.event,h=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},g=Object.keys(h).length===0?"":JSON.stringify(h);if(c.length>255)throw new Error(`joinRef length ${c.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`ref length ${l.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(g.length>255)throw new Error(`metadata length ${g.length} exceeds maximum of 255`);const b=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+l.length+o.length+u.length+g.length,p=new ArrayBuffer(this.HEADER_LENGTH+b);let y=new DataView(p),_=0;y.setUint8(_++,this.KINDS.userBroadcastPush),y.setUint8(_++,c.length),y.setUint8(_++,l.length),y.setUint8(_++,o.length),y.setUint8(_++,u.length),y.setUint8(_++,g.length),y.setUint8(_++,n),Array.from(c,x=>y.setUint8(_++,x.charCodeAt(0))),Array.from(l,x=>y.setUint8(_++,x.charCodeAt(0))),Array.from(o,x=>y.setUint8(_++,x.charCodeAt(0))),Array.from(u,x=>y.setUint8(_++,x.charCodeAt(0))),Array.from(g,x=>y.setUint8(_++,x.charCodeAt(0)));var S=new Uint8Array(p.byteLength+r.byteLength);return S.set(new Uint8Array(p),0),S.set(new Uint8Array(r),p.byteLength),S.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[a,i,o,l,c]=r;return n({join_ref:a,ref:i,topic:o,event:l,payload:c})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),a=new TextDecoder;switch(r){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,a)}}_decodeUserBroadcast(e,n,r){const a=n.getUint8(1),i=n.getUint8(2),o=n.getUint8(3),l=n.getUint8(4);let c=this.HEADER_LENGTH+4;const u=r.decode(e.slice(c,c+a));c=c+a;const h=r.decode(e.slice(c,c+i));c=c+i;const g=r.decode(e.slice(c,c+o));c=c+o;const b=e.slice(c,e.byteLength),p=l===this.JSON_ENCODING?JSON.parse(r.decode(b)):b,y={type:this.BROADCAST_EVENT,event:h,payload:p};return o>0&&(y.meta=JSON.parse(g)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:y}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([r])=>n.includes(r)))}}class Kp{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Qt;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Qt||(Qt={}));const Nh=(t,e,n={})=>{var r;const a=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=L0(o,t,e,a),i),{}):{}},L0=(t,e,n,r)=>{const a=e.find(l=>l.name===t),i=a==null?void 0:a.type,o=n[t];return i&&!r.includes(i)?Jp(i,o):ju(o)},Jp=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return I0(e,n)}switch(t){case Qt.bool:return C0(e);case Qt.float4:case Qt.float8:case Qt.int2:case Qt.int4:case Qt.int8:case Qt.numeric:case Qt.oid:return T0(e);case Qt.json:case Qt.jsonb:return P0(e);case Qt.timestamp:return O0(e);case Qt.abstime:case Qt.date:case Qt.daterange:case Qt.int4range:case Qt.int8range:case Qt.money:case Qt.reltime:case Qt.text:case Qt.time:case Qt.timestamptz:case Qt.timetz:case Qt.tsrange:case Qt.tstzrange:return ju(e);default:return ju(e)}},ju=t=>t,C0=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},T0=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},P0=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},I0=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let i;const o=t.slice(1,n);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>Jp(e,l))}return t},O0=t=>typeof t=="string"?t.replace(" ","T"):t,Yp=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class zc{constructor(e,n,r={},a=Fu){this.channel=e,this.event=n,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Eh;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Eh||(Eh={}));class po{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=po.syncState(this.state,a,i,o),this.pendingDiffs.forEach(c=>{this.state=po.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},a=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=po.syncDiff(this.state,a,i,o),l())}),this.onJoin((a,i,o)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:i,newPresences:o})}),this.onLeave((a,i,o)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,a){const i=this.cloneDeep(e),o=this.transformState(n),l={},c={};return this.map(i,(u,h)=>{o[u]||(c[u]=h)}),this.map(o,(u,h)=>{const g=i[u];if(g){const b=h.map(S=>S.presence_ref),p=g.map(S=>S.presence_ref),y=h.filter(S=>p.indexOf(S.presence_ref)<0),_=g.filter(S=>b.indexOf(S.presence_ref)<0);y.length>0&&(l[u]=y),_.length>0&&(c[u]=_)}else l[u]=h}),this.syncDiff(i,{joins:l,leaves:c},r,a)}static syncDiff(e,n,r,a){const{joins:i,leaves:o}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(i,(l,c)=>{var u;const h=(u=e[l])!==null&&u!==void 0?u:[];if(e[l]=this.cloneDeep(c),h.length>0){const g=e[l].map(p=>p.presence_ref),b=h.filter(p=>g.indexOf(p.presence_ref)<0);e[l].unshift(...b)}r(l,h,c)}),this.map(o,(l,c)=>{let u=e[l];if(!u)return;const h=c.map(g=>g.presence_ref);u=u.filter(g=>h.indexOf(g.presence_ref)<0),e[l]=u,a(l,u,c),u.length===0&&delete e[l]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const a=e[r];return"metas"in a?n[r]=a.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=a,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Lh;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Lh||(Lh={}));var go;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(go||(go={}));var ji;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(ji||(ji={}));class gs{constructor(e,n={config:{}},r){var a,i;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=Dn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new zc(this,ei.join,this.params,this.timeout),this.rejoinTimer=new Kp(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Dn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Dn.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Dn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Dn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Dn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ei.reply,{},(o,l)=>{this._trigger(this._replyEventName(l),o)}),this.presence=new po(this),this.broadcastEndpointURL=Yp(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(a=this.params.config)===null||a===void 0?void 0:a.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,a,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Dn.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,u=(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(p=>p.filter))!==null&&a!==void 0?a:[],h=!!this.bindings[go.PRESENCE]&&this.bindings[go.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,g={},b={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:h}),postgres_changes:u,private:c};this.socket.accessTokenValue&&(g.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(ji.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(ji.CLOSED)),this.updateJoinPayload(Object.assign({config:b},g)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:p})=>{var y;if(this.socket._isManualToken()||this.socket.setAuth(),p===void 0){e==null||e(ji.SUBSCRIBED);return}else{const _=this.bindings.postgres_changes,S=(y=_==null?void 0:_.length)!==null&&y!==void 0?y:0,x=[];for(let T=0;T<S;T++){const O=_[T],{filter:{event:E,schema:M,table:ee,filter:G}}=O,X=p&&p[T];if(X&&X.event===E&&gs.isFilterValueEqual(X.schema,M)&&gs.isFilterValueEqual(X.table,ee)&&gs.isFilterValueEqual(X.filter,G))x.push(Object.assign(Object.assign({},O),{id:X.id}));else{this.unsubscribe(),this.state=Dn.errored,e==null||e(ji.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=x,e&&e(ji.SUBSCRIBED);return}}).receive("error",p=>{this.state=Dn.errored,e==null||e(ji.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(ji.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===Dn.joined&&e===go.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var a;if(n==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},l=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(a=r.timeout)!==null&&a!==void 0?a:this.timeout);if(l.status===202)return{success:!0};let c=l.statusText;try{const u=await l.json();c=u.error||u.message||c}catch{}return Promise.reject(new Error(c))}async send(e,n={}){var r,a;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,l={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(l.Authorization=`Bearer ${this.socket.accessTokenValue}`);const c={method:"POST",headers:l,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((a=u.body)===null||a===void 0?void 0:a.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,c;const u=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Dn.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ei.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(a=>{r=new zc(this,ei.leave,{},e),r.receive("ok",()=>{n(),a("ok")}).receive("timeout",()=>{n(),a("timed out")}).receive("error",()=>{a("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Dn.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const a=new AbortController,i=setTimeout(()=>a.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:a.signal}));return clearTimeout(i),o}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new zc(this,e,n,r);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>N0){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var a,i;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:u,join:h}=ei;if(r&&[l,c,u,h].indexOf(o)>=0&&r!==this._joinRef())return;let b=this._onMessage(o,n,r);if(n&&!b)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(p=>{var y,_,S;return((y=p.filter)===null||y===void 0?void 0:y.event)==="*"||((S=(_=p.filter)===null||_===void 0?void 0:_.event)===null||S===void 0?void 0:S.toLocaleLowerCase())===o}).map(p=>p.callback(b,r)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var y,_,S,x,T,O;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const E=p.id,M=(y=p.filter)===null||y===void 0?void 0:y.event;return E&&((_=n.ids)===null||_===void 0?void 0:_.includes(E))&&(M==="*"||(M==null?void 0:M.toLocaleLowerCase())===((S=n.data)===null||S===void 0?void 0:S.type.toLocaleLowerCase()))}else{const E=(T=(x=p==null?void 0:p.filter)===null||x===void 0?void 0:x.event)===null||T===void 0?void 0:T.toLocaleLowerCase();return E==="*"||E===((O=n==null?void 0:n.event)===null||O===void 0?void 0:O.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof b=="object"&&"ids"in b){const y=b.data,{schema:_,table:S,commit_timestamp:x,type:T,errors:O}=y;b=Object.assign(Object.assign({},{schema:_,table:S,commit_timestamp:x,eventType:T,new:{},old:{},errors:O}),this._getPayloadRecords(y))}p.callback(b,r)})}_isClosed(){return this.state===Dn.closed}_isJoined(){return this.state===Dn.joined}_isJoining(){return this.state===Dn.joining}_isLeaving(){return this.state===Dn.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const a=e.toLocaleLowerCase(),i={type:a,filter:n,callback:r};return this.bindings[a]?this.bindings[a].push(i):this.bindings[a]=[i],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(a=>{var i;return!(((i=a.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&gs.isEqual(a.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}static isFilterValueEqual(e,n){return(e??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ei.close,{},e)}_onError(e){this._on(ei.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Dn.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=Nh(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=Nh(e.columns,e.old_record)),n}}const Hc=()=>{},dl={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},R0=[1e3,2e3,5e3,1e4],F0=1e4,D0=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class j0{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Fu,this.transport=null,this.heartbeatIntervalMs=dl.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Hc,this.ref=0,this.reconnectTimer=null,this.vsn=kh,this.logger=Hc,this.conn=null,this.sendBuffer=[],this.serializer=new E0,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=a=>a?(...i)=>a(...i):(...i)=>fetch(...i),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${Du.websocket}`,this.httpEndpoint=Yp(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=w0.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case sa.connecting:return Ra.Connecting;case sa.open:return Ra.Open;case sa.closing:return Ra.Closing;default:return Ra.Closed}}isConnected(){return this.connectionState()===Ra.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,a=this.getChannels().find(i=>i.topic===r);if(a)return a;{const i=new gs(`realtime:${e}`,n,this);return this.channels.push(i),i}}push(e){const{topic:n,event:r,payload:a,ref:i}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${n} ${r} (${i})`,a),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(k0,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},dl.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply"&&n.ref&&n.ref===this.pendingHeartbeatRef){const u=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error",u)}catch(h){this.log("error","error in heartbeat callback",h)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:r,event:a,payload:i,ref:o}=n,l=o?`(${o})`:"",c=i.status||"";this.log("receive",`${c} ${r} ${a} ${l}`.trim(),i),this.channels.filter(u=>u._isMember(r)).forEach(u=>u._trigger(a,i,o)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===sa.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===sa.open||this.conn.readyState===sa.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(n){this.log("error","error in heartbeat callback",n)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(ei.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",a=new URLSearchParams(n);return`${e}${r}${a}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([D0],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n,r=!1;if(e)n=e,r=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(a){this.log("error","Error fetching access token from callback",a),n=this.accessTokenValue}else n=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(a=>{const i={access_token:n,version:S0};n&&a.updateJoinPayload(i),a.joinedOnce&&a._isJoined()&&a._push(ei.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(a){this.log("error",`error in ${e} callback`,a)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Kp(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},dl.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,a,i,o,l,c,u,h,g,b,p;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:Fu,this.heartbeatIntervalMs=(a=e==null?void 0:e.heartbeatIntervalMs)!==null&&a!==void 0?a:dl.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=e==null?void 0:e.heartbeatCallback)!==null&&l!==void 0?l:Hc,this.vsn=(c=e==null?void 0:e.vsn)!==null&&c!==void 0?c:kh,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=e==null?void 0:e.reconnectAfterMs)!==null&&u!==void 0?u:(y=>R0[y-1]||F0),this.vsn){case A0:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:((y,_)=>_(JSON.stringify(y))),this.decode=(g=e==null?void 0:e.decode)!==null&&g!==void 0?g:((y,_)=>_(JSON.parse(y)));break;case Vp:this.encode=(b=e==null?void 0:e.encode)!==null&&b!==void 0?b:this.serializer.encode.bind(this.serializer),this.decode=(p=e==null?void 0:e.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var _o=class extends Error{constructor(t,e){var n;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((n=e.icebergType)==null?void 0:n.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function B0(t,e,n){const r=new URL(e,t);if(n)for(const[a,i]of Object.entries(n))i!==void 0&&r.searchParams.set(a,i);return r.toString()}async function M0(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function U0(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:r,query:a,body:i,headers:o}){const l=B0(t.baseUrl,r,a),c=await M0(t.auth),u=await e(l,{method:n,headers:{...i?{"Content-Type":"application/json"}:{},...c,...o},body:i?JSON.stringify(i):void 0}),h=await u.text(),g=(u.headers.get("content-type")||"").includes("application/json"),b=g&&h?JSON.parse(h):h;if(!u.ok){const p=g?b:void 0,y=p==null?void 0:p.error;throw new _o((y==null?void 0:y.message)??`Request failed with status ${u.status}`,{status:u.status,icebergType:y==null?void 0:y.type,icebergCode:y==null?void 0:y.code,details:p})}return{status:u.status,headers:u.headers,data:b}}}}function hl(t){return t.join("")}var $0=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:hl(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${hl(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${hl(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${hl(t.namespace)}`}),!0}catch(e){if(e instanceof _o&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof _o&&n.status===409)return;throw n}}};function ts(t){return t.join("")}var q0=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ts(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ts(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ts(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ts(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ts(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ts(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof _o&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof _o&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},z0=class{constructor(t){var r;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=U0({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(r=t.accessDelegation)==null?void 0:r.join(","),this.namespaceOps=new $0(this.client,e),this.tableOps=new q0(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},ec=class extends Error{constructor(t,e="storage",n,r){super(t),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=n,this.statusCode=r}};function tc(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var fl=class extends ec{constructor(t,e,n,r="storage"){super(t,r,e,n),this.name=r==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Xp=class extends ec{constructor(t,e,n="storage"){super(t,n),this.name=n==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const H0=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),W0=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Bu=t=>{if(Array.isArray(t))return t.map(n=>Bu(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const a=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[a]=Bu(r)}),e},G0=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function wo(t){"@babel/helpers - typeof";return wo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wo(t)}function V0(t,e){if(wo(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(wo(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function K0(t){var e=V0(t,"string");return wo(e)=="symbol"?e:e+""}function J0(t,e,n){return(e=K0(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ch(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function ot(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ch(Object(n),!0).forEach(function(r){J0(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ch(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const Th=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},Y0=async(t,e,n,r)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const a=t,i=a.status||500;if(typeof a.json=="function")a.json().then(o=>{const l=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||i+"";e(new fl(Th(o),i,l,r))}).catch(()=>{if(r==="vectors"){const o=i+"";e(new fl(a.statusText||`HTTP ${i} error`,i,o,r))}else{const o=i+"";e(new fl(a.statusText||`HTTP ${i} error`,i,o,r))}});else{const o=i+"";e(new fl(a.statusText||`HTTP ${i} error`,i,o,r))}}else e(new Xp(Th(t),t,r))},X0=(t,e,n,r)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||t==="HEAD"||!r?ot(ot({},a),n):(W0(r)?(a.headers=ot({"Content-Type":"application/json"},e==null?void 0:e.headers),a.body=JSON.stringify(r)):a.body=r,e!=null&&e.duplex&&(a.duplex=e.duplex),ot(ot({},a),n))};async function Qs(t,e,n,r,a,i,o){return new Promise((l,c)=>{t(n,X0(e,r,a,i)).then(u=>{if(!u.ok)throw u;if(r!=null&&r.noResolveJson)return u;if(o==="vectors"){const h=u.headers.get("content-type");if(u.headers.get("content-length")==="0"||u.status===204)return{};if(!h||!h.includes("application/json"))return{}}return u.json()}).then(u=>l(u)).catch(u=>Y0(u,c,r,o))})}function Zp(t="storage"){return{get:async(e,n,r,a)=>Qs(e,"GET",n,r,a,void 0,t),post:async(e,n,r,a,i)=>Qs(e,"POST",n,a,i,r,t),put:async(e,n,r,a,i)=>Qs(e,"PUT",n,a,i,r,t),head:async(e,n,r,a)=>Qs(e,"HEAD",n,ot(ot({},r),{},{noResolveJson:!0}),a,void 0,t),remove:async(e,n,r,a,i)=>Qs(e,"DELETE",n,a,i,r,t)}}const Z0=Zp("storage"),{get:xo,post:Qr,put:Mu,head:Q0,remove:hd}=Z0,Lr=Zp("vectors");var Ns=class{constructor(t,e={},n,r="storage"){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.fetch=H0(n),this.namespace=r}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=ot(ot({},this.headers),{},{[t]:e}),this}async handleOperation(t){var e=this;try{return{data:await t(),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(tc(n))return{data:null,error:n};throw n}}},e1=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(tc(e))return{data:null,error:e};throw e}}};let Qp;Qp=Symbol.toStringTag;var t1=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[Qp]="BlobDownloadBuilder",this.promise=null}asStream(){return new e1(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(tc(e))return{data:null,error:e};throw e}}};const n1={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ph={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var r1=class extends Ns{constructor(t,e={},n,r){super(t,e,r,"storage"),this.bucketId=n}async uploadOrUpdate(t,e,n,r){var a=this;return a.handleOperation(async()=>{let i;const o=ot(ot({},Ph),r);let l=ot(ot({},a.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",a.encodeMetadata(c)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),c&&!i.has("metadata")&&i.append("metadata",a.encodeMetadata(c))):(i=n,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=a.toBase64(a.encodeMetadata(c))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),r!=null&&r.headers&&(l=ot(ot({},l),r.headers));const u=a._removeEmptyFolders(e),h=a._getFinalPath(u),g=await(t=="PUT"?Mu:Qr)(a.fetch,`${a.url}/object/${h}`,i,ot({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{path:u,id:g.Id,fullPath:g.Key}})}async upload(t,e,n){return this.uploadOrUpdate("POST",t,e,n)}async uploadToSignedUrl(t,e,n,r){var a=this;const i=a._removeEmptyFolders(t),o=a._getFinalPath(i),l=new URL(a.url+`/object/upload/sign/${o}`);return l.searchParams.set("token",e),a.handleOperation(async()=>{let c;const u=ot({upsert:Ph.upsert},r),h=ot(ot({},a.headers),{"x-upsert":String(u.upsert)});return typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",u.cacheControl)):(c=n,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType),{path:i,fullPath:(await Mu(a.fetch,l.toString(),c,{headers:h})).Key}})}async createSignedUploadUrl(t,e){var n=this;return n.handleOperation(async()=>{let r=n._getFinalPath(t);const a=ot({},n.headers);e!=null&&e.upsert&&(a["x-upsert"]="true");const i=await Qr(n.fetch,`${n.url}/object/upload/sign/${r}`,{},{headers:a}),o=new URL(n.url+i.url),l=o.searchParams.get("token");if(!l)throw new ec("No token returned by API");return{signedUrl:o.toString(),path:t,token:l}})}async update(t,e,n){return this.uploadOrUpdate("PUT",t,e,n)}async move(t,e,n){var r=this;return r.handleOperation(async()=>await Qr(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers}))}async copy(t,e,n){var r=this;return r.handleOperation(async()=>({path:(await Qr(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers})).Key}))}async createSignedUrl(t,e,n){var r=this;return r.handleOperation(async()=>{let a=r._getFinalPath(t),i=await Qr(r.fetch,`${r.url}/object/sign/${a}`,ot({expiresIn:e},n!=null&&n.transform?{transform:n.transform}:{}),{headers:r.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{signedUrl:encodeURI(`${r.url}${i.signedURL}${o}`)}})}async createSignedUrls(t,e,n){var r=this;return r.handleOperation(async()=>{const a=await Qr(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:e,paths:t},{headers:r.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return a.map(o=>ot(ot({},o),{},{signedUrl:o.signedURL?encodeURI(`${r.url}${o.signedURL}${i}`):null}))})}download(t,e,n){const r=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),i=a?`?${a}`:"",o=this._getFinalPath(t),l=()=>xo(this.fetch,`${this.url}/${r}/${o}${i}`,{headers:this.headers,noResolveJson:!0},n);return new t1(l,this.shouldThrowOnError)}async info(t){var e=this;const n=e._getFinalPath(t);return e.handleOperation(async()=>Bu(await xo(e.fetch,`${e.url}/object/info/${n}`,{headers:e.headers})))}async exists(t){var e=this;const n=e._getFinalPath(t);try{return await Q0(e.fetch,`${e.url}/object/${n}`,{headers:e.headers}),{data:!0,error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(tc(r)&&r instanceof Xp){const a=r.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:r}}throw r}}getPublicUrl(t,e){const n=this._getFinalPath(t),r=[],a=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";a!==""&&r.push(a);const i=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});o!==""&&r.push(o);let l=r.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${l}`)}}}async remove(t){var e=this;return e.handleOperation(async()=>await hd(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}))}async list(t,e,n){var r=this;return r.handleOperation(async()=>{const a=ot(ot(ot({},n1),e),{},{prefix:t||""});return await Qr(r.fetch,`${r.url}/object/list/${r.bucketId}`,a,{headers:r.headers},n)})}async listV2(t,e){var n=this;return n.handleOperation(async()=>{const r=ot({},t);return await Qr(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,r,{headers:n.headers},e)})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const i1="2.97.0",To={"X-Client-Info":`storage-js/${i1}`};var a1=class extends Ns{constructor(t,e={},n,r){const a=new URL(t);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase."));const i=a.href.replace(/\/$/,""),o=ot(ot({},To),e);super(i,o,n,"storage")}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const n=e.listBucketOptionsToQueryString(t);return await xo(e.fetch,`${e.url}/bucket${n}`,{headers:e.headers})})}async getBucket(t){var e=this;return e.handleOperation(async()=>await xo(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}))}async createBucket(t,e={public:!1}){var n=this;return n.handleOperation(async()=>await Qr(n.fetch,`${n.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}))}async updateBucket(t,e){var n=this;return n.handleOperation(async()=>await Mu(n.fetch,`${n.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}))}async emptyBucket(t){var e=this;return e.handleOperation(async()=>await Qr(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await hd(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},s1=class extends Ns{constructor(t,e={},n){const r=t.replace(/\/$/,""),a=ot(ot({},To),e);super(r,a,n,"storage")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Qr(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}))}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const n=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&n.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&n.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&n.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&n.set("sortOrder",t.sortOrder),t!=null&&t.search&&n.set("search",t.search);const r=n.toString(),a=r?`${e.url}/bucket?${r}`:`${e.url}/bucket`;return await xo(e.fetch,a,{headers:e.headers})})}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await hd(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}from(t){var e=this;if(!G0(t))throw new ec("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new z0({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(a,i){const o=a[i];return typeof o!="function"?o:async(...l)=>{try{return{data:await o.apply(a,l),error:null}}catch(c){if(r)throw c;return{data:null,error:c}}}}})}},o1=class extends Ns{constructor(t,e={},n){const r=t.replace(/\/$/,""),a=ot(ot({},To),{},{"Content-Type":"application/json"},e);super(r,a,n,"vectors")}async createIndex(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{})}async getIndex(t,e){var n=this;return n.handleOperation(async()=>await Lr.post(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers}))}async listIndexes(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}))}async deleteIndex(t,e){var n=this;return n.handleOperation(async()=>await Lr.post(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers})||{})}},l1=class extends Ns{constructor(t,e={},n){const r=t.replace(/\/$/,""),a=ot(ot({},To),{},{"Content-Type":"application/json"},e);super(r,a,n,"vectors")}async putVectors(t){var e=this;if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{})}async getVectors(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}))}async listVectors(t){var e=this;if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}))}async queryVectors(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}))}async deleteVectors(t){var e=this;if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{})}},c1=class extends Ns{constructor(t,e={},n){const r=t.replace(/\/$/,""),a=ot(ot({},To),{},{"Content-Type":"application/json"},e);super(r,a,n,"vectors")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}async getBucket(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}))}async listBuckets(t={}){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}},u1=class extends c1{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new d1(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,n=this;return e().call(n,t)}async getBucket(t){var e=()=>super.getBucket,n=this;return e().call(n,t)}async listBuckets(t={}){var e=()=>super.listBuckets,n=this;return e().call(n,t)}async deleteBucket(t){var e=()=>super.deleteBucket,n=this;return e().call(n,t)}},d1=class extends o1{constructor(t,e,n,r){super(t,e,r),this.vectorBucketName=n}async createIndex(t){var e=()=>super.createIndex,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,n=this;return e().call(n,n.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,n=this;return e().call(n,n.vectorBucketName,t)}index(t){return new h1(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},h1=class extends l1{constructor(t,e,n,r,a){super(t,e,a),this.vectorBucketName=n,this.indexName=r}async putVectors(t){var e=()=>super.putVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(t){var e=()=>super.getVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},f1=class extends a1{constructor(t,e={},n,r){super(t,e,n,r)}from(t){return new r1(this.url,this.headers,t,this.fetch)}get vectors(){return new u1(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new s1(this.url+"/iceberg",this.headers,this.fetch)}};const eg="2.97.0",ds=30*1e3,Uu=3,Wc=Uu*ds,p1="http://localhost:9999",g1="supabase.auth.token",m1={"X-Client-Info":`gotrue-js/${eg}`},$u="X-Supabase-Api-Version",tg={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},v1=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,b1=600*1e3;class So extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Ye(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class y1 extends So{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function _1(t){return Ye(t)&&t.name==="AuthApiError"}class Fa extends So{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class Ui extends So{constructor(e,n,r,a){super(e,r,a),this.name=n,this.status=r}}class Nr extends Ui{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Gc(t){return Ye(t)&&t.name==="AuthSessionMissingError"}class ns extends Ui{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class pl extends Ui{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class gl extends Ui{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function w1(t){return Ye(t)&&t.name==="AuthImplicitGrantRedirectError"}class Ih extends Ui{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class x1 extends Ui{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class qu extends Ui{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function Vc(t){return Ye(t)&&t.name==="AuthRetryableFetchError"}class Oh extends Ui{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class zu extends Ui{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const $l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Rh=` 	
\r=`.split(""),S1=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Rh.length;e+=1)t[Rh[e].charCodeAt(0)]=-2;for(let e=0;e<$l.length;e+=1)t[$l[e].charCodeAt(0)]=e;return t})();function Fh(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n($l[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n($l[r]),e.queuedBits-=6}}function ng(t,e,n){const r=S1[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Dh(t){const e=[],n=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=o=>{N1(o,r,n)};for(let o=0;o<t.length;o+=1)ng(t.charCodeAt(o),a,i);return e.join("")}function A1(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function k1(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const a=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|a)+65536,n+=1}A1(r,e)}}function N1(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if((t>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function vs(t){const e=[],n={queue:0,queuedBits:0},r=a=>{e.push(a)};for(let a=0;a<t.length;a+=1)ng(t.charCodeAt(a),n,r);return new Uint8Array(e)}function E1(t){const e=[];return k1(t,n=>e.push(n)),new Uint8Array(e)}function ja(t){const e=[],n={queue:0,queuedBits:0},r=a=>{e.push(a)};return t.forEach(a=>Fh(a,n,r)),Fh(null,n,r),e.join("")}function L1(t){return Math.round(Date.now()/1e3)+t}function C1(){return Symbol("auth-callback")}const Wn=()=>typeof window<"u"&&typeof document<"u",La={tested:!1,writable:!1},rg=()=>{if(!Wn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(La.tested)return La.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),La.tested=!0,La.writable=!0}catch{La.tested=!0,La.writable=!1}return La.writable};function T1(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((a,i)=>{e[i]=a})}catch{}return n.searchParams.forEach((r,a)=>{e[a]=r}),e}const ig=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),P1=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",hs=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},Ca=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Hn=async(t,e)=>{await t.removeItem(e)};class nc{constructor(){this.promise=new nc.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}nc.promiseConstructor=Promise;function ml(t){const e=t.split(".");if(e.length!==3)throw new zu("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!v1.test(e[r]))throw new zu("JWT not in base64url format");return{header:JSON.parse(Dh(e[0])),payload:JSON.parse(Dh(e[1])),signature:vs(e[2]),raw:{header:e[0],payload:e[1]}}}async function I1(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function O1(t,e){return new Promise((r,a)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await t(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){a(o);return}}})()})}function R1(t){return("0"+t.toString(16)).substr(-2)}function F1(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let a="";for(let i=0;i<56;i++)a+=n.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(e),Array.from(e,R1).join("")}async function D1(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),a=new Uint8Array(r);return Array.from(a).map(i=>String.fromCharCode(i)).join("")}async function j1(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await D1(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function rs(t,e,n=!1){const r=F1();let a=r;n&&(a+="/PASSWORD_RECOVERY"),await hs(t,`${e}-code-verifier`,a);const i=await j1(r);return[i,r===i?"plain":"s256"]}const B1=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function M1(t){const e=t.headers.get($u);if(!e||!e.match(B1))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function U1(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function $1(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const q1=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function is(t){if(!q1.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Kc(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function z1(t,e){return new Proxy(t,{get:(n,r,a)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,a)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,a)}})}function jh(t){return JSON.parse(JSON.stringify(t))}const Pa=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),H1=[502,503,504];async function Bh(t){var e;if(!P1(t))throw new qu(Pa(t),0);if(H1.includes(t.status))throw new qu(Pa(t),t.status);let n;try{n=await t.json()}catch(i){throw new Fa(Pa(i),i)}let r;const a=M1(t);if(a&&a.getTime()>=tg["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new Oh(Pa(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Nr}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Oh(Pa(n),t.status,n.weak_password.reasons);throw new y1(Pa(n),t.status||500,r)}const W1=(t,e,n,r)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),n))};async function lt(t,e,n,r){var a;const i=Object.assign({},r==null?void 0:r.headers);i[$u]||(i[$u]=tg["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(a=r==null?void 0:r.query)!==null&&a!==void 0?a:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await G1(t,e,n+l,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function G1(t,e,n,r,a,i){const o=W1(e,r,a,i);let l;try{l=await t(n,Object.assign({},o))}catch(c){throw console.error(c),new qu(Pa(c),0)}if(l.ok||await Bh(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(c){await Bh(c)}}function Yr(t){var e;let n=null;J1(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=L1(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function Mh(t){const e=Yr(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function la(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function V1(t){return{data:t,error:null}}function K1(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:a,verification_type:i}=t,o=Ql(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:n,hashed_token:r,redirect_to:a,verification_type:i},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function Uh(t){return t}function J1(t){return t.access_token&&t.refresh_token&&t.expires_in}const Jc=["global","local","others"];class Y1{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=ig(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=Jc[0]){if(Jc.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Jc.join(", ")}`);try{return await lt(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Ye(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await lt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:la})}catch(r){if(Ye(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=Ql(e,["options"]),a=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(a.new_email=r==null?void 0:r.newEmail,delete a.newEmail),await lt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:K1,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(Ye(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await lt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:la})}catch(n){if(Ye(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,a,i,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},h=await lt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(a=e==null?void 0:e.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:Uh});if(h.error)throw h.error;const g=await h.json(),b=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(y=>{const _=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(y.split(";")[1].split("=")[1]);u[`${S}Page`]=_}),u.total=parseInt(b)),{data:Object.assign(Object.assign({},g),u),error:null}}catch(u){if(Ye(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){is(e);try{return await lt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:la})}catch(n){if(Ye(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){is(e);try{return await lt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:la})}catch(r){if(Ye(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){is(e);try{return await lt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:la})}catch(r){if(Ye(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){is(e.userId);try{const{data:n,error:r}=await lt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:n,error:r}}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _deleteFactor(e){is(e.userId),is(e.id);try{return{data:await lt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,a,i,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},h=await lt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(a=e==null?void 0:e.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:Uh});if(h.error)throw h.error;const g=await h.json(),b=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(y=>{const _=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(y.split(";")[1].split("=")[1]);u[`${S}Page`]=_}),u.total=parseInt(b)),{data:Object.assign(Object.assign({},g),u),error:null}}catch(u){if(Ye(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(e){try{return await lt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await lt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await lt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ye(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await lt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await lt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ye(n))return{data:null,error:n};throw n}}}function $h(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const as={debug:!!(globalThis&&rg()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class ag extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class qh extends ag{}async function X1(t,e,n){as.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;e>0&&setTimeout(()=>{r.abort(),as.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve();try{return await globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){as.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,a.name);try{return await n()}finally{as.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,a.name)}}else{if(e===0)throw as.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new qh(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(as.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}})}catch(a){throw(a==null?void 0:a.name)==="AbortError"?new qh(`Acquiring an exclusive Navigator LockManager lock "${t}" timed out waiting ${e}ms`):a}}function Z1(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function sg(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function Q1(t){return parseInt(t,16)}function ev(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function tv(t){var e;const{chainId:n,domain:r,expirationTime:a,issuedAt:i=new Date,nonce:o,notBefore:l,requestId:c,resources:u,scheme:h,uri:g,version:b}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!g)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(b!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${b}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const p=sg(t.address),y=h?`${h}://${r}`:r,_=t.statement?`${t.statement}
`:"",S=`${y} wants you to sign in with your Ethereum account:
${p}

${_}`;let x=`URI: ${g}
Version: ${b}
Chain ID: ${n}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(a&&(x+=`
Expiration Time: ${a.toISOString()}`),l&&(x+=`
Not Before: ${l.toISOString()}`),c&&(x+=`
Request ID: ${c}`),u){let T=`
Resources:`;for(const O of u){if(!O||typeof O!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${O}`);T+=`
- ${O}`}x+=T}return`${S}
${x}`}class En extends Error{constructor({message:e,code:n,cause:r,name:a}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=a??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n}}class ql extends En{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function nv({error:t,options:e}){var n,r,a;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new En({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new En({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new En({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((a=i.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new En({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new En({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new En({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new En({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new En({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(og(o)){if(i.rp.id!==o)return new En({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new En({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new En({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new En({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new En({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function rv({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new En({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new En({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(og(r)){if(n.rpId!==r)return new En({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new En({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new En({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new En({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class iv{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const av=new iv;function sv(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,a=Ql(t,["challenge","user","excludeCredentials"]),i=vs(e).buffer,o=Object.assign(Object.assign({},n),{id:vs(n.id).buffer}),l=Object.assign(Object.assign({},a),{challenge:i,user:o});if(r&&r.length>0){l.excludeCredentials=new Array(r.length);for(let c=0;c<r.length;c++){const u=r[c];l.excludeCredentials[c]=Object.assign(Object.assign({},u),{id:vs(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return l}function ov(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=Ql(t,["challenge","allowCredentials"]),a=vs(e).buffer,i=Object.assign(Object.assign({},r),{challenge:a});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let o=0;o<n.length;o++){const l=n[o];i.allowCredentials[o]=Object.assign(Object.assign({},l),{id:vs(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return i}function lv(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:ja(new Uint8Array(t.response.attestationObject)),clientDataJSON:ja(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function cv(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),a=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:ja(new Uint8Array(a.authenticatorData)),clientDataJSON:ja(new Uint8Array(a.clientDataJSON)),signature:ja(new Uint8Array(a.signature)),userHandle:a.userHandle?ja(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function og(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function zh(){var t,e;return!!(Wn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function uv(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new ql("Browser returned unexpected credential type",e)}:{data:null,error:new ql("Empty credential response",e)}}catch(e){return{data:null,error:nv({error:e,options:t})}}}async function dv(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new ql("Browser returned unexpected credential type",e)}:{data:null,error:new ql("Empty credential response",e)}}catch(e){return{data:null,error:rv({error:e,options:t})}}}const hv={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},fv={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function zl(...t){const e=a=>a!==null&&typeof a=="object"&&!Array.isArray(a),n=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),r={};for(const a of t)if(a)for(const i in a){const o=a[i];if(o!==void 0)if(Array.isArray(o))r[i]=o;else if(n(o))r[i]=o;else if(e(o)){const l=r[i];e(l)?r[i]=zl(l,o):r[i]=zl(o)}else r[i]=o}return r}function pv(t,e){return zl(hv,t,e||{})}function gv(t,e){return zl(fv,t,e||{})}class mv{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:a},i){var o;try{const{data:l,error:c}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!l)return{data:null,error:c};const u=a??av.createNewAbortSignal();if(l.webauthn.type==="create"){const{user:h}=l.webauthn.credential_options.publicKey;if(!h.name){const g=r;if(g)h.name=`${h.id}:${g}`;else{const p=(await this.client.getUser()).data.user,y=((o=p==null?void 0:p.user_metadata)===null||o===void 0?void 0:o.name)||(p==null?void 0:p.email)||(p==null?void 0:p.id)||"User";h.name=`${h.id}:${y}`}}h.displayName||(h.displayName=h.name)}switch(l.webauthn.type){case"create":{const h=pv(l.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:g,error:b}=await uv({publicKey:h,signal:u});return g?{data:{factorId:e,challengeId:l.id,webauthn:{type:l.webauthn.type,credential_response:g}},error:null}:{data:null,error:b}}case"request":{const h=gv(l.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:g,error:b}=await dv(Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:h,signal:u}));return g?{data:{factorId:e,challengeId:l.id,webauthn:{type:l.webauthn.type,credential_response:g}},error:null}:{data:null,error:b}}}}catch(l){return Ye(l)?{data:null,error:l}:{data:null,error:new Fa("Unexpected error in challenge",l)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},i){if(!n)return{data:null,error:new So("rpId is required for WebAuthn authentication")};try{if(!zh())return{data:null,error:new Fa("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:a},{request:i});if(!o)return{data:null,error:l};const{webauthn:c}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:c.type,rpId:n,rpOrigins:r,credential_response:c.credential_response}})}catch(o){return Ye(o)?{data:null,error:o}:{data:null,error:new Fa("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},i){if(!n)return{data:null,error:new So("rpId is required for WebAuthn registration")};try{if(!zh())return{data:null,error:new Fa("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(h=>{var g;return(g=h.data)===null||g===void 0?void 0:g.all.find(b=>b.factor_type==="webauthn"&&b.friendly_name===e&&b.status!=="unverified")}).then(h=>h?this.client.mfa.unenroll({factorId:h==null?void 0:h.id}):void 0),{data:null,error:l};const{data:c,error:u}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:a},{create:i});return c?this._verify({factorId:o.id,challengeId:c.challengeId,webauthn:{rpId:n,rpOrigins:r,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:u}}catch(o){return Ye(o)?{data:null,error:o}:{data:null,error:new Fa("Unexpected error in register",o)}}}}Z1();const vv={url:p1,storageKey:g1,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:m1,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function Hh(t,e,n){return await n()}const ss={};class Ao{get jwks(){var e,n;return(n=(e=ss[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){ss[this.storageKey]=Object.assign(Object.assign({},ss[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=ss[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ss[this.storageKey]=Object.assign(Object.assign({},ss[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},vv),e);if(this.storageKey=i.storageKey,this.instanceID=(n=Ao.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,Ao.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&Wn()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Y1({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=ig(i.fetch),this.lock=i.lock||Hh,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,this.lockAcquireTimeout=i.lockAcquireTimeout,i.lock?this.lock=i.lock:this.persistSession&&Wn()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=X1:this.lock=Hh,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new mv(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:rg()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=$h(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=$h(this.memoryStorage)),Wn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o);try{await this._notifyAllSubscribers(o.data.event,o.data.session,!1)}catch(l){this._debug("#broadcastChannel","error",l)}})}i.skipAutoInitialize||this.initialize().catch(o=>{this._debug("#initialize()","error",o)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${eg}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(Wn()&&(n=T1(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),Wn()&&this.detectSessionInUrl&&r!=="none"){const{data:a,error:i}=await this._getSessionFromURL(n,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),w1(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return{error:i}}const{session:o,redirectType:l}=a;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Ye(n)?this._returnResult({error:n}):this._returnResult({error:new Fa("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,a;try{const i=await lt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=e==null?void 0:e.options)===null||a===void 0?void 0:a.captchaToken}},xform:Yr}),{data:o,error:l}=i;if(l||!o)return this._returnResult({data:{user:null,session:null},error:l});const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(i){if(Ye(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var n,r,a;try{let i;if("email"in e){const{email:h,password:g,options:b}=e;let p=null,y=null;this.flowType==="pkce"&&([p,y]=await rs(this.storage,this.storageKey)),i=await lt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:b==null?void 0:b.emailRedirectTo,body:{email:h,password:g,data:(n=b==null?void 0:b.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:b==null?void 0:b.captchaToken},code_challenge:p,code_challenge_method:y},xform:Yr})}else if("phone"in e){const{phone:h,password:g,options:b}=e;i=await lt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:g,data:(r=b==null?void 0:b.data)!==null&&r!==void 0?r:{},channel:(a=b==null?void 0:b.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:b==null?void 0:b.captchaToken}},xform:Yr})}else throw new pl("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return await Hn(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:l});const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(i){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let n;if("email"in e){const{email:i,password:o,options:l}=e;n=await lt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Mh})}else if("phone"in e){const{phone:i,password:o,options:l}=e;n=await lt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Mh})}else throw new pl("You must provide either an email or phone number and a password");const{data:r,error:a}=n;if(a)return this._returnResult({data:{user:null,session:null},error:a});if(!r||!r.session||!r.user){const i=new ns;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(n){if(Ye(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,a,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,a,i,o,l,c,u,h,g,b;let p,y;if("message"in e)p=e.message,y=e.signature;else{const{chain:_,wallet:S,statement:x,options:T}=e;let O;if(Wn())if(typeof S=="object")O=S;else{const F=window;if("ethereum"in F&&typeof F.ethereum=="object"&&"request"in F.ethereum&&typeof F.ethereum.request=="function")O=F.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!(T!=null&&T.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");O=S}const E=new URL((n=T==null?void 0:T.url)!==null&&n!==void 0?n:window.location.href),M=await O.request({method:"eth_requestAccounts"}).then(F=>F).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!M||M.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const ee=sg(M[0]);let G=(r=T==null?void 0:T.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!G){const F=await O.request({method:"eth_chainId"});G=Q1(F)}const X={domain:E.host,address:ee,statement:x,uri:E.href,version:"1",chainId:G,nonce:(a=T==null?void 0:T.signInWithEthereum)===null||a===void 0?void 0:a.nonce,issuedAt:(o=(i=T==null?void 0:T.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(l=T==null?void 0:T.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=T==null?void 0:T.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(u=T==null?void 0:T.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(h=T==null?void 0:T.signInWithEthereum)===null||h===void 0?void 0:h.resources};p=tv(X),y=await O.request({method:"personal_sign",params:[ev(p),ee]})}try{const{data:_,error:S}=await lt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:y},!((g=e.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(b=e.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:Yr});if(S)throw S;if(!_||!_.session||!_.user){const x=new ns;return this._returnResult({data:{user:null,session:null},error:x})}return _.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),this._returnResult({data:Object.assign({},_),error:S})}catch(_){if(Ye(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async signInWithSolana(e){var n,r,a,i,o,l,c,u,h,g,b,p;let y,_;if("message"in e)y=e.message,_=e.signature;else{const{chain:S,wallet:x,statement:T,options:O}=e;let E;if(Wn())if(typeof x=="object")E=x;else{const ee=window;if("solana"in ee&&typeof ee.solana=="object"&&("signIn"in ee.solana&&typeof ee.solana.signIn=="function"||"signMessage"in ee.solana&&typeof ee.solana.signMessage=="function"))E=ee.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof x!="object"||!(O!=null&&O.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=x}const M=new URL((n=O==null?void 0:O.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in E&&E.signIn){const ee=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},O==null?void 0:O.signInWithSolana),{version:"1",domain:M.host,uri:M.href}),T?{statement:T}:null));let G;if(Array.isArray(ee)&&ee[0]&&typeof ee[0]=="object")G=ee[0];else if(ee&&typeof ee=="object"&&"signedMessage"in ee&&"signature"in ee)G=ee;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in G&&"signature"in G&&(typeof G.signedMessage=="string"||G.signedMessage instanceof Uint8Array)&&G.signature instanceof Uint8Array)y=typeof G.signedMessage=="string"?G.signedMessage:new TextDecoder().decode(G.signedMessage),_=G.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${M.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),...T?["",T,""]:[""],"Version: 1",`URI: ${M.href}`,`Issued At: ${(a=(r=O==null?void 0:O.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((i=O==null?void 0:O.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${O.signInWithSolana.notBefore}`]:[],...!((o=O==null?void 0:O.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${O.signInWithSolana.expirationTime}`]:[],...!((l=O==null?void 0:O.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${O.signInWithSolana.chainId}`]:[],...!((c=O==null?void 0:O.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${O.signInWithSolana.nonce}`]:[],...!((u=O==null?void 0:O.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${O.signInWithSolana.requestId}`]:[],...!((g=(h=O==null?void 0:O.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||g===void 0)&&g.length?["Resources",...O.signInWithSolana.resources.map(G=>`- ${G}`)]:[]].join(`
`);const ee=await E.signMessage(new TextEncoder().encode(y),"utf8");if(!ee||!(ee instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");_=ee}}try{const{data:S,error:x}=await lt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:ja(_)},!((b=e.options)===null||b===void 0)&&b.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Yr});if(x)throw x;if(!S||!S.session||!S.user){const T=new ns;return this._returnResult({data:{user:null,session:null},error:T})}return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),this._returnResult({data:Object.assign({},S),error:x})}catch(S){if(Ye(S))return this._returnResult({data:{user:null,session:null},error:S});throw S}}async _exchangeCodeForSession(e){const n=await Ca(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(n??"").split("/");try{if(!r&&this.flowType==="pkce")throw new x1;const{data:i,error:o}=await lt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Yr});if(await Hn(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const l=new ns;return this._returnResult({data:{user:null,session:null,redirectType:null},error:l})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:a??null}),error:o})}catch(i){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:n,provider:r,token:a,access_token:i,nonce:o}=e,l=await lt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Yr}),{data:c,error:u}=l;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!c||!c.session||!c.user){const h=new ns;return this._returnResult({data:{user:null,session:null},error:h})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:u})}catch(n){if(Ye(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,a,i,o;try{if("email"in e){const{email:l,options:c}=e;let u=null,h=null;this.flowType==="pkce"&&([u,h]=await rs(this.storage,this.storageKey));const{error:g}=await lt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:h},redirectTo:c==null?void 0:c.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:g})}if("phone"in e){const{phone:l,options:c}=e,{data:u,error:h}=await lt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(a=c==null?void 0:c.data)!==null&&a!==void 0?a:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:h})}throw new pl("You must provide either an email or phone number.")}catch(l){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async verifyOtp(e){var n,r;try{let a,i;"options"in e&&(a=(n=e.options)===null||n===void 0?void 0:n.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:l}=await lt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:a,xform:Yr});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(a){if(Ye(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSSO(e){var n,r,a,i,o;try{let l=null,c=null;this.flowType==="pkce"&&([l,c]=await rs(this.storage,this.storageKey));const u=await lt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=e==null?void 0:e.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:c}),headers:this.headers,xform:V1});return!((i=u.data)===null||i===void 0)&&i.url&&Wn()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(l){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(l))return this._returnResult({data:null,error:l});throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Nr;const{error:a}=await lt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:a})})}catch(e){if(Ye(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:a,options:i}=e,{error:o}=await lt(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:r,type:a,options:i}=e,{data:o,error:l}=await lt(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l})}throw new pl("You must provide either an email or phone number and a type")}catch(n){if(Ye(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await Ca(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Wc:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await Ca(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=Kc()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=z1(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:a,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:a},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const n=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(e){try{return e?await lt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:la}):await this._useSession(async n=>{var r,a,i;const{data:o,error:l}=n;if(l)throw l;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Nr}:await lt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(a=o.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0,xform:la})})}catch(n){if(Ye(n))return Gc(n)&&(await this._removeSession(),await Hn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:a,error:i}=r;if(i)throw i;if(!a.session)throw new Nr;const o=a.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await rs(this.storage,this.storageKey));const{data:u,error:h}=await lt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:la});if(h)throw h;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Nr;const n=Date.now()/1e3;let r=n,a=!0,i=null;const{payload:o}=ml(e.access_token);if(o.exp&&(r=o.exp,a=r<=n),a){const{data:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(n){if(Ye(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:o,error:l}=n;if(l)throw l;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Nr;const{data:a,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):a?this._returnResult({data:{user:a.user,session:a},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Ye(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Wn())throw new gl("No browser detected.");if(e.error||e.error_description||e.error_code)throw new gl(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new Ih("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new gl("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ih("No code detected.");const{data:T,error:O}=await this._exchangeCodeForSession(e.code);if(O)throw O;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:T.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:a,access_token:i,refresh_token:o,expires_in:l,expires_at:c,token_type:u}=e;if(!i||!l||!o||!u)throw new gl("No session defined in URL");const h=Math.round(Date.now()/1e3),g=parseInt(l);let b=h+g;c&&(b=parseInt(c));const p=b-h;p*1e3<=ds&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${g}s`);const y=b-g;h-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,b,h):h-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,b,h);const{data:_,error:S}=await this._getUser(i);if(S)throw S;const x={provider_token:r,provider_refresh_token:a,access_token:i,expires_in:g,expires_at:b,refresh_token:o,token_type:u,user:_.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:x,redirectType:e.type},error:null})}catch(r){if(Ye(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await Ca(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i&&!Gc(i))return this._returnResult({error:i});const o=(r=a.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(_1(l)&&(l.status===404||l.status===401||l.status===403)||Gc(l)))return this._returnResult({error:l})}return e!=="others"&&(await this._removeSession(),await Hn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=C1(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,a;try{const{data:{session:i},error:o}=n;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,n={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await rs(this.storage,this.storageKey,!0));try{return await lt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:a}=await this._useSession(async i=>{var o,l,c,u,h;const{data:g,error:b}=i;if(b)throw b;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await lt(this.fetch,"GET",p,{headers:this.headers,jwt:(h=(u=g.session)===null||u===void 0?void 0:u.access_token)!==null&&h!==void 0?h:void 0})});if(a)throw a;return Wn()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(Ye(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:a,data:{session:i}}=n;if(a)throw a;const{options:o,provider:l,token:c,access_token:u,nonce:h}=e,g=await lt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i==null?void 0:i.access_token)!==null&&r!==void 0?r:void 0,body:{provider:l,id_token:c,access_token:u,nonce:h,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Yr}),{data:b,error:p}=g;return p?this._returnResult({data:{user:null,session:null},error:p}):!b||!b.session||!b.user?this._returnResult({data:{user:null,session:null},error:new ns}):(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("USER_UPDATED",b.session)),this._returnResult({data:b,error:p}))}catch(a){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,a;const{data:i,error:o}=n;if(o)throw o;return await lt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(a=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await O1(async a=>(a>0&&await I1(200*Math.pow(2,a-1)),this._debug(n,"refreshing attempt",a),await lt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Yr})),(a,i)=>{const o=200*Math.pow(2,a);return i&&Vc(i)&&Date.now()+o-r<ds})}catch(r){if(this._debug(n,"error",r),Ye(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Wn()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const a=await Ca(this.storage,this.storageKey);if(a&&this.userStorage){let o=await Ca(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:a.user},await hs(this.userStorage,this.storageKey+"-user",o)),a.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:Kc()}else if(a&&!a.user&&!a.user){const o=await Ca(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(a.user=o.user,await Hn(this.storage,this.storageKey+"-user"),await hs(this.storage,this.storageKey,a)):a.user=Kc()}if(this._debug(r,"session from storage",a),!this._isValidSession(a)){this._debug(r,"session is not valid"),a!==null&&await this._removeSession();return}const i=((n=a.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Wc;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${Wc}s`),i){if(this.autoRefreshToken&&a.refresh_token){const{error:o}=await this._callRefreshToken(a.refresh_token);o&&(console.error(o),Vc(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(a.access_token);!l&&(o!=null&&o.user)?(a.user=o.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(r,"error",a),console.error(a);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Nr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new nc;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Nr;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={data:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(a,"error",i),Ye(i)){const o={data:null,error:i};return Vc(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,n,r=!0){const a=`#_notifyAllSubscribers(${e})`;this._debug(a,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,n)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Hn(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await hs(this.userStorage,this.storageKey+"-user",{user:n.user});const a=Object.assign({},n);delete a.user;const i=jh(a);await hs(this.storage,this.storageKey,i)}else{const a=jh(n);await hs(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Hn(this.storage,this.storageKey),await Hn(this.storage,this.storageKey+"-code-verifier"),await Hn(this.storage,this.storageKey+"-user"),this.userStorage&&await Hn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Wn()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ds);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const n=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const n=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,n&&clearTimeout(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-e)/ds);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${ds}ms, refresh threshold is ${Uu} ticks`),a<=Uu&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof ag)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Wn()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const a=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await rs(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});a.push(l.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);a.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${a.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;return i?this._returnResult({data:null,error:i}):await lt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,a;const{data:i,error:o}=n;if(o)return this._returnResult({data:null,error:o});const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:u}=await lt(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return u?this._returnResult({data:null,error:u}):(e.factorType==="totp"&&c.type==="totp"&&(!((a=c==null?void 0:c.totp)===null||a===void 0)&&a.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?lv(e.webauthn.credential_response):cv(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:c}=await lt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:c}))})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=await lt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:l}=o;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:sv(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:ov(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const a={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])a.all.push(i),i.status==="verified"&&a[i.factor_type].push(i);return{data:a,error:null}}async _getAuthenticatorAssuranceLevel(e){var n,r,a,i;if(e)try{const{payload:p}=ml(e);let y=null;p.aal&&(y=p.aal);let _=y;const{data:{user:S},error:x}=await this.getUser(e);if(x)return this._returnResult({data:null,error:x});((r=(n=S==null?void 0:S.factors)===null||n===void 0?void 0:n.filter(E=>E.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(_="aal2");const O=p.amr||[];return{data:{currentLevel:y,nextLevel:_,currentAuthenticationMethods:O},error:null}}catch(p){if(Ye(p))return this._returnResult({data:null,error:p});throw p}const{data:{session:o},error:l}=await this.getSession();if(l)return this._returnResult({data:null,error:l});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:c}=ml(o.access_token);let u=null;c.aal&&(u=c.aal);let h=u;((i=(a=o.user.factors)===null||a===void 0?void 0:a.filter(p=>p.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(h="aal2");const b=c.amr||[];return{data:{currentLevel:u,nextLevel:h,currentAuthenticationMethods:b},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;return a?this._returnResult({data:null,error:a}):r?await lt(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Nr})})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:a},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!a)return this._returnResult({data:null,error:new Nr});const o=await lt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"approve"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&Wn()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Ye(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:a},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!a)return this._returnResult({data:null,error:new Nr});const o=await lt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"deny"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&Wn()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Ye(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;return r?this._returnResult({data:null,error:r}):n?await lt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new Nr})})}catch(e){if(Ye(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;return a?this._returnResult({data:null,error:a}):r?(await lt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Nr})})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(l=>l.kid===e);if(r)return r;const a=Date.now();if(r=this.jwks.keys.find(l=>l.kid===e),r&&this.jwks_cached_at+b1>a)return r;const{data:i,error:o}=await lt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=a,r=i.keys.find(l=>l.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:p,error:y}=await this.getSession();if(y||!p.session)return this._returnResult({data:null,error:y});r=p.session.access_token}const{header:a,payload:i,signature:o,raw:{header:l,payload:c}}=ml(r);n!=null&&n.allowExpired||U1(i.exp);const u=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!u){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:i,header:a,signature:o},error:null}}const h=$1(a.alg),g=await crypto.subtle.importKey("jwk",u,h,!0,["verify"]);if(!await crypto.subtle.verify(h,g,o,E1(`${l}.${c}`)))throw new zu("Invalid JWT signature");return{data:{claims:i,header:a,signature:o},error:null}}catch(r){if(Ye(r))return this._returnResult({data:null,error:r});throw r}}}Ao.nextInstanceID={};const bv=Ao,yv="2.97.0";let co="";typeof Deno<"u"?co="deno":typeof document<"u"?co="web":typeof navigator<"u"&&navigator.product==="ReactNative"?co="react-native":co="node";const _v={"X-Client-Info":`supabase-js-${co}/${yv}`},wv={headers:_v},xv={schema:"public"},Sv={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Av={};function ko(t){"@babel/helpers - typeof";return ko=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ko(t)}function kv(t,e){if(ko(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(ko(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Nv(t){var e=kv(t,"string");return ko(e)=="symbol"?e:e+""}function Ev(t,e,n){return(e=Nv(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Wh(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function pn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Wh(Object(n),!0).forEach(function(r){Ev(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Wh(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const Lv=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Cv=()=>Headers,Tv=(t,e,n)=>{const r=Lv(n),a=Cv();return async(i,o)=>{var l;const c=(l=await e())!==null&&l!==void 0?l:t;let u=new a(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",t),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),r(i,pn(pn({},o),{},{headers:u}))}};function Pv(t){return t.endsWith("/")?t:t+"/"}function Iv(t,e){var n,r;const{db:a,auth:i,realtime:o,global:l}=t,{db:c,auth:u,realtime:h,global:g}=e,b={db:pn(pn({},c),a),auth:pn(pn({},u),i),realtime:pn(pn({},h),o),storage:{},global:pn(pn(pn({},g),l),{},{headers:pn(pn({},(n=g==null?void 0:g.headers)!==null&&n!==void 0?n:{}),(r=l==null?void 0:l.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?b.accessToken=t.accessToken:delete b.accessToken,b}function Ov(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Pv(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Rv=class extends bv{constructor(t){super(t)}},Fv=class{constructor(t,e,n){var r,a;this.supabaseUrl=t,this.supabaseKey=e;const i=Ov(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,l={db:xv,realtime:Av,auth:pn(pn({},Sv),{},{storageKey:o}),global:wv},c=Iv(n??{},l);if(this.storageKey=(r=c.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(a=c.global.headers)!==null&&a!==void 0?a:{},c.accessToken)this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(h,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}});else{var u;this.auth=this._initSupabaseAuthClient((u=c.auth)!==null&&u!==void 0?u:{},this.headers,c.global.fetch)}this.fetch=Tv(e,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(pn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new _0(new URL("rest/v1",i).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch,timeout:c.db.timeout,urlLengthLimit:c.db.urlLengthLimit}),this.storage=new f1(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new h0(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,n;if(t.accessToken)return await t.accessToken();const{data:r}=await t.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:a,storageKey:i,flowType:o,lock:l,debug:c,throwOnError:u},h,g){const b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Rv({url:this.authUrl.href,headers:pn(pn({},b),h),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:a,flowType:o,lock:l,debug:c,throwOnError:u,fetch:g,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new j0(this.realtimeUrl.href,pn(pn({},t),{},{params:pn(pn({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(t,e,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Dv=(t,e,n)=>new Fv(t,e,n);function jv(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const e=t.version;if(e==null)return!1;const n=e.match(/^v(\d+)\./);return n?parseInt(n[1],10)<=18:!1}jv()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Bv="https://ujuxhijcomgkqfwaovow.supabase.co",Mv="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdXhoaWpjb21na3Fmd2Fvdm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3NTg0NzgsImV4cCI6MjA4NzMzNDQ3OH0.pZuqL4HDtt5Z8yFf7tQNe5hTEz_W0_zyIV-lPebV_1Q",Ne=Dv(Bv,Mv),lg=ud(null);function Uv({children:t}){const[e,n]=me(null),[r,a]=me(!0);Mt(()=>{Ne.auth.getSession().then(({data:{session:c}})=>{n((c==null?void 0:c.user)??null),a(!1)});const{data:{subscription:l}}=Ne.auth.onAuthStateChange((c,u)=>{n((u==null?void 0:u.user)??null)});return()=>l.unsubscribe()},[]);const i=Nt(async(l,c)=>{const{error:u}=await Ne.auth.signInWithPassword({email:l,password:c});if(u)throw u},[]),o=Nt(async()=>{await Ne.auth.signOut()},[]);return s(lg.Provider,{value:{user:e,loading:r,signIn:i,signOut:o},children:t})}function rc(){const t=zp(lg);if(!t)throw new Error("useAuth must be used within AuthProvider");return t}const cg=ud(null);function $v({children:t}){const[e,n]=me([]),r=Nt((i,o="info")=>{const l=Date.now();n(c=>[...c,{id:l,message:i,type:o}]),setTimeout(()=>{n(c=>c.filter(u=>u.id!==l))},3e3)},[]),a={success:i=>r(i,"success"),error:i=>r(i,"error"),info:i=>r(i,"info")};return s(cg.Provider,{value:a,children:[t,s("div",{class:"toast-container",children:e.map(i=>s("div",{class:`toast toast-${i.type}`,children:i.message},i.id))})]})}function Gn(){return zp(cg)}var qv={};function vl(t,e){for(var n in e)t[n]=e[n];return t}function zv(t,e,n){var r,a=/(?:\?([^#]*))?(#.*)?$/,i=t.match(a),o={};if(i&&i[1])for(var l=i[1].split("&"),c=0;c<l.length;c++){var u=l[c].split("=");o[decodeURIComponent(u[0])]=decodeURIComponent(u.slice(1).join("="))}t=Hu(t.replace(a,"")),e=Hu(e||"");for(var h=Math.max(t.length,e.length),g=0;g<h;g++)if(e[g]&&e[g].charAt(0)===":"){var b=e[g].replace(/(^:|[+*?]+$)/g,""),p=(e[g].match(/[+*?]+$/)||qv)[0]||"",y=~p.indexOf("+"),_=~p.indexOf("*"),S=t[g]||"";if(!S&&!_&&(p.indexOf("?")<0||y)){r=!1;break}if(o[b]=decodeURIComponent(S),y||_){o[b]=t.slice(g).map(decodeURIComponent).join("/");break}}else if(e[g]!==t[g]){r=!1;break}return(n.default===!0||r!==!1)&&o}function Hv(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:t.index-e.index}function Wv(t,e){return t.index=e,t.rank=(function(n){return n.props.default?0:Hu(n.props.path).map(Gv).join("")})(t),t.props}function Hu(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function Gv(t){return t.charAt(0)==":"?1+"*+?".indexOf(t.charAt(t.length-1))||4:5}var Vv={},Ba=[],Gh=[],Er=null,ug={url:fd()},Kv=ud(ug);function fd(){var t;return""+((t=Er&&Er.location?Er.location:Er&&Er.getCurrentLocation?Er.getCurrentLocation():typeof location<"u"?location:Vv).pathname||"")+(t.search||"")}function qe(t,e){return e===void 0&&(e=!1),typeof t!="string"&&t.url&&(e=t.replace,t=t.url),(function(n){for(var r=Ba.length;r--;)if(Ba[r].canRoute(n))return!0;return!1})(t)&&(function(n,r){r===void 0&&(r="push"),Er&&Er[r]?Er[r](n):typeof history<"u"&&history[r+"State"]&&history[r+"State"](null,null,n)})(t,e?"replace":"push"),dg(t)}function dg(t){for(var e=!1,n=0;n<Ba.length;n++)Ba[n].routeTo(t)&&(e=!0);return e}function Jv(t){if(t&&t.getAttribute){var e=t.getAttribute("href"),n=t.getAttribute("target");if(e&&e.match(/^\//g)&&(!n||n.match(/^_?self$/i)))return qe(e)}}function Yv(t){return t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),!1}function Xv(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button)){var e=t.target;do if(e.localName==="a"&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))return;if(Jv(e))return Yv(t)}while(e=e.parentNode)}}var Vh=!1;function hg(t){t.history&&(Er=t.history),this.state={url:t.url||fd()}}vl(hg.prototype=new ho,{shouldComponentUpdate:function(t){return t.static!==!0||t.url!==this.props.url||t.onChange!==this.props.onChange},canRoute:function(t){var e=Pu(this.props.children);return this.g(e,t)!==void 0},routeTo:function(t){this.setState({url:t});var e=this.canRoute(t);return this.p||this.forceUpdate(),e},componentWillMount:function(){this.p=!0},componentDidMount:function(){var t=this;Vh||(Vh=!0,Er||addEventListener("popstate",function(){dg(fd())}),addEventListener("click",Xv)),Ba.push(this),Er&&(this.u=Er.listen(function(e){var n=e.location||e;t.routeTo(""+(n.pathname||"")+(n.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),Ba.splice(Ba.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(t,e){t=t.filter(Wv).sort(Hv);for(var n=0;n<t.length;n++){var r=t[n],a=zv(e,r.props.path,r.props);if(a)return[r,a]}},render:function(t,e){var n,r,a=t.onChange,i=e.url,o=this.c,l=this.g(Pu(t.children),i);if(l&&(r=i0(l[0],vl(vl({url:i,matches:n=l[1]},n),{key:void 0,ref:void 0}))),i!==(o&&o.url)){vl(ug,o=this.c={url:i,previous:o&&o.url,current:r,path:r?r.props.path:null,matches:n}),o.router=this,o.active=r?[r]:[];for(var c=Gh.length;c--;)Gh[c]({});typeof a=="function"&&a(o)}return Rp(Kv.Provider,{value:o},r)}});function Zv({children:t}){const{signOut:e}=rc(),[n,r]=me(!1),[a,i]=me(typeof window<"u"?window.location.pathname:"/crm/");Mt(()=>{const c=()=>i(window.location.pathname);return window.addEventListener("popstate",c),()=>window.removeEventListener("popstate",c)},[]);function o(c){r(!1),qe(c),i(c)}return s("div",{class:"app-layout",children:[s("button",{class:"mobile-toggle",onClick:()=>r(!n),"aria-label":"Menu",children:n?"":""}),s("aside",{class:`sidebar ${n?"open":""}`,children:[s("div",{class:"sidebar-brand",onClick:()=>o("/crm/"),style:"cursor:pointer",children:"Beck360 CRM"}),s("nav",{class:"sidebar-nav",children:[{path:"/crm/",label:"Dashboard",icon:""},{path:"/crm/pipeline",label:"Pipeline",icon:""},{path:"/crm/contacts",label:"Kontakte",icon:""},{path:"/crm/companies",label:"Firmen",icon:""},{path:"/crm/invoices",label:"Rechnungen",icon:""},{path:"/crm/expenses",label:"Ausgaben",icon:""},{path:"/crm/reports",label:"Berichte",icon:""},{path:"/crm/campaigns",label:"Kampagnen",icon:""},{path:"/crm/settings",label:"Einstellungen",icon:""}].map(c=>s("a",{class:`nav-item ${(c.path==="/crm/"?a==="/crm/":a.startsWith(c.path))?"active":""}`,href:c.path,onClick:u=>{u.preventDefault(),o(c.path)},children:[s("span",{class:"nav-icon",children:c.icon}),c.label]},c.path))}),s("div",{class:"sidebar-footer",children:s("button",{class:"btn btn-secondary btn-sm",style:"width: 100%",onClick:e,children:"Abmelden"})})]}),n&&s("div",{style:"position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:99",onClick:()=>r(!1)}),s("main",{class:"main-content",children:t})]})}function Qv(){const{signIn:t}=rc(),[e,n]=me(""),[r,a]=me(""),[i,o]=me(null),[l,c]=me(!1);async function u(h){h.preventDefault(),o(null),c(!0);try{await t(e,r)}catch(g){o(g.message==="Invalid login credentials"?"Ungueltige Anmeldedaten":g.message)}c(!1)}return s("div",{class:"login-page",children:s("form",{class:"login-card",onSubmit:u,children:[s("div",{class:"login-title",children:"Beck360 CRM"}),s("div",{class:"login-subtitle",children:"Anmelden"}),i&&s("div",{class:"login-error",children:i}),s("div",{class:"form-group",children:[s("label",{for:"login-email",children:"E-Mail"}),s("input",{id:"login-email",type:"email",value:e,onInput:h=>n(h.target.value),required:!0,autocomplete:"email"})]}),s("div",{class:"form-group",children:[s("label",{for:"login-password",children:"Passwort"}),s("input",{id:"login-password",type:"password",value:r,onInput:h=>a(h.target.value),required:!0,autocomplete:"current-password"})]}),s("button",{type:"submit",class:"btn btn-primary",style:"width: 100%; justify-content: center",disabled:l,children:l?"Anmelden...":"Anmelden"})]})})}function e2(){const[t,e]=me({totalContacts:0,newLeadsThisMonth:0,pipelineValue:0,wonDeals:0,conversionRate:0,dealsByStage:{}}),[n,r]=me([]),[a,i]=me(!0),o=Nt(async()=>{i(!0);const l=new Date,c=new Date(l.getFullYear(),l.getMonth(),1).toISOString(),[{count:u},{count:h},{data:g},{data:b},{data:p},{data:y}]=await Promise.all([Ne.from("contacts").select("*",{count:"exact",head:!0}).is("deleted_at",null),Ne.from("contacts").select("*",{count:"exact",head:!0}).is("deleted_at",null).gte("created_at",c),Ne.from("deals").select("value, stage").is("deleted_at",null).not("stage","in",'("won","lost")'),Ne.from("deals").select("value").is("deleted_at",null).eq("stage","won"),Ne.from("deals").select("stage").is("deleted_at",null),Ne.from("activities").select("*").order("created_at",{ascending:!1}).limit(10)]),_=(g||[]).reduce((E,M)=>E+(M.value||0),0),S=(b||[]).length,x=(p||[]).length,T=x>0?Math.round(S/x*100):0,O={};for(const E of p||[])O[E.stage]=(O[E.stage]||0)+1;e({totalContacts:u||0,newLeadsThisMonth:h||0,pipelineValue:_,wonDeals:S,conversionRate:T,dealsByStage:O}),r(y||[]),i(!1)},[]);return Mt(()=>{o()},[o]),{stats:t,recentActivities:n,loading:a,refetch:o}}const As={invoice:{label:"Rechnung",prefix:"R"},quote:{label:"Angebot",prefix:"A"}},Qn={draft:{label:"Entwurf",color:"#6366f1"},sent:{label:"Versendet",color:"#f59e0b"},paid:{label:"Bezahlt",color:"#10b981"},overdue:{label:"Ueberfaellig",color:"#ef4444"},cancelled:{label:"Storniert",color:"#64748b"}};function Tl(t,e,n){var u;const r=new Date,a=r.getFullYear(),i=String(r.getMonth()+1).padStart(2,"0"),o=String(r.getDate()).padStart(2,"0"),l=((u=As[t])==null?void 0:u.prefix)||"R",c=Kh(e)||Kh(n)||"XX";return`${l}-${a}-${i}-${o}-${c}`}function Kh(t){if(!t||!t.trim())return"";const e=t.trim(),n=e.split(/\s+/);return n.length>=2?n.map(r=>r[0]).join("").toUpperCase().slice(0,4):e.slice(0,3).toUpperCase()}function t2(t,e=0,n=19){const r=t.reduce((c,u)=>c+(parseFloat(u.quantity)||0)*(parseFloat(u.unit_price)||0),0),a=r*(parseFloat(e)||0)/100,i=r-a,o=i*(parseFloat(n)||0)/100,l=i+o;return{subtotal:eo(r),discount_amount:eo(a),net_amount:eo(i),vat_amount:eo(o),total_amount:eo(l)}}function eo(t){return Math.round(t*100)/100}function pd({type:t=null,status:e=null,companyId:n=null,dealId:r=null}={}){const[a,i]=me([]),[o,l]=me(!0),c=Nt(async()=>{l(!0);let u=Ne.from("invoices").select(`
        *,
        company:companies(id, name),
        contact:contacts(id, first_name, last_name)
      `).is("deleted_at",null).order("created_at",{ascending:!1});t&&(u=u.eq("type",t)),e&&(u=u.eq("status",e)),n&&(u=u.eq("company_id",n)),r&&(u=u.eq("deal_id",r));const{data:h,error:g}=await u;g||i(h||[]),l(!1)},[t,e,n,r]);return Mt(()=>{c()},[c]),{invoices:a,loading:o,refetch:c}}function fg(t){const[e,n]=me(null),[r,a]=me([]),[i,o]=me(!0),[l,c]=me(null),u=Nt(async()=>{if(!t)return;o(!0),c(null);const[g,b]=await Promise.all([Ne.from("invoices").select(`
          *,
          company:companies(id, name),
          contact:contacts(id, first_name, last_name, email, phone)
        `).eq("id",t).is("deleted_at",null).single(),Ne.from("invoice_items").select("*").eq("invoice_id",t).order("position",{ascending:!0})]);g.error&&(console.error("useInvoice fetch error:",g.error),c(g.error)),b.error&&console.error("useInvoice items error:",b.error),n(g.data),a(b.data||[]),o(!1)},[t]);Mt(()=>{u()},[u]);const h=Nt(async g=>{const{error:b}=await Ne.from("invoices").update(g).eq("id",t);return b||await u(),{error:b}},[t,u]);return{invoice:e,items:r,loading:i,fetchError:l,refetch:u,update:h}}async function n2(t,e){var u;const{data:n,error:r}=await Ne.auth.getUser();if(r||!((u=n==null?void 0:n.user)!=null&&u.id))return{error:{message:"Nicht authentifiziert. Bitte erneut einloggen."}};const a=n.user.id,{data:i,error:o}=await Ne.from("invoices").insert({...t,owner_id:a}).select().single();if(o)return{error:o};if(!i)return{error:{message:"Rechnung wurde nicht gespeichert."}};if(e&&e.length>0){const h=e.map((b,p)=>({invoice_id:i.id,position:p+1,description:b.description,sub_description:b.sub_description||null,quantity:parseFloat(b.quantity)||1,unit_price:parseFloat(b.unit_price)||0})),{error:g}=await Ne.from("invoice_items").insert(h);if(g)return{data:i,error:g}}const l=t.type==="quote"?"quote_created":"invoice_created",c=t.type==="quote"?"Angebot":"Rechnung";return await Ne.from("activities").insert({owner_id:a,deal_id:t.deal_id||null,contact_id:t.contact_id||null,company_id:t.company_id||null,type:l,description:`${c} erstellt: ${t.invoice_number}`,metadata:{invoice_id:i.id,invoice_number:t.invoice_number}}),{data:i,error:null}}async function r2(t,e,n){const{error:r}=await Ne.from("invoices").update(e).eq("id",t);if(r)return{error:r};if(await Ne.from("invoice_items").delete().eq("invoice_id",t),n&&n.length>0){const a=n.map((o,l)=>({invoice_id:t,position:l+1,description:o.description,sub_description:o.sub_description||null,quantity:parseFloat(o.quantity)||1,unit_price:parseFloat(o.unit_price)||0})),{error:i}=await Ne.from("invoice_items").insert(a);if(i)return{error:i}}return{error:null}}async function i2(t){const{data:e}=await Ne.auth.getUser(),n=e.user.id,[{data:r},{data:a}]=await Promise.all([Ne.from("invoices").select("*").eq("id",t).single(),Ne.from("invoice_items").select("*").eq("invoice_id",t).order("position")]);if(!r)return{error:{message:"Angebot nicht gefunden"}};const i=new Date,o=Tl("invoice",r.customer_company,r.customer_name),{id:l,created_at:c,updated_at:u,...h}=r,{data:g,error:b}=await Ne.from("invoices").insert({...h,type:"invoice",invoice_number:o,status:"draft",invoice_date:i.toISOString().slice(0,10),due_date:new Date(i.getTime()+14*864e5).toISOString().slice(0,10),converted_from_quote_id:t,paid_date:null,paid_amount:0}).select().single();if(b)return{error:b};if(a&&a.length>0){const p=a.map(y=>({invoice_id:g.id,position:y.position,description:y.description,sub_description:y.sub_description,quantity:y.quantity,unit_price:y.unit_price}));await Ne.from("invoice_items").insert(p)}return await Ne.from("activities").insert({owner_id:n,deal_id:r.deal_id||null,contact_id:r.contact_id||null,company_id:r.company_id||null,type:"quote_converted",description:`Angebot ${r.invoice_number} in Rechnung ${o} umgewandelt`,metadata:{quote_id:t,invoice_id:g.id}}),{data:g,error:null}}function ic(){const[t,e]=me(null),[n,r]=me(!0),a=Nt(async()=>{r(!0);const{data:o}=await Ne.from("business_settings").select("*").limit(1).single();e(o),r(!1)},[]);Mt(()=>{a()},[a]);const i=Nt(async o=>{const{data:l}=await Ne.auth.getUser();if(t){const{error:c}=await Ne.from("business_settings").update(o).eq("id",t.id);return c||await a(),{error:c}}else{const{error:c}=await Ne.from("business_settings").insert({...o,owner_id:l.user.id});return c||await a(),{error:c}}},[t,a]);return{settings:t,loading:n,save:i,refetch:a}}function a2(){const[t,e]=me({openCount:0,openAmount:0,monthRevenue:0}),[n,r]=me(!0),a=Nt(async()=>{r(!0);const i=new Date,o=new Date(i.getFullYear(),i.getMonth(),1).toISOString().slice(0,10),[{data:l},{data:c}]=await Promise.all([Ne.from("invoices").select("total_amount").eq("type","invoice").is("deleted_at",null).in("status",["sent","overdue"]),Ne.from("invoices").select("total_amount").eq("type","invoice").is("deleted_at",null).eq("status","paid").gte("paid_date",o)]),u=(l||[]).length,h=(l||[]).reduce((b,p)=>b+(parseFloat(p.total_amount)||0),0),g=(c||[]).reduce((b,p)=>b+(parseFloat(p.total_amount)||0),0);e({openCount:u,openAmount:h,monthRevenue:g}),r(!1)},[]);return Mt(()=>{a()},[a]),{stats:t,loading:n}}async function pg(t){const{error:e}=await Ne.from("invoices").update({deleted_at:new Date().toISOString()}).eq("id",t);return{error:e}}function gd({contactId:t=null,dealId:e=null,companyId:n=null,limit:r=50}={}){const[a,i]=me([]),[o,l]=me(!0),c=Nt(async()=>{l(!0);let u=Ne.from("activities").select("*").order("created_at",{ascending:!1}).limit(r);t&&(u=u.eq("contact_id",t)),e&&(u=u.eq("deal_id",e)),n&&(u=u.eq("company_id",n));const{data:h,error:g}=await u;g||i(h||[]),l(!1)},[t,e,n,r]);return Mt(()=>{c()},[c]),{activities:a,loading:o,refetch:c}}async function gg(t){const{data:e}=await Ne.auth.getUser();return Ne.from("activities").insert({...t,owner_id:e.user.id}).select().single()}function s2(){const[t,e]=me([]),[n,r]=me(!0),a=Nt(async()=>{r(!0);const{data:o}=await Ne.from("activities").select(`
        *,
        contact:contacts(id, first_name, last_name),
        deal:deals(id, title)
      `).eq("type","task").eq("completed",!1).not("due_date","is",null).order("due_date",{ascending:!0});e(o||[]),r(!1)},[]);Mt(()=>{a()},[a]);const i=Nt(async o=>{const{error:l}=await Ne.from("activities").update({completed:!0}).eq("id",o);return l||await a(),{error:l}},[a]);return{tasks:t,loading:n,refetch:a,complete:i}}function Ta({label:t,value:e,color:n}){return s("div",{class:"card",children:[s("div",{class:"kpi-value",style:n?`color: ${n}`:"",children:e}),s("div",{class:"kpi-label",children:t})]})}function jn(t){return t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):""}function Jh(t){return t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function Be(t){return t==null?"":new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)}function o2(t){if(!t)return"";const e=new Date,n=new Date(t),r=e-n,a=Math.floor(r/6e4),i=Math.floor(r/36e5),o=Math.floor(r/864e5);return a<1?"gerade eben":a<60?`vor ${a} Min.`:i<24?`vor ${i} Std.`:o<7?`vor ${o} Tag${o>1?"en":""}`:jn(t)}const Mi={new:{label:"Neu",color:"#6366f1"},contacted:{label:"Kontaktiert",color:"#f59e0b"},qualified:{label:"Qualifiziert",color:"#3b82f6"},proposal:{label:"Angebot",color:"#8b5cf6"},won:{label:"Gewonnen",color:"#10b981"},lost:{label:"Verloren",color:"#ef4444"}},Wu={"360-tour":"360 Rundgang","drone-photo":"Drohnenfoto","drone-video":"Drohnenvideo","drone-inspection":"PV-Inspektion",streetview:"Google Street View",bundle:"Paket",other:"Sonstiges"},ks={"360-rundgang":"360-Rundgang",firmenrundgang:"Firmenrundgang",manual:"Manuell",referral:"Empfehlung",other:"Sonstiges"},md={note:{label:"Notiz",icon:""},call:{label:"Anruf",icon:""},email:{label:"E-Mail",icon:""},meeting:{label:"Treffen",icon:""},form_submission:{label:"Formular",icon:""},stage_change:{label:"Stage",icon:""},created:{label:"Erstellt",icon:""},task:{label:"Aufgabe",icon:""},invoice_created:{label:"Rechnung",icon:""},invoice_sent:{label:"Rechnung versendet",icon:""},quote_created:{label:"Angebot",icon:""},quote_converted:{label:"Angebot umgewandelt",icon:""}},oa={draft:{label:"Entwurf",color:"#6358DE"},sending:{label:"Wird gesendet",color:"#f59e0b"},sent:{label:"Versendet",color:"#0B996F"}},Yh=[{id:"follow-up",name:"Angebot nachfassen",icon:"",preview:"Offenes Angebot freundlich nachfassen",subject:"Ihr 360-Rundgang  Noch Fragen offen?",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"></head>
<body style="margin:0;padding:0;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;background:#f0f4f8;">
<div style="max-width:600px;margin:0 auto;padding:24px 16px;">
  <!-- Header -->
  <div style="background:linear-gradient(135deg,#1a5c6b 0%,#237a8c 100%);padding:32px 24px;border-radius:16px 16px 0 0;text-align:center;">
    <h1 style="color:#ffffff;margin:0 0 4px 0;font-size:24px;font-weight:700;letter-spacing:0.5px;">Beck360</h1>
    <p style="color:rgba(255,255,255,0.7);margin:0;font-size:13px;">360 Rundgnge & Drohnenaufnahmen</p>
  </div>
  <!-- Body -->
  <div style="background:#ffffff;padding:36px 32px;line-height:1.7;color:#334155;font-size:15px;">
    <p style="margin:0 0 16px 0;">Hallo {{vorname}},</p>
    <p style="margin:0 0 16px 0;">vor Kurzem haben wir ber einen <strong>360-Rundgang</strong> fr {{firma}} gesprochen. Haben Sie noch Fragen zu unserem Angebot?</p>
    <p style="margin:0 0 24px 0;">Gerne stehe ich Ihnen fr ein kurzes Gesprch zur Verfgung  unverbindlich und unkompliziert.</p>
    <!-- CTA -->
    <div style="text-align:center;margin:32px 0;">
      <a href="https://360-rundgang-karlsruhe.de" style="background:linear-gradient(135deg,#1a5c6b,#237a8c);color:#ffffff;padding:14px 32px;border-radius:8px;text-decoration:none;display:inline-block;font-weight:600;font-size:15px;box-shadow:0 2px 8px rgba(26,92,107,0.3);">Termin vereinbaren</a>
    </div>
    <!-- Signature -->
    <div style="border-top:1px solid #e2e8f0;padding-top:20px;margin-top:28px;">
      <p style="margin:0;font-size:14px;color:#475569;">Beste Gre<br><strong style="color:#1a5c6b;">Eugen Beck</strong></p>
      <p style="margin:4px 0 0 0;font-size:12px;color:#94a3b8;">Beck360  360 Rundgnge & Drohnenaufnahmen<br> +49 173 468 2501 &nbsp;&nbsp;  rundgang@beck360.de</p>
    </div>
  </div>
  <!-- Footer -->
  <div style="background:#f8fafc;border-top:1px solid #e2e8f0;border-radius:0 0 16px 16px;text-align:center;padding:16px 24px;">
    <p style="margin:0;font-size:11px;color:#94a3b8;">Beck360 &nbsp;&nbsp; Eichenweg 1, 76275 Ettlingen &nbsp;&nbsp; <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#64748b;">Impressum</a></p>
  </div>
</div>
</body></html>`},{id:"new-service",name:"Neue Dienstleistung",icon:"",preview:"Neues Angebot oder Service vorstellen",subject:"Neu bei Beck360: Erweiterte 360-Lsungen fr {{firma}}",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"></head>
<body style="margin:0;padding:0;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;background:#f0f4f8;">
<div style="max-width:600px;margin:0 auto;padding:24px 16px;">
  <!-- Header -->
  <div style="background:linear-gradient(135deg,#1a5c6b 0%,#237a8c 100%);padding:32px 24px;border-radius:16px 16px 0 0;text-align:center;">
    <h1 style="color:#ffffff;margin:0 0 4px 0;font-size:24px;font-weight:700;letter-spacing:0.5px;">Beck360</h1>
    <p style="color:rgba(255,255,255,0.7);margin:0;font-size:13px;">360 Rundgnge & Drohnenaufnahmen</p>
  </div>
  <!-- Body -->
  <div style="background:#ffffff;padding:36px 32px;line-height:1.7;color:#334155;font-size:15px;">
    <p style="margin:0 0 16px 0;">Hallo {{vorname}},</p>
    <p style="margin:0 0 24px 0;">wir haben unser Angebot fr Sie erweitert! Entdecken Sie unsere neuen Mglichkeiten:</p>
    <!-- Feature Cards -->
    <table width="100%" cellpadding="0" cellspacing="0" style="margin:0 0 24px 0;">
      <tr>
        <td style="padding:8px 8px 8px 0;width:33%;vertical-align:top;">
          <div style="background:#f0f9ff;border-radius:10px;padding:16px;text-align:center;">
            <div style="font-size:28px;margin-bottom:8px;"></div>
            <p style="margin:0;font-size:13px;font-weight:600;color:#1a5c6b;">360 Rundgnge</p>
            <p style="margin:4px 0 0 0;font-size:11px;color:#64748b;">Interaktive Touren fr Ihre Rume</p>
          </div>
        </td>
        <td style="padding:8px;width:33%;vertical-align:top;">
          <div style="background:#f0f9ff;border-radius:10px;padding:16px;text-align:center;">
            <div style="font-size:28px;margin-bottom:8px;"></div>
            <p style="margin:0;font-size:13px;font-weight:600;color:#1a5c6b;">Drohnenaufnahmen</p>
            <p style="margin:4px 0 0 0;font-size:11px;color:#64748b;">Luftbilder & Videos</p>
          </div>
        </td>
        <td style="padding:8px 0 8px 8px;width:33%;vertical-align:top;">
          <div style="background:#f0f9ff;border-radius:10px;padding:16px;text-align:center;">
            <div style="font-size:28px;margin-bottom:8px;"></div>
            <p style="margin:0;font-size:13px;font-weight:600;color:#1a5c6b;">Google Street View</p>
            <p style="margin:4px 0 0 0;font-size:11px;color:#64748b;">Direkt auf Google Maps</p>
          </div>
        </td>
      </tr>
    </table>
    <p style="margin:0 0 24px 0;">Alle Leistungen aus einer Hand  professionell, schnell und zu fairen Preisen.</p>
    <!-- CTA -->
    <div style="text-align:center;margin:32px 0;">
      <a href="https://360-rundgang-karlsruhe.de" style="background:linear-gradient(135deg,#1a5c6b,#237a8c);color:#ffffff;padding:14px 32px;border-radius:8px;text-decoration:none;display:inline-block;font-weight:600;font-size:15px;box-shadow:0 2px 8px rgba(26,92,107,0.3);">Mehr erfahren</a>
    </div>
    <!-- Signature -->
    <div style="border-top:1px solid #e2e8f0;padding-top:20px;margin-top:28px;">
      <p style="margin:0;font-size:14px;color:#475569;">Beste Gre<br><strong style="color:#1a5c6b;">Eugen Beck</strong></p>
      <p style="margin:4px 0 0 0;font-size:12px;color:#94a3b8;">Beck360  360 Rundgnge & Drohnenaufnahmen<br> +49 173 468 2501 &nbsp;&nbsp;  rundgang@beck360.de</p>
    </div>
  </div>
  <!-- Footer -->
  <div style="background:#f8fafc;border-top:1px solid #e2e8f0;border-radius:0 0 16px 16px;text-align:center;padding:16px 24px;">
    <p style="margin:0;font-size:11px;color:#94a3b8;">Beck360 &nbsp;&nbsp; Eichenweg 1, 76275 Ettlingen &nbsp;&nbsp; <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#64748b;">Impressum</a></p>
  </div>
</div>
</body></html>`},{id:"review",name:"Um Bewertung bitten",icon:"",preview:"Kunden um Google-Bewertung bitten",subject:"Wie war Ihre Erfahrung mit Beck360, {{vorname}}?",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"></head>
<body style="margin:0;padding:0;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;background:#f0f4f8;">
<div style="max-width:600px;margin:0 auto;padding:24px 16px;">
  <!-- Header -->
  <div style="background:linear-gradient(135deg,#1a5c6b 0%,#237a8c 100%);padding:32px 24px;border-radius:16px 16px 0 0;text-align:center;">
    <h1 style="color:#ffffff;margin:0 0 4px 0;font-size:24px;font-weight:700;letter-spacing:0.5px;">Beck360</h1>
    <p style="color:rgba(255,255,255,0.7);margin:0;font-size:13px;">360 Rundgnge & Drohnenaufnahmen</p>
  </div>
  <!-- Body -->
  <div style="background:#ffffff;padding:36px 32px;line-height:1.7;color:#334155;font-size:15px;">
    <p style="margin:0 0 16px 0;">Hallo {{vorname}},</p>
    <p style="margin:0 0 16px 0;">vielen Dank, dass Sie sich fr Beck360 entschieden haben! Wir hoffen, Sie sind mit dem Ergebnis begeistert.</p>
    <!-- Stars -->
    <div style="text-align:center;margin:28px 0;">
      <div style="background:linear-gradient(135deg,#fefce8,#fef9c3);border:1px solid #fde68a;border-radius:12px;padding:24px;display:inline-block;">
        <p style="font-size:36px;margin:0 0 8px 0;letter-spacing:4px;"></p>
        <p style="font-size:15px;font-weight:600;color:#92400e;margin:0 0 4px 0;">Ihre Meinung zhlt!</p>
        <p style="font-size:13px;color:#a16207;margin:0;">Eine Bewertung dauert nur 1 Minute</p>
      </div>
    </div>
    <p style="margin:0 0 24px 0;text-align:center;">Wrden Sie uns mit einer kurzen Google-Bewertung untersttzen? Das hilft anderen Kunden bei ihrer Entscheidung.</p>
    <!-- CTA -->
    <div style="text-align:center;margin:32px 0;">
      <a href="https://www.google.com/maps/place/Beck360/@48.9408,8.4072,17z/?entry=ttu&action=write-review" style="background:linear-gradient(135deg,#1a5c6b,#237a8c);color:#ffffff;padding:14px 32px;border-radius:8px;text-decoration:none;display:inline-block;font-weight:600;font-size:15px;box-shadow:0 2px 8px rgba(26,92,107,0.3);">Jetzt bewerten</a>
    </div>
    <!-- Signature -->
    <div style="border-top:1px solid #e2e8f0;padding-top:20px;margin-top:28px;">
      <p style="margin:0;font-size:14px;color:#475569;">Herzlichen Dank!<br><strong style="color:#1a5c6b;">Eugen Beck</strong></p>
      <p style="margin:4px 0 0 0;font-size:12px;color:#94a3b8;">Beck360  360 Rundgnge & Drohnenaufnahmen<br> +49 173 468 2501 &nbsp;&nbsp;  rundgang@beck360.de</p>
    </div>
  </div>
  <!-- Footer -->
  <div style="background:#f8fafc;border-top:1px solid #e2e8f0;border-radius:0 0 16px 16px;text-align:center;padding:16px 24px;">
    <p style="margin:0;font-size:11px;color:#94a3b8;">Beck360 &nbsp;&nbsp; Eichenweg 1, 76275 Ettlingen &nbsp;&nbsp; <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#64748b;">Impressum</a></p>
  </div>
</div>
</body></html>`},{id:"seasonal",name:"Saisonales Angebot",icon:"",preview:"Zeitlich begrenztes Angebot bewerben",subject:"Exklusiv fr {{firma}}: 360-Rundgang zum Sonderpreis",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"></head>
<body style="margin:0;padding:0;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;background:#f0f4f8;">
<div style="max-width:600px;margin:0 auto;padding:24px 16px;">
  <!-- Header -->
  <div style="background:linear-gradient(135deg,#1a5c6b 0%,#237a8c 100%);padding:32px 24px;border-radius:16px 16px 0 0;text-align:center;">
    <h1 style="color:#ffffff;margin:0 0 4px 0;font-size:24px;font-weight:700;letter-spacing:0.5px;">Beck360</h1>
    <p style="color:rgba(255,255,255,0.7);margin:0;font-size:13px;">360 Rundgnge & Drohnenaufnahmen</p>
  </div>
  <!-- Body -->
  <div style="background:#ffffff;padding:36px 32px;line-height:1.7;color:#334155;font-size:15px;">
    <p style="margin:0 0 16px 0;">Hallo {{vorname}},</p>
    <p style="margin:0 0 20px 0;">wir haben ein exklusives Angebot fr {{firma}}:</p>
    <!-- Offer Box -->
    <div style="background:linear-gradient(135deg,#ecfdf5,#d1fae5);border:2px solid #6ee7b7;border-radius:12px;padding:28px;margin:20px 0;text-align:center;">
      <p style="font-size:12px;font-weight:700;color:#059669;text-transform:uppercase;letter-spacing:2px;margin:0 0 8px 0;">Limitiertes Angebot</p>
      <p style="font-size:22px;font-weight:700;color:#065f46;margin:0 0 8px 0;">Frhlings-Aktion 2026</p>
      <p style="font-size:14px;color:#047857;margin:0;">360-Rundgang zum Sonderpreis  nur bis Ende des Monats!</p>
    </div>
    <p style="margin:20px 0 8px 0;font-weight:600;color:#1e293b;">Das ist enthalten:</p>
    <table width="100%" cellpadding="0" cellspacing="0">
      <tr><td style="padding:6px 0;font-size:14px;color:#475569;"> Professioneller 360-Rundgang</td></tr>
      <tr><td style="padding:6px 0;font-size:14px;color:#475569;"> Hosting auf Matterport fr 12 Monate</td></tr>
      <tr><td style="padding:6px 0;font-size:14px;color:#475569;"> Einbettung auf Ihrer Website</td></tr>
      <tr><td style="padding:6px 0;font-size:14px;color:#475569;"> Google Street View Integration</td></tr>
    </table>
    <!-- CTA -->
    <div style="text-align:center;margin:32px 0;">
      <a href="https://360-rundgang-karlsruhe.de" style="background:linear-gradient(135deg,#059669,#047857);color:#ffffff;padding:14px 32px;border-radius:8px;text-decoration:none;display:inline-block;font-weight:600;font-size:15px;box-shadow:0 2px 8px rgba(5,150,105,0.3);">Jetzt Angebot sichern</a>
    </div>
    <!-- Signature -->
    <div style="border-top:1px solid #e2e8f0;padding-top:20px;margin-top:28px;">
      <p style="margin:0;font-size:14px;color:#475569;">Beste Gre<br><strong style="color:#1a5c6b;">Eugen Beck</strong></p>
      <p style="margin:4px 0 0 0;font-size:12px;color:#94a3b8;">Beck360  360 Rundgnge & Drohnenaufnahmen<br> +49 173 468 2501 &nbsp;&nbsp;  rundgang@beck360.de</p>
    </div>
  </div>
  <!-- Footer -->
  <div style="background:#f8fafc;border-top:1px solid #e2e8f0;border-radius:0 0 16px 16px;text-align:center;padding:16px 24px;">
    <p style="margin:0;font-size:11px;color:#94a3b8;">Beck360 &nbsp;&nbsp; Eichenweg 1, 76275 Ettlingen &nbsp;&nbsp; <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#64748b;">Impressum</a></p>
  </div>
</div>
</body></html>`},{id:"blank",name:"Leere Vorlage",icon:"",preview:"Leeres Template mit Beck360-Layout",subject:"",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"></head>
<body style="margin:0;padding:0;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;background:#f0f4f8;">
<div style="max-width:600px;margin:0 auto;padding:24px 16px;">
  <!-- Header -->
  <div style="background:linear-gradient(135deg,#1a5c6b 0%,#237a8c 100%);padding:32px 24px;border-radius:16px 16px 0 0;text-align:center;">
    <h1 style="color:#ffffff;margin:0 0 4px 0;font-size:24px;font-weight:700;letter-spacing:0.5px;">Beck360</h1>
    <p style="color:rgba(255,255,255,0.7);margin:0;font-size:13px;">360 Rundgnge & Drohnenaufnahmen</p>
  </div>
  <!-- Body -->
  <div style="background:#ffffff;padding:36px 32px;line-height:1.7;color:#334155;font-size:15px;">
    <p style="margin:0 0 16px 0;">Hallo {{vorname}},</p>
    <p style="margin:0 0 16px 0;"><!-- Ihr Inhalt hier --></p>
    <!-- CTA -->
    <div style="text-align:center;margin:32px 0;">
      <a href="https://360-rundgang-karlsruhe.de" style="background:linear-gradient(135deg,#1a5c6b,#237a8c);color:#ffffff;padding:14px 32px;border-radius:8px;text-decoration:none;display:inline-block;font-weight:600;font-size:15px;box-shadow:0 2px 8px rgba(26,92,107,0.3);">Mehr erfahren</a>
    </div>
    <!-- Signature -->
    <div style="border-top:1px solid #e2e8f0;padding-top:20px;margin-top:28px;">
      <p style="margin:0;font-size:14px;color:#475569;">Beste Gre<br><strong style="color:#1a5c6b;">Eugen Beck</strong></p>
      <p style="margin:4px 0 0 0;font-size:12px;color:#94a3b8;">Beck360  360 Rundgnge & Drohnenaufnahmen<br> +49 173 468 2501 &nbsp;&nbsp;  rundgang@beck360.de</p>
    </div>
  </div>
  <!-- Footer -->
  <div style="background:#f8fafc;border-top:1px solid #e2e8f0;border-radius:0 0 16px 16px;text-align:center;padding:16px 24px;">
    <p style="margin:0;font-size:11px;color:#94a3b8;">Beck360 &nbsp;&nbsp; Eichenweg 1, 76275 Ettlingen &nbsp;&nbsp; <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#64748b;">Impressum</a></p>
  </div>
</div>
</body></html>`}],Hl={office:"Buero & Ausstattung",software:"Software & Lizenzen",marketing:"Marketing & Werbung",travel:"Reise & Fahrtkosten",equipment:"Geraete & Technik",insurance:"Versicherungen",telecom:"Telefon & Internet",professional:"Beratung & Dienstleistung",vehicle:"Fahrzeug",training:"Weiterbildung",other:"Sonstiges"},l2={bank_transfer:"Ueberweisung",cash:"Bar",credit_card:"Kreditkarte",paypal:"PayPal",direct_debit:"Lastschrift"},Wl=["Januar","Februar","Maerz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],vd=["Hotel / Pension","Gastronomie","Fitnessstudio","Einzelhandel","Autohaus","Gesundheit / Arztpraxis","Eventlocation","Coworking","Immobilien","Handwerk","Bildung","Sonstige"];function bd({activity:t}){const e=md[t.type]||{label:t.type,icon:""};return s("div",{class:"timeline-item",children:s("div",{class:"timeline-content",children:[s("div",{class:"timeline-header",children:[s("span",{class:"timeline-icon",children:e.icon}),s("span",{class:"timeline-type",children:e.label}),s("span",{class:"timeline-time",children:o2(t.created_at)})]}),s("div",{class:"timeline-text",children:t.description})]})})}function ac({stage:t}){const e=Mi[t]||{label:t,color:"#64748b"};return s("span",{class:"stage-badge",style:`color: ${e.color}; background: ${e.color}1a`,children:e.label})}function Xh(){const{stats:t,recentActivities:e,loading:n}=e2(),{stats:r}=a2(),{tasks:a,complete:i}=s2();return n?s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Dashboard"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]}):s(xt,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Dashboard"}),s("div",{style:"display:flex;gap:0.5rem",children:[s("button",{class:"btn btn-primary btn-sm",onClick:()=>qe("/crm/contacts/new"),children:"+ Kontakt"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/deals/new"),children:"+ Deal"})]})]}),s("div",{class:"page-body",children:[s("div",{class:"grid-4",style:"margin-bottom: 1.5rem",children:[s(Ta,{label:"Kontakte gesamt",value:t.totalContacts}),s(Ta,{label:"Neue Leads (Monat)",value:t.newLeadsThisMonth,color:"var(--info)"}),s(Ta,{label:"Pipeline-Wert",value:Be(t.pipelineValue),color:"var(--primary-light)"}),s(Ta,{label:"Conversion-Rate",value:`${t.conversionRate}%`,color:"var(--success)"})]}),s("div",{class:"grid-3",style:"margin-bottom: 1.5rem",children:[s(Ta,{label:"Offene Rechnungen",value:r.openCount,color:"var(--warning)"}),s(Ta,{label:"Offener Betrag",value:Be(r.openAmount),color:"var(--error)"}),s(Ta,{label:"Umsatz (Monat)",value:Be(r.monthRevenue),color:"var(--success)"})]}),s("div",{class:"grid-2",style:"margin-bottom: 1.5rem",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Pipeline-Uebersicht"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/pipeline"),children:"Oeffnen"})]}),s("div",{style:"display:flex;flex-direction:column;gap:0.5rem",children:Object.entries(Mi).filter(([o])=>o!=="won"&&o!=="lost").map(([o,l])=>s("div",{style:"display:flex;align-items:center;justify-content:space-between;padding:0.4rem 0",children:[s(ac,{stage:o}),s("span",{style:"font-weight:600",children:t.dealsByStage[o]||0})]},o))})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Faellige Aufgaben"})}),a.length===0?s("div",{class:"empty-state",style:"padding:1rem",children:s("div",{class:"empty-state-text",children:"Keine faelligen Aufgaben"})}):s("div",{style:"display:flex;flex-direction:column;gap:0.5rem",children:a.slice(0,5).map(o=>s("div",{style:"display:flex;align-items:center;justify-content:space-between;padding:0.4rem 0;border-bottom:1px solid var(--border)",children:[s("div",{children:[s("div",{style:"font-size:0.85rem",children:o.description}),s("div",{style:"font-size:0.75rem;color:var(--text-dim)",children:["Faellig: ",jn(o.due_date),o.contact&&`  ${o.contact.first_name} ${o.contact.last_name}`]})]}),s("button",{class:"btn btn-sm btn-secondary",onClick:()=>i(o.id),children:"Erledigt"})]},o.id))})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Letzte Aktivitaeten"})}),e.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Noch keine Aktivitaeten"})]}):s("div",{class:"timeline",children:e.map(o=>s(bd,{activity:o},o.id))})]})]})]})}function yd({stage:t=null,contactId:e=null,companyId:n=null}={}){const[r,a]=me([]),[i,o]=me(!0),l=Nt(async()=>{o(!0);let c=Ne.from("deals").select(`
        *,
        contact:contacts(id, first_name, last_name, email),
        company:companies(id, name)
      `).is("deleted_at",null).order("created_at",{ascending:!1});t&&(c=c.eq("stage",t)),e&&(c=c.eq("contact_id",e)),n&&(c=c.eq("company_id",n));const{data:u,error:h}=await c;h||a((u||[]).map(g=>{var b;return{...g,contact_name:g.contact?`${g.contact.first_name||""} ${g.contact.last_name||""}`.trim()||g.contact.email:null,company_name:((b=g.company)==null?void 0:b.name)||null}})),o(!1)},[t,e,n]);return Mt(()=>{l()},[l]),{deals:r,loading:i,refetch:l}}function c2(t){const[e,n]=me(null),[r,a]=me(!0),i=Nt(async()=>{if(!t)return;a(!0);const{data:c}=await Ne.from("deals").select(`
        *,
        contact:contacts(id, first_name, last_name, email, phone),
        company:companies(id, name)
      `).eq("id",t).single();n(c),a(!1)},[t]);Mt(()=>{i()},[i]);const o=Nt(async c=>{const{error:u}=await Ne.from("deals").update(c).eq("id",t);return u||await i(),{error:u}},[t,i]),l=Nt(async c=>{const u=e==null?void 0:e.stage,{error:h}=await Ne.from("deals").update({stage:c,stage_changed_at:new Date().toISOString()}).eq("id",t);if(!h){const{data:g}=await Ne.auth.getUser();await Ne.from("activities").insert({owner_id:g.user.id,deal_id:t,contact_id:e==null?void 0:e.contact_id,type:"stage_change",description:`Stage geaendert: ${u}  ${c}`,metadata:{old_stage:u,new_stage:c}}),await i()}return{error:h}},[t,e,i]);return{deal:e,loading:r,refetch:i,update:o,changeStage:l}}async function u2(t){const{data:e}=await Ne.auth.getUser(),{data:n,error:r}=await Ne.from("deals").insert({...t,owner_id:e.user.id}).select().single();return r||await Ne.from("activities").insert({owner_id:e.user.id,deal_id:n.id,contact_id:t.contact_id||null,type:"created",description:`Deal erstellt: ${t.title}`}),{data:n,error:r}}async function Zh(t,e,n,r){const{error:a}=await Ne.from("deals").update({stage:e,stage_changed_at:new Date().toISOString()}).eq("id",t);if(!a){const{data:i}=await Ne.auth.getUser();await Ne.from("activities").insert({owner_id:i.user.id,deal_id:t,contact_id:r||null,type:"stage_change",description:`Stage geaendert: ${n}  ${e}`,metadata:{old_stage:n,new_stage:e}})}return{error:a}}const d2=["new","contacted","qualified","proposal","won","lost"];function h2({deal:t,onDragStart:e,onClick:n,onStageChange:r}){return s("div",{class:"deal-card",draggable:!0,onDragStart:a=>{a.dataTransfer.setData("text/plain",t.id),a.currentTarget.classList.add("dragging"),e&&e(t)},onDragEnd:a=>a.currentTarget.classList.remove("dragging"),onClick:()=>n&&n(t),children:[s("div",{class:"deal-card-title",children:t.title}),s("div",{class:"deal-card-meta",children:[s("span",{children:t.contact_name||""}),s("span",{children:t.value?Be(t.value):""})]}),r&&s("select",{class:"deal-card-stage-select",value:t.stage,onClick:a=>a.stopPropagation(),onChange:a=>{a.stopPropagation(),r(t,a.target.value)},children:d2.map(a=>s("option",{value:a,children:Mi[a].label},a))})]})}const Qh=["new","contacted","qualified","proposal","won","lost"];function f2(){const{deals:t,loading:e,refetch:n}=yd(),r=Gn(),[a,i]=me(null),o={};for(const u of Qh)o[u]=t.filter(h=>h.stage===u);const l=Nt(async(u,h)=>{u.preventDefault(),i(null);const g=u.dataTransfer.getData("text/plain"),b=t.find(y=>y.id===g);if(!b||b.stage===h)return;const{error:p}=await Zh(g,h,b.stage,b.contact_id);p?r.error("Fehler beim Aendern der Stage"):(r.success(`Deal nach "${Mi[h].label}" verschoben`),n())},[t,n,r]),c=Nt(async(u,h)=>{if(u.stage===h)return;const{error:g}=await Zh(u.id,h,u.stage,u.contact_id);g?r.error("Fehler beim Aendern der Stage"):(r.success(`Deal nach "${Mi[h].label}" verschoben`),n())},[n,r]);return e?s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Pipeline"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]}):s(xt,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Pipeline"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>qe("/crm/deals/new"),children:"+ Neuer Deal"})]}),s("div",{class:"page-body",children:s("div",{class:"pipeline",children:Qh.map(u=>s("div",{class:"pipeline-column",children:[s("div",{class:"pipeline-column-header",style:`border-top: 3px solid ${Mi[u].color}`,children:[s("span",{children:Mi[u].label}),s("span",{class:"pipeline-column-count",children:o[u].length})]}),s("div",{class:`pipeline-column-body ${a===u?"drag-over":""}`,onDragOver:h=>{h.preventDefault(),i(u)},onDragLeave:()=>i(null),onDrop:h=>l(h,u),children:o[u].length===0?s("div",{style:"text-align:center;padding:1rem;color:var(--text-dim);font-size:0.8rem",children:"Keine Deals"}):o[u].map(h=>s(h2,{deal:h,onClick:()=>qe(`/crm/deals/${h.id}`),onStageChange:c},h.id))})]},u))})})]})}function sc({search:t="",source:e=null}={}){const[n,r]=me([]),[a,i]=me(!0),o=Nt(async()=>{i(!0);let l=Ne.from("contacts").select("*, company:companies(id, name)").is("deleted_at",null).order("created_at",{ascending:!1});e&&(l=l.eq("source",e)),t&&(l=l.or(`first_name.ilike.%${t}%,last_name.ilike.%${t}%,email.ilike.%${t}%`));const{data:c,error:u}=await l;u||r(c||[]),i(!1)},[t,e]);return Mt(()=>{o()},[o]),{contacts:n,loading:a,refetch:o}}function p2(t){const[e,n]=me(null),[r,a]=me(!0),i=Nt(async()=>{if(!t)return;a(!0);const{data:c}=await Ne.from("contacts").select("*, company:companies(id, name)").eq("id",t).single();n(c),a(!1)},[t]);Mt(()=>{i()},[i]);const o=Nt(async c=>{const{error:u}=await Ne.from("contacts").update(c).eq("id",t);return u||await i(),{error:u}},[t,i]),l=Nt(async()=>Ne.from("contacts").update({deleted_at:new Date().toISOString()}).eq("id",t),[t]);return{contact:e,loading:r,refetch:i,update:o,softDelete:l}}async function _d(t){const{data:e}=await Ne.auth.getUser(),{data:n,error:r}=await Ne.from("contacts").insert({...t,owner_id:e.user.id}).select().single();return r||await Ne.from("activities").insert({owner_id:e.user.id,contact_id:n.id,type:"created",description:"Kontakt manuell erstellt"}),{data:n,error:r}}function mg({value:t,onInput:e,placeholder:n="Suchen..."}){return s("input",{type:"search",class:"search-input",placeholder:n,value:t,onInput:r=>e(r.target.value)})}function wd({filters:t,active:e,onSelect:n}){return s("div",{class:"filter-pills",children:[s("button",{class:`filter-pill ${e?"":"active"}`,onClick:()=>n(null),children:"Alle"}),t.map(r=>s("button",{class:`filter-pill ${e===r.value?"active":""}`,onClick:()=>n(r.value),children:r.label},r.value))]})}function ua({title:t,onClose:e,children:n,footer:r,className:a}){const i=Nt(o=>{o.key==="Escape"&&e()},[e]);return Mt(()=>(document.addEventListener("keydown",i),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",i),document.body.style.overflow=""}),[i]),s("div",{class:"modal-overlay",onClick:o=>{o.target===o.currentTarget&&e()},children:s("div",{class:`modal${a?" "+a:""}`,role:"dialog","aria-modal":"true",children:[s("div",{class:"modal-header",children:[s("span",{children:t}),s("button",{class:"btn-icon",onClick:e,"aria-label":"Schliessen",children:""})]}),s("div",{class:"modal-body",children:n}),r&&s("div",{class:"modal-footer",children:r})]})})}function oc({search:t="",industry:e=null}={}){const[n,r]=me([]),[a,i]=me(!0),o=Nt(async()=>{i(!0);let l=Ne.from("companies").select("*").is("deleted_at",null).order("created_at",{ascending:!1});e&&(l=l.eq("industry",e)),t&&(l=l.or(`name.ilike.%${t}%,city.ilike.%${t}%`));const{data:c,error:u}=await l;u||r(c||[]),i(!1)},[t,e]);return Mt(()=>{o()},[o]),{companies:n,loading:a,refetch:o}}function g2(t){const[e,n]=me(null),[r,a]=me(!0),i=Nt(async()=>{if(!t)return;a(!0);const{data:c}=await Ne.from("companies").select("*").eq("id",t).is("deleted_at",null).single();n(c),a(!1)},[t]);Mt(()=>{i()},[i]);const o=Nt(async c=>{const{error:u}=await Ne.from("companies").update(c).eq("id",t);return u||await i(),{error:u}},[t,i]),l=Nt(async()=>{const{error:c}=await Ne.from("companies").update({deleted_at:new Date().toISOString()}).eq("id",t);return{error:c}},[t]);return{company:e,loading:r,refetch:i,update:o,softDelete:l}}async function lc(t){const{data:e}=await Ne.auth.getUser();return Ne.from("companies").insert({...t,owner_id:e.user.id}).select().single()}function ef(t,e){const n=[];let r="",a=!1;for(let i=0;i<t.length;i++){const o=t[i];a?o==='"'&&t[i+1]==='"'?(r+='"',i++):o==='"'?a=!1:r+=o:o==='"'?a=!0:o===e?(n.push(r.trim()),r=""):r+=o}return n.push(r.trim()),n}function m2(t){const e=(t.match(/;/g)||[]).length,n=(t.match(/,/g)||[]).length;return e>=n?";":","}function v2(t,e){const n={};return t.forEach((r,a)=>{n[r]=e[a]||""}),{companyName:n.Firma||"",firstName:n["Ansprechpartner Vorname"]||"",lastName:n["Ansprechpartner Nachname"]||"",email:n["E-Mail"]||n.Email||"",street:n.Strasse||"",zip:n.PLZ||"",city:n.Stadt||"",industry:n.Branche||"",vatId:n["USt-IdNr"]||"",notes:n.Notiz||""}}function b2(){const[t,e]=me(null),[n,r]=me(!1),[a,i]=me({current:0,total:0}),[o,l]=me(null),c=Nt(g=>{const b=g.split(/\r?\n/).filter(O=>O.trim());if(b.length<2)return null;const p=m2(b[0]),y=ef(b[0],p),_=b.slice(1).map(O=>v2(y,ef(O,p))),S=[...new Set(_.map(O=>O.companyName).filter(Boolean))],x=_.filter(O=>O.firstName||O.lastName),T={rows:_,companyNames:S,contactCount:x.length};return e(T),l(null),T},[]),u=Nt(async()=>{if(!t)return;r(!0),l(null);const{rows:g,companyNames:b}=t,p=b.length+g.filter(F=>F.firstName||F.lastName).length;i({current:0,total:p});let y={companies:0,contacts:0},_={companies:0,contacts:0},S=[],x=0;const{data:T}=await Ne.from("companies").select("id, name").is("deleted_at",null),O=new Map((T||[]).map(F=>[F.name.toLowerCase(),F.id])),E=new Map;for(const F of b){const I=F.toLowerCase();if(O.has(I))E.set(F,O.get(I)),_.companies++;else{const k=g.find(K=>K.companyName===F),A=[k.street,k.zip,k.city].filter(Boolean).join(", "),{data:j,error:q}=await lc({name:F,address:A||null,city:k.city||null,industry:k.industry||null});q?S.push(`Firma "${F}": ${q.message}`):(E.set(F,j.id),y.companies++)}x++,i({current:x,total:p})}const{data:M}=await Ne.from("contacts").select("id, first_name, last_name, company_id").is("deleted_at",null),ee=(F,I,k)=>`${(F||"").toLowerCase()}|${(I||"").toLowerCase()}|${k||""}`,G=new Set((M||[]).map(F=>ee(F.first_name,F.last_name,F.company_id)));for(const F of g){if(!F.firstName&&!F.lastName)continue;const I=E.get(F.companyName)||null,k=ee(F.firstName,F.lastName,I);if(G.has(k)){_.contacts++,x++,i({current:x,total:p});continue}const A=F.email||`${(F.firstName||"kontakt").toLowerCase()}.${(F.lastName||"").toLowerCase()}@platzhalter.de`.replace(/\s+/g,""),{error:j}=await _d({first_name:F.firstName||null,last_name:F.lastName||null,email:A,company_id:I,source:"manual"});j?S.push(`Kontakt "${F.firstName} ${F.lastName}": ${j.message}`):(y.contacts++,G.add(k)),x++,i({current:x,total:p})}const X={created:y,skipped:_,errors:S};return l(X),r(!1),X},[t]),h=Nt(()=>{e(null),l(null),i({current:0,total:0})},[]);return{parseCSV:c,importContacts:u,parsed:t,importing:n,progress:a,results:o,reset:h}}function y2({onClose:t,onSuccess:e}){const n=qp(null),[r,a]=me(""),{parseCSV:i,importContacts:o,parsed:l,importing:c,progress:u,results:h,reset:g}=b2(),b=S=>{const x=S.target.files[0];if(!x)return;a(x.name);const T=new FileReader;T.onload=O=>i(O.target.result),T.readAsText(x,"UTF-8")},p=async()=>{const S=await o();S&&S.errors.length===0&&(e==null||e())},y=()=>{g(),t()};return s(ua,{title:"CSV Import",onClose:y,footer:h?s("button",{class:"btn btn-primary btn-sm",onClick:y,children:"Schliessen"}):s(xt,{children:[s("button",{class:"btn btn-secondary btn-sm",onClick:y,disabled:c,children:"Abbrechen"}),l&&s("button",{class:"btn btn-primary btn-sm",onClick:p,disabled:c,children:c?"Importiere...":"Importieren"})]}),className:"modal-wide",children:[!l&&!h&&s("div",{children:[s("p",{style:"font-size:0.85rem;color:var(--text-muted);margin-bottom:1rem",children:"CSV-Datei mit Semikolon- oder Komma-Trennung hochladen. Erwartete Spalten: Firma, Ansprechpartner Vorname/Nachname, Strasse, PLZ, Stadt, Branche, Notiz."}),s("label",{class:"import-file-label",style:"display:flex;align-items:center;justify-content:center;gap:0.5rem;padding:2rem;border:2px dashed var(--border);border-radius:var(--radius-lg);cursor:pointer;color:var(--text-muted);font-size:0.85rem;transition:border-color 0.15s",children:[s("span",{children:r||"CSV-Datei auswaehlen..."}),s("input",{ref:n,type:"file",accept:".csv,.txt",onChange:b,style:"display:none"})]})]}),l&&!h&&s("div",{children:[s("div",{style:"display:flex;gap:1rem;margin-bottom:1rem",children:[s("div",{class:"card",style:"flex:1;padding:0.75rem;text-align:center",children:[s("div",{style:"font-size:1.25rem;font-weight:700;color:var(--primary)",children:l.companyNames.length}),s("div",{style:"font-size:0.75rem;color:var(--text-muted)",children:"Firmen"})]}),s("div",{class:"card",style:"flex:1;padding:0.75rem;text-align:center",children:[s("div",{style:"font-size:1.25rem;font-weight:700;color:var(--primary)",children:l.contactCount}),s("div",{style:"font-size:0.75rem;color:var(--text-muted)",children:"Kontakte"})]})]}),c&&s("div",{style:"margin-bottom:1rem",children:[s("div",{style:"display:flex;justify-content:space-between;font-size:0.75rem;color:var(--text-muted);margin-bottom:0.25rem",children:[s("span",{children:"Importiere..."}),s("span",{children:[u.current,"/",u.total]})]}),s("div",{style:"height:6px;background:var(--border);border-radius:3px;overflow:hidden",children:s("div",{style:`height:100%;background:var(--primary);border-radius:3px;transition:width 0.2s;width:${u.total?u.current/u.total*100:0}%`})})]}),s("div",{class:"card",style:"padding:0;max-height:240px;overflow-y:auto",children:s("table",{style:"font-size:0.8rem",children:[s("thead",{children:s("tr",{children:[s("th",{style:"padding:0.5rem 0.6rem",children:"Firma"}),s("th",{style:"padding:0.5rem 0.6rem",children:"Vorname"}),s("th",{style:"padding:0.5rem 0.6rem",children:"Nachname"}),s("th",{style:"padding:0.5rem 0.6rem",children:"Stadt"}),s("th",{style:"padding:0.5rem 0.6rem",children:"Branche"})]})}),s("tbody",{children:l.rows.map((S,x)=>s("tr",{children:[s("td",{style:"padding:0.4rem 0.6rem",children:S.companyName}),s("td",{style:"padding:0.4rem 0.6rem",children:S.firstName||""}),s("td",{style:"padding:0.4rem 0.6rem",children:S.lastName||""}),s("td",{style:"padding:0.4rem 0.6rem",children:S.city}),s("td",{style:"padding:0.4rem 0.6rem",children:S.industry})]},x))})]})})]}),h&&s("div",{children:[s("div",{style:"display:flex;gap:1rem;margin-bottom:1rem",children:[s("div",{class:"card",style:"flex:1;padding:0.75rem;text-align:center",children:[s("div",{style:"font-size:1.25rem;font-weight:700;color:var(--success)",children:h.created.companies}),s("div",{style:"font-size:0.75rem;color:var(--text-muted)",children:"Firmen erstellt"})]}),s("div",{class:"card",style:"flex:1;padding:0.75rem;text-align:center",children:[s("div",{style:"font-size:1.25rem;font-weight:700;color:var(--success)",children:h.created.contacts}),s("div",{style:"font-size:0.75rem;color:var(--text-muted)",children:"Kontakte erstellt"})]})]}),(h.skipped.companies>0||h.skipped.contacts>0)&&s("p",{style:"font-size:0.8rem;color:var(--text-muted);margin-bottom:0.5rem",children:[[h.skipped.companies>0&&`${h.skipped.companies} Firma(en)`,h.skipped.contacts>0&&`${h.skipped.contacts} Kontakt(e)`].filter(Boolean).join(" und ")," bereits vorhanden (uebersprungen)"]}),h.errors.length>0&&s("div",{style:"margin-top:0.75rem",children:[s("p",{style:"font-size:0.8rem;color:var(--error);font-weight:600;margin-bottom:0.25rem",children:"Fehler:"}),h.errors.map((S,x)=>s("p",{style:"font-size:0.8rem;color:var(--error)",children:S},x))]})]})]})}const _2=Object.entries(ks).map(([t,e])=>({value:t,label:e}));function w2(){const[t,e]=me(""),[n,r]=me(null),[a,i]=me(!1),[o,l]=me(new Set),[c,u]=me(!1),{contacts:h,loading:g,refetch:b}=sc({search:t,source:n}),p=Gn(),y=(T,O)=>{O.stopPropagation(),l(E=>{const M=new Set(E);return M.has(T)?M.delete(T):M.add(T),M})},_=()=>{o.size===h.length?l(new Set):l(new Set(h.map(T=>T.id)))},S=async()=>{if(o.size===0)return;const T=o.size;if(!confirm(`${T} Kontakt(e) wirklich loeschen?`))return;u(!0);const O=[...o],E=new Date().toISOString(),{error:M}=await Ne.from("contacts").update({deleted_at:E}).in("id",O);M?p.error("Fehler beim Loeschen"):(p.success(`${T} Kontakt(e) geloescht`),l(new Set),b()),u(!1)};function x(){if(h.length===0)return;const T=";",O=["Vorname","Nachname","E-Mail","Telefon","Position","Firma","Quelle","Erstellt"],E=h.map(F=>{var I;return[F.first_name||"",F.last_name||"",F.email||"",F.phone||"",F.position||"",((I=F.company)==null?void 0:I.name)||"",ks[F.source]||F.source||"",F.created_at?F.created_at.slice(0,10):""].map(k=>`"${String(k).replace(/"/g,'""')}"`).join(T)}),M="\uFEFF"+[O.join(T),...E].join(`\r
`),ee=new Blob([M],{type:"text/csv;charset=utf-8;"}),G=URL.createObjectURL(ee),X=document.createElement("a");X.href=G,X.download=`kontakte-${new Date().toISOString().slice(0,10)}.csv`,X.click(),URL.revokeObjectURL(G)}return s(xt,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Kontakte"}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap;justify-content:flex-end",children:[o.size>0&&s("button",{class:"btn btn-danger btn-sm",onClick:S,disabled:c,children:c?"Loesche...":`${o.size} loeschen`}),s("button",{class:"btn btn-secondary btn-sm hide-mobile-sm",onClick:x,disabled:h.length===0,children:"CSV Export"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>i(!0),children:"Import"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>qe("/crm/contacts/new"),children:"+ Neu"})]})]}),s("div",{class:"page-body",children:[s("div",{class:"search-bar",children:s(mg,{value:t,onInput:e,placeholder:"Name oder E-Mail suchen..."})}),s("div",{style:"margin-bottom: 1rem",children:s(wd,{filters:_2,active:n,onSelect:r})}),g?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):h.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Kontakte gefunden"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{style:"width:40px",children:s("input",{type:"checkbox",checked:o.size===h.length&&h.length>0,onChange:_,style:"width:16px;height:16px;cursor:pointer"})}),s("th",{children:"Name"}),s("th",{children:"E-Mail"}),s("th",{children:"Firma"}),s("th",{children:"Quelle"}),s("th",{children:"Erstellt"})]})}),s("tbody",{children:h.map(T=>{var O,E;return s("tr",{class:"clickable-row",onClick:()=>qe(`/crm/contacts/${T.id}`),children:[s("td",{"data-label":"",onClick:M=>M.stopPropagation(),style:"width:40px",children:s("input",{type:"checkbox",checked:o.has(T.id),onChange:M=>y(T.id,M),style:"width:16px;height:16px;cursor:pointer"})}),s("td",{"data-label":"Name",style:"font-weight:500",children:T.first_name||T.last_name?`${T.first_name||""} ${T.last_name||""}`.trim():""}),s("td",{"data-label":"E-Mail",children:(O=T.email)!=null&&O.endsWith("@platzhalter.de")?s("span",{style:"color:var(--text-dim);font-style:italic",children:T.email}):T.email}),s("td",{"data-label":"Firma",children:((E=T.company)==null?void 0:E.name)||""}),s("td",{"data-label":"Quelle",children:s("span",{class:"filter-pill",style:"cursor:default;font-size:0.7rem;padding:0.15rem 0.5rem",children:ks[T.source]||T.source})}),s("td",{"data-label":"Erstellt",style:"color:var(--text-dim)",children:jn(T.created_at)})]},T.id)})})]})})})]}),a&&s(y2,{onClose:()=>i(!1),onSuccess:()=>{p.success("Import abgeschlossen"),b()}})]})}function x2({id:t}){var k;const{contact:e,loading:n,update:r,softDelete:a}=p2(t),{companies:i}=oc(),{deals:o}=yd({contactId:t}),{activities:l,refetch:c}=gd({contactId:t}),u=Gn(),[h,g]=me(!1),[b,p]=me({}),[y,_]=me("keep"),[S,x]=me(""),[T,O]=me(!1),[E,M]=me({type:"note",description:"",due_date:""});if(n)return s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Kontakt"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Nicht gefunden"})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Kontakt nicht gefunden"})})})]});function ee(){p({first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",phone:e.phone||"",position:e.position||"",company_id:e.company_id||"",source:e.source||"manual",source_detail:e.source_detail||"",gdpr_consent:!!e.gdpr_consent}),_("keep"),x(""),g(!0)}async function G(){try{const A={...b};if(A.gdpr_consent&&!e.gdpr_consent?A.gdpr_consent_at=new Date().toISOString():A.gdpr_consent||(A.gdpr_consent_at=null),y==="new"&&S.trim()){const{data:q,error:K}=await lc({name:S.trim()});if(K)throw K;A.company_id=q.id}else y==="remove"&&(A.company_id=null);const{error:j}=await r(A);if(j)throw j;u.success("Kontakt aktualisiert"),g(!1)}catch(A){u.error(A.message||"Fehler beim Speichern")}}async function X(){const A=o.length,j=A>0?`Dieser Kontakt hat ${A} verknuepfte(n) Deal(s). Kontakt wirklich loeschen?`:"Kontakt wirklich loeschen?";if(!confirm(j))return;const{error:q}=await a();q?u.error("Fehler beim Loeschen"):(u.success("Kontakt geloescht"),qe("/crm/contacts"))}async function F(A){A.preventDefault();const{error:j}=await gg({contact_id:t,type:E.type,description:E.description,due_date:E.type==="task"&&E.due_date?E.due_date:null});j?u.error("Fehler beim Erstellen"):(u.success("Aktivitaet hinzugefuegt"),O(!1),M({type:"note",description:"",due_date:""}),c())}const I=`${e.first_name||""} ${e.last_name||""}`.trim()||e.email;return s(xt,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/contacts"),children:""}),s("h1",{class:"page-title",children:I})]}),s("div",{style:"display:flex;gap:0.5rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>O(!0),children:"+ Aktivitaet"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe(`/crm/deals/new?contact_id=${t}`),children:"+ Deal"}),!h&&s("button",{class:"btn btn-secondary btn-sm",onClick:ee,children:"Bearbeiten"}),s("button",{class:"btn btn-danger btn-sm",onClick:X,children:"Loeschen"})]})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Stammdaten"})}),h?s("div",{children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Vorname"}),s("input",{value:b.first_name,onInput:A=>p({...b,first_name:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Nachname"}),s("input",{value:b.last_name,onInput:A=>p({...b,last_name:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"E-Mail"}),s("input",{type:"email",value:b.email,onInput:A=>p({...b,email:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Telefon"}),s("input",{value:b.phone,onInput:A=>p({...b,phone:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Position"}),s("input",{value:b.position,onInput:A=>p({...b,position:A.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Firma"}),s("div",{style:"display:flex;gap:0.25rem;margin-bottom:0.5rem",children:[s("button",{type:"button",class:`filter-pill ${y==="keep"?"active":""}`,onClick:()=>_("keep"),children:e.company?"Beibehalten":"Keine"}),s("button",{type:"button",class:`filter-pill ${y==="change"?"active":""}`,onClick:()=>_("change"),children:"Andere waehlen"}),s("button",{type:"button",class:`filter-pill ${y==="new"?"active":""}`,onClick:()=>_("new"),children:"Neue"}),e.company&&s("button",{type:"button",class:`filter-pill ${y==="remove"?"active":""}`,onClick:()=>_("remove"),children:"Entfernen"})]}),y==="keep"&&e.company&&s("div",{style:"font-size:0.85rem;color:var(--text-dim)",children:e.company.name}),y==="change"&&s("select",{value:b.company_id,onChange:A=>p({...b,company_id:A.target.value}),children:[s("option",{value:"",children:" Firma waehlen "}),i.map(A=>s("option",{value:A.id,children:A.name},A.id))]}),y==="new"&&s("input",{value:S,onInput:A=>x(A.target.value),placeholder:"Neuer Firmenname"}),y==="remove"&&s("div",{style:"font-size:0.85rem;color:var(--text-dim)",children:"Firma-Verknuepfung wird entfernt"})]}),s("div",{class:"form-group",children:[s("label",{children:"Quelle"}),s("select",{value:b.source,onChange:A=>p({...b,source:A.target.value}),children:Object.entries(ks).map(([A,j])=>s("option",{value:A,children:j},A))})]}),s("div",{class:"form-group",children:[s("label",{children:"Quelle Detail"}),s("input",{value:b.source_detail,onInput:A=>p({...b,source_detail:A.target.value}),placeholder:"z.B. Blog: Hotels"})]}),s("div",{class:"form-group form-group-full",children:s("label",{style:"display:flex;align-items:center;gap:0.5rem;cursor:pointer;text-transform:none;letter-spacing:normal;font-size:0.875rem;",children:[s("input",{type:"checkbox",checked:b.gdpr_consent,onChange:A=>p({...b,gdpr_consent:A.target.checked}),style:"width:16px;height:16px;cursor:pointer;"}),"DSGVO-Einwilligung erteilt"]})})]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>g(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary btn-sm",onClick:G,children:"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Vorname"}),s("span",{class:"detail-value",children:e.first_name||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Nachname"}),s("span",{class:"detail-value",children:e.last_name||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"E-Mail"}),s("span",{class:"detail-value",children:(k=e.email)!=null&&k.endsWith("@platzhalter.de")?s("span",{style:"color:var(--text-dim);font-style:italic",title:"Platzhalter  bitte echte E-Mail eintragen",children:e.email}):s("a",{href:`mailto:${e.email}`,children:e.email})})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Telefon"}),s("span",{class:"detail-value",children:e.phone?s("a",{href:`tel:${e.phone}`,children:e.phone}):""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Position"}),s("span",{class:"detail-value",children:e.position||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Firma"}),s("span",{class:"detail-value",children:e.company?s("a",{href:"#",onClick:A=>{A.preventDefault(),qe(`/crm/companies/${e.company.id}`)},children:e.company.name}):""})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Deals (",o.length,")"]})}),o.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Deals"}):s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Titel"}),s("th",{children:"Stage"}),s("th",{children:"Wert"})]})}),s("tbody",{children:o.map(A=>s("tr",{class:"clickable-row",onClick:()=>qe(`/crm/deals/${A.id}`),children:[s("td",{children:A.title}),s("td",{children:s(ac,{stage:A.stage})}),s("td",{children:A.value?Be(A.value):""})]},A.id))})]})})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Aktivitaeten (",l.length,")"]})}),l.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Aktivitaeten"}):s("div",{class:"timeline",children:l.map(A=>s(bd,{activity:A},A.id))})]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Quelle"}),s("span",{class:"detail-value",children:ks[e.source]||e.source})]}),e.source_detail&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Detail"}),s("span",{class:"detail-value",children:e.source_detail})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"DSGVO-Einwilligung"}),s("span",{class:"detail-value",children:e.gdpr_consent?"Ja":"Nein"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:jn(e.created_at)})]})]})})]})}),T&&s(ua,{title:"Aktivitaet hinzufuegen",onClose:()=>O(!1),children:s("form",{onSubmit:F,children:[s("div",{class:"form-group",children:[s("label",{children:"Typ"}),s("select",{value:E.type,onChange:A=>M({...E,type:A.target.value}),children:Object.entries(md).filter(([A])=>!["form_submission","stage_change","created","edited"].includes(A)).map(([A,j])=>s("option",{value:A,children:[j.icon," ",j.label]},A))})]}),s("div",{class:"form-group",children:[s("label",{children:"Beschreibung"}),s("textarea",{value:E.description,onInput:A=>M({...E,description:A.target.value}),required:!0})]}),E.type==="task"&&s("div",{class:"form-group",children:[s("label",{children:"Faellig am"}),s("input",{type:"date",value:E.due_date,onInput:A=>M({...E,due_date:A.target.value})})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>O(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",children:"Speichern"})]})]})})]})}function S2(){const t=Gn(),{companies:e}=oc(),[n,r]=me(!1),[a,i]=me("none"),[o,l]=me({first_name:"",last_name:"",email:"",phone:"",position:"",source:"manual",source_detail:"",company_id:"",new_company_name:"",gdpr_consent:!1});function c(h,g){l(b=>({...b,[h]:g}))}async function u(h){h.preventDefault(),r(!0);try{let g=null;if(a==="existing"&&o.company_id)g=o.company_id;else if(a==="new"&&o.new_company_name.trim()){const{data:y,error:_}=await lc({name:o.new_company_name.trim()});if(_)throw _;g=y.id}const{data:b,error:p}=await _d({first_name:o.first_name,last_name:o.last_name,email:o.email,phone:o.phone||null,position:o.position||null,source:o.source,source_detail:o.source_detail||null,company_id:g,gdpr_consent:o.gdpr_consent,gdpr_consent_at:o.gdpr_consent?new Date().toISOString():null});if(p)throw p;t.success("Kontakt erstellt"),qe(`/crm/contacts/${b.id}`)}catch(g){t.error(g.message||"Fehler beim Erstellen")}r(!1)}return s(xt,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/contacts"),children:""}),s("h1",{class:"page-title",children:"Neuer Kontakt"})]})}),s("div",{class:"page-body",children:s("div",{class:"card",style:"max-width: 640px",children:s("form",{onSubmit:u,children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Vorname"}),s("input",{value:o.first_name,onInput:h=>c("first_name",h.target.value)})]}),s("div",{class:"form-group",children:[s("label",{children:"Nachname"}),s("input",{value:o.last_name,onInput:h=>c("last_name",h.target.value)})]}),s("div",{class:"form-group",children:[s("label",{children:"E-Mail *"}),s("input",{type:"email",required:!0,value:o.email,onInput:h=>c("email",h.target.value)})]}),s("div",{class:"form-group",children:[s("label",{children:"Telefon"}),s("input",{type:"tel",value:o.phone,onInput:h=>c("phone",h.target.value)})]}),s("div",{class:"form-group",children:[s("label",{children:"Position"}),s("input",{value:o.position,onInput:h=>c("position",h.target.value),placeholder:"z.B. Geschaeftsfuehrer"})]}),s("div",{class:"form-group",children:[s("label",{children:"Firma"}),s("div",{style:"display:flex;gap:0.25rem;margin-bottom:0.5rem",children:[s("button",{type:"button",class:`filter-pill ${a==="none"?"active":""}`,onClick:()=>i("none"),children:"Keine"}),s("button",{type:"button",class:`filter-pill ${a==="existing"?"active":""}`,onClick:()=>i("existing"),children:"Bestehende"}),s("button",{type:"button",class:`filter-pill ${a==="new"?"active":""}`,onClick:()=>i("new"),children:"Neue"})]}),a==="existing"&&s("select",{value:o.company_id,onChange:h=>c("company_id",h.target.value),children:[s("option",{value:"",children:" Firma waehlen "}),e.map(h=>s("option",{value:h.id,children:h.name},h.id))]}),a==="new"&&s("input",{value:o.new_company_name,onInput:h=>c("new_company_name",h.target.value),placeholder:"Neuer Firmenname"})]}),s("div",{class:"form-group",children:[s("label",{children:"Quelle"}),s("select",{value:o.source,onChange:h=>c("source",h.target.value),children:Object.entries(ks).map(([h,g])=>s("option",{value:h,children:g},h))})]}),s("div",{class:"form-group",children:[s("label",{children:"Quelle (Detail)"}),s("input",{value:o.source_detail,onInput:h=>c("source_detail",h.target.value),placeholder:"z.B. Blog: Hotels"})]}),s("div",{class:"form-group form-group-full",children:s("label",{style:"display:flex;align-items:center;gap:0.5rem;text-transform:none;font-size:0.85rem;cursor:pointer",children:[s("input",{type:"checkbox",checked:o.gdpr_consent,onChange:h=>c("gdpr_consent",h.target.checked),style:"width:auto"}),"DSGVO-Einwilligung erteilt"]})})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>qe("/crm/contacts"),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",disabled:n,children:n?"Erstelle...":"Kontakt erstellen"})]})]})})})]})}const A2=vd.map(t=>({value:t,label:t}));function k2(){const[t,e]=me(""),[n,r]=me(null),{companies:a,loading:i,refetch:o}=oc({search:t,industry:n}),[l,c]=me(!1),[u,h]=me({name:"",industry:"",city:"",website:""}),[g,b]=me(new Set),[p,y]=me(!1),_=Gn(),S=(E,M)=>{M.stopPropagation(),b(ee=>{const G=new Set(ee);return G.has(E)?G.delete(E):G.add(E),G})},x=()=>{g.size===a.length?b(new Set):b(new Set(a.map(E=>E.id)))},T=async()=>{if(g.size===0)return;const E=g.size,M=[...g],{data:ee}=await Ne.from("contacts").select("id").in("company_id",M).is("deleted_at",null),G=(ee||[]).length,X=G>0?`${E} Firma(en) loeschen? ${G} verknuepfte(r) Kontakt(e) verlieren die Firmenzuordnung.`:`${E} Firma(en) wirklich loeschen?`;if(!confirm(X))return;y(!0);const F=new Date().toISOString(),{error:I}=await Ne.from("companies").update({deleted_at:F}).in("id",M);I?_.error("Fehler beim Loeschen"):(_.success(`${E} Firma(en) geloescht`),b(new Set),o()),y(!1)};async function O(E){E.preventDefault();const{data:M,error:ee}=await lc({name:u.name,industry:u.industry||null,city:u.city||null,website:u.website||null});ee?_.error("Fehler beim Erstellen"):(_.success("Firma erstellt"),c(!1),h({name:"",industry:"",city:"",website:""}),o())}return s(xt,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Firmen"}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap;justify-content:flex-end",children:[g.size>0&&s("button",{class:"btn btn-danger btn-sm",onClick:T,disabled:p,children:p?"Loesche...":`${g.size} loeschen`}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>c(!0),children:"+ Neue Firma"})]})]}),s("div",{class:"page-body",children:[s("div",{class:"search-bar",children:s(mg,{value:t,onInput:e,placeholder:"Firma oder Stadt suchen..."})}),s("div",{style:"margin-bottom: 1rem",children:s(wd,{filters:A2,active:n,onSelect:r})}),i?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):a.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Firmen gefunden"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{style:"width:40px",children:s("input",{type:"checkbox",checked:g.size===a.length&&a.length>0,onChange:x,style:"width:16px;height:16px;cursor:pointer"})}),s("th",{children:"Name"}),s("th",{children:"Branche"}),s("th",{children:"Stadt"}),s("th",{children:"Website"}),s("th",{children:"Erstellt"})]})}),s("tbody",{children:a.map(E=>s("tr",{class:"clickable-row",onClick:()=>qe(`/crm/companies/${E.id}`),children:[s("td",{"data-label":"",onClick:M=>M.stopPropagation(),style:"width:40px",children:s("input",{type:"checkbox",checked:g.has(E.id),onChange:M=>S(E.id,M),style:"width:16px;height:16px;cursor:pointer"})}),s("td",{"data-label":"Name",style:"font-weight:500",children:E.name}),s("td",{"data-label":"Branche",children:E.industry||""}),s("td",{"data-label":"Stadt",children:E.city||""}),s("td",{"data-label":"Website",children:E.website?s("a",{href:E.website,target:"_blank",rel:"noopener",onClick:M=>M.stopPropagation(),children:E.website}):""}),s("td",{"data-label":"Erstellt",style:"color:var(--text-dim)",children:jn(E.created_at)})]},E.id))})]})})})]}),l&&s(ua,{title:"Neue Firma",onClose:()=>c(!1),children:s("form",{onSubmit:O,children:[s("div",{class:"form-group",children:[s("label",{children:"Firmenname *"}),s("input",{required:!0,value:u.name,onInput:E=>h({...u,name:E.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Branche"}),s("select",{value:u.industry,onChange:E=>h({...u,industry:E.target.value}),children:[s("option",{value:"",children:" Auswaehlen "}),vd.map(E=>s("option",{value:E,children:E},E))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Stadt"}),s("input",{value:u.city,onInput:E=>h({...u,city:E.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Website"}),s("input",{value:u.website,onInput:E=>h({...u,website:E.target.value}),placeholder:"https://"})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>c(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",children:"Erstellen"})]})]})})]})}function N2({id:t}){const{company:e,loading:n,update:r,softDelete:a}=g2(t),{contacts:i,refetch:o}=sc(),{deals:l}=yd({companyId:t}),{invoices:c}=pd({companyId:t});gd({companyId:t});const u=Gn(),[h,g]=me(!1),[b,p]=me({}),[y,_]=me(!1),[S,x]=me(!1),[T,O]=me(""),[E,M]=me({first_name:"",last_name:"",email:"",phone:"",source:"manual"}),ee=i.filter(A=>A.company_id===t);if(n)return s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Firma"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Nicht gefunden"})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Firma nicht gefunden"})})})]});function G(){p({name:e.name||"",industry:e.industry||"",website:e.website||"",address:e.address||"",city:e.city||"",notes:e.notes||""}),g(!0)}async function X(A){A.preventDefault();const{error:j}=await _d({first_name:E.first_name||null,last_name:E.last_name||null,email:E.email||null,phone:E.phone||null,source:E.source||"manual",company_id:t});j?u.error("Fehler beim Erstellen"):(u.success("Kontakt erstellt"),_(!1),M({first_name:"",last_name:"",email:"",phone:"",source:"manual"}),o())}async function F(){if(!T)return;const{error:A}=await Ne.from("contacts").update({company_id:t}).eq("id",T);A?u.error("Fehler beim Verknuepfen"):(u.success("Kontakt verknuepft"),x(!1),O(""),o())}async function I(){const{error:A}=await r(b);A?u.error("Fehler beim Speichern"):(u.success("Firma aktualisiert"),g(!1))}async function k(){const A=ee.length,j=A>0?`Firma "${e.name}" hat ${A} verknuepfte(n) Kontakt(e). Wirklich loeschen?`:`Firma "${e.name}" wirklich loeschen?`;if(!confirm(j))return;const{error:q}=await a();q?u.error("Fehler beim Loeschen"):(u.success("Firma geloescht"),qe("/crm/companies"))}return s(xt,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/companies"),children:""}),s("h1",{class:"page-title",children:e.name})]}),s("div",{style:"display:flex;gap:0.5rem",children:[!h&&s("button",{class:"btn btn-secondary btn-sm",onClick:G,children:"Bearbeiten"}),s("button",{class:"btn btn-danger btn-sm",onClick:k,children:"Loeschen"})]})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Firmendaten"})}),h?s("div",{children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Name"}),s("input",{value:b.name,onInput:A=>p({...b,name:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Branche"}),s("select",{value:b.industry,onChange:A=>p({...b,industry:A.target.value}),children:[s("option",{value:"",children:""}),vd.map(A=>s("option",{value:A,children:A},A))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Website"}),s("input",{value:b.website,onInput:A=>p({...b,website:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Stadt"}),s("input",{value:b.city,onInput:A=>p({...b,city:A.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Adresse"}),s("input",{value:b.address,onInput:A=>p({...b,address:A.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Notizen"}),s("textarea",{value:b.notes,onInput:A=>p({...b,notes:A.target.value})})]})]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>g(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary btn-sm",onClick:I,children:"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Name"}),s("span",{class:"detail-value",children:e.name})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Branche"}),s("span",{class:"detail-value",children:e.industry||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Website"}),s("span",{class:"detail-value",children:e.website?s("a",{href:e.website,target:"_blank",rel:"noopener",children:e.website}):""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Stadt"}),s("span",{class:"detail-value",children:e.city||""})]}),s("div",{class:"detail-field form-group-full",children:[s("span",{class:"detail-label",children:"Adresse"}),s("span",{class:"detail-value",children:e.address||""})]}),e.notes&&s("div",{class:"detail-field form-group-full",children:[s("span",{class:"detail-label",children:"Notizen"}),s("span",{class:"detail-value",children:e.notes})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:["Kontakte (",ee.length,")"]}),!y&&!S&&s("div",{style:"display:flex;gap:0.25rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>x(!0),children:"Verknuepfen"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>_(!0),children:"+ Neu"})]})]}),S&&s("div",{style:"margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid var(--border)",children:[s("div",{class:"form-grid",children:s("div",{class:"form-group form-group-full",children:[s("label",{children:"Bestehenden Kontakt waehlen"}),s("select",{value:T,onChange:A=>O(A.target.value),children:[s("option",{value:"",children:" Kontakt waehlen "}),i.filter(A=>A.company_id!==t).map(A=>s("option",{value:A.id,children:[`${A.first_name||""} ${A.last_name||""}`.trim()||A.email,A.company?` (${A.company.name})`:""]},A.id))]})]})}),s("div",{class:"form-actions",style:"margin-top:0.5rem;border-top:none;padding-top:0",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:()=>{x(!1),O("")},children:"Abbrechen"}),s("button",{type:"button",class:"btn btn-primary btn-sm",onClick:F,disabled:!T,children:"Verknuepfen"})]})]}),y&&s("form",{onSubmit:X,style:"margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid var(--border)",children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Vorname"}),s("input",{value:E.first_name,onInput:A=>M({...E,first_name:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Nachname"}),s("input",{value:E.last_name,onInput:A=>M({...E,last_name:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"E-Mail"}),s("input",{type:"email",value:E.email,onInput:A=>M({...E,email:A.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Telefon"}),s("input",{value:E.phone,onInput:A=>M({...E,phone:A.target.value})})]})]}),s("div",{class:"form-actions",style:"margin-top:0.5rem;border-top:none;padding-top:0",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:()=>_(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary btn-sm",children:"Erstellen"})]})]}),ee.length===0&&!y?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Kontakte"}):ee.length>0&&s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Name"}),s("th",{children:"E-Mail"}),s("th",{children:"Position"})]})}),s("tbody",{children:ee.map(A=>s("tr",{class:"clickable-row",onClick:()=>qe(`/crm/contacts/${A.id}`),children:[s("td",{children:`${A.first_name||""} ${A.last_name||""}`.trim()||""}),s("td",{children:A.email}),s("td",{children:A.position||""})]},A.id))})]})})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Deals (",l.length,")"]})}),l.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Deals"}):s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Titel"}),s("th",{children:"Stage"}),s("th",{children:"Wert"})]})}),s("tbody",{children:l.map(A=>s("tr",{class:"clickable-row",onClick:()=>qe(`/crm/deals/${A.id}`),children:[s("td",{children:A.title}),s("td",{children:s(ac,{stage:A.stage})}),s("td",{children:A.value?Be(A.value):""})]},A.id))})]})})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Rechnungen / Angebote (",c.length,")"]})}),c.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Rechnungen"}):s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Nummer"}),s("th",{children:"Typ"}),s("th",{children:"Status"}),s("th",{style:"text-align:right",children:"Betrag"})]})}),s("tbody",{children:c.map(A=>{var j,q,K,le;return s("tr",{class:"clickable-row",onClick:()=>qe(`/crm/invoices/${A.id}`),children:[s("td",{style:"font-weight:600",children:A.invoice_number}),s("td",{children:(j=As[A.type])==null?void 0:j.label}),s("td",{children:s("span",{class:"stage-badge",style:`color:${(q=Qn[A.status])==null?void 0:q.color};background:${(K=Qn[A.status])==null?void 0:K.color}20`,children:(le=Qn[A.status])==null?void 0:le.label})}),s("td",{style:"text-align:right",children:Be(A.total_amount)})]},A.id)})})]})})]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:jn(e.created_at)})]})})})]})})]})}function E2({id:t}){const{deal:e,loading:n,update:r,changeStage:a}=c2(t),{activities:i,refetch:o}=gd({dealId:t}),{invoices:l}=pd({dealId:t}),c=Gn(),[u,h]=me(!1),[g,b]=me({}),[p,y]=me(!1),[_,S]=me({type:"note",description:"",due_date:""});if(n)return s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Deal"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Nicht gefunden"})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Deal nicht gefunden"})})})]});function x(){b({title:e.title||"",value:e.value||"",service_type:e.service_type||"",expected_close:e.expected_close||"",lost_reason:e.lost_reason||""}),h(!0)}async function T(){const{error:M}=await r({...g,value:g.value?parseFloat(g.value):null,service_type:g.service_type||null,expected_close:g.expected_close||null,lost_reason:g.lost_reason||null});M?c.error("Fehler beim Speichern"):(c.success("Deal aktualisiert"),h(!1))}async function O(M){const{error:ee}=await a(M);ee?c.error("Fehler beim Aendern"):(c.success(`Stage auf "${Mi[M].label}" geaendert`),o())}async function E(M){M.preventDefault();const{error:ee}=await gg({deal_id:t,contact_id:e.contact_id||null,type:_.type,description:_.description,due_date:_.type==="task"&&_.due_date?_.due_date:null});ee?c.error("Fehler beim Erstellen"):(c.success("Aktivitaet hinzugefuegt"),y(!1),S({type:"note",description:"",due_date:""}),o())}return s(xt,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/pipeline"),children:""}),s("h1",{class:"page-title",children:e.title}),s(ac,{stage:e.stage})]}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>y(!0),children:"+ Aktivitaet"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe(`/crm/invoices/new?type=quote&deal_id=${t}`),children:"+ Angebot"}),e.stage==="won"&&s("button",{class:"btn btn-primary btn-sm",onClick:()=>qe(`/crm/invoices/new?type=invoice&deal_id=${t}`),children:"+ Rechnung"}),!u&&s("button",{class:"btn btn-secondary btn-sm",onClick:x,children:"Bearbeiten"})]})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Deal-Infos"})}),u?s("div",{children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group form-group-full",children:[s("label",{children:"Titel"}),s("input",{value:g.title,onInput:M=>b({...g,title:M.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Wert (EUR)"}),s("input",{type:"number",step:"0.01",value:g.value,onInput:M=>b({...g,value:M.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Service-Typ"}),s("select",{value:g.service_type,onChange:M=>b({...g,service_type:M.target.value}),children:[s("option",{value:"",children:""}),Object.entries(Wu).map(([M,ee])=>s("option",{value:M,children:ee},M))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Erwarteter Abschluss"}),s("input",{type:"date",value:g.expected_close,onInput:M=>b({...g,expected_close:M.target.value})})]}),e.stage==="lost"&&s("div",{class:"form-group",children:[s("label",{children:"Verlustgrund"}),s("input",{value:g.lost_reason,onInput:M=>b({...g,lost_reason:M.target.value})})]})]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>h(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary btn-sm",onClick:T,children:"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Titel"}),s("span",{class:"detail-value",children:e.title})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Wert"}),s("span",{class:"detail-value",children:e.value?Be(e.value):""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Service"}),s("span",{class:"detail-value",children:e.service_type?Wu[e.service_type]:""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erwarteter Abschluss"}),s("span",{class:"detail-value",children:jn(e.expected_close)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Kontakt"}),s("span",{class:"detail-value",children:e.contact?s("a",{href:"#",onClick:M=>{M.preventDefault(),qe(`/crm/contacts/${e.contact.id}`)},children:`${e.contact.first_name||""} ${e.contact.last_name||""}`.trim()||e.contact.email}):""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Firma"}),s("span",{class:"detail-value",children:e.company?s("a",{href:"#",onClick:M=>{M.preventDefault(),qe(`/crm/companies/${e.company.id}`)},children:e.company.name}):""})]}),e.lost_reason&&s("div",{class:"detail-field form-group-full",children:[s("span",{class:"detail-label",children:"Verlustgrund"}),s("span",{class:"detail-value",children:e.lost_reason})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Stage aendern"})}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap",children:Object.entries(Mi).map(([M,ee])=>s("button",{class:`btn btn-sm ${e.stage===M?"btn-primary":"btn-secondary"}`,onClick:()=>e.stage!==M&&O(M),disabled:e.stage===M,style:e.stage===M?`background:${ee.color}`:"",children:ee.label},M))})]}),l.length>0&&s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Rechnungen / Angebote (",l.length,")"]})}),s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Nummer"}),s("th",{children:"Typ"}),s("th",{children:"Status"}),s("th",{style:"text-align:right",children:"Betrag"})]})}),s("tbody",{children:l.map(M=>{var ee,G,X,F;return s("tr",{class:"clickable-row",onClick:()=>qe(`/crm/invoices/${M.id}`),children:[s("td",{style:"font-weight:600",children:M.invoice_number}),s("td",{children:(ee=As[M.type])==null?void 0:ee.label}),s("td",{children:s("span",{class:"stage-badge",style:`color:${(G=Qn[M.status])==null?void 0:G.color};background:${(X=Qn[M.status])==null?void 0:X.color}20`,children:(F=Qn[M.status])==null?void 0:F.label})}),s("td",{style:"text-align:right",children:Be(M.total_amount)})]},M.id)})})]})})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Aktivitaeten"})}),i.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Aktivitaeten"}):s("div",{class:"timeline",children:i.map(M=>s(bd,{activity:M},M.id))})]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Stage geaendert am"}),s("span",{class:"detail-value",children:jn(e.stage_changed_at)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:jn(e.created_at)})]})]})})]})}),p&&s(ua,{title:"Aktivitaet hinzufuegen",onClose:()=>y(!1),children:s("form",{onSubmit:E,children:[s("div",{class:"form-group",children:[s("label",{children:"Typ"}),s("select",{value:_.type,onChange:M=>S({..._,type:M.target.value}),children:Object.entries(md).filter(([M])=>!["form_submission","stage_change","created","edited"].includes(M)).map(([M,ee])=>s("option",{value:M,children:[ee.icon," ",ee.label]},M))})]}),s("div",{class:"form-group",children:[s("label",{children:"Beschreibung"}),s("textarea",{value:_.description,onInput:M=>S({..._,description:M.target.value}),required:!0})]}),_.type==="task"&&s("div",{class:"form-group",children:[s("label",{children:"Faellig am"}),s("input",{type:"date",value:_.due_date,onInput:M=>S({..._,due_date:M.target.value})})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>y(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",children:"Speichern"})]})]})})]})}function L2(){const t=Gn(),{contacts:e}=sc(),[n,r]=me(!1),i=new URLSearchParams(typeof window<"u"?window.location.search:"").get("contact_id")||"",[o,l]=me({title:"",contact_id:i,service_type:"",value:"",expected_close:""});function c(h,g){l(b=>({...b,[h]:g}))}async function u(h){h.preventDefault(),r(!0);try{let g=null;if(o.contact_id){const y=e.find(_=>_.id===o.contact_id);g=(y==null?void 0:y.company_id)||null}const{data:b,error:p}=await u2({title:o.title,contact_id:o.contact_id||null,company_id:g,service_type:o.service_type||null,value:o.value?parseFloat(o.value):null,expected_close:o.expected_close||null});if(p)throw p;t.success("Deal erstellt"),qe(`/crm/deals/${b.id}`)}catch(g){t.error(g.message||"Fehler beim Erstellen")}r(!1)}return s(xt,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/pipeline"),children:""}),s("h1",{class:"page-title",children:"Neuer Deal"})]})}),s("div",{class:"page-body",children:s("div",{class:"card",style:"max-width: 640px",children:s("form",{onSubmit:u,children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group form-group-full",children:[s("label",{children:"Titel *"}),s("input",{required:!0,value:o.title,onInput:h=>c("title",h.target.value),placeholder:"z.B. 360-Tour Restaurant Bellini"})]}),s("div",{class:"form-group",children:[s("label",{children:"Kontakt"}),s("select",{value:o.contact_id,onChange:h=>c("contact_id",h.target.value),children:[s("option",{value:"",children:" Auswaehlen "}),e.map(h=>s("option",{value:h.id,children:`${h.first_name||""} ${h.last_name||""}`.trim()||h.email},h.id))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Service-Typ"}),s("select",{value:o.service_type,onChange:h=>c("service_type",h.target.value),children:[s("option",{value:"",children:" Auswaehlen "}),Object.entries(Wu).map(([h,g])=>s("option",{value:h,children:g},h))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Wert (EUR)"}),s("input",{type:"number",step:"0.01",min:"0",value:o.value,onInput:h=>c("value",h.target.value),placeholder:"z.B. 1200"})]}),s("div",{class:"form-group",children:[s("label",{children:"Erwarteter Abschluss"}),s("input",{type:"date",value:o.expected_close,onInput:h=>c("expected_close",h.target.value)})]})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>qe("/crm/pipeline"),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",disabled:n,children:n?"Erstelle...":"Deal erstellen"})]})]})})})]})}function C2(){const{user:t}=rc(),e=Gn(),{settings:n,save:r,loading:a}=ic(),[i,o]=me({password:"",confirm:""}),[l,c]=me(!1),[u,h]=me({}),[g,b]=me(!1),[p,y]=me(!1),[_,S]=me(!1),[x,T]=me(!1),[O,E]=me({default_invoice_intro:"",default_quote_intro:"",payment_reference_note:""});Mt(()=>{n&&(h({company_name:n.company_name||"",owner_name:n.owner_name||"",address_line1:n.address_line1||"",address_zip:n.address_zip||"",address_city:n.address_city||"",phone:n.phone||"",email:n.email||"",website:n.website||"",tax_id:n.tax_id||"",vat_id:n.vat_id||"",bank_name:n.bank_name||"",bank_iban:n.bank_iban||"",bank_bic:n.bank_bic||"",default_payment_days:n.default_payment_days||14,vat_rate:n.vat_rate||19,default_closing_text:n.default_closing_text||""}),E({default_invoice_intro:n.default_invoice_intro||"Vielen Dank fuer Ihren Auftrag. Ich berechne Ihnen fuer folgende Leistungen:",default_quote_intro:n.default_quote_intro||"Vielen Dank fuer Ihr Interesse. Gerne unterbreite ich Ihnen folgendes Angebot:",payment_reference_note:n.payment_reference_note||"Bitte verwenden Sie die Rechnungsnummer als Verwendungszweck."}))},[n]);async function M(I){I.preventDefault(),y(!0);const{error:k}=await r({...u,default_payment_days:parseInt(u.default_payment_days)||14,vat_rate:parseFloat(u.vat_rate)||19});k?e.error("Fehler: "+k.message):(e.success("Geschaeftsdaten gespeichert"),b(!1)),y(!1)}async function ee(I){I.preventDefault(),T(!0);const{error:k}=await r(O);k?e.error("Fehler: "+k.message):(e.success("Rechnungsvorlage gespeichert"),S(!1)),T(!1)}async function G(I){if(I.preventDefault(),i.password!==i.confirm){e.error("Passwoerter stimmen nicht ueberein");return}if(i.password.length<8){e.error("Passwort muss mindestens 8 Zeichen lang sein");return}c(!0);const{error:k}=await Ne.auth.updateUser({password:i.password});k?e.error("Fehler: "+k.message):(e.success("Passwort geaendert"),o({password:"",confirm:""})),c(!1)}async function X(){const{data:I,error:k}=await Ne.from("contacts").select("first_name, last_name, email, phone, source, created_at").is("deleted_at",null).order("created_at",{ascending:!1});if(k){e.error("Export fehlgeschlagen");return}const A=["Vorname,Nachname,E-Mail,Telefon,Quelle,Erstellt",...I.map(le=>[le.first_name,le.last_name,le.email,le.phone,le.source,le.created_at].map(ue=>`"${(ue||"").toString().replace(/"/g,'""')}"`).join(","))].join(`
`),j=new Blob(["\uFEFF"+A],{type:"text/csv;charset=utf-8"}),q=URL.createObjectURL(j),K=document.createElement("a");K.href=q,K.download=`beck360-kontakte-${new Date().toISOString().slice(0,10)}.csv`,K.click(),URL.revokeObjectURL(q),e.success("Export erstellt")}async function F(){if(!confirm("Alle geloeschten Kontakte endgueltig entfernen? Dies kann nicht rueckgaengig gemacht werden."))return;const{error:I}=await Ne.from("contacts").delete().not("deleted_at","is",null);I?e.error("Fehler: "+I.message):e.success("Geloeschte Kontakte endgueltig entfernt")}return s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Einstellungen"})}),s("div",{class:"page-body",children:s("div",{style:"display:flex;flex-direction:column;gap:1.5rem;max-width:640px",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Konto"})}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"E-Mail"}),s("span",{class:"detail-value",children:t==null?void 0:t.email})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"User ID"}),s("span",{class:"detail-value",style:"font-size:0.75rem;color:var(--text-dim);word-break:break-all",children:t==null?void 0:t.id})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Geschaeftsdaten"}),!g&&s("button",{class:"btn btn-secondary btn-sm",onClick:()=>b(!0),children:"Bearbeiten"})]}),a?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):g?s("form",{onSubmit:M,children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Firmenname"}),s("input",{value:u.company_name,onInput:I=>h({...u,company_name:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Inhaber"}),s("input",{value:u.owner_name,onInput:I=>h({...u,owner_name:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Adresse"}),s("input",{value:u.address_line1,onInput:I=>h({...u,address_line1:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"PLZ"}),s("input",{value:u.address_zip,onInput:I=>h({...u,address_zip:I.target.value}),style:"max-width:120px"})]}),s("div",{class:"form-group",children:[s("label",{children:"Stadt"}),s("input",{value:u.address_city,onInput:I=>h({...u,address_city:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Telefon"}),s("input",{value:u.phone,onInput:I=>h({...u,phone:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"E-Mail"}),s("input",{type:"email",value:u.email,onInput:I=>h({...u,email:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Website"}),s("input",{value:u.website,onInput:I=>h({...u,website:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Steuernummer"}),s("input",{value:u.tax_id,onInput:I=>h({...u,tax_id:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"USt-IdNr."}),s("input",{value:u.vat_id,onInput:I=>h({...u,vat_id:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Bank"}),s("input",{value:u.bank_name,onInput:I=>h({...u,bank_name:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"IBAN"}),s("input",{value:u.bank_iban,onInput:I=>h({...u,bank_iban:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"BIC"}),s("input",{value:u.bank_bic,onInput:I=>h({...u,bank_bic:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Zahlungsziel (Tage)"}),s("input",{type:"number",value:u.default_payment_days,onInput:I=>h({...u,default_payment_days:I.target.value}),style:"max-width:100px"})]}),s("div",{class:"form-group",children:[s("label",{children:"MwSt-Satz (%)"}),s("input",{type:"number",step:"0.01",value:u.vat_rate,onInput:I=>h({...u,vat_rate:I.target.value}),style:"max-width:100px"})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Standard-Schlusstext"}),s("textarea",{value:u.default_closing_text,onInput:I=>h({...u,default_closing_text:I.target.value})})]})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:()=>b(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary btn-sm",disabled:p,children:p?"Speichern...":"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Firma"}),s("span",{class:"detail-value",children:(n==null?void 0:n.company_name)||"BECK360"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Inhaber"}),s("span",{class:"detail-value",children:(n==null?void 0:n.owner_name)||"Eugen Beck"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Adresse"}),s("span",{class:"detail-value",children:[(n==null?void 0:n.address_line1)||"Eichenweg 1",", ",(n==null?void 0:n.address_zip)||"76275"," ",(n==null?void 0:n.address_city)||"Ettlingen"]})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Telefon"}),s("span",{class:"detail-value",children:(n==null?void 0:n.phone)||"0173-4682501"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"IBAN"}),s("span",{class:"detail-value",children:(n==null?void 0:n.bank_iban)||"DE92 5486 2500 0001 1389 95"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"MwSt."}),s("span",{class:"detail-value",children:[(n==null?void 0:n.vat_rate)||19,"%"]})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Rechnungsvorlage"}),!_&&s("button",{class:"btn btn-secondary btn-sm",onClick:()=>S(!0),children:"Bearbeiten"})]}),a?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):_?s("form",{onSubmit:ee,children:[s("div",{class:"form-group",children:[s("label",{children:"Standard-Einleitung Rechnung"}),s("textarea",{value:O.default_invoice_intro,onInput:I=>E({...O,default_invoice_intro:I.target.value}),rows:2})]}),s("div",{class:"form-group",children:[s("label",{children:"Standard-Einleitung Angebot"}),s("textarea",{value:O.default_quote_intro,onInput:I=>E({...O,default_quote_intro:I.target.value}),rows:2})]}),s("div",{class:"form-group",children:[s("label",{children:"Verwendungszweck-Hinweis"}),s("input",{value:O.payment_reference_note,onInput:I=>E({...O,payment_reference_note:I.target.value})})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:()=>S(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary btn-sm",disabled:x,children:x?"Speichern...":"Speichern"})]})]}):s("div",{style:"display:flex;flex-direction:column;gap:0.75rem",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Einleitung Rechnung"}),s("span",{class:"detail-value",style:"white-space:pre-wrap",children:O.default_invoice_intro})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Einleitung Angebot"}),s("span",{class:"detail-value",style:"white-space:pre-wrap",children:O.default_quote_intro})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Verwendungszweck"}),s("span",{class:"detail-value",children:O.payment_reference_note})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Passwort aendern"})}),s("form",{onSubmit:G,children:[s("div",{class:"form-group",children:[s("label",{children:"Neues Passwort"}),s("input",{type:"password",value:i.password,onInput:I=>o({...i,password:I.target.value}),minLength:8,required:!0,autocomplete:"new-password"})]}),s("div",{class:"form-group",children:[s("label",{children:"Passwort bestaetigen"}),s("input",{type:"password",value:i.confirm,onInput:I=>o({...i,confirm:I.target.value}),minLength:8,required:!0,autocomplete:"new-password"})]}),s("button",{type:"submit",class:"btn btn-primary btn-sm",disabled:l,children:l?"Speichern...":"Passwort aendern"})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"DSGVO-Tools"})}),s("div",{style:"display:flex;flex-direction:column;gap:0.75rem",children:[s("div",{children:[s("div",{style:"font-size:0.85rem;margin-bottom:0.35rem",children:"Kontakte als CSV exportieren"}),s("button",{class:"btn btn-secondary btn-sm",onClick:X,children:"CSV Export"})]}),s("div",{children:[s("div",{style:"font-size:0.85rem;margin-bottom:0.35rem",children:"Geloeschte Kontakte endgueltig entfernen (Recht auf Loeschung)"}),s("button",{class:"btn btn-danger btn-sm",onClick:F,children:"Endgueltig loeschen"})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"System-Info"})}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Version"}),s("span",{class:"detail-value",children:"1.0.0"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Datenbank"}),s("span",{class:"detail-value",children:"Supabase (Frankfurt, EU)"})]})]})]})})]})}function T2({status:t=null}={}){const[e,n]=me([]),[r,a]=me(!0),i=Nt(async()=>{a(!0);let o=Ne.from("campaigns").select("*").is("deleted_at",null).order("created_at",{ascending:!1});t&&(o=o.eq("status",t));const{data:l,error:c}=await o;c||n(l||[]),a(!1)},[t]);return Mt(()=>{i()},[i]),{campaigns:e,loading:r,refetch:i}}function P2(t){const[e,n]=me(null),[r,a]=me(!0),i=Nt(async()=>{if(!t)return;a(!0);const{data:c}=await Ne.from("campaigns").select("*").eq("id",t).single();n(c),a(!1)},[t]);Mt(()=>{i()},[i]);const o=Nt(async c=>{const{error:u}=await Ne.from("campaigns").update(c).eq("id",t);return u||await i(),{error:u}},[t,i]),l=Nt(async()=>Ne.from("campaigns").update({deleted_at:new Date().toISOString()}).eq("id",t),[t]);return{campaign:e,loading:r,refetch:i,update:o,remove:l}}function I2(t){const[e,n]=me([]),[r,a]=me(!0),i=Nt(async()=>{if(!t)return;a(!0);const{data:o}=await Ne.from("campaign_recipients").select("*, contact:contacts(first_name, last_name, email)").eq("campaign_id",t).order("created_at",{ascending:!1});n(o||[]),a(!1)},[t]);return Mt(()=>{i()},[i]),{recipients:e,loading:r,refetch:i}}async function Yc(t){const{data:e}=await Ne.auth.getUser();return Ne.from("campaigns").insert({...t,owner_id:e.user.id}).select().single()}async function tf(t,e){if(await Ne.from("campaign_recipients").delete().eq("campaign_id",t),e.length===0)return{error:null};const n=e.map(r=>({campaign_id:t,contact_id:r.id,email:r.email}));return Ne.from("campaign_recipients").insert(n)}async function O2(){const{data:t}=await Ne.auth.getUser(),e=new Date().toISOString();return Ne.from("campaigns").update({deleted_at:e}).eq("owner_id",t.user.id).is("deleted_at",null)}async function Gl(t,{testEmail:e}={}){const{data:{session:n}}=await Ne.auth.getSession();if(!n)throw new Error("Not authenticated");const r={campaign_id:t};e&&(r.test_email=e);const a=await fetch("/api/campaign-send",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify(r)}),i=await a.json();if(!a.ok)throw new Error(i.error||"Send failed");return i}const R2=Object.entries(oa).map(([t,{label:e}])=>({value:t,label:e}));function F2(){const[t,e]=me(null),{campaigns:n,loading:r,refetch:a}=T2({status:t}),i=Gn(),[o,l]=me(!1),[c,u]=me(!1);async function h(){u(!0);const{error:p}=await O2();p?i.error("Fehler beim Loeschen"):(i.success("Alle Kampagnen geloescht"),a()),u(!1),l(!1)}const g=n.filter(p=>p.status==="draft").length,b=n.filter(p=>p.status==="sent").length;return s(xt,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Kampagnen"}),s("div",{style:"display:flex;gap:0.5rem",children:[n.length>0&&s("button",{class:"btn btn-danger btn-sm",onClick:()=>l(!0),children:"Alle loeschen"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>qe("/crm/campaigns/new"),children:"+ Neue Kampagne"})]})]}),s("div",{class:"page-body",children:[!r&&n.length>0&&s("div",{style:"display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1rem;margin-bottom:1.5rem;",children:[s("div",{style:"background:linear-gradient(135deg,#6358DE 0%,#7c6ff7 100%);border-radius:var(--radius-lg);padding:1.25rem;color:#fff;",children:[s("div",{style:"font-size:2rem;font-weight:700;line-height:1",children:n.length}),s("div",{style:"font-size:0.8rem;opacity:0.85;margin-top:0.25rem",children:"Gesamt"})]}),s("div",{style:"background:linear-gradient(135deg,#0B996F 0%,#10b981 100%);border-radius:var(--radius-lg);padding:1.25rem;color:#fff;",children:[s("div",{style:"font-size:2rem;font-weight:700;line-height:1",children:b}),s("div",{style:"font-size:0.8rem;opacity:0.85;margin-top:0.25rem",children:"Versendet"})]}),s("div",{style:"background:linear-gradient(135deg,#1a5c6b 0%,#237a8c 100%);border-radius:var(--radius-lg);padding:1.25rem;color:#fff;",children:[s("div",{style:"font-size:2rem;font-weight:700;line-height:1",children:g}),s("div",{style:"font-size:0.8rem;opacity:0.85;margin-top:0.25rem",children:"Entwuerfe"})]}),s("div",{style:"background:linear-gradient(135deg,#f59e0b 0%,#fbbf24 100%);border-radius:var(--radius-lg);padding:1.25rem;color:#fff;",children:[s("div",{style:"font-size:2rem;font-weight:700;line-height:1",children:n.reduce((p,y)=>p+(y.total_sent||0),0)}),s("div",{style:"font-size:0.8rem;opacity:0.85;margin-top:0.25rem",children:"Mails gesendet"})]})]}),s("div",{style:"margin-bottom:1rem",children:s(wd,{filters:R2,active:t,onSelect:e})}),r?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):n.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Kampagnen gefunden"}),s("button",{class:"btn btn-primary",style:"margin-top:1rem",onClick:()=>qe("/crm/campaigns/new"),children:"Erste Kampagne erstellen"})]}):s("div",{style:"display:flex;flex-direction:column;gap:0.75rem;",children:n.map(p=>{const y=oa[p.status]||{},_=p.total_sent>0?Math.round(p.total_opened/p.total_sent*100):0;return s("div",{onClick:()=>qe(`/crm/campaigns/${p.id}`),style:"background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:1.25rem;cursor:pointer;transition:all 0.2s;box-shadow:var(--shadow);",onMouseEnter:S=>{S.currentTarget.style.boxShadow="var(--shadow-lg)",S.currentTarget.style.borderColor="#6358DE"},onMouseLeave:S=>{S.currentTarget.style.boxShadow="var(--shadow)",S.currentTarget.style.borderColor="var(--border)"},children:s("div",{style:"display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap;",children:[s("div",{style:"flex:1;min-width:200px;",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem;margin-bottom:0.35rem;",children:[s("span",{style:"font-weight:600;font-size:1rem;",children:p.name}),s("span",{class:"stage-badge",style:`background:${y.color||"#6366f1"}15;color:${y.color||"#6366f1"};`,children:y.label||p.status})]}),s("div",{style:"font-size:0.85rem;color:var(--text-muted);",children:p.subject})]}),s("div",{style:"display:flex;gap:1.5rem;align-items:center;",children:[p.status==="sent"&&s(xt,{children:[s("div",{style:"text-align:center;",children:[s("div",{style:"font-size:1.1rem;font-weight:700;color:#6358DE;",children:p.total_sent||0}),s("div",{style:"font-size:0.7rem;color:var(--text-dim);",children:"Gesendet"})]}),s("div",{style:"text-align:center;",children:[s("div",{style:"font-size:1.1rem;font-weight:700;color:#0B996F;",children:[_,"%"]}),s("div",{style:"font-size:0.7rem;color:var(--text-dim);",children:"Geoeffnet"})]})]}),s("div",{style:"font-size:0.8rem;color:var(--text-dim);",children:jn(p.sent_at||p.created_at)})]})]})},p.id)})})]}),o&&s(ua,{title:"Alle Kampagnen loeschen?",onClose:()=>l(!1),children:[s("p",{style:"margin-bottom:1rem;",children:[s("strong",{children:[n.length," Kampagne(n)"]})," werden unwiderruflich geloescht. Dieser Vorgang kann nicht rueckgaengig gemacht werden."]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary",onClick:()=>l(!1),children:"Abbrechen"}),s("button",{class:"btn btn-danger",onClick:h,disabled:c,children:c?"Loesche...":"Alle loeschen"})]})]})]})}/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:vg,setPrototypeOf:nf,isFrozen:D2,getPrototypeOf:j2,getOwnPropertyDescriptor:B2}=Object;let{freeze:or,seal:$r,create:Gu}=Object,{apply:Vu,construct:Ku}=typeof Reflect<"u"&&Reflect;or||(or=function(e){return e});$r||($r=function(e){return e});Vu||(Vu=function(e,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];return e.apply(n,a)});Ku||(Ku=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return new e(...r)});const bl=lr(Array.prototype.forEach),M2=lr(Array.prototype.lastIndexOf),rf=lr(Array.prototype.pop),to=lr(Array.prototype.push),U2=lr(Array.prototype.splice),Pl=lr(String.prototype.toLowerCase),Xc=lr(String.prototype.toString),Zc=lr(String.prototype.match),no=lr(String.prototype.replace),$2=lr(String.prototype.indexOf),q2=lr(String.prototype.trim),Xr=lr(Object.prototype.hasOwnProperty),sr=lr(RegExp.prototype.test),ro=z2(TypeError);function lr(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return Vu(t,e,r)}}function z2(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Ku(t,n)}}function Lt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Pl;nf&&nf(t,null);let r=e.length;for(;r--;){let a=e[r];if(typeof a=="string"){const i=n(a);i!==a&&(D2(e)||(e[r]=i),a=i)}t[a]=!0}return t}function H2(t){for(let e=0;e<t.length;e++)Xr(t,e)||(t[e]=null);return t}function fi(t){const e=Gu(null);for(const[n,r]of vg(t))Xr(t,n)&&(Array.isArray(r)?e[n]=H2(r):r&&typeof r=="object"&&r.constructor===Object?e[n]=fi(r):e[n]=r);return e}function io(t,e){for(;t!==null;){const r=B2(t,e);if(r){if(r.get)return lr(r.get);if(typeof r.value=="function")return lr(r.value)}t=j2(t)}function n(){return null}return n}const af=or(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Qc=or(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),eu=or(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),W2=or(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),tu=or(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),G2=or(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),sf=or(["#text"]),of=or(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),nu=or(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),lf=or(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),yl=or(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),V2=$r(/\{\{[\w\W]*|[\w\W]*\}\}/gm),K2=$r(/<%[\w\W]*|[\w\W]*%>/gm),J2=$r(/\$\{[\w\W]*/gm),Y2=$r(/^data-[\-\w.\u00B7-\uFFFF]+$/),X2=$r(/^aria-[\-\w]+$/),bg=$r(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Z2=$r(/^(?:\w+script|data):/i),Q2=$r(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),yg=$r(/^html$/i),eb=$r(/^[a-z][.\w]*(-[.\w]+)+$/i);var cf=Object.freeze({__proto__:null,ARIA_ATTR:X2,ATTR_WHITESPACE:Q2,CUSTOM_ELEMENT:eb,DATA_ATTR:Y2,DOCTYPE_NAME:yg,ERB_EXPR:K2,IS_ALLOWED_URI:bg,IS_SCRIPT_OR_DATA:Z2,MUSTACHE_EXPR:V2,TMPLIT_EXPR:J2});const ao={element:1,text:3,progressingInstruction:7,comment:8,document:9},tb=function(){return typeof window>"u"?null:window},nb=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(r=n.getAttribute(a));const i="dompurify"+(r?"#"+r:"");try{return e.createPolicy(i,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},uf=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function _g(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:tb();const e=Ue=>_g(Ue);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==ao.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const r=n,a=r.currentScript,{DocumentFragment:i,HTMLTemplateElement:o,Node:l,Element:c,NodeFilter:u,NamedNodeMap:h=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:g,DOMParser:b,trustedTypes:p}=t,y=c.prototype,_=io(y,"cloneNode"),S=io(y,"remove"),x=io(y,"nextSibling"),T=io(y,"childNodes"),O=io(y,"parentNode");if(typeof o=="function"){const Ue=n.createElement("template");Ue.content&&Ue.content.ownerDocument&&(n=Ue.content.ownerDocument)}let E,M="";const{implementation:ee,createNodeIterator:G,createDocumentFragment:X,getElementsByTagName:F}=n,{importNode:I}=r;let k=uf();e.isSupported=typeof vg=="function"&&typeof O=="function"&&ee&&ee.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:A,ERB_EXPR:j,TMPLIT_EXPR:q,DATA_ATTR:K,ARIA_ATTR:le,IS_SCRIPT_OR_DATA:ue,ATTR_WHITESPACE:ae,CUSTOM_ELEMENT:ge}=cf;let{IS_ALLOWED_URI:xe}=cf,pe=null;const C=Lt({},[...af,...Qc,...eu,...tu,...sf]);let $=null;const V=Lt({},[...of,...nu,...lf,...yl]);let J=Object.seal(Gu(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Z=null,ie=null;const fe=Object.seal(Gu(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Y=!0,se=!0,be=!1,Ce=!0,Te=!1,De=!0,U=!1,Pe=!1,ht=!1,He=!1,Se=!1,Ke=!1,Re=!0,Qe=!1;const Ie="user-content-";let it=!0,nt=!1,at={},ut=null;const pt=Lt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ze=null;const mt=Lt({},["audio","video","img","source","image","track"]);let We=null;const rn=Lt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Et="http://www.w3.org/1998/Math/MathML",bt="http://www.w3.org/2000/svg",ct="http://www.w3.org/1999/xhtml";let Dt=ct,et=!1,jt=null;const st=Lt({},[Et,bt,ct],Xc);let dt=Lt({},["mi","mo","mn","ms","mtext"]),Ut=Lt({},["annotation-xml"]);const kt=Lt({},["title","style","font","a","script"]);let tt=null;const Ft=["application/xhtml+xml","text/html"],yi="text/html";let Ct=null,Vn=null;const Tr=n.createElement("form"),rt=function(te){return te instanceof RegExp||te instanceof Function},mr=function(){let te=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Vn&&Vn===te)){if((!te||typeof te!="object")&&(te={}),te=fi(te),tt=Ft.indexOf(te.PARSER_MEDIA_TYPE)===-1?yi:te.PARSER_MEDIA_TYPE,Ct=tt==="application/xhtml+xml"?Xc:Pl,pe=Xr(te,"ALLOWED_TAGS")?Lt({},te.ALLOWED_TAGS,Ct):C,$=Xr(te,"ALLOWED_ATTR")?Lt({},te.ALLOWED_ATTR,Ct):V,jt=Xr(te,"ALLOWED_NAMESPACES")?Lt({},te.ALLOWED_NAMESPACES,Xc):st,We=Xr(te,"ADD_URI_SAFE_ATTR")?Lt(fi(rn),te.ADD_URI_SAFE_ATTR,Ct):rn,ze=Xr(te,"ADD_DATA_URI_TAGS")?Lt(fi(mt),te.ADD_DATA_URI_TAGS,Ct):mt,ut=Xr(te,"FORBID_CONTENTS")?Lt({},te.FORBID_CONTENTS,Ct):pt,Z=Xr(te,"FORBID_TAGS")?Lt({},te.FORBID_TAGS,Ct):fi({}),ie=Xr(te,"FORBID_ATTR")?Lt({},te.FORBID_ATTR,Ct):fi({}),at=Xr(te,"USE_PROFILES")?te.USE_PROFILES:!1,Y=te.ALLOW_ARIA_ATTR!==!1,se=te.ALLOW_DATA_ATTR!==!1,be=te.ALLOW_UNKNOWN_PROTOCOLS||!1,Ce=te.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Te=te.SAFE_FOR_TEMPLATES||!1,De=te.SAFE_FOR_XML!==!1,U=te.WHOLE_DOCUMENT||!1,He=te.RETURN_DOM||!1,Se=te.RETURN_DOM_FRAGMENT||!1,Ke=te.RETURN_TRUSTED_TYPE||!1,ht=te.FORCE_BODY||!1,Re=te.SANITIZE_DOM!==!1,Qe=te.SANITIZE_NAMED_PROPS||!1,it=te.KEEP_CONTENT!==!1,nt=te.IN_PLACE||!1,xe=te.ALLOWED_URI_REGEXP||bg,Dt=te.NAMESPACE||ct,dt=te.MATHML_TEXT_INTEGRATION_POINTS||dt,Ut=te.HTML_INTEGRATION_POINTS||Ut,J=te.CUSTOM_ELEMENT_HANDLING||{},te.CUSTOM_ELEMENT_HANDLING&&rt(te.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(J.tagNameCheck=te.CUSTOM_ELEMENT_HANDLING.tagNameCheck),te.CUSTOM_ELEMENT_HANDLING&&rt(te.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(J.attributeNameCheck=te.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),te.CUSTOM_ELEMENT_HANDLING&&typeof te.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(J.allowCustomizedBuiltInElements=te.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Te&&(se=!1),Se&&(He=!0),at&&(pe=Lt({},sf),$=[],at.html===!0&&(Lt(pe,af),Lt($,of)),at.svg===!0&&(Lt(pe,Qc),Lt($,nu),Lt($,yl)),at.svgFilters===!0&&(Lt(pe,eu),Lt($,nu),Lt($,yl)),at.mathMl===!0&&(Lt(pe,tu),Lt($,lf),Lt($,yl))),te.ADD_TAGS&&(typeof te.ADD_TAGS=="function"?fe.tagCheck=te.ADD_TAGS:(pe===C&&(pe=fi(pe)),Lt(pe,te.ADD_TAGS,Ct))),te.ADD_ATTR&&(typeof te.ADD_ATTR=="function"?fe.attributeCheck=te.ADD_ATTR:($===V&&($=fi($)),Lt($,te.ADD_ATTR,Ct))),te.ADD_URI_SAFE_ATTR&&Lt(We,te.ADD_URI_SAFE_ATTR,Ct),te.FORBID_CONTENTS&&(ut===pt&&(ut=fi(ut)),Lt(ut,te.FORBID_CONTENTS,Ct)),te.ADD_FORBID_CONTENTS&&(ut===pt&&(ut=fi(ut)),Lt(ut,te.ADD_FORBID_CONTENTS,Ct)),it&&(pe["#text"]=!0),U&&Lt(pe,["html","head","body"]),pe.table&&(Lt(pe,["tbody"]),delete Z.tbody),te.TRUSTED_TYPES_POLICY){if(typeof te.TRUSTED_TYPES_POLICY.createHTML!="function")throw ro('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof te.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ro('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');E=te.TRUSTED_TYPES_POLICY,M=E.createHTML("")}else E===void 0&&(E=nb(p,a)),E!==null&&typeof M=="string"&&(M=E.createHTML(""));or&&or(te),Vn=te}},Pr=Lt({},[...Qc,...eu,...W2]),er=Lt({},[...tu,...G2]),cr=function(te){let Ee=O(te);(!Ee||!Ee.tagName)&&(Ee={namespaceURI:Dt,tagName:"template"});const Fe=Pl(te.tagName),Wt=Pl(Ee.tagName);return jt[te.namespaceURI]?te.namespaceURI===bt?Ee.namespaceURI===ct?Fe==="svg":Ee.namespaceURI===Et?Fe==="svg"&&(Wt==="annotation-xml"||dt[Wt]):!!Pr[Fe]:te.namespaceURI===Et?Ee.namespaceURI===ct?Fe==="math":Ee.namespaceURI===bt?Fe==="math"&&Ut[Wt]:!!er[Fe]:te.namespaceURI===ct?Ee.namespaceURI===bt&&!Ut[Wt]||Ee.namespaceURI===Et&&!dt[Wt]?!1:!er[Fe]&&(kt[Fe]||!Pr[Fe]):!!(tt==="application/xhtml+xml"&&jt[te.namespaceURI]):!1},It=function(te){to(e.removed,{element:te});try{O(te).removeChild(te)}catch{S(te)}},Yt=function(te,Ee){try{to(e.removed,{attribute:Ee.getAttributeNode(te),from:Ee})}catch{to(e.removed,{attribute:null,from:Ee})}if(Ee.removeAttribute(te),te==="is")if(He||Se)try{It(Ee)}catch{}else try{Ee.setAttribute(te,"")}catch{}},xn=function(te){let Ee=null,Fe=null;if(ht)te="<remove></remove>"+te;else{const en=Zc(te,/^[\r\n\t ]+/);Fe=en&&en[0]}tt==="application/xhtml+xml"&&Dt===ct&&(te='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+te+"</body></html>");const Wt=E?E.createHTML(te):te;if(Dt===ct)try{Ee=new b().parseFromString(Wt,tt)}catch{}if(!Ee||!Ee.documentElement){Ee=ee.createDocument(Dt,"template",null);try{Ee.documentElement.innerHTML=et?M:Wt}catch{}}const cn=Ee.body||Ee.documentElement;return te&&Fe&&cn.insertBefore(n.createTextNode(Fe),cn.childNodes[0]||null),Dt===ct?F.call(Ee,U?"html":"body")[0]:U?Ee.documentElement:cn},ii=function(te){return G.call(te.ownerDocument||te,te,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Ir=function(te){return te instanceof g&&(typeof te.nodeName!="string"||typeof te.textContent!="string"||typeof te.removeChild!="function"||!(te.attributes instanceof h)||typeof te.removeAttribute!="function"||typeof te.setAttribute!="function"||typeof te.namespaceURI!="string"||typeof te.insertBefore!="function"||typeof te.hasChildNodes!="function")},ur=function(te){return typeof l=="function"&&te instanceof l};function Sn(Ue,te,Ee){bl(Ue,Fe=>{Fe.call(e,te,Ee,Vn)})}const dr=function(te){let Ee=null;if(Sn(k.beforeSanitizeElements,te,null),Ir(te))return It(te),!0;const Fe=Ct(te.nodeName);if(Sn(k.uponSanitizeElement,te,{tagName:Fe,allowedTags:pe}),De&&te.hasChildNodes()&&!ur(te.firstElementChild)&&sr(/<[/\w!]/g,te.innerHTML)&&sr(/<[/\w!]/g,te.textContent)||te.nodeType===ao.progressingInstruction||De&&te.nodeType===ao.comment&&sr(/<[/\w]/g,te.data))return It(te),!0;if(!(fe.tagCheck instanceof Function&&fe.tagCheck(Fe))&&(!pe[Fe]||Z[Fe])){if(!Z[Fe]&&tr(Fe)&&(J.tagNameCheck instanceof RegExp&&sr(J.tagNameCheck,Fe)||J.tagNameCheck instanceof Function&&J.tagNameCheck(Fe)))return!1;if(it&&!ut[Fe]){const Wt=O(te)||te.parentNode,cn=T(te)||te.childNodes;if(cn&&Wt){const en=cn.length;for(let Cn=en-1;Cn>=0;--Cn){const un=_(cn[Cn],!0);un.__removalCount=(te.__removalCount||0)+1,Wt.insertBefore(un,x(te))}}}return It(te),!0}return te instanceof c&&!cr(te)||(Fe==="noscript"||Fe==="noembed"||Fe==="noframes")&&sr(/<\/no(script|embed|frames)/i,te.innerHTML)?(It(te),!0):(Te&&te.nodeType===ao.text&&(Ee=te.textContent,bl([A,j,q],Wt=>{Ee=no(Ee,Wt," ")}),te.textContent!==Ee&&(to(e.removed,{element:te.cloneNode()}),te.textContent=Ee)),Sn(k.afterSanitizeElements,te,null),!1)},hr=function(te,Ee,Fe){if(Re&&(Ee==="id"||Ee==="name")&&(Fe in n||Fe in Tr))return!1;if(!(se&&!ie[Ee]&&sr(K,Ee))){if(!(Y&&sr(le,Ee))){if(!(fe.attributeCheck instanceof Function&&fe.attributeCheck(Ee,te))){if(!$[Ee]||ie[Ee]){if(!(tr(te)&&(J.tagNameCheck instanceof RegExp&&sr(J.tagNameCheck,te)||J.tagNameCheck instanceof Function&&J.tagNameCheck(te))&&(J.attributeNameCheck instanceof RegExp&&sr(J.attributeNameCheck,Ee)||J.attributeNameCheck instanceof Function&&J.attributeNameCheck(Ee,te))||Ee==="is"&&J.allowCustomizedBuiltInElements&&(J.tagNameCheck instanceof RegExp&&sr(J.tagNameCheck,Fe)||J.tagNameCheck instanceof Function&&J.tagNameCheck(Fe))))return!1}else if(!We[Ee]){if(!sr(xe,no(Fe,ae,""))){if(!((Ee==="src"||Ee==="xlink:href"||Ee==="href")&&te!=="script"&&$2(Fe,"data:")===0&&ze[te])){if(!(be&&!sr(ue,no(Fe,ae,"")))){if(Fe)return!1}}}}}}}return!0},tr=function(te){return te!=="annotation-xml"&&Zc(te,ge)},ai=function(te){Sn(k.beforeSanitizeAttributes,te,null);const{attributes:Ee}=te;if(!Ee||Ir(te))return;const Fe={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:$,forceKeepAttr:void 0};let Wt=Ee.length;for(;Wt--;){const cn=Ee[Wt],{name:en,namespaceURI:Cn,value:un}=cn,Rr=Ct(en),$i=un;let sn=en==="value"?$i:q2($i);if(Fe.attrName=Rr,Fe.attrValue=sn,Fe.keepAttr=!0,Fe.forceKeepAttr=void 0,Sn(k.uponSanitizeAttribute,te,Fe),sn=Fe.attrValue,Qe&&(Rr==="id"||Rr==="name")&&(Yt(en,te),sn=Ie+sn),De&&sr(/((--!?|])>)|<\/(style|title|textarea)/i,sn)){Yt(en,te);continue}if(Rr==="attributename"&&Zc(sn,"href")){Yt(en,te);continue}if(Fe.forceKeepAttr)continue;if(!Fe.keepAttr){Yt(en,te);continue}if(!Ce&&sr(/\/>/i,sn)){Yt(en,te);continue}Te&&bl([A,j,q],fa=>{sn=no(sn,fa," ")});const ha=Ct(te.nodeName);if(!hr(ha,Rr,sn)){Yt(en,te);continue}if(E&&typeof p=="object"&&typeof p.getAttributeType=="function"&&!Cn)switch(p.getAttributeType(ha,Rr)){case"TrustedHTML":{sn=E.createHTML(sn);break}case"TrustedScriptURL":{sn=E.createScriptURL(sn);break}}if(sn!==$i)try{Cn?te.setAttributeNS(Cn,en,sn):te.setAttribute(en,sn),Ir(te)?It(te):rf(e.removed)}catch{Yt(en,te)}}Sn(k.afterSanitizeAttributes,te,null)},Or=function Ue(te){let Ee=null;const Fe=ii(te);for(Sn(k.beforeSanitizeShadowDOM,te,null);Ee=Fe.nextNode();)Sn(k.uponSanitizeShadowNode,Ee,null),dr(Ee),ai(Ee),Ee.content instanceof i&&Ue(Ee.content);Sn(k.afterSanitizeShadowDOM,te,null)};return e.sanitize=function(Ue){let te=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ee=null,Fe=null,Wt=null,cn=null;if(et=!Ue,et&&(Ue="<!-->"),typeof Ue!="string"&&!ur(Ue))if(typeof Ue.toString=="function"){if(Ue=Ue.toString(),typeof Ue!="string")throw ro("dirty is not a string, aborting")}else throw ro("toString is not a function");if(!e.isSupported)return Ue;if(Pe||mr(te),e.removed=[],typeof Ue=="string"&&(nt=!1),nt){if(Ue.nodeName){const un=Ct(Ue.nodeName);if(!pe[un]||Z[un])throw ro("root node is forbidden and cannot be sanitized in-place")}}else if(Ue instanceof l)Ee=xn("<!---->"),Fe=Ee.ownerDocument.importNode(Ue,!0),Fe.nodeType===ao.element&&Fe.nodeName==="BODY"||Fe.nodeName==="HTML"?Ee=Fe:Ee.appendChild(Fe);else{if(!He&&!Te&&!U&&Ue.indexOf("<")===-1)return E&&Ke?E.createHTML(Ue):Ue;if(Ee=xn(Ue),!Ee)return He?null:Ke?M:""}Ee&&ht&&It(Ee.firstChild);const en=ii(nt?Ue:Ee);for(;Wt=en.nextNode();)dr(Wt),ai(Wt),Wt.content instanceof i&&Or(Wt.content);if(nt)return Ue;if(He){if(Se)for(cn=X.call(Ee.ownerDocument);Ee.firstChild;)cn.appendChild(Ee.firstChild);else cn=Ee;return($.shadowroot||$.shadowrootmode)&&(cn=I.call(r,cn,!0)),cn}let Cn=U?Ee.outerHTML:Ee.innerHTML;return U&&pe["!doctype"]&&Ee.ownerDocument&&Ee.ownerDocument.doctype&&Ee.ownerDocument.doctype.name&&sr(yg,Ee.ownerDocument.doctype.name)&&(Cn="<!DOCTYPE "+Ee.ownerDocument.doctype.name+`>
`+Cn),Te&&bl([A,j,q],un=>{Cn=no(Cn,un," ")}),E&&Ke?E.createHTML(Cn):Cn},e.setConfig=function(){let Ue=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};mr(Ue),Pe=!0},e.clearConfig=function(){Vn=null,Pe=!1},e.isValidAttribute=function(Ue,te,Ee){Vn||mr({});const Fe=Ct(Ue),Wt=Ct(te);return hr(Fe,Wt,Ee)},e.addHook=function(Ue,te){typeof te=="function"&&to(k[Ue],te)},e.removeHook=function(Ue,te){if(te!==void 0){const Ee=M2(k[Ue],te);return Ee===-1?void 0:U2(k[Ue],Ee,1)[0]}return rf(k[Ue])},e.removeHooks=function(Ue){k[Ue]=[]},e.removeAllHooks=function(){k=uf()},e}var Vl=_g();const rb=Object.freeze(Object.defineProperty({__proto__:null,default:Vl},Symbol.toStringTag,{value:"Module"})),df=[{num:1,label:"Empfaenger"},{num:2,label:"Inhalt"},{num:3,label:"Vorschau & Senden"}],ib=[{tag:"{{vorname}}",label:"Vorname"},{tag:"{{nachname}}",label:"Nachname"},{tag:"{{firma}}",label:"Firma"},{tag:"{{email}}",label:"E-Mail"}];function ab(){var fe;const t=Gn(),{contacts:e,loading:n}=sc(),{companies:r}=oc(),a=qp(null),[i,o]=me(1),[l,c]=me({name:"",subject:"",body_html:""}),[u,h]=me({}),[g,b]=me(""),[p,y]=me(""),[_,S]=me(!1),[x,T]=me(!1),[O,E]=me(!1),[M,ee]=me(""),[G,X]=me(!1);function F(Y,se){c(be=>({...be,[Y]:se}))}function I(Y){const se=Yh.find(be=>be.id===Y);se&&c(be=>({...be,subject:se.subject||be.subject,body_html:se.body}))}function k(Y){const se=a.current;if(!se){F("body_html",l.body_html+Y);return}const be=se.selectionStart,Ce=se.selectionEnd,Te=l.body_html,De=Te.substring(0,be)+Y+Te.substring(Ce);F("body_html",De),requestAnimationFrame(()=>{se.focus(),se.selectionStart=se.selectionEnd=be+Y.length})}const A=fo(()=>e.filter(Y=>Y.email),[e]),j=fo(()=>{let Y=A;if(p&&(Y=Y.filter(se=>se.company_id===p)),g){const se=g.toLowerCase();Y=Y.filter(be=>{var Ce;return(be.first_name||"").toLowerCase().includes(se)||(be.last_name||"").toLowerCase().includes(se)||(be.email||"").toLowerCase().includes(se)||(((Ce=be.company)==null?void 0:Ce.name)||"").toLowerCase().includes(se)})}return Y},[A,g,p]),q=Object.keys(u).length;function K(Y){h(se=>{const be={...se};return be[Y]?delete be[Y]:be[Y]=!0,be})}function le(){const Y={};A.forEach(se=>{Y[se.id]=!0}),h(Y)}function ue(){h({})}const ae=j.length>0&&j.every(Y=>u[Y.id]);function ge(){h(Y=>{const se={...Y};return ae?j.forEach(be=>{delete se[be.id]}):j.forEach(be=>{se[be.id]=!0}),se})}const xe=fo(()=>A.filter(Y=>u[Y.id]),[A,u]),pe=xe.length>0?{vorname:xe[0].first_name||"Max",nachname:xe[0].last_name||"Mustermann",firma:((fe=xe[0].company)==null?void 0:fe.name)||"Musterfirma GmbH",email:xe[0].email}:{vorname:"Max",nachname:"Mustermann",firma:"Musterfirma GmbH",email:"max@example.de"},C=l.body_html.replace(/\{\{vorname\}\}/gi,pe.vorname).replace(/\{\{nachname\}\}/gi,pe.nachname).replace(/\{\{firma\}\}/gi,pe.firma).replace(/\{\{email\}\}/gi,pe.email);async function $(){if(!l.name||!l.subject||!l.body_html){t.error("Name, Betreff und Inhalt sind Pflichtfelder");return}S(!0);try{const{data:Y,error:se}=await Yc({name:l.name,subject:l.subject,body_html:l.body_html,filters:{}});if(se)throw se;await tf(Y.id,xe),t.success("Kampagne gespeichert"),qe(`/crm/campaigns/${Y.id}`)}catch(Y){t.error(Y.message||"Fehler beim Speichern")}S(!1)}async function V(){if(!l.name||!l.subject||!l.body_html){t.error("Name, Betreff und Inhalt sind Pflichtfelder");return}if(xe.length===0){t.error("Keine Empfaenger ausgewaehlt");return}S(!0);try{const{data:Y,error:se}=await Yc({name:l.name,subject:l.subject,body_html:l.body_html,filters:{}});if(se)throw se;await tf(Y.id,xe);const be=await Gl(Y.id);t.success(`Kampagne gesendet an ${be.total_sent} Empfaenger`),qe(`/crm/campaigns/${Y.id}`)}catch(Y){t.error(Y.message||"Fehler beim Senden")}S(!1),E(!1)}async function J(){if(!M){t.error("Bitte Test-E-Mail-Adresse eingeben");return}if(!l.subject||!l.body_html){t.error("Betreff und Inhalt muessen ausgefuellt sein");return}X(!0);try{const{data:Y,error:se}=await Yc({name:l.name||"Test-Kampagne",subject:l.subject,body_html:l.body_html,filters:{}});if(se)throw se;await Gl(Y.id,{testEmail:M}),t.success(`Test-Mail an ${M} gesendet`)}catch(Y){t.error(Y.message||"Test-Mail fehlgeschlagen")}X(!1)}function Z(){return q>0}function ie(){return l.name&&l.subject&&l.body_html}return s(xt,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/campaigns"),children:""}),s("h1",{class:"page-title",children:"Neue Kampagne"})]})}),s("div",{class:"page-body",children:[s("div",{style:"display:flex;align-items:center;gap:0;margin-bottom:1.5rem;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;",children:df.map((Y,se)=>s("button",{onClick:()=>{Y.num===2&&!Z()||Y.num===3&&(!Z()||!ie())||o(Y.num)},style:`
                flex:1;padding:0.875rem 1rem;border:none;cursor:pointer;
                font-size:0.875rem;font-weight:${i===Y.num?"600":"500"};
                background:${i===Y.num?"#6358DE":i>Y.num?"rgba(99,88,222,0.08)":"transparent"};
                color:${i===Y.num?"#fff":i>Y.num?"#6358DE":"var(--text-muted)"};
                border-right:${se<df.length-1?"1px solid var(--border)":"none"};
                transition:all 0.15s;
                display:flex;align-items:center;justify-content:center;gap:0.5rem;
              `,children:[s("span",{style:`
                width:28px;height:28px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;
                font-size:0.75rem;font-weight:700;
                background:${i===Y.num?"rgba(255,255,255,0.25)":i>Y.num?"#6358DE":"var(--border)"};
                color:${i===Y.num||i>Y.num?"#fff":"var(--text-muted)"};
              `,children:i>Y.num?"":Y.num}),s("span",{class:"hide-mobile-sm",children:Y.label})]},Y.num))}),i===1&&s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Empfaenger waehlen"}),s("span",{style:"font-size:0.85rem;color:var(--text-muted)",children:[A.length," Kontakte verfuegbar"]})]}),s("div",{style:"display:flex;gap:0.75rem;margin-bottom:1rem;flex-wrap:wrap;align-items:end;",children:[s("div",{style:"flex:1;min-width:200px;",children:[s("label",{children:"Suche"}),s("input",{value:g,onInput:Y=>b(Y.target.value),placeholder:"Name, E-Mail oder Firma..."})]}),s("div",{style:"min-width:180px;",children:[s("label",{children:"Firma"}),s("select",{value:p,onChange:Y=>y(Y.target.value),children:[s("option",{value:"",children:"Alle Firmen"}),r.map(Y=>s("option",{value:Y.id,children:Y.name},Y.id))]})]}),s("div",{style:"display:flex;gap:0.5rem;",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:le,children:"Alle waehlen"}),s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:ue,children:"Keine"})]})]}),n?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):j.length===0?s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:A.length===0?"Keine Kontakte mit E-Mail-Adresse vorhanden":"Keine Treffer fuer diese Suche"})}):s("div",{style:"border:1px solid var(--border);border-radius:var(--radius);max-height:500px;overflow-y:auto;",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem;padding:0.6rem 0.75rem;border-bottom:1px solid var(--border);background:var(--bg-hover);font-size:0.75rem;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.05em;position:sticky;top:0;z-index:1;",children:[s("input",{type:"checkbox",checked:ae,onChange:ge,style:"width:16px;height:16px;flex-shrink:0;cursor:pointer;"}),s("span",{style:"flex:1;",children:"Name"}),s("span",{style:"flex:1;",class:"hide-mobile-sm",children:"E-Mail"}),s("span",{style:"width:140px;",class:"hide-mobile-sm",children:"Firma"})]}),j.map(Y=>{var Ce;const se=!!u[Y.id],be=`${Y.first_name||""} ${Y.last_name||""}`.trim()||Y.email;return s("label",{style:`display:flex;align-items:center;gap:0.75rem;padding:0.6rem 0.75rem;border-bottom:1px solid var(--border);cursor:pointer;font-size:0.875rem;transition:background 0.1s;${se?"background:rgba(26,92,107,0.06);":""}`,children:[s("input",{type:"checkbox",checked:se,onChange:()=>K(Y.id),style:"width:16px;height:16px;flex-shrink:0;cursor:pointer;"}),s("span",{style:"flex:1;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;",children:be}),s("span",{style:"flex:1;color:var(--text-muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;",class:"hide-mobile-sm",children:Y.email}),s("span",{style:"width:140px;color:var(--text-muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;",class:"hide-mobile-sm",children:((Ce=Y.company)==null?void 0:Ce.name)||""})]},Y.id)})]}),s("div",{style:"display:flex;align-items:center;justify-content:space-between;margin-top:1rem;flex-wrap:wrap;gap:0.75rem;",children:[s("div",{style:"padding:0.5rem 1rem;background:var(--bg-hover);border-radius:var(--radius);font-size:0.875rem;",children:[s("strong",{children:q})," von ",A.length," Empfaenger ausgewaehlt"]}),s("button",{class:"btn btn-primary",onClick:()=>o(2),disabled:!Z(),children:"Weiter "})]})]}),i===2&&s("div",{style:"display:flex;flex-direction:column;gap:1.5rem;",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Kampagne"})}),s("div",{class:"form-group",style:"margin:0;",children:[s("label",{children:"Name (intern)"}),s("input",{value:l.name,onInput:Y=>F("name",Y.target.value),placeholder:"z.B. Follow-up Februar 2026"})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Vorlage waehlen"})}),s("div",{style:"display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:0.75rem;",children:Yh.map(Y=>s("button",{onClick:()=>I(Y.id),style:`
                      display:flex;flex-direction:column;align-items:center;gap:0.5rem;
                      padding:1rem;border-radius:var(--radius);border:1px solid var(--border);
                      background:var(--bg-card);cursor:pointer;transition:all 0.15s;text-align:center;
                    `,onMouseEnter:se=>{se.currentTarget.style.borderColor="var(--primary)",se.currentTarget.style.background="rgba(26,92,107,0.04)"},onMouseLeave:se=>{se.currentTarget.style.borderColor="var(--border)",se.currentTarget.style.background="var(--bg-card)"},children:[s("span",{style:"font-size:1.5rem;",children:Y.icon||""}),s("span",{style:"font-weight:600;font-size:0.85rem;color:var(--text);",children:Y.name}),Y.preview&&s("span",{style:"font-size:0.75rem;color:var(--text-muted);line-height:1.3;",children:Y.preview})]},Y.id))})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Betreff"})}),s("input",{value:l.subject,onInput:Y=>F("subject",Y.target.value),placeholder:"Betreff der E-Mail"})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Inhalt (HTML)"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>T(!x),children:x?"Editor":"Vorschau"})]}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.75rem;",children:[s("span",{style:"font-size:0.75rem;color:var(--text-dim);display:flex;align-items:center;",children:"Platzhalter:"}),ib.map(Y=>s("button",{type:"button",onClick:()=>k(Y.tag),style:"padding:0.2rem 0.6rem;border-radius:999px;font-size:0.75rem;font-weight:500;background:rgba(26,92,107,0.08);color:var(--primary);border:1px solid rgba(26,92,107,0.2);cursor:pointer;transition:all 0.15s;",onMouseEnter:se=>{se.currentTarget.style.background="rgba(26,92,107,0.15)"},onMouseLeave:se=>{se.currentTarget.style.background="rgba(26,92,107,0.08)"},children:Y.label},Y.tag))]}),x?s("div",{style:"border:1px solid var(--border);border-radius:8px;padding:1rem;background:#fff;min-height:300px;",dangerouslySetInnerHTML:{__html:Vl.sanitize(C)}}):s("textarea",{ref:a,value:l.body_html,onInput:Y=>F("body_html",Y.target.value),style:"width:100%;min-height:350px;font-family:monospace;font-size:0.8rem;border:1px solid var(--border);border-radius:8px;padding:0.75rem;",placeholder:"HTML-Inhalt der E-Mail..."})]}),s("div",{style:"display:flex;justify-content:space-between;",children:[s("button",{class:"btn btn-secondary",onClick:()=>o(1),children:" Zurueck"}),s("button",{class:"btn btn-primary",onClick:()=>o(3),disabled:!ie(),children:"Weiter "})]})]}),i===3&&s("div",{style:"display:flex;flex-direction:column;gap:1.5rem;",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Zusammenfassung"})}),s("div",{style:"display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;",children:[s("div",{style:"padding:1rem;background:var(--bg-hover);border-radius:var(--radius);text-align:center;",children:[s("div",{style:"font-size:1.75rem;font-weight:700;",children:q}),s("div",{style:"font-size:0.8rem;color:var(--text-muted);",children:"Empfaenger"})]}),s("div",{style:"padding:1rem;background:var(--bg-hover);border-radius:var(--radius);",children:[s("div",{style:"font-size:0.7rem;font-weight:600;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.25rem;",children:"Kampagne"}),s("div",{style:"font-weight:500;",children:l.name})]}),s("div",{style:"padding:1rem;background:var(--bg-hover);border-radius:var(--radius);",children:[s("div",{style:"font-size:0.7rem;font-weight:600;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.25rem;",children:"Betreff"}),s("div",{style:"font-weight:500;",children:l.subject})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"E-Mail-Vorschau"}),xe.length>0&&s("span",{style:"font-size:0.75rem;color:var(--text-dim);",children:["Personalisiert fuer: ",pe.vorname," ",pe.nachname]})]}),s("div",{style:"border:1px solid var(--border);border-radius:8px;padding:1rem;background:#fff;max-height:500px;overflow:auto;",dangerouslySetInnerHTML:{__html:Vl.sanitize(C)}})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Test-Mail senden"})}),s("div",{style:"display:flex;gap:0.75rem;align-items:end;flex-wrap:wrap;",children:[s("div",{style:"flex:1;min-width:200px;",children:[s("label",{children:"E-Mail-Adresse"}),s("input",{type:"email",value:M,onInput:Y=>ee(Y.target.value),placeholder:"rundgang@beck360.de"})]}),s("button",{class:"btn btn-secondary",onClick:J,disabled:G,style:"white-space:nowrap;",children:G?"Sende...":"Test senden"})]})]}),s("div",{style:"display:flex;justify-content:space-between;flex-wrap:wrap;gap:0.75rem;",children:[s("button",{class:"btn btn-secondary",onClick:()=>o(2),children:" Zurueck"}),s("div",{style:"display:flex;gap:0.75rem;",children:[s("button",{class:"btn btn-secondary",onClick:$,disabled:_,children:_?"Speichere...":"Als Entwurf speichern"}),s("button",{class:"btn btn-primary",onClick:()=>E(!0),disabled:_||q===0,children:"Jetzt senden"})]})]})]})]}),O&&s(ua,{title:"Kampagne senden?",onClose:()=>E(!1),children:[s("p",{style:"margin-bottom:1rem;",children:['Die Kampagne "',s("strong",{children:l.name}),'" wird an ',s("strong",{children:[q," Empfaenger"]})," gesendet. Dieser Vorgang kann nicht rueckgaengig gemacht werden."]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary",onClick:()=>E(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary",onClick:V,disabled:_,children:_?"Sende...":"Jetzt senden"})]})]})]})}const sb={pending:{label:"Ausstehend",color:"#6358DE"},sent:{label:"Gesendet",color:"#3b82f6"},opened:{label:"Geoeffnet",color:"#0B996F"},clicked:{label:"Geklickt",color:"#059669"},bounced:{label:"Bounce",color:"#ef4444"},unsubscribed:{label:"Abgemeldet",color:"#94a3b8"}};function ob({id:t}){var le,ue,ae,ge,xe,pe;const{campaign:e,loading:n,update:r,refetch:a,remove:i}=P2(t),{recipients:o,loading:l,refetch:c}=I2(t),u=Gn(),[h,g]=me(!1),[b,p]=me({}),[y,_]=me(!1),[S,x]=me(!1),[T,O]=me(!1),[E,M]=me(""),[ee,G]=me(!1);if(n)return s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Kampagne"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Nicht gefunden"})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Kampagne nicht gefunden"})})})]});function X(){p({name:e.name||"",subject:e.subject||"",body_html:e.body_html||""}),g(!0)}async function F(){const{error:C}=await r(b);C?u.error("Fehler beim Speichern"):(u.success("Kampagne aktualisiert"),g(!1))}async function I(){x(!0);try{const C=await Gl(e.id);u.success(`Kampagne gesendet an ${C.total_sent} Empfaenger`),a(),c()}catch(C){u.error(C.message||"Senden fehlgeschlagen")}x(!1),_(!1)}async function k(){if(!E){u.error("Bitte E-Mail-Adresse eingeben");return}G(!0);try{await Gl(e.id,{testEmail:E}),u.success(`Test-Mail an ${E} gesendet`)}catch(C){u.error(C.message||"Test-Mail fehlgeschlagen")}G(!1)}async function A(){const{error:C}=await i();C?u.error("Fehler beim Loeschen"):(u.success("Kampagne geloescht"),qe("/crm/campaigns"))}const j=e.total_sent>0?Math.round(e.total_opened/e.total_sent*100):0,q=e.total_sent>0?Math.round(e.total_clicked/e.total_sent*100):0;o.filter(C=>C.status==="sent"||C.status==="opened"||C.status==="clicked").length;const K=o.filter(C=>C.status==="bounced").length;return s(xt,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/campaigns"),children:""}),s("h1",{class:"page-title",children:e.name}),s("span",{class:"stage-badge",style:`background:${((le=oa[e.status])==null?void 0:le.color)||"#6366f1"}15;color:${((ue=oa[e.status])==null?void 0:ue.color)||"#6366f1"};`,children:((ae=oa[e.status])==null?void 0:ae.label)||e.status})]}),s("div",{style:"display:flex;gap:0.5rem",children:e.status==="draft"&&s(xt,{children:[!h&&s("button",{class:"btn btn-secondary btn-sm",onClick:X,children:"Bearbeiten"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>_(!0),children:"Senden"}),s("button",{class:"btn btn-danger btn-sm",onClick:()=>O(!0),children:"Loeschen"})]})})]}),s("div",{class:"page-body",children:[e.status==="sent"&&s("div",{style:"display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:1rem;margin-bottom:1.5rem;",children:[s("div",{style:"background:linear-gradient(135deg,#6358DE 0%,#7c6ff7 100%);border-radius:var(--radius-lg);padding:1.25rem;color:#fff;text-align:center;",children:[s("div",{style:"font-size:2rem;font-weight:700;line-height:1",children:e.total_sent}),s("div",{style:"font-size:0.8rem;opacity:0.85;margin-top:0.35rem",children:"Gesendet"})]}),s("div",{style:"background:linear-gradient(135deg,#0B996F 0%,#10b981 100%);border-radius:var(--radius-lg);padding:1.25rem;color:#fff;text-align:center;",children:[s("div",{style:"font-size:2rem;font-weight:700;line-height:1",children:e.total_opened}),s("div",{style:"font-size:0.8rem;opacity:0.85;margin-top:0.35rem",children:["Geoeffnet (",j,"%)"]})]}),s("div",{style:"background:linear-gradient(135deg,#3b82f6 0%,#60a5fa 100%);border-radius:var(--radius-lg);padding:1.25rem;color:#fff;text-align:center;",children:[s("div",{style:"font-size:2rem;font-weight:700;line-height:1",children:e.total_clicked}),s("div",{style:"font-size:0.8rem;opacity:0.85;margin-top:0.35rem",children:["Geklickt (",q,"%)"]})]}),K>0&&s("div",{style:"background:linear-gradient(135deg,#ef4444 0%,#f87171 100%);border-radius:var(--radius-lg);padding:1.25rem;color:#fff;text-align:center;",children:[s("div",{style:"font-size:2rem;font-weight:700;line-height:1",children:K}),s("div",{style:"font-size:0.8rem;opacity:0.85;margin-top:0.35rem",children:"Bounce"})]})]}),s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Kampagnen-Details"})}),h?s("div",{children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group form-group-full",children:[s("label",{children:"Name"}),s("input",{value:b.name,onInput:C=>p({...b,name:C.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Betreff"}),s("input",{value:b.subject,onInput:C=>p({...b,subject:C.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Inhalt (HTML)"}),s("textarea",{value:b.body_html,onInput:C=>p({...b,body_html:C.target.value}),style:"width:100%;min-height:200px;font-family:monospace;font-size:0.8rem;"})]})]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>g(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary btn-sm",onClick:F,children:"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Betreff"}),s("span",{class:"detail-value",children:e.subject})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:Jh(e.created_at)})]}),e.sent_at&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Gesendet am"}),s("span",{class:"detail-value",children:Jh(e.sent_at)})]})]})]}),e.status==="draft"&&s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Test-Mail senden"})}),s("div",{style:"display:flex;gap:0.75rem;align-items:end;flex-wrap:wrap;",children:[s("div",{style:"flex:1;min-width:200px;",children:[s("label",{children:"E-Mail-Adresse"}),s("input",{type:"email",value:E,onInput:C=>M(C.target.value),placeholder:"rundgang@beck360.de"})]}),s("button",{class:"btn btn-secondary",onClick:k,disabled:ee,style:"white-space:nowrap;",children:ee?"Sende...":"Test senden"})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"E-Mail-Vorschau"})}),s("div",{style:"border:1px solid var(--border);border-radius:var(--radius);padding:1rem;background:#fff;max-height:400px;overflow:auto;",dangerouslySetInnerHTML:{__html:Vl.sanitize(e.body_html)}})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Empfaenger (",o.length,")"]})}),l?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):o.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Empfaenger"}):s("div",{style:"display:flex;flex-direction:column;gap:0.5rem;",children:o.map(C=>{const $=sb[C.status]||{},V=C.contact&&`${C.contact.first_name||""} ${C.contact.last_name||""}`.trim()||C.email;return s("div",{style:"display:flex;align-items:center;gap:0.75rem;padding:0.6rem 0.75rem;border:1px solid var(--border);border-radius:var(--radius);font-size:0.85rem;",children:[s("div",{style:`width:8px;height:8px;border-radius:50%;background:${$.color||"#6366f1"};flex-shrink:0;`}),s("div",{style:"flex:1;min-width:0;",children:[C.contact?s("a",{href:"#",onClick:J=>{J.preventDefault(),J.stopPropagation(),qe(`/crm/contacts/${C.contact_id}`)},style:"font-weight:500;",children:V}):s("span",{style:"font-weight:500;",children:V}),s("div",{style:"font-size:0.75rem;color:var(--text-dim);",children:C.email})]}),s("span",{class:"stage-badge",style:`background:${$.color||"#6366f1"}15;color:${$.color||"#6366f1"};`,children:$.label||C.status})]},C.id)})})]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Status"}),s("span",{class:"detail-value",children:s("span",{class:"stage-badge",style:`background:${((ge=oa[e.status])==null?void 0:ge.color)||"#6366f1"}15;color:${((xe=oa[e.status])==null?void 0:xe.color)||"#6366f1"};`,children:(pe=oa[e.status])==null?void 0:pe.label})})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt"}),s("span",{class:"detail-value",children:jn(e.created_at)})]}),e.sent_at&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Gesendet"}),s("span",{class:"detail-value",children:jn(e.sent_at)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Empfaenger"}),s("span",{class:"detail-value",style:"font-weight:600;font-size:1.1rem;",children:o.length})]})]})})]})]}),y&&s(ua,{title:"Kampagne senden?",onClose:()=>_(!1),children:[s("p",{style:"margin-bottom:1rem;",children:['Die Kampagne "',s("strong",{children:e.name}),'" wird an ',s("strong",{children:[o.length," Empfaenger"]})," gesendet. Nur Kontakte mit DSGVO-Einwilligung erhalten die E-Mail."]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary",onClick:()=>_(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary",onClick:I,disabled:S,children:S?"Sende...":"Jetzt senden"})]})]}),T&&s(ua,{title:"Kampagne loeschen?",onClose:()=>O(!1),children:[s("p",{style:"margin-bottom:1rem;",children:['Die Kampagne "',s("strong",{children:e.name}),'" wird unwiderruflich geloescht.']}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary",onClick:()=>O(!1),children:"Abbrechen"}),s("button",{class:"btn btn-danger",onClick:A,children:"Loeschen"})]})]})]})}function lb(){const[t,e]=me(null),[n,r]=me(null),{invoices:a,loading:i,refetch:o}=pd({type:t,status:n}),[l,c]=me(new Set),[u,h]=me(!1),g=Gn();function b(_,S){S.stopPropagation(),c(x=>{const T=new Set(x);return T.has(_)?T.delete(_):T.add(_),T})}function p(){l.size===a.length?c(new Set):c(new Set(a.map(_=>_.id)))}async function y(){if(l.size===0||!confirm(`${l.size} Dokument${l.size>1?"e":""} wirklich loeschen?`))return;h(!0);let _=0;for(const S of l){const{error:x}=await pg(S);x&&_++}h(!1),c(new Set),await o(),_?g.error(`${_} Fehler beim Loeschen`):g.success(`${l.size===0?"":"Geloescht"}`)}return s(xt,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Rechnungen & Angebote"}),s("div",{style:"display:flex;gap:0.5rem;align-items:center",children:[l.size>0&&s("button",{class:"btn btn-danger btn-sm",onClick:y,disabled:u,children:u?"Loesche...":`${l.size} loeschen`}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>qe("/crm/invoices/new?type=invoice"),children:"+ Rechnung"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/invoices/new?type=quote"),children:"+ Angebot"})]})]}),s("div",{class:"page-body",children:[s("div",{class:"search-bar",children:[s("div",{class:"filter-pills",children:[s("button",{class:`filter-pill ${t?"":"active"}`,onClick:()=>e(null),children:"Alle"}),Object.entries(As).map(([_,S])=>s("button",{class:`filter-pill ${t===_?"active":""}`,onClick:()=>e(t===_?null:_),children:S.label},_))]}),s("div",{class:"filter-pills",children:Object.entries(Qn).map(([_,S])=>s("button",{class:`filter-pill ${n===_?"active":""}`,onClick:()=>r(n===_?null:_),children:S.label},_))})]}),i?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):a.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Rechnungen oder Angebote"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{style:"width:2.5rem;padding-right:0",children:s("input",{type:"checkbox",checked:l.size===a.length,onChange:p,style:"cursor:pointer"})}),s("th",{children:"Nummer"}),s("th",{children:"Typ"}),s("th",{children:"Kunde"}),s("th",{children:"Datum"}),s("th",{children:"Status"}),s("th",{style:"text-align:right",children:"Betrag"})]})}),s("tbody",{children:a.map(_=>{var S,x,T,O;return s("tr",{class:"clickable-row",onClick:()=>qe(`/crm/invoices/${_.id}`),style:l.has(_.id)?"background:var(--brand-light, rgba(26,92,107,0.08))":"",children:[s("td",{style:"padding-right:0",onClick:E=>E.stopPropagation(),children:s("input",{type:"checkbox",checked:l.has(_.id),onChange:E=>b(_.id,E),style:"cursor:pointer"})}),s("td",{"data-label":"Nummer",style:"font-weight:600",children:_.invoice_number}),s("td",{"data-label":"Typ",children:s("span",{style:`font-size:0.75rem;padding:0.15rem 0.5rem;border-radius:999px;background:${_.type==="quote"?"rgba(139,92,246,0.15);color:#a78bfa":"rgba(59,130,246,0.15);color:#60a5fa"}`,children:(S=As[_.type])==null?void 0:S.label})}),s("td",{"data-label":"Kunde",children:_.customer_company||_.customer_name||""}),s("td",{"data-label":"Datum",children:jn(_.invoice_date)}),s("td",{"data-label":"Status",children:s("span",{class:"stage-badge",style:`color:${(x=Qn[_.status])==null?void 0:x.color};background:${(T=Qn[_.status])==null?void 0:T.color}20`,children:(O=Qn[_.status])==null?void 0:O.label})}),s("td",{"data-label":"Betrag",style:"text-align:right;font-weight:600",children:Be(_.total_amount)})]},_.id)})})]})})})]})]})}function cb({items:t,onChange:e}){function n(o,l,c){const u=t.map((h,g)=>g===o?{...h,[l]:c}:h);e(u)}function r(){e([...t,{description:"",sub_description:"",quantity:1,unit_price:0}])}function a(o){e(t.filter((l,c)=>c!==o))}function i(o){return(parseFloat(o)||0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})+" "}return s("div",{children:[s("div",{class:"table-wrapper",children:s("table",{class:"line-items-table",children:[s("thead",{children:s("tr",{children:[s("th",{style:"width:40%",children:"Bezeichnung"}),s("th",{style:"width:15%",children:"Menge"}),s("th",{style:"width:20%",children:"Einzelpreis"}),s("th",{style:"width:15%;text-align:right",children:"Gesamt"}),s("th",{style:"width:10%"})]})}),s("tbody",{children:t.map((o,l)=>{const c=(parseFloat(o.quantity)||0)*(parseFloat(o.unit_price)||0);return s("tr",{children:[s("td",{children:[s("input",{value:o.description,onInput:u=>n(l,"description",u.target.value),placeholder:"Leistung / Produkt",required:!0}),s("input",{value:o.sub_description||"",onInput:u=>n(l,"sub_description",u.target.value),placeholder:"Zusatzinfo (optional)",style:"margin-top:0.25rem;font-size:0.8rem;color:var(--text-muted)"})]}),s("td",{children:s("input",{type:"number",step:"0.01",min:"0",value:o.quantity,onInput:u=>n(l,"quantity",u.target.value),style:"text-align:right"})}),s("td",{children:s("input",{type:"number",step:"0.01",min:"0",value:o.unit_price,onInput:u=>n(l,"unit_price",u.target.value),style:"text-align:right"})}),s("td",{style:"text-align:right;white-space:nowrap;font-weight:500",children:i(c)}),s("td",{style:"text-align:center",children:s("button",{type:"button",class:"btn btn-danger btn-sm",onClick:()=>a(l),title:"Entfernen",children:"x"})})]},l)})})]})}),s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:r,style:"margin-top:0.75rem",children:"+ Position"})]})}function ub(){const t=Gn(),{settings:e}=ic(),n=new URLSearchParams(window.location.search),r=n.get("type")||"invoice",a=n.get("deal_id"),i=n.get("quote_id"),o=n.get("edit"),{invoice:l,items:c,loading:u}=fg(o),[h,g]=me(!1),[b,p]=me([]),[y,_]=me([]),[S,x]=me({type:r,invoice_number:"",invoice_date:new Date().toISOString().slice(0,10),due_date:"",company_id:"",contact_id:"",deal_id:a||"",customer_company:"",customer_name:"",customer_street:"",customer_zip:"",customer_city:"",customer_number:"",discount_percent:0,vat_rate:19,payment_terms:"Diese Rechnung ist zahlbar innerhalb von 14 Tagen ohne Abzug auf das unten angegebene Bankkonto.",closing_message:"",intro_text:"",notes:""}),[T,O]=me([{description:"",sub_description:"",quantity:1,unit_price:0}]);Mt(()=>{Ne.from("companies").select("id, name, address, city").is("deleted_at",null).order("name").then(({data:I})=>p(I||[])),Ne.from("contacts").select("id, first_name, last_name, email, company_id").is("deleted_at",null).order("last_name").then(({data:I})=>_(I||[]))},[]),Mt(()=>{if(e&&!o&&!i){const I=new Date;I.setDate(I.getDate()+(e.default_payment_days||14)),x(k=>{const j=k.type==="quote"?e.default_quote_intro||"Vielen Dank fuer Ihr Interesse. Gerne unterbreite ich Ihnen folgendes Angebot:":e.default_invoice_intro||"Vielen Dank fuer Ihren Auftrag. Ich berechne Ihnen fuer folgende Leistungen:";return{...k,vat_rate:parseFloat(e.vat_rate)||19,due_date:k.due_date||I.toISOString().slice(0,10),closing_message:k.closing_message||e.default_closing_text||"",intro_text:k.intro_text||j}})}},[e,o,i]),Mt(()=>{!a||o||Ne.from("deals").select("*, contact:contacts(id, first_name, last_name), company:companies(id, name, address, city)").eq("id",a).single().then(({data:I})=>{if(!I)return;const k=I.contact?`${I.contact.first_name||""} ${I.contact.last_name||""}`.trim():"";x(A=>{var j,q,K,le,ue,ae;return{...A,deal_id:I.id,company_id:((j=I.company)==null?void 0:j.id)||"",contact_id:((q=I.contact)==null?void 0:q.id)||"",customer_company:((K=I.company)==null?void 0:K.name)||"",customer_name:k,customer_street:((le=I.company)==null?void 0:le.address)||"",customer_city:((ue=I.company)==null?void 0:ue.city)||"",invoice_number:Tl(r,(ae=I.company)==null?void 0:ae.name,k)}})})},[a,r,o]),Mt(()=>{i&&Promise.all([Ne.from("invoices").select("*").eq("id",i).single(),Ne.from("invoice_items").select("*").eq("invoice_id",i).order("position")]).then(([{data:I},{data:k}])=>{I&&(x(A=>({...A,type:"invoice",invoice_number:Tl("invoice",I.customer_company,I.customer_name),company_id:I.company_id||"",contact_id:I.contact_id||"",deal_id:I.deal_id||"",customer_company:I.customer_company||"",customer_name:I.customer_name||"",customer_street:I.customer_street||"",customer_zip:I.customer_zip||"",customer_city:I.customer_city||"",customer_number:I.customer_number||"",discount_percent:I.discount_percent||0,vat_rate:I.vat_rate||19,payment_terms:I.payment_terms||A.payment_terms,closing_message:I.closing_message||A.closing_message,intro_text:I.intro_text||"",notes:I.notes||""})),k&&k.length>0&&O(k.map(A=>({description:A.description,sub_description:A.sub_description||"",quantity:A.quantity,unit_price:A.unit_price}))))})},[i]),Mt(()=>{!o||u||!l||(x({type:l.type,invoice_number:l.invoice_number,invoice_date:l.invoice_date,due_date:l.due_date||"",company_id:l.company_id||"",contact_id:l.contact_id||"",deal_id:l.deal_id||"",customer_company:l.customer_company||"",customer_name:l.customer_name||"",customer_street:l.customer_street||"",customer_zip:l.customer_zip||"",customer_city:l.customer_city||"",customer_number:l.customer_number||"",discount_percent:l.discount_percent||0,vat_rate:l.vat_rate||19,payment_terms:l.payment_terms||"",closing_message:l.closing_message||"",intro_text:l.intro_text||"",notes:l.notes||""}),c.length>0&&O(c.map(I=>({description:I.description,sub_description:I.sub_description||"",quantity:I.quantity,unit_price:I.unit_price}))))},[o,u,l,c]),Mt(()=>{o||i||!S.customer_name&&!S.customer_company||x(I=>({...I,invoice_number:Tl(I.type,I.customer_company,I.customer_name)}))},[S.type,S.customer_name,S.customer_company,o,i]);function E(I){const k=b.find(A=>A.id===I);x(A=>({...A,company_id:I,customer_company:(k==null?void 0:k.name)||A.customer_company,customer_street:(k==null?void 0:k.address)||A.customer_street,customer_city:(k==null?void 0:k.city)||A.customer_city}))}function M(I){const k=y.find(j=>j.id===I);if(!k)return;const A=`${k.first_name||""} ${k.last_name||""}`.trim();x(j=>({...j,contact_id:I,customer_name:A,company_id:k.company_id||j.company_id})),k.company_id&&!S.company_id&&E(k.company_id)}const ee=t2(T,S.discount_percent,S.vat_rate),G=S.type==="quote",X=o?`${G?"Angebot":"Rechnung"} bearbeiten`:i?"Rechnung aus Angebot erstellen":`Neue${G?"s Angebot":" Rechnung"} erstellen`;async function F(I){var k;if(I.preventDefault(),T.length===0||!T.some(A=>A.description)){t.error("Mindestens eine Position erforderlich");return}g(!0);try{const A={...S,company_id:S.company_id||null,contact_id:S.contact_id||null,deal_id:S.deal_id||null,subtotal:ee.subtotal,net_amount:ee.net_amount,vat_amount:ee.vat_amount,total_amount:ee.total_amount,due_date:S.due_date||null};let j;o?(j=await r2(o,A,T),j.error||(t.success("Gespeichert"),qe(`/crm/invoices/${o}`))):(i&&(A.converted_from_quote_id=i),j=await n2(A,T),!j.error&&((k=j.data)!=null&&k.id)?(t.success(`${G?"Angebot":"Rechnung"} erstellt`),qe(`/crm/invoices/${j.data.id}`)):j.error||t.error("Rechnung konnte nicht erstellt werden")),j.error&&t.error("Fehler: "+(j.error.message||JSON.stringify(j.error)))}catch(A){console.error("Invoice submit error:",A),t.error("Unerwarteter Fehler: "+A.message)}g(!1)}return o&&u?s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Laden..."})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]}):s(xt,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/invoices"),children:""}),s("h1",{class:"page-title",children:X})]})}),s("div",{class:"page-body",children:s("form",{onSubmit:F,style:"max-width:900px",children:[s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Dokument"})}),s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Typ"}),s("select",{value:S.type,onChange:I=>x({...S,type:I.target.value}),disabled:!!o||!!i,children:[s("option",{value:"invoice",children:"Rechnung"}),s("option",{value:"quote",children:"Angebot"})]})]}),s("div",{class:"form-group",children:[s("label",{children:G?"Angebotsnr.":"Rechnungsnr."}),s("input",{value:S.invoice_number,onInput:I=>x({...S,invoice_number:I.target.value}),required:!0})]}),s("div",{class:"form-group",children:[s("label",{children:"Datum"}),s("input",{type:"date",value:S.invoice_date,onInput:I=>x({...S,invoice_date:I.target.value}),required:!0})]}),s("div",{class:"form-group",children:[s("label",{children:G?"Gueltig bis":"Faellig am"}),s("input",{type:"date",value:S.due_date,onInput:I=>x({...S,due_date:I.target.value})})]})]})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Kunde"})}),s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Firma (CRM)"}),s("select",{value:S.company_id,onChange:I=>E(I.target.value),children:[s("option",{value:"",children:" Firma waehlen "}),b.map(I=>s("option",{value:I.id,children:I.name},I.id))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Kontakt (CRM)"}),s("select",{value:S.contact_id,onChange:I=>M(I.target.value),children:[s("option",{value:"",children:" Kontakt waehlen "}),y.map(I=>s("option",{value:I.id,children:`${I.first_name||""} ${I.last_name||""}`.trim()||I.email},I.id))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Firmenname (Rechnung)"}),s("input",{value:S.customer_company,onInput:I=>x({...S,customer_company:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Ansprechpartner"}),s("input",{value:S.customer_name,onInput:I=>x({...S,customer_name:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Strasse"}),s("input",{value:S.customer_street,onInput:I=>x({...S,customer_street:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"PLZ"}),s("input",{value:S.customer_zip,onInput:I=>x({...S,customer_zip:I.target.value}),style:"max-width:120px"})]}),s("div",{class:"form-group",children:[s("label",{children:"Stadt"}),s("input",{value:S.customer_city,onInput:I=>x({...S,customer_city:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Kundennummer"}),s("input",{value:S.customer_number,onInput:I=>x({...S,customer_number:I.target.value}),placeholder:"Optional"})]})]})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Positionen"})}),s(cb,{items:T,onChange:O})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Betraege"})}),s("div",{style:"display:flex;gap:1.5rem;align-items:flex-start",children:[s("div",{style:"flex:1",children:[s("div",{class:"form-group",style:"max-width:200px",children:[s("label",{children:"Rabatt (%)"}),s("input",{type:"number",step:"0.01",min:"0",max:"100",value:S.discount_percent,onInput:I=>x({...S,discount_percent:I.target.value}),style:"text-align:right"})]}),s("div",{class:"form-group",style:"max-width:200px",children:[s("label",{children:"MwSt. (%)"}),s("input",{type:"number",step:"0.01",min:"0",value:S.vat_rate,onInput:I=>x({...S,vat_rate:I.target.value}),style:"text-align:right"})]})]}),s("div",{class:"invoice-totals",children:[s("div",{class:"invoice-totals-row",children:[s("span",{children:"Zwischensumme"}),s("span",{children:Be(ee.subtotal)})]}),parseFloat(S.discount_percent)>0&&s("div",{class:"invoice-totals-row",children:[s("span",{children:["Rabatt (-",S.discount_percent,"%)"]}),s("span",{children:["-",Be(ee.discount_amount)]})]}),s("div",{class:"invoice-totals-row",children:[s("span",{children:"Nettobetrag"}),s("span",{children:Be(ee.net_amount)})]}),s("div",{class:"invoice-totals-row",children:[s("span",{children:[S.vat_rate,"% MwSt."]}),s("span",{children:Be(ee.vat_amount)})]}),s("div",{class:"invoice-totals-row",style:"font-weight:700;font-size:1.1rem;border-top:2px solid var(--border);padding-top:0.5rem",children:[s("span",{children:"Gesamtbetrag"}),s("span",{children:Be(ee.total_amount)})]})]})]})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Texte"})}),s("div",{class:"form-group",children:[s("label",{children:"Einleitungstext"}),s("textarea",{value:S.intro_text,onInput:I=>x({...S,intro_text:I.target.value}),rows:2,placeholder:G?"Angebots-Einleitung...":"Rechnungs-Einleitung..."})]}),s("div",{class:"form-group",children:[s("label",{children:"Zahlungsbedingungen"}),s("textarea",{value:S.payment_terms,onInput:I=>x({...S,payment_terms:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Schlussnachricht"}),s("textarea",{value:S.closing_message,onInput:I=>x({...S,closing_message:I.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Interne Notizen"}),s("textarea",{value:S.notes,onInput:I=>x({...S,notes:I.target.value}),placeholder:"Nur intern sichtbar"})]})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>qe("/crm/invoices"),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",disabled:h,children:h?"Speichern...":o?"Speichern":"Erstellen"})]})]})})]})}const db="modulepreload",hb=function(t){return"/crm/"+t},hf={},ru=function(e,n,r){let a=Promise.resolve();if(n&&n.length>0){let o=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=o(n.map(u=>{if(u=hb(u),u in hf)return;hf[u]=!0;const h=u.endsWith(".css"),g=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${g}`))return;const b=document.createElement("link");if(b.rel=h?"stylesheet":db,h||(b.as="script"),b.crossOrigin="",b.href=u,c&&b.setAttribute("nonce",c),document.head.appendChild(b),h)return new Promise((p,y)=>{b.addEventListener("load",p),b.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};function Ht(t){"@babel/helpers - typeof";return Ht=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ht(t)}var ti=Uint8Array,Cr=Uint16Array,xd=Int32Array,Sd=new ti([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ad=new ti([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ff=new ti([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wg=function(t,e){for(var n=new Cr(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var a=new xd(n[30]),r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)a[i]=i-n[r]<<5|r;return{b:n,r:a}},xg=wg(Sd,2),fb=xg.b,Ju=xg.r;fb[28]=258,Ju[258]=28;var pb=wg(Ad,0),pf=pb.r,Yu=new Cr(32768);for(var nn=0;nn<32768;++nn){var ra=(nn&43690)>>1|(nn&21845)<<1;ra=(ra&52428)>>2|(ra&13107)<<2,ra=(ra&61680)>>4|(ra&3855)<<4,Yu[nn]=((ra&65280)>>8|(ra&255)<<8)>>1}var mo=(function(t,e,n){for(var r=t.length,a=0,i=new Cr(e);a<r;++a)t[a]&&++i[t[a]-1];var o=new Cr(e);for(a=1;a<e;++a)o[a]=o[a-1]+i[a-1]<<1;var l;if(n){l=new Cr(1<<e);var c=15-e;for(a=0;a<r;++a)if(t[a])for(var u=a<<4|t[a],h=e-t[a],g=o[t[a]-1]++<<h,b=g|(1<<h)-1;g<=b;++g)l[Yu[g]>>c]=u}else for(l=new Cr(r),a=0;a<r;++a)t[a]&&(l[a]=Yu[o[t[a]-1]++]>>15-t[a]);return l}),Ua=new ti(288);for(var nn=0;nn<144;++nn)Ua[nn]=8;for(var nn=144;nn<256;++nn)Ua[nn]=9;for(var nn=256;nn<280;++nn)Ua[nn]=7;for(var nn=280;nn<288;++nn)Ua[nn]=8;var Kl=new ti(32);for(var nn=0;nn<32;++nn)Kl[nn]=5;var gb=mo(Ua,9,0),mb=mo(Kl,5,0),Sg=function(t){return(t+7)/8|0},vb=function(t,e,n){return(n==null||n>t.length)&&(n=t.length),new ti(t.subarray(e,n))},Fi=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8},so=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8,t[r+2]|=n>>16},iu=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var a=n.length,i=n.slice();if(!a)return{t:kg,l:0};if(a==1){var o=new ti(n[0].s+1);return o[n[0].s]=1,{t:o,l:1}}n.sort(function(M,ee){return M.f-ee.f}),n.push({s:-1,f:25001});var l=n[0],c=n[1],u=0,h=1,g=2;for(n[0]={s:-1,f:l.f+c.f,l,r:c};h!=a-1;)l=n[n[u].f<n[g].f?u++:g++],c=n[u!=h&&n[u].f<n[g].f?u++:g++],n[h++]={s:-1,f:l.f+c.f,l,r:c};for(var b=i[0].s,r=1;r<a;++r)i[r].s>b&&(b=i[r].s);var p=new Cr(b+1),y=Xu(n[h-1],p,0);if(y>e){var r=0,_=0,S=y-e,x=1<<S;for(i.sort(function(ee,G){return p[G.s]-p[ee.s]||ee.f-G.f});r<a;++r){var T=i[r].s;if(p[T]>e)_+=x-(1<<y-p[T]),p[T]=e;else break}for(_>>=S;_>0;){var O=i[r].s;p[O]<e?_-=1<<e-p[O]++-1:++r}for(;r>=0&&_;--r){var E=i[r].s;p[E]==e&&(--p[E],++_)}y=e}return{t:new ti(p),l:y}},Xu=function(t,e,n){return t.s==-1?Math.max(Xu(t.l,e,n+1),Xu(t.r,e,n+1)):e[t.s]=n},gf=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new Cr(++e),r=0,a=t[0],i=1,o=function(c){n[r++]=c},l=1;l<=e;++l)if(t[l]==a&&l!=e)++i;else{if(!a&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(a),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(a);i=1,a=t[l]}return{c:n.subarray(0,r),n:e}},oo=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},Ag=function(t,e,n){var r=n.length,a=Sg(e+2);t[a]=r&255,t[a+1]=r>>8,t[a+2]=t[a]^255,t[a+3]=t[a+1]^255;for(var i=0;i<r;++i)t[a+i+4]=n[i];return(a+4+r)*8},mf=function(t,e,n,r,a,i,o,l,c,u,h){Fi(e,h++,n),++a[256];for(var g=iu(a,15),b=g.t,p=g.l,y=iu(i,15),_=y.t,S=y.l,x=gf(b),T=x.c,O=x.n,E=gf(_),M=E.c,ee=E.n,G=new Cr(19),X=0;X<T.length;++X)++G[T[X]&31];for(var X=0;X<M.length;++X)++G[M[X]&31];for(var F=iu(G,7),I=F.t,k=F.l,A=19;A>4&&!I[ff[A-1]];--A);var j=u+5<<3,q=oo(a,Ua)+oo(i,Kl)+o,K=oo(a,b)+oo(i,_)+o+14+3*A+oo(G,I)+2*G[16]+3*G[17]+7*G[18];if(c>=0&&j<=q&&j<=K)return Ag(e,h,t.subarray(c,c+u));var le,ue,ae,ge;if(Fi(e,h,1+(K<q)),h+=2,K<q){le=mo(b,p,0),ue=b,ae=mo(_,S,0),ge=_;var xe=mo(I,k,0);Fi(e,h,O-257),Fi(e,h+5,ee-1),Fi(e,h+10,A-4),h+=14;for(var X=0;X<A;++X)Fi(e,h+3*X,I[ff[X]]);h+=3*A;for(var pe=[T,M],C=0;C<2;++C)for(var $=pe[C],X=0;X<$.length;++X){var V=$[X]&31;Fi(e,h,xe[V]),h+=I[V],V>15&&(Fi(e,h,$[X]>>5&127),h+=$[X]>>12)}}else le=gb,ue=Ua,ae=mb,ge=Kl;for(var X=0;X<l;++X){var J=r[X];if(J>255){var V=J>>18&31;so(e,h,le[V+257]),h+=ue[V+257],V>7&&(Fi(e,h,J>>23&31),h+=Sd[V]);var Z=J&31;so(e,h,ae[Z]),h+=ge[Z],Z>3&&(so(e,h,J>>5&8191),h+=Ad[Z])}else so(e,h,le[J]),h+=ue[J]}return so(e,h,le[256]),h+ue[256]},bb=new xd([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),kg=new ti(0),yb=function(t,e,n,r,a,i){var o=i.z||t.length,l=new ti(r+o+5*(1+Math.ceil(o/7e3))+a),c=l.subarray(r,l.length-a),u=i.l,h=(i.r||0)&7;if(e){h&&(c[0]=i.r>>3);for(var g=bb[e-1],b=g>>13,p=g&8191,y=(1<<n)-1,_=i.p||new Cr(32768),S=i.h||new Cr(y+1),x=Math.ceil(n/3),T=2*x,O=function(De){return(t[De]^t[De+1]<<x^t[De+2]<<T)&y},E=new xd(25e3),M=new Cr(288),ee=new Cr(32),G=0,X=0,F=i.i||0,I=0,k=i.w||0,A=0;F+2<o;++F){var j=O(F),q=F&32767,K=S[j];if(_[q]=K,S[j]=q,k<=F){var le=o-F;if((G>7e3||I>24576)&&(le>423||!u)){h=mf(t,c,0,E,M,ee,X,I,A,F-A,h),I=G=X=0,A=F;for(var ue=0;ue<286;++ue)M[ue]=0;for(var ue=0;ue<30;++ue)ee[ue]=0}var ae=2,ge=0,xe=p,pe=q-K&32767;if(le>2&&j==O(F-pe))for(var C=Math.min(b,le)-1,$=Math.min(32767,F),V=Math.min(258,le);pe<=$&&--xe&&q!=K;){if(t[F+ae]==t[F+ae-pe]){for(var J=0;J<V&&t[F+J]==t[F+J-pe];++J);if(J>ae){if(ae=J,ge=pe,J>C)break;for(var Z=Math.min(pe,J-2),ie=0,ue=0;ue<Z;++ue){var fe=F-pe+ue&32767,Y=_[fe],se=fe-Y&32767;se>ie&&(ie=se,K=fe)}}}q=K,K=_[q],pe+=q-K&32767}if(ge){E[I++]=268435456|Ju[ae]<<18|pf[ge];var be=Ju[ae]&31,Ce=pf[ge]&31;X+=Sd[be]+Ad[Ce],++M[257+be],++ee[Ce],k=F+ae,++G}else E[I++]=t[F],++M[t[F]]}}for(F=Math.max(F,k);F<o;++F)E[I++]=t[F],++M[t[F]];h=mf(t,c,u,E,M,ee,X,I,A,F-A,h),u||(i.r=h&7|c[h/8|0]<<3,h-=7,i.h=S,i.p=_,i.i=F,i.w=k)}else{for(var F=i.w||0;F<o+u;F+=65535){var Te=F+65535;Te>=o&&(c[h/8|0]=u,Te=o),h=Ag(c,h+1,t.subarray(F,Te))}i.i=o}return vb(l,0,r+Sg(h)+a)},Ng=function(){var t=1,e=0;return{p:function(n){for(var r=t,a=e,i=n.length|0,o=0;o!=i;){for(var l=Math.min(o+2655,i);o<l;++o)a+=r+=n[o];r=(r&65535)+15*(r>>16),a=(a&65535)+15*(a>>16)}t=r,e=a},d:function(){return t%=65521,e%=65521,(t&255)<<24|(t&65280)<<8|(e&255)<<8|e>>8}}},_b=function(t,e,n,r,a){if(!a&&(a={l:1},e.dictionary)){var i=e.dictionary.subarray(-32768),o=new ti(i.length+t.length);o.set(i),o.set(t,i.length),t=o,a.w=i.length}return yb(t,e.level==null?6:e.level,e.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,n,r,a)},Eg=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},wb=function(t,e){var n=e.level,r=n==0?0:n<6?1:n==9?3:2;if(t[0]=120,t[1]=r<<6|(e.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var a=Ng();a.p(e.dictionary),Eg(t,2,a.d())}};function Zu(t,e){e||(e={});var n=Ng();n.p(t);var r=_b(t,e,e.dictionary?6:2,4);return wb(r,e),Eg(r,r.length-4,n.d()),r}var xb=typeof TextDecoder<"u"&&new TextDecoder,Sb=0;try{xb.decode(kg,{stream:!0}),Sb=1}catch{}function Ab(t){if(Array.isArray(t))return t}function kb(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,a,i,o,l=[],c=!0,u=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(h){u=!0,a=h}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return l}}function vf(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Nb(t,e){if(t){if(typeof t=="string")return vf(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vf(t,e):void 0}}function Eb(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bf(t,e){return Ab(t)||kb(t,e)||Nb(t,e)||Eb()}function yf(t,e="utf8"){return new TextDecoder(e).decode(t)}const Lb=new TextEncoder;function Cb(t){return Lb.encode(t)}const Tb=1024*8,Pb=(()=>{const t=new Uint8Array(4),e=new Uint32Array(t.buffer);return!((e[0]=1)&t[0])})(),au={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class kd{constructor(e=Tb,n={}){zt(this,"buffer");zt(this,"byteLength");zt(this,"byteOffset");zt(this,"length");zt(this,"offset");zt(this,"lastWrittenByte");zt(this,"littleEndian");zt(this,"_data");zt(this,"_mark");zt(this,"_marks");let r=!1;typeof e=="number"?e=new ArrayBuffer(e):(r=!0,this.lastWrittenByte=e.byteLength);const a=n.offset?n.offset>>>0:0,i=e.byteLength-a;let o=a;(ArrayBuffer.isView(e)||e instanceof kd)&&(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+a),e=e.buffer),r?this.lastWrittenByte=i:this.lastWrittenByte=0,this.buffer=e,this.length=i,this.byteLength=i,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,i),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const r=(this.offset+e)*2,a=new Uint8Array(r);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=r,this.byteLength=r,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,n){const r=au[n].BYTES_PER_ELEMENT*e,a=this.byteOffset+this.offset,i=this.buffer.slice(a,a+r);if(this.littleEndian===Pb&&n!=="uint8"&&n!=="int8"){const l=new Uint8Array(this.buffer.slice(a,a+r));l.reverse();const c=new au[n](l.buffer);return this.offset+=r,c.reverse(),c}const o=new au[n](i);return this.offset+=r,o}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let n="";for(let r=0;r<e;r++)n+=this.readChar();return n}readUtf8(e=1){return yf(this.readBytes(e))}decodeText(e=1,n="utf8"){return yf(this.readBytes(e),n)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let n=0;n<e.length;n++)this._data.setUint8(this.offset++,e[n]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let n=0;n<e.length;n++)this.writeUint8(e.charCodeAt(n));return this}writeUtf8(e){return this.writeBytes(Cb(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function Es(t){let e=t.length;for(;--e>=0;)t[e]=0}const Ib=3,Ob=258,Lg=29,Rb=256,Fb=Rb+1+Lg,Cg=30,Db=512,jb=new Array((Fb+2)*2);Es(jb);const Bb=new Array(Cg*2);Es(Bb);const Mb=new Array(Db);Es(Mb);const Ub=new Array(Ob-Ib+1);Es(Ub);const $b=new Array(Lg);Es($b);const qb=new Array(Cg);Es(qb);const zb=(t,e,n,r)=>{let a=t&65535|0,i=t>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do a=a+e[r++]|0,i=i+a|0;while(--o);a%=65521,i%=65521}return a|i<<16|0};var Qu=zb;const Hb=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e},Wb=new Uint32Array(Hb()),Gb=(t,e,n,r)=>{const a=Wb,i=r+n;t^=-1;for(let o=r;o<i;o++)t=t>>>8^a[(t^e[o])&255];return t^-1};var hi=Gb,ed={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Tg={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const Vb=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Kb=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)Vb(n,r)&&(t[r]=n[r])}}return t},Jb=t=>{let e=0;for(let r=0,a=t.length;r<a;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,a=0,i=t.length;r<i;r++){let o=t[r];n.set(o,a),a+=o.length}return n},Pg={assign:Kb,flattenChunks:Jb};let Ig=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Ig=!1}const No=new Uint8Array(256);for(let t=0;t<256;t++)No[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;No[254]=No[254]=1;var Yb=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,a,i,o=t.length,l=0;for(a=0;a<o;a++)n=t.charCodeAt(a),(n&64512)===55296&&a+1<o&&(r=t.charCodeAt(a+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),a++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(l),i=0,a=0;i<l;a++)n=t.charCodeAt(a),(n&64512)===55296&&a+1<o&&(r=t.charCodeAt(a+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),a++)),n<128?e[i++]=n:n<2048?(e[i++]=192|n>>>6,e[i++]=128|n&63):n<65536?(e[i++]=224|n>>>12,e[i++]=128|n>>>6&63,e[i++]=128|n&63):(e[i++]=240|n>>>18,e[i++]=128|n>>>12&63,e[i++]=128|n>>>6&63,e[i++]=128|n&63);return e};const Xb=(t,e)=>{if(e<65534&&t.subarray&&Ig)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n};var Zb=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,a;const i=new Array(n*2);for(a=0,r=0;r<n;){let o=t[r++];if(o<128){i[a++]=o;continue}let l=No[o];if(l>4){i[a++]=65533,r+=l-1;continue}for(o&=l===2?31:l===3?15:7;l>1&&r<n;)o=o<<6|t[r++]&63,l--;if(l>1){i[a++]=65533;continue}o<65536?i[a++]=o:(o-=65536,i[a++]=55296|o>>10&1023,i[a++]=56320|o&1023)}return Xb(i,a)},Qb=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(t[n]&192)===128;)n--;return n<0||n===0?e:n+No[t[n]]>e?n:e},td={string2buf:Yb,buf2string:Zb,utf8border:Qb};function e5(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var t5=e5;const _l=16209,n5=16191;var r5=function(e,n){let r,a,i,o,l,c,u,h,g,b,p,y,_,S,x,T,O,E,M,ee,G,X,F,I;const k=e.state;r=e.next_in,F=e.input,a=r+(e.avail_in-5),i=e.next_out,I=e.output,o=i-(n-e.avail_out),l=i+(e.avail_out-257),c=k.dmax,u=k.wsize,h=k.whave,g=k.wnext,b=k.window,p=k.hold,y=k.bits,_=k.lencode,S=k.distcode,x=(1<<k.lenbits)-1,T=(1<<k.distbits)-1;e:do{y<15&&(p+=F[r++]<<y,y+=8,p+=F[r++]<<y,y+=8),O=_[p&x];t:for(;;){if(E=O>>>24,p>>>=E,y-=E,E=O>>>16&255,E===0)I[i++]=O&65535;else if(E&16){M=O&65535,E&=15,E&&(y<E&&(p+=F[r++]<<y,y+=8),M+=p&(1<<E)-1,p>>>=E,y-=E),y<15&&(p+=F[r++]<<y,y+=8,p+=F[r++]<<y,y+=8),O=S[p&T];n:for(;;){if(E=O>>>24,p>>>=E,y-=E,E=O>>>16&255,E&16){if(ee=O&65535,E&=15,y<E&&(p+=F[r++]<<y,y+=8,y<E&&(p+=F[r++]<<y,y+=8)),ee+=p&(1<<E)-1,ee>c){e.msg="invalid distance too far back",k.mode=_l;break e}if(p>>>=E,y-=E,E=i-o,ee>E){if(E=ee-E,E>h&&k.sane){e.msg="invalid distance too far back",k.mode=_l;break e}if(G=0,X=b,g===0){if(G+=u-E,E<M){M-=E;do I[i++]=b[G++];while(--E);G=i-ee,X=I}}else if(g<E){if(G+=u+g-E,E-=g,E<M){M-=E;do I[i++]=b[G++];while(--E);if(G=0,g<M){E=g,M-=E;do I[i++]=b[G++];while(--E);G=i-ee,X=I}}}else if(G+=g-E,E<M){M-=E;do I[i++]=b[G++];while(--E);G=i-ee,X=I}for(;M>2;)I[i++]=X[G++],I[i++]=X[G++],I[i++]=X[G++],M-=3;M&&(I[i++]=X[G++],M>1&&(I[i++]=X[G++]))}else{G=i-ee;do I[i++]=I[G++],I[i++]=I[G++],I[i++]=I[G++],M-=3;while(M>2);M&&(I[i++]=I[G++],M>1&&(I[i++]=I[G++]))}}else if((E&64)===0){O=S[(O&65535)+(p&(1<<E)-1)];continue n}else{e.msg="invalid distance code",k.mode=_l;break e}break}}else if((E&64)===0){O=_[(O&65535)+(p&(1<<E)-1)];continue t}else if(E&32){k.mode=n5;break e}else{e.msg="invalid literal/length code",k.mode=_l;break e}break}}while(r<a&&i<l);M=y>>3,r-=M,y-=M<<3,p&=(1<<y)-1,e.next_in=r,e.next_out=i,e.avail_in=r<a?5+(a-r):5-(r-a),e.avail_out=i<l?257+(l-i):257-(i-l),k.hold=p,k.bits=y};const os=15,_f=852,wf=592,xf=0,su=1,Sf=2,i5=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),a5=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),s5=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),o5=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),l5=(t,e,n,r,a,i,o,l)=>{const c=l.bits;let u=0,h=0,g=0,b=0,p=0,y=0,_=0,S=0,x=0,T=0,O,E,M,ee,G,X=null,F;const I=new Uint16Array(os+1),k=new Uint16Array(os+1);let A=null,j,q,K;for(u=0;u<=os;u++)I[u]=0;for(h=0;h<r;h++)I[e[n+h]]++;for(p=c,b=os;b>=1&&I[b]===0;b--);if(p>b&&(p=b),b===0)return a[i++]=1<<24|64<<16|0,a[i++]=1<<24|64<<16|0,l.bits=1,0;for(g=1;g<b&&I[g]===0;g++);for(p<g&&(p=g),S=1,u=1;u<=os;u++)if(S<<=1,S-=I[u],S<0)return-1;if(S>0&&(t===xf||b!==1))return-1;for(k[1]=0,u=1;u<os;u++)k[u+1]=k[u]+I[u];for(h=0;h<r;h++)e[n+h]!==0&&(o[k[e[n+h]]++]=h);if(t===xf?(X=A=o,F=20):t===su?(X=i5,A=a5,F=257):(X=s5,A=o5,F=0),T=0,h=0,u=g,G=i,y=p,_=0,M=-1,x=1<<p,ee=x-1,t===su&&x>_f||t===Sf&&x>wf)return 1;for(;;){j=u-_,o[h]+1<F?(q=0,K=o[h]):o[h]>=F?(q=A[o[h]-F],K=X[o[h]-F]):(q=96,K=0),O=1<<u-_,E=1<<y,g=E;do E-=O,a[G+(T>>_)+E]=j<<24|q<<16|K|0;while(E!==0);for(O=1<<u-1;T&O;)O>>=1;if(O!==0?(T&=O-1,T+=O):T=0,h++,--I[u]===0){if(u===b)break;u=e[n+o[h]]}if(u>p&&(T&ee)!==M){for(_===0&&(_=p),G+=g,y=u-_,S=1<<y;y+_<b&&(S-=I[y+_],!(S<=0));)y++,S<<=1;if(x+=1<<y,t===su&&x>_f||t===Sf&&x>wf)return 1;M=T&ee,a[M]=p<<24|y<<16|G-i|0}}return T!==0&&(a[G+T]=u-_<<24|64<<16|0),l.bits=p,0};var vo=l5;const c5=0,Og=1,Rg=2,{Z_FINISH:Af,Z_BLOCK:u5,Z_TREES:wl,Z_OK:$a,Z_STREAM_END:d5,Z_NEED_DICT:h5,Z_STREAM_ERROR:qr,Z_DATA_ERROR:Fg,Z_MEM_ERROR:Dg,Z_BUF_ERROR:f5,Z_DEFLATED:kf}=Tg,cc=16180,Nf=16181,Ef=16182,Lf=16183,Cf=16184,Tf=16185,Pf=16186,If=16187,Of=16188,Rf=16189,Jl=16190,Di=16191,ou=16192,Ff=16193,lu=16194,Df=16195,jf=16196,Bf=16197,Mf=16198,xl=16199,Sl=16200,Uf=16201,$f=16202,qf=16203,zf=16204,Hf=16205,cu=16206,Wf=16207,Gf=16208,an=16209,jg=16210,Bg=16211,p5=852,g5=592,m5=15,v5=m5,Vf=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function b5(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const za=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<cc||e.mode>Bg?1:0},Mg=t=>{if(za(t))return qr;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=cc,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(p5),e.distcode=e.distdyn=new Int32Array(g5),e.sane=1,e.back=-1,$a},Ug=t=>{if(za(t))return qr;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Mg(t)},$g=(t,e)=>{let n;if(za(t))return qr;const r=t.state;return e<0?(n=0,e=-e):(n=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?qr:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,Ug(t))},qg=(t,e)=>{if(!t)return qr;const n=new b5;t.state=n,n.strm=t,n.window=null,n.mode=cc;const r=$g(t,e);return r!==$a&&(t.state=null),r},y5=t=>qg(t,v5);let Kf=!0,uu,du;const _5=t=>{if(Kf){uu=new Int32Array(512),du=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(vo(Og,t.lens,0,288,uu,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;vo(Rg,t.lens,0,32,du,0,t.work,{bits:5}),Kf=!1}t.lencode=uu,t.lenbits=9,t.distcode=du,t.distbits=5},zg=(t,e,n,r)=>{let a;const i=t.state;return i.window===null&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),r>=i.wsize?(i.window.set(e.subarray(n-i.wsize,n),0),i.wnext=0,i.whave=i.wsize):(a=i.wsize-i.wnext,a>r&&(a=r),i.window.set(e.subarray(n-r,n-r+a),i.wnext),r-=a,r?(i.window.set(e.subarray(n-r,n),0),i.wnext=r,i.whave=i.wsize):(i.wnext+=a,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=a))),0},w5=(t,e)=>{let n,r,a,i,o,l,c,u,h,g,b,p,y,_,S=0,x,T,O,E,M,ee,G,X;const F=new Uint8Array(4);let I,k;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(za(t)||!t.output||!t.input&&t.avail_in!==0)return qr;n=t.state,n.mode===Di&&(n.mode=ou),o=t.next_out,a=t.output,c=t.avail_out,i=t.next_in,r=t.input,l=t.avail_in,u=n.hold,h=n.bits,g=l,b=c,X=$a;e:for(;;)switch(n.mode){case cc:if(n.wrap===0){n.mode=ou;break}for(;h<16;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}if(n.wrap&2&&u===35615){n.wbits===0&&(n.wbits=15),n.check=0,F[0]=u&255,F[1]=u>>>8&255,n.check=hi(n.check,F,2,0),u=0,h=0,n.mode=Nf;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((u&255)<<8)+(u>>8))%31){t.msg="incorrect header check",n.mode=an;break}if((u&15)!==kf){t.msg="unknown compression method",n.mode=an;break}if(u>>>=4,h-=4,G=(u&15)+8,n.wbits===0&&(n.wbits=G),G>15||G>n.wbits){t.msg="invalid window size",n.mode=an;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=u&512?Rf:Di,u=0,h=0;break;case Nf:for(;h<16;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}if(n.flags=u,(n.flags&255)!==kf){t.msg="unknown compression method",n.mode=an;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=an;break}n.head&&(n.head.text=u>>8&1),n.flags&512&&n.wrap&4&&(F[0]=u&255,F[1]=u>>>8&255,n.check=hi(n.check,F,2,0)),u=0,h=0,n.mode=Ef;case Ef:for(;h<32;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}n.head&&(n.head.time=u),n.flags&512&&n.wrap&4&&(F[0]=u&255,F[1]=u>>>8&255,F[2]=u>>>16&255,F[3]=u>>>24&255,n.check=hi(n.check,F,4,0)),u=0,h=0,n.mode=Lf;case Lf:for(;h<16;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}n.head&&(n.head.xflags=u&255,n.head.os=u>>8),n.flags&512&&n.wrap&4&&(F[0]=u&255,F[1]=u>>>8&255,n.check=hi(n.check,F,2,0)),u=0,h=0,n.mode=Cf;case Cf:if(n.flags&1024){for(;h<16;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}n.length=u,n.head&&(n.head.extra_len=u),n.flags&512&&n.wrap&4&&(F[0]=u&255,F[1]=u>>>8&255,n.check=hi(n.check,F,2,0)),u=0,h=0}else n.head&&(n.head.extra=null);n.mode=Tf;case Tf:if(n.flags&1024&&(p=n.length,p>l&&(p=l),p&&(n.head&&(G=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(i,i+p),G)),n.flags&512&&n.wrap&4&&(n.check=hi(n.check,r,p,i)),l-=p,i+=p,n.length-=p),n.length))break e;n.length=0,n.mode=Pf;case Pf:if(n.flags&2048){if(l===0)break e;p=0;do G=r[i+p++],n.head&&G&&n.length<65536&&(n.head.name+=String.fromCharCode(G));while(G&&p<l);if(n.flags&512&&n.wrap&4&&(n.check=hi(n.check,r,p,i)),l-=p,i+=p,G)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=If;case If:if(n.flags&4096){if(l===0)break e;p=0;do G=r[i+p++],n.head&&G&&n.length<65536&&(n.head.comment+=String.fromCharCode(G));while(G&&p<l);if(n.flags&512&&n.wrap&4&&(n.check=hi(n.check,r,p,i)),l-=p,i+=p,G)break e}else n.head&&(n.head.comment=null);n.mode=Of;case Of:if(n.flags&512){for(;h<16;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}if(n.wrap&4&&u!==(n.check&65535)){t.msg="header crc mismatch",n.mode=an;break}u=0,h=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Di;break;case Rf:for(;h<32;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}t.adler=n.check=Vf(u),u=0,h=0,n.mode=Jl;case Jl:if(n.havedict===0)return t.next_out=o,t.avail_out=c,t.next_in=i,t.avail_in=l,n.hold=u,n.bits=h,h5;t.adler=n.check=1,n.mode=Di;case Di:if(e===u5||e===wl)break e;case ou:if(n.last){u>>>=h&7,h-=h&7,n.mode=cu;break}for(;h<3;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}switch(n.last=u&1,u>>>=1,h-=1,u&3){case 0:n.mode=Ff;break;case 1:if(_5(n),n.mode=xl,e===wl){u>>>=2,h-=2;break e}break;case 2:n.mode=jf;break;case 3:t.msg="invalid block type",n.mode=an}u>>>=2,h-=2;break;case Ff:for(u>>>=h&7,h-=h&7;h<32;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}if((u&65535)!==(u>>>16^65535)){t.msg="invalid stored block lengths",n.mode=an;break}if(n.length=u&65535,u=0,h=0,n.mode=lu,e===wl)break e;case lu:n.mode=Df;case Df:if(p=n.length,p){if(p>l&&(p=l),p>c&&(p=c),p===0)break e;a.set(r.subarray(i,i+p),o),l-=p,i+=p,c-=p,o+=p,n.length-=p;break}n.mode=Di;break;case jf:for(;h<14;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}if(n.nlen=(u&31)+257,u>>>=5,h-=5,n.ndist=(u&31)+1,u>>>=5,h-=5,n.ncode=(u&15)+4,u>>>=4,h-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=an;break}n.have=0,n.mode=Bf;case Bf:for(;n.have<n.ncode;){for(;h<3;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}n.lens[A[n.have++]]=u&7,u>>>=3,h-=3}for(;n.have<19;)n.lens[A[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,I={bits:n.lenbits},X=vo(c5,n.lens,0,19,n.lencode,0,n.work,I),n.lenbits=I.bits,X){t.msg="invalid code lengths set",n.mode=an;break}n.have=0,n.mode=Mf;case Mf:for(;n.have<n.nlen+n.ndist;){for(;S=n.lencode[u&(1<<n.lenbits)-1],x=S>>>24,T=S>>>16&255,O=S&65535,!(x<=h);){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}if(O<16)u>>>=x,h-=x,n.lens[n.have++]=O;else{if(O===16){for(k=x+2;h<k;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}if(u>>>=x,h-=x,n.have===0){t.msg="invalid bit length repeat",n.mode=an;break}G=n.lens[n.have-1],p=3+(u&3),u>>>=2,h-=2}else if(O===17){for(k=x+3;h<k;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}u>>>=x,h-=x,G=0,p=3+(u&7),u>>>=3,h-=3}else{for(k=x+7;h<k;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}u>>>=x,h-=x,G=0,p=11+(u&127),u>>>=7,h-=7}if(n.have+p>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=an;break}for(;p--;)n.lens[n.have++]=G}}if(n.mode===an)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=an;break}if(n.lenbits=9,I={bits:n.lenbits},X=vo(Og,n.lens,0,n.nlen,n.lencode,0,n.work,I),n.lenbits=I.bits,X){t.msg="invalid literal/lengths set",n.mode=an;break}if(n.distbits=6,n.distcode=n.distdyn,I={bits:n.distbits},X=vo(Rg,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,I),n.distbits=I.bits,X){t.msg="invalid distances set",n.mode=an;break}if(n.mode=xl,e===wl)break e;case xl:n.mode=Sl;case Sl:if(l>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=i,t.avail_in=l,n.hold=u,n.bits=h,r5(t,b),o=t.next_out,a=t.output,c=t.avail_out,i=t.next_in,r=t.input,l=t.avail_in,u=n.hold,h=n.bits,n.mode===Di&&(n.back=-1);break}for(n.back=0;S=n.lencode[u&(1<<n.lenbits)-1],x=S>>>24,T=S>>>16&255,O=S&65535,!(x<=h);){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}if(T&&(T&240)===0){for(E=x,M=T,ee=O;S=n.lencode[ee+((u&(1<<E+M)-1)>>E)],x=S>>>24,T=S>>>16&255,O=S&65535,!(E+x<=h);){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}u>>>=E,h-=E,n.back+=E}if(u>>>=x,h-=x,n.back+=x,n.length=O,T===0){n.mode=Hf;break}if(T&32){n.back=-1,n.mode=Di;break}if(T&64){t.msg="invalid literal/length code",n.mode=an;break}n.extra=T&15,n.mode=Uf;case Uf:if(n.extra){for(k=n.extra;h<k;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=$f;case $f:for(;S=n.distcode[u&(1<<n.distbits)-1],x=S>>>24,T=S>>>16&255,O=S&65535,!(x<=h);){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}if((T&240)===0){for(E=x,M=T,ee=O;S=n.distcode[ee+((u&(1<<E+M)-1)>>E)],x=S>>>24,T=S>>>16&255,O=S&65535,!(E+x<=h);){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}u>>>=E,h-=E,n.back+=E}if(u>>>=x,h-=x,n.back+=x,T&64){t.msg="invalid distance code",n.mode=an;break}n.offset=O,n.extra=T&15,n.mode=qf;case qf:if(n.extra){for(k=n.extra;h<k;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=an;break}n.mode=zf;case zf:if(c===0)break e;if(p=b-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=an;break}p>n.wnext?(p-=n.wnext,y=n.wsize-p):y=n.wnext-p,p>n.length&&(p=n.length),_=n.window}else _=a,y=o-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do a[o++]=_[y++];while(--p);n.length===0&&(n.mode=Sl);break;case Hf:if(c===0)break e;a[o++]=n.length,c--,n.mode=Sl;break;case cu:if(n.wrap){for(;h<32;){if(l===0)break e;l--,u|=r[i++]<<h,h+=8}if(b-=c,t.total_out+=b,n.total+=b,n.wrap&4&&b&&(t.adler=n.check=n.flags?hi(n.check,a,b,o-b):Qu(n.check,a,b,o-b)),b=c,n.wrap&4&&(n.flags?u:Vf(u))!==n.check){t.msg="incorrect data check",n.mode=an;break}u=0,h=0}n.mode=Wf;case Wf:if(n.wrap&&n.flags){for(;h<32;){if(l===0)break e;l--,u+=r[i++]<<h,h+=8}if(n.wrap&4&&u!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=an;break}u=0,h=0}n.mode=Gf;case Gf:X=d5;break e;case an:X=Fg;break e;case jg:return Dg;case Bg:default:return qr}return t.next_out=o,t.avail_out=c,t.next_in=i,t.avail_in=l,n.hold=u,n.bits=h,(n.wsize||b!==t.avail_out&&n.mode<an&&(n.mode<cu||e!==Af))&&zg(t,t.output,t.next_out,b-t.avail_out),g-=t.avail_in,b-=t.avail_out,t.total_in+=g,t.total_out+=b,n.total+=b,n.wrap&4&&b&&(t.adler=n.check=n.flags?hi(n.check,a,b,t.next_out-b):Qu(n.check,a,b,t.next_out-b)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Di?128:0)+(n.mode===xl||n.mode===lu?256:0),(g===0&&b===0||e===Af)&&X===$a&&(X=f5),X},x5=t=>{if(za(t))return qr;let e=t.state;return e.window&&(e.window=null),t.state=null,$a},S5=(t,e)=>{if(za(t))return qr;const n=t.state;return(n.wrap&2)===0?qr:(n.head=e,e.done=!1,$a)},A5=(t,e)=>{const n=e.length;let r,a,i;return za(t)||(r=t.state,r.wrap!==0&&r.mode!==Jl)?qr:r.mode===Jl&&(a=1,a=Qu(a,e,n,0),a!==r.check)?Fg:(i=zg(t,e,n,n),i?(r.mode=jg,Dg):(r.havedict=1,$a))};var k5=Ug,N5=$g,E5=Mg,L5=y5,C5=qg,T5=w5,P5=x5,I5=S5,O5=A5,R5="pako inflate (from Nodeca project)",Bi={inflateReset:k5,inflateReset2:N5,inflateResetKeep:E5,inflateInit:L5,inflateInit2:C5,inflate:T5,inflateEnd:P5,inflateGetHeader:I5,inflateSetDictionary:O5,inflateInfo:R5};function F5(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var D5=F5;const Hg=Object.prototype.toString,{Z_NO_FLUSH:j5,Z_FINISH:B5,Z_OK:Eo,Z_STREAM_END:hu,Z_NEED_DICT:fu,Z_STREAM_ERROR:M5,Z_DATA_ERROR:Jf,Z_MEM_ERROR:U5}=Tg;function Po(t){this.options=Pg.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new t5,this.strm.avail_out=0;let n=Bi.inflateInit2(this.strm,e.windowBits);if(n!==Eo)throw new Error(ed[n]);if(this.header=new D5,Bi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=td.string2buf(e.dictionary):Hg.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Bi.inflateSetDictionary(this.strm,e.dictionary),n!==Eo)))throw new Error(ed[n])}Po.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,a=this.options.dictionary;let i,o,l;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?B5:j5,Hg.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),i=Bi.inflate(n,o),i===fu&&a&&(i=Bi.inflateSetDictionary(n,a),i===Eo?i=Bi.inflate(n,o):i===Jf&&(i=fu));n.avail_in>0&&i===hu&&n.state.wrap>0&&t[n.next_in]!==0;)Bi.inflateReset(n),i=Bi.inflate(n,o);switch(i){case M5:case Jf:case fu:case U5:return this.onEnd(i),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||i===hu))if(this.options.to==="string"){let c=td.utf8border(n.output,n.next_out),u=n.next_out-c,h=td.buf2string(n.output,c);n.next_out=u,n.avail_out=r-u,u&&n.output.set(n.output.subarray(c,c+u),0),this.onData(h)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(i===Eo&&l===0)){if(i===hu)return i=Bi.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(n.avail_in===0)break}}return!0};Po.prototype.onData=function(t){this.chunks.push(t)};Po.prototype.onEnd=function(t){t===Eo&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Pg.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function $5(t,e){const n=new Po(e);if(n.push(t),n.err)throw n.msg||ed[n.err];return n.result}var q5=Po,z5=$5,H5={Inflate:q5,inflate:z5};const{Inflate:W5,inflate:G5}=H5;var Yf=W5,V5=G5;const Wg=[];for(let t=0;t<256;t++){let e=t;for(let n=0;n<8;n++)e&1?e=3988292384^e>>>1:e=e>>>1;Wg[t]=e}const Xf=4294967295;function K5(t,e,n){let r=t;for(let a=0;a<n;a++)r=Wg[(r^e[a])&255]^r>>>8;return r}function J5(t,e){return(K5(Xf,t,e)^Xf)>>>0}function Zf(t,e,n){const r=t.readUint32(),a=J5(new Uint8Array(t.buffer,t.byteOffset+t.offset-e-4,e),e);if(a!==r)throw new Error(`CRC mismatch for chunk ${n}. Expected ${r}, found ${a}`)}function Gg(t,e,n){for(let r=0;r<n;r++)e[r]=t[r]}function Vg(t,e,n,r){let a=0;for(;a<r;a++)e[a]=t[a];for(;a<n;a++)e[a]=t[a]+e[a-r]&255}function Kg(t,e,n,r){let a=0;if(n.length===0)for(;a<r;a++)e[a]=t[a];else for(;a<r;a++)e[a]=t[a]+n[a]&255}function Jg(t,e,n,r,a){let i=0;if(n.length===0){for(;i<a;i++)e[i]=t[i];for(;i<r;i++)e[i]=t[i]+(e[i-a]>>1)&255}else{for(;i<a;i++)e[i]=t[i]+(n[i]>>1)&255;for(;i<r;i++)e[i]=t[i]+(e[i-a]+n[i]>>1)&255}}function Yg(t,e,n,r,a){let i=0;if(n.length===0){for(;i<a;i++)e[i]=t[i];for(;i<r;i++)e[i]=t[i]+e[i-a]&255}else{for(;i<a;i++)e[i]=t[i]+n[i]&255;for(;i<r;i++)e[i]=t[i]+Y5(e[i-a],n[i],n[i-a])&255}}function Y5(t,e,n){const r=t+e-n,a=Math.abs(r-t),i=Math.abs(r-e),o=Math.abs(r-n);return a<=i&&a<=o?t:i<=o?e:n}function X5(t,e,n,r,a,i){switch(t){case 0:Gg(e,n,a);break;case 1:Vg(e,n,a,i);break;case 2:Kg(e,n,r,a);break;case 3:Jg(e,n,r,a,i);break;case 4:Yg(e,n,r,a,i);break;default:throw new Error(`Unsupported filter: ${t}`)}}const Z5=new Uint16Array([255]),Q5=new Uint8Array(Z5.buffer),ey=Q5[0]===255;function ty(t){const{data:e,width:n,height:r,channels:a,depth:i}=t,o=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],l=Math.ceil(i/8)*a,c=new Uint8Array(r*n*l);let u=0;for(let h=0;h<7;h++){const g=o[h],b=Math.ceil((n-g.x)/g.xStep),p=Math.ceil((r-g.y)/g.yStep);if(b<=0||p<=0)continue;const y=b*l,_=new Uint8Array(y);for(let S=0;S<p;S++){const x=e[u++],T=e.subarray(u,u+y);u+=y;const O=new Uint8Array(y);X5(x,T,O,_,y,l),_.set(O);for(let E=0;E<b;E++){const M=g.x+E*g.xStep,ee=g.y+S*g.yStep;if(!(M>=n||ee>=r))for(let G=0;G<l;G++)c[(ee*n+M)*l+G]=O[E*l+G]}}}if(i===16){const h=new Uint16Array(c.buffer);if(ey)for(let g=0;g<h.length;g++)h[g]=ny(h[g]);return h}else return c}function ny(t){return(t&255)<<8|t>>8&255}const ry=new Uint16Array([255]),iy=new Uint8Array(ry.buffer),ay=iy[0]===255,sy=new Uint8Array(0);function Qf(t){const{data:e,width:n,height:r,channels:a,depth:i}=t,o=Math.ceil(i/8)*a,l=Math.ceil(i/8*a*n),c=new Uint8Array(r*l);let u=sy,h=0,g,b;for(let p=0;p<r;p++){switch(g=e.subarray(h+1,h+1+l),b=c.subarray(p*l,(p+1)*l),e[h]){case 0:Gg(g,b,l);break;case 1:Vg(g,b,l,o);break;case 2:Kg(g,b,u,l);break;case 3:Jg(g,b,u,l,o);break;case 4:Yg(g,b,u,l,o);break;default:throw new Error(`Unsupported filter: ${e[h]}`)}u=b,h+=l+1}if(i===16){const p=new Uint16Array(c.buffer);if(ay)for(let y=0;y<p.length;y++)p[y]=oy(p[y]);return p}else return c}function oy(t){return(t&255)<<8|t>>8&255}const Il=Uint8Array.of(137,80,78,71,13,10,26,10);function ep(t){if(!ly(t.readBytes(Il.length)))throw new Error("wrong PNG signature")}function ly(t){if(t.length<Il.length)return!1;for(let e=0;e<Il.length;e++)if(t[e]!==Il[e])return!1;return!0}const cy="tEXt",uy=0,Xg=new TextDecoder("latin1");function dy(t){if(fy(t),t.length===0||t.length>79)throw new Error("keyword length must be between 1 and 79")}const hy=/^[\u0000-\u00FF]*$/;function fy(t){if(!hy.test(t))throw new Error("invalid latin1 text")}function py(t,e,n){const r=Zg(e);t[r]=gy(e,n-r.length-1)}function Zg(t){for(t.mark();t.readByte()!==uy;);const e=t.offset;t.reset();const n=Xg.decode(t.readBytes(e-t.offset-1));return t.skip(1),dy(n),n}function gy(t,e){return Xg.decode(t.readBytes(e))}const kr={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},pu={UNKNOWN:-1,DEFLATE:0},tp={UNKNOWN:-1,ADAPTIVE:0},gu={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},Al={NONE:0,BACKGROUND:1,PREVIOUS:2},mu={SOURCE:0,OVER:1};class my extends kd{constructor(n,r={}){super(n);zt(this,"_checkCrc");zt(this,"_inflator");zt(this,"_png");zt(this,"_apng");zt(this,"_end");zt(this,"_hasPalette");zt(this,"_palette");zt(this,"_hasTransparency");zt(this,"_transparency");zt(this,"_compressionMethod");zt(this,"_filterMethod");zt(this,"_interlaceMethod");zt(this,"_colorType");zt(this,"_isAnimated");zt(this,"_numberOfFrames");zt(this,"_numberOfPlays");zt(this,"_frames");zt(this,"_writingDataChunks");const{checkCrc:a=!1}=r;this._checkCrc=a,this._inflator=new Yf,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=pu.UNKNOWN,this._filterMethod=tp.UNKNOWN,this._interlaceMethod=gu.UNKNOWN,this._colorType=kr.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(ep(this);!this._end;){const n=this.readUint32(),r=this.readChars(4);this.decodeChunk(n,r)}return this.decodeImage(),this._png}decodeApng(){for(ep(this);!this._end;){const n=this.readUint32(),r=this.readChars(4);this.decodeApngChunk(n,r)}return this.decodeApngImage(),this._apng}decodeChunk(n,r){const a=this.offset;switch(r){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(n);break;case"IDAT":this.decodeIDAT(n);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(n);break;case"iCCP":this.decodeiCCP(n);break;case cy:py(this._png.text,this,n);break;case"pHYs":this.decodepHYs();break;default:this.skip(n);break}if(this.offset-a!==n)throw new Error(`Length mismatch while decoding chunk ${r}`);this._checkCrc?Zf(this,n+4,r):this.skip(4)}decodeApngChunk(n,r){const a=this.offset;switch(r!=="fdAT"&&r!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),r){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(n);break;default:this.decodeChunk(n,r),this.offset=a+n;break}if(this.offset-a!==n)throw new Error(`Length mismatch while decoding chunk ${r}`);this._checkCrc?Zf(this,n+4,r):this.skip(4)}decodeIHDR(){const n=this._png;n.width=this.readUint32(),n.height=this.readUint32(),n.depth=vy(this.readUint8());const r=this.readUint8();this._colorType=r;let a;switch(r){case kr.GREYSCALE:a=1;break;case kr.TRUECOLOUR:a=3;break;case kr.INDEXED_COLOUR:a=1;break;case kr.GREYSCALE_ALPHA:a=2;break;case kr.TRUECOLOUR_ALPHA:a=4;break;case kr.UNKNOWN:default:throw new Error(`Unknown color type: ${r}`)}if(this._png.channels=a,this._compressionMethod=this.readUint8(),this._compressionMethod!==pu.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const n={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(n)}decodePLTE(n){if(n%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${n}`);const r=n/3;this._hasPalette=!0;const a=[];this._palette=a;for(let i=0;i<r;i++)a.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(n){this._writingDataChunks=!0;const r=n,a=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,a,r)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(n)}decodeFDAT(n){this._writingDataChunks=!0;let r=n,a=this.offset+this.byteOffset;if(a+=4,r-=4,this._inflator.push(new Uint8Array(this.buffer,a,r)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(n)}decodetRNS(n){switch(this._colorType){case kr.GREYSCALE:case kr.TRUECOLOUR:{if(n%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${n}`);if(n/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${n/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(n/2);for(let r=0;r<n/2;r++)this._transparency[r]=this.readUint16();break}case kr.INDEXED_COLOUR:{if(n>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${n} vs ${this._palette.length})`);let r=0;for(;r<n;r++){const a=this.readByte();this._palette[r].push(a)}for(;r<this._palette.length;r++)this._palette[r].push(255);break}case kr.UNKNOWN:case kr.GREYSCALE_ALPHA:case kr.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(n){const r=Zg(this),a=this.readUint8();if(a!==pu.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${a}`);const i=this.readBytes(n-r.length-2);this._png.iccEmbeddedProfile={name:r,profile:V5(i)}}decodepHYs(){const n=this.readUint32(),r=this.readUint32(),a=this.readByte();this._png.resolution={x:n,y:r,unit:a}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let n=0;n<this._numberOfFrames;n++){const r={sequenceNumber:this._frames[n].sequenceNumber,delayNumber:this._frames[n].delayNumber,delayDenominator:this._frames[n].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},a=this._frames.at(n);if(a){if(a.data=Qf({data:a.data,width:a.width,height:a.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),n===0||a.xOffset===0&&a.yOffset===0&&a.width===this._png.width&&a.height===this._png.height)r.data=a.data;else{const i=this._apng.frames.at(n-1);this.disposeFrame(a,i,r),this.addFrameDataToCanvas(r,a)}this._apng.frames.push(r)}}return this._apng}disposeFrame(n,r,a){switch(n.disposeOp){case Al.NONE:break;case Al.BACKGROUND:for(let i=0;i<this._png.height;i++)for(let o=0;o<this._png.width;o++){const l=(i*n.width+o)*this._png.channels;for(let c=0;c<this._png.channels;c++)a.data[l+c]=0}break;case Al.PREVIOUS:a.data.set(r.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(n,r){const a=1<<this._png.depth,i=(o,l)=>{const c=((o+r.yOffset)*this._png.width+r.xOffset+l)*this._png.channels,u=(o*r.width+l)*this._png.channels;return{index:c,frameIndex:u}};switch(r.blendOp){case mu.SOURCE:for(let o=0;o<r.height;o++)for(let l=0;l<r.width;l++){const{index:c,frameIndex:u}=i(o,l);for(let h=0;h<this._png.channels;h++)n.data[c+h]=r.data[u+h]}break;case mu.OVER:for(let o=0;o<r.height;o++)for(let l=0;l<r.width;l++){const{index:c,frameIndex:u}=i(o,l);for(let h=0;h<this._png.channels;h++){const g=r.data[u+this._png.channels-1]/a,b=h%(this._png.channels-1)===0?1:r.data[u+h],p=Math.floor(g*b+(1-g)*n.data[c+h]);n.data[c+h]+=p}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var r;if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const n=this._isAnimated?((r=this._frames)==null?void 0:r.at(0)).data:this._inflator.result;if(this._filterMethod!==tp.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===gu.NO_INTERLACE)this._png.data=Qf({data:n,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===gu.ADAM7)this._png.data=ty({data:n,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const n=this._inflator.result,r=this._frames.at(-1);r?r.data=n:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:Al.NONE,blendOp:mu.SOURCE,data:n}),this._inflator=new Yf,this._writingDataChunks=!1}}function vy(t){if(t!==1&&t!==2&&t!==4&&t!==8&&t!==16)throw new Error(`invalid bit depth: ${t}`);return t}var np;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"})(np||(np={}));function by(t,e){return new my(t,e).decode()}var ft=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function vu(){ft.console&&typeof ft.console.log=="function"&&ft.console.log.apply(ft.console,arguments)}var Kt={log:vu,warn:function(t){ft.console&&(typeof ft.console.warn=="function"?ft.console.warn.apply(ft.console,arguments):vu.call(null,arguments))},error:function(t){ft.console&&(typeof ft.console.error=="function"?ft.console.error.apply(ft.console,arguments):vu(t))}};function bu(t,e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){Ia(r.response,e,n)},r.onerror=function(){Kt.error("could not download file")},r.send()}function rp(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function kl(t){try{t.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var Ia=ft.saveAs||((typeof window>"u"?"undefined":Ht(window))!=="object"||window!==ft?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(t,e,n){var r=ft.URL||ft.webkitURL,a=document.createElement("a");e=e||t.name||"download",a.download=e,a.rel="noopener",typeof t=="string"?(a.href=t,a.origin!==location.origin?rp(a.href)?bu(t,e,n):kl(a,a.target="_blank"):kl(a)):(a.href=r.createObjectURL(t),setTimeout(function(){r.revokeObjectURL(a.href)},4e4),setTimeout(function(){kl(a)},0))}:"msSaveOrOpenBlob"in navigator?function(t,e,n){if(e=e||t.name||"download",typeof t=="string")if(rp(t))bu(t,e,n);else{var r=document.createElement("a");r.href=t,r.target="_blank",setTimeout(function(){kl(r)})}else navigator.msSaveOrOpenBlob((function(a,i){return i===void 0?i={autoBom:!1}:Ht(i)!=="object"&&(Kt.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a})(t,n),e)}:function(t,e,n,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),typeof t=="string")return bu(t,e,n);var a=t.type==="application/octet-stream",i=/constructor/i.test(ft.HTMLElement)||ft.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent);if((o||a&&i)&&(typeof FileReader>"u"?"undefined":Ht(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var h=l.result;h=o?h:h.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=h:location=h,r=null},l.readAsDataURL(t)}else{var c=ft.URL||ft.webkitURL,u=c.createObjectURL(t);r?r.location=u:location.href=u,r=null,setTimeout(function(){c.revokeObjectURL(u)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function Qg(t){var e;t=t||"",this.ok=!1,t.charAt(0)=="#"&&(t=t.substr(1,6)),t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[t=(t=t.replace(/ /g,"")).toLowerCase()]||t;for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],r=0;r<n.length;r++){var a=n[r].re,i=n[r].process,o=a.exec(t);o&&(e=i(o),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),c=this.g.toString(16),u=this.b.toString(16);return l.length==1&&(l="0"+l),c.length==1&&(c="0"+c),u.length==1&&(u="0"+u),"#"+l+c+u}}var Ol=ft.atob.bind(ft),ip=ft.btoa.bind(ft);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function yu(t,e){var n=t[0],r=t[1],a=t[2],i=t[3];n=Jn(n,r,a,i,e[0],7,-680876936),i=Jn(i,n,r,a,e[1],12,-389564586),a=Jn(a,i,n,r,e[2],17,606105819),r=Jn(r,a,i,n,e[3],22,-1044525330),n=Jn(n,r,a,i,e[4],7,-176418897),i=Jn(i,n,r,a,e[5],12,1200080426),a=Jn(a,i,n,r,e[6],17,-1473231341),r=Jn(r,a,i,n,e[7],22,-45705983),n=Jn(n,r,a,i,e[8],7,1770035416),i=Jn(i,n,r,a,e[9],12,-1958414417),a=Jn(a,i,n,r,e[10],17,-42063),r=Jn(r,a,i,n,e[11],22,-1990404162),n=Jn(n,r,a,i,e[12],7,1804603682),i=Jn(i,n,r,a,e[13],12,-40341101),a=Jn(a,i,n,r,e[14],17,-1502002290),n=Yn(n,r=Jn(r,a,i,n,e[15],22,1236535329),a,i,e[1],5,-165796510),i=Yn(i,n,r,a,e[6],9,-1069501632),a=Yn(a,i,n,r,e[11],14,643717713),r=Yn(r,a,i,n,e[0],20,-373897302),n=Yn(n,r,a,i,e[5],5,-701558691),i=Yn(i,n,r,a,e[10],9,38016083),a=Yn(a,i,n,r,e[15],14,-660478335),r=Yn(r,a,i,n,e[4],20,-405537848),n=Yn(n,r,a,i,e[9],5,568446438),i=Yn(i,n,r,a,e[14],9,-1019803690),a=Yn(a,i,n,r,e[3],14,-187363961),r=Yn(r,a,i,n,e[8],20,1163531501),n=Yn(n,r,a,i,e[13],5,-1444681467),i=Yn(i,n,r,a,e[2],9,-51403784),a=Yn(a,i,n,r,e[7],14,1735328473),n=Xn(n,r=Yn(r,a,i,n,e[12],20,-1926607734),a,i,e[5],4,-378558),i=Xn(i,n,r,a,e[8],11,-2022574463),a=Xn(a,i,n,r,e[11],16,1839030562),r=Xn(r,a,i,n,e[14],23,-35309556),n=Xn(n,r,a,i,e[1],4,-1530992060),i=Xn(i,n,r,a,e[4],11,1272893353),a=Xn(a,i,n,r,e[7],16,-155497632),r=Xn(r,a,i,n,e[10],23,-1094730640),n=Xn(n,r,a,i,e[13],4,681279174),i=Xn(i,n,r,a,e[0],11,-358537222),a=Xn(a,i,n,r,e[3],16,-722521979),r=Xn(r,a,i,n,e[6],23,76029189),n=Xn(n,r,a,i,e[9],4,-640364487),i=Xn(i,n,r,a,e[12],11,-421815835),a=Xn(a,i,n,r,e[15],16,530742520),n=Zn(n,r=Xn(r,a,i,n,e[2],23,-995338651),a,i,e[0],6,-198630844),i=Zn(i,n,r,a,e[7],10,1126891415),a=Zn(a,i,n,r,e[14],15,-1416354905),r=Zn(r,a,i,n,e[5],21,-57434055),n=Zn(n,r,a,i,e[12],6,1700485571),i=Zn(i,n,r,a,e[3],10,-1894986606),a=Zn(a,i,n,r,e[10],15,-1051523),r=Zn(r,a,i,n,e[1],21,-2054922799),n=Zn(n,r,a,i,e[8],6,1873313359),i=Zn(i,n,r,a,e[15],10,-30611744),a=Zn(a,i,n,r,e[6],15,-1560198380),r=Zn(r,a,i,n,e[13],21,1309151649),n=Zn(n,r,a,i,e[4],6,-145523070),i=Zn(i,n,r,a,e[11],10,-1120210379),a=Zn(a,i,n,r,e[2],15,718787259),r=Zn(r,a,i,n,e[9],21,-343485551),t[0]=ca(n,t[0]),t[1]=ca(r,t[1]),t[2]=ca(a,t[2]),t[3]=ca(i,t[3])}function uc(t,e,n,r,a,i){return e=ca(ca(e,t),ca(r,i)),ca(e<<a|e>>>32-a,n)}function Jn(t,e,n,r,a,i,o){return uc(e&n|~e&r,t,e,a,i,o)}function Yn(t,e,n,r,a,i,o){return uc(e&r|n&~r,t,e,a,i,o)}function Xn(t,e,n,r,a,i,o){return uc(e^n^r,t,e,a,i,o)}function Zn(t,e,n,r,a,i,o){return uc(n^(e|~r),t,e,a,i,o)}function em(t){var e,n=t.length,r=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)yu(r,yy(t.substring(e-64,e)));t=t.substring(e-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)a[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(a[e>>2]|=128<<(e%4<<3),e>55)for(yu(r,a),e=0;e<16;e++)a[e]=0;return a[14]=8*n,yu(r,a),r}function yy(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}var ap="0123456789abcdef".split("");function _y(t){for(var e="",n=0;n<4;n++)e+=ap[t>>8*n+4&15]+ap[t>>8*n&15];return e}function wy(t){return String.fromCharCode(255&t,(65280&t)>>8,(16711680&t)>>16,(4278190080&t)>>24)}function nd(t){return em(t).map(wy).join("")}var xy=(function(t){for(var e=0;e<t.length;e++)t[e]=_y(t[e]);return t.join("")})(em("hello"))!="5d41402abc4b2a76b9719d911017c592";function ca(t,e){if(xy){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}return t+e&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function rd(t,e){var n,r,a,i;if(t!==n){for(var o=(a=t,i=1+(256/t.length|0),new Array(i+1).join(a)),l=[],c=0;c<256;c++)l[c]=c;var u=0;for(c=0;c<256;c++){var h=l[c];u=(u+h+o.charCodeAt(c))%256,l[c]=l[u],l[u]=h}n=t,r=l}else l=r;var g=e.length,b=0,p=0,y="";for(c=0;c<g;c++)p=(p+(h=l[b=(b+1)%256]))%256,l[b]=l[p],l[p]=h,o=l[(l[b]+l[p])%256],y+=String.fromCharCode(e.charCodeAt(c)^o);return y}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var sp={print:4,modify:8,copy:16,"annot-forms":32};function fs(t,e,n,r){this.v=1,this.r=2;var a=192;t.forEach(function(l){if(sp.perm!==void 0)throw new Error("Invalid permission: "+l);a+=sp[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var i=(e+this.padding).substr(0,32),o=(n+this.padding).substr(0,32);this.O=this.processOwnerPassword(i,o),this.P=-(1+(255^a)),this.encryptionKey=nd(i+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=rd(this.encryptionKey,this.padding)}function ps(t){if(/[^\u0000-\u00ff]/.test(t))throw new Error("Invalid PDF Name Object: "+t+", Only accept ASCII characters.");for(var e="",n=t.length,r=0;r<n;r++){var a=t.charCodeAt(r);e+=a<33||a===35||a===37||a===40||a===41||a===47||a===60||a===62||a===91||a===93||a===123||a===125||a>126?"#"+("0"+a.toString(16)).slice(-2):t[r]}return e}function op(t){if(Ht(t)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(n,r,a){if(a=a||!1,typeof n!="string"||typeof r!="function"||typeof a!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(n)||(e[n]={});var i=Math.random().toString(35);return e[n][i]=[r,!!a],i},this.unsubscribe=function(n){for(var r in e)if(e[r][n])return delete e[r][n],Object.keys(e[r]).length===0&&delete e[r],!0;return!1},this.publish=function(n){if(e.hasOwnProperty(n)){var r=Array.prototype.slice.call(arguments,1),a=[];for(var i in e[n]){var o=e[n][i];try{o[0].apply(t,r)}catch(l){ft.console&&Kt.error("jsPDF PubSub Error",l.message,l)}o[1]&&a.push(i)}a.length&&a.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function Yl(t){if(!(this instanceof Yl))return new Yl(t);var e="opacity,stroke-opacity".split(",");for(var n in t)t.hasOwnProperty(n)&&e.indexOf(n)>=0&&(this[n]=t[n]);this.id="",this.objectNumber=-1}function tm(t,e){this.gState=t,this.matrix=e,this.id="",this.objectNumber=-1}function Da(t,e,n,r,a){if(!(this instanceof Da))return new Da(t,e,n,r,a);this.type=t==="axial"?2:3,this.coords=e,this.colors=n,tm.call(this,r,a)}function ms(t,e,n,r,a){if(!(this instanceof ms))return new ms(t,e,n,r,a);this.boundingBox=t,this.xStep=e,this.yStep=n,this.stream="",this.cloneIndex=0,tm.call(this,r,a)}function Xe(t){var e,n=typeof arguments[0]=="string"?arguments[0]:"p",r=arguments[1],a=arguments[2],i=arguments[3],o=[],l=1,c=16,u="S",h=null;Ht(t=t||{})==="object"&&(n=t.orientation,r=t.unit||r,a=t.format||a,i=t.compress||t.compressPdf||i,(h=t.encryption||null)!==null&&(h.userPassword=h.userPassword||"",h.ownerPassword=h.ownerPassword||"",h.userPermissions=h.userPermissions||[]),l=typeof t.userUnit=="number"?Math.abs(t.userUnit):1,t.precision!==void 0&&(e=t.precision),t.floatPrecision!==void 0&&(c=t.floatPrecision),u=t.defaultPathOperation||"S"),o=t.filters||(i===!0?["FlateEncode"]:o),r=r||"mm",n=(""+(n||"P")).toLowerCase();var g=t.putOnlyUsedFonts||!1,b={},p={internal:{},__private__:{}};p.__private__.PubSub=op;var y="1.3",_=p.__private__.getPdfVersion=function(){return y};p.__private__.setPdfVersion=function(m){y=m};var S={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};p.__private__.getPageFormats=function(){return S};var x=p.__private__.getPageFormat=function(m){return S[m]};a=a||"a4";var T="compat",O="advanced",E=T;function M(){this.saveGraphicsState(),U(new rt(mt,0,0,-mt,0,ba()*mt).toString()+" cm"),this.setFontSize(this.getFontSize()/mt),u="n",E=O}function ee(){this.restoreGraphicsState(),u="S",E=T}var G=p.__private__.combineFontStyleAndFontWeight=function(m,N){if(m=="bold"&&N=="normal"||m=="bold"&&N==400||m=="normal"&&N=="italic"||m=="bold"&&N=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return N&&(m=N==400||N==="normal"?m==="italic"?"italic":"normal":N!=700&&N!=="bold"||m!=="normal"?(N==700?"bold":N)+""+m:"bold"),m};p.advancedAPI=function(m){var N=E===T;return N&&M.call(this),typeof m!="function"||(m(this),N&&ee.call(this)),this},p.compatAPI=function(m){var N=E===O;return N&&ee.call(this),typeof m!="function"||(m(this),N&&M.call(this)),this},p.isAdvancedAPI=function(){return E===O};var X,F=function(m){if(E!==O)throw new Error(m+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},I=p.roundToPrecision=p.__private__.roundToPrecision=function(m,N){var W=e||N;if(isNaN(m)||isNaN(W))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return m.toFixed(W).replace(/0+$/,"")};X=p.hpf=p.__private__.hpf=typeof c=="number"?function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.hpf");return I(m,c)}:c==="smart"?function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.hpf");return I(m,m>-1&&m<1?16:5)}:function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.hpf");return I(m,16)};var k=p.f2=p.__private__.f2=function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.f2");return I(m,2)},A=p.__private__.f3=function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.f3");return I(m,3)},j=p.scale=p.__private__.scale=function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.scale");return E===T?m*mt:E===O?m:void 0},q=function(m){return j((function(N){return E===T?ba()-N:E===O?N:void 0})(m))};p.__private__.setPrecision=p.setPrecision=function(m){typeof parseInt(m,10)=="number"&&(e=parseInt(m,10))};var K,le="00000000000000000000000000000000",ue=p.__private__.getFileId=function(){return le},ae=p.__private__.setFileId=function(m){return le=m!==void 0&&/^[a-fA-F0-9]{32}$/.test(m)?m.toUpperCase():le.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),h!==null&&(Tn=new fs(h.userPermissions,h.userPassword,h.ownerPassword,le)),le};p.setFileId=function(m){return ae(m),this},p.getFileId=function(){return ue()};var ge=p.__private__.convertDateToPDFDate=function(m){var N=m.getTimezoneOffset(),W=N<0?"+":"-",Q=Math.floor(Math.abs(N/60)),oe=Math.abs(N%60),_e=[W,V(Q),"'",V(oe),"'"].join("");return["D:",m.getFullYear(),V(m.getMonth()+1),V(m.getDate()),V(m.getHours()),V(m.getMinutes()),V(m.getSeconds()),_e].join("")},xe=p.__private__.convertPDFDateToDate=function(m){var N=parseInt(m.substr(2,4),10),W=parseInt(m.substr(6,2),10)-1,Q=parseInt(m.substr(8,2),10),oe=parseInt(m.substr(10,2),10),_e=parseInt(m.substr(12,2),10),Ae=parseInt(m.substr(14,2),10);return new Date(N,W,Q,oe,_e,Ae,0)},pe=p.__private__.setCreationDate=function(m){var N;if(m===void 0&&(m=new Date),m instanceof Date)N=ge(m);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(m))throw new Error("Invalid argument passed to jsPDF.setCreationDate");N=m}return K=N},C=p.__private__.getCreationDate=function(m){var N=K;return m==="jsDate"&&(N=xe(K)),N};p.setCreationDate=function(m){return pe(m),this},p.getCreationDate=function(m){return C(m)};var $,V=p.__private__.padd2=function(m){return("0"+parseInt(m)).slice(-2)},J=p.__private__.padd2Hex=function(m){return("00"+(m=m.toString())).substr(m.length)},Z=0,ie=[],fe=[],Y=0,se=[],be=[],Ce=!1,Te=fe;p.__private__.setCustomOutputDestination=function(m){Ce=!0,Te=m};var De=function(m){Ce||(Te=m)};p.__private__.resetCustomOutputDestination=function(){Ce=!1,Te=fe};var U=p.__private__.out=function(m){return m=m.toString(),Y+=m.length+1,Te.push(m),Te},Pe=p.__private__.write=function(m){return U(arguments.length===1?m.toString():Array.prototype.join.call(arguments," "))},ht=p.__private__.getArrayBuffer=function(m){for(var N=m.length,W=new ArrayBuffer(N),Q=new Uint8Array(W);N--;)Q[N]=m.charCodeAt(N);return W},He=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];p.__private__.getStandardFonts=function(){return He};var Se=t.fontSize||16;p.__private__.setFontSize=p.setFontSize=function(m){return Se=E===O?m/mt:m,this};var Ke,Re=p.__private__.getFontSize=p.getFontSize=function(){return E===T?Se:Se*mt},Qe=t.R2L||!1;p.__private__.setR2L=p.setR2L=function(m){return Qe=m,this},p.__private__.getR2L=p.getR2L=function(){return Qe};var Ie,it=p.__private__.setZoomMode=function(m){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(m))Ke=m;else if(isNaN(m)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(m)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+m+'" is not recognized.');Ke=m}else Ke=parseInt(m,10)};p.__private__.getZoomMode=function(){return Ke};var nt,at=p.__private__.setPageMode=function(m){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(m)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+m+'" is not recognized.');Ie=m};p.__private__.getPageMode=function(){return Ie};var ut=p.__private__.setLayoutMode=function(m){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(m)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+m+'" is not recognized.');nt=m};p.__private__.getLayoutMode=function(){return nt},p.__private__.setDisplayMode=p.setDisplayMode=function(m,N,W){return it(m),ut(N),at(W),this};var pt={title:"",subject:"",author:"",keywords:"",creator:""};p.__private__.getDocumentProperty=function(m){if(Object.keys(pt).indexOf(m)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return pt[m]},p.__private__.getDocumentProperties=function(){return pt},p.__private__.setDocumentProperties=p.setProperties=p.setDocumentProperties=function(m){for(var N in pt)pt.hasOwnProperty(N)&&m[N]&&(pt[N]=m[N]);return this},p.__private__.setDocumentProperty=function(m,N){if(Object.keys(pt).indexOf(m)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return pt[m]=N};var ze,mt,We,rn,Et,bt={},ct={},Dt=[],et={},jt={},st={},dt={},Ut=null,kt=0,tt=[],Ft=new op(p),yi=t.hotfixes||[],Ct={},Vn={},Tr=[],rt=function m(N,W,Q,oe,_e,Ae){if(!(this instanceof m))return new m(N,W,Q,oe,_e,Ae);isNaN(N)&&(N=1),isNaN(W)&&(W=0),isNaN(Q)&&(Q=0),isNaN(oe)&&(oe=1),isNaN(_e)&&(_e=0),isNaN(Ae)&&(Ae=0),this._matrix=[N,W,Q,oe,_e,Ae]};Object.defineProperty(rt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(m){this._matrix[0]=m}}),Object.defineProperty(rt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(m){this._matrix[1]=m}}),Object.defineProperty(rt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(m){this._matrix[2]=m}}),Object.defineProperty(rt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(m){this._matrix[3]=m}}),Object.defineProperty(rt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(m){this._matrix[4]=m}}),Object.defineProperty(rt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(m){this._matrix[5]=m}}),Object.defineProperty(rt.prototype,"a",{get:function(){return this._matrix[0]},set:function(m){this._matrix[0]=m}}),Object.defineProperty(rt.prototype,"b",{get:function(){return this._matrix[1]},set:function(m){this._matrix[1]=m}}),Object.defineProperty(rt.prototype,"c",{get:function(){return this._matrix[2]},set:function(m){this._matrix[2]=m}}),Object.defineProperty(rt.prototype,"d",{get:function(){return this._matrix[3]},set:function(m){this._matrix[3]=m}}),Object.defineProperty(rt.prototype,"e",{get:function(){return this._matrix[4]},set:function(m){this._matrix[4]=m}}),Object.defineProperty(rt.prototype,"f",{get:function(){return this._matrix[5]},set:function(m){this._matrix[5]=m}}),Object.defineProperty(rt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(rt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(rt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(rt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),rt.prototype.join=function(m){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(X).join(m)},rt.prototype.multiply=function(m){var N=m.sx*this.sx+m.shy*this.shx,W=m.sx*this.shy+m.shy*this.sy,Q=m.shx*this.sx+m.sy*this.shx,oe=m.shx*this.shy+m.sy*this.sy,_e=m.tx*this.sx+m.ty*this.shx+this.tx,Ae=m.tx*this.shy+m.ty*this.sy+this.ty;return new rt(N,W,Q,oe,_e,Ae)},rt.prototype.decompose=function(){var m=this.sx,N=this.shy,W=this.shx,Q=this.sy,oe=this.tx,_e=this.ty,Ae=Math.sqrt(m*m+N*N),$e=(m/=Ae)*W+(N/=Ae)*Q;W-=m*$e,Q-=N*$e;var Je=Math.sqrt(W*W+Q*Q);return $e/=Je,m*(Q/=Je)<N*(W/=Je)&&(m=-m,N=-N,$e=-$e,Ae=-Ae),{scale:new rt(Ae,0,0,Je,0,0),translate:new rt(1,0,0,1,oe,_e),rotate:new rt(m,N,-N,m,0,0),skew:new rt(1,0,$e,1,0,0)}},rt.prototype.toString=function(m){return this.join(" ")},rt.prototype.inversed=function(){var m=this.sx,N=this.shy,W=this.shx,Q=this.sy,oe=this.tx,_e=this.ty,Ae=1/(m*Q-N*W),$e=Q*Ae,Je=-N*Ae,gt=-W*Ae,wt=m*Ae;return new rt($e,Je,gt,wt,-$e*oe-gt*_e,-Je*oe-wt*_e)},rt.prototype.applyToPoint=function(m){var N=m.x*this.sx+m.y*this.shx+this.tx,W=m.x*this.shy+m.y*this.sy+this.ty;return new Ai(N,W)},rt.prototype.applyToRectangle=function(m){var N=this.applyToPoint(m),W=this.applyToPoint(new Ai(m.x+m.w,m.y+m.h));return new Os(N.x,N.y,W.x-N.x,W.y-N.y)},rt.prototype.clone=function(){var m=this.sx,N=this.shy,W=this.shx,Q=this.sy,oe=this.tx,_e=this.ty;return new rt(m,N,W,Q,oe,_e)},p.Matrix=rt;var mr=p.matrixMult=function(m,N){return N.multiply(m)},Pr=new rt(1,0,0,1,0,0);p.unitMatrix=p.identityMatrix=Pr;var er=function(m,N){if(!jt[m]){var W=(N instanceof Da?"Sh":"P")+(Object.keys(et).length+1).toString(10);N.id=W,jt[m]=W,et[W]=N,Ft.publish("addPattern",N)}};p.ShadingPattern=Da,p.TilingPattern=ms,p.addShadingPattern=function(m,N){return F("addShadingPattern()"),er(m,N),this},p.beginTilingPattern=function(m){F("beginTilingPattern()"),Rs(m.boundingBox[0],m.boundingBox[1],m.boundingBox[2]-m.boundingBox[0],m.boundingBox[3]-m.boundingBox[1],m.matrix)},p.endTilingPattern=function(m,N){F("endTilingPattern()"),N.stream=be[$].join(`
`),er(m,N),Ft.publish("endTilingPattern",N),Tr.pop().restore()};var cr,It=p.__private__.newObject=function(){var m=Yt();return xn(m,!0),m},Yt=p.__private__.newObjectDeferred=function(){return Z++,ie[Z]=function(){return Y},Z},xn=function(m,N){return N=typeof N=="boolean"&&N,ie[m]=Y,N&&U(m+" 0 obj"),m},ii=p.__private__.newAdditionalObject=function(){var m={objId:Yt(),content:""};return se.push(m),m},Ir=Yt(),ur=Yt(),Sn=p.__private__.decodeColorString=function(m){var N=m.split(" ");if(N.length!==2||N[1]!=="g"&&N[1]!=="G")N.length!==5||N[4]!=="k"&&N[4]!=="K"||(N=[(1-N[0])*(1-N[3]),(1-N[1])*(1-N[3]),(1-N[2])*(1-N[3]),"r"]);else{var W=parseFloat(N[0]);N=[W,W,W,"r"]}for(var Q="#",oe=0;oe<3;oe++)Q+=("0"+Math.floor(255*parseFloat(N[oe])).toString(16)).slice(-2);return Q},dr=p.__private__.encodeColorString=function(m){var N;typeof m=="string"&&(m={ch1:m});var W=m.ch1,Q=m.ch2,oe=m.ch3,_e=m.ch4,Ae=m.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof W=="string"&&W.charAt(0)!=="#"){var $e=new Qg(W);if($e.ok)W=$e.toHex();else if(!/^\d*\.?\d*$/.test(W))throw new Error('Invalid color "'+W+'" passed to jsPDF.encodeColorString.')}if(typeof W=="string"&&/^#[0-9A-Fa-f]{3}$/.test(W)&&(W="#"+W[1]+W[1]+W[2]+W[2]+W[3]+W[3]),typeof W=="string"&&/^#[0-9A-Fa-f]{6}$/.test(W)){var Je=parseInt(W.substr(1),16);W=Je>>16&255,Q=Je>>8&255,oe=255&Je}if(Q===void 0||_e===void 0&&W===Q&&Q===oe)N=typeof W=="string"?W+" "+Ae[0]:m.precision===2?k(W/255)+" "+Ae[0]:A(W/255)+" "+Ae[0];else if(_e===void 0||Ht(_e)==="object"){if(_e&&!isNaN(_e.a)&&_e.a===0)return["1.","1.","1.",Ae[1]].join(" ");N=typeof W=="string"?[W,Q,oe,Ae[1]].join(" "):m.precision===2?[k(W/255),k(Q/255),k(oe/255),Ae[1]].join(" "):[A(W/255),A(Q/255),A(oe/255),Ae[1]].join(" ")}else N=typeof W=="string"?[W,Q,oe,_e,Ae[2]].join(" "):m.precision===2?[k(W),k(Q),k(oe),k(_e),Ae[2]].join(" "):[A(W),A(Q),A(oe),A(_e),Ae[2]].join(" ");return N},hr=p.__private__.getFilters=function(){return o},tr=p.__private__.putStream=function(m){var N=(m=m||{}).data||"",W=m.filters||hr(),Q=m.alreadyAppliedFilters||[],oe=m.addLength1||!1,_e=N.length,Ae=m.objectId,$e=function(Pn){return Pn};if(h!==null&&Ae===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");h!==null&&($e=Tn.encryptor(Ae,0));var Je={};W===!0&&(W=["FlateEncode"]);var gt=m.additionalKeyValues||[],wt=(Je=Xe.API.processDataByFilters!==void 0?Xe.API.processDataByFilters(N,W):{data:N,reverseChain:[]}).reverseChain+(Array.isArray(Q)?Q.join(" "):Q.toString());if(Je.data.length!==0&&(gt.push({key:"Length",value:Je.data.length}),oe===!0&&gt.push({key:"Length1",value:_e})),wt.length!=0)if(wt.split("/").length-1==1)gt.push({key:"Filter",value:wt});else{gt.push({key:"Filter",value:"["+wt+"]"});for(var Ot=0;Ot<gt.length;Ot+=1)if(gt[Ot].key==="DecodeParms"){for(var on=[],kn=0;kn<Je.reverseChain.split("/").length-1;kn+=1)on.push("null");on.push(gt[Ot].value),gt[Ot].value="["+on.join(" ")+"]"}}U("<<");for(var Xt=0;Xt<gt.length;Xt++)U("/"+gt[Xt].key+" "+gt[Xt].value);U(">>"),Je.data.length!==0&&(U("stream"),U($e(Je.data)),U("endstream"))},ai=p.__private__.putPage=function(m){var N=m.number,W=m.data,Q=m.objId,oe=m.contentsObjId;xn(Q,!0),U("<</Type /Page"),U("/Parent "+m.rootDictionaryObjId+" 0 R"),U("/Resources "+m.resourceDictionaryObjId+" 0 R"),U("/MediaBox ["+parseFloat(X(m.mediaBox.bottomLeftX))+" "+parseFloat(X(m.mediaBox.bottomLeftY))+" "+X(m.mediaBox.topRightX)+" "+X(m.mediaBox.topRightY)+"]"),m.cropBox!==null&&U("/CropBox ["+X(m.cropBox.bottomLeftX)+" "+X(m.cropBox.bottomLeftY)+" "+X(m.cropBox.topRightX)+" "+X(m.cropBox.topRightY)+"]"),m.bleedBox!==null&&U("/BleedBox ["+X(m.bleedBox.bottomLeftX)+" "+X(m.bleedBox.bottomLeftY)+" "+X(m.bleedBox.topRightX)+" "+X(m.bleedBox.topRightY)+"]"),m.trimBox!==null&&U("/TrimBox ["+X(m.trimBox.bottomLeftX)+" "+X(m.trimBox.bottomLeftY)+" "+X(m.trimBox.topRightX)+" "+X(m.trimBox.topRightY)+"]"),m.artBox!==null&&U("/ArtBox ["+X(m.artBox.bottomLeftX)+" "+X(m.artBox.bottomLeftY)+" "+X(m.artBox.topRightX)+" "+X(m.artBox.topRightY)+"]"),typeof m.userUnit=="number"&&m.userUnit!==1&&U("/UserUnit "+m.userUnit),Ft.publish("putPage",{objId:Q,pageContext:tt[N],pageNumber:N,page:W}),U("/Contents "+oe+" 0 R"),U(">>"),U("endobj");var _e=W.join(`
`);return E===O&&(_e+=`
Q`),xn(oe,!0),tr({data:_e,filters:hr(),objectId:oe}),U("endobj"),Q},Or=p.__private__.putPages=function(){var m,N,W=[];for(m=1;m<=kt;m++)tt[m].objId=Yt(),tt[m].contentsObjId=Yt();for(m=1;m<=kt;m++)W.push(ai({number:m,data:be[m],objId:tt[m].objId,contentsObjId:tt[m].contentsObjId,mediaBox:tt[m].mediaBox,cropBox:tt[m].cropBox,bleedBox:tt[m].bleedBox,trimBox:tt[m].trimBox,artBox:tt[m].artBox,userUnit:tt[m].userUnit,rootDictionaryObjId:Ir,resourceDictionaryObjId:ur}));xn(Ir,!0),U("<</Type /Pages");var Q="/Kids [";for(N=0;N<kt;N++)Q+=W[N]+" 0 R ";U(Q+"]"),U("/Count "+kt),U(">>"),U("endobj"),Ft.publish("postPutPages")},Ue=function(m){Ft.publish("putFont",{font:m,out:U,newObject:It,putStream:tr}),m.isAlreadyPutted!==!0&&(m.objectNumber=It(),U("<<"),U("/Type /Font"),U("/BaseFont /"+ps(m.postScriptName)),U("/Subtype /Type1"),typeof m.encoding=="string"&&U("/Encoding /"+m.encoding),U("/FirstChar 32"),U("/LastChar 255"),U(">>"),U("endobj"))},te=function(m){m.objectNumber=It();var N=[];N.push({key:"Type",value:"/XObject"}),N.push({key:"Subtype",value:"/Form"}),N.push({key:"BBox",value:"["+[X(m.x),X(m.y),X(m.x+m.width),X(m.y+m.height)].join(" ")+"]"}),N.push({key:"Matrix",value:"["+m.matrix.toString()+"]"});var W=m.pages[1].join(`
`);tr({data:W,additionalKeyValues:N,objectId:m.objectNumber}),U("endobj")},Ee=function(m,N){N||(N=21);var W=It(),Q=(function(Ae,$e){var Je,gt=[],wt=1/($e-1);for(Je=0;Je<1;Je+=wt)gt.push(Je);if(gt.push(1),Ae[0].offset!=0){var Ot={offset:0,color:Ae[0].color};Ae.unshift(Ot)}if(Ae[Ae.length-1].offset!=1){var on={offset:1,color:Ae[Ae.length-1].color};Ae.push(on)}for(var kn="",Xt=0,Pn=0;Pn<gt.length;Pn++){for(Je=gt[Pn];Je>Ae[Xt+1].offset;)Xt++;var Nn=Ae[Xt].offset,Mn=(Je-Nn)/(Ae[Xt+1].offset-Nn),Ei=Ae[Xt].color,Hr=Ae[Xt+1].color;kn+=J(Math.round((1-Mn)*Ei[0]+Mn*Hr[0]).toString(16))+J(Math.round((1-Mn)*Ei[1]+Mn*Hr[1]).toString(16))+J(Math.round((1-Mn)*Ei[2]+Mn*Hr[2]).toString(16))}return kn.trim()})(m.colors,N),oe=[];oe.push({key:"FunctionType",value:"0"}),oe.push({key:"Domain",value:"[0.0 1.0]"}),oe.push({key:"Size",value:"["+N+"]"}),oe.push({key:"BitsPerSample",value:"8"}),oe.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),oe.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),tr({data:Q,additionalKeyValues:oe,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:W}),U("endobj"),m.objectNumber=It(),U("<< /ShadingType "+m.type),U("/ColorSpace /DeviceRGB");var _e="/Coords ["+X(parseFloat(m.coords[0]))+" "+X(parseFloat(m.coords[1]))+" ";m.type===2?_e+=X(parseFloat(m.coords[2]))+" "+X(parseFloat(m.coords[3])):_e+=X(parseFloat(m.coords[2]))+" "+X(parseFloat(m.coords[3]))+" "+X(parseFloat(m.coords[4]))+" "+X(parseFloat(m.coords[5])),U(_e+="]"),m.matrix&&U("/Matrix ["+m.matrix.toString()+"]"),U("/Function "+W+" 0 R"),U("/Extend [true true]"),U(">>"),U("endobj")},Fe=function(m,N){var W=Yt(),Q=It();N.push({resourcesOid:W,objectOid:Q}),m.objectNumber=Q;var oe=[];oe.push({key:"Type",value:"/Pattern"}),oe.push({key:"PatternType",value:"1"}),oe.push({key:"PaintType",value:"1"}),oe.push({key:"TilingType",value:"1"}),oe.push({key:"BBox",value:"["+m.boundingBox.map(X).join(" ")+"]"}),oe.push({key:"XStep",value:X(m.xStep)}),oe.push({key:"YStep",value:X(m.yStep)}),oe.push({key:"Resources",value:W+" 0 R"}),m.matrix&&oe.push({key:"Matrix",value:"["+m.matrix.toString()+"]"}),tr({data:m.stream,additionalKeyValues:oe,objectId:m.objectNumber}),U("endobj")},Wt=function(m){for(var N in m.objectNumber=It(),U("<<"),m)switch(N){case"opacity":U("/ca "+k(m[N]));break;case"stroke-opacity":U("/CA "+k(m[N]))}U(">>"),U("endobj")},cn=function(m){xn(m.resourcesOid,!0),U("<<"),U("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var N in U("/Font <<"),bt)bt.hasOwnProperty(N)&&(g===!1||g===!0&&b.hasOwnProperty(N))&&U("/"+N+" "+bt[N].objectNumber+" 0 R");U(">>")})(),(function(){if(Object.keys(et).length>0){for(var N in U("/Shading <<"),et)et.hasOwnProperty(N)&&et[N]instanceof Da&&et[N].objectNumber>=0&&U("/"+N+" "+et[N].objectNumber+" 0 R");Ft.publish("putShadingPatternDict"),U(">>")}})(),(function(N){if(Object.keys(et).length>0){for(var W in U("/Pattern <<"),et)et.hasOwnProperty(W)&&et[W]instanceof p.TilingPattern&&et[W].objectNumber>=0&&et[W].objectNumber<N&&U("/"+W+" "+et[W].objectNumber+" 0 R");Ft.publish("putTilingPatternDict"),U(">>")}})(m.objectOid),(function(){if(Object.keys(st).length>0){var N;for(N in U("/ExtGState <<"),st)st.hasOwnProperty(N)&&st[N].objectNumber>=0&&U("/"+N+" "+st[N].objectNumber+" 0 R");Ft.publish("putGStateDict"),U(">>")}})(),(function(){for(var N in U("/XObject <<"),Ct)Ct.hasOwnProperty(N)&&Ct[N].objectNumber>=0&&U("/"+N+" "+Ct[N].objectNumber+" 0 R");Ft.publish("putXobjectDict"),U(">>")})(),U(">>"),U("endobj")},en=function(m){ct[m.fontName]=ct[m.fontName]||{},ct[m.fontName][m.fontStyle]=m.id},Cn=function(m,N,W,Q,oe){var _e={id:"F"+(Object.keys(bt).length+1).toString(10),postScriptName:m,fontName:N,fontStyle:W,encoding:Q,isStandardFont:oe||!1,metadata:{}};return Ft.publish("addFont",{font:_e,instance:this}),bt[_e.id]=_e,en(_e),_e.id},un=p.__private__.pdfEscape=p.pdfEscape=function(m,N){return(function(W,Q){var oe,_e,Ae,$e,Je,gt,wt,Ot,on;if(Ae=(Q=Q||{}).sourceEncoding||"Unicode",Je=Q.outputEncoding,(Q.autoencode||Je)&&bt[ze].metadata&&bt[ze].metadata[Ae]&&bt[ze].metadata[Ae].encoding&&($e=bt[ze].metadata[Ae].encoding,!Je&&bt[ze].encoding&&(Je=bt[ze].encoding),!Je&&$e.codePages&&(Je=$e.codePages[0]),typeof Je=="string"&&(Je=$e[Je]),Je)){for(wt=!1,gt=[],oe=0,_e=W.length;oe<_e;oe++)(Ot=Je[W.charCodeAt(oe)])?gt.push(String.fromCharCode(Ot)):gt.push(W[oe]),gt[oe].charCodeAt(0)>>8&&(wt=!0);W=gt.join("")}for(oe=W.length;wt===void 0&&oe!==0;)W.charCodeAt(oe-1)>>8&&(wt=!0),oe--;if(!wt)return W;for(gt=Q.noBOM?[]:[254,255],oe=0,_e=W.length;oe<_e;oe++){if((on=(Ot=W.charCodeAt(oe))>>8)>>8)throw new Error("Character at position "+oe+" of string '"+W+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");gt.push(on),gt.push(Ot-(on<<8))}return String.fromCharCode.apply(void 0,gt)})(m,N).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Rr=p.__private__.beginPage=function(m){be[++kt]=[],tt[kt]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(m[0]),topRightY:Number(m[1])}},ha(kt),De(be[$])},$i=function(m,N){var W,Q,oe;switch(n=N||n,typeof m=="string"&&(W=x(m.toLowerCase()),Array.isArray(W)&&(Q=W[0],oe=W[1])),Array.isArray(m)&&(Q=m[0]*mt,oe=m[1]*mt),isNaN(Q)&&(Q=a[0],oe=a[1]),(Q>14400||oe>14400)&&(Kt.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Q=Math.min(14400,Q),oe=Math.min(14400,oe)),a=[Q,oe],n.substr(0,1)){case"l":oe>Q&&(a=[oe,Q]);break;case"p":Q>oe&&(a=[oe,Q])}Rr(a),vt(Cs),U(Ka),Ps!==0&&U(Ps+" J"),Is!==0&&U(Is+" j"),Ft.publish("addPage",{pageNumber:kt})},sn=function(m){m>0&&m<=kt&&(be.splice(m,1),tt.splice(m,1),kt--,$>kt&&($=kt),this.setPage($))},ha=function(m){m>0&&m<=kt&&($=m)},fa=p.__private__.getNumberOfPages=p.getNumberOfPages=function(){return be.length-1},Io=function(m,N,W){var Q,oe=void 0;return W=W||{},m=m!==void 0?m:bt[ze].fontName,N=N!==void 0?N:bt[ze].fontStyle,Q=m.toLowerCase(),ct[Q]!==void 0&&ct[Q][N]!==void 0?oe=ct[Q][N]:ct[m]!==void 0&&ct[m][N]!==void 0?oe=ct[m][N]:W.disableWarning===!1&&Kt.warn("Unable to look up font label for font '"+m+"', '"+N+"'. Refer to getFontList() for available fonts."),oe||W.noFallback||(oe=ct.times[N])==null&&(oe=ct.times.normal),oe},si=p.__private__.putInfo=function(){var m=It(),N=function(Q){return Q};for(var W in h!==null&&(N=Tn.encryptor(m,0)),U("<<"),U("/Producer ("+un(N("jsPDF "+Xe.version))+")"),pt)pt.hasOwnProperty(W)&&pt[W]&&U("/"+W.substr(0,1).toUpperCase()+W.substr(1)+" ("+un(N(pt[W]))+")");U("/CreationDate ("+un(N(K))+")"),U(">>"),U("endobj")},Wa=p.__private__.putCatalog=function(m){var N=(m=m||{}).rootDictionaryObjId||Ir;switch(It(),U("<<"),U("/Type /Catalog"),U("/Pages "+N+" 0 R"),Ke||(Ke="fullwidth"),Ke){case"fullwidth":U("/OpenAction [3 0 R /FitH null]");break;case"fullheight":U("/OpenAction [3 0 R /FitV null]");break;case"fullpage":U("/OpenAction [3 0 R /Fit]");break;case"original":U("/OpenAction [3 0 R /XYZ null null 1]");break;default:var W=""+Ke;W.substr(W.length-1)==="%"&&(Ke=parseInt(Ke)/100),typeof Ke=="number"&&U("/OpenAction [3 0 R /XYZ null null "+k(Ke)+"]")}switch(nt||(nt="continuous"),nt){case"continuous":U("/PageLayout /OneColumn");break;case"single":U("/PageLayout /SinglePage");break;case"two":case"twoleft":U("/PageLayout /TwoColumnLeft");break;case"tworight":U("/PageLayout /TwoColumnRight")}Ie&&U("/PageMode /"+Ie),Ft.publish("putCatalog"),U(">>"),U("endobj")},dc=p.__private__.putTrailer=function(){U("trailer"),U("<<"),U("/Size "+(Z+1)),U("/Root "+Z+" 0 R"),U("/Info "+(Z-1)+" 0 R"),h!==null&&U("/Encrypt "+Tn.oid+" 0 R"),U("/ID [ <"+le+"> <"+le+"> ]"),U(">>")},An=p.__private__.putHeader=function(){U("%PDF-"+y),U("%")},Oo=p.__private__.putXRef=function(){var m="0000000000";U("xref"),U("0 "+(Z+1)),U("0000000000 65535 f ");for(var N=1;N<=Z;N++)typeof ie[N]=="function"?U((m+ie[N]()).slice(-10)+" 00000 n "):ie[N]!==void 0?U((m+ie[N]).slice(-10)+" 00000 n "):U("0000000000 00000 n ")},oi=p.__private__.buildDocument=function(){var m;Z=0,Y=0,fe=[],ie=[],se=[],Ir=Yt(),ur=Yt(),De(fe),Ft.publish("buildDocument"),An(),Or(),(function(){Ft.publish("putAdditionalObjects");for(var W=0;W<se.length;W++){var Q=se[W];xn(Q.objId,!0),U(Q.content),U("endobj")}Ft.publish("postPutAdditionalObjects")})(),m=[],(function(){for(var W in bt)bt.hasOwnProperty(W)&&(g===!1||g===!0&&b.hasOwnProperty(W))&&Ue(bt[W])})(),(function(){var W;for(W in st)st.hasOwnProperty(W)&&Wt(st[W])})(),(function(){for(var W in Ct)Ct.hasOwnProperty(W)&&te(Ct[W])})(),(function(W){var Q;for(Q in et)et.hasOwnProperty(Q)&&(et[Q]instanceof Da?Ee(et[Q]):et[Q]instanceof ms&&Fe(et[Q],W))})(m),Ft.publish("putResources"),m.forEach(cn),cn({resourcesOid:ur,objectOid:Number.MAX_SAFE_INTEGER}),Ft.publish("postPutResources"),h!==null&&(Tn.oid=It(),U("<<"),U("/Filter /Standard"),U("/V "+Tn.v),U("/R "+Tn.r),U("/U <"+Tn.toHexString(Tn.U)+">"),U("/O <"+Tn.toHexString(Tn.O)+">"),U("/P "+Tn.P),U(">>"),U("endobj")),si(),Wa();var N=Y;return Oo(),dc(),U("startxref"),U(""+N),U("%%EOF"),De(be[$]),fe.join(`
`)},Ga=p.__private__.getBlob=function(m){return new Blob([ht(m)],{type:"application/pdf"})},Ro=p.output=p.__private__.output=(cr=function(m,N){switch(typeof(N=N||{})=="string"?N={filename:N}:N.filename=N.filename||"generated.pdf",m){case void 0:return oi();case"save":p.save(N.filename);break;case"arraybuffer":return ht(oi());case"blob":return Ga(oi());case"bloburi":case"bloburl":if(ft.URL!==void 0&&typeof ft.URL.createObjectURL=="function")return ft.URL&&ft.URL.createObjectURL(Ga(oi()))||void 0;Kt.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var W="",Q=oi();try{W=ip(Q)}catch{W=ip(unescape(encodeURIComponent(Q)))}return"data:application/pdf;filename="+N.filename+";base64,"+W;case"pdfobjectnewwindow":if(Object.prototype.toString.call(ft)==="[object Window]"){var oe="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",_e=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';N.pdfObjectUrl&&(oe=N.pdfObjectUrl,_e="");var Ae='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+oe+'"'+_e+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(N)+");<\/script></body></html>",$e=ft.open();return $e!==null&&$e.document.write(Ae),$e}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(ft)==="[object Window]"){var Je='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(N.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+N.filename+'" width="500px" height="400px" /></body></html>',gt=ft.open();if(gt!==null){gt.document.write(Je);var wt=this;gt.document.documentElement.querySelector("#pdfViewer").onload=function(){gt.document.title=N.filename,gt.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(wt.output("bloburl"))}}return gt}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(ft)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Ot='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",N)+'"></iframe></body></html>',on=ft.open();if(on!==null&&(on.document.write(Ot),on.document.title=N.filename),on||typeof safari>"u")return on;break;case"datauri":case"dataurl":return ft.document.location.href=this.output("datauristring",N);default:return null}},cr.foo=function(){try{return cr.apply(this,arguments)}catch(W){var m=W.stack||"";~m.indexOf(" at ")&&(m=m.split(" at ")[1]);var N="Error in function "+m.split(`
`)[0].split("<")[0]+": "+W.message;if(!ft.console)throw new Error(N);ft.console.error(N,W),ft.alert&&alert(N)}},cr.foo.bar=cr,cr.foo),Fr=function(m){return Array.isArray(yi)===!0&&yi.indexOf(m)>-1};switch(r){case"pt":mt=1;break;case"mm":mt=72/25.4;break;case"cm":mt=72/2.54;break;case"in":mt=72;break;case"px":mt=Fr("px_scaling")==1?.75:96/72;break;case"pc":case"em":mt=12;break;case"ex":mt=6;break;default:if(typeof r!="number")throw new Error("Invalid unit: "+r);mt=r}var Tn=null;pe(),ae();var _i=p.__private__.getPageInfo=p.getPageInfo=function(m){if(isNaN(m)||m%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:tt[m].objId,pageNumber:m,pageContext:tt[m]}},Fo=p.__private__.getPageInfoByObjId=function(m){if(isNaN(m)||m%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var N in tt)if(tt[N].objId===m)break;return _i(N)},hc=p.__private__.getCurrentPageInfo=p.getCurrentPageInfo=function(){return{objId:tt[$].objId,pageNumber:$,pageContext:tt[$]}};p.addPage=function(){return $i.apply(this,arguments),this},p.setPage=function(){return ha.apply(this,arguments),De.call(this,be[$]),this},p.insertPage=function(m){return this.addPage(),this.movePage($,m),this},p.movePage=function(m,N){var W,Q;if(m>N){W=be[m],Q=tt[m];for(var oe=m;oe>N;oe--)be[oe]=be[oe-1],tt[oe]=tt[oe-1];be[N]=W,tt[N]=Q,this.setPage(N)}else if(m<N){W=be[m],Q=tt[m];for(var _e=m;_e<N;_e++)be[_e]=be[_e+1],tt[_e]=tt[_e+1];be[N]=W,tt[N]=Q,this.setPage(N)}return this},p.deletePage=function(){return sn.apply(this,arguments),this},p.__private__.text=p.text=function(m,N,W,Q,oe){var _e,Ae,$e,Je,gt,wt,Ot,on,kn,Xt=(Q=Q||{}).scope||this;if(typeof m=="number"&&typeof N=="number"&&(typeof W=="string"||Array.isArray(W))){var Pn=W;W=N,N=m,m=Pn}if(arguments[3]instanceof rt==0?($e=arguments[4],Je=arguments[5],Ht(Ot=arguments[3])==="object"&&Ot!==null||(typeof $e=="string"&&(Je=$e,$e=null),typeof Ot=="string"&&(Je=Ot,Ot=null),typeof Ot=="number"&&($e=Ot,Ot=null),Q={flags:Ot,angle:$e,align:Je})):(F("The transform parameter of text() with a Matrix value"),kn=oe),isNaN(N)||isNaN(W)||m==null)throw new Error("Invalid arguments passed to jsPDF.text");if(m.length===0)return Xt;var Nn,Mn="",Ei=typeof Q.lineHeightFactor=="number"?Q.lineHeightFactor:ga,Hr=Xt.internal.scaleFactor;function Li(Bt){return Bt=Bt.split("	").join(Array(Q.TabLen||9).join(" ")),un(Bt,Ot)}function Ds(Bt){for(var Gt,mn=Bt.concat(),In=[],Pi=mn.length;Pi--;)typeof(Gt=mn.shift())=="string"?In.push(Gt):Array.isArray(Bt)&&(Gt.length===1||Gt[1]===void 0&&Gt[2]===void 0)?In.push(Gt[0]):In.push([Gt[0],Gt[1],Gt[2]]);return In}function Ya(Bt,Gt){var mn;if(typeof Bt=="string")mn=Gt(Bt)[0];else if(Array.isArray(Bt)){for(var In,Pi,Gs=Bt.concat(),Qa=[],Go=Gs.length;Go--;)typeof(In=Gs.shift())=="string"?Qa.push(Gt(In)[0]):Array.isArray(In)&&typeof In[0]=="string"&&(Pi=Gt(In[0],In[1],In[2]),Qa.push([Pi[0],Pi[1],Pi[2]]));mn=Qa}return mn}var qi=!1,ya=!0;if(typeof m=="string")qi=!0;else if(Array.isArray(m)){var _a=m.concat();Ae=[];for(var zi,Un=_a.length;Un--;)(typeof(zi=_a.shift())!="string"||Array.isArray(zi)&&typeof zi[0]!="string")&&(ya=!1);qi=ya}if(qi===!1)throw new Error('Type of text must be string or Array. "'+m+'" is not recognized.');typeof m=="string"&&(m=m.match(/[\r?\n]/)?m.split(/\r\n|\r|\n/g):[m]);var wa=Se/Xt.internal.scaleFactor,xa=wa*(Ei-1);switch(Q.baseline){case"bottom":W-=xa;break;case"top":W+=wa-xa;break;case"hanging":W+=wa-2*xa;break;case"middle":W+=wa/2-xa}if((wt=Q.maxWidth||0)>0&&(typeof m=="string"?m=Xt.splitTextToSize(m,wt):Object.prototype.toString.call(m)==="[object Array]"&&(m=m.reduce(function(Bt,Gt){return Bt.concat(Xt.splitTextToSize(Gt,wt))},[]))),_e={text:m,x:N,y:W,options:Q,mutex:{pdfEscape:un,activeFontKey:ze,fonts:bt,activeFontSize:Se}},Ft.publish("preProcessText",_e),m=_e.text,$e=(Q=_e.options).angle,kn instanceof rt==0&&$e&&typeof $e=="number"){$e*=Math.PI/180,Q.rotationDirection===0&&($e=-$e),E===O&&($e=-$e);var js=Math.cos($e),Bs=Math.sin($e);kn=new rt(js,Bs,-Bs,js,0,0)}else $e&&$e instanceof rt&&(kn=$e);E!==O||kn||(kn=Pr),(gt=Q.charSpace||Si)!==void 0&&(Mn+=X(j(gt))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(on=Q.horizontalScale)!==void 0&&(Mn+=X(100*on)+` Tz
`),Q.lang;var nr=-1,Ci=Q.renderingMode!==void 0?Q.renderingMode:Q.stroke,Xa=Xt.internal.getCurrentPageInfo().pageContext;switch(Ci){case 0:case!1:case"fill":nr=0;break;case 1:case!0:case"stroke":nr=1;break;case 2:case"fillThenStroke":nr=2;break;case 3:case"invisible":nr=3;break;case 4:case"fillAndAddForClipping":nr=4;break;case 5:case"strokeAndAddPathForClipping":nr=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":nr=6;break;case 7:case"addToPathForClipping":nr=7}var Ho=Xa.usedRenderingMode!==void 0?Xa.usedRenderingMode:-1;nr!==-1?Mn+=nr+` Tr
`:Ho!==-1&&(Mn+=`0 Tr
`),nr!==-1&&(Xa.usedRenderingMode=nr),Je=Q.align||"left";var Dr,Sa=Se*Ei,Ms=Xt.internal.pageSize.getWidth(),Us=bt[ze];gt=Q.charSpace||Si,wt=Q.maxWidth||0,Ot=Object.assign({autoencode:!0,noBOM:!0},Q.flags);var Hi=[],Aa=function(Bt){return Xt.getStringUnitWidth(Bt,{font:Us,charSpace:gt,fontSize:Se,doKerning:!1})*Se/Hr};if(Object.prototype.toString.call(m)==="[object Array]"){var vr;Ae=Ds(m),Je!=="left"&&(Dr=Ae.map(Aa));var br,Wi=0;if(Je==="right"){N-=Dr[0],m=[],Un=Ae.length;for(var Ti=0;Ti<Un;Ti++)Ti===0?(br=wi(N),vr=xi(W)):(br=j(Wi-Dr[Ti]),vr=-Sa),m.push([Ae[Ti],br,vr]),Wi=Dr[Ti]}else if(Je==="center"){N-=Dr[0]/2,m=[],Un=Ae.length;for(var Gi=0;Gi<Un;Gi++)Gi===0?(br=wi(N),vr=xi(W)):(br=j((Wi-Dr[Gi])/2),vr=-Sa),m.push([Ae[Gi],br,vr]),Wi=Dr[Gi]}else if(Je==="left"){m=[],Un=Ae.length;for(var $s=0;$s<Un;$s++)m.push(Ae[$s])}else if(Je==="justify"&&Us.encoding==="Identity-H"){m=[],Un=Ae.length,wt=wt!==0?wt:Ms;for(var Za=0,gn=0;gn<Un;gn++)if(vr=gn===0?xi(W):-Sa,br=gn===0?wi(N):Za,gn<Un-1){var Wo=j((wt-Dr[gn])/(Ae[gn].split(" ").length-1)),ci=Ae[gn].split(" ");m.push([ci[0]+" ",br,vr]),Za=0;for(var ui=1;ui<ci.length;ui++){var qs=(Aa(ci[ui-1]+" "+ci[ui])-Aa(ci[ui]))*Hr+Wo;ui==ci.length-1?m.push([ci[ui],qs,0]):m.push([ci[ui]+" ",qs,0]),Za-=qs}}else m.push([Ae[gn],br,vr]);m.push(["",Za,0])}else{if(Je!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(m=[],Un=Ae.length,wt=wt!==0?wt:Ms,gn=0;gn<Un;gn++){vr=gn===0?xi(W):-Sa,br=gn===0?wi(N):0;var zs=Ae[gn].split(" ").length-1,Hs=zs>0?(wt-Dr[gn])/zs:0;gn<Un-1?Hi.push(X(j(Hs))):Hi.push(0),m.push([Ae[gn],br,vr])}}}(typeof Q.R2L=="boolean"?Q.R2L:Qe)===!0&&(m=Ya(m,function(Bt,Gt,mn){return[Bt.split("").reverse().join(""),Gt,mn]})),_e={text:m,x:N,y:W,options:Q,mutex:{pdfEscape:un,activeFontKey:ze,fonts:bt,activeFontSize:Se}},Ft.publish("postProcessText",_e),m=_e.text,Nn=_e.mutex.isHex||!1;var Ws=bt[ze].encoding;Ws!=="WinAnsiEncoding"&&Ws!=="StandardEncoding"||(m=Ya(m,function(Bt,Gt,mn){return[Li(Bt),Gt,mn]})),Ae=Ds(m),m=[];for(var Vi,Ki,Ji,ka=Array.isArray(Ae[0])?1:0,Yi="",Na=function(Bt,Gt,mn){var In="";return mn instanceof rt?(mn=typeof Q.angle=="number"?mr(mn,new rt(1,0,0,1,Bt,Gt)):mr(new rt(1,0,0,1,Bt,Gt),mn),E===O&&(mn=mr(new rt(1,0,0,-1,0,0),mn)),In=mn.join(" ")+` Tm
`):In=X(Bt)+" "+X(Gt)+` Td
`,In},jr=0;jr<Ae.length;jr++){switch(Yi="",ka){case 1:Ji=(Nn?"<":"(")+Ae[jr][0]+(Nn?">":")"),Vi=parseFloat(Ae[jr][1]),Ki=parseFloat(Ae[jr][2]);break;case 0:Ji=(Nn?"<":"(")+Ae[jr]+(Nn?">":")"),Vi=wi(N),Ki=xi(W)}Hi!==void 0&&Hi[jr]!==void 0&&(Yi=Hi[jr]+` Tw
`),jr===0?m.push(Yi+Na(Vi,Ki,kn)+Ji):ka===0?m.push(Yi+Ji):ka===1&&m.push(Yi+Na(Vi,Ki,kn)+Ji)}m=ka===0?m.join(` Tj
T* `):m.join(` Tj
`),m+=` Tj
`;var di=`BT
/`;return di+=ze+" "+Se+` Tf
`,di+=X(Se*Ei)+` TL
`,di+=ma+`
`,di+=Mn,di+=m,U(di+="ET"),b[ze]=!0,Xt};var fc=p.__private__.clip=p.clip=function(m){return U(m==="evenodd"?"W*":"W"),this};p.clipEvenOdd=function(){return fc("evenodd")},p.__private__.discardPath=p.discardPath=function(){return U("n"),this};var li=p.__private__.isValidStyle=function(m){var N=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(m)!==-1&&(N=!0),N};p.__private__.setDefaultPathOperation=p.setDefaultPathOperation=function(m){return li(m)&&(u=m),this};var Do=p.__private__.getStyle=p.getStyle=function(m){var N=u;switch(m){case"D":case"S":N="S";break;case"F":N="f";break;case"FD":case"DF":N="B";break;case"f":case"f*":case"B":case"B*":N=m}return N},jo=p.close=function(){return U("h"),this};p.stroke=function(){return U("S"),this},p.fill=function(m){return Va("f",m),this},p.fillEvenOdd=function(m){return Va("f*",m),this},p.fillStroke=function(m){return Va("B",m),this},p.fillStrokeEvenOdd=function(m){return Va("B*",m),this};var Va=function(m,N){Ht(N)==="object"?gc(N,m):U(m)},pa=function(m){m===null||E===O&&m===void 0||(m=Do(m),U(m))};function pc(m,N,W,Q,oe){var _e=new ms(N||this.boundingBox,W||this.xStep,Q||this.yStep,this.gState,oe||this.matrix);_e.stream=this.stream;var Ae=m+"$$"+this.cloneIndex+++"$$";return er(Ae,_e),_e}var gc=function(m,N){var W=jt[m.key],Q=et[W];if(Q instanceof Da)U("q"),U(mc(N)),Q.gState&&p.setGState(Q.gState),U(m.matrix.toString()+" cm"),U("/"+W+" sh"),U("Q");else if(Q instanceof ms){var oe=new rt(1,0,0,-1,0,ba());m.matrix&&(oe=oe.multiply(m.matrix||Pr),W=pc.call(Q,m.key,m.boundingBox,m.xStep,m.yStep,oe).id),U("q"),U("/Pattern cs"),U("/"+W+" scn"),Q.gState&&p.setGState(Q.gState),U(N),U("Q")}},mc=function(m){switch(m){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Ls=p.moveTo=function(m,N){return U(X(j(m))+" "+X(q(N))+" m"),this},Bo=p.lineTo=function(m,N){return U(X(j(m))+" "+X(q(N))+" l"),this},zr=p.curveTo=function(m,N,W,Q,oe,_e){return U([X(j(m)),X(q(N)),X(j(W)),X(q(Q)),X(j(oe)),X(q(_e)),"c"].join(" ")),this};p.__private__.line=p.line=function(m,N,W,Q,oe){if(isNaN(m)||isNaN(N)||isNaN(W)||isNaN(Q)||!li(oe))throw new Error("Invalid arguments passed to jsPDF.line");return E===T?this.lines([[W-m,Q-N]],m,N,[1,1],oe||"S"):this.lines([[W-m,Q-N]],m,N,[1,1]).stroke()},p.__private__.lines=p.lines=function(m,N,W,Q,oe,_e){var Ae,$e,Je,gt,wt,Ot,on,kn,Xt,Pn,Nn,Mn;if(typeof m=="number"&&(Mn=W,W=N,N=m,m=Mn),Q=Q||[1,1],_e=_e||!1,isNaN(N)||isNaN(W)||!Array.isArray(m)||!Array.isArray(Q)||!li(oe)||typeof _e!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Ls(N,W),Ae=Q[0],$e=Q[1],gt=m.length,Pn=N,Nn=W,Je=0;Je<gt;Je++)(wt=m[Je]).length===2?(Pn=wt[0]*Ae+Pn,Nn=wt[1]*$e+Nn,Bo(Pn,Nn)):(Ot=wt[0]*Ae+Pn,on=wt[1]*$e+Nn,kn=wt[2]*Ae+Pn,Xt=wt[3]*$e+Nn,Pn=wt[4]*Ae+Pn,Nn=wt[5]*$e+Nn,zr(Ot,on,kn,Xt,Pn,Nn));return _e&&jo(),pa(oe),this},p.path=function(m){for(var N=0;N<m.length;N++){var W=m[N],Q=W.c;switch(W.op){case"m":Ls(Q[0],Q[1]);break;case"l":Bo(Q[0],Q[1]);break;case"c":zr.apply(this,Q);break;case"h":jo()}}return this},p.__private__.rect=p.rect=function(m,N,W,Q,oe){if(isNaN(m)||isNaN(N)||isNaN(W)||isNaN(Q)||!li(oe))throw new Error("Invalid arguments passed to jsPDF.rect");return E===T&&(Q=-Q),U([X(j(m)),X(q(N)),X(j(W)),X(j(Q)),"re"].join(" ")),pa(oe),this},p.__private__.triangle=p.triangle=function(m,N,W,Q,oe,_e,Ae){if(isNaN(m)||isNaN(N)||isNaN(W)||isNaN(Q)||isNaN(oe)||isNaN(_e)||!li(Ae))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[W-m,Q-N],[oe-W,_e-Q],[m-oe,N-_e]],m,N,[1,1],Ae,!0),this},p.__private__.roundedRect=p.roundedRect=function(m,N,W,Q,oe,_e,Ae){if(isNaN(m)||isNaN(N)||isNaN(W)||isNaN(Q)||isNaN(oe)||isNaN(_e)||!li(Ae))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var $e=4/3*(Math.SQRT2-1);return oe=Math.min(oe,.5*W),_e=Math.min(_e,.5*Q),this.lines([[W-2*oe,0],[oe*$e,0,oe,_e-_e*$e,oe,_e],[0,Q-2*_e],[0,_e*$e,-oe*$e,_e,-oe,_e],[2*oe-W,0],[-oe*$e,0,-oe,-_e*$e,-oe,-_e],[0,2*_e-Q],[0,-_e*$e,oe*$e,-_e,oe,-_e]],m+oe,N,[1,1],Ae,!0),this},p.__private__.ellipse=p.ellipse=function(m,N,W,Q,oe){if(isNaN(m)||isNaN(N)||isNaN(W)||isNaN(Q)||!li(oe))throw new Error("Invalid arguments passed to jsPDF.ellipse");var _e=4/3*(Math.SQRT2-1)*W,Ae=4/3*(Math.SQRT2-1)*Q;return Ls(m+W,N),zr(m+W,N-Ae,m+_e,N-Q,m,N-Q),zr(m-_e,N-Q,m-W,N-Ae,m-W,N),zr(m-W,N+Ae,m-_e,N+Q,m,N+Q),zr(m+_e,N+Q,m+W,N+Ae,m+W,N),pa(oe),this},p.__private__.circle=p.circle=function(m,N,W,Q){if(isNaN(m)||isNaN(N)||isNaN(W)||!li(Q))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(m,N,W,W,Q)},p.setFont=function(m,N,W){return W&&(N=G(N,W)),ze=Io(m,N,{disableWarning:!1}),this};var vc=p.__private__.getFont=p.getFont=function(){return bt[Io.apply(p,arguments)]};p.__private__.getFontList=p.getFontList=function(){var m,N,W={};for(m in ct)if(ct.hasOwnProperty(m))for(N in W[m]=[],ct[m])ct[m].hasOwnProperty(N)&&W[m].push(N);return W},p.addFont=function(m,N,W,Q,oe){var _e=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&_e.indexOf(arguments[3])!==-1?oe=arguments[3]:arguments[3]&&_e.indexOf(arguments[3])==-1&&(W=G(W,Q)),Cn.call(this,m,N,W,oe=oe||"Identity-H")};var ga,Cs=t.lineWidth||.200025,bc=p.__private__.getLineWidth=p.getLineWidth=function(){return Cs},vt=p.__private__.setLineWidth=p.setLineWidth=function(m){return Cs=m,U(X(j(m))+" w"),this};p.__private__.setLineDash=Xe.API.setLineDash=Xe.API.setLineDashPattern=function(m,N){if(m=m||[],N=N||0,isNaN(N)||!Array.isArray(m))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return m=m.map(function(W){return X(j(W))}).join(" "),N=X(j(N)),U("["+m+"] "+N+" d"),this};var yc=p.__private__.getLineHeight=p.getLineHeight=function(){return Se*ga};p.__private__.getLineHeight=p.getLineHeight=function(){return Se*ga};var _c=p.__private__.setLineHeightFactor=p.setLineHeightFactor=function(m){return typeof(m=m||1.15)=="number"&&(ga=m),this},wc=p.__private__.getLineHeightFactor=p.getLineHeightFactor=function(){return ga};_c(t.lineHeight);var wi=p.__private__.getHorizontalCoordinate=function(m){return j(m)},xi=p.__private__.getVerticalCoordinate=function(m){return E===O?m:tt[$].mediaBox.topRightY-tt[$].mediaBox.bottomLeftY-j(m)},xc=p.__private__.getHorizontalCoordinateString=p.getHorizontalCoordinateString=function(m){return X(wi(m))},Sc=p.__private__.getVerticalCoordinateString=p.getVerticalCoordinateString=function(m){return X(xi(m))},Ka=t.strokeColor||"0 G";p.__private__.getStrokeColor=p.getDrawColor=function(){return Sn(Ka)},p.__private__.setStrokeColor=p.setDrawColor=function(m,N,W,Q){return Ka=dr({ch1:m,ch2:N,ch3:W,ch4:Q,pdfColorType:"draw",precision:2}),U(Ka),this};var Ts=t.fillColor||"0 g";p.__private__.getFillColor=p.getFillColor=function(){return Sn(Ts)},p.__private__.setFillColor=p.setFillColor=function(m,N,W,Q){return Ts=dr({ch1:m,ch2:N,ch3:W,ch4:Q,pdfColorType:"fill",precision:2}),U(Ts),this};var ma=t.textColor||"0 g",Ac=p.__private__.getTextColor=p.getTextColor=function(){return Sn(ma)};p.__private__.setTextColor=p.setTextColor=function(m,N,W,Q){return ma=dr({ch1:m,ch2:N,ch3:W,ch4:Q,pdfColorType:"text",precision:3}),this};var Si=t.charSpace,kc=p.__private__.getCharSpace=p.getCharSpace=function(){return parseFloat(Si||0)};p.__private__.setCharSpace=p.setCharSpace=function(m){if(isNaN(m))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Si=m,this};var Ps=0;p.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},p.__private__.setLineCap=p.setLineCap=function(m){var N=p.CapJoinStyles[m];if(N===void 0)throw new Error("Line cap style of '"+m+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Ps=N,U(N+" J"),this};var Is=0;p.__private__.setLineJoin=p.setLineJoin=function(m){var N=p.CapJoinStyles[m];if(N===void 0)throw new Error("Line join style of '"+m+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Is=N,U(N+" j"),this},p.__private__.setLineMiterLimit=p.__private__.setMiterLimit=p.setLineMiterLimit=p.setMiterLimit=function(m){if(m=m||0,isNaN(m))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return U(X(j(m))+" M"),this},p.GState=Yl,p.setGState=function(m){(m=typeof m=="string"?st[dt[m]]:Mo(null,m)).equals(Ut)||(U("/"+m.id+" gs"),Ut=m)};var Mo=function(m,N){if(!m||!dt[m]){var W=!1;for(var Q in st)if(st.hasOwnProperty(Q)&&st[Q].equals(N)){W=!0;break}if(W)N=st[Q];else{var oe="GS"+(Object.keys(st).length+1).toString(10);st[oe]=N,N.id=oe}return m&&(dt[m]=N.id),Ft.publish("addGState",N),N}};p.addGState=function(m,N){return Mo(m,N),this},p.saveGraphicsState=function(){return U("q"),Dt.push({key:ze,size:Se,color:ma}),this},p.restoreGraphicsState=function(){U("Q");var m=Dt.pop();return ze=m.key,Se=m.size,ma=m.color,Ut=null,this},p.setCurrentTransformationMatrix=function(m){return U(m.toString()+" cm"),this},p.comment=function(m){return U("#"+m),this};var Ai=function(m,N){var W=m||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return W},set:function(_e){isNaN(_e)||(W=parseFloat(_e))}});var Q=N||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Q},set:function(_e){isNaN(_e)||(Q=parseFloat(_e))}});var oe="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return oe},set:function(_e){oe=_e.toString()}}),this},Os=function(m,N,W,Q){Ai.call(this,m,N),this.type="rect";var oe=W||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return oe},set:function(Ae){isNaN(Ae)||(oe=parseFloat(Ae))}});var _e=Q||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return _e},set:function(Ae){isNaN(Ae)||(_e=parseFloat(Ae))}}),this},Ja=function(){this.page=kt,this.currentPage=$,this.pages=be.slice(0),this.pagesContext=tt.slice(0),this.x=We,this.y=rn,this.matrix=Et,this.width=Fs($),this.height=$o($),this.outputDestination=Te,this.id="",this.objectNumber=-1};Ja.prototype.restore=function(){kt=this.page,$=this.currentPage,tt=this.pagesContext,be=this.pages,We=this.x,rn=this.y,Et=this.matrix,Uo($,this.width),ki($,this.height),Te=this.outputDestination};var Rs=function(m,N,W,Q,oe){Tr.push(new Ja),kt=$=0,be=[],We=m,rn=N,Et=oe,Rr([W,Q])};for(var va in p.beginFormObject=function(m,N,W,Q,oe){return Rs(m,N,W,Q,oe),this},p.endFormObject=function(m){return(function(N){if(Vn[N])Tr.pop().restore();else{var W=new Ja,Q="Xo"+(Object.keys(Ct).length+1).toString(10);W.id=Q,Vn[N]=Q,Ct[Q]=W,Ft.publish("addFormObject",W),Tr.pop().restore()}})(m),this},p.doFormObject=function(m,N){var W=Ct[Vn[m]];return U("q"),U(N.toString()+" cm"),U("/"+W.id+" Do"),U("Q"),this},p.getFormObject=function(m){var N=Ct[Vn[m]];return{x:N.x,y:N.y,width:N.width,height:N.height,matrix:N.matrix}},p.save=function(m,N){return m=m||"generated.pdf",(N=N||{}).returnPromise=N.returnPromise||!1,N.returnPromise===!1?(Ia(Ga(oi()),m),typeof Ia.unload=="function"&&ft.setTimeout&&setTimeout(Ia.unload,911),this):new Promise(function(W,Q){try{var oe=Ia(Ga(oi()),m);typeof Ia.unload=="function"&&ft.setTimeout&&setTimeout(Ia.unload,911),W(oe)}catch(_e){Q(_e.message)}})},Xe.API)Xe.API.hasOwnProperty(va)&&(va==="events"&&Xe.API.events.length?(function(m,N){var W,Q,oe;for(oe=N.length-1;oe!==-1;oe--)W=N[oe][0],Q=N[oe][1],m.subscribe.apply(m,[W].concat(typeof Q=="function"?[Q]:Q))})(Ft,Xe.API.events):p[va]=Xe.API[va]);function Fs(m){return tt[m].mediaBox.topRightX-tt[m].mediaBox.bottomLeftX}function Uo(m,N){tt[m].mediaBox.topRightX=N+tt[m].mediaBox.bottomLeftX}function $o(m){return tt[m].mediaBox.topRightY-tt[m].mediaBox.bottomLeftY}function ki(m,N){tt[m].mediaBox.topRightY=N+tt[m].mediaBox.bottomLeftY}var Ni=p.getPageWidth=function(m){return Fs(m=m||$)/mt},qo=p.setPageWidth=function(m,N){Uo(m,N*mt)},ba=p.getPageHeight=function(m){return $o(m=m||$)/mt},zo=p.setPageHeight=function(m,N){ki(m,N*mt)};return p.internal={pdfEscape:un,getStyle:Do,getFont:vc,getFontSize:Re,getCharSpace:kc,getTextColor:Ac,getLineHeight:yc,getLineHeightFactor:wc,getLineWidth:bc,write:Pe,getHorizontalCoordinate:wi,getVerticalCoordinate:xi,getCoordinateString:xc,getVerticalCoordinateString:Sc,collections:{},newObject:It,newAdditionalObject:ii,newObjectDeferred:Yt,newObjectDeferredBegin:xn,getFilters:hr,putStream:tr,events:Ft,scaleFactor:mt,pageSize:{getWidth:function(){return Ni($)},setWidth:function(m){qo($,m)},getHeight:function(){return ba($)},setHeight:function(m){zo($,m)}},encryptionOptions:h,encryption:Tn,getEncryptor:function(m){return h!==null?Tn.encryptor(m,0):function(N){return N}},output:Ro,getNumberOfPages:fa,get pages(){return be},out:U,f2:k,f3:A,getPageInfo:_i,getPageInfoByObjId:Fo,getCurrentPageInfo:hc,getPDFVersion:_,Point:Ai,Rectangle:Os,Matrix:rt,hasHotfix:Fr},Object.defineProperty(p.internal.pageSize,"width",{get:function(){return Ni($)},set:function(m){qo($,m)},enumerable:!0,configurable:!0}),Object.defineProperty(p.internal.pageSize,"height",{get:function(){return ba($)},set:function(m){zo($,m)},enumerable:!0,configurable:!0}),(function(m){for(var N=0,W=He.length;N<W;N++){var Q=Cn.call(this,m[N][0],m[N][1],m[N][2],He[N][3],!0);g===!1&&(b[Q]=!0);var oe=m[N][0].split("-");en({id:Q,fontName:oe[0],fontStyle:oe[1]||""})}Ft.publish("addFonts",{fonts:bt,dictionary:ct})}).call(p,He),ze="F1",$i(a,n),Ft.publish("initialized"),p}fs.prototype.lsbFirstWord=function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)},fs.prototype.toHexString=function(t){return t.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},fs.prototype.hexToBytes=function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(String.fromCharCode(parseInt(t.substr(n,2),16)));return e.join("")},fs.prototype.processOwnerPassword=function(t,e){return rd(nd(e).substr(0,5),t)},fs.prototype.encryptor=function(t,e){var n=nd(this.encryptionKey+String.fromCharCode(255&t,t>>8&255,t>>16&255,255&e,e>>8&255)).substr(0,10);return function(r){return rd(n,r)}},Yl.prototype.equals=function(t){var e,n="id,objectNumber,equals";if(!t||Ht(t)!==Ht(this))return!1;var r=0;for(e in this)if(!(n.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!t.hasOwnProperty(e)||this[e]!==t[e])return!1;r++}for(e in t)t.hasOwnProperty(e)&&n.indexOf(e)<0&&r--;return r===0},Xe.API={events:[]},Xe.version="4.2.0";var fn=Xe.API,Nd=1,Ha=function(t){return t.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},ls=function(t){return t.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},qa=function(t){return t.toString().replace(/#/g,"#23").replace(/[\s\n\r()<>[\]{}\/%]/g,function(e){var n=e.charCodeAt(0).toString(16).toUpperCase();return"#"+(n.length===1?"0"+n:n)})},yt=function(t){return t.toFixed(2)},ia=function(t){return t.toFixed(5)};fn.__acroform__={};var gr=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},lp=function(t){return t*Nd},pi=function(t){var e=new rm,n=Me.internal.getHeight(t)||0,r=Me.internal.getWidth(t)||0;return e.BBox=[0,0,Number(yt(r)),Number(yt(n))],e},Sy=fn.__acroform__.setBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return t|1<<e},Ay=fn.__acroform__.clearBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return t&~(1<<e)},ky=fn.__acroform__.getBit=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return t&1<<e?1:0},yn=fn.__acroform__.getBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return ky(t,e-1)},_n=fn.__acroform__.setBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Sy(t,e-1)},wn=fn.__acroform__.clearBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Ay(t,e-1)},Ny=fn.__acroform__.calculateCoordinates=function(t,e){var n=e.internal.getHorizontalCoordinate,r=e.internal.getVerticalCoordinate,a=t[0],i=t[1],o=t[2],l=t[3],c={};return c.lowerLeft_X=n(a)||0,c.lowerLeft_Y=r(i+l)||0,c.upperRight_X=n(a+o)||0,c.upperRight_Y=r(i)||0,[Number(yt(c.lowerLeft_X)),Number(yt(c.lowerLeft_Y)),Number(yt(c.upperRight_X)),Number(yt(c.upperRight_Y))]},Ey=function(t){if(t.appearanceStreamContent)return t.appearanceStreamContent;if(t.V||t.DV){var e=[],n=t._V||t.DV,r=id(t,n),a=t.scope.internal.getFont(t.fontName,t.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(t.scope.__private__.encodeColorString(t.color)),e.push("/"+a+" "+yt(r.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(r.text),e.push("ET"),e.push("Q"),e.push("EMC");var i=pi(t);return i.scope=t.scope,i.stream=e.join(`
`),i}},id=function(t,e){var n=t.fontSize===0?t.maxFontSize:t.fontSize,r={text:"",fontSize:""},a=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");a=t.multiline?a.map(function(k){return k.split(`
`)}):a.map(function(k){return[k]});var i=n,o=Me.internal.getHeight(t)||0;o=o<0?-o:o;var l=Me.internal.getWidth(t)||0;l=l<0?-l:l;var c=function(k,A,j){if(k+1<a.length){var q=A+" "+a[k+1][0];return Nl(q,t,j).width<=l-4}return!1};i++;e:for(;i>0;){e="",i--;var u,h,g=Nl("3",t,i).height,b=t.multiline?o-i:(o-g)/2,p=b+=2,y=0,_=0,S=0;if(i<=0){e=`(...) Tj
`,e+="% Width of Text: "+Nl(e,t,i=12).width+", FieldWidth:"+l+`
`;break}for(var x="",T=0,O=0;O<a.length;O++)if(a.hasOwnProperty(O)){var E=!1;if(a[O].length!==1&&S!==a[O].length-1){if((g+2)*(T+2)+2>o)continue e;x+=a[O][S],E=!0,_=O,O--}else{x=(x+=a[O][S]+" ").substr(x.length-1)==" "?x.substr(0,x.length-1):x;var M=parseInt(O),ee=c(M,x,i),G=O>=a.length-1;if(ee&&!G){x+=" ",S=0;continue}if(ee||G){if(G)_=M;else if(t.multiline&&(g+2)*(T+2)+2>o)continue e}else{if(!t.multiline||(g+2)*(T+2)+2>o)continue e;_=M}}for(var X="",F=y;F<=_;F++){var I=a[F];if(t.multiline){if(F===_){X+=I[S]+" ",S=(S+1)%I.length;continue}if(F===y){X+=I[I.length-1]+" ";continue}}X+=I[0]+" "}switch(X=X.substr(X.length-1)==" "?X.substr(0,X.length-1):X,h=Nl(X,t,i).width,t.textAlign){case"right":u=l-h-2;break;case"center":u=(l-h)/2;break;default:u=2}e+=yt(u)+" "+yt(p)+` Td
`,e+="("+Ha(X)+`) Tj
`,e+=-yt(u)+` 0 Td
`,p=-(i+2),h=0,y=E?_:_+1,T++,x=""}break}return r.text=e,r.fontSize=i,r},Nl=function(t,e,n){var r=e.scope.internal.getFont(e.fontName,e.fontStyle),a=e.scope.getStringUnitWidth(t,{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n);return{height:e.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n)*1.5,width:a}},Ly={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Cy=function(t,e){var n={type:"reference",object:t};e.internal.getPageInfo(t.page).pageContext.annotations.find(function(r){return r.type===n.type&&r.object===n.object})===void 0&&e.internal.getPageInfo(t.page).pageContext.annotations.push(n)},Ty=function(t,e){if(e.scope=t,t.internal!==void 0&&(t.internal.acroformPlugin===void 0||t.internal.acroformPlugin.isInitialized===!1)){if(ni.FieldNum=0,t.internal.acroformPlugin=JSON.parse(JSON.stringify(Ly)),t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Nd=t.internal.scaleFactor,t.internal.acroformPlugin.acroFormDictionaryRoot=new im,t.internal.acroformPlugin.acroFormDictionaryRoot.scope=t,t.internal.acroformPlugin.acroFormDictionaryRoot._eventID=t.internal.events.subscribe("postPutResources",function(){(function(n){n.internal.events.unsubscribe(n.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete n.internal.acroformPlugin.acroFormDictionaryRoot._eventID,n.internal.acroformPlugin.printedOut=!0})(t)}),t.internal.events.subscribe("buildDocument",function(){(function(n){n.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var r=n.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var a in r)if(r.hasOwnProperty(a)){var i=r[a];i.objId=void 0,i.hasAnnotation&&Cy(i,n)}})(t)}),t.internal.events.subscribe("putCatalog",function(){(function(n){if(n.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");n.internal.write("/AcroForm "+n.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(t)}),t.internal.events.subscribe("postPutPages",function(n){(function(r,a){var i=!r;for(var o in r||(a.internal.newObjectDeferredBegin(a.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),a.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),r=r||a.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(r.hasOwnProperty(o)){var l=r[o],c=[],u=l.Rect;if(l.Rect&&(l.Rect=Ny(l.Rect,a)),a.internal.newObjectDeferredBegin(l.objId,!0),l.DA=Me.createDefaultAppearanceStream(l),Ht(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(c=l.getKeyValueListForStream()),l.Rect=u,l.hasAppearanceStream&&!l.appearanceStreamContent){var h=Ey(l);c.push({key:"AP",value:"<</N "+h+">>"}),a.internal.acroformPlugin.xForms.push(h)}if(l.appearanceStreamContent){var g="";for(var b in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(b)){var p=l.appearanceStreamContent[b];if(g+="/"+b+" ",g+="<<",Object.keys(p).length>=1||Array.isArray(p)){for(var o in p)if(p.hasOwnProperty(o)){var y=p[o];typeof y=="function"&&(y=y.call(a,l)),g+="/"+o+" "+y+" ",a.internal.acroformPlugin.xForms.indexOf(y)>=0||a.internal.acroformPlugin.xForms.push(y)}}else typeof(y=p)=="function"&&(y=y.call(a,l)),g+="/"+o+" "+y,a.internal.acroformPlugin.xForms.indexOf(y)>=0||a.internal.acroformPlugin.xForms.push(y);g+=">>"}c.push({key:"AP",value:`<<
`+g+">>"})}a.internal.putStream({additionalKeyValues:c,objectId:l.objId}),a.internal.out("endobj")}i&&(function(_,S){for(var x in _)if(_.hasOwnProperty(x)){var T=x,O=_[x];S.internal.newObjectDeferredBegin(O.objId,!0),Ht(O)==="object"&&typeof O.putStream=="function"&&O.putStream(),delete _[T]}})(a.internal.acroformPlugin.xForms,a)})(n,t)}),t.internal.acroformPlugin.isInitialized=!0}},nm=fn.__acroform__.arrayToPdfArray=function(t,e,n){var r=function(o){return o};if(Array.isArray(t)){for(var a="[",i=0;i<t.length;i++)switch(i!==0&&(a+=" "),Ht(t[i])){case"boolean":case"number":case"object":a+=t[i].toString();break;case"string":t[i].substr(0,1)==="/"?a+="/"+qa(t[i].substr(1)):(e!==void 0&&n&&(r=n.internal.getEncryptor(e)),a+="("+Ha(r(t[i].toString()))+")")}return a+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},_u=function(t,e,n){var r=function(a){return a};return e!==void 0&&n&&(r=n.internal.getEncryptor(e)),(t=t||"").toString(),"("+Ha(r(t))+")"},vi=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(t){this._objId=t}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};vi.prototype.toString=function(){return this.objId+" 0 R"},vi.prototype.putStream=function(){var t=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:t,objectId:this.objId}),this.scope.internal.out("endobj")},vi.prototype.getKeyValueListForStream=function(){var t=[],e=Object.getOwnPropertyNames(this).filter(function(i){return i!="content"&&i!="appearanceStreamContent"&&i!="scope"&&i!="objId"&&i.substring(0,1)!="_"});for(var n in e)if(Object.getOwnPropertyDescriptor(this,e[n]).configurable===!1){var r=e[n],a=this[r];a&&(Array.isArray(a)?t.push({key:r,value:nm(a,this.objId,this.scope)}):a instanceof vi?(a.scope=this.scope,t.push({key:r,value:a.objId+" 0 R"})):typeof a!="function"&&t.push({key:r,value:a}))}return t};var rm=function(){vi.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var t,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(n){e=n}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(n){t=n.trim()},get:function(){return t||null}})};gr(rm,vi);var im=function(){vi.call(this);var t,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(t){var n=function(r){return r};return this.scope&&(n=this.scope.internal.getEncryptor(this.objId)),"("+Ha(n(t))+")"}},set:function(n){t=n}})};gr(im,vi);var ni=function t(){vi.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(x){if(isNaN(x))throw new Error('Invalid value "'+x+'" for attribute F supplied.');e=x}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!yn(e,3)},set:function(x){x?this.F=_n(e,3):this.F=wn(e,3)}});var n=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return n},set:function(x){if(isNaN(x))throw new Error('Invalid value "'+x+'" for attribute Ff supplied.');n=x}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(r.length!==0)return r},set:function(x){r=x!==void 0?x:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(x){r[0]=x}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(x){r[1]=x}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(x){r[2]=x}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(x){r[3]=x}});var a="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return a},set:function(x){switch(x){case"/Btn":case"/Tx":case"/Ch":case"/Sig":a=x;break;default:throw new Error('Invalid value "'+x+'" for attribute FT supplied.')}}});var i=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!i||i.length<1){if(this instanceof Xl)return;i="FieldObject"+t.FieldNum++}var x=function(T){return T};return this.scope&&(x=this.scope.internal.getEncryptor(this.objId)),"("+Ha(x(i))+")"},set:function(x){i=x.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return i},set:function(x){i=x}});var o="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return o},set:function(x){o=x}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(x){l=x}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(x){c=x}});var u=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return u===void 0?50/Nd:u},set:function(x){u=x}});var h="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return h},set:function(x){h=x}});var g="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!g||this instanceof Xl||this instanceof Ma))return _u(g,this.objId,this.scope)},set:function(x){x=x.toString(),g=x}});var b=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(b)return this instanceof Bn==0?_u(b,this.objId,this.scope):b},set:function(x){x=x.toString(),b=this instanceof Bn==0?x.substr(0,1)==="("?ls(x.substr(1,x.length-2)):ls(x):x}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Bn==1?ls(b.substr(1,b.length-1)):b},set:function(x){x=x.toString(),b=this instanceof Bn==1?"/"+qa(x):x}});var p=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(p)return p},set:function(x){this.V=x}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(p)return this instanceof Bn==0?_u(p,this.objId,this.scope):p},set:function(x){x=x.toString(),p=this instanceof Bn==0?x.substr(0,1)==="("?ls(x.substr(1,x.length-2)):ls(x):x}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Bn==1?ls(p.substr(1,p.length-1)):p},set:function(x){x=x.toString(),p=this instanceof Bn==1?"/"+qa(x):x}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var y,_=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return _},set:function(x){x=!!x,_=x}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(y)return y},set:function(x){y=x}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,1)},set:function(x){x?this.Ff=_n(this.Ff,1):this.Ff=wn(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,2)},set:function(x){x?this.Ff=_n(this.Ff,2):this.Ff=wn(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,3)},set:function(x){x?this.Ff=_n(this.Ff,3):this.Ff=wn(this.Ff,3)}});var S=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(S!==null)return S},set:function(x){if([0,1,2].indexOf(x)===-1)throw new Error('Invalid value "'+x+'" for attribute Q supplied.');S=x}}),Object.defineProperty(this,"textAlign",{get:function(){var x;switch(S){case 0:default:x="left";break;case 1:x="center";break;case 2:x="right"}return x},configurable:!0,enumerable:!0,set:function(x){switch(x){case"right":case 2:S=2;break;case"center":case 1:S=1;break;default:S=0}}})};gr(ni,vi);var bs=function(){ni.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var t=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return t},set:function(n){t=n}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return t},set:function(n){t=n}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return nm(e,this.objId,this.scope)},set:function(n){var r,a;a=[],typeof(r=n)=="string"&&(a=(function(i,o,l){l||(l=1);for(var c,u=[];c=o.exec(i);)u.push(c[l]);return u})(r,/\((.*?)\)/g)),e=a}}),this.getOptions=function(){return e},this.setOptions=function(n){e=n,this.sort&&e.sort()},this.addOption=function(n){n=(n=n||"").toString(),e.push(n),this.sort&&e.sort()},this.removeOption=function(n,r){for(r=r||!1,n=(n=n||"").toString();e.indexOf(n)!==-1&&(e.splice(e.indexOf(n),1),r!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,18)},set:function(n){n?this.Ff=_n(this.Ff,18):this.Ff=wn(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,19)},set:function(n){this.combo===!0&&(n?this.Ff=_n(this.Ff,19):this.Ff=wn(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,20)},set:function(n){n?(this.Ff=_n(this.Ff,20),e.sort()):this.Ff=wn(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,22)},set:function(n){n?this.Ff=_n(this.Ff,22):this.Ff=wn(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,23)},set:function(n){n?this.Ff=_n(this.Ff,23):this.Ff=wn(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,27)},set:function(n){n?this.Ff=_n(this.Ff,27):this.Ff=wn(this.Ff,27)}}),this.hasAppearanceStream=!1};gr(bs,ni);var ys=function(){bs.call(this),this.fontName="helvetica",this.combo=!1};gr(ys,bs);var _s=function(){ys.call(this),this.combo=!0};gr(_s,ys);var Rl=function(){_s.call(this),this.edit=!0};gr(Rl,_s);var Bn=function(){ni.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,15)},set:function(n){n?this.Ff=_n(this.Ff,15):this.Ff=wn(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,16)},set:function(n){n?this.Ff=_n(this.Ff,16):this.Ff=wn(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,17)},set:function(n){n?this.Ff=_n(this.Ff,17):this.Ff=wn(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,26)},set:function(n){n?this.Ff=_n(this.Ff,26):this.Ff=wn(this.Ff,26)}});var t,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var n=function(i){return i};if(this.scope&&(n=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var r,a=[];for(r in a.push("<<"),e)a.push("/"+r+" ("+Ha(n(e[r]))+")");return a.push(">>"),a.join(`
`)}},set:function(n){Ht(n)==="object"&&(e=n)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(n){typeof n=="string"&&(e.CA=n)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(n){var r=n==null?"":n.toString();r.substr(0,1)==="/"&&(r=r.substr(1)),t="/"+qa(r)}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(n){t="/"+qa(n)}})};gr(Bn,ni);var Fl=function(){Bn.call(this),this.pushButton=!0};gr(Fl,Bn);var ws=function(){Bn.call(this),this.radio=!0,this.pushButton=!1;var t=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e!==void 0?e:[]}})};gr(ws,Bn);var Xl=function(){var t,e;ni.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return t},set:function(a){t=a}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(a){e=a}});var n,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var a=function(l){return l};this.scope&&(a=this.scope.internal.getEncryptor(this.objId));var i,o=[];for(i in o.push("<<"),r)o.push("/"+i+" ("+Ha(a(r[i]))+")");return o.push(">>"),o.join(`
`)},set:function(a){Ht(a)==="object"&&(r=a)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(a){typeof a=="string"&&(r.CA=a)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(a){var i=a==null?"":a.toString();i.substr(0,1)==="/"&&(i=i.substr(1)),n="/"+qa(i)}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(a){var i=a==null?"":a.toString();i.substr(0,1)==="/"&&(i=i.substr(1)),n="/"+qa(i)}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Me.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};gr(Xl,ni),ws.prototype.setAppearance=function(t){if(!("createAppearanceStream"in t)||!("getCA"in t))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var n=this.Kids[e];n.appearanceStreamContent=t.createAppearanceStream(n.optionName),n.caption=t.getCA()}},ws.prototype.createOption=function(t){var e=new Xl;return e.Parent=this,e.optionName=t,this.Kids.push(e),Py.call(this.scope,e),e};var Dl=function(){Bn.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Me.CheckBox.createAppearanceStream()};gr(Dl,Bn);var Ma=function(){ni.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,13)},set:function(e){e?this.Ff=_n(this.Ff,13):this.Ff=wn(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,21)},set:function(e){e?this.Ff=_n(this.Ff,21):this.Ff=wn(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,23)},set:function(e){e?this.Ff=_n(this.Ff,23):this.Ff=wn(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,24)},set:function(e){e?this.Ff=_n(this.Ff,24):this.Ff=wn(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,25)},set:function(e){e?this.Ff=_n(this.Ff,25):this.Ff=wn(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,26)},set:function(e){e?this.Ff=_n(this.Ff,26):this.Ff=wn(this.Ff,26)}});var t=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){Number.isInteger(e)&&(t=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};gr(Ma,ni);var jl=function(){Ma.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,14)},set:function(t){t?this.Ff=_n(this.Ff,14):this.Ff=wn(this.Ff,14)}}),this.password=!0};gr(jl,Ma);var Me={CheckBox:{createAppearanceStream:function(){return{N:{On:Me.CheckBox.YesNormal},D:{On:Me.CheckBox.YesPushDown,Off:Me.CheckBox.OffPushDown}}},YesPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=t.scope.internal.getFont(t.fontName,t.fontStyle).id,a=t.scope.__private__.encodeColorString(t.color),i=id(t,t.caption);return n.push("0.749023 g"),n.push("0 0 "+yt(Me.internal.getWidth(t))+" "+yt(Me.internal.getHeight(t))+" re"),n.push("f"),n.push("BMC"),n.push("q"),n.push("0 0 1 rg"),n.push("/"+r+" "+yt(i.fontSize)+" Tf "+a),n.push("BT"),n.push(i.text),n.push("ET"),n.push("Q"),n.push("EMC"),e.stream=n.join(`
`),e},YesNormal:function(t){var e=pi(t);e.scope=t.scope;var n=t.scope.internal.getFont(t.fontName,t.fontStyle).id,r=t.scope.__private__.encodeColorString(t.color),a=[],i=Me.internal.getHeight(t),o=Me.internal.getWidth(t),l=id(t,t.caption);return a.push("1 g"),a.push("0 0 "+yt(o)+" "+yt(i)+" re"),a.push("f"),a.push("q"),a.push("0 0 1 rg"),a.push("0 0 "+yt(o-1)+" "+yt(i-1)+" re"),a.push("W"),a.push("n"),a.push("0 g"),a.push("BT"),a.push("/"+n+" "+yt(l.fontSize)+" Tf "+r),a.push(l.text),a.push("ET"),a.push("Q"),e.stream=a.join(`
`),e},OffPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+yt(Me.internal.getWidth(t))+" "+yt(Me.internal.getHeight(t))+" re"),n.push("f"),e.stream=n.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(t){var e={D:{Off:Me.RadioButton.Circle.OffPushDown},N:{}};return e.N[t]=Me.RadioButton.Circle.YesNormal,e.D[t]=Me.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=Me.internal.getWidth(t)<=Me.internal.getHeight(t)?Me.internal.getWidth(t)/4:Me.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var a=Me.internal.Bezier_C,i=Number((r*a).toFixed(5));return n.push("q"),n.push("1 0 0 1 "+ia(Me.internal.getWidth(t)/2)+" "+ia(Me.internal.getHeight(t)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+i+" "+i+" "+r+" 0 "+r+" c"),n.push("-"+i+" "+r+" -"+r+" "+i+" -"+r+" 0 c"),n.push("-"+r+" -"+i+" -"+i+" -"+r+" 0 -"+r+" c"),n.push(i+" -"+r+" "+r+" -"+i+" "+r+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join(`
`),e},YesPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=Me.internal.getWidth(t)<=Me.internal.getHeight(t)?Me.internal.getWidth(t)/4:Me.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var a=Number((2*r).toFixed(5)),i=Number((a*Me.internal.Bezier_C).toFixed(5)),o=Number((r*Me.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+ia(Me.internal.getWidth(t)/2)+" "+ia(Me.internal.getHeight(t)/2)+" cm"),n.push(a+" 0 m"),n.push(a+" "+i+" "+i+" "+a+" 0 "+a+" c"),n.push("-"+i+" "+a+" -"+a+" "+i+" -"+a+" 0 c"),n.push("-"+a+" -"+i+" -"+i+" -"+a+" 0 -"+a+" c"),n.push(i+" -"+a+" "+a+" -"+i+" "+a+" 0 c"),n.push("f"),n.push("Q"),n.push("0 g"),n.push("q"),n.push("1 0 0 1 "+ia(Me.internal.getWidth(t)/2)+" "+ia(Me.internal.getHeight(t)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+o+" "+o+" "+r+" 0 "+r+" c"),n.push("-"+o+" "+r+" -"+r+" "+o+" -"+r+" 0 c"),n.push("-"+r+" -"+o+" -"+o+" -"+r+" 0 -"+r+" c"),n.push(o+" -"+r+" "+r+" -"+o+" "+r+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=Me.internal.getWidth(t)<=Me.internal.getHeight(t)?Me.internal.getWidth(t)/4:Me.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var a=Number((2*r).toFixed(5)),i=Number((a*Me.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+ia(Me.internal.getWidth(t)/2)+" "+ia(Me.internal.getHeight(t)/2)+" cm"),n.push(a+" 0 m"),n.push(a+" "+i+" "+i+" "+a+" 0 "+a+" c"),n.push("-"+i+" "+a+" -"+a+" "+i+" -"+a+" 0 c"),n.push("-"+a+" -"+i+" -"+i+" -"+a+" 0 -"+a+" c"),n.push(i+" -"+a+" "+a+" -"+i+" "+a+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join(`
`),e}},Cross:{createAppearanceStream:function(t){var e={D:{Off:Me.RadioButton.Cross.OffPushDown},N:{}};return e.N[t]=Me.RadioButton.Cross.YesNormal,e.D[t]=Me.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=Me.internal.calculateCross(t);return n.push("q"),n.push("1 1 "+yt(Me.internal.getWidth(t)-2)+" "+yt(Me.internal.getHeight(t)-2)+" re"),n.push("W"),n.push("n"),n.push(yt(r.x1.x)+" "+yt(r.x1.y)+" m"),n.push(yt(r.x2.x)+" "+yt(r.x2.y)+" l"),n.push(yt(r.x4.x)+" "+yt(r.x4.y)+" m"),n.push(yt(r.x3.x)+" "+yt(r.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join(`
`),e},YesPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=Me.internal.calculateCross(t),r=[];return r.push("0.749023 g"),r.push("0 0 "+yt(Me.internal.getWidth(t))+" "+yt(Me.internal.getHeight(t))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+yt(Me.internal.getWidth(t)-2)+" "+yt(Me.internal.getHeight(t)-2)+" re"),r.push("W"),r.push("n"),r.push(yt(n.x1.x)+" "+yt(n.x1.y)+" m"),r.push(yt(n.x2.x)+" "+yt(n.x2.y)+" l"),r.push(yt(n.x4.x)+" "+yt(n.x4.y)+" m"),r.push(yt(n.x3.x)+" "+yt(n.x3.y)+" l"),r.push("s"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+yt(Me.internal.getWidth(t))+" "+yt(Me.internal.getHeight(t))+" re"),n.push("f"),e.stream=n.join(`
`),e}}},createDefaultAppearanceStream:function(t){var e=t.scope.internal.getFont(t.fontName,t.fontStyle).id,n=t.scope.__private__.encodeColorString(t.color);return"/"+e+" "+t.fontSize+" Tf "+n}};Me.internal={Bezier_C:.551915024494,calculateCross:function(t){var e=Me.internal.getWidth(t),n=Me.internal.getHeight(t),r=Math.min(e,n);return{x1:{x:(e-r)/2,y:(n-r)/2+r},x2:{x:(e-r)/2+r,y:(n-r)/2},x3:{x:(e-r)/2,y:(n-r)/2},x4:{x:(e-r)/2+r,y:(n-r)/2+r}}}},Me.internal.getWidth=function(t){var e=0;return Ht(t)==="object"&&(e=lp(t.Rect[2])),e},Me.internal.getHeight=function(t){var e=0;return Ht(t)==="object"&&(e=lp(t.Rect[3])),e};var Py=fn.addField=function(t){if(Ty(this,t),!(t instanceof ni))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=t).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),t.page=t.scope.internal.getCurrentPageInfo().pageNumber,this};fn.AcroFormChoiceField=bs,fn.AcroFormListBox=ys,fn.AcroFormComboBox=_s,fn.AcroFormEditBox=Rl,fn.AcroFormButton=Bn,fn.AcroFormPushButton=Fl,fn.AcroFormRadioButton=ws,fn.AcroFormCheckBox=Dl,fn.AcroFormTextField=Ma,fn.AcroFormPasswordField=jl,fn.AcroFormAppearance=Me,fn.AcroForm={ChoiceField:bs,ListBox:ys,ComboBox:_s,EditBox:Rl,Button:Bn,PushButton:Fl,RadioButton:ws,CheckBox:Dl,TextField:Ma,PasswordField:jl,Appearance:Me},Xe.AcroForm={ChoiceField:bs,ListBox:ys,ComboBox:_s,EditBox:Rl,Button:Bn,PushButton:Fl,RadioButton:ws,CheckBox:Dl,TextField:Ma,PasswordField:jl,Appearance:Me};Xe.AcroForm;function am(t){return t.reduce(function(e,n,r){return e[n]=r,e},{})}(function(t){var e="addImage_";t.__addimage__={};var n="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},a=t.__addimage__.getImageFileTypeByImageData=function(k,A){var j,q,K,le,ue,ae=n;if((A=A||n)==="RGBA"||k.data!==void 0&&k.data instanceof Uint8ClampedArray&&"height"in k&&"width"in k)return"RGBA";if(ee(k))for(ue in r)for(K=r[ue],j=0;j<K.length;j+=1){for(le=!0,q=0;q<K[j].length;q+=1)if(K[j][q]!==void 0&&K[j][q]!==k[q]){le=!1;break}if(le===!0){ae=ue;break}}else for(ue in r)for(K=r[ue],j=0;j<K.length;j+=1){for(le=!0,q=0;q<K[j].length;q+=1)if(K[j][q]!==void 0&&K[j][q]!==k.charCodeAt(q)){le=!1;break}if(le===!0){ae=ue;break}}return ae===n&&A!==n&&(ae=A),ae},i=function k(A){for(var j=this.internal.write,q=this.internal.putStream,K=(0,this.internal.getFilters)();K.indexOf("FlateEncode")!==-1;)K.splice(K.indexOf("FlateEncode"),1);A.objectId=this.internal.newObject();var le=[];if(le.push({key:"Type",value:"/XObject"}),le.push({key:"Subtype",value:"/Image"}),le.push({key:"Width",value:A.width}),le.push({key:"Height",value:A.height}),A.colorSpace===x.INDEXED?le.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(A.palette.length/3-1)+" "+("sMask"in A&&A.sMask!==void 0?A.objectId+2:A.objectId+1)+" 0 R]"}):(le.push({key:"ColorSpace",value:"/"+A.colorSpace}),A.colorSpace===x.DEVICE_CMYK&&le.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),le.push({key:"BitsPerComponent",value:A.bitsPerComponent}),"decodeParameters"in A&&A.decodeParameters!==void 0&&le.push({key:"DecodeParms",value:"<<"+A.decodeParameters+">>"}),"transparency"in A&&Array.isArray(A.transparency)&&A.transparency.length>0){for(var ue="",ae=0,ge=A.transparency.length;ae<ge;ae++)ue+=A.transparency[ae]+" "+A.transparency[ae]+" ";le.push({key:"Mask",value:"["+ue+"]"})}A.sMask!==void 0&&le.push({key:"SMask",value:A.objectId+1+" 0 R"});var xe=A.filter!==void 0?["/"+A.filter]:void 0;if(q({data:A.data,additionalKeyValues:le,alreadyAppliedFilters:xe,objectId:A.objectId}),j("endobj"),"sMask"in A&&A.sMask!==void 0){var pe,C=(pe=A.sMaskBitsPerComponent)!==null&&pe!==void 0?pe:A.bitsPerComponent,$={width:A.width,height:A.height,colorSpace:"DeviceGray",bitsPerComponent:C,data:A.sMask};"filter"in A&&($.decodeParameters="/Predictor ".concat(A.predictor," /Colors 1 /BitsPerComponent ").concat(C," /Columns ").concat(A.width),$.filter=A.filter),k.call(this,$)}if(A.colorSpace===x.INDEXED){var V=this.internal.newObject();q({data:X(new Uint8Array(A.palette)),objectId:V}),j("endobj")}},o=function(){var k=this.internal.collections[e+"images"];for(var A in k)i.call(this,k[A])},l=function(){var k,A=this.internal.collections[e+"images"],j=this.internal.write;for(var q in A)j("/I"+(k=A[q]).index,k.objectId,"0","R")},c=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",l))},u=function(){var k=this.internal.collections[e+"images"];return c.call(this),k},h=function(){return Object.keys(this.internal.collections[e+"images"]).length},g=function(k){return typeof t["process"+k.toUpperCase()]=="function"},b=function(k){return Ht(k)==="object"&&k.nodeType===1},p=function(k,A){if(k.nodeName==="IMG"&&k.hasAttribute("src")){var j=""+k.getAttribute("src");if(j.indexOf("data:image/")===0)return Ol(unescape(j).split("base64,").pop());var q=t.loadFile(j,!0);if(q!==void 0)return q}if(k.nodeName==="CANVAS"){if(k.width===0||k.height===0)throw new Error("Given canvas must have data. Canvas width: "+k.width+", height: "+k.height);var K;switch(A){case"PNG":K="image/png";break;case"WEBP":K="image/webp";break;default:K="image/jpeg"}return Ol(k.toDataURL(K,1).split("base64,").pop())}},y=function(k){var A=this.internal.collections[e+"images"];if(A){for(var j in A)if(k===A[j].alias)return A[j]}},_=function(k,A,j){return k||A||(k=-96,A=-96),k<0&&(k=-1*j.width*72/k/this.internal.scaleFactor),A<0&&(A=-1*j.height*72/A/this.internal.scaleFactor),k===0&&(k=A*j.width/j.height),A===0&&(A=k*j.height/j.width),[k,A]},S=function(k,A,j,q,K,le){var ue=_.call(this,j,q,K),ae=this.internal.getCoordinateString,ge=this.internal.getVerticalCoordinateString,xe=u.call(this);if(j=ue[0],q=ue[1],xe[K.index]=K,le){le*=Math.PI/180;var pe=Math.cos(le),C=Math.sin(le),$=function(J){return J.toFixed(4)},V=[$(pe),$(C),$(-1*C),$(pe),0,0,"cm"]}this.internal.write("q"),le?(this.internal.write([1,"0","0",1,ae(k),ge(A+q),"cm"].join(" ")),this.internal.write(V.join(" ")),this.internal.write([ae(j),"0","0",ae(q),"0","0","cm"].join(" "))):this.internal.write([ae(j),"0","0",ae(q),ae(k),ge(A+q),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+K.index+" Do"),this.internal.write("Q")},x=t.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};t.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var T=t.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},O=t.__addimage__.sHashCode=function(k){var A,j,q=0;if(typeof k=="string")for(j=k.length,A=0;A<j;A++)q=(q<<5)-q+k.charCodeAt(A),q|=0;else if(ee(k))for(j=k.byteLength/2,A=0;A<j;A++)q=(q<<5)-q+k[A],q|=0;return q},E=t.__addimage__.validateStringAsBase64=function(k){(k=k||"").toString().trim();var A=!0;return k.length===0&&(A=!1),k.length%4!=0&&(A=!1),/^[A-Za-z0-9+/]+$/.test(k.substr(0,k.length-2))===!1&&(A=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(k.substr(-2))===!1&&(A=!1),A},M=t.__addimage__.extractImageFromDataUrl=function(k){if(k==null||!(k=k.trim()).startsWith("data:"))return null;var A=k.indexOf(",");return A<0?null:k.substring(0,A).trim().endsWith("base64")?k.substring(A+1):null};t.__addimage__.isArrayBuffer=function(k){return k instanceof ArrayBuffer};var ee=t.__addimage__.isArrayBufferView=function(k){return k instanceof Int8Array||k instanceof Uint8Array||k instanceof Uint8ClampedArray||k instanceof Int16Array||k instanceof Uint16Array||k instanceof Int32Array||k instanceof Uint32Array||k instanceof Float32Array||k instanceof Float64Array},G=t.__addimage__.binaryStringToUint8Array=function(k){for(var A=k.length,j=new Uint8Array(A),q=0;q<A;q++)j[q]=k.charCodeAt(q);return j},X=t.__addimage__.arrayBufferToBinaryString=function(k){for(var A="",j=ee(k)?k:new Uint8Array(k),q=0;q<j.length;q+=8192)A+=String.fromCharCode.apply(null,j.subarray(q,q+8192));return A};t.addImage=function(){var k,A,j,q,K,le,ue,ae,ge;if(typeof arguments[1]=="number"?(A=n,j=arguments[1],q=arguments[2],K=arguments[3],le=arguments[4],ue=arguments[5],ae=arguments[6],ge=arguments[7]):(A=arguments[1],j=arguments[2],q=arguments[3],K=arguments[4],le=arguments[5],ue=arguments[6],ae=arguments[7],ge=arguments[8]),Ht(k=arguments[0])==="object"&&!b(k)&&"imageData"in k){var xe=k;k=xe.imageData,A=xe.format||A||n,j=xe.x||j||0,q=xe.y||q||0,K=xe.w||xe.width||K,le=xe.h||xe.height||le,ue=xe.alias||ue,ae=xe.compression||ae,ge=xe.rotation||xe.angle||ge}var pe=this.internal.getFilters();if(ae===void 0&&pe.indexOf("FlateEncode")!==-1&&(ae="SLOW"),isNaN(j)||isNaN(q))throw new Error("Invalid coordinates passed to jsPDF.addImage");c.call(this);var C=F.call(this,k,A,ue,ae);return S.call(this,j,q,K,le,C,ge),this};var F=function(k,A,j,q){var K,le,ue;if(typeof k=="string"&&a(k)===n){k=unescape(k);var ae=I(k,!1);(ae!==""||(ae=t.loadFile(k,!0))!==void 0)&&(k=ae)}if(b(k)&&(k=p(k,A)),A=a(k,A),!g(A))throw new Error("addImage does not support files of type '"+A+"', please ensure that a plugin for '"+A+"' support is added.");if(((ue=j)==null||ue.length===0)&&(j=(function(ge){return typeof ge=="string"||ee(ge)?O(ge):ee(ge.data)?O(ge.data):null})(k)),(K=y.call(this,j))||(k instanceof Uint8Array||A==="RGBA"||(le=k,k=G(k)),K=this["process"+A.toUpperCase()](k,h.call(this),j,(function(ge){return ge&&typeof ge=="string"&&(ge=ge.toUpperCase()),ge in t.image_compression?ge:T.NONE})(q),le)),!K)throw new Error("An unknown error occurred whilst processing the image.");return K},I=t.__addimage__.convertBase64ToBinaryString=function(k,A){A=typeof A!="boolean"||A;var j,q="";if(typeof k=="string"){var K;j=(K=M(k))!==null&&K!==void 0?K:k;try{q=Ol(j)}catch(le){if(A)throw E(j)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+le.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return q};t.getImageProperties=function(k){var A,j,q="";if(b(k)&&(k=p(k)),typeof k=="string"&&a(k)===n&&((q=I(k,!1))===""&&(q=t.loadFile(k)||""),k=q),j=a(k),!g(j))throw new Error("addImage does not support files of type '"+j+"', please ensure that a plugin for '"+j+"' support is added.");if(k instanceof Uint8Array||(k=G(k)),!(A=this["process"+j.toUpperCase()](k)))throw new Error("An unknown error occurred whilst processing the image");return A.fileType=j,A}})(Xe.API),(function(t){var e=function(n){if(n!==void 0&&n!="")return!0};Xe.API.events.push(["addPage",function(n){this.internal.getPageInfo(n.pageNumber).pageContext.annotations=[]}]),t.events.push(["putPage",function(n){for(var r,a,i,o=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,c=this.internal.getPageInfoByObjId(n.objId),u=n.pageContext.annotations,h=!1,g=0;g<u.length&&!h;g++)switch((r=u[g]).type){case"link":(e(r.options.url)||e(r.options.pageNumber))&&(h=!0);break;case"reference":case"text":case"freetext":h=!0}if(h!=0){this.internal.write("/Annots [");for(var b=0;b<u.length;b++){r=u[b];var p=this.internal.pdfEscape,y=this.internal.getEncryptor(n.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var _=this.internal.newAdditionalObject(),S=this.internal.newAdditionalObject(),x=this.internal.getEncryptor(_.objId),T=r.title||"Note";i="<</Type /Annot /Subtype /Text "+(a="/Rect ["+o(r.bounds.x)+" "+l(r.bounds.y+r.bounds.h)+" "+o(r.bounds.x+r.bounds.w)+" "+l(r.bounds.y)+"] ")+"/Contents ("+p(x(r.contents))+")",i+=" /Popup "+S.objId+" 0 R",i+=" /P "+c.objId+" 0 R",i+=" /T ("+p(x(T))+") >>",_.content=i;var O=_.objId+" 0 R";i="<</Type /Annot /Subtype /Popup "+(a="/Rect ["+o(r.bounds.x+30)+" "+l(r.bounds.y+r.bounds.h)+" "+o(r.bounds.x+r.bounds.w+30)+" "+l(r.bounds.y)+"] ")+" /Parent "+O,r.open&&(i+=" /Open true"),i+=" >>",S.content=i,this.internal.write(_.objId,"0 R",S.objId,"0 R");break;case"freetext":a="/Rect ["+o(r.bounds.x)+" "+l(r.bounds.y)+" "+o(r.bounds.x+r.bounds.w)+" "+l(r.bounds.y+r.bounds.h)+"] ";var E=r.color||"#000000";i="<</Type /Annot /Subtype /FreeText "+a+"/Contents ("+p(y(r.contents))+")",i+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+E+")",i+=" /Border [0 0 0]",i+=" >>",this.internal.write(i);break;case"link":if(r.options.name){var M=this.annotations._nameMap[r.options.name];r.options.pageNumber=M.page,r.options.top=M.y}else r.options.top||(r.options.top=0);if(a="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",i="",r.options.url)i="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /A <</S /URI /URI ("+p(y(r.options.url))+") >>";else if(r.options.pageNumber)switch(i="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":i+=" /Fit]";break;case"FitH":i+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,i+=" /FitV "+r.options.left+"]";break;default:var ee=l(r.options.top);r.options.left=r.options.left||0,r.options.zoom===void 0&&(r.options.zoom=0),i+=" /XYZ "+r.options.left+" "+ee+" "+r.options.zoom+"]"}i!=""&&(i+=" >>",this.internal.write(i))}}this.internal.write("]")}}]),t.createAnnotation=function(n){var r=this.internal.getCurrentPageInfo();switch(n.type){case"link":this.link(n.bounds.x,n.bounds.y,n.bounds.w,n.bounds.h,n);break;case"text":case"freetext":r.pageContext.annotations.push(n)}},t.link=function(n,r,a,i,o){var l=this.internal.getCurrentPageInfo(),c=this.internal.getCoordinateString,u=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:c(n),y:u(r),w:c(n+a),h:u(r+i)},options:o,type:"link"})},t.textWithLink=function(n,r,a,i){var o,l,c=this.getTextWidth(n),u=this.internal.getLineHeight()/this.internal.scaleFactor;if(i.maxWidth!==void 0){l=i.maxWidth;var h=this.splitTextToSize(n,l).length;o=Math.ceil(u*h)}else l=c,o=u;return this.text(n,r,a,i),a+=.2*u,i.align==="center"&&(r-=c/2),i.align==="right"&&(r-=c),this.link(r,a-u,l,o,i),c},t.getTextWidth=function(n){var r=this.internal.getFontSize();return this.getStringUnitWidth(n)*r/this.internal.scaleFactor}})(Xe.API),(function(t){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},n={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},a=[1570,1571,1573,1575];t.__arabicParser__={};var i=t.__arabicParser__.isInArabicSubstitutionA=function(_){return e[_.charCodeAt(0)]!==void 0},o=t.__arabicParser__.isArabicLetter=function(_){return typeof _=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(_)},l=t.__arabicParser__.isArabicEndLetter=function(_){return o(_)&&i(_)&&e[_.charCodeAt(0)].length<=2},c=t.__arabicParser__.isArabicAlfLetter=function(_){return o(_)&&a.indexOf(_.charCodeAt(0))>=0};t.__arabicParser__.arabicLetterHasIsolatedForm=function(_){return o(_)&&i(_)&&e[_.charCodeAt(0)].length>=1};var u=t.__arabicParser__.arabicLetterHasFinalForm=function(_){return o(_)&&i(_)&&e[_.charCodeAt(0)].length>=2};t.__arabicParser__.arabicLetterHasInitialForm=function(_){return o(_)&&i(_)&&e[_.charCodeAt(0)].length>=3};var h=t.__arabicParser__.arabicLetterHasMedialForm=function(_){return o(_)&&i(_)&&e[_.charCodeAt(0)].length==4},g=t.__arabicParser__.resolveLigatures=function(_){var S=0,x=n,T="",O=0;for(S=0;S<_.length;S+=1)x[_.charCodeAt(S)]!==void 0?(O++,typeof(x=x[_.charCodeAt(S)])=="number"&&(T+=String.fromCharCode(x),x=n,O=0),S===_.length-1&&(x=n,T+=_.charAt(S-(O-1)),S-=O-1,O=0)):(x=n,T+=_.charAt(S-O),S-=O,O=0);return T};t.__arabicParser__.isArabicDiacritic=function(_){return _!==void 0&&r[_.charCodeAt(0)]!==void 0};var b=t.__arabicParser__.getCorrectForm=function(_,S,x){return o(_)?i(_)===!1?-1:!u(_)||!o(S)&&!o(x)||!o(x)&&l(S)||l(_)&&!o(S)||l(_)&&c(S)||l(_)&&l(S)?0:h(_)&&o(S)&&!l(S)&&o(x)&&u(x)?3:l(_)||!o(x)?1:2:-1},p=function(_){var S=0,x=0,T=0,O="",E="",M="",ee=(_=_||"").split("\\s+"),G=[];for(S=0;S<ee.length;S+=1){for(G.push(""),x=0;x<ee[S].length;x+=1)O=ee[S][x],E=ee[S][x-1],M=ee[S][x+1],o(O)?(T=b(O,E,M),G[S]+=T!==-1?String.fromCharCode(e[O.charCodeAt(0)][T]):O):G[S]+=O;G[S]=g(G[S])}return G.join(" ")},y=t.__arabicParser__.processArabic=t.processArabic=function(){var _,S=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,x=[];if(Array.isArray(S)){var T=0;for(x=[],T=0;T<S.length;T+=1)Array.isArray(S[T])?x.push([p(S[T][0]),S[T][1],S[T][2]]):x.push([p(S[T])]);_=x}else _=p(S);return typeof arguments[0]=="string"?_:(arguments[0].text=_,arguments[0])};t.events.push(["preProcessText",y])})(Xe.API),Xe.API.autoPrint=function(t){var e;return(t=t||{}).variant=t.variant||"non-conform",t.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},(function(t){var e=function(){var n=void 0;Object.defineProperty(this,"pdf",{get:function(){return n},set:function(l){n=l}});var r=150;Object.defineProperty(this,"width",{get:function(){return r},set:function(l){r=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=r+1)}});var a=300;Object.defineProperty(this,"height",{get:function(){return a},set:function(l){a=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=a+1)}});var i=[];Object.defineProperty(this,"childNodes",{get:function(){return i},set:function(l){i=l}});var o={};Object.defineProperty(this,"style",{get:function(){return o},set:function(l){o=l}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(n,r){var a;if((n=n||"2d")!=="2d")return null;for(a in r)this.pdf.context2d.hasOwnProperty(a)&&(this.pdf.context2d[a]=r[a]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},t.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])})(Xe.API),(function(t){var e={left:0,top:0,bottom:0,right:0},n=!1,r=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),a.call(this))},a=function(){this.internal.__cell__.lastCell=new i,this.internal.__cell__.pages=1},i=function(){var c=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return c},set:function(_){c=_}});var u=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return u},set:function(_){u=_}});var h=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return h},set:function(_){h=_}});var g=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return g},set:function(_){g=_}});var b=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return b},set:function(_){b=_}});var p=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return p},set:function(_){p=_}});var y=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return y},set:function(_){y=_}}),this};i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},i.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},t.setHeaderFunction=function(c){return r.call(this),this.internal.__cell__.headerFunction=typeof c=="function"?c:void 0,this},t.getTextDimensions=function(c,u){r.call(this);var h=(u=u||{}).fontSize||this.getFontSize(),g=u.font||this.getFont(),b=u.scaleFactor||this.internal.scaleFactor,p=0,y=0,_=0,S=this;if(!Array.isArray(c)&&typeof c!="string"){if(typeof c!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");c=String(c)}var x=u.maxWidth;x>0?typeof c=="string"?c=this.splitTextToSize(c,x):Object.prototype.toString.call(c)==="[object Array]"&&(c=c.reduce(function(O,E){return O.concat(S.splitTextToSize(E,x))},[])):c=Array.isArray(c)?c:[c];for(var T=0;T<c.length;T++)p<(_=this.getStringUnitWidth(c[T],{font:g})*h)&&(p=_);return p!==0&&(y=c.length),{w:p/=b,h:Math.max((y*h*this.getLineHeightFactor()-h*(this.getLineHeightFactor()-1))/b,0)}},t.cellAddPage=function(){r.call(this),this.addPage();var c=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new i(c.left,c.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var o=t.cell=function(){var c;c=arguments[0]instanceof i?arguments[0]:new i(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),r.call(this);var u=this.internal.__cell__.lastCell,h=this.internal.__cell__.padding,g=this.internal.__cell__.margins||e,b=this.internal.__cell__.tableHeaderRow,p=this.internal.__cell__.printHeaders;return u.lineNumber!==void 0&&(u.lineNumber===c.lineNumber?(c.x=(u.x||0)+(u.width||0),c.y=u.y||0):u.y+u.height+c.height+g.bottom>this.getPageHeight()?(this.cellAddPage(),c.y=g.top,p&&b&&(this.printHeaderRow(c.lineNumber,!0),c.y+=b[0].height)):c.y=u.y+u.height||c.y),c.text[0]!==void 0&&(this.rect(c.x,c.y,c.width,c.height,n===!0?"FD":void 0),c.align==="right"?this.text(c.text,c.x+c.width-h,c.y+h,{align:"right",baseline:"top"}):c.align==="center"?this.text(c.text,c.x+c.width/2,c.y+h,{align:"center",baseline:"top",maxWidth:c.width-h-h}):this.text(c.text,c.x+h,c.y+h,{align:"left",baseline:"top",maxWidth:c.width-h-h})),this.internal.__cell__.lastCell=c,this};t.table=function(c,u,h,g,b){if(r.call(this),!h)throw new Error("No data for PDF table.");var p,y,_,S,x=[],T=[],O=[],E={},M={},ee=[],G=[],X=(b=b||{}).autoSize||!1,F=b.printHeaders!==!1,I=b.css&&b.css["font-size"]!==void 0?16*b.css["font-size"]:b.fontSize||12,k=b.margins||Object.assign({width:this.getPageWidth()},e),A=typeof b.padding=="number"?b.padding:3,j=b.headerBackgroundColor||"#c8c8c8",q=b.headerTextColor||"#000";if(a.call(this),this.internal.__cell__.printHeaders=F,this.internal.__cell__.margins=k,this.internal.__cell__.table_font_size=I,this.internal.__cell__.padding=A,this.internal.__cell__.headerBackgroundColor=j,this.internal.__cell__.headerTextColor=q,this.setFontSize(I),g==null)T=x=Object.keys(h[0]),O=x.map(function(){return"left"});else if(Array.isArray(g)&&Ht(g[0])==="object")for(x=g.map(function(xe){return xe.name}),T=g.map(function(xe){return xe.prompt||xe.name||""}),O=g.map(function(xe){return xe.align||"left"}),p=0;p<g.length;p+=1)M[g[p].name]=.7499990551181103*g[p].width;else Array.isArray(g)&&typeof g[0]=="string"&&(T=x=g,O=x.map(function(){return"left"}));if(X||Array.isArray(g)&&typeof g[0]=="string")for(p=0;p<x.length;p+=1){for(E[S=x[p]]=h.map(function(xe){return xe[S]}),this.setFont(void 0,"bold"),ee.push(this.getTextDimensions(T[p],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),y=E[S],this.setFont(void 0,"normal"),_=0;_<y.length;_+=1)ee.push(this.getTextDimensions(y[_],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);M[S]=Math.max.apply(null,ee)+A+A,ee=[]}if(F){var K={};for(p=0;p<x.length;p+=1)K[x[p]]={},K[x[p]].text=T[p],K[x[p]].align=O[p];var le=l.call(this,K,M);G=x.map(function(xe){return new i(c,u,M[xe],le,K[xe].text,void 0,K[xe].align)}),this.setTableHeaderRow(G),this.printHeaderRow(1,!1)}var ue=g.reduce(function(xe,pe){return xe[pe.name]=pe.align,xe},{});for(p=0;p<h.length;p+=1){"rowStart"in b&&b.rowStart instanceof Function&&b.rowStart({row:p,data:h[p]},this);var ae=l.call(this,h[p],M);for(_=0;_<x.length;_+=1){var ge=h[p][x[_]];"cellStart"in b&&b.cellStart instanceof Function&&b.cellStart({row:p,col:_,data:ge},this),o.call(this,new i(c,u,M[x[_]],ae,ge,p+2,ue[x[_]]))}}return this.internal.__cell__.table_x=c,this.internal.__cell__.table_y=u,this};var l=function(c,u){var h=this.internal.__cell__.padding,g=this.internal.__cell__.table_font_size,b=this.internal.scaleFactor;return Object.keys(c).map(function(p){var y=c[p];return this.splitTextToSize(y.hasOwnProperty("text")?y.text:y,u[p]-h-h)},this).map(function(p){return this.getLineHeightFactor()*p.length*g/b+h+h},this).reduce(function(p,y){return Math.max(p,y)},0)};t.setTableHeaderRow=function(c){r.call(this),this.internal.__cell__.tableHeaderRow=c},t.printHeaderRow=function(c,u){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var h;if(n=!0,typeof this.internal.__cell__.headerFunction=="function"){var g=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new i(g[0],g[1],g[2],g[3],void 0,-1)}this.setFont(void 0,"bold");for(var b=[],p=0;p<this.internal.__cell__.tableHeaderRow.length;p+=1){h=this.internal.__cell__.tableHeaderRow[p].clone(),u&&(h.y=this.internal.__cell__.margins.top||0,b.push(h)),h.lineNumber=c;var y=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),o.call(this,h),this.setTextColor(y)}b.length>0&&this.setTableHeaderRow(b),this.setFont(void 0,"normal"),n=!1}})(Xe.API);var sm={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},om=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],ad=am(om),lm=[100,200,300,400,500,600,700,800,900],Iy=am(lm);function wu(t){var e=t.family.replace(/"|'/g,"").toLowerCase(),n=(function(i){return sm[i=i||"normal"]?i:"normal"})(t.style),r=(function(i){return i?typeof i=="number"?i>=100&&i<=900&&i%100==0?i:400:/^\d00$/.test(i)?parseInt(i):i==="bold"?700:400:400})(t.weight),a=(function(i){return typeof ad[i=i||"normal"]=="number"?i:"normal"})(t.stretch);return{family:e,style:n,weight:r,stretch:a,src:t.src||[],ref:t.ref||{name:e,style:[a,n,r].join(" ")}}}function cp(t,e,n,r){var a;for(a=n;a>=0&&a<e.length;a+=r)if(t[e[a]])return t[e[a]];for(a=n;a>=0&&a<e.length;a-=r)if(t[e[a]])return t[e[a]]}var Oy={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},up={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function dp(t){return[t.stretch,t.style,t.weight,t.family].join(" ")}function hp(t){return t.trimLeft()}function Ry(t,e){for(var n=0;n<t.length;){if(t.charAt(n)===e)return[t.substring(0,n),t.substring(n+1)];n+=1}return null}function Fy(t){var e=t.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],t.substring(e[0].length)]}var cs,El,fp,pp,gp,xu=["times"];function mp(t,e,n,r,a){var i=4,o=bp;switch(a){case Xe.API.image_compression.FAST:i=1,o=vp;break;case Xe.API.image_compression.MEDIUM:i=6,o=yp;break;case Xe.API.image_compression.SLOW:i=9,o=_p}t=(function(c,u,h,g){for(var b,p=c.length/u,y=new Uint8Array(c.length+p),_=[Dy,vp,bp,yp,_p],S=0;S<p;S+=1){var x=S*u,T=c.subarray(x,x+u);if(g)y.set(g(T,h,b),x+S);else{for(var O=_.length,E=[],M=0;M<O;M+=1)E[M]=_[M](T,h,b);var ee=By(E.concat());y.set(E[ee],x+S)}b=T}return y})(t,e,Math.ceil(n*r/8),o);var l=Zu(t,{level:i});return Xe.API.__addimage__.arrayBufferToBinaryString(l)}function Dy(t){var e=Array.apply([],t);return e.unshift(0),e}function vp(t,e){var n=t.length,r=[];r[0]=1;for(var a=0;a<n;a+=1){var i=t[a-e]||0;r[a+1]=t[a]-i+256&255}return r}function bp(t,e,n){var r=t.length,a=[];a[0]=2;for(var i=0;i<r;i+=1){var o=n&&n[i]||0;a[i+1]=t[i]-o+256&255}return a}function yp(t,e,n){var r=t.length,a=[];a[0]=3;for(var i=0;i<r;i+=1){var o=t[i-e]||0,l=n&&n[i]||0;a[i+1]=t[i]+256-(o+l>>>1)&255}return a}function _p(t,e,n){var r=t.length,a=[];a[0]=4;for(var i=0;i<r;i+=1){var o=jy(t[i-e]||0,n&&n[i]||0,n&&n[i-e]||0);a[i+1]=t[i]-o+256&255}return a}function jy(t,e,n){if(t===e&&e===n)return t;var r=Math.abs(e-n),a=Math.abs(t-n),i=Math.abs(t+e-n-n);return r<=a&&r<=i?t:a<=i?e:n}function By(t){var e=t.map(function(n){return n.reduce(function(r,a){return r+Math.abs(a)},0)});return e.indexOf(Math.min.apply(null,e))}function Su(t,e,n){var r=e*n,a=Math.floor(r/8),i=16-(r-8*a+n),o=(1<<n)-1;return cm(t,a)>>i&o}function wp(t,e,n,r){var a=n*r,i=Math.floor(a/8),o=16-(a-8*i+r),l=(1<<r)-1,c=(e&l)<<o;(function(u,h,g){if(h+1<u.byteLength)u.setUint16(h,g,!1);else{var b=g>>8&255;u.setUint8(h,b)}})(t,i,cm(t,i)&~(l<<o)&65535|c)}function cm(t,e){return e+1<t.byteLength?t.getUint16(e,!1):t.getUint8(e)<<8}function My(t){var e=0;if(t[e++]!==71||t[e++]!==73||t[e++]!==70||t[e++]!==56||(t[e++]+1&253)!=56||t[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var n=t[e++]|t[e++]<<8,r=t[e++]|t[e++]<<8,a=t[e++],i=a>>7,o=1<<1+(7&a);t[e++],t[e++];var l=null,c=null;i&&(l=e,c=o,e+=3*o);var u=!0,h=[],g=0,b=null,p=0,y=null;for(this.width=n,this.height=r;u&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(t[e]!==11||t[e+1]==78&&t[e+2]==69&&t[e+3]==84&&t[e+4]==83&&t[e+5]==67&&t[e+6]==65&&t[e+7]==80&&t[e+8]==69&&t[e+9]==50&&t[e+10]==46&&t[e+11]==48&&t[e+12]==3&&t[e+13]==1&&t[e+16]==0)e+=14,y=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((k=t[e++])>=0))throw Error("Invalid block size");if(k===0)break;e+=k}break;case 249:if(t[e++]!==4||t[e+4]!==0)throw new Error("Invalid graphics extension block.");var _=t[e++];g=t[e++]|t[e++]<<8,b=t[e++],1&_||(b=null),p=_>>2&7,e++;break;case 254:for(;;){if(!((k=t[e++])>=0))throw Error("Invalid block size");if(k===0)break;e+=k}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var S=t[e++]|t[e++]<<8,x=t[e++]|t[e++]<<8,T=t[e++]|t[e++]<<8,O=t[e++]|t[e++]<<8,E=t[e++],M=E>>6&1,ee=1<<1+(7&E),G=l,X=c,F=!1;E>>7&&(F=!0,G=e,X=ee,e+=3*ee);var I=e;for(e++;;){var k;if(!((k=t[e++])>=0))throw Error("Invalid block size");if(k===0)break;e+=k}h.push({x:S,y:x,width:T,height:O,has_local_palette:F,palette_offset:G,palette_size:X,data_offset:I,data_length:e-I,transparent_index:b,interlaced:!!M,delay:g,disposal:p});break;case 59:u=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return h.length},this.loopCount=function(){return y},this.frameInfo=function(A){if(A<0||A>=h.length)throw new Error("Frame index out of range.");return h[A]},this.decodeAndBlitFrameBGRA=function(A,j){var q=this.frameInfo(A),K=q.width*q.height;if(K>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");var le=new Uint8Array(K);xp(t,q.data_offset,le,K);var ue=q.palette_offset,ae=q.transparent_index;ae===null&&(ae=256);var ge=q.width,xe=n-ge,pe=ge,C=4*(q.y*n+q.x),$=4*((q.y+q.height)*n+q.x),V=C,J=4*xe;q.interlaced===!0&&(J+=4*n*7);for(var Z=8,ie=0,fe=le.length;ie<fe;++ie){var Y=le[ie];if(pe===0&&(pe=ge,(V+=J)>=$&&(J=4*xe+4*n*(Z-1),V=C+(ge+xe)*(Z<<1),Z>>=1)),Y===ae)V+=4;else{var se=t[ue+3*Y],be=t[ue+3*Y+1],Ce=t[ue+3*Y+2];j[V++]=Ce,j[V++]=be,j[V++]=se,j[V++]=255}--pe}},this.decodeAndBlitFrameRGBA=function(A,j){var q=this.frameInfo(A),K=q.width*q.height;if(K>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");var le=new Uint8Array(K);xp(t,q.data_offset,le,K);var ue=q.palette_offset,ae=q.transparent_index;ae===null&&(ae=256);var ge=q.width,xe=n-ge,pe=ge,C=4*(q.y*n+q.x),$=4*((q.y+q.height)*n+q.x),V=C,J=4*xe;q.interlaced===!0&&(J+=4*n*7);for(var Z=8,ie=0,fe=le.length;ie<fe;++ie){var Y=le[ie];if(pe===0&&(pe=ge,(V+=J)>=$&&(J=4*xe+4*n*(Z-1),V=C+(ge+xe)*(Z<<1),Z>>=1)),Y===ae)V+=4;else{var se=t[ue+3*Y],be=t[ue+3*Y+1],Ce=t[ue+3*Y+2];j[V++]=se,j[V++]=be,j[V++]=Ce,j[V++]=255}--pe}}}function xp(t,e,n,r){for(var a=t[e++],i=1<<a,o=i+1,l=o+1,c=a+1,u=(1<<c)-1,h=0,g=0,b=0,p=t[e++],y=new Int32Array(4096),_=null;;){for(;h<16&&p!==0;)g|=t[e++]<<h,h+=8,p===1?p=t[e++]:--p;if(h<c)break;var S=g&u;if(g>>=c,h-=c,S!==i){if(S===o)break;for(var x=S<l?S:_,T=0,O=x;O>i;)O=y[O]>>8,++T;var E=O;if(b+T+(x!==S?1:0)>r)return void Kt.log("Warning, gif stream longer than expected.");n[b++]=E;var M=b+=T;for(x!==S&&(n[b++]=E),O=x;T--;)O=y[O],n[--M]=255&O,O>>=8;_!==null&&l<4096&&(y[l++]=_<<8|E,l>=u+1&&c<12&&(++c,u=u<<1|1)),_=S}else l=o+1,u=(1<<(c=a+1))-1,_=null}return b!==r&&Kt.log("Warning, gif stream shorter than expected."),n}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function Au(t){var e,n,r,a,i,o=Math.floor,l=new Array(64),c=new Array(64),u=new Array(64),h=new Array(64),g=new Array(65535),b=new Array(65535),p=new Array(64),y=new Array(64),_=[],S=0,x=7,T=new Array(64),O=new Array(64),E=new Array(64),M=new Array(256),ee=new Array(2048),G=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],X=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],F=[0,1,2,3,4,5,6,7,8,9,10,11],I=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],k=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],A=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],j=[0,1,2,3,4,5,6,7,8,9,10,11],q=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],K=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function le(C,$){for(var V=0,J=0,Z=new Array,ie=1;ie<=16;ie++){for(var fe=1;fe<=C[ie];fe++)Z[$[J]]=[],Z[$[J]][0]=V,Z[$[J]][1]=ie,J++,V++;V*=2}return Z}function ue(C){for(var $=C[0],V=C[1]-1;V>=0;)$&1<<V&&(S|=1<<x),V--,--x<0&&(S==255?(ae(255),ae(0)):ae(S),x=7,S=0)}function ae(C){_.push(C)}function ge(C){ae(C>>8&255),ae(255&C)}function xe(C,$,V,J,Z){for(var ie,fe=Z[0],Y=Z[240],se=(function(Se,Ke){var Re,Qe,Ie,it,nt,at,ut,pt,ze,mt,We=0;for(ze=0;ze<8;++ze){Re=Se[We],Qe=Se[We+1],Ie=Se[We+2],it=Se[We+3],nt=Se[We+4],at=Se[We+5],ut=Se[We+6];var rn=Re+(pt=Se[We+7]),Et=Re-pt,bt=Qe+ut,ct=Qe-ut,Dt=Ie+at,et=Ie-at,jt=it+nt,st=it-nt,dt=rn+jt,Ut=rn-jt,kt=bt+Dt,tt=bt-Dt;Se[We]=dt+kt,Se[We+4]=dt-kt;var Ft=.707106781*(tt+Ut);Se[We+2]=Ut+Ft,Se[We+6]=Ut-Ft;var yi=.382683433*((dt=st+et)-(tt=ct+Et)),Ct=.5411961*dt+yi,Vn=1.306562965*tt+yi,Tr=.707106781*(kt=et+ct),rt=Et+Tr,mr=Et-Tr;Se[We+5]=mr+Ct,Se[We+3]=mr-Ct,Se[We+1]=rt+Vn,Se[We+7]=rt-Vn,We+=8}for(We=0,ze=0;ze<8;++ze){Re=Se[We],Qe=Se[We+8],Ie=Se[We+16],it=Se[We+24],nt=Se[We+32],at=Se[We+40],ut=Se[We+48];var Pr=Re+(pt=Se[We+56]),er=Re-pt,cr=Qe+ut,It=Qe-ut,Yt=Ie+at,xn=Ie-at,ii=it+nt,Ir=it-nt,ur=Pr+ii,Sn=Pr-ii,dr=cr+Yt,hr=cr-Yt;Se[We]=ur+dr,Se[We+32]=ur-dr;var tr=.707106781*(hr+Sn);Se[We+16]=Sn+tr,Se[We+48]=Sn-tr;var ai=.382683433*((ur=Ir+xn)-(hr=It+er)),Or=.5411961*ur+ai,Ue=1.306562965*hr+ai,te=.707106781*(dr=xn+It),Ee=er+te,Fe=er-te;Se[We+40]=Fe+Or,Se[We+24]=Fe-Or,Se[We+8]=Ee+Ue,Se[We+56]=Ee-Ue,We++}for(ze=0;ze<64;++ze)mt=Se[ze]*Ke[ze],p[ze]=mt>0?mt+.5|0:mt-.5|0;return p})(C,$),be=0;be<64;++be)y[G[be]]=se[be];var Ce=y[0]-V;V=y[0],Ce==0?ue(J[0]):(ue(J[b[ie=32767+Ce]]),ue(g[ie]));for(var Te=63;Te>0&&y[Te]==0;)Te--;if(Te==0)return ue(fe),V;for(var De,U=1;U<=Te;){for(var Pe=U;y[U]==0&&U<=Te;)++U;var ht=U-Pe;if(ht>=16){De=ht>>4;for(var He=1;He<=De;++He)ue(Y);ht&=15}ie=32767+y[U],ue(Z[(ht<<4)+b[ie]]),ue(g[ie]),U++}return Te!=63&&ue(fe),V}function pe(C){C=Math.min(Math.max(C,1),100),i!=C&&((function($){for(var V=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],J=0;J<64;J++){var Z=o((V[J]*$+50)/100);Z=Math.min(Math.max(Z,1),255),l[G[J]]=Z}for(var ie=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],fe=0;fe<64;fe++){var Y=o((ie[fe]*$+50)/100);Y=Math.min(Math.max(Y,1),255),c[G[fe]]=Y}for(var se=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],be=0,Ce=0;Ce<8;Ce++)for(var Te=0;Te<8;Te++)u[be]=1/(l[G[be]]*se[Ce]*se[Te]*8),h[be]=1/(c[G[be]]*se[Ce]*se[Te]*8),be++})(C<50?Math.floor(5e3/C):Math.floor(200-2*C)),i=C)}this.encode=function(C,$){$&&pe($),_=new Array,S=0,x=7,ge(65496),ge(65504),ge(16),ae(74),ae(70),ae(73),ae(70),ae(0),ae(1),ae(1),ae(0),ge(1),ge(1),ae(0),ae(0),(function(){ge(65499),ge(132),ae(0);for(var Qe=0;Qe<64;Qe++)ae(l[Qe]);ae(1);for(var Ie=0;Ie<64;Ie++)ae(c[Ie])})(),(function(Qe,Ie){ge(65472),ge(17),ae(8),ge(Ie),ge(Qe),ae(3),ae(1),ae(17),ae(0),ae(2),ae(17),ae(1),ae(3),ae(17),ae(1)})(C.width,C.height),(function(){ge(65476),ge(418),ae(0);for(var Qe=0;Qe<16;Qe++)ae(X[Qe+1]);for(var Ie=0;Ie<=11;Ie++)ae(F[Ie]);ae(16);for(var it=0;it<16;it++)ae(I[it+1]);for(var nt=0;nt<=161;nt++)ae(k[nt]);ae(1);for(var at=0;at<16;at++)ae(A[at+1]);for(var ut=0;ut<=11;ut++)ae(j[ut]);ae(17);for(var pt=0;pt<16;pt++)ae(q[pt+1]);for(var ze=0;ze<=161;ze++)ae(K[ze])})(),ge(65498),ge(12),ae(3),ae(1),ae(0),ae(2),ae(17),ae(3),ae(17),ae(0),ae(63),ae(0);var V=0,J=0,Z=0;S=0,x=7,this.encode.displayName="_encode_";for(var ie,fe,Y,se,be,Ce,Te,De,U,Pe=C.data,ht=C.width,He=C.height,Se=4*ht,Ke=0;Ke<He;){for(ie=0;ie<Se;){for(be=Se*Ke+ie,Te=-1,De=0,U=0;U<64;U++)Ce=be+(De=U>>3)*Se+(Te=4*(7&U)),Ke+De>=He&&(Ce-=Se*(Ke+1+De-He)),ie+Te>=Se&&(Ce-=ie+Te-Se+4),fe=Pe[Ce++],Y=Pe[Ce++],se=Pe[Ce++],T[U]=(ee[fe]+ee[Y+256|0]+ee[se+512|0]>>16)-128,O[U]=(ee[fe+768|0]+ee[Y+1024|0]+ee[se+1280|0]>>16)-128,E[U]=(ee[fe+1280|0]+ee[Y+1536|0]+ee[se+1792|0]>>16)-128;V=xe(T,u,V,e,r),J=xe(O,h,J,n,a),Z=xe(E,h,Z,n,a),ie+=32}Ke+=8}if(x>=0){var Re=[];Re[1]=x+1,Re[0]=(1<<x+1)-1,ue(Re)}return ge(65497),new Uint8Array(_)},t=t||50,(function(){for(var C=String.fromCharCode,$=0;$<256;$++)M[$]=C($)})(),e=le(X,F),n=le(A,j),r=le(I,k),a=le(q,K),(function(){for(var C=1,$=2,V=1;V<=15;V++){for(var J=C;J<$;J++)b[32767+J]=V,g[32767+J]=[],g[32767+J][1]=V,g[32767+J][0]=J;for(var Z=-($-1);Z<=-C;Z++)b[32767+Z]=V,g[32767+Z]=[],g[32767+Z][1]=V,g[32767+Z][0]=$-1+Z;C<<=1,$<<=1}})(),(function(){for(var C=0;C<256;C++)ee[C]=19595*C,ee[C+256|0]=38470*C,ee[C+512|0]=7471*C+32768,ee[C+768|0]=-11059*C,ee[C+1024|0]=-21709*C,ee[C+1280|0]=32768*C+8421375,ee[C+1536|0]=-27439*C,ee[C+1792|0]=-5329*C})(),pe(t)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Kr(t,e){if(this.pos=0,this.buffer=t,this.datav=new DataView(t.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function Sp(t){function e(F){if(!F)throw Error("assert :P")}function n(F,I,k){for(var A=0;4>A;A++)if(F[I+A]!=k.charCodeAt(A))return!0;return!1}function r(F,I,k,A,j){for(var q=0;q<j;q++)F[I+q]=k[A+q]}function a(F,I,k,A){for(var j=0;j<A;j++)F[I+j]=k}function i(F){return new Int32Array(F)}function o(F,I){for(var k=[],A=0;A<F;A++)k.push(new I);return k}function l(F,I){var k=[];return(function A(j,q,K){for(var le=K[q],ue=0;ue<le&&(j.push(K.length>q+1?[]:new I),!(K.length<q+1));ue++)A(j[ue],q+1,K)})(k,0,F),k}var c=function(){var F=this;function I(d,f){for(var v=1<<f-1>>>0;d&v;)v>>>=1;return v?(d&v-1)+v:d}function k(d,f,v,w,L){e(!(w%v));do d[f+(w-=v)]=L;while(0<w)}function A(d,f,v,w,L){if(e(2328>=L),512>=L)var P=i(512);else if((P=i(L))==null)return 0;return(function(R,D,B,z,ne,he){var H,re,ce=D,ve=1<<B,de=i(16),ye=i(16);for(e(ne!=0),e(z!=null),e(R!=null),e(0<B),re=0;re<ne;++re){if(15<z[re])return 0;++de[z[re]]}if(de[0]==ne)return 0;for(ye[1]=0,H=1;15>H;++H){if(de[H]>1<<H)return 0;ye[H+1]=ye[H]+de[H]}for(re=0;re<ne;++re)H=z[re],0<z[re]&&(he[ye[H]++]=re);if(ye[15]==1)return(z=new j).g=0,z.value=he[0],k(R,ce,1,ve,z),ve;var we,Le=-1,ke=ve-1,Ze=0,je=1,St=1,Ge=1<<B;for(re=0,H=1,ne=2;H<=B;++H,ne<<=1){if(je+=St<<=1,0>(St-=de[H]))return 0;for(;0<de[H];--de[H])(z=new j).g=H,z.value=he[re++],k(R,ce+Ze,ne,Ge,z),Ze=I(Ze,H)}for(H=B+1,ne=2;15>=H;++H,ne<<=1){if(je+=St<<=1,0>(St-=de[H]))return 0;for(;0<de[H];--de[H]){if(z=new j,(Ze&ke)!=Le){for(ce+=Ge,we=1<<(Le=H)-B;15>Le&&!(0>=(we-=de[Le]));)++Le,we<<=1;ve+=Ge=1<<(we=Le-B),R[D+(Le=Ze&ke)].g=we+B,R[D+Le].value=ce-D-Le}z.g=H-B,z.value=he[re++],k(R,ce+(Ze>>B),ne,Ge,z),Ze=I(Ze,H)}}return je!=2*ye[15]-1?0:ve})(d,f,v,w,L,P)}function j(){this.value=this.g=0}function q(){this.value=this.g=0}function K(){this.G=o(5,j),this.H=i(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=o(Aa,q)}function le(d,f,v,w){e(d!=null),e(f!=null),e(2147483648>w),d.Ca=254,d.I=0,d.b=-8,d.Ka=0,d.oa=f,d.pa=v,d.Jd=f,d.Yc=v+w,d.Zc=4<=w?v+w-4+1:v,fe(d)}function ue(d,f){for(var v=0;0<f--;)v|=se(d,128)<<f;return v}function ae(d,f){var v=ue(d,f);return Y(d)?-v:v}function ge(d,f,v,w){var L,P=0;for(e(d!=null),e(f!=null),e(4294967288>w),d.Sb=w,d.Ra=0,d.u=0,d.h=0,4<w&&(w=4),L=0;L<w;++L)P+=f[v+L]<<8*L;d.Ra=P,d.bb=w,d.oa=f,d.pa=v}function xe(d){for(;8<=d.u&&d.bb<d.Sb;)d.Ra>>>=8,d.Ra+=d.oa[d.pa+d.bb]<<Wi-8>>>0,++d.bb,d.u-=8;J(d)&&(d.h=1,d.u=0)}function pe(d,f){if(e(0<=f),!d.h&&f<=br){var v=V(d)&vr[f];return d.u+=f,xe(d),v}return d.h=1,d.u=0}function C(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function $(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function V(d){return d.Ra>>>(d.u&Wi-1)>>>0}function J(d){return e(d.bb<=d.Sb),d.h||d.bb==d.Sb&&d.u>Wi}function Z(d,f){d.u=f,d.h=J(d)}function ie(d){d.u>=Ti&&(e(d.u>=Ti),xe(d))}function fe(d){e(d!=null&&d.oa!=null),d.pa<d.Zc?(d.I=(d.oa[d.pa++]|d.I<<8)>>>0,d.b+=8):(e(d!=null&&d.oa!=null),d.pa<d.Yc?(d.b+=8,d.I=d.oa[d.pa++]|d.I<<8):d.Ka?d.b=0:(d.I<<=8,d.b+=8,d.Ka=1))}function Y(d){return ue(d,1)}function se(d,f){var v=d.Ca;0>d.b&&fe(d);var w=d.b,L=v*f>>>8,P=(d.I>>>w>L)+0;for(P?(v-=L,d.I-=L+1<<w>>>0):v=L+1,w=v,L=0;256<=w;)L+=8,w>>=8;return w=7^L+Gi[w],d.b-=w,d.Ca=(v<<w)-1,P}function be(d,f,v){d[f+0]=v>>24&255,d[f+1]=v>>16&255,d[f+2]=v>>8&255,d[f+3]=255&v}function Ce(d,f){return d[f+0]|d[f+1]<<8}function Te(d,f){return Ce(d,f)|d[f+2]<<16}function De(d,f){return Ce(d,f)|Ce(d,f+2)<<16}function U(d,f){var v=1<<f;return e(d!=null),e(0<f),d.X=i(v),d.X==null?0:(d.Mb=32-f,d.Xa=f,1)}function Pe(d,f){e(d!=null),e(f!=null),e(d.Xa==f.Xa),r(f.X,0,d.X,0,1<<f.Xa)}function ht(){this.X=[],this.Xa=this.Mb=0}function He(d,f,v,w){e(v!=null),e(w!=null);var L=v[0],P=w[0];return L==0&&(L=(d*P+f/2)/f),P==0&&(P=(f*L+d/2)/d),0>=L||0>=P?0:(v[0]=L,w[0]=P,1)}function Se(d,f){return d+(1<<f)-1>>>f}function Ke(d,f){return((4278255360&d)+(4278255360&f)>>>0&4278255360)+((16711935&d)+(16711935&f)>>>0&16711935)>>>0}function Re(d,f){F[f]=function(v,w,L,P,R,D,B){var z;for(z=0;z<R;++z){var ne=F[d](D[B+z-1],L,P+z);D[B+z]=Ke(v[w+z],ne)}}}function Qe(){this.ud=this.hd=this.jd=0}function Ie(d,f){return((4278124286&(d^f))>>>1)+(d&f)>>>0}function it(d){return 0<=d&&256>d?d:0>d?0:255<d?255:void 0}function nt(d,f){return it(d+(d-f+.5>>1))}function at(d,f,v){return Math.abs(f-v)-Math.abs(d-v)}function ut(d,f,v,w,L,P,R){for(w=P[R-1],v=0;v<L;++v)P[R+v]=w=Ke(d[f+v],w)}function pt(d,f,v,w,L){var P;for(P=0;P<v;++P){var R=d[f+P],D=R>>8&255,B=16711935&(B=(B=16711935&R)+((D<<16)+D));w[L+P]=(4278255360&R)+B>>>0}}function ze(d,f){f.jd=255&d,f.hd=d>>8&255,f.ud=d>>16&255}function mt(d,f,v,w,L,P){var R;for(R=0;R<w;++R){var D=f[v+R],B=D>>>8,z=D,ne=255&(ne=(ne=D>>>16)+((d.jd<<24>>24)*(B<<24>>24)>>>5));z=255&(z=(z+=(d.hd<<24>>24)*(B<<24>>24)>>>5)+((d.ud<<24>>24)*(ne<<24>>24)>>>5)),L[P+R]=(4278255360&D)+(ne<<16)+z}}function We(d,f,v,w,L){F[f]=function(P,R,D,B,z,ne,he,H,re){for(B=he;B<H;++B)for(he=0;he<re;++he)z[ne++]=L(D[w(P[R++])])},F[d]=function(P,R,D,B,z,ne,he){var H=8>>P.b,re=P.Ea,ce=P.K[0],ve=P.w;if(8>H)for(P=(1<<P.b)-1,ve=(1<<H)-1;R<D;++R){var de,ye=0;for(de=0;de<re;++de)de&P||(ye=w(B[z++])),ne[he++]=L(ce[ye&ve]),ye>>=H}else F["VP8LMapColor"+v](B,z,ce,ve,ne,he,R,D,re)}}function rn(d,f,v,w,L){for(v=f+v;f<v;){var P=d[f++];w[L++]=P>>16&255,w[L++]=P>>8&255,w[L++]=255&P}}function Et(d,f,v,w,L){for(v=f+v;f<v;){var P=d[f++];w[L++]=P>>16&255,w[L++]=P>>8&255,w[L++]=255&P,w[L++]=P>>24&255}}function bt(d,f,v,w,L){for(v=f+v;f<v;){var P=(R=d[f++])>>16&240|R>>12&15,R=240&R|R>>28&15;w[L++]=P,w[L++]=R}}function ct(d,f,v,w,L){for(v=f+v;f<v;){var P=(R=d[f++])>>16&248|R>>13&7,R=R>>5&224|R>>3&31;w[L++]=P,w[L++]=R}}function Dt(d,f,v,w,L){for(v=f+v;f<v;){var P=d[f++];w[L++]=255&P,w[L++]=P>>8&255,w[L++]=P>>16&255}}function et(d,f,v,w,L,P){if(P==0)for(v=f+v;f<v;)be(w,((P=d[f++])[0]>>24|P[1]>>8&65280|P[2]<<8&16711680|P[3]<<24)>>>0),L+=32;else r(w,L,d,f,v)}function jt(d,f){F[f][0]=F[d+"0"],F[f][1]=F[d+"1"],F[f][2]=F[d+"2"],F[f][3]=F[d+"3"],F[f][4]=F[d+"4"],F[f][5]=F[d+"5"],F[f][6]=F[d+"6"],F[f][7]=F[d+"7"],F[f][8]=F[d+"8"],F[f][9]=F[d+"9"],F[f][10]=F[d+"10"],F[f][11]=F[d+"11"],F[f][12]=F[d+"12"],F[f][13]=F[d+"13"],F[f][14]=F[d+"0"],F[f][15]=F[d+"0"]}function st(d){return d==Lc||d==Cc||d==Zo||d==Tc}function dt(){this.eb=[],this.size=this.A=this.fb=0}function Ut(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function kt(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new dt,this.f.kb=new Ut,this.sd=null}function tt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Ft(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function yi(d){return alert("todo:WebPSamplerProcessPlane"),d.T}function Ct(d,f){var v=d.T,w=f.ba.f.RGBA,L=w.eb,P=w.fb+d.ka*w.A,R=Mr[f.ba.S],D=d.y,B=d.O,z=d.f,ne=d.N,he=d.ea,H=d.W,re=f.cc,ce=f.dc,ve=f.Mc,de=f.Nc,ye=d.ka,we=d.ka+d.T,Le=d.U,ke=Le+1>>1;for(ye==0?R(D,B,null,null,z,ne,he,H,z,ne,he,H,L,P,null,null,Le):(R(f.ec,f.fc,D,B,re,ce,ve,de,z,ne,he,H,L,P-w.A,L,P,Le),++v);ye+2<we;ye+=2)re=z,ce=ne,ve=he,de=H,ne+=d.Rc,H+=d.Rc,P+=2*w.A,R(D,(B+=2*d.fa)-d.fa,D,B,re,ce,ve,de,z,ne,he,H,L,P-w.A,L,P,Le);return B+=d.fa,d.j+we<d.o?(r(f.ec,f.fc,D,B,Le),r(f.cc,f.dc,z,ne,ke),r(f.Mc,f.Nc,he,H,ke),v--):1&we||R(D,B,null,null,z,ne,he,H,z,ne,he,H,L,P+w.A,null,null,Le),v}function Vn(d,f,v){var w=d.F,L=[d.J];if(w!=null){var P=d.U,R=f.ba.S,D=R==Xo||R==Zo;f=f.ba.f.RGBA;var B=[0],z=d.ka;B[0]=d.T,d.Kb&&(z==0?--B[0]:(--z,L[0]-=d.width),d.j+d.ka+d.T==d.o&&(B[0]=d.o-d.j-z));var ne=f.eb;z=f.fb+z*f.A,d=Rd(w,L[0],d.width,P,B,ne,z+(D?0:3),f.A),e(v==B),d&&st(R)&&Vs(ne,z,D,P,B,f.A)}return 0}function Tr(d){var f=d.ma,v=f.ba.S,w=11>v,L=v==Jo||v==Yo||v==Xo||v==Ec||v==12||st(v);if(f.memory=null,f.Ib=null,f.Jb=null,f.Nd=null,!Ms(f.Oa,d,L?11:12))return 0;if(L&&st(v)&&Ds(),d.da)alert("todo:use_scaling");else{if(w){if(f.Ib=yi,d.Kb){if(v=d.U+1>>1,f.memory=i(d.U+2*v),f.memory==null)return 0;f.ec=f.memory,f.fc=0,f.cc=f.ec,f.dc=f.fc+d.U,f.Mc=f.cc,f.Nc=f.dc+v,f.Ib=Ct,Ds()}}else alert("todo:EmitYUV");L&&(f.Jb=Vn,w&&Hr())}if(w&&!Yd){for(d=0;256>d;++d)Tm[d]=89858*(d-128)+el>>Qo,Om[d]=-22014*(d-128)+el,Im[d]=-45773*(d-128),Pm[d]=113618*(d-128)+el>>Qo;for(d=Js;d<Oc;++d)f=76283*(d-16)+el>>Qo,Rm[d-Js]=si(f,255),Fm[d-Js]=si(f+8>>4,15);Yd=1}return 1}function rt(d){var f=d.ma,v=d.U,w=d.T;return e(!(1&d.ka)),0>=v||0>=w?0:(v=f.Ib(d,f),f.Jb!=null&&f.Jb(d,f,v),f.Dc+=v,1)}function mr(d){d.ma.memory=null}function Pr(d,f,v,w){return pe(d,8)!=47?0:(f[0]=pe(d,14)+1,v[0]=pe(d,14)+1,w[0]=pe(d,1),pe(d,3)!=0?0:!d.h)}function er(d,f){if(4>d)return d+1;var v=d-2>>1;return(2+(1&d)<<v)+pe(f,v)+1}function cr(d,f){return 120<f?f-120:1<=(v=((v=mm[f-1])>>4)*d+(8-(15&v)))?v:1;var v}function It(d,f,v){var w=V(v),L=d[f+=255&w].g-8;return 0<L&&(Z(v,v.u+8),w=V(v),f+=d[f].value,f+=w&(1<<L)-1),Z(v,v.u+d[f].g),d[f].value}function Yt(d,f,v){return v.g+=d.g,v.value+=d.value<<f>>>0,e(8>=v.g),d.g}function xn(d,f,v){var w=d.xc;return e((f=w==0?0:d.vc[d.md*(v>>w)+(f>>w)])<d.Wb),d.Ya[f]}function ii(d,f,v,w){var L=d.ab,P=d.c*f,R=d.C;f=R+f;var D=v,B=w;for(w=d.Ta,v=d.Ua;0<L--;){var z=d.gc[L],ne=R,he=f,H=D,re=B,ce=(B=w,D=v,z.Ea);switch(e(ne<he),e(he<=z.nc),z.hc){case 2:gn(H,re,(he-ne)*ce,B,D);break;case 0:var ve=ne,de=he,ye=B,we=D,Le=(Ge=z).Ea;ve==0&&($s(H,re,null,null,1,ye,we),ut(H,re+1,0,0,Le-1,ye,we+1),re+=Le,we+=Le,++ve);for(var ke=1<<Ge.b,Ze=ke-1,je=Se(Le,Ge.b),St=Ge.K,Ge=Ge.w+(ve>>Ge.b)*je;ve<de;){var Tt=St,On=Ge,At=1;for(Za(H,re,ye,we-Le,1,ye,we);At<Le;){var Ve=(At&~Ze)+ke;Ve>Le&&(Ve=Le),(0,zs[Tt[On++]>>8&15])(H,re+ +At,ye,we+At-Le,Ve-At,ye,we+At),At=Ve}re+=Le,we+=Le,++ve&Ze||(Ge+=je)}he!=z.nc&&r(B,D-ce,B,D+(he-ne-1)*ce,ce);break;case 1:for(ce=H,de=re,Le=(H=z.Ea)-(we=H&~(ye=(re=1<<z.b)-1)),ve=Se(H,z.b),ke=z.K,z=z.w+(ne>>z.b)*ve;ne<he;){for(Ze=ke,je=z,St=new Qe,Ge=de+we,Tt=de+H;de<Ge;)ze(Ze[je++],St),Hs(St,ce,de,re,B,D),de+=re,D+=re;de<Tt&&(ze(Ze[je++],St),Hs(St,ce,de,Le,B,D),de+=Le,D+=Le),++ne&ye||(z+=ve)}break;case 3:if(H==B&&re==D&&0<z.b){for(de=B,H=ce=D+(he-ne)*ce-(we=(he-ne)*Se(z.Ea,z.b)),re=B,ye=D,ve=[],we=(Le=we)-1;0<=we;--we)ve[we]=re[ye+we];for(we=Le-1;0<=we;--we)de[H+we]=ve[we];Wo(z,ne,he,B,ce,B,D)}else Wo(z,ne,he,H,re,B,D)}D=w,B=v}B!=v&&r(w,v,D,B,P)}function Ir(d,f){var v=d.V,w=d.Ba+d.c*d.C,L=f-d.C;if(e(f<=d.l.o),e(16>=L),0<L){var P=d.l,R=d.Ta,D=d.Ua,B=P.width;if(ii(d,L,v,w),L=D=[D],e((v=d.C)<(w=f)),e(P.v<P.va),w>P.o&&(w=P.o),v<P.j){var z=P.j-v;v=P.j,L[0]+=z*B}if(v>=w?v=0:(L[0]+=4*P.v,P.ka=v-P.j,P.U=P.va-P.v,P.T=w-v,v=1),v){if(D=D[0],11>(v=d.ca).S){var ne=v.f.RGBA,he=(w=v.S,L=P.U,P=P.T,z=ne.eb,ne.A),H=P;for(ne=ne.fb+d.Ma*ne.A;0<H--;){var re=R,ce=D,ve=L,de=z,ye=ne;switch(w){case Ko:Ws(re,ce,ve,de,ye);break;case Jo:Vi(re,ce,ve,de,ye);break;case Lc:Vi(re,ce,ve,de,ye),Vs(de,ye,0,ve,1,0);break;case $d:ka(re,ce,ve,de,ye);break;case Yo:et(re,ce,ve,de,ye,1);break;case Cc:et(re,ce,ve,de,ye,1),Vs(de,ye,0,ve,1,0);break;case Xo:et(re,ce,ve,de,ye,0);break;case Zo:et(re,ce,ve,de,ye,0),Vs(de,ye,1,ve,1,0);break;case Ec:Ki(re,ce,ve,de,ye);break;case Tc:Ki(re,ce,ve,de,ye),Od(de,ye,ve,1,0);break;case qd:Ji(re,ce,ve,de,ye);break;default:e(0)}D+=B,ne+=he}d.Ma+=P}else alert("todo:EmitRescaledRowsYUVA");e(d.Ma<=v.height)}}d.C=f,e(d.C<=d.i)}function ur(d){var f;if(0<d.ua)return 0;for(f=0;f<d.Wb;++f){var v=d.Ya[f].G,w=d.Ya[f].H;if(0<v[1][w[1]+0].g||0<v[2][w[2]+0].g||0<v[3][w[3]+0].g)return 0}return 1}function Sn(d,f,v,w,L,P){if(d.Z!=0){var R=d.qd,D=d.rd;for(e(Zi[d.Z]!=null);f<v;++f)Zi[d.Z](R,D,w,L,w,L,P),R=w,D=L,L+=P;d.qd=R,d.rd=D}}function dr(d,f){var v=d.l.ma,w=v.Z==0||v.Z==1?d.l.j:d.C;if(w=d.C<w?w:d.C,e(f<=d.l.o),f>w){var L=d.l.width,P=v.ca,R=v.tb+L*w,D=d.V,B=d.Ba+d.c*w,z=d.gc;e(d.ab==1),e(z[0].hc==3),ui(z[0],w,f,D,B,P,R),Sn(v,w,f,P,R,L)}d.C=d.Ma=f}function hr(d,f,v,w,L,P,R){var D=d.$/w,B=d.$%w,z=d.m,ne=d.s,he=v+d.$,H=he;L=v+w*L;var re=v+w*P,ce=280+ne.ua,ve=d.Pb?D:16777216,de=0<ne.ua?ne.Wa:null,ye=ne.wc,we=he<re?xn(ne,B,D):null;e(d.C<P),e(re<=L);var Le=!1;e:for(;;){for(;Le||he<re;){var ke=0;if(D>=ve){var Ze=he-v;e((ve=d).Pb),ve.wd=ve.m,ve.xd=Ze,0<ve.s.ua&&Pe(ve.s.Wa,ve.s.vb),ve=D+bm}if(B&ye||(we=xn(ne,B,D)),e(we!=null),we.Qb&&(f[he]=we.qb,Le=!0),!Le)if(ie(z),we.jc){ke=z,Ze=f;var je=he,St=we.pd[V(ke)&Aa-1];e(we.jc),256>St.g?(Z(ke,ke.u+St.g),Ze[je]=St.value,ke=0):(Z(ke,ke.u+St.g-256),e(256<=St.value),ke=St.value),ke==0&&(Le=!0)}else ke=It(we.G[0],we.H[0],z);if(z.h)break;if(Le||256>ke){if(!Le)if(we.nd)f[he]=(we.qb|ke<<8)>>>0;else{if(ie(z),Le=It(we.G[1],we.H[1],z),ie(z),Ze=It(we.G[2],we.H[2],z),je=It(we.G[3],we.H[3],z),z.h)break;f[he]=(je<<24|Le<<16|ke<<8|Ze)>>>0}if(Le=!1,++he,++B>=w&&(B=0,++D,R!=null&&D<=P&&!(D%16)&&R(d,D),de!=null))for(;H<he;)ke=f[H++],de.X[(506832829*ke&4294967295)>>>de.Mb]=ke}else if(280>ke){if(ke=er(ke-256,z),Ze=It(we.G[4],we.H[4],z),ie(z),Ze=cr(w,Ze=er(Ze,z)),z.h)break;if(he-v<Ze||L-he<ke)break e;for(je=0;je<ke;++je)f[he+je]=f[he+je-Ze];for(he+=ke,B+=ke;B>=w;)B-=w,++D,R!=null&&D<=P&&!(D%16)&&R(d,D);if(e(he<=L),B&ye&&(we=xn(ne,B,D)),de!=null)for(;H<he;)ke=f[H++],de.X[(506832829*ke&4294967295)>>>de.Mb]=ke}else{if(!(ke<ce))break e;for(Le=ke-280,e(de!=null);H<he;)ke=f[H++],de.X[(506832829*ke&4294967295)>>>de.Mb]=ke;ke=he,e(!(Le>>>(Ze=de).Xa)),f[ke]=Ze.X[Le],Le=!0}Le||e(z.h==J(z))}if(d.Pb&&z.h&&he<L)e(d.m.h),d.a=5,d.m=d.wd,d.$=d.xd,0<d.s.ua&&Pe(d.s.vb,d.s.Wa);else{if(z.h)break e;R!=null&&R(d,D>P?P:D),d.a=0,d.$=he-v}return 1}return d.a=3,0}function tr(d){e(d!=null),d.vc=null,d.yc=null,d.Ya=null;var f=d.Wa;f!=null&&(f.X=null),d.vb=null,e(d!=null)}function ai(){var d=new gt;return d==null?null:(d.a=0,d.xb=Wd,jt("Predictor","VP8LPredictors"),jt("Predictor","VP8LPredictors_C"),jt("PredictorAdd","VP8LPredictorsAdd"),jt("PredictorAdd","VP8LPredictorsAdd_C"),gn=pt,Hs=mt,Ws=rn,Vi=Et,Ki=bt,Ji=ct,ka=Dt,F.VP8LMapColor32b=ci,F.VP8LMapColor8b=qs,d)}function Or(d,f,v,w,L){var P=1,R=[d],D=[f],B=w.m,z=w.s,ne=null,he=0;e:for(;;){if(v)for(;P&&pe(B,1);){var H=R,re=D,ce=w,ve=1,de=ce.m,ye=ce.gc[ce.ab],we=pe(de,2);if(ce.Oc&1<<we)P=0;else{switch(ce.Oc|=1<<we,ye.hc=we,ye.Ea=H[0],ye.nc=re[0],ye.K=[null],++ce.ab,e(4>=ce.ab),we){case 0:case 1:ye.b=pe(de,3)+2,ve=Or(Se(ye.Ea,ye.b),Se(ye.nc,ye.b),0,ce,ye.K),ye.K=ye.K[0];break;case 3:var Le,ke=pe(de,8)+1,Ze=16<ke?0:4<ke?1:2<ke?2:3;if(H[0]=Se(ye.Ea,Ze),ye.b=Ze,Le=ve=Or(ke,1,0,ce,ye.K)){var je,St=ke,Ge=ye,Tt=1<<(8>>Ge.b),On=i(Tt);if(On==null)Le=0;else{var At=Ge.K[0],Ve=Ge.w;for(On[0]=Ge.K[0][0],je=1;je<1*St;++je)On[je]=Ke(At[Ve+je],On[je-1]);for(;je<4*Tt;++je)On[je]=0;Ge.K[0]=null,Ge.K[0]=On,Le=1}}ve=Le;break;case 2:break;default:e(0)}P=ve}}if(R=R[0],D=D[0],P&&pe(B,1)&&!(P=1<=(he=pe(B,4))&&11>=he)){w.a=3;break e}var Oe;if(Oe=P)t:{var vn,_t,Pt,tn=w,$n=R,rr=D,dn=he,Kn=v,ir=tn.m,Rn=tn.s,Rt=[null],$t=1,hn=0,qt=vm[dn];n:for(;;){if(Kn&&pe(ir,1)){var qn=pe(ir,3)+2,Gr=Se($n,qn),bn=Se(rr,qn),fr=Gr*bn;if(!Or(Gr,bn,0,tn,Rt))break n;for(Rt=Rt[0],Rn.xc=qn,vn=0;vn<fr;++vn){var Vt=Rt[vn]>>8&65535;Rt[vn]=Vt,Vt>=$t&&($t=Vt+1)}}if(ir.h)break n;for(_t=0;5>_t;++_t){var Fn=zd[_t];!_t&&0<dn&&(Fn+=1<<dn),hn<Fn&&(hn=Fn)}var _r=o($t*qt,j),ar=$t,wr=o(ar,K);if(wr==null)var xr=null;else e(65536>=ar),xr=wr;var pr=i(hn);if(xr==null||pr==null||_r==null){tn.a=1;break n}var Sr=_r;for(vn=Pt=0;vn<$t;++vn){var Zt=xr[vn],Ar=Zt.G,Vr=Zt.H,Ea=0,Oi=1,zn=0;for(_t=0;5>_t;++_t){Fn=zd[_t],Ar[_t]=Sr,Vr[_t]=Pt,!_t&&0<dn&&(Fn+=1<<dn);i:{var nl,Rc=Fn,rl=tn,Ys=pr,Bm=Sr,Mm=Pt,Fc=0,Qi=rl.m,Um=pe(Qi,1);if(a(Ys,0,0,Rc),Um){var $m=pe(Qi,1)+1,qm=pe(Qi,1),Qd=pe(Qi,qm==0?1:8);Ys[Qd]=1,$m==2&&(Ys[Qd=pe(Qi,8)]=1);var il=1}else{var eh=i(19),th=pe(Qi,4)+4;if(19<th){rl.a=3;var al=0;break i}for(nl=0;nl<th;++nl)eh[gm[nl]]=pe(Qi,3);var Dc=void 0,Xs=void 0,nh=rl,zm=eh,sl=Rc,rh=Ys,jc=0,ea=nh.m,ih=8,ah=o(128,j);r:for(;A(ah,0,7,zm,19);){if(pe(ea,1)){var Hm=2+2*pe(ea,3);if((Dc=2+pe(ea,Hm))>sl)break r}else Dc=sl;for(Xs=0;Xs<sl&&Dc--;){ie(ea);var sh=ah[0+(127&V(ea))];Z(ea,ea.u+sh.g);var es=sh.value;if(16>es)rh[Xs++]=es,es!=0&&(ih=es);else{var Wm=es==16,oh=es-16,Gm=fm[oh],lh=pe(ea,hm[oh])+Gm;if(Xs+lh>sl)break r;for(var Vm=Wm?ih:0;0<lh--;)rh[Xs++]=Vm}}jc=1;break r}jc||(nh.a=3),il=jc}(il=il&&!Qi.h)&&(Fc=A(Bm,Mm,8,Ys,Rc)),il&&Fc!=0?al=Fc:(rl.a=3,al=0)}if(al==0)break n;if(Oi&&pm[_t]==1&&(Oi=Sr[Pt].g==0),Ea+=Sr[Pt].g,Pt+=al,3>=_t){var Zs,Bc=pr[0];for(Zs=1;Zs<Fn;++Zs)pr[Zs]>Bc&&(Bc=pr[Zs]);zn+=Bc}}if(Zt.nd=Oi,Zt.Qb=0,Oi&&(Zt.qb=(Ar[3][Vr[3]+0].value<<24|Ar[1][Vr[1]+0].value<<16|Ar[2][Vr[2]+0].value)>>>0,Ea==0&&256>Ar[0][Vr[0]+0].value&&(Zt.Qb=1,Zt.qb+=Ar[0][Vr[0]+0].value<<8)),Zt.jc=!Zt.Qb&&6>zn,Zt.jc){var ol,Ri=Zt;for(ol=0;ol<Aa;++ol){var ta=ol,na=Ri.pd[ta],ll=Ri.G[0][Ri.H[0]+ta];256<=ll.value?(na.g=ll.g+256,na.value=ll.value):(na.g=0,na.value=0,ta>>=Yt(ll,8,na),ta>>=Yt(Ri.G[1][Ri.H[1]+ta],16,na),ta>>=Yt(Ri.G[2][Ri.H[2]+ta],0,na),Yt(Ri.G[3][Ri.H[3]+ta],24,na))}}}Rn.vc=Rt,Rn.Wb=$t,Rn.Ya=xr,Rn.yc=_r,Oe=1;break t}Oe=0}if(!(P=Oe)){w.a=3;break e}if(0<he){if(z.ua=1<<he,!U(z.Wa,he)){w.a=1,P=0;break e}}else z.ua=0;var Mc=w,ch=R,Km=D,Uc=Mc.s,$c=Uc.xc;if(Mc.c=ch,Mc.i=Km,Uc.md=Se(ch,$c),Uc.wc=$c==0?-1:(1<<$c)-1,v){w.xb=km;break e}if((ne=i(R*D))==null){w.a=1,P=0;break e}P=(P=hr(w,ne,0,R,D,D,null))&&!B.h;break e}return P?(L!=null?L[0]=ne:(e(ne==null),e(v)),w.$=0,v||tr(z)):tr(z),P}function Ue(d,f){var v=d.c*d.i,w=v+f+16*f;return e(d.c<=f),d.V=i(w),d.V==null?(d.Ta=null,d.Ua=0,d.a=1,0):(d.Ta=d.V,d.Ua=d.Ba+v+f,1)}function te(d,f){var v=d.C,w=f-v,L=d.V,P=d.Ba+d.c*v;for(e(f<=d.l.o);0<w;){var R=16<w?16:w,D=d.l.ma,B=d.l.width,z=B*R,ne=D.ca,he=D.tb+B*v,H=d.Ta,re=d.Ua;ii(d,R,L,P),Fd(H,re,ne,he,z),Sn(D,v,v+R,ne,he,B),w-=R,L+=R*d.c,v+=R}e(v==f),d.C=d.Ma=f}function Ee(){this.ub=this.yd=this.td=this.Rb=0}function Fe(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Wt(){this.Fb=this.Bb=this.Cb=0,this.Zb=i(4),this.Lb=i(4)}function cn(){this.Yb=(function(){var d=[];return(function f(v,w,L){for(var P=L[w],R=0;R<P&&(v.push(L.length>w+1?[]:0),!(L.length<w+1));R++)f(v[R],w+1,L)})(d,0,[3,11]),d})()}function en(){this.jb=i(3),this.Wc=l([4,8],cn),this.Xc=l([4,17],cn)}function Cn(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new i(4),this.od=new i(4)}function un(){this.ld=this.La=this.dd=this.tc=0}function Rr(){this.Na=this.la=0}function $i(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function sn(){this.ad=i(384),this.Za=0,this.Ob=i(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function ha(){this.uc=this.M=this.Nb=0,this.wa=Array(new un),this.Y=0,this.ya=Array(new sn),this.aa=0,this.l=new Wa}function fa(){this.y=i(16),this.f=i(8),this.ea=i(8)}function Io(){this.cb=this.a=0,this.sc="",this.m=new C,this.Od=new Ee,this.Kc=new Fe,this.ed=new Cn,this.Qa=new Wt,this.Ic=this.$c=this.Aa=0,this.D=new ha,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=o(8,C),this.ia=0,this.pb=o(4,$i),this.Pa=new en,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new fa),this.Hd=0,this.rb=Array(new Rr),this.sb=0,this.wa=Array(new un),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new sn),this.L=this.aa=0,this.gd=l([4,2],un),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function si(d,f){return 0>d?0:d>f?f:d}function Wa(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function dc(){var d=new Io;return d!=null&&(d.a=0,d.sc="OK",d.cb=0,d.Xb=0,Ks||(Ks=Ga)),d}function An(d,f,v){return d.a==0&&(d.a=f,d.sc=v,d.cb=0),0}function Oo(d,f,v){return 3<=v&&d[f+0]==157&&d[f+1]==1&&d[f+2]==42}function oi(d,f){if(d==null)return 0;if(d.a=0,d.sc="OK",f==null)return An(d,2,"null VP8Io passed to VP8GetHeaders()");var v=f.data,w=f.w,L=f.ha;if(4>L)return An(d,7,"Truncated header.");var P=v[w+0]|v[w+1]<<8|v[w+2]<<16,R=d.Od;if(R.Rb=!(1&P),R.td=P>>1&7,R.yd=P>>4&1,R.ub=P>>5,3<R.td)return An(d,3,"Incorrect keyframe parameters.");if(!R.yd)return An(d,4,"Frame not displayable.");w+=3,L-=3;var D=d.Kc;if(R.Rb){if(7>L)return An(d,7,"cannot parse picture header");if(!Oo(v,w,L))return An(d,3,"Bad code word");D.c=16383&(v[w+4]<<8|v[w+3]),D.Td=v[w+4]>>6,D.i=16383&(v[w+6]<<8|v[w+5]),D.Ud=v[w+6]>>6,w+=7,L-=7,d.za=D.c+15>>4,d.Ub=D.i+15>>4,f.width=D.c,f.height=D.i,f.Da=0,f.j=0,f.v=0,f.va=f.width,f.o=f.height,f.da=0,f.ib=f.width,f.hb=f.height,f.U=f.width,f.T=f.height,a((P=d.Pa).jb,0,255,P.jb.length),e((P=d.Qa)!=null),P.Cb=0,P.Bb=0,P.Fb=1,a(P.Zb,0,0,P.Zb.length),a(P.Lb,0,0,P.Lb)}if(R.ub>L)return An(d,7,"bad partition length");le(P=d.m,v,w,R.ub),w+=R.ub,L-=R.ub,R.Rb&&(D.Ld=Y(P),D.Kd=Y(P)),D=d.Qa;var B,z=d.Pa;if(e(P!=null),e(D!=null),D.Cb=Y(P),D.Cb){if(D.Bb=Y(P),Y(P)){for(D.Fb=Y(P),B=0;4>B;++B)D.Zb[B]=Y(P)?ae(P,7):0;for(B=0;4>B;++B)D.Lb[B]=Y(P)?ae(P,6):0}if(D.Bb)for(B=0;3>B;++B)z.jb[B]=Y(P)?ue(P,8):255}else D.Bb=0;if(P.Ka)return An(d,3,"cannot parse segment header");if((D=d.ed).zd=Y(P),D.Tb=ue(P,6),D.wb=ue(P,3),D.Pc=Y(P),D.Pc&&Y(P)){for(z=0;4>z;++z)Y(P)&&(D.vd[z]=ae(P,6));for(z=0;4>z;++z)Y(P)&&(D.od[z]=ae(P,6))}if(d.L=D.Tb==0?0:D.zd?1:2,P.Ka)return An(d,3,"cannot parse filter header");var ne=L;if(L=B=w,w=B+ne,D=ne,d.Xb=(1<<ue(d.m,2))-1,ne<3*(z=d.Xb))v=7;else{for(B+=3*z,D-=3*z,ne=0;ne<z;++ne){var he=v[L+0]|v[L+1]<<8|v[L+2]<<16;he>D&&(he=D),le(d.Jc[+ne],v,B,he),B+=he,D-=he,L+=3}le(d.Jc[+z],v,B,D),v=B<w?0:5}if(v!=0)return An(d,v,"cannot parse partitions");for(v=ue(B=d.m,7),L=Y(B)?ae(B,4):0,w=Y(B)?ae(B,4):0,D=Y(B)?ae(B,4):0,z=Y(B)?ae(B,4):0,B=Y(B)?ae(B,4):0,ne=d.Qa,he=0;4>he;++he){if(ne.Cb){var H=ne.Zb[he];ne.Fb||(H+=v)}else{if(0<he){d.pb[he]=d.pb[0];continue}H=v}var re=d.pb[he];re.Sc[0]=Pc[si(H+L,127)],re.Sc[1]=Ic[si(H+0,127)],re.Eb[0]=2*Pc[si(H+w,127)],re.Eb[1]=101581*Ic[si(H+D,127)]>>16,8>re.Eb[1]&&(re.Eb[1]=8),re.Qc[0]=Pc[si(H+z,117)],re.Qc[1]=Ic[si(H+B,127)],re.lc=H+B}if(!R.Rb)return An(d,4,"Not a key frame.");for(Y(P),R=d.Pa,v=0;4>v;++v){for(L=0;8>L;++L)for(w=0;3>w;++w)for(D=0;11>D;++D)z=se(P,Sm[v][L][w][D])?ue(P,8):wm[v][L][w][D],R.Wc[v][L].Yb[w][D]=z;for(L=0;17>L;++L)R.Xc[v][L]=R.Wc[v][Am[L]]}return d.kc=Y(P),d.kc&&(d.Bd=ue(P,8)),d.cb=1}function Ga(d,f,v,w,L,P,R){var D=f[L].Yb[v];for(v=0;16>L;++L){if(!se(d,D[v+0]))return L;for(;!se(d,D[v+1]);)if(D=f[++L].Yb[0],v=0,L==16)return 16;var B=f[L+1].Yb;if(se(d,D[v+2])){var z=d,ne=0;if(se(z,(H=D)[(he=v)+3]))if(se(z,H[he+6])){for(D=0,he=2*(ne=se(z,H[he+8]))+(H=se(z,H[he+9+ne])),ne=0,H=ym[he];H[D];++D)ne+=ne+se(z,H[D]);ne+=3+(8<<he)}else se(z,H[he+7])?(ne=7+2*se(z,165),ne+=se(z,145)):ne=5+se(z,159);else ne=se(z,H[he+4])?3+se(z,H[he+5]):2;D=B[2]}else ne=1,D=B[1];B=R+_m[L],0>(z=d).b&&fe(z);var he,H=z.b,re=(he=z.Ca>>1)-(z.I>>H)>>31;--z.b,z.Ca+=re,z.Ca|=1,z.I-=(he+1&re)<<H,P[B]=((ne^re)-re)*w[(0<L)+0]}return 16}function Ro(d){var f=d.rb[d.sb-1];f.la=0,f.Na=0,a(d.zc,0,0,d.zc.length),d.ja=0}function Fr(d,f,v,w,L){L=d[f+v+32*w]+(L>>3),d[f+v+32*w]=-256&L?0>L?0:255:L}function Tn(d,f,v,w,L,P){Fr(d,f,0,v,w+L),Fr(d,f,1,v,w+P),Fr(d,f,2,v,w-P),Fr(d,f,3,v,w-L)}function _i(d){return(20091*d>>16)+d}function Fo(d,f,v,w){var L,P=0,R=i(16);for(L=0;4>L;++L){var D=d[f+0]+d[f+8],B=d[f+0]-d[f+8],z=(35468*d[f+4]>>16)-_i(d[f+12]),ne=_i(d[f+4])+(35468*d[f+12]>>16);R[P+0]=D+ne,R[P+1]=B+z,R[P+2]=B-z,R[P+3]=D-ne,P+=4,f++}for(L=P=0;4>L;++L)D=(d=R[P+0]+4)+R[P+8],B=d-R[P+8],z=(35468*R[P+4]>>16)-_i(R[P+12]),Fr(v,w,0,0,D+(ne=_i(R[P+4])+(35468*R[P+12]>>16))),Fr(v,w,1,0,B+z),Fr(v,w,2,0,B-z),Fr(v,w,3,0,D-ne),P++,w+=32}function hc(d,f,v,w){var L=d[f+0]+4,P=35468*d[f+4]>>16,R=_i(d[f+4]),D=35468*d[f+1]>>16;Tn(v,w,0,L+R,d=_i(d[f+1]),D),Tn(v,w,1,L+P,d,D),Tn(v,w,2,L-P,d,D),Tn(v,w,3,L-R,d,D)}function fc(d,f,v,w,L){Fo(d,f,v,w),L&&Fo(d,f+16,v,w+4)}function li(d,f,v,w){Na(d,f+0,v,w,1),Na(d,f+32,v,w+128,1)}function Do(d,f,v,w){var L;for(d=d[f+0]+4,L=0;4>L;++L)for(f=0;4>f;++f)Fr(v,w,f,L,d)}function jo(d,f,v,w){d[f+0]&&Bt(d,f+0,v,w),d[f+16]&&Bt(d,f+16,v,w+4),d[f+32]&&Bt(d,f+32,v,w+128),d[f+48]&&Bt(d,f+48,v,w+128+4)}function Va(d,f,v,w){var L,P=i(16);for(L=0;4>L;++L){var R=d[f+0+L]+d[f+12+L],D=d[f+4+L]+d[f+8+L],B=d[f+4+L]-d[f+8+L],z=d[f+0+L]-d[f+12+L];P[0+L]=R+D,P[8+L]=R-D,P[4+L]=z+B,P[12+L]=z-B}for(L=0;4>L;++L)R=(d=P[0+4*L]+3)+P[3+4*L],D=P[1+4*L]+P[2+4*L],B=P[1+4*L]-P[2+4*L],z=d-P[3+4*L],v[w+0]=R+D>>3,v[w+16]=z+B>>3,v[w+32]=R-D>>3,v[w+48]=z-B>>3,w+=64}function pa(d,f,v){var w,L=f-32,P=yr,R=255-d[L-1];for(w=0;w<v;++w){var D,B=P,z=R+d[f-1];for(D=0;D<v;++D)d[f+D]=B[z+d[L+D]];f+=32}}function pc(d,f){pa(d,f,4)}function gc(d,f){pa(d,f,8)}function mc(d,f){pa(d,f,16)}function Ls(d,f){var v;for(v=0;16>v;++v)r(d,f+32*v,d,f-32,16)}function Bo(d,f){var v;for(v=16;0<v;--v)a(d,f,d[f-1],16),f+=32}function zr(d,f,v){var w;for(w=0;16>w;++w)a(f,v+32*w,d,16)}function vc(d,f){var v,w=16;for(v=0;16>v;++v)w+=d[f-1+32*v]+d[f+v-32];zr(w>>5,d,f)}function ga(d,f){var v,w=8;for(v=0;16>v;++v)w+=d[f-1+32*v];zr(w>>4,d,f)}function Cs(d,f){var v,w=8;for(v=0;16>v;++v)w+=d[f+v-32];zr(w>>4,d,f)}function bc(d,f){zr(128,d,f)}function vt(d,f,v){return d+2*f+v+2>>2}function yc(d,f){var v,w=f-32;for(w=new Uint8Array([vt(d[w-1],d[w+0],d[w+1]),vt(d[w+0],d[w+1],d[w+2]),vt(d[w+1],d[w+2],d[w+3]),vt(d[w+2],d[w+3],d[w+4])]),v=0;4>v;++v)r(d,f+32*v,w,0,w.length)}function _c(d,f){var v=d[f-1],w=d[f-1+32],L=d[f-1+64],P=d[f-1+96];be(d,f+0,16843009*vt(d[f-1-32],v,w)),be(d,f+32,16843009*vt(v,w,L)),be(d,f+64,16843009*vt(w,L,P)),be(d,f+96,16843009*vt(L,P,P))}function wc(d,f){var v,w=4;for(v=0;4>v;++v)w+=d[f+v-32]+d[f-1+32*v];for(w>>=3,v=0;4>v;++v)a(d,f+32*v,w,4)}function wi(d,f){var v=d[f-1+0],w=d[f-1+32],L=d[f-1+64],P=d[f-1-32],R=d[f+0-32],D=d[f+1-32],B=d[f+2-32],z=d[f+3-32];d[f+0+96]=vt(w,L,d[f-1+96]),d[f+1+96]=d[f+0+64]=vt(v,w,L),d[f+2+96]=d[f+1+64]=d[f+0+32]=vt(P,v,w),d[f+3+96]=d[f+2+64]=d[f+1+32]=d[f+0+0]=vt(R,P,v),d[f+3+64]=d[f+2+32]=d[f+1+0]=vt(D,R,P),d[f+3+32]=d[f+2+0]=vt(B,D,R),d[f+3+0]=vt(z,B,D)}function xi(d,f){var v=d[f+1-32],w=d[f+2-32],L=d[f+3-32],P=d[f+4-32],R=d[f+5-32],D=d[f+6-32],B=d[f+7-32];d[f+0+0]=vt(d[f+0-32],v,w),d[f+1+0]=d[f+0+32]=vt(v,w,L),d[f+2+0]=d[f+1+32]=d[f+0+64]=vt(w,L,P),d[f+3+0]=d[f+2+32]=d[f+1+64]=d[f+0+96]=vt(L,P,R),d[f+3+32]=d[f+2+64]=d[f+1+96]=vt(P,R,D),d[f+3+64]=d[f+2+96]=vt(R,D,B),d[f+3+96]=vt(D,B,B)}function xc(d,f){var v=d[f-1+0],w=d[f-1+32],L=d[f-1+64],P=d[f-1-32],R=d[f+0-32],D=d[f+1-32],B=d[f+2-32],z=d[f+3-32];d[f+0+0]=d[f+1+64]=P+R+1>>1,d[f+1+0]=d[f+2+64]=R+D+1>>1,d[f+2+0]=d[f+3+64]=D+B+1>>1,d[f+3+0]=B+z+1>>1,d[f+0+96]=vt(L,w,v),d[f+0+64]=vt(w,v,P),d[f+0+32]=d[f+1+96]=vt(v,P,R),d[f+1+32]=d[f+2+96]=vt(P,R,D),d[f+2+32]=d[f+3+96]=vt(R,D,B),d[f+3+32]=vt(D,B,z)}function Sc(d,f){var v=d[f+0-32],w=d[f+1-32],L=d[f+2-32],P=d[f+3-32],R=d[f+4-32],D=d[f+5-32],B=d[f+6-32],z=d[f+7-32];d[f+0+0]=v+w+1>>1,d[f+1+0]=d[f+0+64]=w+L+1>>1,d[f+2+0]=d[f+1+64]=L+P+1>>1,d[f+3+0]=d[f+2+64]=P+R+1>>1,d[f+0+32]=vt(v,w,L),d[f+1+32]=d[f+0+96]=vt(w,L,P),d[f+2+32]=d[f+1+96]=vt(L,P,R),d[f+3+32]=d[f+2+96]=vt(P,R,D),d[f+3+64]=vt(R,D,B),d[f+3+96]=vt(D,B,z)}function Ka(d,f){var v=d[f-1+0],w=d[f-1+32],L=d[f-1+64],P=d[f-1+96];d[f+0+0]=v+w+1>>1,d[f+2+0]=d[f+0+32]=w+L+1>>1,d[f+2+32]=d[f+0+64]=L+P+1>>1,d[f+1+0]=vt(v,w,L),d[f+3+0]=d[f+1+32]=vt(w,L,P),d[f+3+32]=d[f+1+64]=vt(L,P,P),d[f+3+64]=d[f+2+64]=d[f+0+96]=d[f+1+96]=d[f+2+96]=d[f+3+96]=P}function Ts(d,f){var v=d[f-1+0],w=d[f-1+32],L=d[f-1+64],P=d[f-1+96],R=d[f-1-32],D=d[f+0-32],B=d[f+1-32],z=d[f+2-32];d[f+0+0]=d[f+2+32]=v+R+1>>1,d[f+0+32]=d[f+2+64]=w+v+1>>1,d[f+0+64]=d[f+2+96]=L+w+1>>1,d[f+0+96]=P+L+1>>1,d[f+3+0]=vt(D,B,z),d[f+2+0]=vt(R,D,B),d[f+1+0]=d[f+3+32]=vt(v,R,D),d[f+1+32]=d[f+3+64]=vt(w,v,R),d[f+1+64]=d[f+3+96]=vt(L,w,v),d[f+1+96]=vt(P,L,w)}function ma(d,f){var v;for(v=0;8>v;++v)r(d,f+32*v,d,f-32,8)}function Ac(d,f){var v;for(v=0;8>v;++v)a(d,f,d[f-1],8),f+=32}function Si(d,f,v){var w;for(w=0;8>w;++w)a(f,v+32*w,d,8)}function kc(d,f){var v,w=8;for(v=0;8>v;++v)w+=d[f+v-32]+d[f-1+32*v];Si(w>>4,d,f)}function Ps(d,f){var v,w=4;for(v=0;8>v;++v)w+=d[f+v-32];Si(w>>3,d,f)}function Is(d,f){var v,w=4;for(v=0;8>v;++v)w+=d[f-1+32*v];Si(w>>3,d,f)}function Mo(d,f){Si(128,d,f)}function Ai(d,f,v){var w=d[f-v],L=d[f+0],P=3*(L-w)+Nc[1020+d[f-2*v]-d[f+v]],R=Vo[112+(P+4>>3)];d[f-v]=yr[255+w+Vo[112+(P+3>>3)]],d[f+0]=yr[255+L-R]}function Os(d,f,v,w){var L=d[f+0],P=d[f+v];return Br[255+d[f-2*v]-d[f-v]]>w||Br[255+P-L]>w}function Ja(d,f,v,w){return 4*Br[255+d[f-v]-d[f+0]]+Br[255+d[f-2*v]-d[f+v]]<=w}function Rs(d,f,v,w,L){var P=d[f-3*v],R=d[f-2*v],D=d[f-v],B=d[f+0],z=d[f+v],ne=d[f+2*v],he=d[f+3*v];return 4*Br[255+D-B]+Br[255+R-z]>w?0:Br[255+d[f-4*v]-P]<=L&&Br[255+P-R]<=L&&Br[255+R-D]<=L&&Br[255+he-ne]<=L&&Br[255+ne-z]<=L&&Br[255+z-B]<=L}function va(d,f,v,w){var L=2*w+1;for(w=0;16>w;++w)Ja(d,f+w,v,L)&&Ai(d,f+w,v)}function Fs(d,f,v,w){var L=2*w+1;for(w=0;16>w;++w)Ja(d,f+w*v,1,L)&&Ai(d,f+w*v,1)}function Uo(d,f,v,w){var L;for(L=3;0<L;--L)va(d,f+=4*v,v,w)}function $o(d,f,v,w){var L;for(L=3;0<L;--L)Fs(d,f+=4,v,w)}function ki(d,f,v,w,L,P,R,D){for(P=2*P+1;0<L--;){if(Rs(d,f,v,P,R))if(Os(d,f,v,D))Ai(d,f,v);else{var B=d,z=f,ne=v,he=B[z-2*ne],H=B[z-ne],re=B[z+0],ce=B[z+ne],ve=B[z+2*ne],de=27*(we=Nc[1020+3*(re-H)+Nc[1020+he-ce]])+63>>7,ye=18*we+63>>7,we=9*we+63>>7;B[z-3*ne]=yr[255+B[z-3*ne]+we],B[z-2*ne]=yr[255+he+ye],B[z-ne]=yr[255+H+de],B[z+0]=yr[255+re-de],B[z+ne]=yr[255+ce-ye],B[z+2*ne]=yr[255+ve-we]}f+=w}}function Ni(d,f,v,w,L,P,R,D){for(P=2*P+1;0<L--;){if(Rs(d,f,v,P,R))if(Os(d,f,v,D))Ai(d,f,v);else{var B=d,z=f,ne=v,he=B[z-ne],H=B[z+0],re=B[z+ne],ce=Vo[112+(4+(ve=3*(H-he))>>3)],ve=Vo[112+(ve+3>>3)],de=ce+1>>1;B[z-2*ne]=yr[255+B[z-2*ne]+de],B[z-ne]=yr[255+he+ve],B[z+0]=yr[255+H-ce],B[z+ne]=yr[255+re-de]}f+=w}}function qo(d,f,v,w,L,P){ki(d,f,v,1,16,w,L,P)}function ba(d,f,v,w,L,P){ki(d,f,1,v,16,w,L,P)}function zo(d,f,v,w,L,P){var R;for(R=3;0<R;--R)Ni(d,f+=4*v,v,1,16,w,L,P)}function m(d,f,v,w,L,P){var R;for(R=3;0<R;--R)Ni(d,f+=4,1,v,16,w,L,P)}function N(d,f,v,w,L,P,R,D){ki(d,f,L,1,8,P,R,D),ki(v,w,L,1,8,P,R,D)}function W(d,f,v,w,L,P,R,D){ki(d,f,1,L,8,P,R,D),ki(v,w,1,L,8,P,R,D)}function Q(d,f,v,w,L,P,R,D){Ni(d,f+4*L,L,1,8,P,R,D),Ni(v,w+4*L,L,1,8,P,R,D)}function oe(d,f,v,w,L,P,R,D){Ni(d,f+4,1,L,8,P,R,D),Ni(v,w+4,1,L,8,P,R,D)}function _e(){this.ba=new kt,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Ft,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Ae(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function $e(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Je(){this.ua=0,this.Wa=new ht,this.vb=new ht,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new K,this.yc=new j}function gt(){this.xb=this.a=0,this.l=new Wa,this.ca=new kt,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new $,this.Pb=0,this.wd=new $,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Je,this.ab=0,this.gc=o(4,$e),this.Oc=0}function wt(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Wa,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Ot(d,f,v,w,L,P,R){for(d=d==null?0:d[f+0],f=0;f<R;++f)L[P+f]=d+v[w+f]&255,d=L[P+f]}function on(d,f,v,w,L,P,R){var D;if(d==null)Ot(null,null,v,w,L,P,R);else for(D=0;D<R;++D)L[P+D]=d[f+D]+v[w+D]&255}function kn(d,f,v,w,L,P,R){if(d==null)Ot(null,null,v,w,L,P,R);else{var D,B=d[f+0],z=B,ne=B;for(D=0;D<R;++D)z=ne+(B=d[f+D])-z,ne=v[w+D]+(-256&z?0>z?0:255:z)&255,z=B,L[P+D]=ne}}function Xt(d,f,v,w){var L=f.width,P=f.o;if(e(d!=null&&f!=null),0>v||0>=w||v+w>P)return null;if(!d.Cc){if(d.ga==null){var R;if(d.ga=new wt,(R=d.ga==null)||(R=f.width*f.o,e(d.Gb.length==0),d.Gb=i(R),d.Uc=0,d.Gb==null?R=0:(d.mb=d.Gb,d.nb=d.Uc,d.rc=null,R=1),R=!R),!R){R=d.ga;var D=d.Fa,B=d.P,z=d.qc,ne=d.mb,he=d.nb,H=B+1,re=z-1,ce=R.l;if(e(D!=null&&ne!=null&&f!=null),Zi[0]=null,Zi[1]=Ot,Zi[2]=on,Zi[3]=kn,R.ca=ne,R.tb=he,R.c=f.width,R.i=f.height,e(0<R.c&&0<R.i),1>=z)f=0;else if(R.$a=3&D[B+0],R.Z=D[B+0]>>2&3,R.Lc=D[B+0]>>4&3,B=D[B+0]>>6&3,0>R.$a||1<R.$a||4<=R.Z||1<R.Lc||B)f=0;else if(ce.put=rt,ce.ac=Tr,ce.bc=mr,ce.ma=R,ce.width=f.width,ce.height=f.height,ce.Da=f.Da,ce.v=f.v,ce.va=f.va,ce.j=f.j,ce.o=f.o,R.$a)e:{e(R.$a==1),f=ai();t:for(;;){if(f==null){f=0;break e}if(e(R!=null),R.mc=f,f.c=R.c,f.i=R.i,f.l=R.l,f.l.ma=R,f.l.width=R.c,f.l.height=R.i,f.a=0,ge(f.m,D,H,re),!Or(R.c,R.i,1,f,null)||(f.ab==1&&f.gc[0].hc==3&&ur(f.s)?(R.ic=1,D=f.c*f.i,f.Ta=null,f.Ua=0,f.V=i(D),f.Ba=0,f.V==null?(f.a=1,f=0):f=1):(R.ic=0,f=Ue(f,R.c)),!f))break t;f=1;break e}R.mc=null,f=0}else f=re>=R.c*R.i;R=!f}if(R)return null;d.ga.Lc!=1?d.Ga=0:w=P-v}e(d.ga!=null),e(v+w<=P);e:{if(f=(D=d.ga).c,P=D.l.o,D.$a==0){if(H=d.rc,re=d.Vc,ce=d.Fa,B=d.P+1+v*f,z=d.mb,ne=d.nb+v*f,e(B<=d.P+d.qc),D.Z!=0)for(e(Zi[D.Z]!=null),R=0;R<w;++R)Zi[D.Z](H,re,ce,B,z,ne,f),H=z,re=ne,ne+=f,B+=f;else for(R=0;R<w;++R)r(z,ne,ce,B,f),H=z,re=ne,ne+=f,B+=f;d.rc=H,d.Vc=re}else{if(e(D.mc!=null),f=v+w,e((R=D.mc)!=null),e(f<=R.i),R.C>=f)f=1;else if(D.ic||Hr(),D.ic){D=R.V,H=R.Ba,re=R.c;var ve=R.i,de=(ce=1,B=R.$/re,z=R.$%re,ne=R.m,he=R.s,R.$),ye=re*ve,we=re*f,Le=he.wc,ke=de<we?xn(he,z,B):null;e(de<=ye),e(f<=ve),e(ur(he));t:for(;;){for(;!ne.h&&de<we;){if(z&Le||(ke=xn(he,z,B)),e(ke!=null),ie(ne),256>(ve=It(ke.G[0],ke.H[0],ne)))D[H+de]=ve,++de,++z>=re&&(z=0,++B<=f&&!(B%16)&&dr(R,B));else{if(!(280>ve)){ce=0;break t}ve=er(ve-256,ne);var Ze,je=It(ke.G[4],ke.H[4],ne);if(ie(ne),!(de>=(je=cr(re,je=er(je,ne)))&&ye-de>=ve)){ce=0;break t}for(Ze=0;Ze<ve;++Ze)D[H+de+Ze]=D[H+de+Ze-je];for(de+=ve,z+=ve;z>=re;)z-=re,++B<=f&&!(B%16)&&dr(R,B);de<we&&z&Le&&(ke=xn(he,z,B))}e(ne.h==J(ne))}dr(R,B>f?f:B);break t}!ce||ne.h&&de<ye?(ce=0,R.a=ne.h?5:3):R.$=de,f=ce}else f=hr(R,R.V,R.Ba,R.c,R.i,f,te);if(!f){w=0;break e}}v+w>=P&&(d.Cc=1),w=1}if(!w)return null;if(d.Cc&&((w=d.ga)!=null&&(w.mc=null),d.ga=null,0<d.Ga))return alert("todo:WebPDequantizeLevels"),null}return d.nb+v*L}function Pn(d,f,v,w,L,P){for(;0<L--;){var R,D=d,B=f+(v?1:0),z=d,ne=f+(v?0:3);for(R=0;R<w;++R){var he=z[ne+4*R];he!=255&&(he*=32897,D[B+4*R+0]=D[B+4*R+0]*he>>23,D[B+4*R+1]=D[B+4*R+1]*he>>23,D[B+4*R+2]=D[B+4*R+2]*he>>23)}f+=P}}function Nn(d,f,v,w,L){for(;0<w--;){var P;for(P=0;P<v;++P){var R=d[f+2*P+0],D=15&(z=d[f+2*P+1]),B=4369*D,z=(240&z|z>>4)*B>>16;d[f+2*P+0]=(240&R|R>>4)*B>>16&240|(15&R|R<<4)*B>>16>>4&15,d[f+2*P+1]=240&z|D}f+=L}}function Mn(d,f,v,w,L,P,R,D){var B,z,ne=255;for(z=0;z<L;++z){for(B=0;B<w;++B){var he=d[f+B];P[R+4*B]=he,ne&=he}f+=v,R+=D}return ne!=255}function Ei(d,f,v,w,L){var P;for(P=0;P<L;++P)v[w+P]=d[f+P]>>8}function Hr(){Vs=Pn,Od=Nn,Rd=Mn,Fd=Ei}function Li(d,f,v){F[d]=function(w,L,P,R,D,B,z,ne,he,H,re,ce,ve,de,ye,we,Le){var ke,Ze=Le-1>>1,je=D[B+0]|z[ne+0]<<16,St=he[H+0]|re[ce+0]<<16;e(w!=null);var Ge=3*je+St+131074>>2;for(f(w[L+0],255&Ge,Ge>>16,ve,de),P!=null&&(Ge=3*St+je+131074>>2,f(P[R+0],255&Ge,Ge>>16,ye,we)),ke=1;ke<=Ze;++ke){var Tt=D[B+ke]|z[ne+ke]<<16,On=he[H+ke]|re[ce+ke]<<16,At=je+Tt+St+On+524296,Ve=At+2*(Tt+St)>>3;Ge=Ve+je>>1,je=(At=At+2*(je+On)>>3)+Tt>>1,f(w[L+2*ke-1],255&Ge,Ge>>16,ve,de+(2*ke-1)*v),f(w[L+2*ke-0],255&je,je>>16,ve,de+(2*ke-0)*v),P!=null&&(Ge=At+St>>1,je=Ve+On>>1,f(P[R+2*ke-1],255&Ge,Ge>>16,ye,we+(2*ke-1)*v),f(P[R+2*ke+0],255&je,je>>16,ye,we+(2*ke+0)*v)),je=Tt,St=On}1&Le||(Ge=3*je+St+131074>>2,f(w[L+Le-1],255&Ge,Ge>>16,ve,de+(Le-1)*v),P!=null&&(Ge=3*St+je+131074>>2,f(P[R+Le-1],255&Ge,Ge>>16,ye,we+(Le-1)*v)))}}function Ds(){Mr[Ko]=Nm,Mr[Jo]=Gd,Mr[$d]=Em,Mr[Yo]=Vd,Mr[Xo]=Kd,Mr[Ec]=Jd,Mr[qd]=Lm,Mr[Lc]=Gd,Mr[Cc]=Vd,Mr[Zo]=Kd,Mr[Tc]=Jd}function Ya(d){return d&-16384?0>d?0:255:d>>Cm}function qi(d,f){return Ya((19077*d>>8)+(26149*f>>8)-14234)}function ya(d,f,v){return Ya((19077*d>>8)-(6419*f>>8)-(13320*v>>8)+8708)}function _a(d,f){return Ya((19077*d>>8)+(33050*f>>8)-17685)}function zi(d,f,v,w,L){w[L+0]=qi(d,v),w[L+1]=ya(d,f,v),w[L+2]=_a(d,f)}function Un(d,f,v,w,L){w[L+0]=_a(d,f),w[L+1]=ya(d,f,v),w[L+2]=qi(d,v)}function wa(d,f,v,w,L){var P=ya(d,f,v);f=P<<3&224|_a(d,f)>>3,w[L+0]=248&qi(d,v)|P>>5,w[L+1]=f}function xa(d,f,v,w,L){var P=240&_a(d,f)|15;w[L+0]=240&qi(d,v)|ya(d,f,v)>>4,w[L+1]=P}function js(d,f,v,w,L){w[L+0]=255,zi(d,f,v,w,L+1)}function Bs(d,f,v,w,L){Un(d,f,v,w,L),w[L+3]=255}function nr(d,f,v,w,L){zi(d,f,v,w,L),w[L+3]=255}function Ci(d,f,v){F[d]=function(w,L,P,R,D,B,z,ne,he){for(var H=ne+(-2&he)*v;ne!=H;)f(w[L+0],P[R+0],D[B+0],z,ne),f(w[L+1],P[R+0],D[B+0],z,ne+v),L+=2,++R,++B,ne+=2*v;1&he&&f(w[L+0],P[R+0],D[B+0],z,ne)}}function Xa(d,f,v){return v==0?d==0?f==0?6:5:f==0?4:0:v}function Ho(d,f,v,w,L){switch(d>>>30){case 3:Na(f,v,w,L,0);break;case 2:jr(f,v,w,L);break;case 1:Bt(f,v,w,L)}}function Dr(d,f){var v,w,L=f.M,P=f.Nb,R=d.oc,D=d.pc+40,B=d.oc,z=d.pc+584,ne=d.oc,he=d.pc+600;for(v=0;16>v;++v)R[D+32*v-1]=129;for(v=0;8>v;++v)B[z+32*v-1]=129,ne[he+32*v-1]=129;for(0<L?R[D-1-32]=B[z-1-32]=ne[he-1-32]=129:(a(R,D-32-1,127,21),a(B,z-32-1,127,9),a(ne,he-32-1,127,9)),w=0;w<d.za;++w){var H=f.ya[f.aa+w];if(0<w){for(v=-1;16>v;++v)r(R,D+32*v-4,R,D+32*v+12,4);for(v=-1;8>v;++v)r(B,z+32*v-4,B,z+32*v+4,4),r(ne,he+32*v-4,ne,he+32*v+4,4)}var re=d.Gd,ce=d.Hd+w,ve=H.ad,de=H.Hc;if(0<L&&(r(R,D-32,re[ce].y,0,16),r(B,z-32,re[ce].f,0,8),r(ne,he-32,re[ce].ea,0,8)),H.Za){var ye=R,we=D-32+16;for(0<L&&(w>=d.za-1?a(ye,we,re[ce].y[15],4):r(ye,we,re[ce+1].y,0,4)),v=0;4>v;v++)ye[we+128+v]=ye[we+256+v]=ye[we+384+v]=ye[we+0+v];for(v=0;16>v;++v,de<<=2)ye=R,we=D+Xd[v],Wr[H.Ob[v]](ye,we),Ho(de,ve,16*+v,ye,we)}else if(ye=Xa(w,L,H.Ob[0]),Xi[ye](R,D),de!=0)for(v=0;16>v;++v,de<<=2)Ho(de,ve,16*+v,R,D+Xd[v]);for(v=H.Gc,ye=Xa(w,L,H.Dd),Ii[ye](B,z),Ii[ye](ne,he),de=ve,ye=B,we=z,255&(H=0|v)&&(170&H?di(de,256,ye,we):Gt(de,256,ye,we)),H=ne,de=he,255&(v>>=8)&&(170&v?di(ve,320,H,de):Gt(ve,320,H,de)),L<d.Ub-1&&(r(re[ce].y,0,R,D+480,16),r(re[ce].f,0,B,z+224,8),r(re[ce].ea,0,ne,he+224,8)),v=8*P*d.B,re=d.sa,ce=d.ta+16*w+16*P*d.R,ve=d.qa,H=d.ra+8*w+v,de=d.Ha,ye=d.Ia+8*w+v,v=0;16>v;++v)r(re,ce+v*d.R,R,D+32*v,16);for(v=0;8>v;++v)r(ve,H+v*d.B,B,z+32*v,8),r(de,ye+v*d.B,ne,he+32*v,8)}}function Sa(d,f,v,w,L,P,R,D,B){var z=[0],ne=[0],he=0,H=B!=null?B.kd:0,re=B??new Ae;if(d==null||12>v)return 7;re.data=d,re.w=f,re.ha=v,f=[f],v=[v],re.gb=[re.gb];e:{var ce=f,ve=v,de=re.gb;if(e(d!=null),e(ve!=null),e(de!=null),de[0]=0,12<=ve[0]&&!n(d,ce[0],"RIFF")){if(n(d,ce[0]+8,"WEBP")){de=3;break e}var ye=De(d,ce[0]+4);if(12>ye||4294967286<ye){de=3;break e}if(H&&ye>ve[0]-8){de=7;break e}de[0]=ye,ce[0]+=12,ve[0]-=12}de=0}if(de!=0)return de;for(ye=0<re.gb[0],v=v[0];;){e:{var we=d;ve=f,de=v;var Le=z,ke=ne,Ze=ce=[0];if((Ge=he=[he])[0]=0,8>de[0])de=7;else{if(!n(we,ve[0],"VP8X")){if(De(we,ve[0]+4)!=10){de=3;break e}if(18>de[0]){de=7;break e}var je=De(we,ve[0]+8),St=1+Te(we,ve[0]+12);if(2147483648<=St*(we=1+Te(we,ve[0]+15))){de=3;break e}Ze!=null&&(Ze[0]=je),Le!=null&&(Le[0]=St),ke!=null&&(ke[0]=we),ve[0]+=18,de[0]-=18,Ge[0]=1}de=0}}if(he=he[0],ce=ce[0],de!=0)return de;if(ve=!!(2&ce),!ye&&he)return 3;if(P!=null&&(P[0]=!!(16&ce)),R!=null&&(R[0]=ve),D!=null&&(D[0]=0),R=z[0],ce=ne[0],he&&ve&&B==null){de=0;break}if(4>v){de=7;break}if(ye&&he||!ye&&!he&&!n(d,f[0],"ALPH")){v=[v],re.na=[re.na],re.P=[re.P],re.Sa=[re.Sa];e:{je=d,de=f,ye=v;var Ge=re.gb;Le=re.na,ke=re.P,Ze=re.Sa,St=22,e(je!=null),e(ye!=null),we=de[0];var Tt=ye[0];for(e(Le!=null),e(Ze!=null),Le[0]=null,ke[0]=null,Ze[0]=0;;){if(de[0]=we,ye[0]=Tt,8>Tt){de=7;break e}var On=De(je,we+4);if(4294967286<On){de=3;break e}var At=8+On+1&-2;if(St+=At,0<Ge&&St>Ge){de=3;break e}if(!n(je,we,"VP8 ")||!n(je,we,"VP8L")){de=0;break e}if(Tt[0]<At){de=7;break e}n(je,we,"ALPH")||(Le[0]=je,ke[0]=we+8,Ze[0]=On),we+=At,Tt-=At}}if(v=v[0],re.na=re.na[0],re.P=re.P[0],re.Sa=re.Sa[0],de!=0)break}v=[v],re.Ja=[re.Ja],re.xa=[re.xa];e:if(Ge=d,de=f,ye=v,Le=re.gb[0],ke=re.Ja,Ze=re.xa,je=de[0],we=!n(Ge,je,"VP8 "),St=!n(Ge,je,"VP8L"),e(Ge!=null),e(ye!=null),e(ke!=null),e(Ze!=null),8>ye[0])de=7;else{if(we||St){if(Ge=De(Ge,je+4),12<=Le&&Ge>Le-12){de=3;break e}if(H&&Ge>ye[0]-8){de=7;break e}ke[0]=Ge,de[0]+=8,ye[0]-=8,Ze[0]=St}else Ze[0]=5<=ye[0]&&Ge[je+0]==47&&!(Ge[je+4]>>5),ke[0]=ye[0];de=0}if(v=v[0],re.Ja=re.Ja[0],re.xa=re.xa[0],f=f[0],de!=0)break;if(4294967286<re.Ja)return 3;if(D==null||ve||(D[0]=re.xa?2:1),R=[R],ce=[ce],re.xa){if(5>v){de=7;break}D=R,H=ce,ve=P,d==null||5>v?d=0:5<=v&&d[f+0]==47&&!(d[f+4]>>5)?(ye=[0],Ge=[0],Le=[0],ge(ke=new $,d,f,v),Pr(ke,ye,Ge,Le)?(D!=null&&(D[0]=ye[0]),H!=null&&(H[0]=Ge[0]),ve!=null&&(ve[0]=Le[0]),d=1):d=0):d=0}else{if(10>v){de=7;break}D=ce,d==null||10>v||!Oo(d,f+3,v-3)?d=0:(H=d[f+0]|d[f+1]<<8|d[f+2]<<16,ve=16383&(d[f+7]<<8|d[f+6]),d=16383&(d[f+9]<<8|d[f+8]),1&H||3<(H>>1&7)||!(H>>4&1)||H>>5>=re.Ja||!ve||!d?d=0:(R&&(R[0]=ve),D&&(D[0]=d),d=1))}if(!d||(R=R[0],ce=ce[0],he&&(z[0]!=R||ne[0]!=ce)))return 3;B!=null&&(B[0]=re,B.offset=f-B.w,e(4294967286>f-B.w),e(B.offset==B.ha-v));break}return de==0||de==7&&he&&B==null?(P!=null&&(P[0]|=re.na!=null&&0<re.na.length),w!=null&&(w[0]=R),L!=null&&(L[0]=ce),0):de}function Ms(d,f,v){var w=f.width,L=f.height,P=0,R=0,D=w,B=L;if(f.Da=d!=null&&0<d.Da,f.Da&&(D=d.cd,B=d.bd,P=d.v,R=d.j,11>v||(P&=-2,R&=-2),0>P||0>R||0>=D||0>=B||P+D>w||R+B>L))return 0;if(f.v=P,f.j=R,f.va=P+D,f.o=R+B,f.U=D,f.T=B,f.da=d!=null&&0<d.da,f.da){if(!He(D,B,v=[d.ib],P=[d.hb]))return 0;f.ib=v[0],f.hb=P[0]}return f.ob=d!=null&&d.ob,f.Kb=d==null||!d.Sd,f.da&&(f.ob=f.ib<3*w/4&&f.hb<3*L/4,f.Kb=0),1}function Us(d){if(d==null)return 2;if(11>d.S){var f=d.f.RGBA;f.fb+=(d.height-1)*f.A,f.A=-f.A}else f=d.f.kb,d=d.height,f.O+=(d-1)*f.fa,f.fa=-f.fa,f.N+=(d-1>>1)*f.Ab,f.Ab=-f.Ab,f.W+=(d-1>>1)*f.Db,f.Db=-f.Db,f.F!=null&&(f.J+=(d-1)*f.lb,f.lb=-f.lb);return 0}function Hi(d,f,v,w){if(w==null||0>=d||0>=f)return 2;if(v!=null){if(v.Da){var L=v.cd,P=v.bd,R=-2&v.v,D=-2&v.j;if(0>R||0>D||0>=L||0>=P||R+L>d||D+P>f)return 2;d=L,f=P}if(v.da){if(!He(d,f,L=[v.ib],P=[v.hb]))return 2;d=L[0],f=P[0]}}w.width=d,w.height=f;e:{var B=w.width,z=w.height;if(d=w.S,0>=B||0>=z||!(d>=Ko&&13>d))d=2;else{if(0>=w.Rd&&w.sd==null){R=P=L=f=0;var ne=(D=B*Zd[d])*z;if(11>d||(P=(z+1)/2*(f=(B+1)/2),d==12&&(R=(L=B)*z)),(z=i(ne+2*P+R))==null){d=1;break e}w.sd=z,11>d?((B=w.f.RGBA).eb=z,B.fb=0,B.A=D,B.size=ne):((B=w.f.kb).y=z,B.O=0,B.fa=D,B.Fd=ne,B.f=z,B.N=0+ne,B.Ab=f,B.Cd=P,B.ea=z,B.W=0+ne+P,B.Db=f,B.Ed=P,d==12&&(B.F=z,B.J=0+ne+2*P),B.Tc=R,B.lb=L)}if(f=1,L=w.S,P=w.width,R=w.height,L>=Ko&&13>L)if(11>L)d=w.f.RGBA,f&=(D=Math.abs(d.A))*(R-1)+P<=d.size,f&=D>=P*Zd[L],f&=d.eb!=null;else{d=w.f.kb,D=(P+1)/2,ne=(R+1)/2,B=Math.abs(d.fa),z=Math.abs(d.Ab);var he=Math.abs(d.Db),H=Math.abs(d.lb),re=H*(R-1)+P;f&=B*(R-1)+P<=d.Fd,f&=z*(ne-1)+D<=d.Cd,f=(f&=he*(ne-1)+D<=d.Ed)&B>=P&z>=D&he>=D,f&=d.y!=null,f&=d.f!=null,f&=d.ea!=null,L==12&&(f&=H>=P,f&=re<=d.Tc,f&=d.F!=null)}else f=0;d=f?0:2}}return d!=0||v!=null&&v.fd&&(d=Us(w)),d}var Aa=64,vr=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],br=24,Wi=32,Ti=8,Gi=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Re("Predictor0","PredictorAdd0"),F.Predictor0=function(){return 4278190080},F.Predictor1=function(d){return d},F.Predictor2=function(d,f,v){return f[v+0]},F.Predictor3=function(d,f,v){return f[v+1]},F.Predictor4=function(d,f,v){return f[v-1]},F.Predictor5=function(d,f,v){return Ie(Ie(d,f[v+1]),f[v+0])},F.Predictor6=function(d,f,v){return Ie(d,f[v-1])},F.Predictor7=function(d,f,v){return Ie(d,f[v+0])},F.Predictor8=function(d,f,v){return Ie(f[v-1],f[v+0])},F.Predictor9=function(d,f,v){return Ie(f[v+0],f[v+1])},F.Predictor10=function(d,f,v){return Ie(Ie(d,f[v-1]),Ie(f[v+0],f[v+1]))},F.Predictor11=function(d,f,v){var w=f[v+0];return 0>=at(w>>24&255,d>>24&255,(f=f[v-1])>>24&255)+at(w>>16&255,d>>16&255,f>>16&255)+at(w>>8&255,d>>8&255,f>>8&255)+at(255&w,255&d,255&f)?w:d},F.Predictor12=function(d,f,v){var w=f[v+0];return(it((d>>24&255)+(w>>24&255)-((f=f[v-1])>>24&255))<<24|it((d>>16&255)+(w>>16&255)-(f>>16&255))<<16|it((d>>8&255)+(w>>8&255)-(f>>8&255))<<8|it((255&d)+(255&w)-(255&f)))>>>0},F.Predictor13=function(d,f,v){var w=f[v-1];return(nt((d=Ie(d,f[v+0]))>>24&255,w>>24&255)<<24|nt(d>>16&255,w>>16&255)<<16|nt(d>>8&255,w>>8&255)<<8|nt(255&d,255&w))>>>0};var $s=F.PredictorAdd0;F.PredictorAdd1=ut,Re("Predictor2","PredictorAdd2"),Re("Predictor3","PredictorAdd3"),Re("Predictor4","PredictorAdd4"),Re("Predictor5","PredictorAdd5"),Re("Predictor6","PredictorAdd6"),Re("Predictor7","PredictorAdd7"),Re("Predictor8","PredictorAdd8"),Re("Predictor9","PredictorAdd9"),Re("Predictor10","PredictorAdd10"),Re("Predictor11","PredictorAdd11"),Re("Predictor12","PredictorAdd12"),Re("Predictor13","PredictorAdd13");var Za=F.PredictorAdd2;We("ColorIndexInverseTransform","MapARGB","32b",function(d){return d>>8&255},function(d){return d}),We("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(d){return d},function(d){return d>>8&255});var gn,Wo=F.ColorIndexInverseTransform,ci=F.MapARGB,ui=F.VP8LColorIndexInverseTransformAlpha,qs=F.MapAlpha,zs=F.VP8LPredictorsAdd=[];zs.length=16,(F.VP8LPredictors=[]).length=16,(F.VP8LPredictorsAdd_C=[]).length=16,(F.VP8LPredictors_C=[]).length=16;var Hs,Ws,Vi,Ki,Ji,ka,Yi,Na,jr,di,Bt,Gt,mn,In,Pi,Gs,Qa,Go,Ed,Ld,Cd,Td,Pd,Id,Vs,Od,Rd,Fd,Dd=i(511),jd=i(2041),Bd=i(225),Md=i(767),Ud=0,Nc=jd,Vo=Bd,yr=Md,Br=Dd,Ko=0,Jo=1,$d=2,Yo=3,Xo=4,Ec=5,qd=6,Lc=7,Cc=8,Zo=9,Tc=10,hm=[2,3,7],fm=[3,3,11],zd=[280,256,256,256,40],pm=[0,1,1,1,0],gm=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],mm=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],vm=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],bm=8,Pc=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Ic=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Ks=null,ym=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],_m=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Hd=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],wm=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],xm=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Sm=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Am=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Xi=[],Wr=[],Ii=[],km=1,Wd=2,Zi=[],Mr=[];Li("UpsampleRgbLinePair",zi,3),Li("UpsampleBgrLinePair",Un,3),Li("UpsampleRgbaLinePair",nr,4),Li("UpsampleBgraLinePair",Bs,4),Li("UpsampleArgbLinePair",js,4),Li("UpsampleRgba4444LinePair",xa,2),Li("UpsampleRgb565LinePair",wa,2);var Nm=F.UpsampleRgbLinePair,Em=F.UpsampleBgrLinePair,Gd=F.UpsampleRgbaLinePair,Vd=F.UpsampleBgraLinePair,Kd=F.UpsampleArgbLinePair,Jd=F.UpsampleRgba4444LinePair,Lm=F.UpsampleRgb565LinePair,Qo=16,el=1<<Qo-1,Js=-227,Oc=482,Cm=6,Yd=0,Tm=i(256),Pm=i(256),Im=i(256),Om=i(256),Rm=i(Oc-Js),Fm=i(Oc-Js);Ci("YuvToRgbRow",zi,3),Ci("YuvToBgrRow",Un,3),Ci("YuvToRgbaRow",nr,4),Ci("YuvToBgraRow",Bs,4),Ci("YuvToArgbRow",js,4),Ci("YuvToRgba4444Row",xa,2),Ci("YuvToRgb565Row",wa,2);var Xd=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],tl=[0,2,8],Dm=[8,7,6,4,4,2,2,2,1,1,1,1],jm=1;this.WebPDecodeRGBA=function(d,f,v,w,L){var P=Jo,R=new _e,D=new kt;R.ba=D,D.S=P,D.width=[D.width],D.height=[D.height];var B=D.width,z=D.height,ne=new tt;if(ne==null||d==null)var he=2;else e(ne!=null),he=Sa(d,f,v,ne.width,ne.height,ne.Pd,ne.Qd,ne.format,null);if(he!=0?B=0:(B!=null&&(B[0]=ne.width[0]),z!=null&&(z[0]=ne.height[0]),B=1),B){D.width=D.width[0],D.height=D.height[0],w!=null&&(w[0]=D.width),L!=null&&(L[0]=D.height);e:{if(w=new Wa,(L=new Ae).data=d,L.w=f,L.ha=v,L.kd=1,f=[0],e(L!=null),((d=Sa(L.data,L.w,L.ha,null,null,null,f,null,L))==0||d==7)&&f[0]&&(d=4),(f=d)==0){if(e(R!=null),w.data=L.data,w.w=L.w+L.offset,w.ha=L.ha-L.offset,w.put=rt,w.ac=Tr,w.bc=mr,w.ma=R,L.xa){if((d=ai())==null){R=1;break e}if((function(H,re){var ce=[0],ve=[0],de=[0];t:for(;;){if(H==null)return 0;if(re==null)return H.a=2,0;if(H.l=re,H.a=0,ge(H.m,re.data,re.w,re.ha),!Pr(H.m,ce,ve,de)){H.a=3;break t}if(H.xb=Wd,re.width=ce[0],re.height=ve[0],!Or(ce[0],ve[0],1,H,null))break t;return 1}return e(H.a!=0),0})(d,w)){if(w=(f=Hi(w.width,w.height,R.Oa,R.ba))==0){t:{w=d;n:for(;;){if(w==null){w=0;break t}if(e(w.s.yc!=null),e(w.s.Ya!=null),e(0<w.s.Wb),e((v=w.l)!=null),e((L=v.ma)!=null),w.xb!=0){if(w.ca=L.ba,w.tb=L.tb,e(w.ca!=null),!Ms(L.Oa,v,Yo)){w.a=2;break n}if(!Ue(w,v.width)||v.da)break n;if((v.da||st(w.ca.S))&&Hr(),11>w.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),w.ca.f.kb.F!=null&&Hr()),w.Pb&&0<w.s.ua&&w.s.vb.X==null&&!U(w.s.vb,w.s.Wa.Xa)){w.a=1;break n}w.xb=0}if(!hr(w,w.V,w.Ba,w.c,w.i,v.o,Ir))break n;L.Dc=w.Ma,w=1;break t}e(w.a!=0),w=0}w=!w}w&&(f=d.a)}else f=d.a}else{if((d=new dc)==null){R=1;break e}if(d.Fa=L.na,d.P=L.P,d.qc=L.Sa,oi(d,w)){if((f=Hi(w.width,w.height,R.Oa,R.ba))==0){if(d.Aa=0,v=R.Oa,e((L=d)!=null),v!=null){if(0<(B=0>(B=v.Md)?0:100<B?255:255*B/100)){for(z=ne=0;4>z;++z)12>(he=L.pb[z]).lc&&(he.ia=B*Dm[0>he.lc?0:he.lc]>>3),ne|=he.ia;ne&&(alert("todo:VP8InitRandom"),L.ia=1)}L.Ga=v.Id,100<L.Ga?L.Ga=100:0>L.Ga&&(L.Ga=0)}(function(H,re){if(H==null)return 0;if(re==null)return An(H,2,"NULL VP8Io parameter in VP8Decode().");if(!H.cb&&!oi(H,re))return 0;if(e(H.cb),re.ac==null||re.ac(re)){re.ob&&(H.L=0);var ce=tl[H.L];if(H.L==2?(H.yb=0,H.zb=0):(H.yb=re.v-ce>>4,H.zb=re.j-ce>>4,0>H.yb&&(H.yb=0),0>H.zb&&(H.zb=0)),H.Va=re.o+15+ce>>4,H.Hb=re.va+15+ce>>4,H.Hb>H.za&&(H.Hb=H.za),H.Va>H.Ub&&(H.Va=H.Ub),0<H.L){var ve=H.ed;for(ce=0;4>ce;++ce){var de;if(H.Qa.Cb){var ye=H.Qa.Lb[ce];H.Qa.Fb||(ye+=ve.Tb)}else ye=ve.Tb;for(de=0;1>=de;++de){var we=H.gd[ce][de],Le=ye;if(ve.Pc&&(Le+=ve.vd[0],de&&(Le+=ve.od[0])),0<(Le=0>Le?0:63<Le?63:Le)){var ke=Le;0<ve.wb&&(ke=4<ve.wb?ke>>2:ke>>1)>9-ve.wb&&(ke=9-ve.wb),1>ke&&(ke=1),we.dd=ke,we.tc=2*Le+ke,we.ld=40<=Le?2:15<=Le?1:0}else we.tc=0;we.La=de}}}ce=0}else An(H,6,"Frame setup failed"),ce=H.a;if(ce=ce==0){if(ce){H.$c=0,0<H.Aa||(H.Ic=jm);t:{ce=H.Ic,ve=4*(ke=H.za);var Ze=32*ke,je=ke+1,St=0<H.L?ke*(0<H.Aa?2:1):0,Ge=(H.Aa==2?2:1)*ke;if((we=ve+832+(de=3*(16*ce+tl[H.L])/2*Ze)+(ye=H.Fa!=null&&0<H.Fa.length?H.Kc.c*H.Kc.i:0))!=we)ce=0;else{if(we>H.Vb){if(H.Vb=0,H.Ec=i(we),H.Fc=0,H.Ec==null){ce=An(H,1,"no memory during frame initialization.");break t}H.Vb=we}we=H.Ec,Le=H.Fc,H.Ac=we,H.Bc=Le,Le+=ve,H.Gd=o(Ze,fa),H.Hd=0,H.rb=o(je+1,Rr),H.sb=1,H.wa=St?o(St,un):null,H.Y=0,H.D.Nb=0,H.D.wa=H.wa,H.D.Y=H.Y,0<H.Aa&&(H.D.Y+=ke),e(!0),H.oc=we,H.pc=Le,Le+=832,H.ya=o(Ge,sn),H.aa=0,H.D.ya=H.ya,H.D.aa=H.aa,H.Aa==2&&(H.D.aa+=ke),H.R=16*ke,H.B=8*ke,ke=(Ze=tl[H.L])*H.R,Ze=Ze/2*H.B,H.sa=we,H.ta=Le+ke,H.qa=H.sa,H.ra=H.ta+16*ce*H.R+Ze,H.Ha=H.qa,H.Ia=H.ra+8*ce*H.B+Ze,H.$c=0,Le+=de,H.mb=ye?we:null,H.nb=ye?Le:null,e(Le+ye<=H.Fc+H.Vb),Ro(H),a(H.Ac,H.Bc,0,ve),ce=1}}if(ce){if(re.ka=0,re.y=H.sa,re.O=H.ta,re.f=H.qa,re.N=H.ra,re.ea=H.Ha,re.Vd=H.Ia,re.fa=H.R,re.Rc=H.B,re.F=null,re.J=0,!Ud){for(ce=-255;255>=ce;++ce)Dd[255+ce]=0>ce?-ce:ce;for(ce=-1020;1020>=ce;++ce)jd[1020+ce]=-128>ce?-128:127<ce?127:ce;for(ce=-112;112>=ce;++ce)Bd[112+ce]=-16>ce?-16:15<ce?15:ce;for(ce=-255;510>=ce;++ce)Md[255+ce]=0>ce?0:255<ce?255:ce;Ud=1}Yi=Va,Na=fc,di=li,Bt=Do,Gt=jo,jr=hc,mn=qo,In=ba,Pi=N,Gs=W,Qa=zo,Go=m,Ed=Q,Ld=oe,Cd=va,Td=Fs,Pd=Uo,Id=$o,Wr[0]=wc,Wr[1]=pc,Wr[2]=yc,Wr[3]=_c,Wr[4]=wi,Wr[5]=xc,Wr[6]=xi,Wr[7]=Sc,Wr[8]=Ts,Wr[9]=Ka,Xi[0]=vc,Xi[1]=mc,Xi[2]=Ls,Xi[3]=Bo,Xi[4]=ga,Xi[5]=Cs,Xi[6]=bc,Ii[0]=kc,Ii[1]=gc,Ii[2]=ma,Ii[3]=Ac,Ii[4]=Is,Ii[5]=Ps,Ii[6]=Mo,ce=1}else ce=0}ce&&(ce=(function(Tt,On){for(Tt.M=0;Tt.M<Tt.Va;++Tt.M){var At,Ve=Tt.Jc[Tt.M&Tt.Xb],Oe=Tt.m,vn=Tt;for(At=0;At<vn.za;++At){var _t=Oe,Pt=vn,tn=Pt.Ac,$n=Pt.Bc+4*At,rr=Pt.zc,dn=Pt.ya[Pt.aa+At];if(Pt.Qa.Bb?dn.$b=se(_t,Pt.Pa.jb[0])?2+se(_t,Pt.Pa.jb[2]):se(_t,Pt.Pa.jb[1]):dn.$b=0,Pt.kc&&(dn.Ad=se(_t,Pt.Bd)),dn.Za=!se(_t,145)+0,dn.Za){var Kn=dn.Ob,ir=0;for(Pt=0;4>Pt;++Pt){var Rn,Rt=rr[0+Pt];for(Rn=0;4>Rn;++Rn){Rt=xm[tn[$n+Rn]][Rt];for(var $t=Hd[se(_t,Rt[0])];0<$t;)$t=Hd[2*$t+se(_t,Rt[$t])];Rt=-$t,tn[$n+Rn]=Rt}r(Kn,ir,tn,$n,4),ir+=4,rr[0+Pt]=Rt}}else Rt=se(_t,156)?se(_t,128)?1:3:se(_t,163)?2:0,dn.Ob[0]=Rt,a(tn,$n,Rt,4),a(rr,0,Rt,4);dn.Dd=se(_t,142)?se(_t,114)?se(_t,183)?1:3:2:0}if(vn.m.Ka)return An(Tt,7,"Premature end-of-partition0 encountered.");for(;Tt.ja<Tt.za;++Tt.ja){if(vn=Ve,_t=(Oe=Tt).rb[Oe.sb-1],tn=Oe.rb[Oe.sb+Oe.ja],At=Oe.ya[Oe.aa+Oe.ja],$n=Oe.kc?At.Ad:0)_t.la=tn.la=0,At.Za||(_t.Na=tn.Na=0),At.Hc=0,At.Gc=0,At.ia=0;else{var hn,qt;if(_t=tn,tn=vn,$n=Oe.Pa.Xc,rr=Oe.ya[Oe.aa+Oe.ja],dn=Oe.pb[rr.$b],Pt=rr.ad,Kn=0,ir=Oe.rb[Oe.sb-1],Rt=Rn=0,a(Pt,Kn,0,384),rr.Za)var qn=0,Gr=$n[3];else{$t=i(16);var bn=_t.Na+ir.Na;if(bn=Ks(tn,$n[1],bn,dn.Eb,0,$t,0),_t.Na=ir.Na=(0<bn)+0,1<bn)Yi($t,0,Pt,Kn);else{var fr=$t[0]+3>>3;for($t=0;256>$t;$t+=16)Pt[Kn+$t]=fr}qn=1,Gr=$n[0]}var Vt=15&_t.la,Fn=15&ir.la;for($t=0;4>$t;++$t){var _r=1&Fn;for(fr=qt=0;4>fr;++fr)Vt=Vt>>1|(_r=(bn=Ks(tn,Gr,bn=_r+(1&Vt),dn.Sc,qn,Pt,Kn))>qn)<<7,qt=qt<<2|(3<bn?3:1<bn?2:Pt[Kn+0]!=0),Kn+=16;Vt>>=4,Fn=Fn>>1|_r<<7,Rn=(Rn<<8|qt)>>>0}for(Gr=Vt,qn=Fn>>4,hn=0;4>hn;hn+=2){for(qt=0,Vt=_t.la>>4+hn,Fn=ir.la>>4+hn,$t=0;2>$t;++$t){for(_r=1&Fn,fr=0;2>fr;++fr)bn=_r+(1&Vt),Vt=Vt>>1|(_r=0<(bn=Ks(tn,$n[2],bn,dn.Qc,0,Pt,Kn)))<<3,qt=qt<<2|(3<bn?3:1<bn?2:Pt[Kn+0]!=0),Kn+=16;Vt>>=2,Fn=Fn>>1|_r<<5}Rt|=qt<<4*hn,Gr|=Vt<<4<<hn,qn|=(240&Fn)<<hn}_t.la=Gr,ir.la=qn,rr.Hc=Rn,rr.Gc=Rt,rr.ia=43690&Rt?0:dn.ia,$n=!(Rn|Rt)}if(0<Oe.L&&(Oe.wa[Oe.Y+Oe.ja]=Oe.gd[At.$b][At.Za],Oe.wa[Oe.Y+Oe.ja].La|=!$n),vn.Ka)return An(Tt,7,"Premature end-of-file encountered.")}if(Ro(Tt),Oe=On,vn=1,At=(Ve=Tt).D,_t=0<Ve.L&&Ve.M>=Ve.zb&&Ve.M<=Ve.Va,Ve.Aa==0)t:{if(At.M=Ve.M,At.uc=_t,Dr(Ve,At),vn=1,At=(qt=Ve.D).Nb,_t=(Rt=tl[Ve.L])*Ve.R,tn=Rt/2*Ve.B,$t=16*At*Ve.R,fr=8*At*Ve.B,$n=Ve.sa,rr=Ve.ta-_t+$t,dn=Ve.qa,Pt=Ve.ra-tn+fr,Kn=Ve.Ha,ir=Ve.Ia-tn+fr,Fn=(Vt=qt.M)==0,Rn=Vt>=Ve.Va-1,Ve.Aa==2&&Dr(Ve,qt),qt.uc)for(_r=(bn=Ve).D.M,e(bn.D.uc),qt=bn.yb;qt<bn.Hb;++qt){qn=qt,Gr=_r;var ar=(wr=(zn=bn).D).Nb;hn=zn.R;var wr=wr.wa[wr.Y+qn],xr=zn.sa,pr=zn.ta+16*ar*hn+16*qn,Sr=wr.dd,Zt=wr.tc;if(Zt!=0)if(e(3<=Zt),zn.L==1)0<qn&&Td(xr,pr,hn,Zt+4),wr.La&&Id(xr,pr,hn,Zt),0<Gr&&Cd(xr,pr,hn,Zt+4),wr.La&&Pd(xr,pr,hn,Zt);else{var Ar=zn.B,Vr=zn.qa,Ea=zn.ra+8*ar*Ar+8*qn,Oi=zn.Ha,zn=zn.Ia+8*ar*Ar+8*qn;ar=wr.ld,0<qn&&(In(xr,pr,hn,Zt+4,Sr,ar),Gs(Vr,Ea,Oi,zn,Ar,Zt+4,Sr,ar)),wr.La&&(Go(xr,pr,hn,Zt,Sr,ar),Ld(Vr,Ea,Oi,zn,Ar,Zt,Sr,ar)),0<Gr&&(mn(xr,pr,hn,Zt+4,Sr,ar),Pi(Vr,Ea,Oi,zn,Ar,Zt+4,Sr,ar)),wr.La&&(Qa(xr,pr,hn,Zt,Sr,ar),Ed(Vr,Ea,Oi,zn,Ar,Zt,Sr,ar))}}if(Ve.ia&&alert("todo:DitherRow"),Oe.put!=null){if(qt=16*Vt,Vt=16*(Vt+1),Fn?(Oe.y=Ve.sa,Oe.O=Ve.ta+$t,Oe.f=Ve.qa,Oe.N=Ve.ra+fr,Oe.ea=Ve.Ha,Oe.W=Ve.Ia+fr):(qt-=Rt,Oe.y=$n,Oe.O=rr,Oe.f=dn,Oe.N=Pt,Oe.ea=Kn,Oe.W=ir),Rn||(Vt-=Rt),Vt>Oe.o&&(Vt=Oe.o),Oe.F=null,Oe.J=null,Ve.Fa!=null&&0<Ve.Fa.length&&qt<Vt&&(Oe.J=Xt(Ve,Oe,qt,Vt-qt),Oe.F=Ve.mb,Oe.F==null&&Oe.F.length==0)){vn=An(Ve,3,"Could not decode alpha data.");break t}qt<Oe.j&&(Rt=Oe.j-qt,qt=Oe.j,e(!(1&Rt)),Oe.O+=Ve.R*Rt,Oe.N+=Ve.B*(Rt>>1),Oe.W+=Ve.B*(Rt>>1),Oe.F!=null&&(Oe.J+=Oe.width*Rt)),qt<Vt&&(Oe.O+=Oe.v,Oe.N+=Oe.v>>1,Oe.W+=Oe.v>>1,Oe.F!=null&&(Oe.J+=Oe.v),Oe.ka=qt-Oe.j,Oe.U=Oe.va-Oe.v,Oe.T=Vt-qt,vn=Oe.put(Oe))}At+1!=Ve.Ic||Rn||(r(Ve.sa,Ve.ta-_t,$n,rr+16*Ve.R,_t),r(Ve.qa,Ve.ra-tn,dn,Pt+8*Ve.B,tn),r(Ve.Ha,Ve.Ia-tn,Kn,ir+8*Ve.B,tn))}if(!vn)return An(Tt,6,"Output aborted.")}return 1})(H,re)),re.bc!=null&&re.bc(re),ce&=1}return ce?(H.cb=0,ce):0})(d,w)||(f=d.a)}}else f=d.a}f==0&&R.Oa!=null&&R.Oa.fd&&(f=Us(R.ba))}R=f}P=R!=0?null:11>P?D.f.RGBA.eb:D.f.kb.y}else P=null;return P};var Zd=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function u(F,I){for(var k="",A=0;A<4;A++)k+=String.fromCharCode(F[I++]);return k}function h(F,I){return F[I+0]|F[I+1]<<8}function g(F,I){return(F[I+0]|F[I+1]<<8|F[I+2]<<16)>>>0}function b(F,I){return(F[I+0]|F[I+1]<<8|F[I+2]<<16|F[I+3]<<24)>>>0}new c;var p=[0],y=[0],_=[],S=new c,x=t,T=(function(F,I){var k={},A=0,j=!1,q=0,K=0;if(k.frames=[],!(function(C,$){for(var V=0;V<4;V++)if(C[$+V]!="RIFF".charCodeAt(V))return!0;return!1})(F,I)){for(b(F,I+=4),I+=8;I<F.length;){var le=u(F,I),ue=b(F,I+=4);I+=4;var ae=ue+(1&ue);switch(le){case"VP8 ":case"VP8L":k.frames[A]===void 0&&(k.frames[A]={}),(pe=k.frames[A]).src_off=j?K:I-8,pe.src_size=q+ue+8,A++,j&&(j=!1,q=0,K=0);break;case"VP8X":(pe=k.header={}).feature_flags=F[I];var ge=I+4;pe.canvas_width=1+g(F,ge),ge+=3,pe.canvas_height=1+g(F,ge),ge+=3;break;case"ALPH":j=!0,q=ae+8,K=I-8;break;case"ANIM":(pe=k.header).bgcolor=b(F,I),ge=I+4,pe.loop_count=h(F,ge),ge+=2;break;case"ANMF":var xe,pe;(pe=k.frames[A]={}).offset_x=2*g(F,I),I+=3,pe.offset_y=2*g(F,I),I+=3,pe.width=1+g(F,I),I+=3,pe.height=1+g(F,I),I+=3,pe.duration=g(F,I),I+=3,xe=F[I++],pe.dispose=1&xe,pe.blend=xe>>1&1}le!="ANMF"&&(I+=ae)}return k}})(x,0);T.response=x,T.rgbaoutput=!0,T.dataurl=!1;var O=T.header?T.header:null,E=T.frames?T.frames:null;if(O){O.loop_counter=O.loop_count,p=[O.canvas_height],y=[O.canvas_width];for(var M=0;M<E.length&&E[M].blend!=0;M++);}var ee=E[0],G=S.WebPDecodeRGBA(x,ee.src_off,ee.src_size,y,p);ee.rgba=G,ee.imgwidth=y[0],ee.imgheight=p[0];for(var X=0;X<y[0]*p[0]*4;X++)_[X]=G[X];return this.width=y,this.height=p,this.data=_,this}/** ====================================================================
 * @license
 * jsPDF XMP metadata plugin
 * Copyright (c) 2016 Jussi Utunen, u-jussi@suomi24.fi
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */function Uy(){var t,e=this.internal.__metadata__.metadata,n=unescape(encodeURIComponent(e));t=this.internal.__metadata__.rawXml?n:'<x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceUri+'"><jspdf:metadata>'+n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")+"</jspdf:metadata></rdf:Description></rdf:RDF></x:xmpmeta>",this.internal.__metadata__.metadataObjectNumber=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+t.length+" >>"),this.internal.write("stream"),this.internal.write(t),this.internal.write("endstream"),this.internal.write("endobj")}function $y(){this.internal.__metadata__.metadataObjectNumber&&this.internal.write("/Metadata "+this.internal.__metadata__.metadataObjectNumber+" 0 R")}(function(t){var e,n,r,a,i,o,l,c,u,h=function(C){return C=C||{},this.isStrokeTransparent=C.isStrokeTransparent||!1,this.strokeOpacity=C.strokeOpacity||1,this.strokeStyle=C.strokeStyle||"#000000",this.fillStyle=C.fillStyle||"#000000",this.isFillTransparent=C.isFillTransparent||!1,this.fillOpacity=C.fillOpacity||1,this.font=C.font||"10px sans-serif",this.textBaseline=C.textBaseline||"alphabetic",this.textAlign=C.textAlign||"left",this.lineWidth=C.lineWidth||1,this.lineJoin=C.lineJoin||"miter",this.lineCap=C.lineCap||"butt",this.path=C.path||[],this.transform=C.transform!==void 0?C.transform.clone():new c,this.globalCompositeOperation=C.globalCompositeOperation||"normal",this.globalAlpha=C.globalAlpha||1,this.clip_path=C.clip_path||[],this.currentPoint=C.currentPoint||new o,this.miterLimit=C.miterLimit||10,this.lastPoint=C.lastPoint||new o,this.lineDashOffset=C.lineDashOffset||0,this.lineDash=C.lineDash||[],this.margin=C.margin||[0,0,0,0],this.prevPageLastElemOffset=C.prevPageLastElemOffset||0,this.ignoreClearRect=typeof C.ignoreClearRect!="boolean"||C.ignoreClearRect,this};t.events.push(["initialized",function(){this.context2d=new g(this),e=this.internal.f2,n=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,a=this.internal.getHorizontalCoordinate,i=this.internal.getVerticalCoordinate,o=this.internal.Point,l=this.internal.Rectangle,c=this.internal.Matrix,u=new h}]);var g=function(C){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var $=C;Object.defineProperty(this,"pdf",{get:function(){return $}});var V=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return V},set:function(U){V=!!U}});var J=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return J},set:function(U){J=!!U}});var Z=0;Object.defineProperty(this,"posX",{get:function(){return Z},set:function(U){isNaN(U)||(Z=U)}});var ie=0;Object.defineProperty(this,"posY",{get:function(){return ie},set:function(U){isNaN(U)||(ie=U)}}),Object.defineProperty(this,"margin",{get:function(){return u.margin},set:function(U){var Pe;typeof U=="number"?Pe=[U,U,U,U]:((Pe=new Array(4))[0]=U[0],Pe[1]=U.length>=2?U[1]:Pe[0],Pe[2]=U.length>=3?U[2]:Pe[0],Pe[3]=U.length>=4?U[3]:Pe[1]),u.margin=Pe}});var fe=!1;Object.defineProperty(this,"autoPaging",{get:function(){return fe},set:function(U){fe=U}});var Y=0;Object.defineProperty(this,"lastBreak",{get:function(){return Y},set:function(U){Y=U}});var se=[];Object.defineProperty(this,"pageBreaks",{get:function(){return se},set:function(U){se=U}}),Object.defineProperty(this,"ctx",{get:function(){return u},set:function(U){U instanceof h&&(u=U)}}),Object.defineProperty(this,"path",{get:function(){return u.path},set:function(U){u.path=U}});var be=[];Object.defineProperty(this,"ctxStack",{get:function(){return be},set:function(U){be=U}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(U){var Pe;Pe=b(U),this.ctx.fillStyle=Pe.style,this.ctx.isFillTransparent=Pe.a===0,this.ctx.fillOpacity=Pe.a,this.pdf.setFillColor(Pe.r,Pe.g,Pe.b,{a:Pe.a}),this.pdf.setTextColor(Pe.r,Pe.g,Pe.b,{a:Pe.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(U){var Pe=b(U);this.ctx.strokeStyle=Pe.style,this.ctx.isStrokeTransparent=Pe.a===0,this.ctx.strokeOpacity=Pe.a,Pe.a===0?this.pdf.setDrawColor(255,255,255):(Pe.a,this.pdf.setDrawColor(Pe.r,Pe.g,Pe.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(U){["butt","round","square"].indexOf(U)!==-1&&(this.ctx.lineCap=U,this.pdf.setLineCap(U))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(U){isNaN(U)||(this.ctx.lineWidth=U,this.pdf.setLineWidth(U))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(U){["bevel","round","miter"].indexOf(U)!==-1&&(this.ctx.lineJoin=U,this.pdf.setLineJoin(U))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(U){isNaN(U)||(this.ctx.miterLimit=U,this.pdf.setMiterLimit(U))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(U){this.ctx.textBaseline=U}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(U){["right","end","center","left","start"].indexOf(U)!==-1&&(this.ctx.textAlign=U)}});var Ce=null,Te=null,De=null;Object.defineProperty(this,"fontFaces",{get:function(){return De},set:function(U){Ce=null,Te=null,De=U}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(U){var Pe;if(this.ctx.font=U,(Pe=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(U))!==null){var ht=Pe[1];Pe[2];var He=Pe[3],Se=Pe[4];Pe[5];var Ke=Pe[6],Re=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Se)[2];Se=Math.floor(Re==="px"?parseFloat(Se)*this.pdf.internal.scaleFactor:Re==="em"?parseFloat(Se)*this.pdf.getFontSize():parseFloat(Se)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Se);var Qe=(function(We){var rn,Et,bt=[],ct=We.trim();if(ct==="")return xu;if(ct in up)return[up[ct]];for(;ct!=="";){switch(Et=null,rn=(ct=hp(ct)).charAt(0)){case'"':case"'":Et=Ry(ct.substring(1),rn);break;default:Et=Fy(ct)}if(Et===null||(bt.push(Et[0]),(ct=hp(Et[1]))!==""&&ct.charAt(0)!==","))return xu;ct=ct.replace(/^,/,"")}return bt})(Ke);if(this.fontFaces){var Ie=(function(We,rn){var Et=We.getFontList(),bt=JSON.stringify(Et);if(Ce===null||Te!==bt){var ct=(function(Dt){var et=[];return Object.keys(Dt).forEach(function(jt){Dt[jt].forEach(function(st){var dt=null;switch(st){case"bold":dt={family:jt,weight:"bold"};break;case"italic":dt={family:jt,style:"italic"};break;case"bolditalic":dt={family:jt,weight:"bold",style:"italic"};break;case"":case"normal":dt={family:jt}}dt!==null&&(dt.ref={name:jt,style:st},et.push(dt))})}),et})(Et);Ce=(function(Dt){for(var et={},jt=0;jt<Dt.length;++jt){var st=wu(Dt[jt]),dt=st.family,Ut=st.stretch,kt=st.style,tt=st.weight;et[dt]=et[dt]||{},et[dt][Ut]=et[dt][Ut]||{},et[dt][Ut][kt]=et[dt][Ut][kt]||{},et[dt][Ut][kt][tt]=st}return et})(ct.concat(rn)),Te=bt}return Ce})(this.pdf,this.fontFaces),it=Qe.map(function(We){return{family:We,stretch:"normal",weight:He,style:ht}}),nt=(function(We,rn,Et){for(var bt=(Et=Et||{}).defaultFontFamily||"times",ct=Object.assign({},Oy,Et.genericFontFamilies||{}),Dt=null,et=null,jt=0;jt<rn.length;++jt)if(ct[(Dt=wu(rn[jt])).family]&&(Dt.family=ct[Dt.family]),We.hasOwnProperty(Dt.family)){et=We[Dt.family];break}if(!(et=et||We[bt]))throw new Error("Could not find a font-family for the rule '"+dp(Dt)+"' and default family '"+bt+"'.");if(et=(function(st,dt){if(dt[st])return dt[st];var Ut=ad[st],kt=Ut<=ad.normal?-1:1,tt=cp(dt,om,Ut,kt);if(!tt)throw new Error("Could not find a matching font-stretch value for "+st);return tt})(Dt.stretch,et),et=(function(st,dt){if(dt[st])return dt[st];for(var Ut=sm[st],kt=0;kt<Ut.length;++kt)if(dt[Ut[kt]])return dt[Ut[kt]];throw new Error("Could not find a matching font-style for "+st)})(Dt.style,et),!(et=(function(st,dt){if(dt[st])return dt[st];if(st===400&&dt[500])return dt[500];if(st===500&&dt[400])return dt[400];var Ut=Iy[st],kt=cp(dt,lm,Ut,st<400?-1:1);if(!kt)throw new Error("Could not find a matching font-weight for value "+st);return kt})(Dt.weight,et)))throw new Error("Failed to resolve a font for the rule '"+dp(Dt)+"'.");return et})(Ie,it);this.pdf.setFont(nt.ref.name,nt.ref.style)}else{var at="";(He==="bold"||parseInt(He,10)>=700||ht==="bold")&&(at="bold"),ht==="italic"&&(at+="italic"),at.length===0&&(at="normal");for(var ut="",pt={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},ze=0;ze<Qe.length;ze++){if(this.pdf.internal.getFont(Qe[ze],at,{noFallback:!0,disableWarning:!0})!==void 0){ut=Qe[ze];break}if(at==="bolditalic"&&this.pdf.internal.getFont(Qe[ze],"bold",{noFallback:!0,disableWarning:!0})!==void 0)ut=Qe[ze],at="bold";else if(this.pdf.internal.getFont(Qe[ze],"normal",{noFallback:!0,disableWarning:!0})!==void 0){ut=Qe[ze],at="normal";break}}if(ut===""){for(var mt=0;mt<Qe.length;mt++)if(pt[Qe[mt]]){ut=pt[Qe[mt]];break}}ut=ut===""?"Times":ut,this.pdf.setFont(ut,at)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(U){this.ctx.globalCompositeOperation=U}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(U){this.ctx.globalAlpha=U}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(U){this.ctx.lineDashOffset=U,pe.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(U){this.ctx.lineDash=U,pe.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(U){this.ctx.ignoreClearRect=!!U}})};g.prototype.setLineDash=function(C){this.lineDash=C},g.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},g.prototype.fill=function(){E.call(this,"fill",!1)},g.prototype.stroke=function(){E.call(this,"stroke",!1)},g.prototype.beginPath=function(){this.path=[{type:"begin"}]},g.prototype.moveTo=function(C,$){if(isNaN(C)||isNaN($))throw Kt.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var V=this.ctx.transform.applyToPoint(new o(C,$));this.path.push({type:"mt",x:V.x,y:V.y}),this.ctx.lastPoint=new o(C,$)},g.prototype.closePath=function(){var C=new o(0,0),$=0;for($=this.path.length-1;$!==-1;$--)if(this.path[$].type==="begin"&&Ht(this.path[$+1])==="object"&&typeof this.path[$+1].x=="number"){C=new o(this.path[$+1].x,this.path[$+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new o(C.x,C.y)},g.prototype.lineTo=function(C,$){if(isNaN(C)||isNaN($))throw Kt.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var V=this.ctx.transform.applyToPoint(new o(C,$));this.path.push({type:"lt",x:V.x,y:V.y}),this.ctx.lastPoint=new o(V.x,V.y)},g.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),E.call(this,null,!0)},g.prototype.quadraticCurveTo=function(C,$,V,J){if(isNaN(V)||isNaN(J)||isNaN(C)||isNaN($))throw Kt.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var Z=this.ctx.transform.applyToPoint(new o(V,J)),ie=this.ctx.transform.applyToPoint(new o(C,$));this.path.push({type:"qct",x1:ie.x,y1:ie.y,x:Z.x,y:Z.y}),this.ctx.lastPoint=new o(Z.x,Z.y)},g.prototype.bezierCurveTo=function(C,$,V,J,Z,ie){if(isNaN(Z)||isNaN(ie)||isNaN(C)||isNaN($)||isNaN(V)||isNaN(J))throw Kt.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var fe=this.ctx.transform.applyToPoint(new o(Z,ie)),Y=this.ctx.transform.applyToPoint(new o(C,$)),se=this.ctx.transform.applyToPoint(new o(V,J));this.path.push({type:"bct",x1:Y.x,y1:Y.y,x2:se.x,y2:se.y,x:fe.x,y:fe.y}),this.ctx.lastPoint=new o(fe.x,fe.y)},g.prototype.arc=function(C,$,V,J,Z,ie){if(isNaN(C)||isNaN($)||isNaN(V)||isNaN(J)||isNaN(Z))throw Kt.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(ie=!!ie,!this.ctx.transform.isIdentity){var fe=this.ctx.transform.applyToPoint(new o(C,$));C=fe.x,$=fe.y;var Y=this.ctx.transform.applyToPoint(new o(0,V)),se=this.ctx.transform.applyToPoint(new o(0,0));V=Math.sqrt(Math.pow(Y.x-se.x,2)+Math.pow(Y.y-se.y,2))}Math.abs(Z-J)>=2*Math.PI&&(J=0,Z=2*Math.PI),this.path.push({type:"arc",x:C,y:$,radius:V,startAngle:J,endAngle:Z,counterclockwise:ie})},g.prototype.arcTo=function(C,$,V,J,Z){throw new Error("arcTo not implemented.")},g.prototype.rect=function(C,$,V,J){if(isNaN(C)||isNaN($)||isNaN(V)||isNaN(J))throw Kt.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(C,$),this.lineTo(C+V,$),this.lineTo(C+V,$+J),this.lineTo(C,$+J),this.lineTo(C,$),this.lineTo(C+V,$),this.lineTo(C,$)},g.prototype.fillRect=function(C,$,V,J){if(isNaN(C)||isNaN($)||isNaN(V)||isNaN(J))throw Kt.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!p.call(this)){var Z={};this.lineCap!=="butt"&&(Z.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(Z.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(C,$,V,J),this.fill(),Z.hasOwnProperty("lineCap")&&(this.lineCap=Z.lineCap),Z.hasOwnProperty("lineJoin")&&(this.lineJoin=Z.lineJoin)}},g.prototype.strokeRect=function(C,$,V,J){if(isNaN(C)||isNaN($)||isNaN(V)||isNaN(J))throw Kt.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");y.call(this)||(this.beginPath(),this.rect(C,$,V,J),this.stroke())},g.prototype.clearRect=function(C,$,V,J){if(isNaN(C)||isNaN($)||isNaN(V)||isNaN(J))throw Kt.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(C,$,V,J))},g.prototype.save=function(C){C=typeof C!="boolean"||C;for(var $=this.pdf.internal.getCurrentPageInfo().pageNumber,V=0;V<this.pdf.internal.getNumberOfPages();V++)this.pdf.setPage(V+1),this.pdf.internal.out("q");if(this.pdf.setPage($),C){this.ctx.fontSize=this.pdf.internal.getFontSize();var J=new h(this.ctx);this.ctxStack.push(this.ctx),this.ctx=J}},g.prototype.restore=function(C){C=typeof C!="boolean"||C;for(var $=this.pdf.internal.getCurrentPageInfo().pageNumber,V=0;V<this.pdf.internal.getNumberOfPages();V++)this.pdf.setPage(V+1),this.pdf.internal.out("Q");this.pdf.setPage($),C&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},g.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var b=function(C){var $,V,J,Z;if(C.isCanvasGradient===!0&&(C=C.getColor()),!C)return{r:0,g:0,b:0,a:0,style:C};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(C))$=0,V=0,J=0,Z=0;else{var ie=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(C);if(ie!==null)$=parseInt(ie[1]),V=parseInt(ie[2]),J=parseInt(ie[3]),Z=1;else if((ie=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(C))!==null)$=parseInt(ie[1]),V=parseInt(ie[2]),J=parseInt(ie[3]),Z=parseFloat(ie[4]);else{if(Z=1,typeof C=="string"&&C.charAt(0)!=="#"){var fe=new Qg(C);C=fe.ok?fe.toHex():"#000000"}C.length===4?($=C.substring(1,2),$+=$,V=C.substring(2,3),V+=V,J=C.substring(3,4),J+=J):($=C.substring(1,3),V=C.substring(3,5),J=C.substring(5,7)),$=parseInt($,16),V=parseInt(V,16),J=parseInt(J,16)}}return{r:$,g:V,b:J,a:Z,style:C}},p=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},y=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};g.prototype.fillText=function(C,$,V,J){if(isNaN($)||isNaN(V)||typeof C!="string")throw Kt.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(J=isNaN(J)?void 0:J,!p.call(this)){var Z=ae(this.ctx.transform.rotation),ie=this.ctx.transform.scaleX;A.call(this,{text:C,x:$,y:V,scale:ie,angle:Z,align:this.textAlign,maxWidth:J})}},g.prototype.strokeText=function(C,$,V,J){if(isNaN($)||isNaN(V)||typeof C!="string")throw Kt.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!y.call(this)){J=isNaN(J)?void 0:J;var Z=ae(this.ctx.transform.rotation),ie=this.ctx.transform.scaleX;A.call(this,{text:C,x:$,y:V,scale:ie,renderingMode:"stroke",angle:Z,align:this.textAlign,maxWidth:J})}},g.prototype.measureText=function(C){if(typeof C!="string")throw Kt.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var $=this.pdf,V=this.pdf.internal.scaleFactor,J=$.internal.getFontSize(),Z=$.getStringUnitWidth(C)*J/$.internal.scaleFactor;return new function(ie){var fe=(ie=ie||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return fe}}),this}({width:Z*=Math.round(96*V/72*1e4)/1e4})},g.prototype.scale=function(C,$){if(isNaN(C)||isNaN($))throw Kt.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var V=new c(C,0,0,$,0,0);this.ctx.transform=this.ctx.transform.multiply(V)},g.prototype.rotate=function(C){if(isNaN(C))throw Kt.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var $=new c(Math.cos(C),Math.sin(C),-Math.sin(C),Math.cos(C),0,0);this.ctx.transform=this.ctx.transform.multiply($)},g.prototype.translate=function(C,$){if(isNaN(C)||isNaN($))throw Kt.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var V=new c(1,0,0,1,C,$);this.ctx.transform=this.ctx.transform.multiply(V)},g.prototype.transform=function(C,$,V,J,Z,ie){if(isNaN(C)||isNaN($)||isNaN(V)||isNaN(J)||isNaN(Z)||isNaN(ie))throw Kt.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var fe=new c(C,$,V,J,Z,ie);this.ctx.transform=this.ctx.transform.multiply(fe)},g.prototype.setTransform=function(C,$,V,J,Z,ie){C=isNaN(C)?1:C,$=isNaN($)?0:$,V=isNaN(V)?0:V,J=isNaN(J)?1:J,Z=isNaN(Z)?0:Z,ie=isNaN(ie)?0:ie,this.ctx.transform=new c(C,$,V,J,Z,ie)};var _=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};g.prototype.drawImage=function(C,$,V,J,Z,ie,fe,Y,se){var be=this.pdf.getImageProperties(C),Ce=1,Te=1,De=1,U=1;J!==void 0&&Y!==void 0&&(De=Y/J,U=se/Z,Ce=be.width/J*Y/J,Te=be.height/Z*se/Z),ie===void 0&&(ie=$,fe=V,$=0,V=0),J!==void 0&&Y===void 0&&(Y=J,se=Z),J===void 0&&Y===void 0&&(Y=be.width,se=be.height);var Pe=this.ctx.transform.decompose(),ht=ae(Pe.rotate.shx),He=new c,Se=(He=(He=(He=He.multiply(Pe.translate)).multiply(Pe.skew)).multiply(Pe.scale)).applyToRectangle(new l(ie-$*De,fe-V*U,J*Ce,Z*Te));if(this.autoPaging){for(var Ke,Re=S.call(this,Se),Qe=[],Ie=0;Ie<Re.length;Ie+=1)Qe.indexOf(Re[Ie])===-1&&Qe.push(Re[Ie]);O(Qe);for(var it=Qe[0],nt=Qe[Qe.length-1],at=it;at<nt+1;at++){this.pdf.setPage(at);var ut=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],pt=at===1?this.posY+this.margin[0]:this.margin[0],ze=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],mt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],We=at===1?0:ze+(at-2)*mt;if(this.ctx.clip_path.length!==0){var rn=this.path;Ke=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=T(Ke,this.posX+this.margin[3],-We+pt+this.ctx.prevPageLastElemOffset),M.call(this,"fill",!0),this.path=rn}var Et=JSON.parse(JSON.stringify(Se));Et=T([Et],this.posX+this.margin[3],-We+pt+this.ctx.prevPageLastElemOffset)[0];var bt=(at>it||at<nt)&&_.call(this);bt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ut,mt,null).clip().discardPath()),this.pdf.addImage(C,"JPEG",Et.x,Et.y,Et.w,Et.h,null,null,ht),bt&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(C,"JPEG",Se.x,Se.y,Se.w,Se.h,null,null,ht)};var S=function(C,$,V){var J=[];$=$||this.pdf.internal.pageSize.width,V=V||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var Z=this.posY+this.ctx.prevPageLastElemOffset;switch(C.type){default:case"mt":case"lt":J.push(Math.floor((C.y+Z)/V)+1);break;case"arc":J.push(Math.floor((C.y+Z-C.radius)/V)+1),J.push(Math.floor((C.y+Z+C.radius)/V)+1);break;case"qct":var ie=ge(this.ctx.lastPoint.x,this.ctx.lastPoint.y,C.x1,C.y1,C.x,C.y);J.push(Math.floor((ie.y+Z)/V)+1),J.push(Math.floor((ie.y+ie.h+Z)/V)+1);break;case"bct":var fe=xe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,C.x1,C.y1,C.x2,C.y2,C.x,C.y);J.push(Math.floor((fe.y+Z)/V)+1),J.push(Math.floor((fe.y+fe.h+Z)/V)+1);break;case"rect":J.push(Math.floor((C.y+Z)/V)+1),J.push(Math.floor((C.y+C.h+Z)/V)+1)}for(var Y=0;Y<J.length;Y+=1)for(;this.pdf.internal.getNumberOfPages()<J[Y];)x.call(this);return J},x=function(){var C=this.fillStyle,$=this.strokeStyle,V=this.font,J=this.lineCap,Z=this.lineWidth,ie=this.lineJoin;this.pdf.addPage(),this.fillStyle=C,this.strokeStyle=$,this.font=V,this.lineCap=J,this.lineWidth=Z,this.lineJoin=ie},T=function(C,$,V){for(var J=0;J<C.length;J++)switch(C[J].type){case"bct":C[J].x2+=$,C[J].y2+=V;case"qct":C[J].x1+=$,C[J].y1+=V;default:C[J].x+=$,C[J].y+=V}return C},O=function(C){return C.sort(function($,V){return $-V})},E=function(C,$){var V=this.fillStyle,J=this.strokeStyle,Z=this.lineCap,ie=this.lineWidth,fe=Math.abs(ie*this.ctx.transform.scaleX),Y=this.lineJoin;if(this.autoPaging){for(var se,be,Ce=JSON.parse(JSON.stringify(this.path)),Te=JSON.parse(JSON.stringify(this.path)),De=[],U=0;U<Te.length;U++)if(Te[U].x!==void 0)for(var Pe=S.call(this,Te[U]),ht=0;ht<Pe.length;ht+=1)De.indexOf(Pe[ht])===-1&&De.push(Pe[ht]);for(var He=0;He<De.length;He++)for(;this.pdf.internal.getNumberOfPages()<De[He];)x.call(this);O(De);for(var Se=De[0],Ke=De[De.length-1],Re=Se;Re<Ke+1;Re++){this.pdf.setPage(Re),this.fillStyle=V,this.strokeStyle=J,this.lineCap=Z,this.lineWidth=fe,this.lineJoin=Y;var Qe=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Ie=Re===1?this.posY+this.margin[0]:this.margin[0],it=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],nt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],at=Re===1?0:it+(Re-2)*nt;if(this.ctx.clip_path.length!==0){var ut=this.path;se=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=T(se,this.posX+this.margin[3],-at+Ie+this.ctx.prevPageLastElemOffset),M.call(this,C,!0),this.path=ut}if(be=JSON.parse(JSON.stringify(Ce)),this.path=T(be,this.posX+this.margin[3],-at+Ie+this.ctx.prevPageLastElemOffset),$===!1||Re===0){var pt=(Re>Se||Re<Ke)&&_.call(this);pt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Qe,nt,null).clip().discardPath()),M.call(this,C,$),pt&&this.pdf.restoreGraphicsState()}this.lineWidth=ie}this.path=Ce}else this.lineWidth=fe,M.call(this,C,$),this.lineWidth=ie},M=function(C,$){if((C!=="stroke"||$||!y.call(this))&&(C==="stroke"||$||!p.call(this))){for(var V,J,Z=[],ie=this.path,fe=0;fe<ie.length;fe++){var Y=ie[fe];switch(Y.type){case"begin":Z.push({begin:!0});break;case"close":Z.push({close:!0});break;case"mt":Z.push({start:Y,deltas:[],abs:[]});break;case"lt":var se=Z.length;if(ie[fe-1]&&!isNaN(ie[fe-1].x)&&(V=[Y.x-ie[fe-1].x,Y.y-ie[fe-1].y],se>0)){for(;se>=0;se--)if(Z[se-1].close!==!0&&Z[se-1].begin!==!0){Z[se-1].deltas.push(V),Z[se-1].abs.push(Y);break}}break;case"bct":V=[Y.x1-ie[fe-1].x,Y.y1-ie[fe-1].y,Y.x2-ie[fe-1].x,Y.y2-ie[fe-1].y,Y.x-ie[fe-1].x,Y.y-ie[fe-1].y],Z[Z.length-1].deltas.push(V);break;case"qct":var be=ie[fe-1].x+2/3*(Y.x1-ie[fe-1].x),Ce=ie[fe-1].y+2/3*(Y.y1-ie[fe-1].y),Te=Y.x+2/3*(Y.x1-Y.x),De=Y.y+2/3*(Y.y1-Y.y),U=Y.x,Pe=Y.y;V=[be-ie[fe-1].x,Ce-ie[fe-1].y,Te-ie[fe-1].x,De-ie[fe-1].y,U-ie[fe-1].x,Pe-ie[fe-1].y],Z[Z.length-1].deltas.push(V);break;case"arc":Z.push({deltas:[],abs:[],arc:!0}),Array.isArray(Z[Z.length-1].abs)&&Z[Z.length-1].abs.push(Y)}}J=$?null:C==="stroke"?"stroke":"fill";for(var ht=!1,He=0;He<Z.length;He++)if(Z[He].arc)for(var Se=Z[He].abs,Ke=0;Ke<Se.length;Ke++){var Re=Se[Ke];Re.type==="arc"?X.call(this,Re.x,Re.y,Re.radius,Re.startAngle,Re.endAngle,Re.counterclockwise,void 0,$,!ht):j.call(this,Re.x,Re.y),ht=!0}else if(Z[He].close===!0)this.pdf.internal.out("h"),ht=!1;else if(Z[He].begin!==!0){var Qe=Z[He].start.x,Ie=Z[He].start.y;q.call(this,Z[He].deltas,Qe,Ie),ht=!0}J&&F.call(this,J),$&&I.call(this)}},ee=function(C){var $=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,V=$*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return C-V;case"top":return C+$-V;case"hanging":return C+$-2*V;case"middle":return C+$/2-V;default:return C}},G=function(C){return C+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};g.prototype.createLinearGradient=function(){var C=function(){};return C.colorStops=[],C.addColorStop=function($,V){this.colorStops.push([$,V])},C.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},C.isCanvasGradient=!0,C},g.prototype.createPattern=function(){return this.createLinearGradient()},g.prototype.createRadialGradient=function(){return this.createLinearGradient()};var X=function(C,$,V,J,Z,ie,fe,Y,se){for(var be=le.call(this,V,J,Z,ie),Ce=0;Ce<be.length;Ce++){var Te=be[Ce];Ce===0&&(se?k.call(this,Te.x1+C,Te.y1+$):j.call(this,Te.x1+C,Te.y1+$)),K.call(this,C,$,Te.x2,Te.y2,Te.x3,Te.y3,Te.x4,Te.y4)}Y?I.call(this):F.call(this,fe)},F=function(C){switch(C){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},I=function(){this.pdf.clip(),this.pdf.discardPath()},k=function(C,$){this.pdf.internal.out(n(C)+" "+r($)+" m")},A=function(C){var $;switch(C.align){case"right":case"end":$="right";break;case"center":$="center";break;default:$="left"}var V,J,Z,ie=this.pdf.getTextDimensions(C.text),fe=ee.call(this,C.y),Y=G.call(this,fe)-ie.h,se=this.ctx.transform.applyToPoint(new o(C.x,fe));if(this.autoPaging){var be=this.ctx.transform.decompose(),Ce=new c;Ce=(Ce=(Ce=Ce.multiply(be.translate)).multiply(be.skew)).multiply(be.scale);for(var Te=this.ctx.transform.applyToRectangle(new l(C.x,fe,ie.w,ie.h)),De=Ce.applyToRectangle(new l(C.x,Y,ie.w,ie.h)),U=S.call(this,De),Pe=[],ht=0;ht<U.length;ht+=1)Pe.indexOf(U[ht])===-1&&Pe.push(U[ht]);O(Pe);for(var He=Pe[0],Se=Pe[Pe.length-1],Ke=He;Ke<Se+1;Ke++){this.pdf.setPage(Ke);var Re=Ke===1?this.posY+this.margin[0]:this.margin[0],Qe=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ie=this.pdf.internal.pageSize.height-this.margin[2],it=Ie-this.margin[0],nt=this.pdf.internal.pageSize.width-this.margin[1],at=nt-this.margin[3],ut=Ke===1?0:Qe+(Ke-2)*it;if(this.ctx.clip_path.length!==0){var pt=this.path;V=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=T(V,this.posX+this.margin[3],-1*ut+Re),M.call(this,"fill",!0),this.path=pt}var ze=T([JSON.parse(JSON.stringify(De))],this.posX+this.margin[3],-ut+Re+this.ctx.prevPageLastElemOffset)[0];C.scale>=.01&&(J=this.pdf.internal.getFontSize(),this.pdf.setFontSize(J*C.scale),Z=this.lineWidth,this.lineWidth=Z*C.scale);var mt=this.autoPaging!=="text";if(mt||ze.y+ze.h<=Ie){if(mt||ze.y>=Re&&ze.x<=nt){var We=mt?C.text:this.pdf.splitTextToSize(C.text,C.maxWidth||nt-ze.x)[0],rn=T([JSON.parse(JSON.stringify(Te))],this.posX+this.margin[3],-ut+Re+this.ctx.prevPageLastElemOffset)[0],Et=mt&&(Ke>He||Ke<Se)&&_.call(this);Et&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],at,it,null).clip().discardPath()),this.pdf.text(We,rn.x,rn.y,{angle:C.angle,align:$,renderingMode:C.renderingMode}),Et&&this.pdf.restoreGraphicsState()}}else ze.y<Ie&&(this.ctx.prevPageLastElemOffset+=Ie-ze.y);C.scale>=.01&&(this.pdf.setFontSize(J),this.lineWidth=Z)}}else C.scale>=.01&&(J=this.pdf.internal.getFontSize(),this.pdf.setFontSize(J*C.scale),Z=this.lineWidth,this.lineWidth=Z*C.scale),this.pdf.text(C.text,se.x+this.posX,se.y+this.posY,{angle:C.angle,align:$,renderingMode:C.renderingMode,maxWidth:C.maxWidth}),C.scale>=.01&&(this.pdf.setFontSize(J),this.lineWidth=Z)},j=function(C,$,V,J){V=V||0,J=J||0,this.pdf.internal.out(n(C+V)+" "+r($+J)+" l")},q=function(C,$,V){return this.pdf.lines(C,$,V,null,null)},K=function(C,$,V,J,Z,ie,fe,Y){this.pdf.internal.out([e(a(V+C)),e(i(J+$)),e(a(Z+C)),e(i(ie+$)),e(a(fe+C)),e(i(Y+$)),"c"].join(" "))},le=function(C,$,V,J){for(var Z=2*Math.PI,ie=Math.PI/2;$>V;)$-=Z;var fe=Math.abs(V-$);fe<Z&&J&&(fe=Z-fe);for(var Y=[],se=J?-1:1,be=$;fe>1e-5;){var Ce=be+se*Math.min(fe,ie);Y.push(ue.call(this,C,be,Ce)),fe-=Math.abs(Ce-be),be=Ce}return Y},ue=function(C,$,V){var J=(V-$)/2,Z=C*Math.cos(J),ie=C*Math.sin(J),fe=Z,Y=-ie,se=fe*fe+Y*Y,be=se+fe*Z+Y*ie,Ce=4/3*(Math.sqrt(2*se*be)-be)/(fe*ie-Y*Z),Te=fe-Ce*Y,De=Y+Ce*fe,U=Te,Pe=-De,ht=J+$,He=Math.cos(ht),Se=Math.sin(ht);return{x1:C*Math.cos($),y1:C*Math.sin($),x2:Te*He-De*Se,y2:Te*Se+De*He,x3:U*He-Pe*Se,y3:U*Se+Pe*He,x4:C*Math.cos(V),y4:C*Math.sin(V)}},ae=function(C){return 180*C/Math.PI},ge=function(C,$,V,J,Z,ie){var fe=C+.5*(V-C),Y=$+.5*(J-$),se=Z+.5*(V-Z),be=ie+.5*(J-ie),Ce=Math.min(C,Z,fe,se),Te=Math.max(C,Z,fe,se),De=Math.min($,ie,Y,be),U=Math.max($,ie,Y,be);return new l(Ce,De,Te-Ce,U-De)},xe=function(C,$,V,J,Z,ie,fe,Y){var se,be,Ce,Te,De,U,Pe,ht,He,Se,Ke,Re,Qe,Ie,it=V-C,nt=J-$,at=Z-V,ut=ie-J,pt=fe-Z,ze=Y-ie;for(be=0;be<41;be++)He=(Pe=(Ce=C+(se=be/40)*it)+se*((De=V+se*at)-Ce))+se*(De+se*(Z+se*pt-De)-Pe),Se=(ht=(Te=$+se*nt)+se*((U=J+se*ut)-Te))+se*(U+se*(ie+se*ze-U)-ht),be==0?(Ke=He,Re=Se,Qe=He,Ie=Se):(Ke=Math.min(Ke,He),Re=Math.min(Re,Se),Qe=Math.max(Qe,He),Ie=Math.max(Ie,Se));return new l(Math.round(Ke),Math.round(Re),Math.round(Qe-Ke),Math.round(Ie-Re))},pe=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var C,$,V=(C=this.ctx.lineDash,$=this.ctx.lineDashOffset,JSON.stringify({lineDash:C,lineDashOffset:$}));this.prevLineDash!==V&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=V)}}})(Xe.API),(function(t){var e=function(o){var l,c,u,h,g,b,p,y,_,S;for(c=[],u=0,h=(o+=l="\0\0\0\0".slice(o.length%4||4)).length;h>u;u+=4)(g=(o.charCodeAt(u)<<24)+(o.charCodeAt(u+1)<<16)+(o.charCodeAt(u+2)<<8)+o.charCodeAt(u+3))!==0?(b=(g=((g=((g=((g=(g-(S=g%85))/85)-(_=g%85))/85)-(y=g%85))/85)-(p=g%85))/85)%85,c.push(b+33,p+33,y+33,_+33,S+33)):c.push(122);return(function(x,T){for(var O=T;O>0;O--)x.pop()})(c,l.length),String.fromCharCode.apply(String,c)+"~>"},n=function(o){var l,c,u,h,g,b=String,p="length",y=255,_="charCodeAt",S="slice",x="replace";for(o[S](-2),o=o[S](0,-2)[x](/\s/g,"")[x]("z","!!!!!"),u=[],h=0,g=(o+=l="uuuuu"[S](o[p]%5||5))[p];g>h;h+=5)c=52200625*(o[_](h)-33)+614125*(o[_](h+1)-33)+7225*(o[_](h+2)-33)+85*(o[_](h+3)-33)+(o[_](h+4)-33),u.push(y&c>>24,y&c>>16,y&c>>8,y&c);return(function(T,O){for(var E=O;E>0;E--)T.pop()})(u,l[p]),b.fromCharCode.apply(b,u)},r=function(o){return o.split("").map(function(l){return("0"+l.charCodeAt().toString(16)).slice(-2)}).join("")+">"},a=function(o){var l=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),l.test(o)===!1)return"";for(var c="",u=0;u<o.length;u+=2)c+=String.fromCharCode("0x"+(o[u]+o[u+1]));return c},i=function(o){for(var l=new Uint8Array(o.length),c=o.length;c--;)l[c]=o.charCodeAt(c);return(l=Zu(l)).reduce(function(u,h){return u+String.fromCharCode(h)},"")};t.processDataByFilters=function(o,l){var c=0,u=o||"",h=[];for(typeof(l=l||[])=="string"&&(l=[l]),c=0;c<l.length;c+=1)switch(l[c]){case"ASCII85Decode":case"/ASCII85Decode":u=n(u),h.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":u=e(u),h.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":u=a(u),h.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":u=r(u),h.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":u=i(u),h.push("/FlateDecode");break;default:throw new Error('The filter: "'+l[c]+'" is not implemented')}return{data:u,reverseChain:h.reverse().join(" ")}}})(Xe.API),(function(t){t.loadFile=function(e,n,r){return(function(a,i,o){i=i!==!1,o=typeof o=="function"?o:function(){};var l=void 0;try{l=(function(c,u,h){var g=new XMLHttpRequest,b=0,p=function(y){var _=y.length,S=[],x=String.fromCharCode;for(b=0;b<_;b+=1)S.push(x(255&y.charCodeAt(b)));return S.join("")};if(g.open("GET",c,!u),g.overrideMimeType("text/plain; charset=x-user-defined"),u===!1&&(g.onload=function(){g.status===200?h(p(this.responseText)):h(void 0)}),g.send(null),u&&g.status===200)return p(g.responseText)})(a,i,o)}catch{}return l})(e,n,r)},t.allowFsRead=void 0,t.loadImageFile=t.loadFile})(Xe.API),(function(t){function e(){return(ft.html2canvas?Promise.resolve(ft.html2canvas):ru(()=>import("./html2canvas.esm-QH1iLAAe.js"),[])).catch(function(l){return Promise.reject(new Error("Could not load html2canvas: "+l))}).then(function(l){return l.default?l.default:l})}function n(){return(ft.DOMPurify?Promise.resolve(ft.DOMPurify):ru(()=>Promise.resolve().then(()=>rb),void 0)).catch(function(l){return Promise.reject(new Error("Could not load dompurify: "+l))}).then(function(l){return l.default?l.default:l})}var r=function(l){var c=Ht(l);return c==="undefined"?"undefined":c==="string"||l instanceof String?"string":c==="number"||l instanceof Number?"number":c==="function"||l instanceof Function?"function":l&&l.constructor===Array?"array":l&&l.nodeType===1?"element":c==="object"?"object":"unknown"},a=function(l,c){var u=document.createElement(l);for(var h in c.className&&(u.className=c.className),c.innerHTML&&c.dompurify&&(u.innerHTML=c.dompurify.sanitize(c.innerHTML)),c.style)u.style[h]=c.style[h];return u},i=function l(c,u){for(var h=c.nodeType===3?document.createTextNode(c.nodeValue):c.cloneNode(!1),g=c.firstChild;g;g=g.nextSibling)u!==!0&&g.nodeType===1&&g.nodeName==="SCRIPT"||h.appendChild(l(g,u));return c.nodeType===1&&(c.nodeName==="CANVAS"?(h.width=c.width,h.height=c.height,h.getContext("2d").drawImage(c,0,0)):c.nodeName!=="TEXTAREA"&&c.nodeName!=="SELECT"||(h.value=c.value),h.addEventListener("load",function(){h.scrollTop=c.scrollTop,h.scrollLeft=c.scrollLeft},!0)),h},o=function l(c){var u=Object.assign(l.convert(Promise.resolve()),JSON.parse(JSON.stringify(l.template))),h=l.convert(Promise.resolve(),u);return(h=h.setProgress(1,l,1,[l])).set(c)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(l,c){return l.__proto__=c||o.prototype,l},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(l,c){return this.then(function(){switch(c=c||(function(u){switch(r(u)){case"string":return"string";case"element":return u.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(l),c){case"string":return this.then(n).then(function(u){return this.set({src:a("div",{innerHTML:l,dompurify:u})})});case"element":return this.set({src:l});case"canvas":return this.set({canvas:l});case"img":return this.set({img:l});default:return this.error("Unknown source type.")}})},o.prototype.to=function(l){switch(l){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var l={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},c=i(this.prop.src,this.opt.html2canvas.javascriptEnabled);c.tagName==="BODY"&&(l.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=a("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=a("div",{className:"html2pdf__container",style:l}),this.prop.container.appendChild(c),this.prop.container.firstChild.appendChild(a("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(c){var u=Object.assign({},this.opt.html2canvas);return delete u.onrendered,c(this.prop.container,u)}).then(function(c){(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(c){var u=this.opt.jsPDF,h=this.opt.fontFaces,g=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,b=Object.assign({async:!0,allowTaint:!0,scale:g,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete b.onrendered,u.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,u.context2d.posX=this.opt.x,u.context2d.posY=this.opt.y,u.context2d.margin=this.opt.margin,u.context2d.fontFaces=h,h)for(var p=0;p<h.length;++p){var y=h[p],_=y.src.find(function(S){return S.format==="truetype"});_&&u.addFont(_.url,y.ref.name,y.ref.style)}return b.windowHeight=b.windowHeight||0,b.windowHeight=b.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):b.windowHeight,u.context2d.save(!0),c(this.prop.container,b)}).then(function(c){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var l=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=l})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(l,c,u){return(u=u||"pdf").toLowerCase()==="img"||u.toLowerCase()==="image"?this.outputImg(l,c):this.outputPdf(l,c)},o.prototype.outputPdf=function(l,c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(l,c)})},o.prototype.outputImg=function(l){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(l){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+l+'" is not supported.'}})},o.prototype.save=function(l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(l?{filename:l}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(l){if(r(l)!=="object")return this;var c=Object.keys(l||{}).map(function(u){if(u in o.template.prop)return function(){this.prop[u]=l[u]};switch(u){case"margin":return this.setMargin.bind(this,l.margin);case"jsPDF":return function(){return this.opt.jsPDF=l.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,l.pageSize);default:return function(){this.opt[u]=l[u]}}},this);return this.then(function(){return this.thenList(c)})},o.prototype.get=function(l,c){return this.then(function(){var u=l in o.template.prop?this.prop[l]:this.opt[l];return c?c(u):u})},o.prototype.setMargin=function(l){return this.then(function(){switch(r(l)){case"number":l=[l,l,l,l];case"array":if(l.length===2&&(l=[l[0],l[1],l[0],l[1]]),l.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=l}).then(this.setPageSize)},o.prototype.setPageSize=function(l){function c(u,h){return Math.floor(u*h/72*96)}return this.then(function(){(l=l||Xe.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(l.inner={width:l.width-this.opt.margin[1]-this.opt.margin[3],height:l.height-this.opt.margin[0]-this.opt.margin[2]},l.inner.px={width:c(l.inner.width,l.k),height:c(l.inner.height,l.k)},l.inner.ratio=l.inner.height/l.inner.width),this.prop.pageSize=l})},o.prototype.setProgress=function(l,c,u,h){return l!=null&&(this.progress.val=l),c!=null&&(this.progress.state=c),u!=null&&(this.progress.n=u),h!=null&&(this.progress.stack=h),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(l,c,u,h){return this.setProgress(l?this.progress.val+l:null,c||null,u?this.progress.n+u:null,h?this.progress.stack.concat(h):null)},o.prototype.then=function(l,c){var u=this;return this.thenCore(l,c,function(h,g){return u.updateProgress(null,null,1,[h]),Promise.prototype.then.call(this,function(b){return u.updateProgress(null,h),b}).then(h,g).then(function(b){return u.updateProgress(1),b})})},o.prototype.thenCore=function(l,c,u){u=u||Promise.prototype.then;var h=this;l&&(l=l.bind(h)),c&&(c=c.bind(h));var g=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?h:o.convert(Object.assign({},h),Promise.prototype),b=u.call(g,l,c);return o.convert(b,h.__proto__)},o.prototype.thenExternal=function(l,c){return Promise.prototype.then.call(this,l,c)},o.prototype.thenList=function(l){var c=this;return l.forEach(function(u){c=c.thenCore(u)}),c},o.prototype.catch=function(l){l&&(l=l.bind(this));var c=Promise.prototype.catch.call(this,l);return o.convert(c,this)},o.prototype.catchExternal=function(l){return Promise.prototype.catch.call(this,l)},o.prototype.error=function(l){return this.then(function(){throw new Error(l)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,Xe.getPageSize=function(l,c,u){if(Ht(l)==="object"){var h=l;l=h.orientation,c=h.unit||c,u=h.format||u}c=c||"mm",u=u||"a4",l=(""+(l||"P")).toLowerCase();var g,b=(""+u).toLowerCase(),p={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(c){case"pt":g=1;break;case"mm":g=72/25.4;break;case"cm":g=72/2.54;break;case"in":g=72;break;case"px":g=.75;break;case"pc":case"em":g=12;break;case"ex":g=6;break;default:throw"Invalid unit: "+c}var y,_=0,S=0;if(p.hasOwnProperty(b))_=p[b][1]/g,S=p[b][0]/g;else try{_=u[1],S=u[0]}catch{throw new Error("Invalid format: "+u)}if(l==="p"||l==="portrait")l="p",S>_&&(y=S,S=_,_=y);else{if(l!=="l"&&l!=="landscape")throw"Invalid orientation: "+l;l="l",_>S&&(y=S,S=_,_=y)}return{width:S,height:_,unit:c,k:g,orientation:l}},t.html=function(l,c){(c=c||{}).callback=c.callback||function(){},c.html2canvas=c.html2canvas||{},c.html2canvas.canvas=c.html2canvas.canvas||this.canvas,c.jsPDF=c.jsPDF||this,c.fontFaces=c.fontFaces?c.fontFaces.map(wu):null;var u=new o(c);return c.worker?u:u.from(l).doCallback()}})(Xe.API),Xe.API.addJS=function(t){var e,n,r=(function(a){for(var i="",o=0;o<a.length;o++){var l=a[o];if(l==="("||l===")"){for(var c=0,u=o-1;u>=0&&a[u]==="\\";u--)c++;i+=c%2==0?"\\"+l:l}else i+=l}return i})(t);return this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(e+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),n=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+r+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){e!==void 0&&n!==void 0&&this.internal.out("/Names <</JavaScript "+e+" 0 R>>")}),this},(function(t){var e;t.events.push(["postPutResources",function(){var n=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var a=n.outline.render().split(/\r\n/),i=0;i<a.length;i++){var o=a[i],l=r.exec(o);if(l!=null){var c=l[1];n.internal.newObjectDeferredBegin(c,!1)}n.internal.write(o)}if(this.outline.createNamedDestinations){var u=this.internal.pages.length,h=[];for(i=0;i<u;i++){var g=n.internal.newObject();h.push(g);var b=n.internal.getPageInfo(i+1);n.internal.write("<< /D["+b.objId+" 0 R /XYZ null null null]>> endobj")}var p=n.internal.newObject();for(n.internal.write("<< /Names [ "),i=0;i<h.length;i++)n.internal.write("(page_"+(i+1)+")"+h[i]+" 0 R");n.internal.write(" ] >>","endobj"),e=n.internal.newObject(),n.internal.write("<< /Dests "+p+" 0 R"),n.internal.write(">>","endobj")}}]),t.events.push(["putCatalog",function(){var n=this;n.outline.root.children.length>0&&(n.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&n.internal.write("/Names "+e+" 0 R"))}]),t.events.push(["initialized",function(){var n=this;n.outline={createNamedDestinations:!1,root:{children:[]}},n.outline.add=function(r,a,i){var o={title:a,options:i,children:[]};return r==null&&(r=this.root),r.children.push(o),o},n.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=n,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},n.outline.genIds_r=function(r){r.id=n.internal.newObjectDeferred();for(var a=0;a<r.children.length;a++)this.genIds_r(r.children[a])},n.outline.renderRoot=function(r){this.objStart(r),this.line("/Type /Outlines"),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1]))),this.line("/Count "+this.count_r({count:0},r)),this.objEnd()},n.outline.renderItems=function(r){for(var a=this.ctx.pdf.internal.getVerticalCoordinateString,i=0;i<r.children.length;i++){var o=r.children[i];this.objStart(o),this.line("/Title "+this.makeString(o.title)),this.line("/Parent "+this.makeRef(r)),i>0&&this.line("/Prev "+this.makeRef(r.children[i-1])),i<r.children.length-1&&this.line("/Next "+this.makeRef(r.children[i+1])),o.children.length>0&&(this.line("/First "+this.makeRef(o.children[0])),this.line("/Last "+this.makeRef(o.children[o.children.length-1])));var l=this.count=this.count_r({count:0},o);if(l>0&&this.line("/Count "+l),o.options&&o.options.pageNumber){var c=n.internal.getPageInfo(o.options.pageNumber);this.line("/Dest ["+c.objId+" 0 R /XYZ 0 "+a(0)+" 0]")}this.objEnd()}for(var u=0;u<r.children.length;u++)this.renderItems(r.children[u])},n.outline.line=function(r){this.ctx.val+=r+`\r
`},n.outline.makeRef=function(r){return r.id+" 0 R"},n.outline.makeString=function(r){return"("+n.internal.pdfEscape(r)+")"},n.outline.objStart=function(r){this.ctx.val+=`\r
`+r.id+` 0 obj\r
<<\r
`},n.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},n.outline.count_r=function(r,a){for(var i=0;i<a.children.length;i++)r.count++,this.count_r(r,a.children[i]);return r.count}}])})(Xe.API),(function(t){var e=[192,193,194,195,196,197,198,199];t.processJPEG=function(n,r,a,i,o,l){var c,u=this.decode.DCT_DECODE,h=null;if(typeof n=="string"||this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n)){switch(n=o||n,n=this.__addimage__.isArrayBuffer(n)?new Uint8Array(n):n,c=(function(g){for(var b,p=256*g.charCodeAt(4)+g.charCodeAt(5),y=g.length,_={width:0,height:0,numcomponents:1},S=4;S<y;S+=2){if(S+=p,e.indexOf(g.charCodeAt(S+1))!==-1){b=256*g.charCodeAt(S+5)+g.charCodeAt(S+6),_={width:256*g.charCodeAt(S+7)+g.charCodeAt(S+8),height:b,numcomponents:g.charCodeAt(S+9)};break}p=256*g.charCodeAt(S+2)+g.charCodeAt(S+3)}return _})(n=this.__addimage__.isArrayBufferView(n)?this.__addimage__.arrayBufferToBinaryString(n):n),c.numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}h={data:n,width:c.width,height:c.height,colorSpace:l,bitsPerComponent:8,filter:u,index:r,alias:a}}return h}})(Xe.API),Xe.API.processPNG=function(t,e,n,r){if(this.__addimage__.isArrayBuffer(t)&&(t=new Uint8Array(t)),this.__addimage__.isArrayBufferView(t)){var a,i=by(t,{checkCrc:!0}),o=i.width,l=i.height,c=i.channels,u=i.palette,h=i.depth;a=u&&c===1?(function(X){for(var F=X.width,I=X.height,k=X.data,A=X.palette,j=X.depth,q=!1,K=[],le=[],ue=void 0,ae=!1,ge=0,xe=0;xe<A.length;xe++){var pe=bf(A[xe],4),C=pe[0],$=pe[1],V=pe[2],J=pe[3];K.push(C,$,V),J!=null&&(J===0?(ge++,le.length<1&&le.push(xe)):J<255&&(ae=!0))}if(ae||ge>1){q=!0,le=void 0;var Z=F*I;ue=new Uint8Array(Z);for(var ie=new DataView(k.buffer),fe=0;fe<Z;fe++){var Y=Su(ie,fe,j),se=bf(A[Y],4)[3];ue[fe]=se}}else ge===0&&(le=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:q?8:void 0,colorBytes:k,alphaBytes:ue,needSMask:q,palette:K,mask:le}})(i):c===2||c===4?(function(X){for(var F=X.data,I=X.width,k=X.height,A=X.channels,j=X.depth,q=A===2?"DeviceGray":"DeviceRGB",K=A-1,le=I*k,ue=K,ae=le*ue,ge=1*le,xe=Math.ceil(ae*j/8),pe=Math.ceil(ge*j/8),C=new Uint8Array(xe),$=new Uint8Array(pe),V=new DataView(F.buffer),J=new DataView(C.buffer),Z=new DataView($.buffer),ie=!1,fe=0;fe<le;fe++){for(var Y=fe*A,se=0;se<ue;se++)wp(J,Su(V,Y+se,j),fe*ue+se,j);var be=Su(V,Y+ue,j);be<(1<<j)-1&&(ie=!0),wp(Z,be,1*fe,j)}return{colorSpace:q,colorsPerPixel:K,sMaskBitsPerComponent:ie?j:void 0,colorBytes:C,alphaBytes:$,needSMask:ie}})(i):(function(X){var F=X.data,I=X.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:I,colorsPerPixel:I==="DeviceGray"?1:3,colorBytes:F instanceof Uint16Array?(function(k){for(var A=k.length,j=new Uint8Array(2*A),q=new DataView(j.buffer,j.byteOffset,j.byteLength),K=0;K<A;K++)q.setUint16(2*K,k[K],!1);return j})(F):F,needSMask:!1}})(i);var g,b,p,y=a,_=y.colorSpace,S=y.colorsPerPixel,x=y.sMaskBitsPerComponent,T=y.colorBytes,O=y.alphaBytes,E=y.needSMask,M=y.palette,ee=y.mask,G=null;return r!==Xe.API.image_compression.NONE&&typeof Zu=="function"?(G=(function(X){var F;switch(X){case Xe.API.image_compression.FAST:F=11;break;case Xe.API.image_compression.MEDIUM:F=13;break;case Xe.API.image_compression.SLOW:F=14;break;default:F=12}return F})(r),g=this.decode.FLATE_DECODE,b="/Predictor ".concat(G," /Colors ").concat(S," /BitsPerComponent ").concat(h," /Columns ").concat(o),t=mp(T,Math.ceil(o*S*h/8),S,h,r),E&&(p=mp(O,Math.ceil(o*x/8),1,x,r))):(g=void 0,b=void 0,t=T,E&&(p=O)),(this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t))&&(t=this.__addimage__.arrayBufferToBinaryString(t)),(p&&this.__addimage__.isArrayBuffer(p)||this.__addimage__.isArrayBufferView(p))&&(p=this.__addimage__.arrayBufferToBinaryString(p)),{alias:n,data:t,index:e,filter:g,decodeParameters:b,transparency:ee,palette:M,sMask:p,predictor:G,width:o,height:l,bitsPerComponent:h,sMaskBitsPerComponent:x,colorSpace:_}}},(function(t){t.processGIF89A=function(e,n,r,a){var i=new My(e),o=i.width,l=i.height,c=[];i.decodeAndBlitFrameRGBA(0,c);var u={data:c,width:o,height:l},h=new Au(100).encode(u,100);return t.processJPEG.call(this,h,n,r,a)},t.processGIF87A=t.processGIF89A})(Xe.API),Kr.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var t=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var e=0;e<t;e++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:a,green:r,blue:n,quad:i}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Kr.prototype.parseBGR=function(){this.pos=this.offset;var t="bit"+this.bitPP,e=this.width*this.height*4;if(e>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");this.data=new Uint8Array(e);try{this[t]()}catch(n){Kt.log("bit decode error:"+n)}},Kr.prototype.bit1=function(){var t,e=Math.ceil(this.width/8),n=e%4;for(t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,a=0;a<e;a++)for(var i=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+8*a*4,l=0;l<8&&8*a+l<this.width;l++){var c=this.palette[i>>7-l&1];this.data[o+4*l]=c.blue,this.data[o+4*l+1]=c.green,this.data[o+4*l+2]=c.red,this.data[o+4*l+3]=255}n!==0&&(this.pos+=4-n)}},Kr.prototype.bit4=function(){for(var t=Math.ceil(this.width/2),e=t%4,n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,a=0;a<t;a++){var i=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+2*a*4,l=i>>4,c=15&i,u=this.palette[l];if(this.data[o]=u.blue,this.data[o+1]=u.green,this.data[o+2]=u.red,this.data[o+3]=255,2*a+1>=this.width)break;u=this.palette[c],this.data[o+4]=u.blue,this.data[o+4+1]=u.green,this.data[o+4+2]=u.red,this.data[o+4+3]=255}e!==0&&(this.pos+=4-e)}},Kr.prototype.bit8=function(){for(var t=this.width%4,e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var a=this.datav.getUint8(this.pos++,!0),i=n*this.width*4+4*r;if(a<this.palette.length){var o=this.palette[a];this.data[i]=o.red,this.data[i+1]=o.green,this.data[i+2]=o.blue,this.data[i+3]=255}else this.data[i]=255,this.data[i+1]=255,this.data[i+2]=255,this.data[i+3]=255}t!==0&&(this.pos+=4-t)}},Kr.prototype.bit15=function(){for(var t=this.width%3,e=parseInt("11111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,a=0;a<this.width;a++){var i=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(i&e)/e*255|0,l=(i>>5&e)/e*255|0,c=(i>>10&e)/e*255|0,u=i>>15?255:0,h=r*this.width*4+4*a;this.data[h]=c,this.data[h+1]=l,this.data[h+2]=o,this.data[h+3]=u}this.pos+=t}},Kr.prototype.bit16=function(){for(var t=this.width%3,e=parseInt("11111",2),n=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var a=this.bottom_up?r:this.height-1-r,i=0;i<this.width;i++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(o&e)/e*255|0,c=(o>>5&n)/n*255|0,u=(o>>11)/e*255|0,h=a*this.width*4+4*i;this.data[h]=u,this.data[h+1]=c,this.data[h+2]=l,this.data[h+3]=255}this.pos+=t}},Kr.prototype.bit24=function(){for(var t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*n;this.data[o]=i,this.data[o+1]=a,this.data[o+2]=r,this.data[o+3]=255}this.pos+=this.width%4}},Kr.prototype.bit32=function(){for(var t=this.height-1;t>=0;t--)for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),l=e*this.width*4+4*n;this.data[l]=i,this.data[l+1]=a,this.data[l+2]=r,this.data[l+3]=o}},Kr.prototype.getData=function(){return this.data},(function(t){t.processBMP=function(e,n,r,a){var i=new Kr(e,!1),o=i.width,l=i.height,c={data:i.getData(),width:o,height:l},u=new Au(100).encode(c,100);return t.processJPEG.call(this,u,n,r,a)}})(Xe.API),Sp.prototype.getData=function(){return this.data},(function(t){t.processWEBP=function(e,n,r,a){var i=new Sp(e),o=i.width,l=i.height,c={data:i.getData(),width:o,height:l},u=new Au(100).encode(c,100);return t.processJPEG.call(this,u,n,r,a)}})(Xe.API),Xe.API.processRGBA=function(t,e,n){for(var r=t.data,a=r.length,i=new Uint8Array(a/4*3),o=new Uint8Array(a/4),l=0,c=0,u=0;u<a;u+=4){var h=r[u],g=r[u+1],b=r[u+2],p=r[u+3];i[l++]=h,i[l++]=g,i[l++]=b,o[c++]=p}var y=this.__addimage__.arrayBufferToBinaryString(i);return{alpha:this.__addimage__.arrayBufferToBinaryString(o),data:y,index:e,alias:n,colorSpace:"DeviceRGB",bitsPerComponent:8,width:t.width,height:t.height}},Xe.API.setLanguage=function(t){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[t]!==void 0&&(this.internal.languageSettings.languageCode=t,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},cs=Xe.API,El=cs.getCharWidthsArray=function(t,e){var n,r,a=(e=e||{}).font||this.internal.getFont(),i=e.fontSize||this.internal.getFontSize(),o=e.charSpace||this.internal.getCharSpace(),l=e.widths?e.widths:a.metadata.Unicode.widths,c=l.fof?l.fof:1,u=e.kerning?e.kerning:a.metadata.Unicode.kerning,h=u.fof?u.fof:1,g=e.doKerning!==!1,b=0,p=t.length,y=0,_=l[0]||c,S=[];for(n=0;n<p;n++)r=t.charCodeAt(n),typeof a.metadata.widthOfString=="function"?S.push((a.metadata.widthOfGlyph(a.metadata.characterToGlyph(r))+o*(1e3/i)||0)/1e3):(b=g&&Ht(u[r])==="object"&&!isNaN(parseInt(u[r][y],10))?u[r][y]/h:0,S.push((l[r]||_)/c+b)),y=r;return S},fp=cs.getStringUnitWidth=function(t,e){var n=(e=e||{}).fontSize||this.internal.getFontSize(),r=e.font||this.internal.getFont(),a=e.charSpace||this.internal.getCharSpace();return cs.processArabic&&(t=cs.processArabic(t)),typeof r.metadata.widthOfString=="function"?r.metadata.widthOfString(t,n,a)/n:El.apply(this,arguments).reduce(function(i,o){return i+o},0)},pp=function(t,e,n,r){for(var a=[],i=0,o=t.length,l=0;i!==o&&l+e[i]<n;)l+=e[i],i++;a.push(t.slice(0,i));var c=i;for(l=0;i!==o;)l+e[i]>r&&(a.push(t.slice(c,i)),l=0,c=i),l+=e[i],i++;return c!==i&&a.push(t.slice(c,i)),a},gp=function(t,e,n){n||(n={});var r,a,i,o,l,c,u,h=[],g=[h],b=n.textIndent||0,p=0,y=0,_=t.split(" "),S=El.apply(this,[" ",n])[0];if(c=n.lineIndent===-1?_[0].length+2:n.lineIndent||0){var x=Array(c).join(" "),T=[];_.map(function(E){(E=E.split(/\s*\n/)).length>1?T=T.concat(E.map(function(M,ee){return(ee&&M.length?`
`:"")+M})):T.push(E[0])}),_=T,c=fp.apply(this,[x,n])}for(i=0,o=_.length;i<o;i++){var O=0;if(r=_[i],c&&r[0]==`
`&&(r=r.substr(1),O=1),b+p+(y=(a=El.apply(this,[r,n])).reduce(function(E,M){return E+M},0))>e||O){if(y>e){for(l=pp.apply(this,[r,a,e-(b+p),e]),h.push(l.shift()),h=[l.pop()];l.length;)g.push([l.shift()]);y=a.slice(r.length-(h[0]?h[0].length:0)).reduce(function(E,M){return E+M},0)}else h=[r];g.push(h),b=y+c,p=S}else h.push(r),b+=p+y,p=S}return u=c?function(E,M){return(M?x:"")+E.join(" ")}:function(E){return E.join(" ")},g.map(u)},cs.splitTextToSize=function(t,e,n){var r,a=(n=n||{}).fontSize||this.internal.getFontSize(),i=(function(h){if(h.widths&&h.kerning)return{widths:h.widths,kerning:h.kerning};var g=this.internal.getFont(h.fontName,h.fontStyle),b="Unicode";return g.metadata[b]?{widths:g.metadata[b].widths||{0:1},kerning:g.metadata[b].kerning||{}}:{font:g.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,n);r=Array.isArray(t)?t:String(t).split(/\r?\n/);var o=1*this.internal.scaleFactor*e/a;i.textIndent=n.textIndent?1*n.textIndent*this.internal.scaleFactor/a:0,i.lineIndent=n.lineIndent;var l,c,u=[];for(l=0,c=r.length;l<c;l++)u=u.concat(gp.apply(this,[r[l],o,i]));return u},(function(t){t.__fontmetrics__=t.__fontmetrics__||{};for(var e="0123456789abcdef",n="klmnopqrstuvwxyz",r={},a={},i=0;i<16;i++)r[n[i]]=e[i],a[e[i]]=n[i];var o=function(b){return"0x"+parseInt(b,10).toString(16)},l=t.__fontmetrics__.compress=function(b){var p,y,_,S,x=["{"];for(var T in b){if(p=b[T],isNaN(parseInt(T,10))?y="'"+T+"'":(T=parseInt(T,10),y=(y=o(T).slice(2)).slice(0,-1)+a[y.slice(-1)]),typeof p=="number")p<0?(_=o(p).slice(3),S="-"):(_=o(p).slice(2),S=""),_=S+_.slice(0,-1)+a[_.slice(-1)];else{if(Ht(p)!=="object")throw new Error("Don't know what to do with value type "+Ht(p)+".");_=l(p)}x.push(y+_)}return x.push("}"),x.join("")},c=t.__fontmetrics__.uncompress=function(b){if(typeof b!="string")throw new Error("Invalid argument passed to uncompress.");for(var p,y,_,S,x={},T=1,O=x,E=[],M="",ee="",G=b.length-1,X=1;X<G;X+=1)(S=b[X])=="'"?p?(_=p.join(""),p=void 0):p=[]:p?p.push(S):S=="{"?(E.push([O,_]),O={},_=void 0):S=="}"?((y=E.pop())[0][y[1]]=O,_=void 0,O=y[0]):S=="-"?T=-1:_===void 0?r.hasOwnProperty(S)?(M+=r[S],_=parseInt(M,16)*T,T=1,M=""):M+=S:r.hasOwnProperty(S)?(ee+=r[S],O[_]=parseInt(ee,16)*T,T=1,_=void 0,ee=""):ee+=S;return x},u={codePages:["WinAnsiEncoding"],WinAnsiEncoding:c("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},h={Unicode:{Courier:u,"Courier-Bold":u,"Courier-BoldOblique":u,"Courier-Oblique":u,Helvetica:u,"Helvetica-Bold":u,"Helvetica-BoldOblique":u,"Helvetica-Oblique":u,"Times-Roman":u,"Times-Bold":u,"Times-BoldItalic":u,"Times-Italic":u}},g={Unicode:{"Courier-Oblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":c("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":c("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:c("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:c("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":c("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":c("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};t.events.push(["addFont",function(b){var p=b.font,y=g.Unicode[p.postScriptName];y&&(p.metadata.Unicode={},p.metadata.Unicode.widths=y.widths,p.metadata.Unicode.kerning=y.kerning);var _=h.Unicode[p.postScriptName];_&&(p.metadata.Unicode.encoding=_,p.encoding=_.codePages[0])}])})(Xe.API),(function(t){var e=function(n){for(var r=n.length,a=new Uint8Array(r),i=0;i<r;i++)a[i]=n.charCodeAt(i);return a};t.API.events.push(["addFont",function(n){var r=void 0,a=n.font,i=n.instance;if(!a.isStandardFont){if(i===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");if(typeof(r=i.existsFileInVFS(a.postScriptName)===!1?i.loadFile(a.postScriptName):i.getFileFromVFS(a.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");(function(o,l){l=/^\x00\x01\x00\x00/.test(l)?e(l):e(Ol(l)),o.metadata=t.API.TTFFont.open(l),o.metadata.Unicode=o.metadata.Unicode||{encoding:{},kerning:{},widths:[]},o.metadata.glyIdsUsed=[0]})(a,r)}}])})(Xe),Xe.API.addSvgAsImage=function(t,e,n,r,a,i,o,l){if(isNaN(e)||isNaN(n))throw Kt.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(r)||isNaN(a))throw Kt.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=r,c.height=a;var u=c.getContext("2d");u.fillStyle="#fff",u.fillRect(0,0,c.width,c.height);var h={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},g=this;return(ft.canvg?Promise.resolve(ft.canvg):ru(()=>import("./index.es-rh6EnfNl.js"),[])).catch(function(b){return Promise.reject(new Error("Could not load canvg: "+b))}).then(function(b){return b.default?b.default:b}).then(function(b){return b.fromString(u,t,h)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(b){return b.render(h)}).then(function(){g.addImage(c.toDataURL("image/jpeg",1),e,n,r,a,o,l)})},Xe.API.putTotalPages=function(t){var e,n=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(t,"g"),n=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(t,this.internal.getFont()),"g"),n=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var a=0;a<this.internal.pages[r].length;a++)this.internal.pages[r][a]=this.internal.pages[r][a].replace(e,n);return this},Xe.API.viewerPreferences=function(t,e){var n;t=t||{},e=e||!1;var r,a,i,o={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(o),c=[],u=0,h=0,g=0;function b(y,_){var S,x=!1;for(S=0;S<y.length;S+=1)y[S]===_&&(x=!0);return x}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(o)),this.internal.viewerpreferences.isSubscribed=!1),n=this.internal.viewerpreferences.configuration,t==="reset"||e===!0){var p=l.length;for(g=0;g<p;g+=1)n[l[g]].value=n[l[g]].defaultValue,n[l[g]].explicitSet=!1}if(Ht(t)==="object"){for(a in t)if(i=t[a],b(l,a)&&i!==void 0){if(n[a].type==="boolean"&&typeof i=="boolean")n[a].value=i;else if(n[a].type==="name"&&b(n[a].valueSet,i))n[a].value=i;else if(n[a].type==="integer"&&Number.isInteger(i))n[a].value=i;else if(n[a].type==="array"){for(u=0;u<i.length;u+=1)if(r=!0,i[u].length===1&&typeof i[u][0]=="number")c.push(String(i[u]-1));else if(i[u].length>1){for(h=0;h<i[u].length;h+=1)typeof i[u][h]!="number"&&(r=!1);r===!0&&c.push([i[u][0]-1,i[u][1]-1].join(" "))}n[a].value="["+c.join(" ")+"]"}else n[a].value=n[a].defaultValue;n[a].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var y,_=[];for(y in n)n[y].explicitSet===!0&&(n[y].type==="name"?_.push("/"+y+" /"+n[y].value):_.push("/"+y+" "+n[y].value));_.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+_.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=n,this},Xe.API.addMetadata=function(t,e){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:t,namespaceUri:e??"http://jspdf.default.namespaceuri/",rawXml:typeof e=="boolean"&&e},this.internal.events.subscribe("putCatalog",$y),this.internal.events.subscribe("postPutResources",Uy)),this},(function(t){var e=t.API,n=e.pdfEscape16=function(i,o){for(var l,c=o.metadata.Unicode.widths,u=["","0","00","000","0000"],h=[""],g=0,b=i.length;g<b;++g){if(l=o.metadata.characterToGlyph(i.charCodeAt(g)),o.metadata.glyIdsUsed.push(l),o.metadata.toUnicode[l]=i.charCodeAt(g),c.indexOf(l)==-1&&(c.push(l),c.push([parseInt(o.metadata.widthOfGlyph(l),10)])),l=="0")return h.join("");l=l.toString(16),h.push(u[4-l.length],l)}return h.join("")},r=function(i){var o,l,c,u,h,g,b;for(h=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,c=[],g=0,b=(l=Object.keys(i).sort(function(p,y){return p-y})).length;g<b;g++)o=l[g],c.length>=100&&(h+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar`,c=[]),i[o]!==void 0&&i[o]!==null&&typeof i[o].toString=="function"&&(u=("0000"+i[o].toString(16)).slice(-4),o=("0000"+(+o).toString(16)).slice(-4),c.push("<"+o+"><"+u+">"));return c.length&&(h+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar
`),h+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(i){(function(o){var l=o.font,c=o.out,u=o.newObject,h=o.putStream;if(l.metadata instanceof t.API.TTFFont&&l.encoding==="Identity-H"){for(var g=l.metadata.Unicode.widths,b=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),p="",y=0;y<b.length;y++)p+=String.fromCharCode(b[y]);var _=u();h({data:p,addLength1:!0,objectId:_}),c("endobj");var S=u();h({data:r(l.metadata.toUnicode),addLength1:!0,objectId:S}),c("endobj");var x=u();c("<<"),c("/Type /FontDescriptor"),c("/FontName /"+ps(l.fontName)),c("/FontFile2 "+_+" 0 R"),c("/FontBBox "+t.API.PDFObject.convert(l.metadata.bbox)),c("/Flags "+l.metadata.flags),c("/StemV "+l.metadata.stemV),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c(">>"),c("endobj");var T=u();c("<<"),c("/Type /Font"),c("/BaseFont /"+ps(l.fontName)),c("/FontDescriptor "+x+" 0 R"),c("/W "+t.API.PDFObject.convert(g)),c("/CIDToGIDMap /Identity"),c("/DW 1000"),c("/Subtype /CIDFontType2"),c("/CIDSystemInfo"),c("<<"),c("/Supplement 0"),c("/Registry (Adobe)"),c("/Ordering ("+l.encoding+")"),c(">>"),c(">>"),c("endobj"),l.objectNumber=u(),c("<<"),c("/Type /Font"),c("/Subtype /Type0"),c("/ToUnicode "+S+" 0 R"),c("/BaseFont /"+ps(l.fontName)),c("/Encoding /"+l.encoding),c("/DescendantFonts ["+T+" 0 R]"),c(">>"),c("endobj"),l.isAlreadyPutted=!0}})(i)}]),e.events.push(["putFont",function(i){(function(o){var l=o.font,c=o.out,u=o.newObject,h=o.putStream;if(l.metadata instanceof t.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var g=l.metadata.rawData,b="",p=0;p<g.length;p++)b+=String.fromCharCode(g[p]);var y=u();h({data:b,addLength1:!0,objectId:y}),c("endobj");var _=u();h({data:r(l.metadata.toUnicode),addLength1:!0,objectId:_}),c("endobj");var S=u();c("<<"),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c("/StemV "+l.metadata.stemV),c("/Type /FontDescriptor"),c("/FontFile2 "+y+" 0 R"),c("/Flags 96"),c("/FontBBox "+t.API.PDFObject.convert(l.metadata.bbox)),c("/FontName /"+ps(l.fontName)),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c(">>"),c("endobj"),l.objectNumber=u();for(var x=0;x<l.metadata.hmtx.widths.length;x++)l.metadata.hmtx.widths[x]=parseInt(l.metadata.hmtx.widths[x]*(1e3/l.metadata.head.unitsPerEm));c("<</Subtype/TrueType/Type/Font/ToUnicode "+_+" 0 R/BaseFont/"+ps(l.fontName)+"/FontDescriptor "+S+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+t.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),c("endobj"),l.isAlreadyPutted=!0}})(i)}]);var a=function(i){var o,l=i.text||"",c=i.x,u=i.y,h=i.options||{},g=i.mutex||{},b=g.pdfEscape,p=g.activeFontKey,y=g.fonts,_=p,S="",x=0,T="",O=y[_].encoding;if(y[_].encoding!=="Identity-H")return{text:l,x:c,y:u,options:h,mutex:g};for(T=l,_=p,Array.isArray(l)&&(T=l[0]),x=0;x<T.length;x+=1)y[_].metadata.hasOwnProperty("cmap")&&(o=y[_].metadata.cmap.unicode.codeMap[T[x].charCodeAt(0)]),o||T[x].charCodeAt(0)<256&&y[_].metadata.hasOwnProperty("Unicode")?S+=T[x]:S+="";var E="";return parseInt(_.slice(1))<14||O==="WinAnsiEncoding"?E=b(S,_).split("").map(function(M){return M.charCodeAt(0).toString(16)}).join(""):O==="Identity-H"&&(E=n(S,y[_])),g.isHex=!0,{text:E,x:c,y:u,options:h,mutex:g}};e.events.push(["postProcessText",function(i){var o=i.text||"",l=[],c={text:o,x:i.x,y:i.y,options:i.options,mutex:i.mutex};if(Array.isArray(o)){var u=0;for(u=0;u<o.length;u+=1)Array.isArray(o[u])&&o[u].length===3?l.push([a(Object.assign({},c,{text:o[u][0]})).text,o[u][1],o[u][2]]):l.push(a(Object.assign({},c,{text:o[u]})).text);i.text=l}else i.text=a(Object.assign({},c,{text:o})).text}])})(Xe),(function(t){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};t.existsFileInVFS=function(n){return e.call(this),this.internal.vFS[n]!==void 0},t.addFileToVFS=function(n,r){return e.call(this),this.internal.vFS[n]=r,this},t.getFileFromVFS=function(n){return e.call(this),this.internal.vFS[n]!==void 0?this.internal.vFS[n]:null}})(Xe.API),(function(t){t.__bidiEngine__=t.prototype.__bidiEngine__=function(r){var a,i,o,l,c,u,h,g=e,b=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],p=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],y={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},_={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},S=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],x=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),T=!1,O=0;this.__bidiEngine__={};var E=function(k){var A=k.charCodeAt(),j=A>>8,q=_[j];return q!==void 0?g[256*q+(255&A)]:j===252||j===253?"AL":x.test(j)?"L":j===8?"R":"N"},M=function(k){for(var A,j=0;j<k.length;j++){if((A=E(k.charAt(j)))==="L")return!1;if(A==="R")return!0}return!1},ee=function(k,A,j,q){var K,le,ue,ae,ge=A[q];switch(ge){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":T=!1;break;case"N":case"AN":break;case"EN":T&&(ge="AN");break;case"AL":T=!0,ge="R";break;case"WS":case"BN":ge="N";break;case"CS":q<1||q+1>=A.length||(K=j[q-1])!=="EN"&&K!=="AN"||(le=A[q+1])!=="EN"&&le!=="AN"?ge="N":T&&(le="AN"),ge=le===K?le:"N";break;case"ES":ge=(K=q>0?j[q-1]:"B")==="EN"&&q+1<A.length&&A[q+1]==="EN"?"EN":"N";break;case"ET":if(q>0&&j[q-1]==="EN"){ge="EN";break}if(T){ge="N";break}for(ue=q+1,ae=A.length;ue<ae&&A[ue]==="ET";)ue++;ge=ue<ae&&A[ue]==="EN"?"EN":"N";break;case"NSM":if(o&&!l){for(ae=A.length,ue=q+1;ue<ae&&A[ue]==="NSM";)ue++;if(ue<ae){var xe=k[q],pe=xe>=1425&&xe<=2303||xe===64286;if(K=A[ue],pe&&(K==="R"||K==="AL")){ge="R";break}}}ge=q<1||(K=A[q-1])==="B"?"N":j[q-1];break;case"B":T=!1,a=!0,ge=O;break;case"S":i=!0,ge="N"}return ge},G=function(k,A,j){var q=k.split("");return j&&X(q,j,{hiLevel:O}),q.reverse(),A&&A.reverse(),q.join("")},X=function(k,A,j){var q,K,le,ue,ae,ge=-1,xe=k.length,pe=0,C=[],$=O?p:b,V=[];for(T=!1,a=!1,i=!1,K=0;K<xe;K++)V[K]=E(k[K]);for(le=0;le<xe;le++){if(ae=pe,C[le]=ee(k,V,C,le),q=240&(pe=$[ae][y[C[le]]]),pe&=15,A[le]=ue=$[pe][5],q>0)if(q===16){for(K=ge;K<le;K++)A[K]=1;ge=-1}else ge=-1;if($[pe][6])ge===-1&&(ge=le);else if(ge>-1){for(K=ge;K<le;K++)A[K]=ue;ge=-1}V[le]==="B"&&(A[le]=0),j.hiLevel|=ue}i&&(function(J,Z,ie){for(var fe=0;fe<ie;fe++)if(J[fe]==="S"){Z[fe]=O;for(var Y=fe-1;Y>=0&&J[Y]==="WS";Y--)Z[Y]=O}})(V,A,xe)},F=function(k,A,j,q,K){if(!(K.hiLevel<k)){if(k===1&&O===1&&!a)return A.reverse(),void(j&&j.reverse());for(var le,ue,ae,ge,xe=A.length,pe=0;pe<xe;){if(q[pe]>=k){for(ae=pe+1;ae<xe&&q[ae]>=k;)ae++;for(ge=pe,ue=ae-1;ge<ue;ge++,ue--)le=A[ge],A[ge]=A[ue],A[ue]=le,j&&(le=j[ge],j[ge]=j[ue],j[ue]=le);pe=ae}pe++}}},I=function(k,A,j){var q=k.split(""),K={hiLevel:O};return j||(j=[]),X(q,j,K),(function(le,ue,ae){if(ae.hiLevel!==0&&h)for(var ge,xe=0;xe<le.length;xe++)ue[xe]===1&&(ge=S.indexOf(le[xe]))>=0&&(le[xe]=S[ge+1])})(q,j,K),F(2,q,A,j,K),F(1,q,A,j,K),q.join("")};return this.__bidiEngine__.doBidiReorder=function(k,A,j){if((function(K,le){if(le)for(var ue=0;ue<K.length;ue++)le[ue]=ue;l===void 0&&(l=M(K)),u===void 0&&(u=M(K))})(k,A),o||!c||u)if(o&&c&&l^u)O=l?1:0,k=G(k,A,j);else if(!o&&c&&u)O=l?1:0,k=I(k,A,j),k=G(k,A);else if(!o||l||c||u){if(o&&!c&&l^u)k=G(k,A),l?(O=0,k=I(k,A,j)):(O=1,k=I(k,A,j),k=G(k,A));else if(o&&l&&!c&&u)O=1,k=I(k,A,j),k=G(k,A);else if(!o&&!c&&l^u){var q=h;l?(O=1,k=I(k,A,j),O=0,h=!1,k=I(k,A,j),h=q):(O=0,k=I(k,A,j),k=G(k,A),O=1,h=!1,k=I(k,A,j),h=q,k=G(k,A))}}else O=0,k=I(k,A,j);else O=l?1:0,k=I(k,A,j);return k},this.__bidiEngine__.setOptions=function(k){k&&(o=k.isInputVisual,c=k.isOutputVisual,l=k.isInputRtl,u=k.isOutputRtl,h=k.isSymmetricSwapping)},this.__bidiEngine__.setOptions(r),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],n=new t.__bidiEngine__({isInputVisual:!0});t.API.events.push(["postProcessText",function(r){var a=r.text;r.x,r.y;var i=r.options||{};r.mutex,i.lang;var o=[];if(i.isInputVisual=typeof i.isInputVisual!="boolean"||i.isInputVisual,n.setOptions(i),Object.prototype.toString.call(a)==="[object Array]"){var l=0;for(o=[],l=0;l<a.length;l+=1)Object.prototype.toString.call(a[l])==="[object Array]"?o.push([n.doBidiReorder(a[l][0]),a[l][1],a[l][2]]):o.push([n.doBidiReorder(a[l])]);r.text=o}else r.text=n.doBidiReorder(a);n.setOptions({isInputVisual:!0})}])})(Xe),Xe.API.TTFFont=(function(){function t(e){var n;if(this.rawData=e,n=this.contents=new da(e),this.contents.pos=4,n.readString(4)==="ttcf")throw new Error("TTCF not supported.");n.pos=0,this.parse(),this.subset=new n_(this),this.registerTTF()}return t.open=function(e){return new t(e)},t.prototype.parse=function(){return this.directory=new qy(this.contents),this.head=new Hy(this),this.name=new Jy(this),this.cmap=new um(this),this.toUnicode={},this.hhea=new Wy(this),this.maxp=new Yy(this),this.hmtx=new Xy(this),this.post=new Vy(this),this.os2=new Gy(this),this.loca=new t_(this),this.glyf=new Zy(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},t.prototype.registerTTF=function(){var e,n,r,a,i;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var o,l,c,u;for(u=[],o=0,l=(c=this.bbox).length;o<l;o++)e=c[o],u.push(Math.round(e*this.scaleFactor));return u}).call(this),this.stemV=0,this.post.exists?(r=255&(a=this.post.italic_angle),32768&(n=a>>16)&&(n=-(1+(65535^n))),this.italicAngle=+(n+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(i=this.familyClass)===1||i===2||i===3||i===4||i===5||i===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},t.prototype.characterToGlyph=function(e){var n;return((n=this.cmap.unicode)!=null?n.codeMap[e]:void 0)||0},t.prototype.widthOfGlyph=function(e){var n;return n=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*n},t.prototype.widthOfString=function(e,n,r){var a,i,o,l;for(o=0,i=0,l=(e=""+e).length;0<=l?i<l:i>l;i=0<=l?++i:--i)a=e.charCodeAt(i),o+=this.widthOfGlyph(this.characterToGlyph(a))+r*(1e3/n)||0;return o*(n/1e3)},t.prototype.lineHeight=function(e,n){var r;return n==null&&(n=!1),r=n?this.lineGap:0,(this.ascender+r-this.decender)/1e3*e},t})();var ri,da=(function(){function t(e){this.data=e??[],this.pos=0,this.length=this.data.length}return t.prototype.readByte=function(){return this.data[this.pos++]},t.prototype.writeByte=function(e){return this.data[this.pos++]=e},t.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},t.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},t.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},t.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},t.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},t.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},t.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},t.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},t.prototype.readString=function(e){var n,r;for(r=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)r[n]=String.fromCharCode(this.readByte());return r.join("")},t.prototype.writeString=function(e){var n,r,a;for(a=[],n=0,r=e.length;0<=r?n<r:n>r;n=0<=r?++n:--n)a.push(this.writeByte(e.charCodeAt(n)));return a},t.prototype.readShort=function(){return this.readInt16()},t.prototype.writeShort=function(e){return this.writeInt16(e)},t.prototype.readLongLong=function(){var e,n,r,a,i,o,l,c;return e=this.readByte(),n=this.readByte(),r=this.readByte(),a=this.readByte(),i=this.readByte(),o=this.readByte(),l=this.readByte(),c=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^n)+1099511627776*(255^r)+4294967296*(255^a)+16777216*(255^i)+65536*(255^o)+256*(255^l)+(255^c)+1):72057594037927940*e+281474976710656*n+1099511627776*r+4294967296*a+16777216*i+65536*o+256*l+c},t.prototype.writeLongLong=function(e){var n,r;return n=Math.floor(e/4294967296),r=4294967295&e,this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},t.prototype.readInt=function(){return this.readInt32()},t.prototype.writeInt=function(e){return this.writeInt32(e)},t.prototype.read=function(e){var n,r;for(n=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)n.push(this.readByte());return n},t.prototype.write=function(e){var n,r,a,i;for(i=[],r=0,a=e.length;r<a;r++)n=e[r],i.push(this.writeByte(n));return i},t})(),qy=(function(){var t;function e(n){var r,a,i;for(this.scalarType=n.readInt(),this.tableCount=n.readShort(),this.searchRange=n.readShort(),this.entrySelector=n.readShort(),this.rangeShift=n.readShort(),this.tables={},a=0,i=this.tableCount;0<=i?a<i:a>i;a=0<=i?++a:--a)r={tag:n.readString(4),checksum:n.readInt(),offset:n.readInt(),length:n.readInt()},this.tables[r.tag]=r}return e.prototype.encode=function(n){var r,a,i,o,l,c,u,h,g,b,p,y,_;for(_ in p=Object.keys(n).length,c=Math.log(2),g=16*Math.floor(Math.log(p)/c),o=Math.floor(g/c),h=16*p-g,(a=new da).writeInt(this.scalarType),a.writeShort(p),a.writeShort(g),a.writeShort(o),a.writeShort(h),i=16*p,u=a.pos+i,l=null,y=[],n)for(b=n[_],a.writeString(_),a.writeInt(t(b)),a.writeInt(u),a.writeInt(b.length),y=y.concat(b),_==="head"&&(l=u),u+=b.length;u%4;)y.push(0),u++;return a.write(y),r=2981146554-t(a.data),a.pos=l+8,a.writeUInt32(r),a.data},t=function(n){var r,a,i,o;for(n=dm.call(n);n.length%4;)n.push(0);for(i=new da(n),a=0,r=0,o=n.length;r<o;r=r+=4)a+=i.readUInt32();return 4294967295&a},e})(),zy={}.hasOwnProperty,bi=function(t,e){for(var n in e)zy.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};ri=(function(){function t(e){var n;this.file=e,n=this.file.directory.tables[this.tag],this.exists=!!n,n&&(this.offset=n.offset,this.length=n.length,this.parse(this.file.contents))}return t.prototype.parse=function(){},t.prototype.encode=function(){},t.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},t})();var Hy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="head",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},t.prototype.encode=function(e){var n;return(n=new da).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(e),n.writeShort(this.glyphDataFormat),n.data},t})(),Ap=(function(){function t(e,n){var r,a,i,o,l,c,u,h,g,b,p,y,_,S,x,T,O;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=n+e.readInt(),g=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(c=0;c<256;++c)this.codeMap[c]=e.readByte();break;case 4:for(p=e.readUInt16(),b=p/2,e.pos+=6,i=(function(){var E,M;for(M=[],c=E=0;0<=b?E<b:E>b;c=0<=b?++E:--E)M.push(e.readUInt16());return M})(),e.pos+=2,_=(function(){var E,M;for(M=[],c=E=0;0<=b?E<b:E>b;c=0<=b?++E:--E)M.push(e.readUInt16());return M})(),u=(function(){var E,M;for(M=[],c=E=0;0<=b?E<b:E>b;c=0<=b?++E:--E)M.push(e.readUInt16());return M})(),h=(function(){var E,M;for(M=[],c=E=0;0<=b?E<b:E>b;c=0<=b?++E:--E)M.push(e.readUInt16());return M})(),a=(this.length-e.pos+this.offset)/2,l=(function(){var E,M;for(M=[],c=E=0;0<=a?E<a:E>a;c=0<=a?++E:--E)M.push(e.readUInt16());return M})(),c=x=0,O=i.length;x<O;c=++x)for(S=i[c],r=T=y=_[c];y<=S?T<=S:T>=S;r=y<=S?++T:--T)h[c]===0?o=r+u[c]:(o=l[h[c]/2+(r-y)-(b-c)]||0)!==0&&(o+=u[c]),this.codeMap[r]=65535&o}e.pos=g}return t.encode=function(e,n){var r,a,i,o,l,c,u,h,g,b,p,y,_,S,x,T,O,E,M,ee,G,X,F,I,k,A,j,q,K,le,ue,ae,ge,xe,pe,C,$,V,J,Z,ie,fe,Y,se,be,Ce;switch(q=new da,o=Object.keys(e).sort(function(Te,De){return Te-De}),n){case"macroman":for(_=0,S=(function(){var Te=[];for(y=0;y<256;++y)Te.push(0);return Te})(),T={0:0},i={},K=0,ge=o.length;K<ge;K++)T[Y=e[a=o[K]]]==null&&(T[Y]=++_),i[a]={old:e[a],new:T[e[a]]},S[a]=T[e[a]];return q.writeUInt16(1),q.writeUInt16(0),q.writeUInt32(12),q.writeUInt16(0),q.writeUInt16(262),q.writeUInt16(0),q.write(S),{charMap:i,subtable:q.data,maxGlyphID:_+1};case"unicode":for(A=[],g=[],O=0,T={},r={},x=u=null,le=0,xe=o.length;le<xe;le++)T[M=e[a=o[le]]]==null&&(T[M]=++O),r[a]={old:M,new:T[M]},l=T[M]-a,x!=null&&l===u||(x&&g.push(x),A.push(a),u=l),x=a;for(x&&g.push(x),g.push(65535),A.push(65535),I=2*(F=A.length),X=2*Math.pow(Math.log(F)/Math.LN2,2),b=Math.log(X/2)/Math.LN2,G=2*F-X,c=[],ee=[],p=[],y=ue=0,pe=A.length;ue<pe;y=++ue){if(k=A[y],h=g[y],k===65535){c.push(0),ee.push(0);break}if(k-(j=r[k].new)>=32768)for(c.push(0),ee.push(2*(p.length+F-y)),a=ae=k;k<=h?ae<=h:ae>=h;a=k<=h?++ae:--ae)p.push(r[a].new);else c.push(j-k),ee.push(0)}for(q.writeUInt16(3),q.writeUInt16(1),q.writeUInt32(12),q.writeUInt16(4),q.writeUInt16(16+8*F+2*p.length),q.writeUInt16(0),q.writeUInt16(I),q.writeUInt16(X),q.writeUInt16(b),q.writeUInt16(G),ie=0,C=g.length;ie<C;ie++)a=g[ie],q.writeUInt16(a);for(q.writeUInt16(0),fe=0,$=A.length;fe<$;fe++)a=A[fe],q.writeUInt16(a);for(se=0,V=c.length;se<V;se++)l=c[se],q.writeUInt16(l);for(be=0,J=ee.length;be<J;be++)E=ee[be],q.writeUInt16(E);for(Ce=0,Z=p.length;Ce<Z;Ce++)_=p[Ce],q.writeUInt16(_);return{charMap:r,subtable:q.data,maxGlyphID:O+1}}},t})(),um=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="cmap",t.prototype.parse=function(e){var n,r,a;for(e.pos=this.offset,this.version=e.readUInt16(),a=e.readUInt16(),this.tables=[],this.unicode=null,r=0;0<=a?r<a:r>a;r=0<=a?++r:--r)n=new Ap(e,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},t.encode=function(e,n){var r,a;return n==null&&(n="macroman"),r=Ap.encode(e,n),(a=new da).writeUInt16(0),a.writeUInt16(1),r.table=a.data.concat(r.subtable),r},t})(),Wy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="hhea",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},t})(),Gy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="OS/2",t.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=(function(){var n,r;for(r=[],n=0;n<10;++n)r.push(e.readByte());return r})(),this.charRange=(function(){var n,r;for(r=[],n=0;n<4;++n)r.push(e.readInt());return r})(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=(function(){var n,r;for(r=[],n=0;n<2;n=++n)r.push(e.readInt());return r})(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},t})(),Vy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="post",t.prototype.parse=function(e){var n,r,a;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var i;for(r=e.readUInt16(),this.glyphNameIndex=[],i=0;0<=r?i<r:i>r;i=0<=r?++i:--i)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],a=[];e.pos<this.offset+this.length;)n=e.readByte(),a.push(this.names.push(e.readString(n)));return a;case 151552:return r=e.readUInt16(),this.offsets=e.read(r);case 262144:return this.map=(function(){var o,l,c;for(c=[],i=o=0,l=this.file.maxp.numGlyphs;0<=l?o<l:o>l;i=0<=l?++o:--o)c.push(e.readUInt32());return c}).call(this)}},t})(),Ky=function(t,e){this.raw=t,this.length=t.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},Jy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="name",t.prototype.parse=function(e){var n,r,a,i,o,l,c,u,h,g,b;for(e.pos=this.offset,e.readShort(),n=e.readShort(),l=e.readShort(),r=[],i=0;0<=n?i<n:i>n;i=0<=n?++i:--i)r.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+l+e.readShort()});for(c={},i=h=0,g=r.length;h<g;i=++h)a=r[i],e.pos=a.offset,u=e.readString(a.length),o=new Ky(u,a),c[b=a.nameID]==null&&(c[b]=[]),c[a.nameID].push(o);this.strings=c,this.copyright=c[0],this.fontFamily=c[1],this.fontSubfamily=c[2],this.uniqueSubfamily=c[3],this.fontName=c[4],this.version=c[5];try{this.postscriptName=c[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=c[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=c[7],this.manufacturer=c[8],this.designer=c[9],this.description=c[10],this.vendorUrl=c[11],this.designerUrl=c[12],this.license=c[13],this.licenseUrl=c[14],this.preferredFamily=c[15],this.preferredSubfamily=c[17],this.compatibleFull=c[18],this.sampleText=c[19]},t})(),Yy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="maxp",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},t})(),Xy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="hmtx",t.prototype.parse=function(e){var n,r,a,i,o,l,c;for(e.pos=this.offset,this.metrics=[],n=0,l=this.file.hhea.numberOfMetrics;0<=l?n<l:n>l;n=0<=l?++n:--n)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(a=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var u,h;for(h=[],n=u=0;0<=a?u<a:u>a;n=0<=a?++u:--u)h.push(e.readInt16());return h})(),this.widths=(function(){var u,h,g,b;for(b=[],u=0,h=(g=this.metrics).length;u<h;u++)i=g[u],b.push(i.advance);return b}).call(this),r=this.widths[this.widths.length-1],c=[],n=o=0;0<=a?o<a:o>a;n=0<=a?++o:--o)c.push(this.widths.push(r));return c},t.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},t})(),dm=[].slice,Zy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(e){var n,r,a,i,o,l,c,u,h,g;return e in this.cache?this.cache[e]:(i=this.file.loca,n=this.file.contents,r=i.indexOf(e),(a=i.lengthOf(e))===0?this.cache[e]=null:(n.pos=this.offset+r,o=(l=new da(n.read(a))).readShort(),u=l.readShort(),g=l.readShort(),c=l.readShort(),h=l.readShort(),this.cache[e]=o===-1?new e_(l,u,g,c,h):new Qy(l,o,u,g,c,h),this.cache[e]))},t.prototype.encode=function(e,n,r){var a,i,o,l,c;for(o=[],i=[],l=0,c=n.length;l<c;l++)a=e[n[l]],i.push(o.length),a&&(o=o.concat(a.encode(r)));return i.push(o.length),{table:o,offsets:i}},t})(),Qy=(function(){function t(e,n,r,a,i,o){this.raw=e,this.numberOfContours=n,this.xMin=r,this.yMin=a,this.xMax=i,this.yMax=o,this.compound=!1}return t.prototype.encode=function(){return this.raw.data},t})(),e_=(function(){function t(e,n,r,a,i){var o,l;for(this.raw=e,this.xMin=n,this.yMin=r,this.xMax=a,this.yMax=i,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],o=this.raw;l=o.readShort(),this.glyphOffsets.push(o.pos),this.glyphIDs.push(o.readUInt16()),32&l;)o.pos+=1&l?4:2,128&l?o.pos+=8:64&l?o.pos+=4:8&l&&(o.pos+=2)}return t.prototype.encode=function(){var e,n,r;for(n=new da(dm.call(this.raw.data)),e=0,r=this.glyphIDs.length;e<r;++e)n.pos=this.glyphOffsets[e];return n.data},t})(),t_=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="loca",t.prototype.parse=function(e){var n,r;return e.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var a,i;for(i=[],r=0,a=this.length;r<a;r+=2)i.push(2*e.readUInt16());return i}).call(this):(function(){var a,i;for(i=[],r=0,a=this.length;r<a;r+=4)i.push(e.readUInt32());return i}).call(this)},t.prototype.indexOf=function(e){return this.offsets[e]},t.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},t.prototype.encode=function(e,n){for(var r=new Uint32Array(this.offsets.length),a=0,i=0,o=0;o<r.length;++o)if(r[o]=a,i<n.length&&n[i]==o){++i,r[o]=a;var l=this.offsets[o],c=this.offsets[o+1]-l;c>0&&(a+=c)}for(var u=new Array(4*r.length),h=0;h<r.length;++h)u[4*h+3]=255&r[h],u[4*h+2]=(65280&r[h])>>8,u[4*h+1]=(16711680&r[h])>>16,u[4*h]=(4278190080&r[h])>>24;return u},t})(),n_=(function(){function t(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return t.prototype.generateCmap=function(){var e,n,r,a,i;for(n in a=this.font.cmap.tables[0].codeMap,e={},i=this.subset)r=i[n],e[n]=a[r];return e},t.prototype.glyphsFor=function(e){var n,r,a,i,o,l,c;for(a={},o=0,l=e.length;o<l;o++)a[i=e[o]]=this.font.glyf.glyphFor(i);for(i in n=[],a)(r=a[i])!=null&&r.compound&&n.push.apply(n,r.glyphIDs);if(n.length>0)for(i in c=this.glyphsFor(n))r=c[i],a[i]=r;return a},t.prototype.encode=function(e,n){var r,a,i,o,l,c,u,h,g,b,p,y,_,S,x;for(a in r=um.encode(this.generateCmap(),"unicode"),o=this.glyphsFor(e),p={0:0},x=r.charMap)p[(c=x[a]).old]=c.new;for(y in b=r.maxGlyphID,o)y in p||(p[y]=b++);return h=(function(T){var O,E;for(O in E={},T)E[T[O]]=O;return E})(p),g=Object.keys(h).sort(function(T,O){return T-O}),_=(function(){var T,O,E;for(E=[],T=0,O=g.length;T<O;T++)l=g[T],E.push(h[l]);return E})(),i=this.font.glyf.encode(o,_,p),u=this.font.loca.encode(i.offsets,_),S={cmap:this.font.cmap.raw(),glyf:i.table,loca:u,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(n)},this.font.os2.exists&&(S["OS/2"]=this.font.os2.raw()),this.font.directory.encode(S)},t})();Xe.API.PDFObject=(function(){var t;function e(){}return t=function(n,r){return(Array(r+1).join("0")+n).slice(-r)},e.convert=function(n){var r,a,i,o;if(Array.isArray(n))return"["+(function(){var l,c,u;for(u=[],l=0,c=n.length;l<c;l++)r=n[l],u.push(e.convert(r));return u})().join(" ")+"]";if(typeof n=="string")return"/"+n;if(n!=null&&n.isString)return"("+n+")";if(n instanceof Date)return"(D:"+t(n.getUTCFullYear(),4)+t(n.getUTCMonth(),2)+t(n.getUTCDate(),2)+t(n.getUTCHours(),2)+t(n.getUTCMinutes(),2)+t(n.getUTCSeconds(),2)+"Z)";if({}.toString.call(n)==="[object Object]"){for(a in i=["<<"],n)o=n[a],i.push("/"+a+" "+e.convert(o));return i.push(">>"),i.join(`
`)}return""+n},e})();const Zr=[26,92,107],r_=[240,247,248],Ur=[0,0,0],gi=[100,100,100],kp=[200,200,200],i_=[248,249,250],Np=[255,255,255];function aa(t){return(parseFloat(t)||0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})+" "}function ku(t){return t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):""}function Ep(t,e,n,r){const a=new Xe("p","mm","a4"),i=210,o=25,l=25,c=i-o-l,u=n||{},h=u.company_name||"BECK360",g=u.owner_name||"Eugen Beck",b=u.address_line1||"Eichenweg 1",p=u.address_zip||"76275",y=u.address_city||"Ettlingen",_=u.phone||"0173-4682501",S=u.email||"rundgang@beck360.de",x=u.website||"www.beck360.de",T=u.tax_id||"31205/27003",O=u.vat_id||"DE321274049",E=u.bank_name||"VR Bank Suedpfalz",M=u.bank_iban||"DE92 5486 2500 0001 1389 95",ee=u.bank_bic||"GEN0DE61SUW",G=u.payment_reference_note||"Bitte verwenden Sie die Rechnungsnummer als Verwendungszweck.",X=u.default_invoice_intro||"Vielen Dank fuer Ihren Auftrag. Ich berechne Ihnen fuer folgende Leistungen:",F=u.default_quote_intro||"Vielen Dank fuer Ihr Interesse. Gerne unterbreite ich Ihnen folgendes Angebot:",I=t.type==="quote",k=I?"ANGEBOT":"RECHNUNG",A=I?"Angebotsnr.":"Rechnungsnr.",j=I?"Angebotsdatum":"Rechnungsdatum",q=I?"Gueltig bis":"Faellig am";a.setFillColor(...Zr),a.rect(0,0,i,4,"F");let K=16;a.setFont("helvetica","bold"),a.setFontSize(18),a.setTextColor(...Zr),a.text("Beck360",o,K),a.setFontSize(22),a.setTextColor(...Ur),a.text(k,i-l,K,{align:"right"}),K+=14,a.setFontSize(7),a.setTextColor(...gi),a.setFont("helvetica","normal");const le=`${h}  ${g}  ${b}  ${p} ${y}`;a.text(le,o,K);const ue=a.getTextWidth(le);a.setDrawColor(...kp),a.setLineWidth(.2),a.line(o,K+1,o+ue,K+1),K+=8;const ae=K;a.setFontSize(10),a.setTextColor(...Ur),t.customer_company&&(a.setFont("helvetica","bold"),a.text(t.customer_company,o,K),K+=5),t.customer_name&&(a.setFont("helvetica",t.customer_company?"normal":"bold"),a.text(t.customer_name,o,K),K+=5),a.setFont("helvetica","normal"),t.customer_street&&(a.text(t.customer_street,o,K),K+=5);const ge=`${t.customer_zip||""} ${t.customer_city||""}`.trim();ge&&(a.text(ge,o,K),K+=5);const xe=65,pe=i-l-xe,C=4,$=5.5,V=[[A,t.invoice_number],[j,ku(t.invoice_date)]];t.due_date&&V.push([q,ku(t.due_date)]),t.customer_number&&V.push(["Kundennr.",t.customer_number]),t.service_date&&V.push(["Leistungsdatum",ku(t.service_date)]);const J=C*2+V.length*$,Z=ae-2;a.setFillColor(...r_),a.roundedRect(pe,Z,xe,J,1.5,1.5,"F"),a.setFillColor(...Zr),a.rect(pe,Z,1,J,"F"),a.setFontSize(8.5);let ie=Z+C+4;for(const[Ie,it]of V)a.setFont("helvetica","normal"),a.setTextColor(...gi),a.text(Ie,pe+C+2,ie),a.setFont("helvetica","bold"),a.setTextColor(...Ur),a.text(it||"",pe+xe-C,ie,{align:"right"}),ie+=$;K=Math.max(K,Z+J+8),K+=4;const fe=t.intro_text||(I?F:X);{a.setFont("helvetica","normal"),a.setFontSize(9.5),a.setTextColor(...Ur);const Ie=a.splitTextToSize(fe,c);a.text(Ie,o,K),K+=Ie.length*4.5+6}const Y=o,se=o+12,be=o+c*.58,Ce=o+c*.76,Te=i-l,De=6,U=8;a.setFillColor(...Zr),a.rect(o,K,c,U,"F"),a.setFont("helvetica","bold"),a.setFontSize(8.5),a.setTextColor(...Np);const Pe=K+5.5;a.text("Pos.",Y+2,Pe),a.text("Bezeichnung",se,Pe),a.text("Menge",be,Pe,{align:"right"}),a.text("Einzelpreis",Ce,Pe,{align:"right"}),a.text("Gesamt",Te-2,Pe,{align:"right"}),K+=U,a.setFont("helvetica","normal"),a.setFontSize(9);for(let Ie=0;Ie<e.length;Ie++){const it=e[Ie];let nt=De;it.sub_description&&(nt+=4.5),K+nt>245&&(Ll(a,i,o,l,h,g,b,p,y,_,S,x,T,O,M,ee,E),a.addPage(),a.setFillColor(...Zr),a.rect(0,0,i,4,"F"),K=16),Ie%2===1&&(a.setFillColor(...i_),a.rect(o,K,c,nt,"F"));const at=(parseFloat(it.quantity)||0)*(parseFloat(it.unit_price)||0),ut=parseFloat(it.quantity)%1===0?`${parseInt(it.quantity)} Stk.`:`${parseFloat(it.quantity).toLocaleString("de-DE")}`,pt=K+4.5;a.setTextColor(...Ur),a.setFont("helvetica","normal"),a.setFontSize(9),a.setTextColor(...gi),a.text(`${Ie+1}`,Y+2,pt),a.setTextColor(...Ur),a.text(it.description||"",se,pt),a.text(ut,be,pt,{align:"right"}),a.text(aa(it.unit_price),Ce,pt,{align:"right"}),a.setFont("helvetica","bold"),a.text(aa(at),Te-2,pt,{align:"right"}),K+=De,it.sub_description&&(a.setFont("helvetica","italic"),a.setFontSize(8),a.setTextColor(...gi),a.text(it.sub_description,se,K+1),K+=4.5)}a.setDrawColor(...Zr),a.setLineWidth(.4),a.line(o,K,i-l,K),K+=10;const ht=75,He=i-l-ht,Se=He+3,Ke=i-l-3;function Re(Ie,it,nt={}){if(nt.highlight){a.setFillColor(...Zr),a.roundedRect(He,K-4,ht,9,1,1,"F"),a.setFont("helvetica","bold"),a.setFontSize(10),a.setTextColor(...Np),a.text(Ie,Se,K+1),a.text(it,Ke,K+1,{align:"right"}),K+=10;return}a.setFont("helvetica",nt.bold?"bold":"normal"),nt.italic&&a.setFont("helvetica","italic"),a.setFontSize(nt.size||9),a.setTextColor(...nt.color||Ur),a.text(Ie,Se,K),a.text(it,Ke,K,{align:"right"}),K+=nt.spacing||6}if(a.setDrawColor(...kp),a.setLineWidth(.2),Re("Zwischensumme",aa(t.subtotal)),parseFloat(t.discount_percent)>0){const Ie=parseFloat(t.subtotal)-parseFloat(t.net_amount);Re(`Rabatt (- ${t.discount_percent}%)`,`-${aa(Ie)}`,{color:gi})}if(Re("Nettobetrag",aa(t.net_amount)),Re(`${t.vat_rate} % MwSt.`,aa(t.vat_amount),{italic:!0,color:gi}),Re("Gesamtbetrag",aa(t.total_amount),{highlight:!0}),t.status==="paid"&&Re("Bezahlt",aa(t.paid_amount||t.total_amount),{bold:!0,size:10,color:[22,163,74]}),K+=4,t.payment_terms){K>245&&(Ll(a,i,o,l,h,g,b,p,y,_,S,x,T,O,M,ee,E),a.addPage(),a.setFillColor(...Zr),a.rect(0,0,i,4,"F"),K=16),a.setFont("helvetica","normal"),a.setFontSize(9),a.setTextColor(...Ur);const Ie=a.splitTextToSize(t.payment_terms,c);a.text(Ie,o,K),K+=Ie.length*4.5+3}if(!I&&G&&(a.setFont("helvetica","normal"),a.setFontSize(8.5),a.setTextColor(...gi),a.text(G,o,K),K+=8),t.closing_message){K>250&&(Ll(a,i,o,l,h,g,b,p,y,_,S,x,T,O,M,ee,E),a.addPage(),a.setFillColor(...Zr),a.rect(0,0,i,4,"F"),K=16),a.setFont("helvetica","normal"),a.setFontSize(9),a.setTextColor(...Ur);const Ie=a.splitTextToSize(t.closing_message,c);a.text(Ie,o,K),K+=Ie.length*4.5}if(Ll(a,i,o,l,h,g,b,p,y,_,S,x,T,O,M,ee,E),r!=null&&r.preview){const Ie=a.output("blob"),it=URL.createObjectURL(Ie);window.open(it,"_blank");return}const Qe=`${t.invoice_number}.pdf`;a.save(Qe)}function Ll(t,e,n,r,a,i,o,l,c,u,h,g,b,p,y,_,S){t.setDrawColor(...Zr),t.setLineWidth(.3),t.line(n,268,e-r,268),t.setFontSize(7);const T=n;t.setFont("helvetica","bold"),t.setTextColor(...Zr),t.text(a,T,272),t.setTextColor(...Ur),t.text(i,T,272+3.5),t.setFont("helvetica","normal"),t.setTextColor(...gi),t.text(o,T,279),t.text(`${l} ${c}`,T,272+10.5),t.text(g,T,286),t.text(`St.-Nr.: ${b}`,T,272+17.5);const O=n+55;t.setFont("helvetica","bold"),t.setTextColor(...Ur),t.text("Kontakt",O,272),t.setFont("helvetica","normal"),t.setTextColor(...gi),t.text(`Tel.: ${u}`,O,272+3.5),t.text(`E-Mail: ${h}`,O,279),t.text(`USt-IdNr.: ${p}`,O,272+10.5);const E=n+110;t.setFont("helvetica","bold"),t.setTextColor(...Ur),t.text("Bankverbindung",E,272),t.setFont("helvetica","normal"),t.setTextColor(...gi),t.text(S,E,272+3.5),t.text(`IBAN: ${y}`,E,279),t.text(`BIC: ${_}`,E,272+10.5)}function a_({id:t}){var S,x,T,O,E,M,ee;const{invoice:e,items:n,loading:r,update:a}=fg(t),{settings:i}=ic(),o=Gn();if(r)return s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Rechnung"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(xt,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/invoices"),children:""}),s("h1",{class:"page-title",children:"Nicht gefunden"})]})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Dokument nicht gefunden"})})})]});const l=e.type==="quote",c=((S=As[e.type])==null?void 0:S.label)||"Dokument";async function u(){const{error:G}=await a({status:"sent"});G?o.error("Fehler"):o.success("Als versendet markiert")}async function h(){const{error:G}=await a({status:"paid",paid_date:new Date().toISOString().slice(0,10),paid_amount:e.total_amount});G?o.error("Fehler"):o.success("Als bezahlt markiert")}async function g(){const{data:G,error:X}=await i2(t);X?o.error("Fehler: "+X.message):(o.success("In Rechnung umgewandelt"),qe(`/crm/invoices/${G.id}`))}async function b(){if(!confirm(`${c} "${e.invoice_number}" wirklich loeschen?`))return;const{error:G}=await pg(t);G?o.error("Fehler"):(o.success("Geloescht"),qe("/crm/invoices"))}function p(){Ep(e,n,i)}function y(){Ep(e,n,i,{preview:!0})}function _(){qe(`/crm/invoices/new?edit=${t}`)}return s(xt,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/invoices"),children:""}),s("h1",{class:"page-title",children:e.invoice_number}),s("span",{class:"stage-badge",style:`color:${(x=Qn[e.status])==null?void 0:x.color};background:${(T=Qn[e.status])==null?void 0:T.color}20`,children:(O=Qn[e.status])==null?void 0:O.label})]}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:y,children:"Vorschau"}),s("button",{class:"btn btn-primary btn-sm",onClick:p,children:"PDF herunterladen"}),e.status==="draft"&&s(xt,{children:[s("button",{class:"btn btn-secondary btn-sm",onClick:_,children:"Bearbeiten"}),s("button",{class:"btn btn-secondary btn-sm",onClick:u,children:"Als versendet markieren"}),l&&s("button",{class:"btn btn-primary btn-sm",onClick:g,children:"In Rechnung umwandeln"}),s("button",{class:"btn btn-danger btn-sm",onClick:b,children:"Loeschen"})]}),e.status==="sent"&&!l&&s("button",{class:"btn btn-primary btn-sm",onClick:h,children:"Als bezahlt markieren"})]})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:c})}),s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:l?"Angebotsnr.":"Rechnungsnr."}),s("span",{class:"detail-value",children:e.invoice_number})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Typ"}),s("span",{class:"detail-value",children:c})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Datum"}),s("span",{class:"detail-value",children:jn(e.invoice_date)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:l?"Gueltig bis":"Faellig am"}),s("span",{class:"detail-value",children:jn(e.due_date)})]}),e.paid_date&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Bezahlt am"}),s("span",{class:"detail-value",children:jn(e.paid_date)})]}),e.converted_from_quote_id&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt aus Angebot"}),s("span",{class:"detail-value",children:s("a",{href:"#",onClick:G=>{G.preventDefault(),qe(`/crm/invoices/${e.converted_from_quote_id}`)},children:"Angebot anzeigen"})})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Kunde"})}),s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Firma"}),s("span",{class:"detail-value",children:e.company_id?s("a",{href:"#",onClick:G=>{G.preventDefault(),qe(`/crm/companies/${e.company_id}`)},children:e.customer_company||""}):e.customer_company||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Ansprechpartner"}),s("span",{class:"detail-value",children:e.customer_name||""})]}),s("div",{class:"detail-field form-group-full",children:[s("span",{class:"detail-label",children:"Adresse"}),s("span",{class:"detail-value",children:[e.customer_street,`${e.customer_zip||""} ${e.customer_city||""}`.trim()].filter(Boolean).join(", ")||""})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Positionen"})}),s("div",{class:"table-wrapper",children:s("table",{class:"line-items-table",children:[s("thead",{children:s("tr",{children:[s("th",{children:"Bezeichnung"}),s("th",{style:"text-align:right",children:"Menge"}),s("th",{style:"text-align:right",children:"Einzelpreis"}),s("th",{style:"text-align:right",children:"Gesamt"})]})}),s("tbody",{children:n.map(G=>s("tr",{children:[s("td",{"data-label":"Bezeichnung",children:[s("div",{children:G.description}),G.sub_description&&s("div",{style:"font-size:0.8rem;color:var(--text-muted)",children:G.sub_description})]}),s("td",{"data-label":"Menge",children:G.quantity}),s("td",{"data-label":"Einzelpreis",children:Be(G.unit_price)}),s("td",{"data-label":"Gesamt",style:"font-weight:500",children:Be(G.total)})]},G.id))})]})}),s("div",{class:"invoice-totals",style:"margin-top:1rem",children:[s("div",{class:"invoice-totals-row",children:[s("span",{children:"Zwischensumme"}),s("span",{children:Be(e.subtotal)})]}),parseFloat(e.discount_percent)>0&&s("div",{class:"invoice-totals-row",children:[s("span",{children:["Rabatt (-",e.discount_percent,"%)"]}),s("span",{children:["-",Be(e.subtotal-e.net_amount)]})]}),s("div",{class:"invoice-totals-row",children:[s("span",{children:"Nettobetrag"}),s("span",{children:Be(e.net_amount)})]}),s("div",{class:"invoice-totals-row",children:[s("span",{children:[e.vat_rate,"% MwSt."]}),s("span",{children:Be(e.vat_amount)})]}),s("div",{class:"invoice-totals-row",style:"font-weight:700;font-size:1.1rem;border-top:2px solid var(--border);padding-top:0.5rem",children:[s("span",{children:"Gesamtbetrag"}),s("span",{children:Be(e.total_amount)})]}),e.status==="paid"&&s("div",{class:"invoice-totals-row",style:"font-weight:700;color:var(--success)",children:[s("span",{children:"Bezahlt"}),s("span",{children:Be(e.paid_amount)})]})]})]}),(e.payment_terms||e.closing_message)&&s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Texte"})}),e.payment_terms&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Zahlungsbedingungen"}),s("span",{class:"detail-value",style:"white-space:pre-wrap",children:e.payment_terms})]}),e.closing_message&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Schlussnachricht"}),s("span",{class:"detail-value",style:"white-space:pre-wrap",children:e.closing_message})]})]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Status"}),s("span",{class:"detail-value",children:s("span",{class:"stage-badge",style:`color:${(E=Qn[e.status])==null?void 0:E.color};background:${(M=Qn[e.status])==null?void 0:M.color}20`,children:(ee=Qn[e.status])==null?void 0:ee.label})})]}),e.deal_id&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Deal"}),s("span",{class:"detail-value",children:s("a",{href:"#",onClick:G=>{G.preventDefault(),qe(`/crm/deals/${e.deal_id}`)},children:"Deal anzeigen"})})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:jn(e.created_at)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Aktualisiert"}),s("span",{class:"detail-value",children:jn(e.updated_at)})]}),e.notes&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Interne Notizen"}),s("span",{class:"detail-value",style:"white-space:pre-wrap;font-size:0.8rem",children:e.notes})]})]})})]})})]})}function s_({month:t=null,year:e=null,category:n=null}={}){const[r,a]=me([]),[i,o]=me(!0),l=Nt(async()=>{o(!0);let c=Ne.from("expenses").select("*").is("deleted_at",null).order("date",{ascending:!1});if(e&&(c=c.gte("date",`${e}-01-01`).lte("date",`${e}-12-31`)),t){const g=String(t).padStart(2,"0"),b=e||new Date().getFullYear();c=c.gte("date",`${b}-${g}-01`).lte("date",`${b}-${g}-31`)}n&&(c=c.eq("category",n));const{data:u,error:h}=await c;h||a(u||[]),o(!1)},[t,e,n]);return Mt(()=>{l()},[l]),{expenses:r,loading:i,refetch:l}}function o_(t){const[e,n]=me(null),[r,a]=me(!0),i=Nt(async()=>{if(!t)return;a(!0);const{data:o}=await Ne.from("expenses").select("*").eq("id",t).single();n(o),a(!1)},[t]);return Mt(()=>{i()},[i]),{expense:e,loading:r,refetch:i}}async function l_(t){const{data:e}=await Ne.auth.getUser(),n=e.user.id,{data:r,error:a}=await Ne.from("expenses").insert({...t,owner_id:n}).select().single();return{data:r,error:a}}async function c_(t,e){const{error:n}=await Ne.from("expenses").update({...e,updated_at:new Date().toISOString()}).eq("id",t);return{error:n}}async function u_(t){const{error:e}=await Ne.from("expenses").update({deleted_at:new Date().toISOString()}).eq("id",t);return{error:e}}function d_(){const t=new Date,[e,n]=me(t.getFullYear()),[r,a]=me(null),[i,o]=me(null),{expenses:l,loading:c}=s_({year:e,month:r,category:i}),u=l.reduce((p,y)=>p+(parseFloat(y.amount)||0),0),h=l.reduce((p,y)=>p+(parseFloat(y.amount)||0),0),g=l.length,b=[];for(let p=t.getFullYear();p>=t.getFullYear()-5;p--)b.push(p);return s(xt,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Ausgaben"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>qe("/crm/expenses/new"),children:"+ Ausgabe"})]}),s("div",{class:"page-body",children:[s("div",{class:"search-bar",style:"flex-wrap:wrap;gap:0.75rem",children:[s("select",{value:e,onChange:p=>n(parseInt(p.target.value)),style:"width:auto",children:b.map(p=>s("option",{value:p,children:p},p))}),s("select",{value:r||"",onChange:p=>a(p.target.value?parseInt(p.target.value):null),style:"width:auto",children:[s("option",{value:"",children:"Alle Monate"}),Wl.map((p,y)=>s("option",{value:y+1,children:p},y))]}),s("div",{class:"filter-pills",children:[s("button",{class:`filter-pill ${i?"":"active"}`,onClick:()=>o(null),children:"Alle"}),Object.entries(Hl).map(([p,y])=>s("button",{class:`filter-pill ${i===p?"active":""}`,onClick:()=>o(i===p?null:p),children:y},p))]})]}),s("div",{class:"grid-3",style:"margin-bottom:1.5rem",children:[s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:["Ausgaben ",r?Wl[r-1]:"Zeitraum"]}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#ef4444",children:Be(u)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:["Ausgaben ",e]}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#ef4444",children:Be(h)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Anzahl Belege"}),s("div",{style:"font-size:1.5rem;font-weight:700",children:g})]})]}),c?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):l.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Ausgaben gefunden"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Datum"}),s("th",{children:"Kategorie"}),s("th",{children:"Beschreibung"}),s("th",{children:"Lieferant"}),s("th",{style:"text-align:right",children:"Betrag"})]})}),s("tbody",{children:l.map(p=>s("tr",{class:"clickable-row",onClick:()=>qe(`/crm/expenses/new?edit=${p.id}`),children:[s("td",{"data-label":"Datum",children:jn(p.date)}),s("td",{"data-label":"Kategorie",children:s("span",{style:"font-size:0.75rem;padding:0.15rem 0.5rem;border-radius:999px;background:rgba(239,68,68,0.12);color:#ef4444",children:Hl[p.category]||p.category})}),s("td",{"data-label":"Beschreibung",children:p.description}),s("td",{"data-label":"Lieferant",children:p.vendor||""}),s("td",{"data-label":"Betrag",style:"text-align:right;font-weight:600",children:Be(p.amount)})]},p.id))})]})})})]})]})}function h_(){const t=Gn(),n=new URLSearchParams(window.location.search).get("edit"),{expense:r,loading:a}=o_(n),[i,o]=me(!1),[l,c]=me({date:new Date().toISOString().slice(0,10),category:"other",description:"",amount:"",vat_rate:19,vendor:"",receipt_ref:"",payment_method:"bank_transfer",notes:""});Mt(()=>{!n||a||!r||c({date:r.date||"",category:r.category||"other",description:r.description||"",amount:r.amount||"",vat_rate:r.vat_rate!=null?r.vat_rate:19,vendor:r.vendor||"",receipt_ref:r.receipt_ref||"",payment_method:r.payment_method||"bank_transfer",notes:r.notes||""})},[n,a,r]);const u=parseFloat(l.amount)||0,h=parseFloat(l.vat_rate)||0,g=h>0?u/(1+h/100):u,b=u-g;async function p(_){if(_.preventDefault(),!l.description||!l.amount){t.error("Beschreibung und Betrag sind Pflichtfelder");return}o(!0);const S={date:l.date,category:l.category,description:l.description,amount:parseFloat(l.amount)||0,net_amount:Math.round(g*100)/100,vat_amount:Math.round(b*100)/100,vat_rate:parseFloat(l.vat_rate)||0,vendor:l.vendor||null,receipt_ref:l.receipt_ref||null,payment_method:l.payment_method,notes:l.notes||null};let x;n?(x=await c_(n,S),x.error||(t.success("Ausgabe gespeichert"),qe("/crm/expenses"))):(x=await l_(S),x.error||(t.success("Ausgabe erstellt"),qe("/crm/expenses"))),x.error&&t.error("Fehler: "+x.error.message),o(!1)}async function y(){if(!confirm("Ausgabe wirklich loeschen?"))return;const{error:_}=await u_(n);_?t.error("Fehler: "+_.message):(t.success("Ausgabe geloescht"),qe("/crm/expenses"))}return n&&a?s(xt,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Laden..."})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]}):s(xt,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>qe("/crm/expenses"),children:""}),s("h1",{class:"page-title",children:n?"Ausgabe bearbeiten":"Neue Ausgabe"})]}),n&&s("button",{class:"btn btn-danger btn-sm",onClick:y,children:"Loeschen"})]}),s("div",{class:"page-body",children:s("form",{onSubmit:p,style:"max-width:640px",children:[s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Ausgabe"})}),s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Datum"}),s("input",{type:"date",value:l.date,onInput:_=>c({...l,date:_.target.value}),required:!0})]}),s("div",{class:"form-group",children:[s("label",{children:"Kategorie"}),s("select",{value:l.category,onChange:_=>c({...l,category:_.target.value}),children:Object.entries(Hl).map(([_,S])=>s("option",{value:_,children:S},_))})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Beschreibung"}),s("input",{value:l.description,onInput:_=>c({...l,description:_.target.value}),required:!0,placeholder:"z.B. Matterport-Lizenz, Bueroeinrichtung..."})]}),s("div",{class:"form-group",children:[s("label",{children:"Betrag brutto"}),s("input",{type:"number",step:"0.01",min:"0",value:l.amount,onInput:_=>c({...l,amount:_.target.value}),required:!0,style:"text-align:right"})]}),s("div",{class:"form-group",children:[s("label",{children:"MwSt-Satz (%)"}),s("input",{type:"number",step:"0.01",min:"0",value:l.vat_rate,onInput:_=>c({...l,vat_rate:_.target.value}),style:"max-width:100px;text-align:right"})]}),s("div",{class:"form-group",children:[s("label",{children:"Lieferant"}),s("input",{value:l.vendor,onInput:_=>c({...l,vendor:_.target.value}),placeholder:"Optional"})]}),s("div",{class:"form-group",children:[s("label",{children:"Belegnummer"}),s("input",{value:l.receipt_ref,onInput:_=>c({...l,receipt_ref:_.target.value}),placeholder:"Optional"})]}),s("div",{class:"form-group",children:[s("label",{children:"Zahlungsart"}),s("select",{value:l.payment_method,onChange:_=>c({...l,payment_method:_.target.value}),children:Object.entries(l2).map(([_,S])=>s("option",{value:_,children:S},_))})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Notizen"}),s("textarea",{value:l.notes,onInput:_=>c({...l,notes:_.target.value}),placeholder:"Optional"})]})]}),u>0&&s("div",{style:"margin-top:1rem;padding:1rem;background:var(--bg-secondary);border-radius:8px",children:[s("div",{style:"display:flex;justify-content:space-between;font-size:0.85rem;margin-bottom:0.25rem",children:[s("span",{children:"Nettobetrag"}),s("span",{children:Be(g)})]}),s("div",{style:"display:flex;justify-content:space-between;font-size:0.85rem;margin-bottom:0.25rem",children:[s("span",{children:[l.vat_rate,"% MwSt."]}),s("span",{children:Be(b)})]}),s("div",{style:"display:flex;justify-content:space-between;font-size:0.95rem;font-weight:700;border-top:1px solid var(--border);padding-top:0.5rem;margin-top:0.25rem",children:[s("span",{children:"Bruttobetrag"}),s("span",{children:Be(u)})]})]})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>qe("/crm/expenses"),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",disabled:i,children:i?"Speichern...":n?"Speichern":"Erstellen"})]})]})})]})}function f_({year:t}={}){const[e,n]=me(null),[r,a]=me([]),[i,o]=me([]),[l,c]=me({}),[u,h]=me(!0),g=Nt(async()=>{if(!t)return;h(!0);const b=`${t}-01-01`,p=`${t}-12-31`,[{data:y},{data:_},{data:S}]=await Promise.all([Ne.from("invoices").select("total_amount, net_amount, vat_amount, paid_date").eq("type","invoice").eq("status","paid").gte("paid_date",b).lte("paid_date",p),Ne.from("invoices").select("total_amount").eq("type","invoice").in("status",["sent","overdue"]),Ne.from("expenses").select("date, category, amount, net_amount, vat_amount").is("deleted_at",null).gte("date",b).lte("date",p)]),x=y||[],T=S||[],O=Array.from({length:12},(j,q)=>{const K=q+1,le=String(K).padStart(2,"0"),ue=`${t}-${le}`,ae=x.filter(Z=>Z.paid_date&&Z.paid_date.startsWith(ue)),ge=T.filter(Z=>Z.date&&Z.date.startsWith(ue)),xe=ae.reduce((Z,ie)=>Z+(parseFloat(ie.total_amount)||0),0),pe=ae.reduce((Z,ie)=>Z+(parseFloat(ie.net_amount)||0),0),C=ae.reduce((Z,ie)=>Z+(parseFloat(ie.vat_amount)||0),0),$=ge.reduce((Z,ie)=>Z+(parseFloat(ie.amount)||0),0),V=ge.reduce((Z,ie)=>Z+(parseFloat(ie.net_amount)||0),0),J=ge.reduce((Z,ie)=>Z+(parseFloat(ie.vat_amount)||0),0);return{month:K,incomeBrutto:xe,incomeNetto:pe,vatCollected:C,expensesBrutto:$,expensesNetto:V,vatPaid:J,profit:pe-V}});a(O);const E=[0,1,2,3].map(j=>{const q=O.slice(j*3,j*3+3);return{quarter:j+1,incomeBrutto:q.reduce((K,le)=>K+le.incomeBrutto,0),incomeNetto:q.reduce((K,le)=>K+le.incomeNetto,0),vatCollected:q.reduce((K,le)=>K+le.vatCollected,0),expensesBrutto:q.reduce((K,le)=>K+le.expensesBrutto,0),expensesNetto:q.reduce((K,le)=>K+le.expensesNetto,0),vatPaid:q.reduce((K,le)=>K+le.vatPaid,0),profit:q.reduce((K,le)=>K+le.profit,0)}});o(E);const M={};T.forEach(j=>{const q=j.category||"other";M[q]=(M[q]||0)+(parseFloat(j.amount)||0)}),c(M);const ee=x.reduce((j,q)=>j+(parseFloat(q.total_amount)||0),0),G=x.reduce((j,q)=>j+(parseFloat(q.net_amount)||0),0),X=T.reduce((j,q)=>j+(parseFloat(q.amount)||0),0),F=T.reduce((j,q)=>j+(parseFloat(q.net_amount)||0),0),I=x.reduce((j,q)=>j+(parseFloat(q.vat_amount)||0),0),k=T.reduce((j,q)=>j+(parseFloat(q.vat_amount)||0),0),A=(_||[]).reduce((j,q)=>j+(parseFloat(q.total_amount)||0),0);n({yearRevenue:ee,yearRevenueNetto:G,yearExpenses:X,yearExpensesNetto:F,yearProfit:G-F,openInvoices:A,vatCollected:I,vatPaid:k,vatPayable:I-k}),h(!1)},[t]);return Mt(()=>{g()},[g]),{stats:e,monthlyData:r,quarterlyData:i,expensesByCategory:l,loading:u,refetch:g}}const Nu=[26,92,107],lo=[0,0,0],Eu=[100,100,100],Lp=[200,200,200];function Jr(t){return(parseFloat(t)||0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})+" "}const p_=["Januar","Februar","Maerz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"];function g_({year:t,monthlyData:e,quarterlyData:n,stats:r,settings:a}){const i=new Xe("p","mm","a4"),o=210,l=25,c=25,u=a||{},h=u.company_name||"BECK360",g=u.owner_name||"Eugen Beck",b=u.address_line1||"Eichenweg 1",p=u.address_zip||"76275",y=u.address_city||"Ettlingen",_=u.phone||"0173-4682501",S=u.email||"rundgang@beck360.de",x=u.website||"www.beck360.de",T=u.tax_id||"31205/27003",O=u.vat_id||"DE321274049",E=u.bank_name||"VR Bank Suedpfalz",M=u.bank_iban||"DE92 5486 2500 0001 1389 95",ee=u.bank_bic||"GEN0DE61SUW";let G=20;i.setFont("helvetica","bold"),i.setFontSize(18),i.setTextColor(...Nu),i.text("Beck360",l,G),i.setFontSize(16),i.setTextColor(...lo),i.text("EINNAHMEN-UEBERSCHUSS-RECHNUNG",o-c,G,{align:"right"}),G+=8,i.setFontSize(12),i.setTextColor(...Eu),i.text(`Geschaeftsjahr ${t}`,o-c,G,{align:"right"}),G+=5,i.setFontSize(7),i.setTextColor(...Eu);const X=`${h} - ${g} - ${b} - ${p} ${y}`;i.text(X,l,G);const F=i.getTextWidth(X);i.setDrawColor(...Eu),i.setLineWidth(.2),i.line(l,G+.5,l+F,G+.5),G+=12,i.setFont("helvetica","bold"),i.setFontSize(11),i.setTextColor(...Nu),i.text("Monatsuebersicht",l,G),G+=6;const I=[{label:"Monat",x:l,align:"left",w:28},{label:"Einnahmen",x:l+30,align:"right"},{label:"Ausg. netto",x:l+58,align:"right"},{label:"MwSt erh.",x:l+84,align:"right"},{label:"MwSt gez.",x:l+108,align:"right"},{label:"Gewinn",x:l+136,align:"right"}];i.setFont("helvetica","bold"),i.setFontSize(7.5),i.setTextColor(...lo),i.setDrawColor(...lo),i.setLineWidth(.3),i.line(l,G,o-c,G),G+=4,I.forEach(ue=>{const ae=ue.align==="right"?{align:"right"}:{};i.text(ue.label,ue.x,G,ae)}),G+=2,i.line(l,G,o-c,G),G+=4,i.setFont("helvetica","normal"),i.setFontSize(7.5);const k={incomeNetto:0,expensesNetto:0,vatCollected:0,vatPaid:0,profit:0};e.forEach(ue=>{i.text(p_[ue.month-1],I[0].x,G),i.text(Jr(ue.incomeNetto),I[1].x,G,{align:"right"}),i.text(Jr(ue.expensesNetto),I[2].x,G,{align:"right"}),i.text(Jr(ue.vatCollected),I[3].x,G,{align:"right"}),i.text(Jr(ue.vatPaid),I[4].x,G,{align:"right"}),i.text(Jr(ue.profit),I[5].x,G,{align:"right"}),k.incomeNetto+=ue.incomeNetto,k.expensesNetto+=ue.expensesNetto,k.vatCollected+=ue.vatCollected,k.vatPaid+=ue.vatPaid,k.profit+=ue.profit,G+=4.5}),i.line(l,G-1,o-c,G-1),G+=2,i.setFont("helvetica","bold"),i.text("Summe",I[0].x,G),i.text(Jr(k.incomeNetto),I[1].x,G,{align:"right"}),i.text(Jr(k.expensesNetto),I[2].x,G,{align:"right"}),i.text(Jr(k.vatCollected),I[3].x,G,{align:"right"}),i.text(Jr(k.vatPaid),I[4].x,G,{align:"right"}),i.text(Jr(k.profit),I[5].x,G,{align:"right"}),G+=3,i.line(l,G,o-c,G),G+=15,i.setFont("helvetica","bold"),i.setFontSize(11),i.setTextColor(...Nu),i.text("EUER-Zusammenfassung",l,G),G+=8,i.setFontSize(9),i.setTextColor(...lo);function A(ue,ae,ge={}){ge.bold?i.setFont("helvetica","bold"):i.setFont("helvetica","normal"),i.text(ue,l,G),i.text(Jr(ae),o-c,G,{align:"right"}),G+=ge.spacing||6}A("Betriebseinnahmen (netto)",r.yearRevenueNetto),A("Betriebsausgaben (netto)",r.yearExpensesNetto),i.setDrawColor(...Lp),i.setLineWidth(.3),i.line(l,G-2,o-c,G-2),A("Gewinn vor Steuern",r.yearProfit,{bold:!0,spacing:10}),A("MwSt. erhalten",r.vatCollected),A("MwSt. gezahlt (Vorsteuer)",r.vatPaid),i.line(l,G-2,o-c,G-2),A("MwSt.-Zahllast",r.vatPayable,{bold:!0});const j=270;i.setDrawColor(...Lp),i.setLineWidth(.3),i.line(l,j-3,o-c,j-3),i.setFontSize(7),i.setTextColor(...lo);const q=l;i.setFont("helvetica","bold"),i.text(h,q,j),i.text(g,q,j+3.5),i.setFont("helvetica","normal"),i.text(b,q,j+7),i.text(`${p} ${y}`,q,j+10.5),i.text(x,q,j+14),i.text(`Steuernummer: ${T}`,q,j+17.5),i.text(`USt-IdNr.: ${O}`,q,j+21);const K=l+55;i.setFont("helvetica","bold"),i.text("Kontakt:",K,j),i.setFont("helvetica","normal"),i.text(`Tel.: ${_}`,K,j+3.5),i.text(`E-Mail: ${S}`,K,j+7);const le=l+110;i.setFont("helvetica","bold"),i.text("Zahlungsinformationen:",le,j),i.setFont("helvetica","normal"),i.text(`IBAN: ${M}`,le,j+3.5),i.text(`BIC: ${ee}`,le,j+7),i.text(E,le,j+10.5),i.save(`EUER-${t}-Beck360.pdf`)}function m_(){const t=Gn(),e=new Date,[n,r]=me(e.getFullYear()),{stats:a,monthlyData:i,quarterlyData:o,expensesByCategory:l,loading:c}=f_({year:n}),{settings:u}=ic(),h=[];for(let y=e.getFullYear();y>=e.getFullYear()-5;y--)h.push(y);function g(){a&&(g_({year:n,monthlyData:i,quarterlyData:o,stats:a,settings:u}),t.success("PDF erstellt"))}function b(){if(!i.length)return;const y="Monat,Einnahmen Brutto,Einnahmen Netto,MwSt erhalten,Ausgaben Brutto,Ausgaben Netto,MwSt gezahlt,Gewinn",_=i.map(M=>[Wl[M.month-1],M.incomeBrutto.toFixed(2).replace(".",","),M.incomeNetto.toFixed(2).replace(".",","),M.vatCollected.toFixed(2).replace(".",","),M.expensesBrutto.toFixed(2).replace(".",","),M.expensesNetto.toFixed(2).replace(".",","),M.vatPaid.toFixed(2).replace(".",","),M.profit.toFixed(2).replace(".",",")].map(ee=>`"${ee}"`).join(";")),S=i.reduce((M,ee)=>({ib:M.ib+ee.incomeBrutto,in_:M.in_+ee.incomeNetto,vc:M.vc+ee.vatCollected,eb:M.eb+ee.expensesBrutto,en:M.en+ee.expensesNetto,vp:M.vp+ee.vatPaid,p:M.p+ee.profit}),{ib:0,in_:0,vc:0,eb:0,en:0,vp:0,p:0});_.push(["Summe",S.ib.toFixed(2).replace(".",","),S.in_.toFixed(2).replace(".",","),S.vc.toFixed(2).replace(".",","),S.eb.toFixed(2).replace(".",","),S.en.toFixed(2).replace(".",","),S.vp.toFixed(2).replace(".",","),S.p.toFixed(2).replace(".",",")].map(M=>`"${M}"`).join(";"));const x=[y.split(",").map(M=>`"${M}"`).join(";"),..._].join(`
`),T=new Blob(["\uFEFF"+x],{type:"text/csv;charset=utf-8"}),O=URL.createObjectURL(T),E=document.createElement("a");E.href=O,E.download=`EUER-${n}-Beck360.csv`,E.click(),URL.revokeObjectURL(O),t.success("CSV erstellt")}const p=Object.values(l).reduce((y,_)=>y+_,0);return s(xt,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Berichte"}),s("div",{style:"display:flex;gap:0.5rem;align-items:center;flex-wrap:wrap",children:[s("select",{value:n,onChange:y=>r(parseInt(y.target.value)),style:"width:auto",children:h.map(y=>s("option",{value:y,children:y},y))}),s("button",{class:"btn btn-primary btn-sm",onClick:g,disabled:c,children:"PDF Export"}),s("button",{class:"btn btn-secondary btn-sm",onClick:b,disabled:c,children:"CSV Export"})]})]}),s("div",{class:"page-body",children:c?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):a?s(xt,{children:[s("div",{class:"grid-4",style:"margin-bottom:1.5rem",children:[s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Jahresumsatz brutto"}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#10b981",children:Be(a.yearRevenue)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Ausgaben gesamt"}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#ef4444",children:Be(a.yearExpenses)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Gewinn (netto)"}),s("div",{style:"font-size:1.5rem;font-weight:700;color:var(--brand)",children:Be(a.yearProfit)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Offene Rechnungen"}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#f59e0b",children:Be(a.openInvoices)})]})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Monatsuebersicht ",n]})}),s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Monat"}),s("th",{style:"text-align:right",children:"Einnahmen brutto"}),s("th",{style:"text-align:right",children:"Einnahmen netto"}),s("th",{style:"text-align:right",children:"Ausgaben brutto"}),s("th",{style:"text-align:right",children:"MwSt erh."}),s("th",{style:"text-align:right",children:"MwSt gez."}),s("th",{style:"text-align:right",children:"Gewinn"})]})}),s("tbody",{children:[i.map(y=>s("tr",{children:[s("td",{"data-label":"Monat",style:"font-weight:600",children:Wl[y.month-1]}),s("td",{"data-label":"Einnahmen brutto",children:Be(y.incomeBrutto)}),s("td",{"data-label":"Einnahmen netto",children:Be(y.incomeNetto)}),s("td",{"data-label":"Ausgaben brutto",children:Be(y.expensesBrutto)}),s("td",{"data-label":"MwSt erh.",children:Be(y.vatCollected)}),s("td",{"data-label":"MwSt gez.",children:Be(y.vatPaid)}),s("td",{"data-label":"Gewinn",style:`font-weight:600;color:${y.profit>=0?"#10b981":"#ef4444"}`,children:Be(y.profit)})]},y.month)),s("tr",{style:"font-weight:700;border-top:2px solid var(--border)",children:[s("td",{"data-label":"Monat",children:"Summe"}),s("td",{"data-label":"Einnahmen brutto",children:Be(i.reduce((y,_)=>y+_.incomeBrutto,0))}),s("td",{"data-label":"Einnahmen netto",children:Be(i.reduce((y,_)=>y+_.incomeNetto,0))}),s("td",{"data-label":"Ausgaben brutto",children:Be(i.reduce((y,_)=>y+_.expensesBrutto,0))}),s("td",{"data-label":"MwSt erh.",children:Be(i.reduce((y,_)=>y+_.vatCollected,0))}),s("td",{"data-label":"MwSt gez.",children:Be(i.reduce((y,_)=>y+_.vatPaid,0))}),s("td",{"data-label":"Gewinn",style:`color:${a.yearProfit>=0?"#10b981":"#ef4444"}`,children:Be(a.yearProfit)})]})]})]})})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Quartalsuebersicht ",n]})}),s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Quartal"}),s("th",{style:"text-align:right",children:"Einnahmen brutto"}),s("th",{style:"text-align:right",children:"Einnahmen netto"}),s("th",{style:"text-align:right",children:"Ausgaben brutto"}),s("th",{style:"text-align:right",children:"MwSt erh."}),s("th",{style:"text-align:right",children:"MwSt gez."}),s("th",{style:"text-align:right",children:"Gewinn"})]})}),s("tbody",{children:[o.map(y=>s("tr",{children:[s("td",{"data-label":"Quartal",style:"font-weight:600",children:["Q",y.quarter]}),s("td",{"data-label":"Einnahmen brutto",children:Be(y.incomeBrutto)}),s("td",{"data-label":"Einnahmen netto",children:Be(y.incomeNetto)}),s("td",{"data-label":"Ausgaben brutto",children:Be(y.expensesBrutto)}),s("td",{"data-label":"MwSt erh.",children:Be(y.vatCollected)}),s("td",{"data-label":"MwSt gez.",children:Be(y.vatPaid)}),s("td",{"data-label":"Gewinn",style:`font-weight:600;color:${y.profit>=0?"#10b981":"#ef4444"}`,children:Be(y.profit)})]},y.quarter)),s("tr",{style:"font-weight:700;border-top:2px solid var(--border)",children:[s("td",{"data-label":"Quartal",children:"Summe"}),s("td",{"data-label":"Einnahmen brutto",children:Be(a.yearRevenue)}),s("td",{"data-label":"Einnahmen netto",children:Be(a.yearRevenueNetto)}),s("td",{"data-label":"Ausgaben brutto",children:Be(a.yearExpenses)}),s("td",{"data-label":"MwSt erh.",children:Be(a.vatCollected)}),s("td",{"data-label":"MwSt gez.",children:Be(a.vatPaid)}),s("td",{"data-label":"Gewinn",style:`color:${a.yearProfit>=0?"#10b981":"#ef4444"}`,children:Be(a.yearProfit)})]})]})]})})]}),Object.keys(l).length>0&&s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Ausgaben nach Kategorie"})}),s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Kategorie"}),s("th",{style:"text-align:right",children:"Betrag"}),s("th",{style:"text-align:right",children:"Anteil"})]})}),s("tbody",{children:[Object.entries(l).sort(([,y],[,_])=>_-y).map(([y,_])=>s("tr",{children:[s("td",{"data-label":"Kategorie",style:"font-weight:500",children:Hl[y]||y}),s("td",{"data-label":"Betrag",children:Be(_)}),s("td",{"data-label":"Anteil",children:[p>0?(_/p*100).toFixed(1):0," %"]})]},y)),s("tr",{style:"font-weight:700;border-top:2px solid var(--border)",children:[s("td",{"data-label":"Kategorie",children:"Gesamt"}),s("td",{"data-label":"Betrag",children:Be(p)}),s("td",{"data-label":"Anteil",children:"100 %"})]})]})]})})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["EUER-Zusammenfassung ",n]})}),s("div",{style:"padding:0.5rem 0",children:[s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--border)",children:[s("span",{children:"Betriebseinnahmen (netto)"}),s("span",{style:"font-weight:600",children:Be(a.yearRevenueNetto)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--border)",children:[s("span",{children:"Betriebsausgaben (netto)"}),s("span",{style:"font-weight:600;color:#ef4444",children:Be(a.yearExpensesNetto)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:2px solid var(--border);font-weight:700;font-size:1.1rem",children:[s("span",{children:"Gewinn vor Steuern"}),s("span",{style:`color:${a.yearProfit>=0?"#10b981":"#ef4444"}`,children:Be(a.yearProfit)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--border);margin-top:0.5rem",children:[s("span",{children:"MwSt. erhalten"}),s("span",{children:Be(a.vatCollected)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--border)",children:[s("span",{children:"MwSt. gezahlt (Vorsteuer)"}),s("span",{children:Be(a.vatPaid)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;font-weight:700",children:[s("span",{children:"MwSt.-Zahllast"}),s("span",{children:Be(a.vatPayable)})]})]})]})]}):s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Daten verfuegbar"})]})})]})}function v_(){const{user:t,loading:e}=rc();return e?s("div",{class:"loading-center",style:"min-height: 100vh",children:s("div",{class:"spinner"})}):t?s(Zv,{children:s(hg,{children:[s(Xh,{path:"/crm/"}),s(f2,{path:"/crm/pipeline"}),s(w2,{path:"/crm/contacts"}),s(S2,{path:"/crm/contacts/new"}),s(x2,{path:"/crm/contacts/:id"}),s(k2,{path:"/crm/companies"}),s(N2,{path:"/crm/companies/:id"}),s(L2,{path:"/crm/deals/new"}),s(E2,{path:"/crm/deals/:id"}),s(lb,{path:"/crm/invoices"}),s(ub,{path:"/crm/invoices/new"}),s(a_,{path:"/crm/invoices/:id"}),s(d_,{path:"/crm/expenses"}),s(h_,{path:"/crm/expenses/new"}),s(m_,{path:"/crm/reports"}),s(F2,{path:"/crm/campaigns"}),s(ab,{path:"/crm/campaigns/new"}),s(ob,{path:"/crm/campaigns/:id"}),s(C2,{path:"/crm/settings"}),s(Xh,{default:!0})]})}):s(Qv,{})}r0(s(Uv,{children:s($v,{children:s(v_,{})})}),document.getElementById("app"));export{Ht as _};
