var Xm=Object.defineProperty;var Zm=(t,e,n)=>e in t?Xm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var zt=(t,e,n)=>Zm(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();var Lo,Jt,Pp,Ia,fh,Ip,Op,Rp,cd,Pu,Iu,Fp,Ul={},$l=[],Qm=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Co=Array.isArray;function mi(t,e){for(var n in e)t[n]=e[n];return t}function ud(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Dp(t,e,n){var r,a,i,o={};for(i in e)i=="key"?r=e[i]:i=="ref"?a=e[i]:o[i]=e[i];if(arguments.length>2&&(o.children=arguments.length>3?Lo.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(i in t.defaultProps)o[i]===void 0&&(o[i]=t.defaultProps[i]);return uo(t,o,r,a,null)}function uo(t,e,n,r,a){var i={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:a??++Pp,__i:-1,__u:0};return a==null&&Jt.vnode!=null&&Jt.vnode(i),i}function At(t){return t.children}function ho(t,e){this.props=t,this.context=e}function Ss(t,e){if(e==null)return t.__?Ss(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?Ss(t):null}function e0(t){if(t.__P&&t.__d){var e=t.__v,n=e.__e,r=[],a=[],i=mi({},e);i.__v=e.__v+1,Jt.vnode&&Jt.vnode(i),dd(t.__P,i,e,t.__n,t.__P.namespaceURI,32&e.__u?[n]:null,r,n??Ss(e),!!(32&e.__u),a),i.__v=e.__v,i.__.__k[i.__i]=i,Up(r,i,a),e.__e=e.__=null,i.__e!=n&&jp(i)}}function jp(t){if((t=t.__)!=null&&t.__c!=null)return t.__e=t.__c.base=null,t.__k.some(function(e){if(e!=null&&e.__e!=null)return t.__e=t.__c.base=e.__e}),jp(t)}function Ou(t){(!t.__d&&(t.__d=!0)&&Ia.push(t)&&!ql.__r++||fh!=Jt.debounceRendering)&&((fh=Jt.debounceRendering)||Ip)(ql)}function ql(){for(var t,e=1;Ia.length;)Ia.length>e&&Ia.sort(Op),t=Ia.shift(),e=Ia.length,e0(t);ql.__r=0}function Bp(t,e,n,r,a,i,o,l,c,d,h){var m,b,p,_,w,S,x,T=r&&r.__k||$l,O=e.length;for(c=t0(n,e,T,c,O),m=0;m<O;m++)(p=n.__k[m])!=null&&(b=p.__i!=-1&&T[p.__i]||Ul,p.__i=m,S=dd(t,p,b,a,i,o,l,c,d,h),_=p.__e,p.ref&&b.ref!=p.ref&&(b.ref&&hd(b.ref,null,p),h.push(p.ref,p.__c||_,p)),w==null&&_!=null&&(w=_),(x=!!(4&p.__u))||b.__k===p.__k?c=Mp(p,c,t,x):typeof p.type=="function"&&S!==void 0?c=S:_&&(c=_.nextSibling),p.__u&=-7);return n.__e=w,c}function t0(t,e,n,r,a){var i,o,l,c,d,h=n.length,m=h,b=0;for(t.__k=new Array(a),i=0;i<a;i++)(o=e[i])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=t.__k[i]=uo(null,o,null,null,null):Co(o)?o=t.__k[i]=uo(At,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?o=t.__k[i]=uo(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):t.__k[i]=o,c=i+b,o.__=t,o.__b=t.__b+1,l=null,(d=o.__i=n0(o,n,c,m))!=-1&&(m--,(l=n[d])&&(l.__u|=2)),l==null||l.__v==null?(d==-1&&(a>h?b--:a<h&&b++),typeof o.type!="function"&&(o.__u|=4)):d!=c&&(d==c-1?b--:d==c+1?b++:(d>c?b--:b++,o.__u|=4))):t.__k[i]=null;if(m)for(i=0;i<h;i++)(l=n[i])!=null&&(2&l.__u)==0&&(l.__e==r&&(r=Ss(l)),qp(l,l));return r}function Mp(t,e,n,r){var a,i;if(typeof t.type=="function"){for(a=t.__k,i=0;a&&i<a.length;i++)a[i]&&(a[i].__=t,e=Mp(a[i],e,n,r));return e}t.__e!=e&&(r&&(e&&t.type&&!e.parentNode&&(e=Ss(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Ru(t,e){return e=e||[],t==null||typeof t=="boolean"||(Co(t)?t.some(function(n){Ru(n,e)}):e.push(t)),e}function n0(t,e,n,r){var a,i,o,l=t.key,c=t.type,d=e[n],h=d!=null&&(2&d.__u)==0;if(d===null&&l==null||h&&l==d.key&&c==d.type)return n;if(r>(h?1:0)){for(a=n-1,i=n+1;a>=0||i<e.length;)if((d=e[o=a>=0?a--:i++])!=null&&(2&d.__u)==0&&l==d.key&&c==d.type)return o}return-1}function ph(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Qm.test(e)?n:n+"px"}function cl(t,e,n,r,a){var i,o;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||ph(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||ph(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")i=e!=(e=e.replace(Rp,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+i]=n,n?r?n.u=r.u:(n.u=cd,t.addEventListener(e,i?Iu:Pu,i)):t.removeEventListener(e,i?Iu:Pu,i);else{if(a=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function gh(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=cd++;else if(e.t<n.u)return;return n(Jt.event?Jt.event(e):e)}}}function dd(t,e,n,r,a,i,o,l,c,d){var h,m,b,p,_,w,S,x,T,O,L,K,te,V,q,F=e.type;if(e.constructor!==void 0)return null;128&n.__u&&(c=!!(32&n.__u),i=[l=e.__e=n.__e]),(h=Jt.__b)&&h(e);e:if(typeof F=="function")try{if(x=e.props,T="prototype"in F&&F.prototype.render,O=(h=F.contextType)&&r[h.__c],L=h?O?O.props.value:h.__:r,n.__c?S=(m=e.__c=n.__c).__=m.__E:(T?e.__c=m=new F(x,L):(e.__c=m=new ho(x,L),m.constructor=F,m.render=i0),O&&O.sub(m),m.state||(m.state={}),m.__n=r,b=m.__d=!0,m.__h=[],m._sb=[]),T&&m.__s==null&&(m.__s=m.state),T&&F.getDerivedStateFromProps!=null&&(m.__s==m.state&&(m.__s=mi({},m.__s)),mi(m.__s,F.getDerivedStateFromProps(x,m.__s))),p=m.props,_=m.state,m.__v=e,b)T&&F.getDerivedStateFromProps==null&&m.componentWillMount!=null&&m.componentWillMount(),T&&m.componentDidMount!=null&&m.__h.push(m.componentDidMount);else{if(T&&F.getDerivedStateFromProps==null&&x!==p&&m.componentWillReceiveProps!=null&&m.componentWillReceiveProps(x,L),e.__v==n.__v||!m.__e&&m.shouldComponentUpdate!=null&&m.shouldComponentUpdate(x,m.__s,L)===!1){e.__v!=n.__v&&(m.props=x,m.state=m.__s,m.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(C){C&&(C.__=e)}),$l.push.apply(m.__h,m._sb),m._sb=[],m.__h.length&&o.push(m);break e}m.componentWillUpdate!=null&&m.componentWillUpdate(x,m.__s,L),T&&m.componentDidUpdate!=null&&m.__h.push(function(){m.componentDidUpdate(p,_,w)})}if(m.context=L,m.props=x,m.__P=t,m.__e=!1,K=Jt.__r,te=0,T)m.state=m.__s,m.__d=!1,K&&K(e),h=m.render(m.props,m.state,m.context),$l.push.apply(m.__h,m._sb),m._sb=[];else do m.__d=!1,K&&K(e),h=m.render(m.props,m.state,m.context),m.state=m.__s;while(m.__d&&++te<25);m.state=m.__s,m.getChildContext!=null&&(r=mi(mi({},r),m.getChildContext())),T&&!b&&m.getSnapshotBeforeUpdate!=null&&(w=m.getSnapshotBeforeUpdate(p,_)),V=h!=null&&h.type===At&&h.key==null?$p(h.props.children):h,l=Bp(t,Co(V)?V:[V],e,n,r,a,i,o,l,c,d),m.base=e.__e,e.__u&=-161,m.__h.length&&o.push(m),S&&(m.__E=m.__=null)}catch(C){if(e.__v=null,c||i!=null)if(C.then){for(e.__u|=c?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;i[i.indexOf(l)]=null,e.__e=l}else{for(q=i.length;q--;)ud(i[q]);Fu(e)}else e.__e=n.__e,e.__k=n.__k,C.then||Fu(e);Jt.__e(C,e,n)}else i==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):l=e.__e=r0(n.__e,e,n,r,a,i,o,c,d);return(h=Jt.diffed)&&h(e),128&e.__u?void 0:l}function Fu(t){t&&(t.__c&&(t.__c.__e=!0),t.__k&&t.__k.some(Fu))}function Up(t,e,n){for(var r=0;r<n.length;r++)hd(n[r],n[++r],n[++r]);Jt.__c&&Jt.__c(e,t),t.some(function(a){try{t=a.__h,a.__h=[],t.some(function(i){i.call(a)})}catch(i){Jt.__e(i,a.__v)}})}function $p(t){return typeof t!="object"||t==null||t.__b>0?t:Co(t)?t.map($p):mi({},t)}function r0(t,e,n,r,a,i,o,l,c){var d,h,m,b,p,_,w,S=n.props||Ul,x=e.props,T=e.type;if(T=="svg"?a="http://www.w3.org/2000/svg":T=="math"?a="http://www.w3.org/1998/Math/MathML":a||(a="http://www.w3.org/1999/xhtml"),i!=null){for(d=0;d<i.length;d++)if((p=i[d])&&"setAttribute"in p==!!T&&(T?p.localName==T:p.nodeType==3)){t=p,i[d]=null;break}}if(t==null){if(T==null)return document.createTextNode(x);t=document.createElementNS(a,T,x.is&&x),l&&(Jt.__m&&Jt.__m(e,i),l=!1),i=null}if(T==null)S===x||l&&t.data==x||(t.data=x);else{if(i=i&&Lo.call(t.childNodes),!l&&i!=null)for(S={},d=0;d<t.attributes.length;d++)S[(p=t.attributes[d]).name]=p.value;for(d in S)p=S[d],d=="dangerouslySetInnerHTML"?m=p:d=="children"||d in x||d=="value"&&"defaultValue"in x||d=="checked"&&"defaultChecked"in x||cl(t,d,null,p,a);for(d in x)p=x[d],d=="children"?b=p:d=="dangerouslySetInnerHTML"?h=p:d=="value"?_=p:d=="checked"?w=p:l&&typeof p!="function"||S[d]===p||cl(t,d,p,S[d],a);if(h)l||m&&(h.__html==m.__html||h.__html==t.innerHTML)||(t.innerHTML=h.__html),e.__k=[];else if(m&&(t.innerHTML=""),Bp(e.type=="template"?t.content:t,Co(b)?b:[b],e,n,r,T=="foreignObject"?"http://www.w3.org/1999/xhtml":a,i,o,i?i[0]:n.__k&&Ss(n,0),l,c),i!=null)for(d=i.length;d--;)ud(i[d]);l||(d="value",T=="progress"&&_==null?t.removeAttribute("value"):_!=null&&(_!==t[d]||T=="progress"&&!_||T=="option"&&_!=S[d])&&cl(t,d,_,S[d],a),d="checked",w!=null&&w!=t[d]&&cl(t,d,w,S[d],a))}return t}function hd(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(a){Jt.__e(a,n)}}function qp(t,e,n){var r,a;if(Jt.unmount&&Jt.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||hd(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){Jt.__e(i,e)}r.base=r.__P=null}if(r=t.__k)for(a=0;a<r.length;a++)r[a]&&qp(r[a],e,n||typeof t.type!="function");n||ud(t.__e),t.__c=t.__=t.__e=void 0}function i0(t,e,n){return this.constructor(t,n)}function a0(t,e,n){var r,a,i,o;e==document&&(e=document.documentElement),Jt.__&&Jt.__(t,e),a=(r=!1)?null:e.__k,i=[],o=[],dd(e,t=e.__k=Dp(At,null,[t]),a||Ul,Ul,e.namespaceURI,a?null:e.firstChild?Lo.call(e.childNodes):null,i,a?a.__e:e.firstChild,r,o),Up(i,t,o)}function s0(t,e,n){var r,a,i,o,l=mi({},t.props);for(i in t.type&&t.type.defaultProps&&(o=t.type.defaultProps),e)i=="key"?r=e[i]:i=="ref"?a=e[i]:l[i]=e[i]===void 0&&o!=null?o[i]:e[i];return arguments.length>2&&(l.children=arguments.length>3?Lo.call(arguments,2):n),uo(t.type,l,r||t.key,a||t.ref,null)}function fd(t){function e(n){var r,a;return this.getChildContext||(r=new Set,(a={})[e.__c]=this,this.getChildContext=function(){return a},this.componentWillUnmount=function(){r=null},this.shouldComponentUpdate=function(i){this.props.value!=i.value&&r.forEach(function(o){o.__e=!0,Ou(o)})},this.sub=function(i){r.add(i);var o=i.componentWillUnmount;i.componentWillUnmount=function(){r&&r.delete(i),o&&o.call(i)}}),n.children}return e.__c="__cC"+Fp++,e.__=t,e.Provider=e.__l=(e.Consumer=function(n,r){return n.children(r)}).contextType=e,e}Lo=$l.slice,Jt={__e:function(t,e,n,r){for(var a,i,o;e=e.__;)if((a=e.__c)&&!a.__)try{if((i=a.constructor)&&i.getDerivedStateFromError!=null&&(a.setState(i.getDerivedStateFromError(t)),o=a.__d),a.componentDidCatch!=null&&(a.componentDidCatch(t,r||{}),o=a.__d),o)return a.__E=a}catch(l){t=l}throw t}},Pp=0,ho.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=mi({},this.state),typeof t=="function"&&(t=t(mi({},n),this.props)),t&&mi(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),Ou(this))},ho.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Ou(this))},ho.prototype.render=At,Ia=[],Ip=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Op=function(t,e){return t.__v.__b-e.__v.__b},ql.__r=0,Rp=/(PointerCapture)$|Capture$/i,cd=0,Pu=gh(!1),Iu=gh(!0),Fp=0;var o0=0;function s(t,e,n,r,a,i){e||(e={});var o,l,c=e;if("ref"in c)for(l in c={},e)l=="ref"?o=e[l]:c[l]=e[l];var d={type:t,props:c,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--o0,__i:-1,__u:0,__source:a,__self:i};if(typeof t=="function"&&(o=t.defaultProps))for(l in o)c[l]===void 0&&(c[l]=o[l]);return Jt.vnode&&Jt.vnode(d),d}var As,ln,Hc,mh,bo=0,zp=[],Ln=Jt,vh=Ln.__b,bh=Ln.__r,yh=Ln.diffed,_h=Ln.__c,wh=Ln.unmount,xh=Ln.__;function ec(t,e){Ln.__h&&Ln.__h(ln,t,bo||e),bo=0;var n=ln.__H||(ln.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function me(t){return bo=1,l0(Vp,t)}function l0(t,e,n){var r=ec(As++,2);if(r.t=t,!r.__c&&(r.__=[Vp(void 0,e),function(l){var c=r.__N?r.__N[0]:r.__[0],d=r.t(c,l);c!==d&&(r.__N=[d,r.__[1]],r.__c.setState({}))}],r.__c=ln,!ln.__f)){var a=function(l,c,d){if(!r.__c.__H)return!0;var h=r.__c.__H.__.filter(function(b){return b.__c});if(h.every(function(b){return!b.__N}))return!i||i.call(this,l,c,d);var m=r.__c.props!==l;return h.some(function(b){if(b.__N){var p=b.__[0];b.__=b.__N,b.__N=void 0,p!==b.__[0]&&(m=!0)}}),i&&i.call(this,l,c,d)||m};ln.__f=!0;var i=ln.shouldComponentUpdate,o=ln.componentWillUpdate;ln.componentWillUpdate=function(l,c,d){if(this.__e){var h=i;i=void 0,a(l,c,d),i=h}o&&o.call(this,l,c,d)},ln.shouldComponentUpdate=a}return r.__N||r.__}function Mt(t,e){var n=ec(As++,3);!Ln.__s&&Gp(n.__H,e)&&(n.__=t,n.u=e,ln.__H.__h.push(n))}function Hp(t){return bo=5,fo(function(){return{current:t}},[])}function fo(t,e){var n=ec(As++,7);return Gp(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function Nt(t,e){return bo=8,fo(function(){return t},e)}function Wp(t){var e=ln.context[t.__c],n=ec(As++,9);return n.c=t,e?(n.__==null&&(n.__=!0,e.sub(ln)),e.props.value):t.__}function c0(){for(var t;t=zp.shift();){var e=t.__H;if(t.__P&&e)try{e.__h.some(Tl),e.__h.some(Du),e.__h=[]}catch(n){e.__h=[],Ln.__e(n,t.__v)}}}Ln.__b=function(t){ln=null,vh&&vh(t)},Ln.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),xh&&xh(t,e)},Ln.__r=function(t){bh&&bh(t),As=0;var e=(ln=t.__c).__H;e&&(Hc===ln?(e.__h=[],ln.__h=[],e.__.some(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.some(Tl),e.__h.some(Du),e.__h=[],As=0)),Hc=ln},Ln.diffed=function(t){yh&&yh(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(zp.push(e)!==1&&mh===Ln.requestAnimationFrame||((mh=Ln.requestAnimationFrame)||u0)(c0)),e.__H.__.some(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Hc=ln=null},Ln.__c=function(t,e){e.some(function(n){try{n.__h.some(Tl),n.__h=n.__h.filter(function(r){return!r.__||Du(r)})}catch(r){e.some(function(a){a.__h&&(a.__h=[])}),e=[],Ln.__e(r,n.__v)}}),_h&&_h(t,e)},Ln.unmount=function(t){wh&&wh(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.some(function(r){try{Tl(r)}catch(a){e=a}}),n.__H=void 0,e&&Ln.__e(e,n.__v))};var Sh=typeof requestAnimationFrame=="function";function u0(t){var e,n=function(){clearTimeout(r),Sh&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,35);Sh&&(e=requestAnimationFrame(n))}function Tl(t){var e=ln,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),ln=e}function Du(t){var e=ln;t.__c=t.__(),ln=e}function Gp(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function Vp(t,e){return typeof e=="function"?e(t):e}function tc(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]]);return n}function d0(t,e,n,r){function a(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(h){try{d(r.next(h))}catch(m){o(m)}}function c(h){try{d(r.throw(h))}catch(m){o(m)}}function d(h){h.done?i(h.value):a(h.value).then(l,c)}d((r=r.apply(t,e||[])).next())})}const h0=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class pd extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class f0 extends pd{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ah extends pd{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class kh extends pd{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ju;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(ju||(ju={}));class p0{constructor(e,{headers:n={},customFetch:r,region:a=ju.Any}={}){this.url=e,this.headers=n,this.region=a,this.fetch=h0(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return d0(this,arguments,void 0,function*(n,r={}){var a;let i,o;try{const{headers:l,method:c,body:d,signal:h,timeout:m}=r;let b={},{region:p}=r;p||(p=this.region);const _=new URL(`${this.url}/${n}`);p&&p!=="any"&&(b["x-region"]=p,_.searchParams.set("forceFunctionRegion",p));let w;d&&(l&&!Object.prototype.hasOwnProperty.call(l,"Content-Type")||!l)?typeof Blob<"u"&&d instanceof Blob||d instanceof ArrayBuffer?(b["Content-Type"]="application/octet-stream",w=d):typeof d=="string"?(b["Content-Type"]="text/plain",w=d):typeof FormData<"u"&&d instanceof FormData?w=d:(b["Content-Type"]="application/json",w=JSON.stringify(d)):d&&typeof d!="string"&&!(typeof Blob<"u"&&d instanceof Blob)&&!(d instanceof ArrayBuffer)&&!(typeof FormData<"u"&&d instanceof FormData)?w=JSON.stringify(d):w=d;let S=h;m&&(o=new AbortController,i=setTimeout(()=>o.abort(),m),h?(S=o.signal,h.addEventListener("abort",()=>o.abort())):S=o.signal);const x=yield this.fetch(_.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},b),this.headers),l),body:w,signal:S}).catch(K=>{throw new f0(K)}),T=x.headers.get("x-relay-error");if(T&&T==="true")throw new Ah(x);if(!x.ok)throw new kh(x);let O=((a=x.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),L;return O==="application/json"?L=yield x.json():O==="application/octet-stream"||O==="application/pdf"?L=yield x.blob():O==="text/event-stream"?L=x:O==="multipart/form-data"?L=yield x.formData():L=yield x.text(),{data:L,error:null,response:x}}catch(l){return{data:null,error:l,response:l instanceof kh||l instanceof Ah?l.context:void 0}}finally{i&&clearTimeout(i)}})}}var g0=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},m0=class{constructor(t){var e,n,r;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,this.urlLengthLimit=(r=t.urlLengthLimit)!==null&&r!==void 0?r:8e3,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let a=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,l=null,c=null,d=i.status,h=i.statusText;if(i.ok){var m,b;if(n.method!=="HEAD"){var p;const x=await i.text();x===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((p=n.headers.get("Accept"))===null||p===void 0)&&p.includes("application/vnd.pgrst.plan+text"))?l=x:l=JSON.parse(x))}const w=(m=n.headers.get("Prefer"))===null||m===void 0?void 0:m.match(/count=(exact|planned|estimated)/),S=(b=i.headers.get("content-range"))===null||b===void 0?void 0:b.split("/");w&&S&&S.length>1&&(c=parseInt(S[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(l)&&(l.length>1?(o={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,c=null,d=406,h="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{var _;const w=await i.text();try{o=JSON.parse(w),Array.isArray(o)&&i.status===404&&(l=[],o=null,d=200,h="OK")}catch{i.status===404&&w===""?(d=204,h="No Content"):o={message:w}}if(o&&n.isMaybeSingle&&(!(o==null||(_=o.details)===null||_===void 0)&&_.includes("0 rows"))&&(o=null,d=200,h="OK"),o&&n.shouldThrowOnError)throw new g0(o)}return{error:o,data:l,count:c,status:d,statusText:h}});return this.shouldThrowOnError||(a=a.catch(i=>{var o;let l="",c="",d="";const h=i==null?void 0:i.cause;if(h){var m,b,p,_;const x=(m=h==null?void 0:h.message)!==null&&m!==void 0?m:"",T=(b=h==null?void 0:h.code)!==null&&b!==void 0?b:"";l=`${(p=i==null?void 0:i.name)!==null&&p!==void 0?p:"FetchError"}: ${i==null?void 0:i.message}`,l+=`

Caused by: ${(_=h==null?void 0:h.name)!==null&&_!==void 0?_:"Error"}: ${x}`,T&&(l+=` (${T})`),h!=null&&h.stack&&(l+=`
${h.stack}`)}else{var w;l=(w=i==null?void 0:i.stack)!==null&&w!==void 0?w:""}const S=this.url.toString().length;return(i==null?void 0:i.name)==="AbortError"||(i==null?void 0:i.code)==="ABORT_ERR"?(d="",c="Request was aborted (timeout or manual cancellation)",S>this.urlLengthLimit&&(c+=`. Note: Your request URL is ${S} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((h==null?void 0:h.name)==="HeadersOverflowError"||(h==null?void 0:h.code)==="UND_ERR_HEADERS_OVERFLOW")&&(d="",c="HTTP headers exceeded server limits (typically 16KB)",S>this.urlLengthLimit&&(c+=`. Your request URL is ${S} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:l,hint:c,code:d},data:null,count:null,status:0,statusText:""}})),a.then(t,e)}returns(){return this}overrideTypes(){return this}},v0=class extends m0{select(t){let e=!1;const n=(t??"*").split("").map(r=>/\s/.test(r)&&!e?"":(r==='"'&&(e=!e),r)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:r,referencedTable:a=r}={}){const i=a?`${a}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:r=n}={}){const a=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${t}`),this.url.searchParams.set(i,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:r=!1,wal:a=!1,format:i="text"}={}){var o;const l=[t?"analyze":null,e?"verbose":null,n?"settings":null,r?"buffers":null,a?"wal":null].filter(Boolean).join("|"),c=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${c}"; options=${l};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const Nh=new RegExp("[,()]");var ds=class extends v0{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&Nh.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}notIn(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&Nh.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`not.in.(${n})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:r}={}){let a="";r==="plain"?a="pl":r==="phrase"?a="ph":r==="websearch"&&(a="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${a}fts${i}.${e}`),this}match(t){return Object.entries(t).forEach(([e,n])=>{this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}},b0=class{constructor(t,{headers:e={},schema:n,fetch:r,urlLengthLimit:a=8e3}){this.url=t,this.headers=new Headers(e),this.schema=n,this.fetch=r,this.urlLengthLimit=a}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,e){const{head:n=!1,count:r}=e??{},a=n?"HEAD":"GET";let i=!1;const o=(t??"*").split("").map(d=>/\s/.test(d)&&!i?"":(d==='"'&&(i=!i),d)).join(""),{url:l,headers:c}=this.cloneRequestState();return l.searchParams.set("select",o),r&&c.append("Prefer",`count=${r}`),new ds({method:a,url:l,headers:c,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(t,{count:e,defaultToNull:n=!0}={}){var r;const a="POST",{url:i,headers:o}=this.cloneRequestState();if(e&&o.append("Prefer",`count=${e}`),n||o.append("Prefer","missing=default"),Array.isArray(t)){const l=t.reduce((c,d)=>c.concat(Object.keys(d)),[]);if(l.length>0){const c=[...new Set(l)].map(d=>`"${d}"`);i.searchParams.set("columns",c.join(","))}}return new ds({method:a,url:i,headers:o,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:r,defaultToNull:a=!0}={}){var i;const o="POST",{url:l,headers:c}=this.cloneRequestState();if(c.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),e!==void 0&&l.searchParams.set("on_conflict",e),r&&c.append("Prefer",`count=${r}`),a||c.append("Prefer","missing=default"),Array.isArray(t)){const d=t.reduce((h,m)=>h.concat(Object.keys(m)),[]);if(d.length>0){const h=[...new Set(d)].map(m=>`"${m}"`);l.searchParams.set("columns",h.join(","))}}return new ds({method:o,url:l,headers:c,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}update(t,{count:e}={}){var n;const r="PATCH",{url:a,headers:i}=this.cloneRequestState();return e&&i.append("Prefer",`count=${e}`),new ds({method:r,url:a,headers:i,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:t}={}){var e;const n="DELETE",{url:r,headers:a}=this.cloneRequestState();return t&&a.append("Prefer",`count=${t}`),new ds({method:n,url:r,headers:a,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}};function yo(t){"@babel/helpers - typeof";return yo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yo(t)}function y0(t,e){if(yo(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(yo(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function _0(t){var e=y0(t,"string");return yo(e)=="symbol"?e:e+""}function w0(t,e,n){return(e=_0(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Eh(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function ul(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Eh(Object(n),!0).forEach(function(r){w0(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Eh(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var x0=class Kp{constructor(e,{headers:n={},schema:r,fetch:a,timeout:i,urlLengthLimit:o=8e3}={}){this.url=e,this.headers=new Headers(n),this.schemaName=r,this.urlLengthLimit=o;const l=a??globalThis.fetch;i!==void 0&&i>0?this.fetch=(c,d)=>{const h=new AbortController,m=setTimeout(()=>h.abort(),i),b=d==null?void 0:d.signal;if(b){if(b.aborted)return clearTimeout(m),l(c,d);const p=()=>{clearTimeout(m),h.abort()};return b.addEventListener("abort",p,{once:!0}),l(c,ul(ul({},d),{},{signal:h.signal})).finally(()=>{clearTimeout(m),b.removeEventListener("abort",p)})}return l(c,ul(ul({},d),{},{signal:h.signal})).finally(()=>clearTimeout(m))}:this.fetch=l}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new b0(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(e){return new Kp(this.url,{headers:this.headers,schema:e,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,n={},{head:r=!1,get:a=!1,count:i}={}){var o;let l;const c=new URL(`${this.url}/rpc/${e}`);let d;const h=p=>p!==null&&typeof p=="object"&&(!Array.isArray(p)||p.some(h)),m=r&&Object.values(n).some(h);m?(l="POST",d=n):r||a?(l=r?"HEAD":"GET",Object.entries(n).filter(([p,_])=>_!==void 0).map(([p,_])=>[p,Array.isArray(_)?`{${_.join(",")}}`:`${_}`]).forEach(([p,_])=>{c.searchParams.append(p,_)})):(l="POST",d=n);const b=new Headers(this.headers);return m?b.set("Prefer",i?`count=${i},return=minimal`:"return=minimal"):i&&b.set("Prefer",`count=${i}`),new ds({method:l,url:c,headers:b,schema:this.schemaName,body:d,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}};class S0{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const n=globalThis.process;if(n){const r=n.versions;if(r&&r.node){const a=r.node,i=parseInt(a.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const A0="2.97.0",k0=`realtime-js/${A0}`,N0="1.0.0",Jp="2.0.0",Lh=Jp,Bu=1e4,E0=1e3,L0=100;var sa;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(sa||(sa={}));var jn;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(jn||(jn={}));var ei;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(ei||(ei={}));var Mu;(function(t){t.websocket="websocket"})(Mu||(Mu={}));var Oa;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Oa||(Oa={}));class C0{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r;const a=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,a)}_encodeJsonUserBroadcastPush(e){var n,r;const a=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},o=new TextEncoder().encode(JSON.stringify(a)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,n,r){var a,i;const o=e.topic,l=(a=e.ref)!==null&&a!==void 0?a:"",c=(i=e.join_ref)!==null&&i!==void 0?i:"",d=e.payload.event,h=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},m=Object.keys(h).length===0?"":JSON.stringify(h);if(c.length>255)throw new Error(`joinRef length ${c.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`ref length ${l.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`userEvent length ${d.length} exceeds maximum of 255`);if(m.length>255)throw new Error(`metadata length ${m.length} exceeds maximum of 255`);const b=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+l.length+o.length+d.length+m.length,p=new ArrayBuffer(this.HEADER_LENGTH+b);let _=new DataView(p),w=0;_.setUint8(w++,this.KINDS.userBroadcastPush),_.setUint8(w++,c.length),_.setUint8(w++,l.length),_.setUint8(w++,o.length),_.setUint8(w++,d.length),_.setUint8(w++,m.length),_.setUint8(w++,n),Array.from(c,x=>_.setUint8(w++,x.charCodeAt(0))),Array.from(l,x=>_.setUint8(w++,x.charCodeAt(0))),Array.from(o,x=>_.setUint8(w++,x.charCodeAt(0))),Array.from(d,x=>_.setUint8(w++,x.charCodeAt(0))),Array.from(m,x=>_.setUint8(w++,x.charCodeAt(0)));var S=new Uint8Array(p.byteLength+r.byteLength);return S.set(new Uint8Array(p),0),S.set(new Uint8Array(r),p.byteLength),S.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[a,i,o,l,c]=r;return n({join_ref:a,ref:i,topic:o,event:l,payload:c})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),a=new TextDecoder;switch(r){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,a)}}_decodeUserBroadcast(e,n,r){const a=n.getUint8(1),i=n.getUint8(2),o=n.getUint8(3),l=n.getUint8(4);let c=this.HEADER_LENGTH+4;const d=r.decode(e.slice(c,c+a));c=c+a;const h=r.decode(e.slice(c,c+i));c=c+i;const m=r.decode(e.slice(c,c+o));c=c+o;const b=e.slice(c,e.byteLength),p=l===this.JSON_ENCODING?JSON.parse(r.decode(b)):b,_={type:this.BROADCAST_EVENT,event:h,payload:p};return o>0&&(_.meta=JSON.parse(m)),{join_ref:null,ref:null,topic:d,event:this.BROADCAST_EVENT,payload:_}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([r])=>n.includes(r)))}}class Yp{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Qt;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Qt||(Qt={}));const Ch=(t,e,n={})=>{var r;const a=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=T0(o,t,e,a),i),{}):{}},T0=(t,e,n,r)=>{const a=e.find(l=>l.name===t),i=a==null?void 0:a.type,o=n[t];return i&&!r.includes(i)?Xp(i,o):Uu(o)},Xp=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return R0(e,n)}switch(t){case Qt.bool:return P0(e);case Qt.float4:case Qt.float8:case Qt.int2:case Qt.int4:case Qt.int8:case Qt.numeric:case Qt.oid:return I0(e);case Qt.json:case Qt.jsonb:return O0(e);case Qt.timestamp:return F0(e);case Qt.abstime:case Qt.date:case Qt.daterange:case Qt.int4range:case Qt.int8range:case Qt.money:case Qt.reltime:case Qt.text:case Qt.time:case Qt.timestamptz:case Qt.timetz:case Qt.tsrange:case Qt.tstzrange:return Uu(e);default:return Uu(e)}},Uu=t=>t,P0=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},I0=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},O0=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},R0=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let i;const o=t.slice(1,n);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>Xp(e,l))}return t},F0=t=>typeof t=="string"?t.replace(" ","T"):t,Zp=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Wc{constructor(e,n,r={},a=Bu){this.channel=e,this.event=n,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Th;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Th||(Th={}));class po{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=po.syncState(this.state,a,i,o),this.pendingDiffs.forEach(c=>{this.state=po.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},a=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=po.syncDiff(this.state,a,i,o),l())}),this.onJoin((a,i,o)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:i,newPresences:o})}),this.onLeave((a,i,o)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,a){const i=this.cloneDeep(e),o=this.transformState(n),l={},c={};return this.map(i,(d,h)=>{o[d]||(c[d]=h)}),this.map(o,(d,h)=>{const m=i[d];if(m){const b=h.map(S=>S.presence_ref),p=m.map(S=>S.presence_ref),_=h.filter(S=>p.indexOf(S.presence_ref)<0),w=m.filter(S=>b.indexOf(S.presence_ref)<0);_.length>0&&(l[d]=_),w.length>0&&(c[d]=w)}else l[d]=h}),this.syncDiff(i,{joins:l,leaves:c},r,a)}static syncDiff(e,n,r,a){const{joins:i,leaves:o}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(i,(l,c)=>{var d;const h=(d=e[l])!==null&&d!==void 0?d:[];if(e[l]=this.cloneDeep(c),h.length>0){const m=e[l].map(p=>p.presence_ref),b=h.filter(p=>m.indexOf(p.presence_ref)<0);e[l].unshift(...b)}r(l,h,c)}),this.map(o,(l,c)=>{let d=e[l];if(!d)return;const h=c.map(m=>m.presence_ref);d=d.filter(m=>h.indexOf(m.presence_ref)<0),e[l]=d,a(l,d,c),d.length===0&&delete e[l]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const a=e[r];return"metas"in a?n[r]=a.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=a,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ph;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Ph||(Ph={}));var go;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(go||(go={}));var ji;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(ji||(ji={}));class ms{constructor(e,n={config:{}},r){var a,i;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=jn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Wc(this,ei.join,this.params,this.timeout),this.rejoinTimer=new Yp(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=jn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=jn.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=jn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=jn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=jn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ei.reply,{},(o,l)=>{this._trigger(this._replyEventName(l),o)}),this.presence=new po(this),this.broadcastEndpointURL=Zp(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(a=this.params.config)===null||a===void 0?void 0:a.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,a,i;if(this.socket.isConnected()||this.socket.connect(),this.state==jn.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,d=(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(p=>p.filter))!==null&&a!==void 0?a:[],h=!!this.bindings[go.PRESENCE]&&this.bindings[go.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,m={},b={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:h}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(ji.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(ji.CLOSED)),this.updateJoinPayload(Object.assign({config:b},m)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:p})=>{var _;if(this.socket._isManualToken()||this.socket.setAuth(),p===void 0){e==null||e(ji.SUBSCRIBED);return}else{const w=this.bindings.postgres_changes,S=(_=w==null?void 0:w.length)!==null&&_!==void 0?_:0,x=[];for(let T=0;T<S;T++){const O=w[T],{filter:{event:L,schema:K,table:te,filter:V}}=O,q=p&&p[T];if(q&&q.event===L&&ms.isFilterValueEqual(q.schema,K)&&ms.isFilterValueEqual(q.table,te)&&ms.isFilterValueEqual(q.filter,V))x.push(Object.assign(Object.assign({},O),{id:q.id}));else{this.unsubscribe(),this.state=jn.errored,e==null||e(ji.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=x,e&&e(ji.SUBSCRIBED);return}}).receive("error",p=>{this.state=jn.errored,e==null||e(ji.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(ji.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===jn.joined&&e===go.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var a;if(n==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},l=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(a=r.timeout)!==null&&a!==void 0?a:this.timeout);if(l.status===202)return{success:!0};let c=l.statusText;try{const d=await l.json();c=d.error||d.message||c}catch{}return Promise.reject(new Error(c))}async send(e,n={}){var r,a;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,l={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(l.Authorization=`Bearer ${this.socket.accessTokenValue}`);const c={method:"POST",headers:l,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((a=d.body)===null||a===void 0?void 0:a.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,c;const d=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=jn.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ei.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(a=>{r=new Wc(this,ei.leave,{},e),r.receive("ok",()=>{n(),a("ok")}).receive("timeout",()=>{n(),a("timed out")}).receive("error",()=>{a("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=jn.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const a=new AbortController,i=setTimeout(()=>a.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:a.signal}));return clearTimeout(i),o}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new Wc(this,e,n,r);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>L0){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var a,i;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:d,join:h}=ei;if(r&&[l,c,d,h].indexOf(o)>=0&&r!==this._joinRef())return;let b=this._onMessage(o,n,r);if(n&&!b)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(p=>{var _,w,S;return((_=p.filter)===null||_===void 0?void 0:_.event)==="*"||((S=(w=p.filter)===null||w===void 0?void 0:w.event)===null||S===void 0?void 0:S.toLocaleLowerCase())===o}).map(p=>p.callback(b,r)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var _,w,S,x,T,O;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const L=p.id,K=(_=p.filter)===null||_===void 0?void 0:_.event;return L&&((w=n.ids)===null||w===void 0?void 0:w.includes(L))&&(K==="*"||(K==null?void 0:K.toLocaleLowerCase())===((S=n.data)===null||S===void 0?void 0:S.type.toLocaleLowerCase()))}else{const L=(T=(x=p==null?void 0:p.filter)===null||x===void 0?void 0:x.event)===null||T===void 0?void 0:T.toLocaleLowerCase();return L==="*"||L===((O=n==null?void 0:n.event)===null||O===void 0?void 0:O.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof b=="object"&&"ids"in b){const _=b.data,{schema:w,table:S,commit_timestamp:x,type:T,errors:O}=_;b=Object.assign(Object.assign({},{schema:w,table:S,commit_timestamp:x,eventType:T,new:{},old:{},errors:O}),this._getPayloadRecords(_))}p.callback(b,r)})}_isClosed(){return this.state===jn.closed}_isJoined(){return this.state===jn.joined}_isJoining(){return this.state===jn.joining}_isLeaving(){return this.state===jn.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const a=e.toLocaleLowerCase(),i={type:a,filter:n,callback:r};return this.bindings[a]?this.bindings[a].push(i):this.bindings[a]=[i],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(a=>{var i;return!(((i=a.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&ms.isEqual(a.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}static isFilterValueEqual(e,n){return(e??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ei.close,{},e)}_onError(e){this._on(ei.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=jn.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=Ch(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=Ch(e.columns,e.old_record)),n}}const Gc=()=>{},dl={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},D0=[1e3,2e3,5e3,1e4],j0=1e4,B0=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class M0{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Bu,this.transport=null,this.heartbeatIntervalMs=dl.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Gc,this.ref=0,this.reconnectTimer=null,this.vsn=Lh,this.logger=Gc,this.conn=null,this.sendBuffer=[],this.serializer=new C0,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=a=>a?(...i)=>a(...i):(...i)=>fetch(...i),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${Mu.websocket}`,this.httpEndpoint=Zp(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=S0.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case sa.connecting:return Oa.Connecting;case sa.open:return Oa.Open;case sa.closing:return Oa.Closing;default:return Oa.Closed}}isConnected(){return this.connectionState()===Oa.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,a=this.getChannels().find(i=>i.topic===r);if(a)return a;{const i=new ms(`realtime:${e}`,n,this);return this.channels.push(i),i}}push(e){const{topic:n,event:r,payload:a,ref:i}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${n} ${r} (${i})`,a),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(E0,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},dl.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply"&&n.ref&&n.ref===this.pendingHeartbeatRef){const d=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error",d)}catch(h){this.log("error","error in heartbeat callback",h)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:r,event:a,payload:i,ref:o}=n,l=o?`(${o})`:"",c=i.status||"";this.log("receive",`${c} ${r} ${a} ${l}`.trim(),i),this.channels.filter(d=>d._isMember(r)).forEach(d=>d._trigger(a,i,o)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===sa.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===sa.open||this.conn.readyState===sa.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(n){this.log("error","error in heartbeat callback",n)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(ei.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",a=new URLSearchParams(n);return`${e}${r}${a}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([B0],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n,r=!1;if(e)n=e,r=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(a){this.log("error","Error fetching access token from callback",a),n=this.accessTokenValue}else n=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(a=>{const i={access_token:n,version:k0};n&&a.updateJoinPayload(i),a.joinedOnce&&a._isJoined()&&a._push(ei.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(a){this.log("error",`error in ${e} callback`,a)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Yp(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},dl.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,a,i,o,l,c,d,h,m,b,p;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:Bu,this.heartbeatIntervalMs=(a=e==null?void 0:e.heartbeatIntervalMs)!==null&&a!==void 0?a:dl.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=e==null?void 0:e.heartbeatCallback)!==null&&l!==void 0?l:Gc,this.vsn=(c=e==null?void 0:e.vsn)!==null&&c!==void 0?c:Lh,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(d=e==null?void 0:e.reconnectAfterMs)!==null&&d!==void 0?d:(_=>D0[_-1]||j0),this.vsn){case N0:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:((_,w)=>w(JSON.stringify(_))),this.decode=(m=e==null?void 0:e.decode)!==null&&m!==void 0?m:((_,w)=>w(JSON.parse(_)));break;case Jp:this.encode=(b=e==null?void 0:e.encode)!==null&&b!==void 0?b:this.serializer.encode.bind(this.serializer),this.decode=(p=e==null?void 0:e.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var _o=class extends Error{constructor(t,e){var n;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((n=e.icebergType)==null?void 0:n.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function U0(t,e,n){const r=new URL(e,t);if(n)for(const[a,i]of Object.entries(n))i!==void 0&&r.searchParams.set(a,i);return r.toString()}async function $0(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function q0(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:r,query:a,body:i,headers:o}){const l=U0(t.baseUrl,r,a),c=await $0(t.auth),d=await e(l,{method:n,headers:{...i?{"Content-Type":"application/json"}:{},...c,...o},body:i?JSON.stringify(i):void 0}),h=await d.text(),m=(d.headers.get("content-type")||"").includes("application/json"),b=m&&h?JSON.parse(h):h;if(!d.ok){const p=m?b:void 0,_=p==null?void 0:p.error;throw new _o((_==null?void 0:_.message)??`Request failed with status ${d.status}`,{status:d.status,icebergType:_==null?void 0:_.type,icebergCode:_==null?void 0:_.code,details:p})}return{status:d.status,headers:d.headers,data:b}}}}function hl(t){return t.join("")}var z0=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:hl(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${hl(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${hl(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${hl(t.namespace)}`}),!0}catch(e){if(e instanceof _o&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof _o&&n.status===409)return;throw n}}};function ns(t){return t.join("")}var H0=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ns(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ns(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ns(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ns(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ns(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ns(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof _o&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof _o&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},W0=class{constructor(t){var r;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=q0({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(r=t.accessDelegation)==null?void 0:r.join(","),this.namespaceOps=new z0(this.client,e),this.tableOps=new H0(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},nc=class extends Error{constructor(t,e="storage",n,r){super(t),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=n,this.statusCode=r}};function rc(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var fl=class extends nc{constructor(t,e,n,r="storage"){super(t,r,e,n),this.name=r==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Qp=class extends nc{constructor(t,e,n="storage"){super(t,n),this.name=n==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const G0=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),V0=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},$u=t=>{if(Array.isArray(t))return t.map(n=>$u(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const a=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[a]=$u(r)}),e},K0=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function wo(t){"@babel/helpers - typeof";return wo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wo(t)}function J0(t,e){if(wo(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(wo(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Y0(t){var e=J0(t,"string");return wo(e)=="symbol"?e:e+""}function X0(t,e,n){return(e=Y0(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ih(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function ot(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ih(Object(n),!0).forEach(function(r){X0(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ih(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const Oh=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},Z0=async(t,e,n,r)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const a=t,i=a.status||500;if(typeof a.json=="function")a.json().then(o=>{const l=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||i+"";e(new fl(Oh(o),i,l,r))}).catch(()=>{if(r==="vectors"){const o=i+"";e(new fl(a.statusText||`HTTP ${i} error`,i,o,r))}else{const o=i+"";e(new fl(a.statusText||`HTTP ${i} error`,i,o,r))}});else{const o=i+"";e(new fl(a.statusText||`HTTP ${i} error`,i,o,r))}}else e(new Qp(Oh(t),t,r))},Q0=(t,e,n,r)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||t==="HEAD"||!r?ot(ot({},a),n):(V0(r)?(a.headers=ot({"Content-Type":"application/json"},e==null?void 0:e.headers),a.body=JSON.stringify(r)):a.body=r,e!=null&&e.duplex&&(a.duplex=e.duplex),ot(ot({},a),n))};async function Qs(t,e,n,r,a,i,o){return new Promise((l,c)=>{t(n,Q0(e,r,a,i)).then(d=>{if(!d.ok)throw d;if(r!=null&&r.noResolveJson)return d;if(o==="vectors"){const h=d.headers.get("content-type");if(d.headers.get("content-length")==="0"||d.status===204)return{};if(!h||!h.includes("application/json"))return{}}return d.json()}).then(d=>l(d)).catch(d=>Z0(d,c,r,o))})}function eg(t="storage"){return{get:async(e,n,r,a)=>Qs(e,"GET",n,r,a,void 0,t),post:async(e,n,r,a,i)=>Qs(e,"POST",n,a,i,r,t),put:async(e,n,r,a,i)=>Qs(e,"PUT",n,a,i,r,t),head:async(e,n,r,a)=>Qs(e,"HEAD",n,ot(ot({},r),{},{noResolveJson:!0}),a,void 0,t),remove:async(e,n,r,a,i)=>Qs(e,"DELETE",n,a,i,r,t)}}const e1=eg("storage"),{get:xo,post:Qr,put:qu,head:t1,remove:gd}=e1,Lr=eg("vectors");var Ns=class{constructor(t,e={},n,r="storage"){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.fetch=G0(n),this.namespace=r}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=ot(ot({},this.headers),{},{[t]:e}),this}async handleOperation(t){var e=this;try{return{data:await t(),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(rc(n))return{data:null,error:n};throw n}}},n1=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(rc(e))return{data:null,error:e};throw e}}};let tg;tg=Symbol.toStringTag;var r1=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[tg]="BlobDownloadBuilder",this.promise=null}asStream(){return new n1(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(rc(e))return{data:null,error:e};throw e}}};const i1={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Rh={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var a1=class extends Ns{constructor(t,e={},n,r){super(t,e,r,"storage"),this.bucketId=n}async uploadOrUpdate(t,e,n,r){var a=this;return a.handleOperation(async()=>{let i;const o=ot(ot({},Rh),r);let l=ot(ot({},a.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",a.encodeMetadata(c)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),c&&!i.has("metadata")&&i.append("metadata",a.encodeMetadata(c))):(i=n,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=a.toBase64(a.encodeMetadata(c))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),r!=null&&r.headers&&(l=ot(ot({},l),r.headers));const d=a._removeEmptyFolders(e),h=a._getFinalPath(d),m=await(t=="PUT"?qu:Qr)(a.fetch,`${a.url}/object/${h}`,i,ot({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{path:d,id:m.Id,fullPath:m.Key}})}async upload(t,e,n){return this.uploadOrUpdate("POST",t,e,n)}async uploadToSignedUrl(t,e,n,r){var a=this;const i=a._removeEmptyFolders(t),o=a._getFinalPath(i),l=new URL(a.url+`/object/upload/sign/${o}`);return l.searchParams.set("token",e),a.handleOperation(async()=>{let c;const d=ot({upsert:Rh.upsert},r),h=ot(ot({},a.headers),{"x-upsert":String(d.upsert)});return typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",d.cacheControl)):(c=n,h["cache-control"]=`max-age=${d.cacheControl}`,h["content-type"]=d.contentType),{path:i,fullPath:(await qu(a.fetch,l.toString(),c,{headers:h})).Key}})}async createSignedUploadUrl(t,e){var n=this;return n.handleOperation(async()=>{let r=n._getFinalPath(t);const a=ot({},n.headers);e!=null&&e.upsert&&(a["x-upsert"]="true");const i=await Qr(n.fetch,`${n.url}/object/upload/sign/${r}`,{},{headers:a}),o=new URL(n.url+i.url),l=o.searchParams.get("token");if(!l)throw new nc("No token returned by API");return{signedUrl:o.toString(),path:t,token:l}})}async update(t,e,n){return this.uploadOrUpdate("PUT",t,e,n)}async move(t,e,n){var r=this;return r.handleOperation(async()=>await Qr(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers}))}async copy(t,e,n){var r=this;return r.handleOperation(async()=>({path:(await Qr(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n==null?void 0:n.destinationBucket},{headers:r.headers})).Key}))}async createSignedUrl(t,e,n){var r=this;return r.handleOperation(async()=>{let a=r._getFinalPath(t),i=await Qr(r.fetch,`${r.url}/object/sign/${a}`,ot({expiresIn:e},n!=null&&n.transform?{transform:n.transform}:{}),{headers:r.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{signedUrl:encodeURI(`${r.url}${i.signedURL}${o}`)}})}async createSignedUrls(t,e,n){var r=this;return r.handleOperation(async()=>{const a=await Qr(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:e,paths:t},{headers:r.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return a.map(o=>ot(ot({},o),{},{signedUrl:o.signedURL?encodeURI(`${r.url}${o.signedURL}${i}`):null}))})}download(t,e,n){const r=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),i=a?`?${a}`:"",o=this._getFinalPath(t),l=()=>xo(this.fetch,`${this.url}/${r}/${o}${i}`,{headers:this.headers,noResolveJson:!0},n);return new r1(l,this.shouldThrowOnError)}async info(t){var e=this;const n=e._getFinalPath(t);return e.handleOperation(async()=>$u(await xo(e.fetch,`${e.url}/object/info/${n}`,{headers:e.headers})))}async exists(t){var e=this;const n=e._getFinalPath(t);try{return await t1(e.fetch,`${e.url}/object/${n}`,{headers:e.headers}),{data:!0,error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(rc(r)&&r instanceof Qp){const a=r.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:r}}throw r}}getPublicUrl(t,e){const n=this._getFinalPath(t),r=[],a=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";a!==""&&r.push(a);const i=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});o!==""&&r.push(o);let l=r.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${l}`)}}}async remove(t){var e=this;return e.handleOperation(async()=>await gd(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}))}async list(t,e,n){var r=this;return r.handleOperation(async()=>{const a=ot(ot(ot({},i1),e),{},{prefix:t||""});return await Qr(r.fetch,`${r.url}/object/list/${r.bucketId}`,a,{headers:r.headers},n)})}async listV2(t,e){var n=this;return n.handleOperation(async()=>{const r=ot({},t);return await Qr(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,r,{headers:n.headers},e)})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const s1="2.97.0",To={"X-Client-Info":`storage-js/${s1}`};var o1=class extends Ns{constructor(t,e={},n,r){const a=new URL(t);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase."));const i=a.href.replace(/\/$/,""),o=ot(ot({},To),e);super(i,o,n,"storage")}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const n=e.listBucketOptionsToQueryString(t);return await xo(e.fetch,`${e.url}/bucket${n}`,{headers:e.headers})})}async getBucket(t){var e=this;return e.handleOperation(async()=>await xo(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}))}async createBucket(t,e={public:!1}){var n=this;return n.handleOperation(async()=>await Qr(n.fetch,`${n.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}))}async updateBucket(t,e){var n=this;return n.handleOperation(async()=>await qu(n.fetch,`${n.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}))}async emptyBucket(t){var e=this;return e.handleOperation(async()=>await Qr(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await gd(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},l1=class extends Ns{constructor(t,e={},n){const r=t.replace(/\/$/,""),a=ot(ot({},To),e);super(r,a,n,"storage")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Qr(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}))}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const n=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&n.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&n.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&n.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&n.set("sortOrder",t.sortOrder),t!=null&&t.search&&n.set("search",t.search);const r=n.toString(),a=r?`${e.url}/bucket?${r}`:`${e.url}/bucket`;return await xo(e.fetch,a,{headers:e.headers})})}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await gd(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}from(t){var e=this;if(!K0(t))throw new nc("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new W0({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(a,i){const o=a[i];return typeof o!="function"?o:async(...l)=>{try{return{data:await o.apply(a,l),error:null}}catch(c){if(r)throw c;return{data:null,error:c}}}}})}},c1=class extends Ns{constructor(t,e={},n){const r=t.replace(/\/$/,""),a=ot(ot({},To),{},{"Content-Type":"application/json"},e);super(r,a,n,"vectors")}async createIndex(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{})}async getIndex(t,e){var n=this;return n.handleOperation(async()=>await Lr.post(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers}))}async listIndexes(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}))}async deleteIndex(t,e){var n=this;return n.handleOperation(async()=>await Lr.post(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers})||{})}},u1=class extends Ns{constructor(t,e={},n){const r=t.replace(/\/$/,""),a=ot(ot({},To),{},{"Content-Type":"application/json"},e);super(r,a,n,"vectors")}async putVectors(t){var e=this;if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{})}async getVectors(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}))}async listVectors(t){var e=this;if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}))}async queryVectors(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}))}async deleteVectors(t){var e=this;if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{})}},d1=class extends Ns{constructor(t,e={},n){const r=t.replace(/\/$/,""),a=ot(ot({},To),{},{"Content-Type":"application/json"},e);super(r,a,n,"vectors")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}async getBucket(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}))}async listBuckets(t={}){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await Lr.post(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}},h1=class extends d1{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new f1(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,n=this;return e().call(n,t)}async getBucket(t){var e=()=>super.getBucket,n=this;return e().call(n,t)}async listBuckets(t={}){var e=()=>super.listBuckets,n=this;return e().call(n,t)}async deleteBucket(t){var e=()=>super.deleteBucket,n=this;return e().call(n,t)}},f1=class extends c1{constructor(t,e,n,r){super(t,e,r),this.vectorBucketName=n}async createIndex(t){var e=()=>super.createIndex,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,n=this;return e().call(n,n.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,n=this;return e().call(n,n.vectorBucketName,t)}index(t){return new p1(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},p1=class extends u1{constructor(t,e,n,r,a){super(t,e,a),this.vectorBucketName=n,this.indexName=r}async putVectors(t){var e=()=>super.putVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(t){var e=()=>super.getVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,n=this;return e().call(n,ot(ot({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},g1=class extends o1{constructor(t,e={},n,r){super(t,e,n,r)}from(t){return new a1(this.url,this.headers,t,this.fetch)}get vectors(){return new h1(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new l1(this.url+"/iceberg",this.headers,this.fetch)}};const ng="2.97.0",hs=30*1e3,zu=3,Vc=zu*hs,m1="http://localhost:9999",v1="supabase.auth.token",b1={"X-Client-Info":`gotrue-js/${ng}`},Hu="X-Supabase-Api-Version",rg={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},y1=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,_1=600*1e3;class So extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function Ye(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class w1 extends So{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function x1(t){return Ye(t)&&t.name==="AuthApiError"}class Ra extends So{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class Ui extends So{constructor(e,n,r,a){super(e,r,a),this.name=n,this.status=r}}class Nr extends Ui{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Kc(t){return Ye(t)&&t.name==="AuthSessionMissingError"}class rs extends Ui{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class pl extends Ui{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class gl extends Ui{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function S1(t){return Ye(t)&&t.name==="AuthImplicitGrantRedirectError"}class Fh extends Ui{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class A1 extends Ui{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Wu extends Ui{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function Jc(t){return Ye(t)&&t.name==="AuthRetryableFetchError"}class Dh extends Ui{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Gu extends Ui{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const zl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),jh=` 	
\r=`.split(""),k1=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<jh.length;e+=1)t[jh[e].charCodeAt(0)]=-2;for(let e=0;e<zl.length;e+=1)t[zl[e].charCodeAt(0)]=e;return t})();function Bh(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(zl[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(zl[r]),e.queuedBits-=6}}function ig(t,e,n){const r=k1[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Mh(t){const e=[],n=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=o=>{L1(o,r,n)};for(let o=0;o<t.length;o+=1)ig(t.charCodeAt(o),a,i);return e.join("")}function N1(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function E1(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const a=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|a)+65536,n+=1}N1(r,e)}}function L1(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if((t>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function bs(t){const e=[],n={queue:0,queuedBits:0},r=a=>{e.push(a)};for(let a=0;a<t.length;a+=1)ig(t.charCodeAt(a),n,r);return new Uint8Array(e)}function C1(t){const e=[];return E1(t,n=>e.push(n)),new Uint8Array(e)}function Da(t){const e=[],n={queue:0,queuedBits:0},r=a=>{e.push(a)};return t.forEach(a=>Bh(a,n,r)),Bh(null,n,r),e.join("")}function T1(t){return Math.round(Date.now()/1e3)+t}function P1(){return Symbol("auth-callback")}const Wn=()=>typeof window<"u"&&typeof document<"u",Ea={tested:!1,writable:!1},ag=()=>{if(!Wn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ea.tested)return Ea.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Ea.tested=!0,Ea.writable=!0}catch{Ea.tested=!0,Ea.writable=!1}return Ea.writable};function I1(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((a,i)=>{e[i]=a})}catch{}return n.searchParams.forEach((r,a)=>{e[a]=r}),e}const sg=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),O1=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",fs=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},La=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Hn=async(t,e)=>{await t.removeItem(e)};class ic{constructor(){this.promise=new ic.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}ic.promiseConstructor=Promise;function ml(t){const e=t.split(".");if(e.length!==3)throw new Gu("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!y1.test(e[r]))throw new Gu("JWT not in base64url format");return{header:JSON.parse(Mh(e[0])),payload:JSON.parse(Mh(e[1])),signature:bs(e[2]),raw:{header:e[0],payload:e[1]}}}async function R1(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function F1(t,e){return new Promise((r,a)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await t(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){a(o);return}}})()})}function D1(t){return("0"+t.toString(16)).substr(-2)}function j1(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let a="";for(let i=0;i<56;i++)a+=n.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(e),Array.from(e,D1).join("")}async function B1(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),a=new Uint8Array(r);return Array.from(a).map(i=>String.fromCharCode(i)).join("")}async function M1(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await B1(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function is(t,e,n=!1){const r=j1();let a=r;n&&(a+="/PASSWORD_RECOVERY"),await fs(t,`${e}-code-verifier`,a);const i=await M1(r);return[i,r===i?"plain":"s256"]}const U1=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function $1(t){const e=t.headers.get(Hu);if(!e||!e.match(U1))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function q1(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function z1(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const H1=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function as(t){if(!H1.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Yc(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function W1(t,e){return new Proxy(t,{get:(n,r,a)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,a)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,a)}})}function Uh(t){return JSON.parse(JSON.stringify(t))}const Ta=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),G1=[502,503,504];async function $h(t){var e;if(!O1(t))throw new Wu(Ta(t),0);if(G1.includes(t.status))throw new Wu(Ta(t),t.status);let n;try{n=await t.json()}catch(i){throw new Ra(Ta(i),i)}let r;const a=$1(t);if(a&&a.getTime()>=rg["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new Dh(Ta(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Nr}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Dh(Ta(n),t.status,n.weak_password.reasons);throw new w1(Ta(n),t.status||500,r)}const V1=(t,e,n,r)=>{const a={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),n))};async function lt(t,e,n,r){var a;const i=Object.assign({},r==null?void 0:r.headers);i[Hu]||(i[Hu]=rg["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(a=r==null?void 0:r.query)!==null&&a!==void 0?a:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await K1(t,e,n+l,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function K1(t,e,n,r,a,i){const o=V1(e,r,a,i);let l;try{l=await t(n,Object.assign({},o))}catch(c){throw console.error(c),new Wu(Ta(c),0)}if(l.ok||await $h(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(c){await $h(c)}}function Yr(t){var e;let n=null;X1(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=T1(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function qh(t){const e=Yr(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function oa(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function J1(t){return{data:t,error:null}}function Y1(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:a,verification_type:i}=t,o=tc(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:n,hashed_token:r,redirect_to:a,verification_type:i},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function zh(t){return t}function X1(t){return t.access_token&&t.refresh_token&&t.expires_in}const Xc=["global","local","others"];class Z1{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=sg(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=Xc[0]){if(Xc.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Xc.join(", ")}`);try{return await lt(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Ye(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await lt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:oa})}catch(r){if(Ye(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=tc(e,["options"]),a=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(a.new_email=r==null?void 0:r.newEmail,delete a.newEmail),await lt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:Y1,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(Ye(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await lt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:oa})}catch(n){if(Ye(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,a,i,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},h=await lt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(a=e==null?void 0:e.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:zh});if(h.error)throw h.error;const m=await h.json(),b=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(_=>{const w=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(_.split(";")[1].split("=")[1]);d[`${S}Page`]=w}),d.total=parseInt(b)),{data:Object.assign(Object.assign({},m),d),error:null}}catch(d){if(Ye(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){as(e);try{return await lt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:oa})}catch(n){if(Ye(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){as(e);try{return await lt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:oa})}catch(r){if(Ye(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){as(e);try{return await lt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:oa})}catch(r){if(Ye(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){as(e.userId);try{const{data:n,error:r}=await lt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:n,error:r}}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _deleteFactor(e){as(e.userId),as(e.id);try{return{data:await lt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,a,i,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},h=await lt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(a=e==null?void 0:e.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:zh});if(h.error)throw h.error;const m=await h.json(),b=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(_=>{const w=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(_.split(";")[1].split("=")[1]);d[`${S}Page`]=w}),d.total=parseInt(b)),{data:Object.assign(Object.assign({},m),d),error:null}}catch(d){if(Ye(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(e){try{return await lt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await lt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await lt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ye(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await lt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Ye(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await lt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Ye(n))return{data:null,error:n};throw n}}}function Hh(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const ss={debug:!!(globalThis&&ag()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class og extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Wh extends og{}async function Q1(t,e,n){ss.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;e>0&&setTimeout(()=>{r.abort(),ss.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve();try{return await globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){ss.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,a.name);try{return await n()}finally{ss.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,a.name)}}else{if(e===0)throw ss.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Wh(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(ss.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}})}catch(a){throw(a==null?void 0:a.name)==="AbortError"?new Wh(`Acquiring an exclusive Navigator LockManager lock "${t}" timed out waiting ${e}ms`):a}}function ev(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function lg(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function tv(t){return parseInt(t,16)}function nv(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function rv(t){var e;const{chainId:n,domain:r,expirationTime:a,issuedAt:i=new Date,nonce:o,notBefore:l,requestId:c,resources:d,scheme:h,uri:m,version:b}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!m)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(b!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${b}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const p=lg(t.address),_=h?`${h}://${r}`:r,w=t.statement?`${t.statement}
`:"",S=`${_} wants you to sign in with your Ethereum account:
${p}

${w}`;let x=`URI: ${m}
Version: ${b}
Chain ID: ${n}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(a&&(x+=`
Expiration Time: ${a.toISOString()}`),l&&(x+=`
Not Before: ${l.toISOString()}`),c&&(x+=`
Request ID: ${c}`),d){let T=`
Resources:`;for(const O of d){if(!O||typeof O!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${O}`);T+=`
- ${O}`}x+=T}return`${S}
${x}`}class En extends Error{constructor({message:e,code:n,cause:r,name:a}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=a??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n}}class Hl extends En{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function iv({error:t,options:e}){var n,r,a;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new En({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new En({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new En({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((a=i.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new En({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new En({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new En({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new En({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new En({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(cg(o)){if(i.rp.id!==o)return new En({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new En({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new En({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new En({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new En({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function av({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new En({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new En({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(cg(r)){if(n.rpId!==r)return new En({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new En({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new En({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new En({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class sv{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const ov=new sv;function lv(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,a=tc(t,["challenge","user","excludeCredentials"]),i=bs(e).buffer,o=Object.assign(Object.assign({},n),{id:bs(n.id).buffer}),l=Object.assign(Object.assign({},a),{challenge:i,user:o});if(r&&r.length>0){l.excludeCredentials=new Array(r.length);for(let c=0;c<r.length;c++){const d=r[c];l.excludeCredentials[c]=Object.assign(Object.assign({},d),{id:bs(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return l}function cv(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=tc(t,["challenge","allowCredentials"]),a=bs(e).buffer,i=Object.assign(Object.assign({},r),{challenge:a});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let o=0;o<n.length;o++){const l=n[o];i.allowCredentials[o]=Object.assign(Object.assign({},l),{id:bs(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return i}function uv(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:Da(new Uint8Array(t.response.attestationObject)),clientDataJSON:Da(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function dv(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),a=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Da(new Uint8Array(a.authenticatorData)),clientDataJSON:Da(new Uint8Array(a.clientDataJSON)),signature:Da(new Uint8Array(a.signature)),userHandle:a.userHandle?Da(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function cg(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function Gh(){var t,e;return!!(Wn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function hv(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Hl("Browser returned unexpected credential type",e)}:{data:null,error:new Hl("Empty credential response",e)}}catch(e){return{data:null,error:iv({error:e,options:t})}}}async function fv(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Hl("Browser returned unexpected credential type",e)}:{data:null,error:new Hl("Empty credential response",e)}}catch(e){return{data:null,error:av({error:e,options:t})}}}const pv={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},gv={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Wl(...t){const e=a=>a!==null&&typeof a=="object"&&!Array.isArray(a),n=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),r={};for(const a of t)if(a)for(const i in a){const o=a[i];if(o!==void 0)if(Array.isArray(o))r[i]=o;else if(n(o))r[i]=o;else if(e(o)){const l=r[i];e(l)?r[i]=Wl(l,o):r[i]=Wl(o)}else r[i]=o}return r}function mv(t,e){return Wl(pv,t,e||{})}function vv(t,e){return Wl(gv,t,e||{})}class bv{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:a},i){var o;try{const{data:l,error:c}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!l)return{data:null,error:c};const d=a??ov.createNewAbortSignal();if(l.webauthn.type==="create"){const{user:h}=l.webauthn.credential_options.publicKey;if(!h.name){const m=r;if(m)h.name=`${h.id}:${m}`;else{const p=(await this.client.getUser()).data.user,_=((o=p==null?void 0:p.user_metadata)===null||o===void 0?void 0:o.name)||(p==null?void 0:p.email)||(p==null?void 0:p.id)||"User";h.name=`${h.id}:${_}`}}h.displayName||(h.displayName=h.name)}switch(l.webauthn.type){case"create":{const h=mv(l.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:m,error:b}=await hv({publicKey:h,signal:d});return m?{data:{factorId:e,challengeId:l.id,webauthn:{type:l.webauthn.type,credential_response:m}},error:null}:{data:null,error:b}}case"request":{const h=vv(l.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:m,error:b}=await fv(Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:h,signal:d}));return m?{data:{factorId:e,challengeId:l.id,webauthn:{type:l.webauthn.type,credential_response:m}},error:null}:{data:null,error:b}}}}catch(l){return Ye(l)?{data:null,error:l}:{data:null,error:new Ra("Unexpected error in challenge",l)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},i){if(!n)return{data:null,error:new So("rpId is required for WebAuthn authentication")};try{if(!Gh())return{data:null,error:new Ra("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:a},{request:i});if(!o)return{data:null,error:l};const{webauthn:c}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:c.type,rpId:n,rpOrigins:r,credential_response:c.credential_response}})}catch(o){return Ye(o)?{data:null,error:o}:{data:null,error:new Ra("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},i){if(!n)return{data:null,error:new So("rpId is required for WebAuthn registration")};try{if(!Gh())return{data:null,error:new Ra("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(h=>{var m;return(m=h.data)===null||m===void 0?void 0:m.all.find(b=>b.factor_type==="webauthn"&&b.friendly_name===e&&b.status!=="unverified")}).then(h=>h?this.client.mfa.unenroll({factorId:h==null?void 0:h.id}):void 0),{data:null,error:l};const{data:c,error:d}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:a},{create:i});return c?this._verify({factorId:o.id,challengeId:c.challengeId,webauthn:{rpId:n,rpOrigins:r,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:d}}catch(o){return Ye(o)?{data:null,error:o}:{data:null,error:new Ra("Unexpected error in register",o)}}}}ev();const yv={url:m1,storageKey:v1,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:b1,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function Vh(t,e,n){return await n()}const os={};class Ao{get jwks(){var e,n;return(n=(e=os[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){os[this.storageKey]=Object.assign(Object.assign({},os[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=os[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){os[this.storageKey]=Object.assign(Object.assign({},os[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},yv),e);if(this.storageKey=i.storageKey,this.instanceID=(n=Ao.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,Ao.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&Wn()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Z1({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=sg(i.fetch),this.lock=i.lock||Vh,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,this.lockAcquireTimeout=i.lockAcquireTimeout,i.lock?this.lock=i.lock:this.persistSession&&Wn()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=Q1:this.lock=Vh,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new bv(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:ag()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Hh(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Hh(this.memoryStorage)),Wn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o);try{await this._notifyAllSubscribers(o.data.event,o.data.session,!1)}catch(l){this._debug("#broadcastChannel","error",l)}})}i.skipAutoInitialize||this.initialize().catch(o=>{this._debug("#initialize()","error",o)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${ng}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(Wn()&&(n=I1(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),Wn()&&this.detectSessionInUrl&&r!=="none"){const{data:a,error:i}=await this._getSessionFromURL(n,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),S1(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return{error:i}}const{session:o,redirectType:l}=a;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Ye(n)?this._returnResult({error:n}):this._returnResult({error:new Ra("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,a;try{const i=await lt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=e==null?void 0:e.options)===null||a===void 0?void 0:a.captchaToken}},xform:Yr}),{data:o,error:l}=i;if(l||!o)return this._returnResult({data:{user:null,session:null},error:l});const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(Ye(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var n,r,a;try{let i;if("email"in e){const{email:h,password:m,options:b}=e;let p=null,_=null;this.flowType==="pkce"&&([p,_]=await is(this.storage,this.storageKey)),i=await lt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:b==null?void 0:b.emailRedirectTo,body:{email:h,password:m,data:(n=b==null?void 0:b.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:b==null?void 0:b.captchaToken},code_challenge:p,code_challenge_method:_},xform:Yr})}else if("phone"in e){const{phone:h,password:m,options:b}=e;i=await lt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:m,data:(r=b==null?void 0:b.data)!==null&&r!==void 0?r:{},channel:(a=b==null?void 0:b.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:b==null?void 0:b.captchaToken}},xform:Yr})}else throw new pl("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return await Hn(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:l});const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let n;if("email"in e){const{email:i,password:o,options:l}=e;n=await lt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:qh})}else if("phone"in e){const{phone:i,password:o,options:l}=e;n=await lt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:qh})}else throw new pl("You must provide either an email or phone number and a password");const{data:r,error:a}=n;if(a)return this._returnResult({data:{user:null,session:null},error:a});if(!r||!r.session||!r.user){const i=new rs;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(n){if(Ye(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,a,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,a,i,o,l,c,d,h,m,b;let p,_;if("message"in e)p=e.message,_=e.signature;else{const{chain:w,wallet:S,statement:x,options:T}=e;let O;if(Wn())if(typeof S=="object")O=S;else{const F=window;if("ethereum"in F&&typeof F.ethereum=="object"&&"request"in F.ethereum&&typeof F.ethereum.request=="function")O=F.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!(T!=null&&T.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");O=S}const L=new URL((n=T==null?void 0:T.url)!==null&&n!==void 0?n:window.location.href),K=await O.request({method:"eth_requestAccounts"}).then(F=>F).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!K||K.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const te=lg(K[0]);let V=(r=T==null?void 0:T.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!V){const F=await O.request({method:"eth_chainId"});V=tv(F)}const q={domain:L.host,address:te,statement:x,uri:L.href,version:"1",chainId:V,nonce:(a=T==null?void 0:T.signInWithEthereum)===null||a===void 0?void 0:a.nonce,issuedAt:(o=(i=T==null?void 0:T.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(l=T==null?void 0:T.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=T==null?void 0:T.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=T==null?void 0:T.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(h=T==null?void 0:T.signInWithEthereum)===null||h===void 0?void 0:h.resources};p=rv(q),_=await O.request({method:"personal_sign",params:[nv(p),te]})}try{const{data:w,error:S}=await lt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:_},!((m=e.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(b=e.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:Yr});if(S)throw S;if(!w||!w.session||!w.user){const x=new rs;return this._returnResult({data:{user:null,session:null},error:x})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:S})}catch(w){if(Ye(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async signInWithSolana(e){var n,r,a,i,o,l,c,d,h,m,b,p;let _,w;if("message"in e)_=e.message,w=e.signature;else{const{chain:S,wallet:x,statement:T,options:O}=e;let L;if(Wn())if(typeof x=="object")L=x;else{const te=window;if("solana"in te&&typeof te.solana=="object"&&("signIn"in te.solana&&typeof te.solana.signIn=="function"||"signMessage"in te.solana&&typeof te.solana.signMessage=="function"))L=te.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof x!="object"||!(O!=null&&O.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");L=x}const K=new URL((n=O==null?void 0:O.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in L&&L.signIn){const te=await L.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},O==null?void 0:O.signInWithSolana),{version:"1",domain:K.host,uri:K.href}),T?{statement:T}:null));let V;if(Array.isArray(te)&&te[0]&&typeof te[0]=="object")V=te[0];else if(te&&typeof te=="object"&&"signedMessage"in te&&"signature"in te)V=te;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in V&&"signature"in V&&(typeof V.signedMessage=="string"||V.signedMessage instanceof Uint8Array)&&V.signature instanceof Uint8Array)_=typeof V.signedMessage=="string"?V.signedMessage:new TextDecoder().decode(V.signedMessage),w=V.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in L)||typeof L.signMessage!="function"||!("publicKey"in L)||typeof L!="object"||!L.publicKey||!("toBase58"in L.publicKey)||typeof L.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");_=[`${K.host} wants you to sign in with your Solana account:`,L.publicKey.toBase58(),...T?["",T,""]:[""],"Version: 1",`URI: ${K.href}`,`Issued At: ${(a=(r=O==null?void 0:O.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((i=O==null?void 0:O.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${O.signInWithSolana.notBefore}`]:[],...!((o=O==null?void 0:O.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${O.signInWithSolana.expirationTime}`]:[],...!((l=O==null?void 0:O.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${O.signInWithSolana.chainId}`]:[],...!((c=O==null?void 0:O.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${O.signInWithSolana.nonce}`]:[],...!((d=O==null?void 0:O.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${O.signInWithSolana.requestId}`]:[],...!((m=(h=O==null?void 0:O.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||m===void 0)&&m.length?["Resources",...O.signInWithSolana.resources.map(V=>`- ${V}`)]:[]].join(`
`);const te=await L.signMessage(new TextEncoder().encode(_),"utf8");if(!te||!(te instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");w=te}}try{const{data:S,error:x}=await lt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:_,signature:Da(w)},!((b=e.options)===null||b===void 0)&&b.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Yr});if(x)throw x;if(!S||!S.session||!S.user){const T=new rs;return this._returnResult({data:{user:null,session:null},error:T})}return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),this._returnResult({data:Object.assign({},S),error:x})}catch(S){if(Ye(S))return this._returnResult({data:{user:null,session:null},error:S});throw S}}async _exchangeCodeForSession(e){const n=await La(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(n??"").split("/");try{if(!r&&this.flowType==="pkce")throw new A1;const{data:i,error:o}=await lt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Yr});if(await Hn(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const l=new rs;return this._returnResult({data:{user:null,session:null,redirectType:null},error:l})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:a??null}),error:o})}catch(i){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:n,provider:r,token:a,access_token:i,nonce:o}=e,l=await lt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Yr}),{data:c,error:d}=l;if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!c||!c.session||!c.user){const h=new rs;return this._returnResult({data:{user:null,session:null},error:h})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:d})}catch(n){if(Ye(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,a,i,o;try{if("email"in e){const{email:l,options:c}=e;let d=null,h=null;this.flowType==="pkce"&&([d,h]=await is(this.storage,this.storageKey));const{error:m}=await lt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:h},redirectTo:c==null?void 0:c.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:m})}if("phone"in e){const{phone:l,options:c}=e,{data:d,error:h}=await lt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(a=c==null?void 0:c.data)!==null&&a!==void 0?a:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:h})}throw new pl("You must provide either an email or phone number.")}catch(l){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async verifyOtp(e){var n,r;try{let a,i;"options"in e&&(a=(n=e.options)===null||n===void 0?void 0:n.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:l}=await lt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:a,xform:Yr});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,d=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(a){if(Ye(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSSO(e){var n,r,a,i,o;try{let l=null,c=null;this.flowType==="pkce"&&([l,c]=await is(this.storage,this.storageKey));const d=await lt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=e==null?void 0:e.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:c}),headers:this.headers,xform:J1});return!((i=d.data)===null||i===void 0)&&i.url&&Wn()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(d.data.url),this._returnResult(d)}catch(l){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(l))return this._returnResult({data:null,error:l});throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Nr;const{error:a}=await lt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:a})})}catch(e){if(Ye(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:a,options:i}=e,{error:o}=await lt(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:r,type:a,options:i}=e,{data:o,error:l}=await lt(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l})}throw new pl("You must provide either an email or phone number and a type")}catch(n){if(Ye(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await La(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Vc:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await La(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=Yc()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=W1(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:a,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:a},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const n=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(e){try{return e?await lt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:oa}):await this._useSession(async n=>{var r,a,i;const{data:o,error:l}=n;if(l)throw l;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Nr}:await lt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(a=o.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0,xform:oa})})}catch(n){if(Ye(n))return Kc(n)&&(await this._removeSession(),await Hn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:a,error:i}=r;if(i)throw i;if(!a.session)throw new Nr;const o=a.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await is(this.storage,this.storageKey));const{data:d,error:h}=await lt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:oa});if(h)throw h;return o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(r){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Nr;const n=Date.now()/1e3;let r=n,a=!0,i=null;const{payload:o}=ml(e.access_token);if(o.exp&&(r=o.exp,a=r<=n),a){const{data:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(n){if(Ye(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:o,error:l}=n;if(l)throw l;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Nr;const{data:a,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):a?this._returnResult({data:{user:a.user,session:a},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Ye(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Wn())throw new gl("No browser detected.");if(e.error||e.error_description||e.error_code)throw new gl(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new Fh("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new gl("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Fh("No code detected.");const{data:T,error:O}=await this._exchangeCodeForSession(e.code);if(O)throw O;const L=new URL(window.location.href);return L.searchParams.delete("code"),window.history.replaceState(window.history.state,"",L.toString()),{data:{session:T.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:a,access_token:i,refresh_token:o,expires_in:l,expires_at:c,token_type:d}=e;if(!i||!l||!o||!d)throw new gl("No session defined in URL");const h=Math.round(Date.now()/1e3),m=parseInt(l);let b=h+m;c&&(b=parseInt(c));const p=b-h;p*1e3<=hs&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${m}s`);const _=b-m;h-_>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",_,b,h):h-_<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",_,b,h);const{data:w,error:S}=await this._getUser(i);if(S)throw S;const x={provider_token:r,provider_refresh_token:a,access_token:i,expires_in:m,expires_at:b,refresh_token:o,token_type:d,user:w.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:x,redirectType:e.type},error:null})}catch(r){if(Ye(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await La(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i&&!Kc(i))return this._returnResult({error:i});const o=(r=a.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(x1(l)&&(l.status===404||l.status===401||l.status===403)||Kc(l)))return this._returnResult({error:l})}return e!=="others"&&(await this._removeSession(),await Hn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=P1(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,a;try{const{data:{session:i},error:o}=n;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,n={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await is(this.storage,this.storageKey,!0));try{return await lt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:a}=await this._useSession(async i=>{var o,l,c,d,h;const{data:m,error:b}=i;if(b)throw b;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await lt(this.fetch,"GET",p,{headers:this.headers,jwt:(h=(d=m.session)===null||d===void 0?void 0:d.access_token)!==null&&h!==void 0?h:void 0})});if(a)throw a;return Wn()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(Ye(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:a,data:{session:i}}=n;if(a)throw a;const{options:o,provider:l,token:c,access_token:d,nonce:h}=e,m=await lt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i==null?void 0:i.access_token)!==null&&r!==void 0?r:void 0,body:{provider:l,id_token:c,access_token:d,nonce:h,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Yr}),{data:b,error:p}=m;return p?this._returnResult({data:{user:null,session:null},error:p}):!b||!b.session||!b.user?this._returnResult({data:{user:null,session:null},error:new rs}):(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("USER_UPDATED",b.session)),this._returnResult({data:b,error:p}))}catch(a){if(await Hn(this.storage,`${this.storageKey}-code-verifier`),Ye(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,a;const{data:i,error:o}=n;if(o)throw o;return await lt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(a=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await F1(async a=>(a>0&&await R1(200*Math.pow(2,a-1)),this._debug(n,"refreshing attempt",a),await lt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Yr})),(a,i)=>{const o=200*Math.pow(2,a);return i&&Jc(i)&&Date.now()+o-r<hs})}catch(r){if(this._debug(n,"error",r),Ye(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Wn()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const a=await La(this.storage,this.storageKey);if(a&&this.userStorage){let o=await La(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:a.user},await fs(this.userStorage,this.storageKey+"-user",o)),a.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:Yc()}else if(a&&!a.user&&!a.user){const o=await La(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(a.user=o.user,await Hn(this.storage,this.storageKey+"-user"),await fs(this.storage,this.storageKey,a)):a.user=Yc()}if(this._debug(r,"session from storage",a),!this._isValidSession(a)){this._debug(r,"session is not valid"),a!==null&&await this._removeSession();return}const i=((n=a.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Vc;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${Vc}s`),i){if(this.autoRefreshToken&&a.refresh_token){const{error:o}=await this._callRefreshToken(a.refresh_token);o&&(console.error(o),Jc(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(a.access_token);!l&&(o!=null&&o.user)?(a.user=o.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(r,"error",a),console.error(a);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Nr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new ic;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Nr;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={data:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(a,"error",i),Ye(i)){const o={data:null,error:i};return Jc(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,n,r=!0){const a=`#_notifyAllSubscribers(${e})`;this._debug(a,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,n)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Hn(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await fs(this.userStorage,this.storageKey+"-user",{user:n.user});const a=Object.assign({},n);delete a.user;const i=Uh(a);await fs(this.storage,this.storageKey,i)}else{const a=Uh(n);await fs(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Hn(this.storage,this.storageKey),await Hn(this.storage,this.storageKey+"-code-verifier"),await Hn(this.storage,this.storageKey+"-user"),this.userStorage&&await Hn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Wn()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),hs);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const n=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const n=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,n&&clearTimeout(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-e)/hs);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${hs}ms, refresh threshold is ${zu} ticks`),a<=zu&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof og)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Wn()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const a=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await is(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});a.push(l.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);a.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${a.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;return i?this._returnResult({data:null,error:i}):await lt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,a;const{data:i,error:o}=n;if(o)return this._returnResult({data:null,error:o});const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:d}=await lt(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return d?this._returnResult({data:null,error:d}):(e.factorType==="totp"&&c.type==="totp"&&(!((a=c==null?void 0:c.totp)===null||a===void 0)&&a.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?uv(e.webauthn.credential_response):dv(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:c}=await lt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:c}))})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i)return this._returnResult({data:null,error:i});const o=await lt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:l}=o;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:lv(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:cv(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const a={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])a.all.push(i),i.status==="verified"&&a[i.factor_type].push(i);return{data:a,error:null}}async _getAuthenticatorAssuranceLevel(e){var n,r,a,i;if(e)try{const{payload:p}=ml(e);let _=null;p.aal&&(_=p.aal);let w=_;const{data:{user:S},error:x}=await this.getUser(e);if(x)return this._returnResult({data:null,error:x});((r=(n=S==null?void 0:S.factors)===null||n===void 0?void 0:n.filter(L=>L.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(w="aal2");const O=p.amr||[];return{data:{currentLevel:_,nextLevel:w,currentAuthenticationMethods:O},error:null}}catch(p){if(Ye(p))return this._returnResult({data:null,error:p});throw p}const{data:{session:o},error:l}=await this.getSession();if(l)return this._returnResult({data:null,error:l});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:c}=ml(o.access_token);let d=null;c.aal&&(d=c.aal);let h=d;((i=(a=o.user.factors)===null||a===void 0?void 0:a.filter(p=>p.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(h="aal2");const b=c.amr||[];return{data:{currentLevel:d,nextLevel:h,currentAuthenticationMethods:b},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;return a?this._returnResult({data:null,error:a}):r?await lt(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Nr})})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:a},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!a)return this._returnResult({data:null,error:new Nr});const o=await lt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"approve"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&Wn()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Ye(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:a},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!a)return this._returnResult({data:null,error:new Nr});const o=await lt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"deny"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&Wn()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(Ye(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;return r?this._returnResult({data:null,error:r}):n?await lt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new Nr})})}catch(e){if(Ye(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;return a?this._returnResult({data:null,error:a}):r?(await lt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Nr})})}catch(n){if(Ye(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(l=>l.kid===e);if(r)return r;const a=Date.now();if(r=this.jwks.keys.find(l=>l.kid===e),r&&this.jwks_cached_at+_1>a)return r;const{data:i,error:o}=await lt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=a,r=i.keys.find(l=>l.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:p,error:_}=await this.getSession();if(_||!p.session)return this._returnResult({data:null,error:_});r=p.session.access_token}const{header:a,payload:i,signature:o,raw:{header:l,payload:c}}=ml(r);n!=null&&n.allowExpired||q1(i.exp);const d=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!d){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:i,header:a,signature:o},error:null}}const h=z1(a.alg),m=await crypto.subtle.importKey("jwk",d,h,!0,["verify"]);if(!await crypto.subtle.verify(h,m,o,C1(`${l}.${c}`)))throw new Gu("Invalid JWT signature");return{data:{claims:i,header:a,signature:o},error:null}}catch(r){if(Ye(r))return this._returnResult({data:null,error:r});throw r}}}Ao.nextInstanceID={};const _v=Ao,wv="2.97.0";let co="";typeof Deno<"u"?co="deno":typeof document<"u"?co="web":typeof navigator<"u"&&navigator.product==="ReactNative"?co="react-native":co="node";const xv={"X-Client-Info":`supabase-js-${co}/${wv}`},Sv={headers:xv},Av={schema:"public"},kv={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Nv={};function ko(t){"@babel/helpers - typeof";return ko=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ko(t)}function Ev(t,e){if(ko(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(ko(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Lv(t){var e=Ev(t,"string");return ko(e)=="symbol"?e:e+""}function Cv(t,e,n){return(e=Lv(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Kh(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function pn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Kh(Object(n),!0).forEach(function(r){Cv(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Kh(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const Tv=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Pv=()=>Headers,Iv=(t,e,n)=>{const r=Tv(n),a=Pv();return async(i,o)=>{var l;const c=(l=await e())!==null&&l!==void 0?l:t;let d=new a(o==null?void 0:o.headers);return d.has("apikey")||d.set("apikey",t),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),r(i,pn(pn({},o),{},{headers:d}))}};function Ov(t){return t.endsWith("/")?t:t+"/"}function Rv(t,e){var n,r;const{db:a,auth:i,realtime:o,global:l}=t,{db:c,auth:d,realtime:h,global:m}=e,b={db:pn(pn({},c),a),auth:pn(pn({},d),i),realtime:pn(pn({},h),o),storage:{},global:pn(pn(pn({},m),l),{},{headers:pn(pn({},(n=m==null?void 0:m.headers)!==null&&n!==void 0?n:{}),(r=l==null?void 0:l.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?b.accessToken=t.accessToken:delete b.accessToken,b}function Fv(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Ov(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var Dv=class extends _v{constructor(t){super(t)}},jv=class{constructor(t,e,n){var r,a;this.supabaseUrl=t,this.supabaseKey=e;const i=Fv(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,l={db:Av,realtime:Nv,auth:pn(pn({},kv),{},{storageKey:o}),global:Sv},c=Rv(n??{},l);if(this.storageKey=(r=c.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(a=c.global.headers)!==null&&a!==void 0?a:{},c.accessToken)this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(h,m)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(m)} is not possible`)}});else{var d;this.auth=this._initSupabaseAuthClient((d=c.auth)!==null&&d!==void 0?d:{},this.headers,c.global.fetch)}this.fetch=Iv(e,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(pn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new x0(new URL("rest/v1",i).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch,timeout:c.db.timeout,urlLengthLimit:c.db.urlLengthLimit}),this.storage=new g1(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new p0(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,n;if(t.accessToken)return await t.accessToken();const{data:r}=await t.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:a,storageKey:i,flowType:o,lock:l,debug:c,throwOnError:d},h,m){const b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Dv({url:this.authUrl.href,headers:pn(pn({},b),h),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:a,flowType:o,lock:l,debug:c,throwOnError:d,fetch:m,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new M0(this.realtimeUrl.href,pn(pn({},t),{},{params:pn(pn({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(t,e,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Bv=(t,e,n)=>new jv(t,e,n);function Mv(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const e=t.version;if(e==null)return!1;const n=e.match(/^v(\d+)\./);return n?parseInt(n[1],10)<=18:!1}Mv()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Uv="https://ujuxhijcomgkqfwaovow.supabase.co",$v="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdXhoaWpjb21na3Fmd2Fvdm93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3NTg0NzgsImV4cCI6MjA4NzMzNDQ3OH0.pZuqL4HDtt5Z8yFf7tQNe5hTEz_W0_zyIV-lPebV_1Q",Le=Bv(Uv,$v),ug=fd(null);function qv({children:t}){const[e,n]=me(null),[r,a]=me(!0);Mt(()=>{Le.auth.getSession().then(({data:{session:c}})=>{n((c==null?void 0:c.user)??null),a(!1)});const{data:{subscription:l}}=Le.auth.onAuthStateChange((c,d)=>{n((d==null?void 0:d.user)??null)});return()=>l.unsubscribe()},[]);const i=Nt(async(l,c)=>{const{error:d}=await Le.auth.signInWithPassword({email:l,password:c});if(d)throw d},[]),o=Nt(async()=>{await Le.auth.signOut()},[]);return s(ug.Provider,{value:{user:e,loading:r,signIn:i,signOut:o},children:t})}function ac(){const t=Wp(ug);if(!t)throw new Error("useAuth must be used within AuthProvider");return t}const dg=fd(null);function zv({children:t}){const[e,n]=me([]),r=Nt((i,o="info")=>{const l=Date.now();n(c=>[...c,{id:l,message:i,type:o}]),setTimeout(()=>{n(c=>c.filter(d=>d.id!==l))},3e3)},[]),a={success:i=>r(i,"success"),error:i=>r(i,"error"),info:i=>r(i,"info")};return s(dg.Provider,{value:a,children:[t,s("div",{class:"toast-container",children:e.map(i=>s("div",{class:`toast toast-${i.type}`,children:i.message},i.id))})]})}function Qn(){return Wp(dg)}var Hv={};function vl(t,e){for(var n in e)t[n]=e[n];return t}function Wv(t,e,n){var r,a=/(?:\?([^#]*))?(#.*)?$/,i=t.match(a),o={};if(i&&i[1])for(var l=i[1].split("&"),c=0;c<l.length;c++){var d=l[c].split("=");o[decodeURIComponent(d[0])]=decodeURIComponent(d.slice(1).join("="))}t=Vu(t.replace(a,"")),e=Vu(e||"");for(var h=Math.max(t.length,e.length),m=0;m<h;m++)if(e[m]&&e[m].charAt(0)===":"){var b=e[m].replace(/(^:|[+*?]+$)/g,""),p=(e[m].match(/[+*?]+$/)||Hv)[0]||"",_=~p.indexOf("+"),w=~p.indexOf("*"),S=t[m]||"";if(!S&&!w&&(p.indexOf("?")<0||_)){r=!1;break}if(o[b]=decodeURIComponent(S),_||w){o[b]=t.slice(m).map(decodeURIComponent).join("/");break}}else if(e[m]!==t[m]){r=!1;break}return(n.default===!0||r!==!1)&&o}function Gv(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:t.index-e.index}function Vv(t,e){return t.index=e,t.rank=(function(n){return n.props.default?0:Vu(n.props.path).map(Kv).join("")})(t),t.props}function Vu(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function Kv(t){return t.charAt(0)==":"?1+"*+?".indexOf(t.charAt(t.length-1))||4:5}var Jv={},ja=[],Jh=[],Er=null,hg={url:md()},Yv=fd(hg);function md(){var t;return""+((t=Er&&Er.location?Er.location:Er&&Er.getCurrentLocation?Er.getCurrentLocation():typeof location<"u"?location:Jv).pathname||"")+(t.search||"")}function ze(t,e){return e===void 0&&(e=!1),typeof t!="string"&&t.url&&(e=t.replace,t=t.url),(function(n){for(var r=ja.length;r--;)if(ja[r].canRoute(n))return!0;return!1})(t)&&(function(n,r){r===void 0&&(r="push"),Er&&Er[r]?Er[r](n):typeof history<"u"&&history[r+"State"]&&history[r+"State"](null,null,n)})(t,e?"replace":"push"),fg(t)}function fg(t){for(var e=!1,n=0;n<ja.length;n++)ja[n].routeTo(t)&&(e=!0);return e}function Xv(t){if(t&&t.getAttribute){var e=t.getAttribute("href"),n=t.getAttribute("target");if(e&&e.match(/^\//g)&&(!n||n.match(/^_?self$/i)))return ze(e)}}function Zv(t){return t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),!1}function Qv(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button)){var e=t.target;do if(e.localName==="a"&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))return;if(Xv(e))return Zv(t)}while(e=e.parentNode)}}var Yh=!1;function pg(t){t.history&&(Er=t.history),this.state={url:t.url||md()}}vl(pg.prototype=new ho,{shouldComponentUpdate:function(t){return t.static!==!0||t.url!==this.props.url||t.onChange!==this.props.onChange},canRoute:function(t){var e=Ru(this.props.children);return this.g(e,t)!==void 0},routeTo:function(t){this.setState({url:t});var e=this.canRoute(t);return this.p||this.forceUpdate(),e},componentWillMount:function(){this.p=!0},componentDidMount:function(){var t=this;Yh||(Yh=!0,Er||addEventListener("popstate",function(){fg(md())}),addEventListener("click",Qv)),ja.push(this),Er&&(this.u=Er.listen(function(e){var n=e.location||e;t.routeTo(""+(n.pathname||"")+(n.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),ja.splice(ja.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(t,e){t=t.filter(Vv).sort(Gv);for(var n=0;n<t.length;n++){var r=t[n],a=Wv(e,r.props.path,r.props);if(a)return[r,a]}},render:function(t,e){var n,r,a=t.onChange,i=e.url,o=this.c,l=this.g(Ru(t.children),i);if(l&&(r=s0(l[0],vl(vl({url:i,matches:n=l[1]},n),{key:void 0,ref:void 0}))),i!==(o&&o.url)){vl(hg,o=this.c={url:i,previous:o&&o.url,current:r,path:r?r.props.path:null,matches:n}),o.router=this,o.active=r?[r]:[];for(var c=Jh.length;c--;)Jh[c]({});typeof a=="function"&&a(o)}return Dp(Yv.Provider,{value:o},r)}});function e2({children:t}){const{signOut:e}=ac(),[n,r]=me(!1),[a,i]=me(typeof window<"u"?window.location.pathname:"/crm/");Mt(()=>{const c=()=>i(window.location.pathname);return window.addEventListener("popstate",c),()=>window.removeEventListener("popstate",c)},[]);function o(c){r(!1),ze(c),i(c)}return s("div",{class:"app-layout",children:[s("button",{class:"mobile-toggle",onClick:()=>r(!n),"aria-label":"Menu",children:n?"":""}),s("aside",{class:`sidebar ${n?"open":""}`,children:[s("div",{class:"sidebar-brand",onClick:()=>o("/crm/"),style:"cursor:pointer",children:"Beck360 CRM"}),s("nav",{class:"sidebar-nav",children:[{path:"/crm/",label:"Dashboard",icon:""},{path:"/crm/pipeline",label:"Pipeline",icon:""},{path:"/crm/contacts",label:"Kontakte",icon:""},{path:"/crm/companies",label:"Firmen",icon:""},{path:"/crm/invoices",label:"Rechnungen",icon:""},{path:"/crm/expenses",label:"Ausgaben",icon:""},{path:"/crm/reports",label:"Berichte",icon:""},{path:"/crm/campaigns",label:"Kampagnen",icon:""},{path:"/crm/settings",label:"Einstellungen",icon:""}].map(c=>s("a",{class:`nav-item ${(c.path==="/crm/"?a==="/crm/":a.startsWith(c.path))?"active":""}`,href:c.path,onClick:d=>{d.preventDefault(),o(c.path)},children:[s("span",{class:"nav-icon",children:c.icon}),c.label]},c.path))}),s("div",{class:"sidebar-footer",children:s("button",{class:"btn btn-secondary btn-sm",style:"width: 100%",onClick:e,children:"Abmelden"})})]}),n&&s("div",{style:"position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:99",onClick:()=>r(!1)}),s("main",{class:"main-content",children:t})]})}function t2(){const{signIn:t}=ac(),[e,n]=me(""),[r,a]=me(""),[i,o]=me(null),[l,c]=me(!1);async function d(h){h.preventDefault(),o(null),c(!0);try{await t(e,r)}catch(m){o(m.message==="Invalid login credentials"?"Ungueltige Anmeldedaten":m.message)}c(!1)}return s("div",{class:"login-page",children:s("form",{class:"login-card",onSubmit:d,children:[s("div",{class:"login-title",children:"Beck360 CRM"}),s("div",{class:"login-subtitle",children:"Anmelden"}),i&&s("div",{class:"login-error",children:i}),s("div",{class:"form-group",children:[s("label",{for:"login-email",children:"E-Mail"}),s("input",{id:"login-email",type:"email",value:e,onInput:h=>n(h.target.value),required:!0,autocomplete:"email"})]}),s("div",{class:"form-group",children:[s("label",{for:"login-password",children:"Passwort"}),s("input",{id:"login-password",type:"password",value:r,onInput:h=>a(h.target.value),required:!0,autocomplete:"current-password"})]}),s("button",{type:"submit",class:"btn btn-primary",style:"width: 100%; justify-content: center",disabled:l,children:l?"Anmelden...":"Anmelden"})]})})}function n2(){const[t,e]=me({totalContacts:0,newLeadsThisMonth:0,pipelineValue:0,wonDeals:0,conversionRate:0,dealsByStage:{}}),[n,r]=me([]),[a,i]=me(!0),o=Nt(async()=>{i(!0);const l=new Date,c=new Date(l.getFullYear(),l.getMonth(),1).toISOString(),[{count:d},{count:h},{data:m},{data:b},{data:p},{data:_}]=await Promise.all([Le.from("contacts").select("*",{count:"exact",head:!0}).is("deleted_at",null),Le.from("contacts").select("*",{count:"exact",head:!0}).is("deleted_at",null).gte("created_at",c),Le.from("deals").select("value, stage").is("deleted_at",null).not("stage","in",'("won","lost")'),Le.from("deals").select("value").is("deleted_at",null).eq("stage","won"),Le.from("deals").select("stage").is("deleted_at",null),Le.from("activities").select("*").order("created_at",{ascending:!1}).limit(10)]),w=(m||[]).reduce((L,K)=>L+(K.value||0),0),S=(b||[]).length,x=(p||[]).length,T=x>0?Math.round(S/x*100):0,O={};for(const L of p||[])O[L.stage]=(O[L.stage]||0)+1;e({totalContacts:d||0,newLeadsThisMonth:h||0,pipelineValue:w,wonDeals:S,conversionRate:T,dealsByStage:O}),r(_||[]),i(!1)},[]);return Mt(()=>{o()},[o]),{stats:t,recentActivities:n,loading:a,refetch:o}}const ks={invoice:{label:"Rechnung",prefix:"R"},quote:{label:"Angebot",prefix:"A"}},Zn={draft:{label:"Entwurf",color:"#6366f1"},sent:{label:"Versendet",color:"#f59e0b"},paid:{label:"Bezahlt",color:"#10b981"},overdue:{label:"Ueberfaellig",color:"#ef4444"},cancelled:{label:"Storniert",color:"#64748b"}};function Pl(t,e,n){var d;const r=new Date,a=r.getFullYear(),i=String(r.getMonth()+1).padStart(2,"0"),o=String(r.getDate()).padStart(2,"0"),l=((d=ks[t])==null?void 0:d.prefix)||"R",c=Xh(e)||Xh(n)||"XX";return`${l}-${a}-${i}-${o}-${c}`}function Xh(t){if(!t||!t.trim())return"";const e=t.trim(),n=e.split(/\s+/);return n.length>=2?n.map(r=>r[0]).join("").toUpperCase().slice(0,4):e.slice(0,3).toUpperCase()}function r2(t,e=0,n=19){const r=t.reduce((c,d)=>c+(parseFloat(d.quantity)||0)*(parseFloat(d.unit_price)||0),0),a=r*(parseFloat(e)||0)/100,i=r-a,o=i*(parseFloat(n)||0)/100,l=i+o;return{subtotal:eo(r),discount_amount:eo(a),net_amount:eo(i),vat_amount:eo(o),total_amount:eo(l)}}function eo(t){return Math.round(t*100)/100}function vd({type:t=null,status:e=null,companyId:n=null,dealId:r=null}={}){const[a,i]=me([]),[o,l]=me(!0),c=Nt(async()=>{l(!0);let d=Le.from("invoices").select(`
        *,
        company:companies(id, name),
        contact:contacts(id, first_name, last_name)
      `).is("deleted_at",null).order("created_at",{ascending:!1});t&&(d=d.eq("type",t)),e&&(d=d.eq("status",e)),n&&(d=d.eq("company_id",n)),r&&(d=d.eq("deal_id",r));const{data:h,error:m}=await d;m||i(h||[]),l(!1)},[t,e,n,r]);return Mt(()=>{c()},[c]),{invoices:a,loading:o,refetch:c}}function gg(t){const[e,n]=me(null),[r,a]=me([]),[i,o]=me(!0),[l,c]=me(null),d=Nt(async()=>{if(!t)return;o(!0),c(null);const[m,b]=await Promise.all([Le.from("invoices").select(`
          *,
          company:companies(id, name),
          contact:contacts(id, first_name, last_name, email, phone)
        `).eq("id",t).is("deleted_at",null).single(),Le.from("invoice_items").select("*").eq("invoice_id",t).order("position",{ascending:!0})]);m.error&&(console.error("useInvoice fetch error:",m.error),c(m.error)),b.error&&console.error("useInvoice items error:",b.error),n(m.data),a(b.data||[]),o(!1)},[t]);Mt(()=>{d()},[d]);const h=Nt(async m=>{const{error:b}=await Le.from("invoices").update(m).eq("id",t);return b||await d(),{error:b}},[t,d]);return{invoice:e,items:r,loading:i,fetchError:l,refetch:d,update:h}}async function i2(t,e){var d;const{data:n,error:r}=await Le.auth.getUser();if(r||!((d=n==null?void 0:n.user)!=null&&d.id))return{error:{message:"Nicht authentifiziert. Bitte erneut einloggen."}};const a=n.user.id,{data:i,error:o}=await Le.from("invoices").insert({...t,owner_id:a}).select().single();if(o)return{error:o};if(!i)return{error:{message:"Rechnung wurde nicht gespeichert."}};if(e&&e.length>0){const h=e.map((b,p)=>({invoice_id:i.id,position:p+1,description:b.description,sub_description:b.sub_description||null,quantity:parseFloat(b.quantity)||1,unit_price:parseFloat(b.unit_price)||0})),{error:m}=await Le.from("invoice_items").insert(h);if(m)return{data:i,error:m}}const l=t.type==="quote"?"quote_created":"invoice_created",c=t.type==="quote"?"Angebot":"Rechnung";return await Le.from("activities").insert({owner_id:a,deal_id:t.deal_id||null,contact_id:t.contact_id||null,company_id:t.company_id||null,type:l,description:`${c} erstellt: ${t.invoice_number}`,metadata:{invoice_id:i.id,invoice_number:t.invoice_number}}),{data:i,error:null}}async function a2(t,e,n){const{error:r}=await Le.from("invoices").update(e).eq("id",t);if(r)return{error:r};if(await Le.from("invoice_items").delete().eq("invoice_id",t),n&&n.length>0){const a=n.map((o,l)=>({invoice_id:t,position:l+1,description:o.description,sub_description:o.sub_description||null,quantity:parseFloat(o.quantity)||1,unit_price:parseFloat(o.unit_price)||0})),{error:i}=await Le.from("invoice_items").insert(a);if(i)return{error:i}}return{error:null}}async function s2(t){const{data:e}=await Le.auth.getUser(),n=e.user.id,[{data:r},{data:a}]=await Promise.all([Le.from("invoices").select("*").eq("id",t).single(),Le.from("invoice_items").select("*").eq("invoice_id",t).order("position")]);if(!r)return{error:{message:"Angebot nicht gefunden"}};const i=new Date,o=Pl("invoice",r.customer_company,r.customer_name),{id:l,created_at:c,updated_at:d,...h}=r,{data:m,error:b}=await Le.from("invoices").insert({...h,type:"invoice",invoice_number:o,status:"draft",invoice_date:i.toISOString().slice(0,10),due_date:new Date(i.getTime()+14*864e5).toISOString().slice(0,10),converted_from_quote_id:t,paid_date:null,paid_amount:0}).select().single();if(b)return{error:b};if(a&&a.length>0){const p=a.map(_=>({invoice_id:m.id,position:_.position,description:_.description,sub_description:_.sub_description,quantity:_.quantity,unit_price:_.unit_price}));await Le.from("invoice_items").insert(p)}return await Le.from("activities").insert({owner_id:n,deal_id:r.deal_id||null,contact_id:r.contact_id||null,company_id:r.company_id||null,type:"quote_converted",description:`Angebot ${r.invoice_number} in Rechnung ${o} umgewandelt`,metadata:{quote_id:t,invoice_id:m.id}}),{data:m,error:null}}function sc(){const[t,e]=me(null),[n,r]=me(!0),a=Nt(async()=>{r(!0);const{data:o}=await Le.from("business_settings").select("*").limit(1).single();e(o),r(!1)},[]);Mt(()=>{a()},[a]);const i=Nt(async o=>{const{data:l}=await Le.auth.getUser();if(t){const{error:c}=await Le.from("business_settings").update(o).eq("id",t.id);return c||await a(),{error:c}}else{const{error:c}=await Le.from("business_settings").insert({...o,owner_id:l.user.id});return c||await a(),{error:c}}},[t,a]);return{settings:t,loading:n,save:i,refetch:a}}function o2(){const[t,e]=me({openCount:0,openAmount:0,monthRevenue:0}),[n,r]=me(!0),a=Nt(async()=>{r(!0);const i=new Date,o=new Date(i.getFullYear(),i.getMonth(),1).toISOString().slice(0,10),[{data:l},{data:c}]=await Promise.all([Le.from("invoices").select("total_amount").eq("type","invoice").is("deleted_at",null).in("status",["sent","overdue"]),Le.from("invoices").select("total_amount").eq("type","invoice").is("deleted_at",null).eq("status","paid").gte("paid_date",o)]),d=(l||[]).length,h=(l||[]).reduce((b,p)=>b+(parseFloat(p.total_amount)||0),0),m=(c||[]).reduce((b,p)=>b+(parseFloat(p.total_amount)||0),0);e({openCount:d,openAmount:h,monthRevenue:m}),r(!1)},[]);return Mt(()=>{a()},[a]),{stats:t,loading:n}}async function mg(t){const{error:e}=await Le.from("invoices").update({deleted_at:new Date().toISOString()}).eq("id",t);return{error:e}}function bd({contactId:t=null,dealId:e=null,companyId:n=null,limit:r=50}={}){const[a,i]=me([]),[o,l]=me(!0),c=Nt(async()=>{l(!0);let d=Le.from("activities").select("*").order("created_at",{ascending:!1}).limit(r);t&&(d=d.eq("contact_id",t)),e&&(d=d.eq("deal_id",e)),n&&(d=d.eq("company_id",n));const{data:h,error:m}=await d;m||i(h||[]),l(!1)},[t,e,n,r]);return Mt(()=>{c()},[c]),{activities:a,loading:o,refetch:c}}async function Gl(t){const{data:e}=await Le.auth.getUser();return Le.from("activities").insert({...t,owner_id:e.user.id}).select().single()}function l2(){const[t,e]=me([]),[n,r]=me(!0),a=Nt(async()=>{r(!0);const{data:o}=await Le.from("activities").select(`
        *,
        contact:contacts(id, first_name, last_name),
        deal:deals(id, title)
      `).eq("type","task").eq("completed",!1).not("due_date","is",null).order("due_date",{ascending:!0});e(o||[]),r(!1)},[]);Mt(()=>{a()},[a]);const i=Nt(async o=>{const{error:l}=await Le.from("activities").update({completed:!0}).eq("id",o);return l||await a(),{error:l}},[a]);return{tasks:t,loading:n,refetch:a,complete:i}}function Ca({label:t,value:e,color:n}){return s("div",{class:"card",children:[s("div",{class:"kpi-value",style:n?`color: ${n}`:"",children:e}),s("div",{class:"kpi-label",children:t})]})}function Cn(t){return t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):""}function bl(t){return t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function De(t){return t==null?"":new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(t)}function c2(t){if(!t)return"";const e=new Date,n=new Date(t),r=e-n,a=Math.floor(r/6e4),i=Math.floor(r/36e5),o=Math.floor(r/864e5);return a<1?"gerade eben":a<60?`vor ${a} Min.`:i<24?`vor ${i} Std.`:o<7?`vor ${o} Tag${o>1?"en":""}`:Cn(t)}const Mi={new:{label:"Neu",color:"#6366f1"},contacted:{label:"Kontaktiert",color:"#f59e0b"},qualified:{label:"Qualifiziert",color:"#3b82f6"},proposal:{label:"Angebot",color:"#8b5cf6"},won:{label:"Gewonnen",color:"#10b981"},lost:{label:"Verloren",color:"#ef4444"}},Il={"360-tour":"360 Rundgang","drone-photo":"Drohnenfoto","drone-video":"Drohnenvideo","drone-inspection":"PV-Inspektion",streetview:"Google Street View",bundle:"Paket",other:"Sonstiges"},Ba={"360-rundgang":"360-Rundgang",firmenrundgang:"Firmenrundgang",manual:"Manuell",referral:"Empfehlung",other:"Sonstiges"},yd={note:{label:"Notiz",icon:""},call:{label:"Anruf",icon:""},email:{label:"E-Mail",icon:""},meeting:{label:"Treffen",icon:""},form_submission:{label:"Formular",icon:""},stage_change:{label:"Stage",icon:""},created:{label:"Erstellt",icon:""},task:{label:"Aufgabe",icon:""},invoice_created:{label:"Rechnung",icon:""},invoice_sent:{label:"Rechnung versendet",icon:""},quote_created:{label:"Angebot",icon:""},quote_converted:{label:"Angebot umgewandelt",icon:""},edited:{label:"Bearbeitet",icon:""}},vg={first_name:"Vorname",last_name:"Nachname",email:"E-Mail",phone:"Telefon",position:"Position",company_id:"Firma",source:"Quelle",source_detail:"Quelle Detail",gdpr_consent:"DSGVO-Einwilligung",title:"Titel",value:"Wert",service_type:"Service-Typ",expected_close:"Erwarteter Abschluss",lost_reason:"Verlustgrund",stage:"Stage",name:"Name",industry:"Branche",website:"Website",address:"Adresse",city:"Stadt"},la={draft:{label:"Entwurf",color:"#6366f1"},sending:{label:"Wird gesendet",color:"#f59e0b"},sent:{label:"Versendet",color:"#10b981"}},Zh=[{id:"follow-up",name:"Angebot nachfassen",icon:"",preview:"Offenes Angebot freundlich nachfassen",subject:"Ihr 360-Rundgang  Noch Fragen offen?",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"></head>
<body style="margin:0;padding:0;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;background:#f0f4f8;">
<div style="max-width:600px;margin:0 auto;padding:24px 16px;">
  <!-- Header -->
  <div style="background:linear-gradient(135deg,#1a5c6b 0%,#237a8c 100%);padding:32px 24px;border-radius:16px 16px 0 0;text-align:center;">
    <h1 style="color:#ffffff;margin:0 0 4px 0;font-size:24px;font-weight:700;letter-spacing:0.5px;">Beck360</h1>
    <p style="color:rgba(255,255,255,0.7);margin:0;font-size:13px;">360 Rundgnge & Drohnenaufnahmen</p>
  </div>
  <!-- Body -->
  <div style="background:#ffffff;padding:36px 32px;line-height:1.7;color:#334155;font-size:15px;">
    <p style="margin:0 0 16px 0;">Hallo {{vorname}},</p>
    <p style="margin:0 0 16px 0;">vor Kurzem haben wir ber einen <strong>360-Rundgang</strong> fr {{firma}} gesprochen. Haben Sie noch Fragen zu unserem Angebot?</p>
    <p style="margin:0 0 24px 0;">Gerne stehe ich Ihnen fr ein kurzes Gesprch zur Verfgung  unverbindlich und unkompliziert.</p>
    <!-- CTA -->
    <div style="text-align:center;margin:32px 0;">
      <a href="https://360-rundgang-karlsruhe.de" style="background:linear-gradient(135deg,#1a5c6b,#237a8c);color:#ffffff;padding:14px 32px;border-radius:8px;text-decoration:none;display:inline-block;font-weight:600;font-size:15px;box-shadow:0 2px 8px rgba(26,92,107,0.3);">Termin vereinbaren</a>
    </div>
    <!-- Signature -->
    <div style="border-top:1px solid #e2e8f0;padding-top:20px;margin-top:28px;">
      <p style="margin:0;font-size:14px;color:#475569;">Beste Gre<br><strong style="color:#1a5c6b;">Eugen Beck</strong></p>
      <p style="margin:4px 0 0 0;font-size:12px;color:#94a3b8;">Beck360  360 Rundgnge & Drohnenaufnahmen<br> +49 173 468 2501 &nbsp;&nbsp;  rundgang@beck360.de</p>
    </div>
  </div>
  <!-- Footer -->
  <div style="background:#f8fafc;border-top:1px solid #e2e8f0;border-radius:0 0 16px 16px;text-align:center;padding:16px 24px;">
    <p style="margin:0;font-size:11px;color:#94a3b8;">Beck360 &nbsp;&nbsp; Eichenweg 1, 76275 Ettlingen &nbsp;&nbsp; <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#64748b;">Impressum</a></p>
  </div>
</div>
</body></html>`},{id:"new-service",name:"Neue Dienstleistung",icon:"",preview:"Neues Angebot oder Service vorstellen",subject:"Neu bei Beck360: Erweiterte 360-Lsungen fr {{firma}}",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"></head>
<body style="margin:0;padding:0;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;background:#f0f4f8;">
<div style="max-width:600px;margin:0 auto;padding:24px 16px;">
  <!-- Header -->
  <div style="background:linear-gradient(135deg,#1a5c6b 0%,#237a8c 100%);padding:32px 24px;border-radius:16px 16px 0 0;text-align:center;">
    <h1 style="color:#ffffff;margin:0 0 4px 0;font-size:24px;font-weight:700;letter-spacing:0.5px;">Beck360</h1>
    <p style="color:rgba(255,255,255,0.7);margin:0;font-size:13px;">360 Rundgnge & Drohnenaufnahmen</p>
  </div>
  <!-- Body -->
  <div style="background:#ffffff;padding:36px 32px;line-height:1.7;color:#334155;font-size:15px;">
    <p style="margin:0 0 16px 0;">Hallo {{vorname}},</p>
    <p style="margin:0 0 24px 0;">wir haben unser Angebot fr Sie erweitert! Entdecken Sie unsere neuen Mglichkeiten:</p>
    <!-- Feature Cards -->
    <table width="100%" cellpadding="0" cellspacing="0" style="margin:0 0 24px 0;">
      <tr>
        <td style="padding:8px 8px 8px 0;width:33%;vertical-align:top;">
          <div style="background:#f0f9ff;border-radius:10px;padding:16px;text-align:center;">
            <div style="font-size:28px;margin-bottom:8px;"></div>
            <p style="margin:0;font-size:13px;font-weight:600;color:#1a5c6b;">360 Rundgnge</p>
            <p style="margin:4px 0 0 0;font-size:11px;color:#64748b;">Interaktive Touren fr Ihre Rume</p>
          </div>
        </td>
        <td style="padding:8px;width:33%;vertical-align:top;">
          <div style="background:#f0f9ff;border-radius:10px;padding:16px;text-align:center;">
            <div style="font-size:28px;margin-bottom:8px;"></div>
            <p style="margin:0;font-size:13px;font-weight:600;color:#1a5c6b;">Drohnenaufnahmen</p>
            <p style="margin:4px 0 0 0;font-size:11px;color:#64748b;">Luftbilder & Videos</p>
          </div>
        </td>
        <td style="padding:8px 0 8px 8px;width:33%;vertical-align:top;">
          <div style="background:#f0f9ff;border-radius:10px;padding:16px;text-align:center;">
            <div style="font-size:28px;margin-bottom:8px;"></div>
            <p style="margin:0;font-size:13px;font-weight:600;color:#1a5c6b;">Google Street View</p>
            <p style="margin:4px 0 0 0;font-size:11px;color:#64748b;">Direkt auf Google Maps</p>
          </div>
        </td>
      </tr>
    </table>
    <p style="margin:0 0 24px 0;">Alle Leistungen aus einer Hand  professionell, schnell und zu fairen Preisen.</p>
    <!-- CTA -->
    <div style="text-align:center;margin:32px 0;">
      <a href="https://360-rundgang-karlsruhe.de" style="background:linear-gradient(135deg,#1a5c6b,#237a8c);color:#ffffff;padding:14px 32px;border-radius:8px;text-decoration:none;display:inline-block;font-weight:600;font-size:15px;box-shadow:0 2px 8px rgba(26,92,107,0.3);">Mehr erfahren</a>
    </div>
    <!-- Signature -->
    <div style="border-top:1px solid #e2e8f0;padding-top:20px;margin-top:28px;">
      <p style="margin:0;font-size:14px;color:#475569;">Beste Gre<br><strong style="color:#1a5c6b;">Eugen Beck</strong></p>
      <p style="margin:4px 0 0 0;font-size:12px;color:#94a3b8;">Beck360  360 Rundgnge & Drohnenaufnahmen<br> +49 173 468 2501 &nbsp;&nbsp;  rundgang@beck360.de</p>
    </div>
  </div>
  <!-- Footer -->
  <div style="background:#f8fafc;border-top:1px solid #e2e8f0;border-radius:0 0 16px 16px;text-align:center;padding:16px 24px;">
    <p style="margin:0;font-size:11px;color:#94a3b8;">Beck360 &nbsp;&nbsp; Eichenweg 1, 76275 Ettlingen &nbsp;&nbsp; <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#64748b;">Impressum</a></p>
  </div>
</div>
</body></html>`},{id:"review",name:"Um Bewertung bitten",icon:"",preview:"Kunden um Google-Bewertung bitten",subject:"Wie war Ihre Erfahrung mit Beck360, {{vorname}}?",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"></head>
<body style="margin:0;padding:0;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;background:#f0f4f8;">
<div style="max-width:600px;margin:0 auto;padding:24px 16px;">
  <!-- Header -->
  <div style="background:linear-gradient(135deg,#1a5c6b 0%,#237a8c 100%);padding:32px 24px;border-radius:16px 16px 0 0;text-align:center;">
    <h1 style="color:#ffffff;margin:0 0 4px 0;font-size:24px;font-weight:700;letter-spacing:0.5px;">Beck360</h1>
    <p style="color:rgba(255,255,255,0.7);margin:0;font-size:13px;">360 Rundgnge & Drohnenaufnahmen</p>
  </div>
  <!-- Body -->
  <div style="background:#ffffff;padding:36px 32px;line-height:1.7;color:#334155;font-size:15px;">
    <p style="margin:0 0 16px 0;">Hallo {{vorname}},</p>
    <p style="margin:0 0 16px 0;">vielen Dank, dass Sie sich fr Beck360 entschieden haben! Wir hoffen, Sie sind mit dem Ergebnis begeistert.</p>
    <!-- Stars -->
    <div style="text-align:center;margin:28px 0;">
      <div style="background:linear-gradient(135deg,#fefce8,#fef9c3);border:1px solid #fde68a;border-radius:12px;padding:24px;display:inline-block;">
        <p style="font-size:36px;margin:0 0 8px 0;letter-spacing:4px;"></p>
        <p style="font-size:15px;font-weight:600;color:#92400e;margin:0 0 4px 0;">Ihre Meinung zhlt!</p>
        <p style="font-size:13px;color:#a16207;margin:0;">Eine Bewertung dauert nur 1 Minute</p>
      </div>
    </div>
    <p style="margin:0 0 24px 0;text-align:center;">Wrden Sie uns mit einer kurzen Google-Bewertung untersttzen? Das hilft anderen Kunden bei ihrer Entscheidung.</p>
    <!-- CTA -->
    <div style="text-align:center;margin:32px 0;">
      <a href="https://www.google.com/maps/place/Beck360/@48.9408,8.4072,17z/?entry=ttu&action=write-review" style="background:linear-gradient(135deg,#1a5c6b,#237a8c);color:#ffffff;padding:14px 32px;border-radius:8px;text-decoration:none;display:inline-block;font-weight:600;font-size:15px;box-shadow:0 2px 8px rgba(26,92,107,0.3);">Jetzt bewerten</a>
    </div>
    <!-- Signature -->
    <div style="border-top:1px solid #e2e8f0;padding-top:20px;margin-top:28px;">
      <p style="margin:0;font-size:14px;color:#475569;">Herzlichen Dank!<br><strong style="color:#1a5c6b;">Eugen Beck</strong></p>
      <p style="margin:4px 0 0 0;font-size:12px;color:#94a3b8;">Beck360  360 Rundgnge & Drohnenaufnahmen<br> +49 173 468 2501 &nbsp;&nbsp;  rundgang@beck360.de</p>
    </div>
  </div>
  <!-- Footer -->
  <div style="background:#f8fafc;border-top:1px solid #e2e8f0;border-radius:0 0 16px 16px;text-align:center;padding:16px 24px;">
    <p style="margin:0;font-size:11px;color:#94a3b8;">Beck360 &nbsp;&nbsp; Eichenweg 1, 76275 Ettlingen &nbsp;&nbsp; <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#64748b;">Impressum</a></p>
  </div>
</div>
</body></html>`},{id:"seasonal",name:"Saisonales Angebot",icon:"",preview:"Zeitlich begrenztes Angebot bewerben",subject:"Exklusiv fr {{firma}}: 360-Rundgang zum Sonderpreis",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"></head>
<body style="margin:0;padding:0;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;background:#f0f4f8;">
<div style="max-width:600px;margin:0 auto;padding:24px 16px;">
  <!-- Header -->
  <div style="background:linear-gradient(135deg,#1a5c6b 0%,#237a8c 100%);padding:32px 24px;border-radius:16px 16px 0 0;text-align:center;">
    <h1 style="color:#ffffff;margin:0 0 4px 0;font-size:24px;font-weight:700;letter-spacing:0.5px;">Beck360</h1>
    <p style="color:rgba(255,255,255,0.7);margin:0;font-size:13px;">360 Rundgnge & Drohnenaufnahmen</p>
  </div>
  <!-- Body -->
  <div style="background:#ffffff;padding:36px 32px;line-height:1.7;color:#334155;font-size:15px;">
    <p style="margin:0 0 16px 0;">Hallo {{vorname}},</p>
    <p style="margin:0 0 20px 0;">wir haben ein exklusives Angebot fr {{firma}}:</p>
    <!-- Offer Box -->
    <div style="background:linear-gradient(135deg,#ecfdf5,#d1fae5);border:2px solid #6ee7b7;border-radius:12px;padding:28px;margin:20px 0;text-align:center;">
      <p style="font-size:12px;font-weight:700;color:#059669;text-transform:uppercase;letter-spacing:2px;margin:0 0 8px 0;">Limitiertes Angebot</p>
      <p style="font-size:22px;font-weight:700;color:#065f46;margin:0 0 8px 0;">Frhlings-Aktion 2026</p>
      <p style="font-size:14px;color:#047857;margin:0;">360-Rundgang zum Sonderpreis  nur bis Ende des Monats!</p>
    </div>
    <p style="margin:20px 0 8px 0;font-weight:600;color:#1e293b;">Das ist enthalten:</p>
    <table width="100%" cellpadding="0" cellspacing="0">
      <tr><td style="padding:6px 0;font-size:14px;color:#475569;"> Professioneller 360-Rundgang</td></tr>
      <tr><td style="padding:6px 0;font-size:14px;color:#475569;"> Hosting auf Matterport fr 12 Monate</td></tr>
      <tr><td style="padding:6px 0;font-size:14px;color:#475569;"> Einbettung auf Ihrer Website</td></tr>
      <tr><td style="padding:6px 0;font-size:14px;color:#475569;"> Google Street View Integration</td></tr>
    </table>
    <!-- CTA -->
    <div style="text-align:center;margin:32px 0;">
      <a href="https://360-rundgang-karlsruhe.de" style="background:linear-gradient(135deg,#059669,#047857);color:#ffffff;padding:14px 32px;border-radius:8px;text-decoration:none;display:inline-block;font-weight:600;font-size:15px;box-shadow:0 2px 8px rgba(5,150,105,0.3);">Jetzt Angebot sichern</a>
    </div>
    <!-- Signature -->
    <div style="border-top:1px solid #e2e8f0;padding-top:20px;margin-top:28px;">
      <p style="margin:0;font-size:14px;color:#475569;">Beste Gre<br><strong style="color:#1a5c6b;">Eugen Beck</strong></p>
      <p style="margin:4px 0 0 0;font-size:12px;color:#94a3b8;">Beck360  360 Rundgnge & Drohnenaufnahmen<br> +49 173 468 2501 &nbsp;&nbsp;  rundgang@beck360.de</p>
    </div>
  </div>
  <!-- Footer -->
  <div style="background:#f8fafc;border-top:1px solid #e2e8f0;border-radius:0 0 16px 16px;text-align:center;padding:16px 24px;">
    <p style="margin:0;font-size:11px;color:#94a3b8;">Beck360 &nbsp;&nbsp; Eichenweg 1, 76275 Ettlingen &nbsp;&nbsp; <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#64748b;">Impressum</a></p>
  </div>
</div>
</body></html>`},{id:"blank",name:"Leere Vorlage",icon:"",preview:"Leeres Template mit Beck360-Layout",subject:"",body:`<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"></head>
<body style="margin:0;padding:0;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;background:#f0f4f8;">
<div style="max-width:600px;margin:0 auto;padding:24px 16px;">
  <!-- Header -->
  <div style="background:linear-gradient(135deg,#1a5c6b 0%,#237a8c 100%);padding:32px 24px;border-radius:16px 16px 0 0;text-align:center;">
    <h1 style="color:#ffffff;margin:0 0 4px 0;font-size:24px;font-weight:700;letter-spacing:0.5px;">Beck360</h1>
    <p style="color:rgba(255,255,255,0.7);margin:0;font-size:13px;">360 Rundgnge & Drohnenaufnahmen</p>
  </div>
  <!-- Body -->
  <div style="background:#ffffff;padding:36px 32px;line-height:1.7;color:#334155;font-size:15px;">
    <p style="margin:0 0 16px 0;">Hallo {{vorname}},</p>
    <p style="margin:0 0 16px 0;"><!-- Ihr Inhalt hier --></p>
    <!-- CTA -->
    <div style="text-align:center;margin:32px 0;">
      <a href="https://360-rundgang-karlsruhe.de" style="background:linear-gradient(135deg,#1a5c6b,#237a8c);color:#ffffff;padding:14px 32px;border-radius:8px;text-decoration:none;display:inline-block;font-weight:600;font-size:15px;box-shadow:0 2px 8px rgba(26,92,107,0.3);">Mehr erfahren</a>
    </div>
    <!-- Signature -->
    <div style="border-top:1px solid #e2e8f0;padding-top:20px;margin-top:28px;">
      <p style="margin:0;font-size:14px;color:#475569;">Beste Gre<br><strong style="color:#1a5c6b;">Eugen Beck</strong></p>
      <p style="margin:4px 0 0 0;font-size:12px;color:#94a3b8;">Beck360  360 Rundgnge & Drohnenaufnahmen<br> +49 173 468 2501 &nbsp;&nbsp;  rundgang@beck360.de</p>
    </div>
  </div>
  <!-- Footer -->
  <div style="background:#f8fafc;border-top:1px solid #e2e8f0;border-radius:0 0 16px 16px;text-align:center;padding:16px 24px;">
    <p style="margin:0;font-size:11px;color:#94a3b8;">Beck360 &nbsp;&nbsp; Eichenweg 1, 76275 Ettlingen &nbsp;&nbsp; <a href="https://360-rundgang-karlsruhe.de/impressum/" style="color:#64748b;">Impressum</a></p>
  </div>
</div>
</body></html>`}],Vl={office:"Buero & Ausstattung",software:"Software & Lizenzen",marketing:"Marketing & Werbung",travel:"Reise & Fahrtkosten",equipment:"Geraete & Technik",insurance:"Versicherungen",telecom:"Telefon & Internet",professional:"Beratung & Dienstleistung",vehicle:"Fahrzeug",training:"Weiterbildung",other:"Sonstiges"},u2={bank_transfer:"Ueberweisung",cash:"Bar",credit_card:"Kreditkarte",paypal:"PayPal",direct_debit:"Lastschrift"},Kl=["Januar","Februar","Maerz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],_d=["Hotel / Pension","Gastronomie","Fitnessstudio","Einzelhandel","Autohaus","Gesundheit / Arztpraxis","Eventlocation","Coworking","Immobilien","Handwerk","Bildung","Sonstige"];function wd({activity:t}){var o;const e=yd[t.type]||{label:t.type,icon:""},n=(o=t.metadata)==null?void 0:o.changes,r=t.description||n&&n.length>0,[a,i]=me(!1);return s("div",{class:"timeline-item",children:s("div",{class:"timeline-content",children:[s("div",{class:"timeline-header",style:r?"cursor:pointer;user-select:none":"",onClick:()=>r&&i(!a),children:[s("span",{class:"timeline-icon",children:e.icon}),s("span",{class:"timeline-type",children:e.label}),s("span",{class:"timeline-time",children:c2(t.created_at)}),r&&s("span",{style:"margin-left:auto;font-size:0.75rem;color:var(--text-dim)",children:a?"":""})]}),a&&s("div",{style:"margin-top:0.5rem",children:[n&&n.length>0&&s("div",{style:"font-size:0.8rem;display:flex;flex-direction:column;gap:0.25rem",children:n.map((l,c)=>s("div",{style:"display:flex;gap:0.5rem;align-items:baseline;padding:0.2rem 0;border-bottom:1px solid var(--border)",children:[s("span",{style:"font-weight:600;min-width:120px;color:var(--text-dim)",children:l.field}),s("span",{style:"color:#ef4444;text-decoration:line-through;word-break:break-word",children:l.from||""}),s("span",{style:"color:var(--text-dim)",children:""}),s("span",{style:"color:#10b981;word-break:break-word",children:l.to||""})]},c))}),t.description&&s("div",{class:"timeline-text",style:n?"margin-top:0.5rem":"",children:t.description})]})]})})}function oc({stage:t}){const e=Mi[t]||{label:t,color:"#64748b"};return s("span",{class:"stage-badge",style:`color: ${e.color}; background: ${e.color}1a`,children:e.label})}function Qh(){const{stats:t,recentActivities:e,loading:n}=n2(),{stats:r}=o2(),{tasks:a,complete:i}=l2();return n?s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Dashboard"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]}):s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Dashboard"}),s("div",{style:"display:flex;gap:0.5rem",children:[s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze("/crm/contacts/new"),children:"+ Kontakt"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/deals/new"),children:"+ Deal"})]})]}),s("div",{class:"page-body",children:[s("div",{class:"grid-4",style:"margin-bottom: 1.5rem",children:[s(Ca,{label:"Kontakte gesamt",value:t.totalContacts}),s(Ca,{label:"Neue Leads (Monat)",value:t.newLeadsThisMonth,color:"var(--info)"}),s(Ca,{label:"Pipeline-Wert",value:De(t.pipelineValue),color:"var(--primary-light)"}),s(Ca,{label:"Conversion-Rate",value:`${t.conversionRate}%`,color:"var(--success)"})]}),s("div",{class:"grid-3",style:"margin-bottom: 1.5rem",children:[s(Ca,{label:"Offene Rechnungen",value:r.openCount,color:"var(--warning)"}),s(Ca,{label:"Offener Betrag",value:De(r.openAmount),color:"var(--error)"}),s(Ca,{label:"Umsatz (Monat)",value:De(r.monthRevenue),color:"var(--success)"})]}),s("div",{class:"grid-2",style:"margin-bottom: 1.5rem",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Pipeline-Uebersicht"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/pipeline"),children:"Oeffnen"})]}),s("div",{style:"display:flex;flex-direction:column;gap:0.5rem",children:Object.entries(Mi).filter(([o])=>o!=="won"&&o!=="lost").map(([o,l])=>s("div",{style:"display:flex;align-items:center;justify-content:space-between;padding:0.4rem 0",children:[s(oc,{stage:o}),s("span",{style:"font-weight:600",children:t.dealsByStage[o]||0})]},o))})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Faellige Aufgaben"})}),a.length===0?s("div",{class:"empty-state",style:"padding:1rem",children:s("div",{class:"empty-state-text",children:"Keine faelligen Aufgaben"})}):s("div",{style:"display:flex;flex-direction:column;gap:0.5rem",children:a.slice(0,5).map(o=>s("div",{style:"display:flex;align-items:center;justify-content:space-between;padding:0.4rem 0;border-bottom:1px solid var(--border)",children:[s("div",{children:[s("div",{style:"font-size:0.85rem",children:o.description}),s("div",{style:"font-size:0.75rem;color:var(--text-dim)",children:["Faellig: ",Cn(o.due_date),o.contact&&`  ${o.contact.first_name} ${o.contact.last_name}`]})]}),s("button",{class:"btn btn-sm btn-secondary",onClick:()=>i(o.id),children:"Erledigt"})]},o.id))})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Letzte Aktivitaeten"})}),e.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Noch keine Aktivitaeten"})]}):s("div",{class:"timeline",children:e.map(o=>s(wd,{activity:o},o.id))})]})]})]})}function xd({stage:t=null,contactId:e=null,companyId:n=null}={}){const[r,a]=me([]),[i,o]=me(!0),l=Nt(async()=>{o(!0);let c=Le.from("deals").select(`
        *,
        contact:contacts(id, first_name, last_name, email),
        company:companies(id, name)
      `).is("deleted_at",null).order("created_at",{ascending:!1});t&&(c=c.eq("stage",t)),e&&(c=c.eq("contact_id",e)),n&&(c=c.eq("company_id",n));const{data:d,error:h}=await c;h||a((d||[]).map(m=>{var b;return{...m,contact_name:m.contact?`${m.contact.first_name||""} ${m.contact.last_name||""}`.trim()||m.contact.email:null,company_name:((b=m.company)==null?void 0:b.name)||null}})),o(!1)},[t,e,n]);return Mt(()=>{l()},[l]),{deals:r,loading:i,refetch:l}}function d2(t){const[e,n]=me(null),[r,a]=me(!0),i=Nt(async()=>{if(!t)return;a(!0);const{data:c}=await Le.from("deals").select(`
        *,
        contact:contacts(id, first_name, last_name, email, phone),
        company:companies(id, name)
      `).eq("id",t).single();n(c),a(!1)},[t]);Mt(()=>{i()},[i]);const o=Nt(async c=>{const{error:d}=await Le.from("deals").update(c).eq("id",t);return d||await i(),{error:d}},[t,i]),l=Nt(async c=>{const d=e==null?void 0:e.stage,{error:h}=await Le.from("deals").update({stage:c,stage_changed_at:new Date().toISOString()}).eq("id",t);if(!h){const{data:m}=await Le.auth.getUser();await Le.from("activities").insert({owner_id:m.user.id,deal_id:t,contact_id:e==null?void 0:e.contact_id,type:"stage_change",description:`Stage geaendert: ${d}  ${c}`,metadata:{old_stage:d,new_stage:c}}),await i()}return{error:h}},[t,e,i]);return{deal:e,loading:r,refetch:i,update:o,changeStage:l}}async function h2(t){const{data:e}=await Le.auth.getUser(),{data:n,error:r}=await Le.from("deals").insert({...t,owner_id:e.user.id}).select().single();return r||await Le.from("activities").insert({owner_id:e.user.id,deal_id:n.id,contact_id:t.contact_id||null,type:"created",description:`Deal erstellt: ${t.title}`}),{data:n,error:r}}async function ef(t,e,n,r){const{error:a}=await Le.from("deals").update({stage:e,stage_changed_at:new Date().toISOString()}).eq("id",t);if(!a){const{data:i}=await Le.auth.getUser();await Le.from("activities").insert({owner_id:i.user.id,deal_id:t,contact_id:r||null,type:"stage_change",description:`Stage geaendert: ${n}  ${e}`,metadata:{old_stage:n,new_stage:e}})}return{error:a}}const f2=["new","contacted","qualified","proposal","won","lost"];function p2({deal:t,onDragStart:e,onClick:n,onStageChange:r}){return s("div",{class:"deal-card",draggable:!0,onDragStart:a=>{a.dataTransfer.setData("text/plain",t.id),a.currentTarget.classList.add("dragging"),e&&e(t)},onDragEnd:a=>a.currentTarget.classList.remove("dragging"),onClick:()=>n&&n(t),children:[s("div",{class:"deal-card-title",children:t.title}),s("div",{class:"deal-card-meta",children:[s("span",{children:t.contact_name||""}),s("span",{children:t.value?De(t.value):""})]}),r&&s("select",{class:"deal-card-stage-select",value:t.stage,onClick:a=>a.stopPropagation(),onChange:a=>{a.stopPropagation(),r(t,a.target.value)},children:f2.map(a=>s("option",{value:a,children:Mi[a].label},a))})]})}const tf=["new","contacted","qualified","proposal","won","lost"];function g2(){const{deals:t,loading:e,refetch:n}=xd(),r=Qn(),[a,i]=me(null),o={};for(const d of tf)o[d]=t.filter(h=>h.stage===d);const l=Nt(async(d,h)=>{d.preventDefault(),i(null);const m=d.dataTransfer.getData("text/plain"),b=t.find(_=>_.id===m);if(!b||b.stage===h)return;const{error:p}=await ef(m,h,b.stage,b.contact_id);p?r.error("Fehler beim Aendern der Stage"):(r.success(`Deal nach "${Mi[h].label}" verschoben`),n())},[t,n,r]),c=Nt(async(d,h)=>{if(d.stage===h)return;const{error:m}=await ef(d.id,h,d.stage,d.contact_id);m?r.error("Fehler beim Aendern der Stage"):(r.success(`Deal nach "${Mi[h].label}" verschoben`),n())},[n,r]);return e?s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Pipeline"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]}):s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Pipeline"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze("/crm/deals/new"),children:"+ Neuer Deal"})]}),s("div",{class:"page-body",children:s("div",{class:"pipeline",children:tf.map(d=>s("div",{class:"pipeline-column",children:[s("div",{class:"pipeline-column-header",style:`border-top: 3px solid ${Mi[d].color}`,children:[s("span",{children:Mi[d].label}),s("span",{class:"pipeline-column-count",children:o[d].length})]}),s("div",{class:`pipeline-column-body ${a===d?"drag-over":""}`,onDragOver:h=>{h.preventDefault(),i(d)},onDragLeave:()=>i(null),onDrop:h=>l(h,d),children:o[d].length===0?s("div",{style:"text-align:center;padding:1rem;color:var(--text-dim);font-size:0.8rem",children:"Keine Deals"}):o[d].map(h=>s(p2,{deal:h,onClick:()=>ze(`/crm/deals/${h.id}`),onStageChange:c},h.id))})]},d))})})]})}function lc({search:t="",source:e=null}={}){const[n,r]=me([]),[a,i]=me(!0),o=Nt(async()=>{i(!0);let l=Le.from("contacts").select("*, company:companies(id, name)").is("deleted_at",null).order("created_at",{ascending:!1});e&&(l=l.eq("source",e)),t&&(l=l.or(`first_name.ilike.%${t}%,last_name.ilike.%${t}%,email.ilike.%${t}%`));const{data:c,error:d}=await l;d||r(c||[]),i(!1)},[t,e]);return Mt(()=>{o()},[o]),{contacts:n,loading:a,refetch:o}}function m2(t){const[e,n]=me(null),[r,a]=me(!0),i=Nt(async()=>{if(!t)return;a(!0);const{data:c}=await Le.from("contacts").select("*, company:companies(id, name)").eq("id",t).single();n(c),a(!1)},[t]);Mt(()=>{i()},[i]);const o=Nt(async c=>{const{error:d}=await Le.from("contacts").update(c).eq("id",t);return d||await i(),{error:d}},[t,i]),l=Nt(async()=>Le.from("contacts").update({deleted_at:new Date().toISOString()}).eq("id",t),[t]);return{contact:e,loading:r,refetch:i,update:o,softDelete:l}}async function Sd(t){const{data:e}=await Le.auth.getUser(),{data:n,error:r}=await Le.from("contacts").insert({...t,owner_id:e.user.id}).select().single();return r||await Le.from("activities").insert({owner_id:e.user.id,contact_id:n.id,type:"created",description:"Kontakt manuell erstellt"}),{data:n,error:r}}function bg({value:t,onInput:e,placeholder:n="Suchen..."}){return s("input",{type:"search",class:"search-input",placeholder:n,value:t,onInput:r=>e(r.target.value)})}function Ad({filters:t,active:e,onSelect:n}){return s("div",{class:"filter-pills",children:[s("button",{class:`filter-pill ${e?"":"active"}`,onClick:()=>n(null),children:"Alle"}),t.map(r=>s("button",{class:`filter-pill ${e===r.value?"active":""}`,onClick:()=>n(r.value),children:r.label},r.value))]})}function Ua({title:t,onClose:e,children:n,footer:r,className:a}){const i=Nt(o=>{o.key==="Escape"&&e()},[e]);return Mt(()=>(document.addEventListener("keydown",i),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",i),document.body.style.overflow=""}),[i]),s("div",{class:"modal-overlay",onClick:o=>{o.target===o.currentTarget&&e()},children:s("div",{class:`modal${a?" "+a:""}`,role:"dialog","aria-modal":"true",children:[s("div",{class:"modal-header",children:[s("span",{children:t}),s("button",{class:"btn-icon",onClick:e,"aria-label":"Schliessen",children:""})]}),s("div",{class:"modal-body",children:n}),r&&s("div",{class:"modal-footer",children:r})]})})}function cc({search:t="",industry:e=null}={}){const[n,r]=me([]),[a,i]=me(!0),o=Nt(async()=>{i(!0);let l=Le.from("companies").select("*").is("deleted_at",null).order("created_at",{ascending:!1});e&&(l=l.eq("industry",e)),t&&(l=l.or(`name.ilike.%${t}%,city.ilike.%${t}%`));const{data:c,error:d}=await l;d||r(c||[]),i(!1)},[t,e]);return Mt(()=>{o()},[o]),{companies:n,loading:a,refetch:o}}function v2(t){const[e,n]=me(null),[r,a]=me(!0),i=Nt(async()=>{if(!t)return;a(!0);const{data:c}=await Le.from("companies").select("*").eq("id",t).is("deleted_at",null).single();n(c),a(!1)},[t]);Mt(()=>{i()},[i]);const o=Nt(async c=>{const{error:d}=await Le.from("companies").update(c).eq("id",t);return d||await i(),{error:d}},[t,i]),l=Nt(async()=>{const{error:c}=await Le.from("companies").update({deleted_at:new Date().toISOString()}).eq("id",t);return{error:c}},[t]);return{company:e,loading:r,refetch:i,update:o,softDelete:l}}async function uc(t){const{data:e}=await Le.auth.getUser();return Le.from("companies").insert({...t,owner_id:e.user.id}).select().single()}function nf(t,e){const n=[];let r="",a=!1;for(let i=0;i<t.length;i++){const o=t[i];a?o==='"'&&t[i+1]==='"'?(r+='"',i++):o==='"'?a=!1:r+=o:o==='"'?a=!0:o===e?(n.push(r.trim()),r=""):r+=o}return n.push(r.trim()),n}function b2(t){const e=(t.match(/;/g)||[]).length,n=(t.match(/,/g)||[]).length;return e>=n?";":","}function y2(t,e){const n={};return t.forEach((r,a)=>{n[r]=e[a]||""}),{companyName:n.Firma||"",firstName:n["Ansprechpartner Vorname"]||"",lastName:n["Ansprechpartner Nachname"]||"",email:n["E-Mail"]||n.Email||"",street:n.Strasse||"",zip:n.PLZ||"",city:n.Stadt||"",industry:n.Branche||"",vatId:n["USt-IdNr"]||"",notes:n.Notiz||""}}function _2(){const[t,e]=me(null),[n,r]=me(!1),[a,i]=me({current:0,total:0}),[o,l]=me(null),c=Nt(m=>{const b=m.split(/\r?\n/).filter(O=>O.trim());if(b.length<2)return null;const p=b2(b[0]),_=nf(b[0],p),w=b.slice(1).map(O=>y2(_,nf(O,p))),S=[...new Set(w.map(O=>O.companyName).filter(Boolean))],x=w.filter(O=>O.firstName||O.lastName),T={rows:w,companyNames:S,contactCount:x.length};return e(T),l(null),T},[]),d=Nt(async()=>{if(!t)return;r(!0),l(null);const{rows:m,companyNames:b}=t,p=b.length+m.filter(F=>F.firstName||F.lastName).length;i({current:0,total:p});let _={companies:0,contacts:0},w={companies:0,contacts:0},S=[],x=0;const{data:T}=await Le.from("companies").select("id, name").is("deleted_at",null),O=new Map((T||[]).map(F=>[F.name.toLowerCase(),F.id])),L=new Map;for(const F of b){const C=F.toLowerCase();if(O.has(C))L.set(F,O.get(C)),w.companies++;else{const A=m.find(U=>U.companyName===F),k=[A.street,A.zip,A.city].filter(Boolean).join(", "),{data:M,error:j}=await uc({name:F,address:k||null,city:A.city||null,industry:A.industry||null});j?S.push(`Firma "${F}": ${j.message}`):(L.set(F,M.id),_.companies++)}x++,i({current:x,total:p})}const{data:K}=await Le.from("contacts").select("id, first_name, last_name, company_id").is("deleted_at",null),te=(F,C,A)=>`${(F||"").toLowerCase()}|${(C||"").toLowerCase()}|${A||""}`,V=new Set((K||[]).map(F=>te(F.first_name,F.last_name,F.company_id)));for(const F of m){if(!F.firstName&&!F.lastName)continue;const C=L.get(F.companyName)||null,A=te(F.firstName,F.lastName,C);if(V.has(A)){w.contacts++,x++,i({current:x,total:p});continue}const k=F.email||`${(F.firstName||"kontakt").toLowerCase()}.${(F.lastName||"").toLowerCase()}@platzhalter.de`.replace(/\s+/g,""),{error:M}=await Sd({first_name:F.firstName||null,last_name:F.lastName||null,email:k,company_id:C,source:"manual"});M?S.push(`Kontakt "${F.firstName} ${F.lastName}": ${M.message}`):(_.contacts++,V.add(A)),x++,i({current:x,total:p})}const q={created:_,skipped:w,errors:S};return l(q),r(!1),q},[t]),h=Nt(()=>{e(null),l(null),i({current:0,total:0})},[]);return{parseCSV:c,importContacts:d,parsed:t,importing:n,progress:a,results:o,reset:h}}function w2({onClose:t,onSuccess:e}){const n=Hp(null),[r,a]=me(""),{parseCSV:i,importContacts:o,parsed:l,importing:c,progress:d,results:h,reset:m}=_2(),b=S=>{const x=S.target.files[0];if(!x)return;a(x.name);const T=new FileReader;T.onload=O=>i(O.target.result),T.readAsText(x,"UTF-8")},p=async()=>{const S=await o();S&&S.errors.length===0&&(e==null||e())},_=()=>{m(),t()};return s(Ua,{title:"CSV Import",onClose:_,footer:h?s("button",{class:"btn btn-primary btn-sm",onClick:_,children:"Schliessen"}):s(At,{children:[s("button",{class:"btn btn-secondary btn-sm",onClick:_,disabled:c,children:"Abbrechen"}),l&&s("button",{class:"btn btn-primary btn-sm",onClick:p,disabled:c,children:c?"Importiere...":"Importieren"})]}),className:"modal-wide",children:[!l&&!h&&s("div",{children:[s("p",{style:"font-size:0.85rem;color:var(--text-muted);margin-bottom:1rem",children:"CSV-Datei mit Semikolon- oder Komma-Trennung hochladen. Erwartete Spalten: Firma, Ansprechpartner Vorname/Nachname, Strasse, PLZ, Stadt, Branche, Notiz."}),s("label",{class:"import-file-label",style:"display:flex;align-items:center;justify-content:center;gap:0.5rem;padding:2rem;border:2px dashed var(--border);border-radius:var(--radius-lg);cursor:pointer;color:var(--text-muted);font-size:0.85rem;transition:border-color 0.15s",children:[s("span",{children:r||"CSV-Datei auswaehlen..."}),s("input",{ref:n,type:"file",accept:".csv,.txt",onChange:b,style:"display:none"})]})]}),l&&!h&&s("div",{children:[s("div",{style:"display:flex;gap:1rem;margin-bottom:1rem",children:[s("div",{class:"card",style:"flex:1;padding:0.75rem;text-align:center",children:[s("div",{style:"font-size:1.25rem;font-weight:700;color:var(--primary)",children:l.companyNames.length}),s("div",{style:"font-size:0.75rem;color:var(--text-muted)",children:"Firmen"})]}),s("div",{class:"card",style:"flex:1;padding:0.75rem;text-align:center",children:[s("div",{style:"font-size:1.25rem;font-weight:700;color:var(--primary)",children:l.contactCount}),s("div",{style:"font-size:0.75rem;color:var(--text-muted)",children:"Kontakte"})]})]}),c&&s("div",{style:"margin-bottom:1rem",children:[s("div",{style:"display:flex;justify-content:space-between;font-size:0.75rem;color:var(--text-muted);margin-bottom:0.25rem",children:[s("span",{children:"Importiere..."}),s("span",{children:[d.current,"/",d.total]})]}),s("div",{style:"height:6px;background:var(--border);border-radius:3px;overflow:hidden",children:s("div",{style:`height:100%;background:var(--primary);border-radius:3px;transition:width 0.2s;width:${d.total?d.current/d.total*100:0}%`})})]}),s("div",{class:"card",style:"padding:0;max-height:240px;overflow-y:auto",children:s("table",{style:"font-size:0.8rem",children:[s("thead",{children:s("tr",{children:[s("th",{style:"padding:0.5rem 0.6rem",children:"Firma"}),s("th",{style:"padding:0.5rem 0.6rem",children:"Vorname"}),s("th",{style:"padding:0.5rem 0.6rem",children:"Nachname"}),s("th",{style:"padding:0.5rem 0.6rem",children:"Stadt"}),s("th",{style:"padding:0.5rem 0.6rem",children:"Branche"})]})}),s("tbody",{children:l.rows.map((S,x)=>s("tr",{children:[s("td",{style:"padding:0.4rem 0.6rem",children:S.companyName}),s("td",{style:"padding:0.4rem 0.6rem",children:S.firstName||""}),s("td",{style:"padding:0.4rem 0.6rem",children:S.lastName||""}),s("td",{style:"padding:0.4rem 0.6rem",children:S.city}),s("td",{style:"padding:0.4rem 0.6rem",children:S.industry})]},x))})]})})]}),h&&s("div",{children:[s("div",{style:"display:flex;gap:1rem;margin-bottom:1rem",children:[s("div",{class:"card",style:"flex:1;padding:0.75rem;text-align:center",children:[s("div",{style:"font-size:1.25rem;font-weight:700;color:var(--success)",children:h.created.companies}),s("div",{style:"font-size:0.75rem;color:var(--text-muted)",children:"Firmen erstellt"})]}),s("div",{class:"card",style:"flex:1;padding:0.75rem;text-align:center",children:[s("div",{style:"font-size:1.25rem;font-weight:700;color:var(--success)",children:h.created.contacts}),s("div",{style:"font-size:0.75rem;color:var(--text-muted)",children:"Kontakte erstellt"})]})]}),(h.skipped.companies>0||h.skipped.contacts>0)&&s("p",{style:"font-size:0.8rem;color:var(--text-muted);margin-bottom:0.5rem",children:[[h.skipped.companies>0&&`${h.skipped.companies} Firma(en)`,h.skipped.contacts>0&&`${h.skipped.contacts} Kontakt(e)`].filter(Boolean).join(" und ")," bereits vorhanden (uebersprungen)"]}),h.errors.length>0&&s("div",{style:"margin-top:0.75rem",children:[s("p",{style:"font-size:0.8rem;color:var(--error);font-weight:600;margin-bottom:0.25rem",children:"Fehler:"}),h.errors.map((S,x)=>s("p",{style:"font-size:0.8rem;color:var(--error)",children:S},x))]})]})]})}const x2=Object.entries(Ba).map(([t,e])=>({value:t,label:e}));function S2(){const[t,e]=me(""),[n,r]=me(null),[a,i]=me(!1),[o,l]=me(new Set),[c,d]=me(!1),{contacts:h,loading:m,refetch:b}=lc({search:t,source:n}),p=Qn(),_=(T,O)=>{O.stopPropagation(),l(L=>{const K=new Set(L);return K.has(T)?K.delete(T):K.add(T),K})},w=()=>{o.size===h.length?l(new Set):l(new Set(h.map(T=>T.id)))},S=async()=>{if(o.size===0)return;const T=o.size;if(!confirm(`${T} Kontakt(e) wirklich loeschen?`))return;d(!0);const O=[...o],L=new Date().toISOString(),{error:K}=await Le.from("contacts").update({deleted_at:L}).in("id",O);K?p.error("Fehler beim Loeschen"):(p.success(`${T} Kontakt(e) geloescht`),l(new Set),b()),d(!1)};function x(){if(h.length===0)return;const T=";",O=["Vorname","Nachname","E-Mail","Telefon","Position","Firma","Quelle","Erstellt"],L=h.map(F=>{var C;return[F.first_name||"",F.last_name||"",F.email||"",F.phone||"",F.position||"",((C=F.company)==null?void 0:C.name)||"",Ba[F.source]||F.source||"",F.created_at?F.created_at.slice(0,10):""].map(A=>`"${String(A).replace(/"/g,'""')}"`).join(T)}),K="\uFEFF"+[O.join(T),...L].join(`\r
`),te=new Blob([K],{type:"text/csv;charset=utf-8;"}),V=URL.createObjectURL(te),q=document.createElement("a");q.href=V,q.download=`kontakte-${new Date().toISOString().slice(0,10)}.csv`,q.click(),URL.revokeObjectURL(V)}return s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Kontakte"}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap;justify-content:flex-end",children:[o.size>0&&s("button",{class:"btn btn-danger btn-sm",onClick:S,disabled:c,children:c?"Loesche...":`${o.size} loeschen`}),s("button",{class:"btn btn-secondary btn-sm hide-mobile-sm",onClick:x,disabled:h.length===0,children:"CSV Export"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>i(!0),children:"Import"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze("/crm/contacts/new"),children:"+ Neu"})]})]}),s("div",{class:"page-body",children:[s("div",{class:"search-bar",children:s(bg,{value:t,onInput:e,placeholder:"Name oder E-Mail suchen..."})}),s("div",{style:"margin-bottom: 1rem",children:s(Ad,{filters:x2,active:n,onSelect:r})}),m?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):h.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Kontakte gefunden"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{style:"width:40px",children:s("input",{type:"checkbox",checked:o.size===h.length&&h.length>0,onChange:w,style:"width:16px;height:16px;cursor:pointer"})}),s("th",{children:"Name"}),s("th",{children:"E-Mail"}),s("th",{children:"Firma"}),s("th",{children:"Quelle"}),s("th",{children:"Erstellt"})]})}),s("tbody",{children:h.map(T=>{var O,L;return s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/contacts/${T.id}`),children:[s("td",{"data-label":"",onClick:K=>K.stopPropagation(),style:"width:40px",children:s("input",{type:"checkbox",checked:o.has(T.id),onChange:K=>_(T.id,K),style:"width:16px;height:16px;cursor:pointer"})}),s("td",{"data-label":"Name",style:"font-weight:500",children:T.first_name||T.last_name?`${T.first_name||""} ${T.last_name||""}`.trim():""}),s("td",{"data-label":"E-Mail",children:(O=T.email)!=null&&O.endsWith("@platzhalter.de")?s("span",{style:"color:var(--text-dim);font-style:italic",children:T.email}):T.email}),s("td",{"data-label":"Firma",children:((L=T.company)==null?void 0:L.name)||""}),s("td",{"data-label":"Quelle",children:s("span",{class:"filter-pill",style:"cursor:default;font-size:0.7rem;padding:0.15rem 0.5rem",children:Ba[T.source]||T.source})}),s("td",{"data-label":"Erstellt",style:"color:var(--text-dim)",children:Cn(T.created_at)})]},T.id)})})]})})})]}),a&&s(w2,{onClose:()=>i(!1),onSuccess:()=>{p.success("Import abgeschlossen"),b()}})]})}function A2({id:t}){var j;const{contact:e,loading:n,update:r,softDelete:a}=m2(t),{companies:i}=cc(),{deals:o}=xd({contactId:t}),{activities:l,refetch:c}=bd({contactId:t}),d=Qn(),[h,m]=me(!1),[b,p]=me({}),[_,w]=me("keep"),[S,x]=me(""),[T,O]=me(!1),[L,K]=me({type:"note",description:"",due_date:""}),[te,V]=me(!0);if(n)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Kontakt"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Nicht gefunden"})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Kontakt nicht gefunden"})})})]});function q(){p({first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",phone:e.phone||"",position:e.position||"",company_id:e.company_id||"",source:e.source||"manual",source_detail:e.source_detail||"",gdpr_consent:!!e.gdpr_consent}),w("keep"),x(""),m(!0)}function F(U,re){if(U==="gdpr_consent")return re?"Ja":"Nein";if(U==="source")return Ba[re]||re||"";if(U==="company_id"){if(!re)return"";const ce=i.find(se=>se.id===re);return ce?ce.name:re}return re||""}async function C(){try{const U={...b};if(U.gdpr_consent&&!e.gdpr_consent?U.gdpr_consent_at=new Date().toISOString():U.gdpr_consent||(U.gdpr_consent_at=null),_==="new"&&S.trim()){const{data:fe,error:xe}=await uc({name:S.trim()});if(xe)throw xe;U.company_id=fe.id}else _==="remove"&&(U.company_id=null);const re=["first_name","last_name","email","phone","position","company_id","source","source_detail","gdpr_consent"],ce=[];for(const fe of re){const xe=e[fe]??"",ge=U[fe]??"";String(xe)!==String(ge)&&ce.push({field:vg[fe]||fe,from:F(fe,xe),to:F(fe,ge)})}const{error:se}=await r(U);if(se)throw se;if(ce.length>0){const fe=ce.map(xe=>xe.field).join(", ");await Gl({contact_id:t,type:"edited",description:`${fe} geaendert`,metadata:{changes:ce}}),c()}d.success("Kontakt aktualisiert"),m(!1)}catch(U){d.error(U.message||"Fehler beim Speichern")}}async function A(){const U=o.length,re=U>0?`Dieser Kontakt hat ${U} verknuepfte(n) Deal(s). Kontakt wirklich loeschen?`:"Kontakt wirklich loeschen?";if(!confirm(re))return;const{error:ce}=await a();ce?d.error("Fehler beim Loeschen"):(d.success("Kontakt geloescht"),ze("/crm/contacts"))}async function k(U){U.preventDefault();const{error:re}=await Gl({contact_id:t,type:L.type,description:L.description,due_date:L.type==="task"&&L.due_date?L.due_date:null});re?d.error("Fehler beim Erstellen"):(d.success("Aktivitaet hinzugefuegt"),O(!1),K({type:"note",description:"",due_date:""}),c())}const M=`${e.first_name||""} ${e.last_name||""}`.trim()||e.email;return s(At,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/contacts"),children:""}),s("h1",{class:"page-title",children:M})]}),s("div",{style:"display:flex;gap:0.5rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>O(!0),children:"+ Aktivitaet"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze(`/crm/deals/new?contact_id=${t}`),children:"+ Deal"}),!h&&s("button",{class:"btn btn-secondary btn-sm",onClick:q,children:"Bearbeiten"}),s("button",{class:"btn btn-danger btn-sm",onClick:A,children:"Loeschen"})]})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Stammdaten"})}),h?s("div",{children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Vorname"}),s("input",{value:b.first_name,onInput:U=>p({...b,first_name:U.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Nachname"}),s("input",{value:b.last_name,onInput:U=>p({...b,last_name:U.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"E-Mail"}),s("input",{type:"email",value:b.email,onInput:U=>p({...b,email:U.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Telefon"}),s("input",{value:b.phone,onInput:U=>p({...b,phone:U.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Position"}),s("input",{value:b.position,onInput:U=>p({...b,position:U.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Firma"}),s("div",{style:"display:flex;gap:0.25rem;margin-bottom:0.5rem",children:[s("button",{type:"button",class:`filter-pill ${_==="keep"?"active":""}`,onClick:()=>w("keep"),children:e.company?"Beibehalten":"Keine"}),s("button",{type:"button",class:`filter-pill ${_==="change"?"active":""}`,onClick:()=>w("change"),children:"Andere waehlen"}),s("button",{type:"button",class:`filter-pill ${_==="new"?"active":""}`,onClick:()=>w("new"),children:"Neue"}),e.company&&s("button",{type:"button",class:`filter-pill ${_==="remove"?"active":""}`,onClick:()=>w("remove"),children:"Entfernen"})]}),_==="keep"&&e.company&&s("div",{style:"font-size:0.85rem;color:var(--text-dim)",children:e.company.name}),_==="change"&&s("select",{value:b.company_id,onChange:U=>p({...b,company_id:U.target.value}),children:[s("option",{value:"",children:" Firma waehlen "}),i.map(U=>s("option",{value:U.id,children:U.name},U.id))]}),_==="new"&&s("input",{value:S,onInput:U=>x(U.target.value),placeholder:"Neuer Firmenname"}),_==="remove"&&s("div",{style:"font-size:0.85rem;color:var(--text-dim)",children:"Firma-Verknuepfung wird entfernt"})]}),s("div",{class:"form-group",children:[s("label",{children:"Quelle"}),s("select",{value:b.source,onChange:U=>p({...b,source:U.target.value}),children:Object.entries(Ba).map(([U,re])=>s("option",{value:U,children:re},U))})]}),s("div",{class:"form-group",children:[s("label",{children:"Quelle Detail"}),s("input",{value:b.source_detail,onInput:U=>p({...b,source_detail:U.target.value}),placeholder:"z.B. Blog: Hotels"})]}),s("div",{class:"form-group form-group-full",children:s("label",{style:"display:flex;align-items:center;gap:0.5rem;cursor:pointer;text-transform:none;letter-spacing:normal;font-size:0.875rem;",children:[s("input",{type:"checkbox",checked:b.gdpr_consent,onChange:U=>p({...b,gdpr_consent:U.target.checked}),style:"width:16px;height:16px;cursor:pointer;"}),"DSGVO-Einwilligung erteilt"]})})]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>m(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary btn-sm",onClick:C,children:"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Vorname"}),s("span",{class:"detail-value",children:e.first_name||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Nachname"}),s("span",{class:"detail-value",children:e.last_name||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"E-Mail"}),s("span",{class:"detail-value",children:(j=e.email)!=null&&j.endsWith("@platzhalter.de")?s("span",{style:"color:var(--text-dim);font-style:italic",title:"Platzhalter  bitte echte E-Mail eintragen",children:e.email}):s("a",{href:`mailto:${e.email}`,children:e.email})})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Telefon"}),s("span",{class:"detail-value",children:e.phone?s("a",{href:`tel:${e.phone}`,children:e.phone}):""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Position"}),s("span",{class:"detail-value",children:e.position||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Firma"}),s("span",{class:"detail-value",children:e.company?s("a",{href:"#",onClick:U=>{U.preventDefault(),ze(`/crm/companies/${e.company.id}`)},children:e.company.name}):""})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Deals (",o.length,")"]})}),o.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Deals"}):s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Titel"}),s("th",{children:"Stage"}),s("th",{children:"Wert"})]})}),s("tbody",{children:o.map(U=>s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/deals/${U.id}`),children:[s("td",{children:U.title}),s("td",{children:s(oc,{stage:U.stage})}),s("td",{children:U.value?De(U.value):""})]},U.id))})]})})]}),s("div",{class:"card",children:[s("div",{class:"card-header",style:"cursor:pointer;user-select:none",onClick:()=>V(!te),children:[s("span",{class:"card-title",children:["Aktivitaeten (",l.length,")"]}),s("span",{style:"font-size:0.75rem;color:var(--text-dim)",children:te?" Einklappen":" Ausklappen"})]}),te&&(l.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Aktivitaeten"}):s("div",{class:"timeline",children:l.map(U=>s(wd,{activity:U},U.id))}))]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Quelle"}),s("span",{class:"detail-value",children:Ba[e.source]||e.source})]}),e.source_detail&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Detail"}),s("span",{class:"detail-value",children:e.source_detail})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"DSGVO-Einwilligung"}),s("span",{class:"detail-value",children:e.gdpr_consent?"Ja":"Nein"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:Cn(e.created_at)})]})]})})]})}),T&&s(Ua,{title:"Aktivitaet hinzufuegen",onClose:()=>O(!1),children:s("form",{onSubmit:k,children:[s("div",{class:"form-group",children:[s("label",{children:"Typ"}),s("select",{value:L.type,onChange:U=>K({...L,type:U.target.value}),children:Object.entries(yd).filter(([U])=>!["form_submission","stage_change","created","edited"].includes(U)).map(([U,re])=>s("option",{value:U,children:[re.icon," ",re.label]},U))})]}),s("div",{class:"form-group",children:[s("label",{children:"Beschreibung"}),s("textarea",{value:L.description,onInput:U=>K({...L,description:U.target.value}),required:!0})]}),L.type==="task"&&s("div",{class:"form-group",children:[s("label",{children:"Faellig am"}),s("input",{type:"date",value:L.due_date,onInput:U=>K({...L,due_date:U.target.value})})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>O(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",children:"Speichern"})]})]})})]})}function k2(){const t=Qn(),{companies:e}=cc(),[n,r]=me(!1),[a,i]=me("none"),[o,l]=me({first_name:"",last_name:"",email:"",phone:"",position:"",source:"manual",source_detail:"",company_id:"",new_company_name:"",gdpr_consent:!1});function c(h,m){l(b=>({...b,[h]:m}))}async function d(h){h.preventDefault(),r(!0);try{let m=null;if(a==="existing"&&o.company_id)m=o.company_id;else if(a==="new"&&o.new_company_name.trim()){const{data:_,error:w}=await uc({name:o.new_company_name.trim()});if(w)throw w;m=_.id}const{data:b,error:p}=await Sd({first_name:o.first_name,last_name:o.last_name,email:o.email,phone:o.phone||null,position:o.position||null,source:o.source,source_detail:o.source_detail||null,company_id:m,gdpr_consent:o.gdpr_consent,gdpr_consent_at:o.gdpr_consent?new Date().toISOString():null});if(p)throw p;t.success("Kontakt erstellt"),ze(`/crm/contacts/${b.id}`)}catch(m){t.error(m.message||"Fehler beim Erstellen")}r(!1)}return s(At,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/contacts"),children:""}),s("h1",{class:"page-title",children:"Neuer Kontakt"})]})}),s("div",{class:"page-body",children:s("div",{class:"card",style:"max-width: 640px",children:s("form",{onSubmit:d,children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Vorname"}),s("input",{value:o.first_name,onInput:h=>c("first_name",h.target.value)})]}),s("div",{class:"form-group",children:[s("label",{children:"Nachname"}),s("input",{value:o.last_name,onInput:h=>c("last_name",h.target.value)})]}),s("div",{class:"form-group",children:[s("label",{children:"E-Mail *"}),s("input",{type:"email",required:!0,value:o.email,onInput:h=>c("email",h.target.value)})]}),s("div",{class:"form-group",children:[s("label",{children:"Telefon"}),s("input",{type:"tel",value:o.phone,onInput:h=>c("phone",h.target.value)})]}),s("div",{class:"form-group",children:[s("label",{children:"Position"}),s("input",{value:o.position,onInput:h=>c("position",h.target.value),placeholder:"z.B. Geschaeftsfuehrer"})]}),s("div",{class:"form-group",children:[s("label",{children:"Firma"}),s("div",{style:"display:flex;gap:0.25rem;margin-bottom:0.5rem",children:[s("button",{type:"button",class:`filter-pill ${a==="none"?"active":""}`,onClick:()=>i("none"),children:"Keine"}),s("button",{type:"button",class:`filter-pill ${a==="existing"?"active":""}`,onClick:()=>i("existing"),children:"Bestehende"}),s("button",{type:"button",class:`filter-pill ${a==="new"?"active":""}`,onClick:()=>i("new"),children:"Neue"})]}),a==="existing"&&s("select",{value:o.company_id,onChange:h=>c("company_id",h.target.value),children:[s("option",{value:"",children:" Firma waehlen "}),e.map(h=>s("option",{value:h.id,children:h.name},h.id))]}),a==="new"&&s("input",{value:o.new_company_name,onInput:h=>c("new_company_name",h.target.value),placeholder:"Neuer Firmenname"})]}),s("div",{class:"form-group",children:[s("label",{children:"Quelle"}),s("select",{value:o.source,onChange:h=>c("source",h.target.value),children:Object.entries(Ba).map(([h,m])=>s("option",{value:h,children:m},h))})]}),s("div",{class:"form-group",children:[s("label",{children:"Quelle (Detail)"}),s("input",{value:o.source_detail,onInput:h=>c("source_detail",h.target.value),placeholder:"z.B. Blog: Hotels"})]}),s("div",{class:"form-group form-group-full",children:s("label",{style:"display:flex;align-items:center;gap:0.5rem;text-transform:none;font-size:0.85rem;cursor:pointer",children:[s("input",{type:"checkbox",checked:o.gdpr_consent,onChange:h=>c("gdpr_consent",h.target.checked),style:"width:auto"}),"DSGVO-Einwilligung erteilt"]})})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>ze("/crm/contacts"),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",disabled:n,children:n?"Erstelle...":"Kontakt erstellen"})]})]})})})]})}const N2=_d.map(t=>({value:t,label:t}));function E2(){const[t,e]=me(""),[n,r]=me(null),{companies:a,loading:i,refetch:o}=cc({search:t,industry:n}),[l,c]=me(!1),[d,h]=me({name:"",industry:"",city:"",website:""}),[m,b]=me(new Set),[p,_]=me(!1),w=Qn(),S=(L,K)=>{K.stopPropagation(),b(te=>{const V=new Set(te);return V.has(L)?V.delete(L):V.add(L),V})},x=()=>{m.size===a.length?b(new Set):b(new Set(a.map(L=>L.id)))},T=async()=>{if(m.size===0)return;const L=m.size,K=[...m],{data:te}=await Le.from("contacts").select("id").in("company_id",K).is("deleted_at",null),V=(te||[]).length,q=V>0?`${L} Firma(en) loeschen? ${V} verknuepfte(r) Kontakt(e) verlieren die Firmenzuordnung.`:`${L} Firma(en) wirklich loeschen?`;if(!confirm(q))return;_(!0);const F=new Date().toISOString(),{error:C}=await Le.from("companies").update({deleted_at:F}).in("id",K);C?w.error("Fehler beim Loeschen"):(w.success(`${L} Firma(en) geloescht`),b(new Set),o()),_(!1)};async function O(L){L.preventDefault();const{data:K,error:te}=await uc({name:d.name,industry:d.industry||null,city:d.city||null,website:d.website||null});te?w.error("Fehler beim Erstellen"):(w.success("Firma erstellt"),c(!1),h({name:"",industry:"",city:"",website:""}),o())}return s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Firmen"}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap;justify-content:flex-end",children:[m.size>0&&s("button",{class:"btn btn-danger btn-sm",onClick:T,disabled:p,children:p?"Loesche...":`${m.size} loeschen`}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>c(!0),children:"+ Neue Firma"})]})]}),s("div",{class:"page-body",children:[s("div",{class:"search-bar",children:s(bg,{value:t,onInput:e,placeholder:"Firma oder Stadt suchen..."})}),s("div",{style:"margin-bottom: 1rem",children:s(Ad,{filters:N2,active:n,onSelect:r})}),i?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):a.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Firmen gefunden"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{style:"width:40px",children:s("input",{type:"checkbox",checked:m.size===a.length&&a.length>0,onChange:x,style:"width:16px;height:16px;cursor:pointer"})}),s("th",{children:"Name"}),s("th",{children:"Branche"}),s("th",{children:"Stadt"}),s("th",{children:"Website"}),s("th",{children:"Erstellt"})]})}),s("tbody",{children:a.map(L=>s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/companies/${L.id}`),children:[s("td",{"data-label":"",onClick:K=>K.stopPropagation(),style:"width:40px",children:s("input",{type:"checkbox",checked:m.has(L.id),onChange:K=>S(L.id,K),style:"width:16px;height:16px;cursor:pointer"})}),s("td",{"data-label":"Name",style:"font-weight:500",children:L.name}),s("td",{"data-label":"Branche",children:L.industry||""}),s("td",{"data-label":"Stadt",children:L.city||""}),s("td",{"data-label":"Website",children:L.website?s("a",{href:L.website,target:"_blank",rel:"noopener",onClick:K=>K.stopPropagation(),children:L.website}):""}),s("td",{"data-label":"Erstellt",style:"color:var(--text-dim)",children:Cn(L.created_at)})]},L.id))})]})})})]}),l&&s(Ua,{title:"Neue Firma",onClose:()=>c(!1),children:s("form",{onSubmit:O,children:[s("div",{class:"form-group",children:[s("label",{children:"Firmenname *"}),s("input",{required:!0,value:d.name,onInput:L=>h({...d,name:L.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Branche"}),s("select",{value:d.industry,onChange:L=>h({...d,industry:L.target.value}),children:[s("option",{value:"",children:" Auswaehlen "}),_d.map(L=>s("option",{value:L,children:L},L))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Stadt"}),s("input",{value:d.city,onInput:L=>h({...d,city:L.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Website"}),s("input",{value:d.website,onInput:L=>h({...d,website:L.target.value}),placeholder:"https://"})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>c(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",children:"Erstellen"})]})]})})]})}function L2({id:t}){const{company:e,loading:n,update:r,softDelete:a}=v2(t),{contacts:i,refetch:o}=lc(),{deals:l}=xd({companyId:t}),{invoices:c}=vd({companyId:t});bd({companyId:t});const d=Qn(),[h,m]=me(!1),[b,p]=me({}),[_,w]=me(!1),[S,x]=me(!1),[T,O]=me(""),[L,K]=me({first_name:"",last_name:"",email:"",phone:"",source:"manual"}),te=i.filter(k=>k.company_id===t);if(n)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Firma"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Nicht gefunden"})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Firma nicht gefunden"})})})]});function V(){p({name:e.name||"",industry:e.industry||"",website:e.website||"",address:e.address||"",city:e.city||"",notes:e.notes||""}),m(!0)}async function q(k){k.preventDefault();const{error:M}=await Sd({first_name:L.first_name||null,last_name:L.last_name||null,email:L.email||null,phone:L.phone||null,source:L.source||"manual",company_id:t});M?d.error("Fehler beim Erstellen"):(d.success("Kontakt erstellt"),w(!1),K({first_name:"",last_name:"",email:"",phone:"",source:"manual"}),o())}async function F(){if(!T)return;const{error:k}=await Le.from("contacts").update({company_id:t}).eq("id",T);k?d.error("Fehler beim Verknuepfen"):(d.success("Kontakt verknuepft"),x(!1),O(""),o())}async function C(){const{error:k}=await r(b);k?d.error("Fehler beim Speichern"):(d.success("Firma aktualisiert"),m(!1))}async function A(){const k=te.length,M=k>0?`Firma "${e.name}" hat ${k} verknuepfte(n) Kontakt(e). Wirklich loeschen?`:`Firma "${e.name}" wirklich loeschen?`;if(!confirm(M))return;const{error:j}=await a();j?d.error("Fehler beim Loeschen"):(d.success("Firma geloescht"),ze("/crm/companies"))}return s(At,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/companies"),children:""}),s("h1",{class:"page-title",children:e.name})]}),s("div",{style:"display:flex;gap:0.5rem",children:[!h&&s("button",{class:"btn btn-secondary btn-sm",onClick:V,children:"Bearbeiten"}),s("button",{class:"btn btn-danger btn-sm",onClick:A,children:"Loeschen"})]})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Firmendaten"})}),h?s("div",{children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Name"}),s("input",{value:b.name,onInput:k=>p({...b,name:k.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Branche"}),s("select",{value:b.industry,onChange:k=>p({...b,industry:k.target.value}),children:[s("option",{value:"",children:""}),_d.map(k=>s("option",{value:k,children:k},k))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Website"}),s("input",{value:b.website,onInput:k=>p({...b,website:k.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Stadt"}),s("input",{value:b.city,onInput:k=>p({...b,city:k.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Adresse"}),s("input",{value:b.address,onInput:k=>p({...b,address:k.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Notizen"}),s("textarea",{value:b.notes,onInput:k=>p({...b,notes:k.target.value})})]})]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>m(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary btn-sm",onClick:C,children:"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Name"}),s("span",{class:"detail-value",children:e.name})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Branche"}),s("span",{class:"detail-value",children:e.industry||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Website"}),s("span",{class:"detail-value",children:e.website?s("a",{href:e.website,target:"_blank",rel:"noopener",children:e.website}):""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Stadt"}),s("span",{class:"detail-value",children:e.city||""})]}),s("div",{class:"detail-field form-group-full",children:[s("span",{class:"detail-label",children:"Adresse"}),s("span",{class:"detail-value",children:e.address||""})]}),e.notes&&s("div",{class:"detail-field form-group-full",children:[s("span",{class:"detail-label",children:"Notizen"}),s("span",{class:"detail-value",children:e.notes})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:["Kontakte (",te.length,")"]}),!_&&!S&&s("div",{style:"display:flex;gap:0.25rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>x(!0),children:"Verknuepfen"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>w(!0),children:"+ Neu"})]})]}),S&&s("div",{style:"margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid var(--border)",children:[s("div",{class:"form-grid",children:s("div",{class:"form-group form-group-full",children:[s("label",{children:"Bestehenden Kontakt waehlen"}),s("select",{value:T,onChange:k=>O(k.target.value),children:[s("option",{value:"",children:" Kontakt waehlen "}),i.filter(k=>k.company_id!==t).map(k=>s("option",{value:k.id,children:[`${k.first_name||""} ${k.last_name||""}`.trim()||k.email,k.company?` (${k.company.name})`:""]},k.id))]})]})}),s("div",{class:"form-actions",style:"margin-top:0.5rem;border-top:none;padding-top:0",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:()=>{x(!1),O("")},children:"Abbrechen"}),s("button",{type:"button",class:"btn btn-primary btn-sm",onClick:F,disabled:!T,children:"Verknuepfen"})]})]}),_&&s("form",{onSubmit:q,style:"margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid var(--border)",children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Vorname"}),s("input",{value:L.first_name,onInput:k=>K({...L,first_name:k.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Nachname"}),s("input",{value:L.last_name,onInput:k=>K({...L,last_name:k.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"E-Mail"}),s("input",{type:"email",value:L.email,onInput:k=>K({...L,email:k.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Telefon"}),s("input",{value:L.phone,onInput:k=>K({...L,phone:k.target.value})})]})]}),s("div",{class:"form-actions",style:"margin-top:0.5rem;border-top:none;padding-top:0",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:()=>w(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary btn-sm",children:"Erstellen"})]})]}),te.length===0&&!_?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Kontakte"}):te.length>0&&s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Name"}),s("th",{children:"E-Mail"}),s("th",{children:"Position"})]})}),s("tbody",{children:te.map(k=>s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/contacts/${k.id}`),children:[s("td",{children:`${k.first_name||""} ${k.last_name||""}`.trim()||""}),s("td",{children:k.email}),s("td",{children:k.position||""})]},k.id))})]})})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Deals (",l.length,")"]})}),l.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Deals"}):s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Titel"}),s("th",{children:"Stage"}),s("th",{children:"Wert"})]})}),s("tbody",{children:l.map(k=>s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/deals/${k.id}`),children:[s("td",{children:k.title}),s("td",{children:s(oc,{stage:k.stage})}),s("td",{children:k.value?De(k.value):""})]},k.id))})]})})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Rechnungen / Angebote (",c.length,")"]})}),c.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Rechnungen"}):s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Nummer"}),s("th",{children:"Typ"}),s("th",{children:"Status"}),s("th",{style:"text-align:right",children:"Betrag"})]})}),s("tbody",{children:c.map(k=>{var M,j,U,re;return s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/invoices/${k.id}`),children:[s("td",{style:"font-weight:600",children:k.invoice_number}),s("td",{children:(M=ks[k.type])==null?void 0:M.label}),s("td",{children:s("span",{class:"stage-badge",style:`color:${(j=Zn[k.status])==null?void 0:j.color};background:${(U=Zn[k.status])==null?void 0:U.color}20`,children:(re=Zn[k.status])==null?void 0:re.label})}),s("td",{style:"text-align:right",children:De(k.total_amount)})]},k.id)})})]})})]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:Cn(e.created_at)})]})})})]})})]})}function C2({id:t}){const{deal:e,loading:n,update:r,changeStage:a}=d2(t),{activities:i,refetch:o}=bd({dealId:t}),{invoices:l}=vd({dealId:t}),c=Qn(),[d,h]=me(!1),[m,b]=me({}),[p,_]=me(!1),[w,S]=me({type:"note",description:"",due_date:""}),[x,T]=me(!0);if(n)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Deal"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Nicht gefunden"})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Deal nicht gefunden"})})})]});function O(){b({title:e.title||"",value:e.value||"",service_type:e.service_type||"",expected_close:e.expected_close||"",lost_reason:e.lost_reason||""}),h(!0)}function L(q,F){return q==="service_type"?Il[F]||F||"":q==="value"?F?De(parseFloat(F)):"":q==="expected_close"?F?Cn(F):"":F||""}async function K(){const q={...m,value:m.value?parseFloat(m.value):null,service_type:m.service_type||null,expected_close:m.expected_close||null,lost_reason:m.lost_reason||null},F=["title","value","service_type","expected_close","lost_reason"],C=[];for(const k of F){const M=e[k]??"",j=q[k]??"";String(M)!==String(j)&&C.push({field:vg[k]||k,from:L(k,M),to:L(k,j)})}const{error:A}=await r(q);if(A)c.error("Fehler beim Speichern");else{if(C.length>0){const k=C.map(M=>M.field).join(", ");await Gl({deal_id:t,contact_id:e.contact_id||null,type:"edited",description:`${k} geaendert`,metadata:{changes:C}}),o()}c.success("Deal aktualisiert"),h(!1)}}async function te(q){const{error:F}=await a(q);F?c.error("Fehler beim Aendern"):(c.success(`Stage auf "${Mi[q].label}" geaendert`),o())}async function V(q){q.preventDefault();const{error:F}=await Gl({deal_id:t,contact_id:e.contact_id||null,type:w.type,description:w.description,due_date:w.type==="task"&&w.due_date?w.due_date:null});F?c.error("Fehler beim Erstellen"):(c.success("Aktivitaet hinzugefuegt"),_(!1),S({type:"note",description:"",due_date:""}),o())}return s(At,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/pipeline"),children:""}),s("h1",{class:"page-title",children:e.title}),s(oc,{stage:e.stage})]}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>_(!0),children:"+ Aktivitaet"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze(`/crm/invoices/new?type=quote&deal_id=${t}`),children:"+ Angebot"}),e.stage==="won"&&s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze(`/crm/invoices/new?type=invoice&deal_id=${t}`),children:"+ Rechnung"}),!d&&s("button",{class:"btn btn-secondary btn-sm",onClick:O,children:"Bearbeiten"})]})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Deal-Infos"})}),d?s("div",{children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group form-group-full",children:[s("label",{children:"Titel"}),s("input",{value:m.title,onInput:q=>b({...m,title:q.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Wert (EUR)"}),s("input",{type:"number",step:"0.01",value:m.value,onInput:q=>b({...m,value:q.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Service-Typ"}),s("select",{value:m.service_type,onChange:q=>b({...m,service_type:q.target.value}),children:[s("option",{value:"",children:""}),Object.entries(Il).map(([q,F])=>s("option",{value:q,children:F},q))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Erwarteter Abschluss"}),s("input",{type:"date",value:m.expected_close,onInput:q=>b({...m,expected_close:q.target.value})})]}),e.stage==="lost"&&s("div",{class:"form-group",children:[s("label",{children:"Verlustgrund"}),s("input",{value:m.lost_reason,onInput:q=>b({...m,lost_reason:q.target.value})})]})]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>h(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary btn-sm",onClick:K,children:"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Titel"}),s("span",{class:"detail-value",children:e.title})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Wert"}),s("span",{class:"detail-value",children:e.value?De(e.value):""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Service"}),s("span",{class:"detail-value",children:e.service_type?Il[e.service_type]:""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erwarteter Abschluss"}),s("span",{class:"detail-value",children:Cn(e.expected_close)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Kontakt"}),s("span",{class:"detail-value",children:e.contact?s("a",{href:"#",onClick:q=>{q.preventDefault(),ze(`/crm/contacts/${e.contact.id}`)},children:`${e.contact.first_name||""} ${e.contact.last_name||""}`.trim()||e.contact.email}):""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Firma"}),s("span",{class:"detail-value",children:e.company?s("a",{href:"#",onClick:q=>{q.preventDefault(),ze(`/crm/companies/${e.company.id}`)},children:e.company.name}):""})]}),e.lost_reason&&s("div",{class:"detail-field form-group-full",children:[s("span",{class:"detail-label",children:"Verlustgrund"}),s("span",{class:"detail-value",children:e.lost_reason})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Stage aendern"})}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap",children:Object.entries(Mi).map(([q,F])=>s("button",{class:`btn btn-sm ${e.stage===q?"btn-primary":"btn-secondary"}`,onClick:()=>e.stage!==q&&te(q),disabled:e.stage===q,style:e.stage===q?`background:${F.color}`:"",children:F.label},q))})]}),l.length>0&&s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Rechnungen / Angebote (",l.length,")"]})}),s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Nummer"}),s("th",{children:"Typ"}),s("th",{children:"Status"}),s("th",{style:"text-align:right",children:"Betrag"})]})}),s("tbody",{children:l.map(q=>{var F,C,A,k;return s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/invoices/${q.id}`),children:[s("td",{style:"font-weight:600",children:q.invoice_number}),s("td",{children:(F=ks[q.type])==null?void 0:F.label}),s("td",{children:s("span",{class:"stage-badge",style:`color:${(C=Zn[q.status])==null?void 0:C.color};background:${(A=Zn[q.status])==null?void 0:A.color}20`,children:(k=Zn[q.status])==null?void 0:k.label})}),s("td",{style:"text-align:right",children:De(q.total_amount)})]},q.id)})})]})})]}),s("div",{class:"card",children:[s("div",{class:"card-header",style:"cursor:pointer;user-select:none",onClick:()=>T(!x),children:[s("span",{class:"card-title",children:["Aktivitaeten (",i.length,")"]}),s("span",{style:"font-size:0.75rem;color:var(--text-dim)",children:x?" Einklappen":" Ausklappen"})]}),x&&(i.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Aktivitaeten"}):s("div",{class:"timeline",children:i.map(q=>s(wd,{activity:q},q.id))}))]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Stage geaendert am"}),s("span",{class:"detail-value",children:Cn(e.stage_changed_at)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:Cn(e.created_at)})]})]})})]})}),p&&s(Ua,{title:"Aktivitaet hinzufuegen",onClose:()=>_(!1),children:s("form",{onSubmit:V,children:[s("div",{class:"form-group",children:[s("label",{children:"Typ"}),s("select",{value:w.type,onChange:q=>S({...w,type:q.target.value}),children:Object.entries(yd).filter(([q])=>!["form_submission","stage_change","created","edited"].includes(q)).map(([q,F])=>s("option",{value:q,children:[F.icon," ",F.label]},q))})]}),s("div",{class:"form-group",children:[s("label",{children:"Beschreibung"}),s("textarea",{value:w.description,onInput:q=>S({...w,description:q.target.value}),required:!0})]}),w.type==="task"&&s("div",{class:"form-group",children:[s("label",{children:"Faellig am"}),s("input",{type:"date",value:w.due_date,onInput:q=>S({...w,due_date:q.target.value})})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>_(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",children:"Speichern"})]})]})})]})}function T2(){const t=Qn(),{contacts:e}=lc(),[n,r]=me(!1),i=new URLSearchParams(typeof window<"u"?window.location.search:"").get("contact_id")||"",[o,l]=me({title:"",contact_id:i,service_type:"",value:"",expected_close:""});function c(h,m){l(b=>({...b,[h]:m}))}async function d(h){h.preventDefault(),r(!0);try{let m=null;if(o.contact_id){const _=e.find(w=>w.id===o.contact_id);m=(_==null?void 0:_.company_id)||null}const{data:b,error:p}=await h2({title:o.title,contact_id:o.contact_id||null,company_id:m,service_type:o.service_type||null,value:o.value?parseFloat(o.value):null,expected_close:o.expected_close||null});if(p)throw p;t.success("Deal erstellt"),ze(`/crm/deals/${b.id}`)}catch(m){t.error(m.message||"Fehler beim Erstellen")}r(!1)}return s(At,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/pipeline"),children:""}),s("h1",{class:"page-title",children:"Neuer Deal"})]})}),s("div",{class:"page-body",children:s("div",{class:"card",style:"max-width: 640px",children:s("form",{onSubmit:d,children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group form-group-full",children:[s("label",{children:"Titel *"}),s("input",{required:!0,value:o.title,onInput:h=>c("title",h.target.value),placeholder:"z.B. 360-Tour Restaurant Bellini"})]}),s("div",{class:"form-group",children:[s("label",{children:"Kontakt"}),s("select",{value:o.contact_id,onChange:h=>c("contact_id",h.target.value),children:[s("option",{value:"",children:" Auswaehlen "}),e.map(h=>s("option",{value:h.id,children:`${h.first_name||""} ${h.last_name||""}`.trim()||h.email},h.id))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Service-Typ"}),s("select",{value:o.service_type,onChange:h=>c("service_type",h.target.value),children:[s("option",{value:"",children:" Auswaehlen "}),Object.entries(Il).map(([h,m])=>s("option",{value:h,children:m},h))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Wert (EUR)"}),s("input",{type:"number",step:"0.01",min:"0",value:o.value,onInput:h=>c("value",h.target.value),placeholder:"z.B. 1200"})]}),s("div",{class:"form-group",children:[s("label",{children:"Erwarteter Abschluss"}),s("input",{type:"date",value:o.expected_close,onInput:h=>c("expected_close",h.target.value)})]})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>ze("/crm/pipeline"),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",disabled:n,children:n?"Erstelle...":"Deal erstellen"})]})]})})})]})}function P2(){const{user:t}=ac(),e=Qn(),{settings:n,save:r,loading:a}=sc(),[i,o]=me({password:"",confirm:""}),[l,c]=me(!1),[d,h]=me({}),[m,b]=me(!1),[p,_]=me(!1),[w,S]=me(!1),[x,T]=me(!1),[O,L]=me({default_invoice_intro:"",default_quote_intro:"",payment_reference_note:""});Mt(()=>{n&&(h({company_name:n.company_name||"",owner_name:n.owner_name||"",address_line1:n.address_line1||"",address_zip:n.address_zip||"",address_city:n.address_city||"",phone:n.phone||"",email:n.email||"",website:n.website||"",tax_id:n.tax_id||"",vat_id:n.vat_id||"",bank_name:n.bank_name||"",bank_iban:n.bank_iban||"",bank_bic:n.bank_bic||"",default_payment_days:n.default_payment_days||14,vat_rate:n.vat_rate||19,default_closing_text:n.default_closing_text||""}),L({default_invoice_intro:n.default_invoice_intro||"Vielen Dank fuer Ihren Auftrag. Ich berechne Ihnen fuer folgende Leistungen:",default_quote_intro:n.default_quote_intro||"Vielen Dank fuer Ihr Interesse. Gerne unterbreite ich Ihnen folgendes Angebot:",payment_reference_note:n.payment_reference_note||"Bitte verwenden Sie die Rechnungsnummer als Verwendungszweck."}))},[n]);async function K(C){C.preventDefault(),_(!0);const{error:A}=await r({...d,default_payment_days:parseInt(d.default_payment_days)||14,vat_rate:parseFloat(d.vat_rate)||19});A?e.error("Fehler: "+A.message):(e.success("Geschaeftsdaten gespeichert"),b(!1)),_(!1)}async function te(C){C.preventDefault(),T(!0);const{error:A}=await r(O);A?e.error("Fehler: "+A.message):(e.success("Rechnungsvorlage gespeichert"),S(!1)),T(!1)}async function V(C){if(C.preventDefault(),i.password!==i.confirm){e.error("Passwoerter stimmen nicht ueberein");return}if(i.password.length<8){e.error("Passwort muss mindestens 8 Zeichen lang sein");return}c(!0);const{error:A}=await Le.auth.updateUser({password:i.password});A?e.error("Fehler: "+A.message):(e.success("Passwort geaendert"),o({password:"",confirm:""})),c(!1)}async function q(){const{data:C,error:A}=await Le.from("contacts").select("first_name, last_name, email, phone, source, created_at").is("deleted_at",null).order("created_at",{ascending:!1});if(A){e.error("Export fehlgeschlagen");return}const k=["Vorname,Nachname,E-Mail,Telefon,Quelle,Erstellt",...C.map(re=>[re.first_name,re.last_name,re.email,re.phone,re.source,re.created_at].map(ce=>`"${(ce||"").toString().replace(/"/g,'""')}"`).join(","))].join(`
`),M=new Blob(["\uFEFF"+k],{type:"text/csv;charset=utf-8"}),j=URL.createObjectURL(M),U=document.createElement("a");U.href=j,U.download=`beck360-kontakte-${new Date().toISOString().slice(0,10)}.csv`,U.click(),URL.revokeObjectURL(j),e.success("Export erstellt")}async function F(){if(!confirm("Alle geloeschten Kontakte endgueltig entfernen? Dies kann nicht rueckgaengig gemacht werden."))return;const{error:C}=await Le.from("contacts").delete().not("deleted_at","is",null);C?e.error("Fehler: "+C.message):e.success("Geloeschte Kontakte endgueltig entfernt")}return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Einstellungen"})}),s("div",{class:"page-body",children:s("div",{style:"display:flex;flex-direction:column;gap:1.5rem;max-width:640px",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Konto"})}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"E-Mail"}),s("span",{class:"detail-value",children:t==null?void 0:t.email})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"User ID"}),s("span",{class:"detail-value",style:"font-size:0.75rem;color:var(--text-dim);word-break:break-all",children:t==null?void 0:t.id})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Geschaeftsdaten"}),!m&&s("button",{class:"btn btn-secondary btn-sm",onClick:()=>b(!0),children:"Bearbeiten"})]}),a?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):m?s("form",{onSubmit:K,children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Firmenname"}),s("input",{value:d.company_name,onInput:C=>h({...d,company_name:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Inhaber"}),s("input",{value:d.owner_name,onInput:C=>h({...d,owner_name:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Adresse"}),s("input",{value:d.address_line1,onInput:C=>h({...d,address_line1:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"PLZ"}),s("input",{value:d.address_zip,onInput:C=>h({...d,address_zip:C.target.value}),style:"max-width:120px"})]}),s("div",{class:"form-group",children:[s("label",{children:"Stadt"}),s("input",{value:d.address_city,onInput:C=>h({...d,address_city:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Telefon"}),s("input",{value:d.phone,onInput:C=>h({...d,phone:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"E-Mail"}),s("input",{type:"email",value:d.email,onInput:C=>h({...d,email:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Website"}),s("input",{value:d.website,onInput:C=>h({...d,website:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Steuernummer"}),s("input",{value:d.tax_id,onInput:C=>h({...d,tax_id:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"USt-IdNr."}),s("input",{value:d.vat_id,onInput:C=>h({...d,vat_id:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Bank"}),s("input",{value:d.bank_name,onInput:C=>h({...d,bank_name:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"IBAN"}),s("input",{value:d.bank_iban,onInput:C=>h({...d,bank_iban:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"BIC"}),s("input",{value:d.bank_bic,onInput:C=>h({...d,bank_bic:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Zahlungsziel (Tage)"}),s("input",{type:"number",value:d.default_payment_days,onInput:C=>h({...d,default_payment_days:C.target.value}),style:"max-width:100px"})]}),s("div",{class:"form-group",children:[s("label",{children:"MwSt-Satz (%)"}),s("input",{type:"number",step:"0.01",value:d.vat_rate,onInput:C=>h({...d,vat_rate:C.target.value}),style:"max-width:100px"})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Standard-Schlusstext"}),s("textarea",{value:d.default_closing_text,onInput:C=>h({...d,default_closing_text:C.target.value})})]})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:()=>b(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary btn-sm",disabled:p,children:p?"Speichern...":"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Firma"}),s("span",{class:"detail-value",children:(n==null?void 0:n.company_name)||"BECK360"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Inhaber"}),s("span",{class:"detail-value",children:(n==null?void 0:n.owner_name)||"Eugen Beck"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Adresse"}),s("span",{class:"detail-value",children:[(n==null?void 0:n.address_line1)||"Eichenweg 1",", ",(n==null?void 0:n.address_zip)||"76275"," ",(n==null?void 0:n.address_city)||"Ettlingen"]})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Telefon"}),s("span",{class:"detail-value",children:(n==null?void 0:n.phone)||"0173-4682501"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"IBAN"}),s("span",{class:"detail-value",children:(n==null?void 0:n.bank_iban)||"DE92 5486 2500 0001 1389 95"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"MwSt."}),s("span",{class:"detail-value",children:[(n==null?void 0:n.vat_rate)||19,"%"]})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Rechnungsvorlage"}),!w&&s("button",{class:"btn btn-secondary btn-sm",onClick:()=>S(!0),children:"Bearbeiten"})]}),a?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):w?s("form",{onSubmit:te,children:[s("div",{class:"form-group",children:[s("label",{children:"Standard-Einleitung Rechnung"}),s("textarea",{value:O.default_invoice_intro,onInput:C=>L({...O,default_invoice_intro:C.target.value}),rows:2})]}),s("div",{class:"form-group",children:[s("label",{children:"Standard-Einleitung Angebot"}),s("textarea",{value:O.default_quote_intro,onInput:C=>L({...O,default_quote_intro:C.target.value}),rows:2})]}),s("div",{class:"form-group",children:[s("label",{children:"Verwendungszweck-Hinweis"}),s("input",{value:O.payment_reference_note,onInput:C=>L({...O,payment_reference_note:C.target.value})})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:()=>S(!1),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary btn-sm",disabled:x,children:x?"Speichern...":"Speichern"})]})]}):s("div",{style:"display:flex;flex-direction:column;gap:0.75rem",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Einleitung Rechnung"}),s("span",{class:"detail-value",style:"white-space:pre-wrap",children:O.default_invoice_intro})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Einleitung Angebot"}),s("span",{class:"detail-value",style:"white-space:pre-wrap",children:O.default_quote_intro})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Verwendungszweck"}),s("span",{class:"detail-value",children:O.payment_reference_note})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Passwort aendern"})}),s("form",{onSubmit:V,children:[s("div",{class:"form-group",children:[s("label",{children:"Neues Passwort"}),s("input",{type:"password",value:i.password,onInput:C=>o({...i,password:C.target.value}),minLength:8,required:!0,autocomplete:"new-password"})]}),s("div",{class:"form-group",children:[s("label",{children:"Passwort bestaetigen"}),s("input",{type:"password",value:i.confirm,onInput:C=>o({...i,confirm:C.target.value}),minLength:8,required:!0,autocomplete:"new-password"})]}),s("button",{type:"submit",class:"btn btn-primary btn-sm",disabled:l,children:l?"Speichern...":"Passwort aendern"})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"DSGVO-Tools"})}),s("div",{style:"display:flex;flex-direction:column;gap:0.75rem",children:[s("div",{children:[s("div",{style:"font-size:0.85rem;margin-bottom:0.35rem",children:"Kontakte als CSV exportieren"}),s("button",{class:"btn btn-secondary btn-sm",onClick:q,children:"CSV Export"})]}),s("div",{children:[s("div",{style:"font-size:0.85rem;margin-bottom:0.35rem",children:"Geloeschte Kontakte endgueltig entfernen (Recht auf Loeschung)"}),s("button",{class:"btn btn-danger btn-sm",onClick:F,children:"Endgueltig loeschen"})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"System-Info"})}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Version"}),s("span",{class:"detail-value",children:"1.0.0"})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Datenbank"}),s("span",{class:"detail-value",children:"Supabase (Frankfurt, EU)"})]})]})]})})]})}function I2({status:t=null}={}){const[e,n]=me([]),[r,a]=me(!0),i=Nt(async()=>{a(!0);let o=Le.from("campaigns").select("*").is("deleted_at",null).order("created_at",{ascending:!1});t&&(o=o.eq("status",t));const{data:l,error:c}=await o;c||n(l||[]),a(!1)},[t]);return Mt(()=>{i()},[i]),{campaigns:e,loading:r,refetch:i}}function O2(t){const[e,n]=me(null),[r,a]=me(!0),i=Nt(async()=>{if(!t)return;a(!0);const{data:c}=await Le.from("campaigns").select("*").eq("id",t).single();n(c),a(!1)},[t]);Mt(()=>{i()},[i]);const o=Nt(async c=>{const{error:d}=await Le.from("campaigns").update(c).eq("id",t);return d||await i(),{error:d}},[t,i]),l=Nt(async()=>Le.from("campaigns").update({deleted_at:new Date().toISOString()}).eq("id",t),[t]);return{campaign:e,loading:r,refetch:i,update:o,remove:l}}function R2(t){const[e,n]=me([]),[r,a]=me(!0),i=Nt(async()=>{if(!t)return;a(!0);const{data:o}=await Le.from("campaign_recipients").select("*, contact:contacts(first_name, last_name, email)").eq("campaign_id",t).order("created_at",{ascending:!1});n(o||[]),a(!1)},[t]);return Mt(()=>{i()},[i]),{recipients:e,loading:r,refetch:i}}async function Zc(t){const{data:e}=await Le.auth.getUser();return Le.from("campaigns").insert({...t,owner_id:e.user.id}).select().single()}async function rf(t,e){if(await Le.from("campaign_recipients").delete().eq("campaign_id",t),e.length===0)return{error:null};const n=e.map(r=>({campaign_id:t,contact_id:r.id,email:r.email}));return Le.from("campaign_recipients").insert(n)}async function Ku(t,{testEmail:e}={}){const{data:{session:n}}=await Le.auth.getSession();if(!n)throw new Error("Not authenticated");const r={campaign_id:t};e&&(r.test_email=e);const a=await fetch("/api/campaign-send",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify(r)}),i=await a.json();if(!a.ok)throw new Error(i.error||"Send failed");return i}const F2=Object.entries(la).map(([t,{label:e}])=>({value:t,label:e}));function D2(){const[t,e]=me(null),{campaigns:n,loading:r}=I2({status:t});return s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Kampagnen"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze("/crm/campaigns/new"),children:"+ Neue Kampagne"})]}),s("div",{class:"page-body",children:[s("div",{style:"margin-bottom: 1rem",children:s(Ad,{filters:F2,active:t,onSelect:e})}),r?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):n.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Kampagnen gefunden"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Name"}),s("th",{children:"Betreff"}),s("th",{children:"Status"}),s("th",{children:"Gesendet"}),s("th",{children:"Geoeffnet"}),s("th",{children:"Datum"})]})}),s("tbody",{children:n.map(a=>{var i,o,l;return s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/campaigns/${a.id}`),children:[s("td",{"data-label":"Name",style:"font-weight:500",children:a.name}),s("td",{"data-label":"Betreff",children:a.subject}),s("td",{"data-label":"Status",children:s("span",{class:"stage-badge",style:`background:${((i=la[a.status])==null?void 0:i.color)||"#6366f1"}15;color:${((o=la[a.status])==null?void 0:o.color)||"#6366f1"};`,children:((l=la[a.status])==null?void 0:l.label)||a.status})}),s("td",{"data-label":"Gesendet",children:a.total_sent||0}),s("td",{"data-label":"Geoeffnet",children:a.total_opened||0}),s("td",{"data-label":"Datum",style:"color:var(--text-dim)",children:Cn(a.sent_at||a.created_at)})]},a.id)})})]})})})]})]})}/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:yg,setPrototypeOf:af,isFrozen:j2,getPrototypeOf:B2,getOwnPropertyDescriptor:M2}=Object;let{freeze:or,seal:$r,create:Ju}=Object,{apply:Yu,construct:Xu}=typeof Reflect<"u"&&Reflect;or||(or=function(e){return e});$r||($r=function(e){return e});Yu||(Yu=function(e,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];return e.apply(n,a)});Xu||(Xu=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return new e(...r)});const yl=lr(Array.prototype.forEach),U2=lr(Array.prototype.lastIndexOf),sf=lr(Array.prototype.pop),to=lr(Array.prototype.push),$2=lr(Array.prototype.splice),Ol=lr(String.prototype.toLowerCase),Qc=lr(String.prototype.toString),eu=lr(String.prototype.match),no=lr(String.prototype.replace),q2=lr(String.prototype.indexOf),z2=lr(String.prototype.trim),Xr=lr(Object.prototype.hasOwnProperty),sr=lr(RegExp.prototype.test),ro=H2(TypeError);function lr(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return Yu(t,e,r)}}function H2(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Xu(t,n)}}function Lt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ol;af&&af(t,null);let r=e.length;for(;r--;){let a=e[r];if(typeof a=="string"){const i=n(a);i!==a&&(j2(e)||(e[r]=i),a=i)}t[a]=!0}return t}function W2(t){for(let e=0;e<t.length;e++)Xr(t,e)||(t[e]=null);return t}function fi(t){const e=Ju(null);for(const[n,r]of yg(t))Xr(t,n)&&(Array.isArray(r)?e[n]=W2(r):r&&typeof r=="object"&&r.constructor===Object?e[n]=fi(r):e[n]=r);return e}function io(t,e){for(;t!==null;){const r=M2(t,e);if(r){if(r.get)return lr(r.get);if(typeof r.value=="function")return lr(r.value)}t=B2(t)}function n(){return null}return n}const of=or(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),tu=or(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),nu=or(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),G2=or(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ru=or(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),V2=or(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),lf=or(["#text"]),cf=or(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),iu=or(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),uf=or(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),_l=or(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),K2=$r(/\{\{[\w\W]*|[\w\W]*\}\}/gm),J2=$r(/<%[\w\W]*|[\w\W]*%>/gm),Y2=$r(/\$\{[\w\W]*/gm),X2=$r(/^data-[\-\w.\u00B7-\uFFFF]+$/),Z2=$r(/^aria-[\-\w]+$/),_g=$r(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Q2=$r(/^(?:\w+script|data):/i),eb=$r(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),wg=$r(/^html$/i),tb=$r(/^[a-z][.\w]*(-[.\w]+)+$/i);var df=Object.freeze({__proto__:null,ARIA_ATTR:Z2,ATTR_WHITESPACE:eb,CUSTOM_ELEMENT:tb,DATA_ATTR:X2,DOCTYPE_NAME:wg,ERB_EXPR:J2,IS_ALLOWED_URI:_g,IS_SCRIPT_OR_DATA:Q2,MUSTACHE_EXPR:K2,TMPLIT_EXPR:Y2});const ao={element:1,text:3,progressingInstruction:7,comment:8,document:9},nb=function(){return typeof window>"u"?null:window},rb=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(r=n.getAttribute(a));const i="dompurify"+(r?"#"+r:"");try{return e.createPolicy(i,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},hf=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function xg(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:nb();const e=Ue=>xg(Ue);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==ao.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const r=n,a=r.currentScript,{DocumentFragment:i,HTMLTemplateElement:o,Node:l,Element:c,NodeFilter:d,NamedNodeMap:h=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:m,DOMParser:b,trustedTypes:p}=t,_=c.prototype,w=io(_,"cloneNode"),S=io(_,"remove"),x=io(_,"nextSibling"),T=io(_,"childNodes"),O=io(_,"parentNode");if(typeof o=="function"){const Ue=n.createElement("template");Ue.content&&Ue.content.ownerDocument&&(n=Ue.content.ownerDocument)}let L,K="";const{implementation:te,createNodeIterator:V,createDocumentFragment:q,getElementsByTagName:F}=n,{importNode:C}=r;let A=hf();e.isSupported=typeof yg=="function"&&typeof O=="function"&&te&&te.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:k,ERB_EXPR:M,TMPLIT_EXPR:j,DATA_ATTR:U,ARIA_ATTR:re,IS_SCRIPT_OR_DATA:ce,ATTR_WHITESPACE:se,CUSTOM_ELEMENT:fe}=df;let{IS_ALLOWED_URI:xe}=df,ge=null;const I=Lt({},[...of,...tu,...nu,...ru,...lf]);let z=null;const J=Lt({},[...cf,...iu,...uf,..._l]);let X=Object.seal(Ju(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Z=null,ae=null;const pe=Object.seal(Ju(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Y=!0,oe=!0,be=!1,Ce=!0,Te=!1,je=!0,$=!1,Pe=!1,ht=!1,He=!1,Se=!1,Ke=!1,Re=!0,Qe=!1;const Ie="user-content-";let it=!0,nt=!1,at={},ut=null;const pt=Lt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let qe=null;const mt=Lt({},["audio","video","img","source","image","track"]);let We=null;const rn=Lt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Et="http://www.w3.org/1998/Math/MathML",bt="http://www.w3.org/2000/svg",ct="http://www.w3.org/1999/xhtml";let Dt=ct,et=!1,jt=null;const st=Lt({},[Et,bt,ct],Qc);let dt=Lt({},["mi","mo","mn","ms","mtext"]),Ut=Lt({},["annotation-xml"]);const kt=Lt({},["title","style","font","a","script"]);let tt=null;const Ft=["application/xhtml+xml","text/html"],yi="text/html";let Ct=null,Gn=null;const Tr=n.createElement("form"),rt=function(ee){return ee instanceof RegExp||ee instanceof Function},mr=function(){let ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Gn&&Gn===ee)){if((!ee||typeof ee!="object")&&(ee={}),ee=fi(ee),tt=Ft.indexOf(ee.PARSER_MEDIA_TYPE)===-1?yi:ee.PARSER_MEDIA_TYPE,Ct=tt==="application/xhtml+xml"?Qc:Ol,ge=Xr(ee,"ALLOWED_TAGS")?Lt({},ee.ALLOWED_TAGS,Ct):I,z=Xr(ee,"ALLOWED_ATTR")?Lt({},ee.ALLOWED_ATTR,Ct):J,jt=Xr(ee,"ALLOWED_NAMESPACES")?Lt({},ee.ALLOWED_NAMESPACES,Qc):st,We=Xr(ee,"ADD_URI_SAFE_ATTR")?Lt(fi(rn),ee.ADD_URI_SAFE_ATTR,Ct):rn,qe=Xr(ee,"ADD_DATA_URI_TAGS")?Lt(fi(mt),ee.ADD_DATA_URI_TAGS,Ct):mt,ut=Xr(ee,"FORBID_CONTENTS")?Lt({},ee.FORBID_CONTENTS,Ct):pt,Z=Xr(ee,"FORBID_TAGS")?Lt({},ee.FORBID_TAGS,Ct):fi({}),ae=Xr(ee,"FORBID_ATTR")?Lt({},ee.FORBID_ATTR,Ct):fi({}),at=Xr(ee,"USE_PROFILES")?ee.USE_PROFILES:!1,Y=ee.ALLOW_ARIA_ATTR!==!1,oe=ee.ALLOW_DATA_ATTR!==!1,be=ee.ALLOW_UNKNOWN_PROTOCOLS||!1,Ce=ee.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Te=ee.SAFE_FOR_TEMPLATES||!1,je=ee.SAFE_FOR_XML!==!1,$=ee.WHOLE_DOCUMENT||!1,He=ee.RETURN_DOM||!1,Se=ee.RETURN_DOM_FRAGMENT||!1,Ke=ee.RETURN_TRUSTED_TYPE||!1,ht=ee.FORCE_BODY||!1,Re=ee.SANITIZE_DOM!==!1,Qe=ee.SANITIZE_NAMED_PROPS||!1,it=ee.KEEP_CONTENT!==!1,nt=ee.IN_PLACE||!1,xe=ee.ALLOWED_URI_REGEXP||_g,Dt=ee.NAMESPACE||ct,dt=ee.MATHML_TEXT_INTEGRATION_POINTS||dt,Ut=ee.HTML_INTEGRATION_POINTS||Ut,X=ee.CUSTOM_ELEMENT_HANDLING||{},ee.CUSTOM_ELEMENT_HANDLING&&rt(ee.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(X.tagNameCheck=ee.CUSTOM_ELEMENT_HANDLING.tagNameCheck),ee.CUSTOM_ELEMENT_HANDLING&&rt(ee.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(X.attributeNameCheck=ee.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),ee.CUSTOM_ELEMENT_HANDLING&&typeof ee.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(X.allowCustomizedBuiltInElements=ee.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Te&&(oe=!1),Se&&(He=!0),at&&(ge=Lt({},lf),z=[],at.html===!0&&(Lt(ge,of),Lt(z,cf)),at.svg===!0&&(Lt(ge,tu),Lt(z,iu),Lt(z,_l)),at.svgFilters===!0&&(Lt(ge,nu),Lt(z,iu),Lt(z,_l)),at.mathMl===!0&&(Lt(ge,ru),Lt(z,uf),Lt(z,_l))),ee.ADD_TAGS&&(typeof ee.ADD_TAGS=="function"?pe.tagCheck=ee.ADD_TAGS:(ge===I&&(ge=fi(ge)),Lt(ge,ee.ADD_TAGS,Ct))),ee.ADD_ATTR&&(typeof ee.ADD_ATTR=="function"?pe.attributeCheck=ee.ADD_ATTR:(z===J&&(z=fi(z)),Lt(z,ee.ADD_ATTR,Ct))),ee.ADD_URI_SAFE_ATTR&&Lt(We,ee.ADD_URI_SAFE_ATTR,Ct),ee.FORBID_CONTENTS&&(ut===pt&&(ut=fi(ut)),Lt(ut,ee.FORBID_CONTENTS,Ct)),ee.ADD_FORBID_CONTENTS&&(ut===pt&&(ut=fi(ut)),Lt(ut,ee.ADD_FORBID_CONTENTS,Ct)),it&&(ge["#text"]=!0),$&&Lt(ge,["html","head","body"]),ge.table&&(Lt(ge,["tbody"]),delete Z.tbody),ee.TRUSTED_TYPES_POLICY){if(typeof ee.TRUSTED_TYPES_POLICY.createHTML!="function")throw ro('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof ee.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ro('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');L=ee.TRUSTED_TYPES_POLICY,K=L.createHTML("")}else L===void 0&&(L=rb(p,a)),L!==null&&typeof K=="string"&&(K=L.createHTML(""));or&&or(ee),Gn=ee}},Pr=Lt({},[...tu,...nu,...G2]),er=Lt({},[...ru,...V2]),cr=function(ee){let Ne=O(ee);(!Ne||!Ne.tagName)&&(Ne={namespaceURI:Dt,tagName:"template"});const Fe=Ol(ee.tagName),Wt=Ol(Ne.tagName);return jt[ee.namespaceURI]?ee.namespaceURI===bt?Ne.namespaceURI===ct?Fe==="svg":Ne.namespaceURI===Et?Fe==="svg"&&(Wt==="annotation-xml"||dt[Wt]):!!Pr[Fe]:ee.namespaceURI===Et?Ne.namespaceURI===ct?Fe==="math":Ne.namespaceURI===bt?Fe==="math"&&Ut[Wt]:!!er[Fe]:ee.namespaceURI===ct?Ne.namespaceURI===bt&&!Ut[Wt]||Ne.namespaceURI===Et&&!dt[Wt]?!1:!er[Fe]&&(kt[Fe]||!Pr[Fe]):!!(tt==="application/xhtml+xml"&&jt[ee.namespaceURI]):!1},It=function(ee){to(e.removed,{element:ee});try{O(ee).removeChild(ee)}catch{S(ee)}},Yt=function(ee,Ne){try{to(e.removed,{attribute:Ne.getAttributeNode(ee),from:Ne})}catch{to(e.removed,{attribute:null,from:Ne})}if(Ne.removeAttribute(ee),ee==="is")if(He||Se)try{It(Ne)}catch{}else try{Ne.setAttribute(ee,"")}catch{}},xn=function(ee){let Ne=null,Fe=null;if(ht)ee="<remove></remove>"+ee;else{const en=eu(ee,/^[\r\n\t ]+/);Fe=en&&en[0]}tt==="application/xhtml+xml"&&Dt===ct&&(ee='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+ee+"</body></html>");const Wt=L?L.createHTML(ee):ee;if(Dt===ct)try{Ne=new b().parseFromString(Wt,tt)}catch{}if(!Ne||!Ne.documentElement){Ne=te.createDocument(Dt,"template",null);try{Ne.documentElement.innerHTML=et?K:Wt}catch{}}const cn=Ne.body||Ne.documentElement;return ee&&Fe&&cn.insertBefore(n.createTextNode(Fe),cn.childNodes[0]||null),Dt===ct?F.call(Ne,$?"html":"body")[0]:$?Ne.documentElement:cn},ii=function(ee){return V.call(ee.ownerDocument||ee,ee,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},Ir=function(ee){return ee instanceof m&&(typeof ee.nodeName!="string"||typeof ee.textContent!="string"||typeof ee.removeChild!="function"||!(ee.attributes instanceof h)||typeof ee.removeAttribute!="function"||typeof ee.setAttribute!="function"||typeof ee.namespaceURI!="string"||typeof ee.insertBefore!="function"||typeof ee.hasChildNodes!="function")},ur=function(ee){return typeof l=="function"&&ee instanceof l};function Sn(Ue,ee,Ne){yl(Ue,Fe=>{Fe.call(e,ee,Ne,Gn)})}const dr=function(ee){let Ne=null;if(Sn(A.beforeSanitizeElements,ee,null),Ir(ee))return It(ee),!0;const Fe=Ct(ee.nodeName);if(Sn(A.uponSanitizeElement,ee,{tagName:Fe,allowedTags:ge}),je&&ee.hasChildNodes()&&!ur(ee.firstElementChild)&&sr(/<[/\w!]/g,ee.innerHTML)&&sr(/<[/\w!]/g,ee.textContent)||ee.nodeType===ao.progressingInstruction||je&&ee.nodeType===ao.comment&&sr(/<[/\w]/g,ee.data))return It(ee),!0;if(!(pe.tagCheck instanceof Function&&pe.tagCheck(Fe))&&(!ge[Fe]||Z[Fe])){if(!Z[Fe]&&tr(Fe)&&(X.tagNameCheck instanceof RegExp&&sr(X.tagNameCheck,Fe)||X.tagNameCheck instanceof Function&&X.tagNameCheck(Fe)))return!1;if(it&&!ut[Fe]){const Wt=O(ee)||ee.parentNode,cn=T(ee)||ee.childNodes;if(cn&&Wt){const en=cn.length;for(let Tn=en-1;Tn>=0;--Tn){const un=w(cn[Tn],!0);un.__removalCount=(ee.__removalCount||0)+1,Wt.insertBefore(un,x(ee))}}}return It(ee),!0}return ee instanceof c&&!cr(ee)||(Fe==="noscript"||Fe==="noembed"||Fe==="noframes")&&sr(/<\/no(script|embed|frames)/i,ee.innerHTML)?(It(ee),!0):(Te&&ee.nodeType===ao.text&&(Ne=ee.textContent,yl([k,M,j],Wt=>{Ne=no(Ne,Wt," ")}),ee.textContent!==Ne&&(to(e.removed,{element:ee.cloneNode()}),ee.textContent=Ne)),Sn(A.afterSanitizeElements,ee,null),!1)},hr=function(ee,Ne,Fe){if(Re&&(Ne==="id"||Ne==="name")&&(Fe in n||Fe in Tr))return!1;if(!(oe&&!ae[Ne]&&sr(U,Ne))){if(!(Y&&sr(re,Ne))){if(!(pe.attributeCheck instanceof Function&&pe.attributeCheck(Ne,ee))){if(!z[Ne]||ae[Ne]){if(!(tr(ee)&&(X.tagNameCheck instanceof RegExp&&sr(X.tagNameCheck,ee)||X.tagNameCheck instanceof Function&&X.tagNameCheck(ee))&&(X.attributeNameCheck instanceof RegExp&&sr(X.attributeNameCheck,Ne)||X.attributeNameCheck instanceof Function&&X.attributeNameCheck(Ne,ee))||Ne==="is"&&X.allowCustomizedBuiltInElements&&(X.tagNameCheck instanceof RegExp&&sr(X.tagNameCheck,Fe)||X.tagNameCheck instanceof Function&&X.tagNameCheck(Fe))))return!1}else if(!We[Ne]){if(!sr(xe,no(Fe,se,""))){if(!((Ne==="src"||Ne==="xlink:href"||Ne==="href")&&ee!=="script"&&q2(Fe,"data:")===0&&qe[ee])){if(!(be&&!sr(ce,no(Fe,se,"")))){if(Fe)return!1}}}}}}}return!0},tr=function(ee){return ee!=="annotation-xml"&&eu(ee,fe)},ai=function(ee){Sn(A.beforeSanitizeAttributes,ee,null);const{attributes:Ne}=ee;if(!Ne||Ir(ee))return;const Fe={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:z,forceKeepAttr:void 0};let Wt=Ne.length;for(;Wt--;){const cn=Ne[Wt],{name:en,namespaceURI:Tn,value:un}=cn,Rr=Ct(en),$i=un;let sn=en==="value"?$i:z2($i);if(Fe.attrName=Rr,Fe.attrValue=sn,Fe.keepAttr=!0,Fe.forceKeepAttr=void 0,Sn(A.uponSanitizeAttribute,ee,Fe),sn=Fe.attrValue,Qe&&(Rr==="id"||Rr==="name")&&(Yt(en,ee),sn=Ie+sn),je&&sr(/((--!?|])>)|<\/(style|title|textarea)/i,sn)){Yt(en,ee);continue}if(Rr==="attributename"&&eu(sn,"href")){Yt(en,ee);continue}if(Fe.forceKeepAttr)continue;if(!Fe.keepAttr){Yt(en,ee);continue}if(!Ce&&sr(/\/>/i,sn)){Yt(en,ee);continue}Te&&yl([k,M,j],ha=>{sn=no(sn,ha," ")});const da=Ct(ee.nodeName);if(!hr(da,Rr,sn)){Yt(en,ee);continue}if(L&&typeof p=="object"&&typeof p.getAttributeType=="function"&&!Tn)switch(p.getAttributeType(da,Rr)){case"TrustedHTML":{sn=L.createHTML(sn);break}case"TrustedScriptURL":{sn=L.createScriptURL(sn);break}}if(sn!==$i)try{Tn?ee.setAttributeNS(Tn,en,sn):ee.setAttribute(en,sn),Ir(ee)?It(ee):sf(e.removed)}catch{Yt(en,ee)}}Sn(A.afterSanitizeAttributes,ee,null)},Or=function Ue(ee){let Ne=null;const Fe=ii(ee);for(Sn(A.beforeSanitizeShadowDOM,ee,null);Ne=Fe.nextNode();)Sn(A.uponSanitizeShadowNode,Ne,null),dr(Ne),ai(Ne),Ne.content instanceof i&&Ue(Ne.content);Sn(A.afterSanitizeShadowDOM,ee,null)};return e.sanitize=function(Ue){let ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ne=null,Fe=null,Wt=null,cn=null;if(et=!Ue,et&&(Ue="<!-->"),typeof Ue!="string"&&!ur(Ue))if(typeof Ue.toString=="function"){if(Ue=Ue.toString(),typeof Ue!="string")throw ro("dirty is not a string, aborting")}else throw ro("toString is not a function");if(!e.isSupported)return Ue;if(Pe||mr(ee),e.removed=[],typeof Ue=="string"&&(nt=!1),nt){if(Ue.nodeName){const un=Ct(Ue.nodeName);if(!ge[un]||Z[un])throw ro("root node is forbidden and cannot be sanitized in-place")}}else if(Ue instanceof l)Ne=xn("<!---->"),Fe=Ne.ownerDocument.importNode(Ue,!0),Fe.nodeType===ao.element&&Fe.nodeName==="BODY"||Fe.nodeName==="HTML"?Ne=Fe:Ne.appendChild(Fe);else{if(!He&&!Te&&!$&&Ue.indexOf("<")===-1)return L&&Ke?L.createHTML(Ue):Ue;if(Ne=xn(Ue),!Ne)return He?null:Ke?K:""}Ne&&ht&&It(Ne.firstChild);const en=ii(nt?Ue:Ne);for(;Wt=en.nextNode();)dr(Wt),ai(Wt),Wt.content instanceof i&&Or(Wt.content);if(nt)return Ue;if(He){if(Se)for(cn=q.call(Ne.ownerDocument);Ne.firstChild;)cn.appendChild(Ne.firstChild);else cn=Ne;return(z.shadowroot||z.shadowrootmode)&&(cn=C.call(r,cn,!0)),cn}let Tn=$?Ne.outerHTML:Ne.innerHTML;return $&&ge["!doctype"]&&Ne.ownerDocument&&Ne.ownerDocument.doctype&&Ne.ownerDocument.doctype.name&&sr(wg,Ne.ownerDocument.doctype.name)&&(Tn="<!DOCTYPE "+Ne.ownerDocument.doctype.name+`>
`+Tn),Te&&yl([k,M,j],un=>{Tn=no(Tn,un," ")}),L&&Ke?L.createHTML(Tn):Tn},e.setConfig=function(){let Ue=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};mr(Ue),Pe=!0},e.clearConfig=function(){Gn=null,Pe=!1},e.isValidAttribute=function(Ue,ee,Ne){Gn||mr({});const Fe=Ct(Ue),Wt=Ct(ee);return hr(Fe,Wt,Ne)},e.addHook=function(Ue,ee){typeof ee=="function"&&to(A[Ue],ee)},e.removeHook=function(Ue,ee){if(ee!==void 0){const Ne=U2(A[Ue],ee);return Ne===-1?void 0:$2(A[Ue],Ne,1)[0]}return sf(A[Ue])},e.removeHooks=function(Ue){A[Ue]=[]},e.removeAllHooks=function(){A=hf()},e}var Jl=xg();const ib=Object.freeze(Object.defineProperty({__proto__:null,default:Jl},Symbol.toStringTag,{value:"Module"})),ff=[{num:1,label:"Empfaenger"},{num:2,label:"Inhalt"},{num:3,label:"Vorschau & Senden"}],ab=[{tag:"{{vorname}}",label:"Vorname"},{tag:"{{nachname}}",label:"Nachname"},{tag:"{{firma}}",label:"Firma"},{tag:"{{email}}",label:"E-Mail"}];function sb(){var pe;const t=Qn(),{contacts:e,loading:n}=lc(),{companies:r}=cc(),a=Hp(null),[i,o]=me(1),[l,c]=me({name:"",subject:"",body_html:""}),[d,h]=me({}),[m,b]=me(""),[p,_]=me(""),[w,S]=me(!1),[x,T]=me(!1),[O,L]=me(!1),[K,te]=me(""),[V,q]=me(!1);function F(Y,oe){c(be=>({...be,[Y]:oe}))}function C(Y){const oe=Zh.find(be=>be.id===Y);oe&&c(be=>({...be,subject:oe.subject||be.subject,body_html:oe.body}))}function A(Y){const oe=a.current;if(!oe){F("body_html",l.body_html+Y);return}const be=oe.selectionStart,Ce=oe.selectionEnd,Te=l.body_html,je=Te.substring(0,be)+Y+Te.substring(Ce);F("body_html",je),requestAnimationFrame(()=>{oe.focus(),oe.selectionStart=oe.selectionEnd=be+Y.length})}const k=fo(()=>e.filter(Y=>Y.email),[e]),M=fo(()=>{let Y=k;if(p&&(Y=Y.filter(oe=>oe.company_id===p)),m){const oe=m.toLowerCase();Y=Y.filter(be=>{var Ce;return(be.first_name||"").toLowerCase().includes(oe)||(be.last_name||"").toLowerCase().includes(oe)||(be.email||"").toLowerCase().includes(oe)||(((Ce=be.company)==null?void 0:Ce.name)||"").toLowerCase().includes(oe)})}return Y},[k,m,p]),j=Object.keys(d).length;function U(Y){h(oe=>{const be={...oe};return be[Y]?delete be[Y]:be[Y]=!0,be})}function re(){const Y={};k.forEach(oe=>{Y[oe.id]=!0}),h(Y)}function ce(){h({})}const se=M.length>0&&M.every(Y=>d[Y.id]);function fe(){h(Y=>{const oe={...Y};return se?M.forEach(be=>{delete oe[be.id]}):M.forEach(be=>{oe[be.id]=!0}),oe})}const xe=fo(()=>k.filter(Y=>d[Y.id]),[k,d]),ge=xe.length>0?{vorname:xe[0].first_name||"Max",nachname:xe[0].last_name||"Mustermann",firma:((pe=xe[0].company)==null?void 0:pe.name)||"Musterfirma GmbH",email:xe[0].email}:{vorname:"Max",nachname:"Mustermann",firma:"Musterfirma GmbH",email:"max@example.de"},I=l.body_html.replace(/\{\{vorname\}\}/gi,ge.vorname).replace(/\{\{nachname\}\}/gi,ge.nachname).replace(/\{\{firma\}\}/gi,ge.firma).replace(/\{\{email\}\}/gi,ge.email);async function z(){if(!l.name||!l.subject||!l.body_html){t.error("Name, Betreff und Inhalt sind Pflichtfelder");return}S(!0);try{const{data:Y,error:oe}=await Zc({name:l.name,subject:l.subject,body_html:l.body_html,filters:{}});if(oe)throw oe;await rf(Y.id,xe),t.success("Kampagne gespeichert"),ze(`/crm/campaigns/${Y.id}`)}catch(Y){t.error(Y.message||"Fehler beim Speichern")}S(!1)}async function J(){if(!l.name||!l.subject||!l.body_html){t.error("Name, Betreff und Inhalt sind Pflichtfelder");return}if(xe.length===0){t.error("Keine Empfaenger ausgewaehlt");return}S(!0);try{const{data:Y,error:oe}=await Zc({name:l.name,subject:l.subject,body_html:l.body_html,filters:{}});if(oe)throw oe;await rf(Y.id,xe);const be=await Ku(Y.id);t.success(`Kampagne gesendet an ${be.total_sent} Empfaenger`),ze(`/crm/campaigns/${Y.id}`)}catch(Y){t.error(Y.message||"Fehler beim Senden")}S(!1),L(!1)}async function X(){if(!K){t.error("Bitte Test-E-Mail-Adresse eingeben");return}if(!l.subject||!l.body_html){t.error("Betreff und Inhalt muessen ausgefuellt sein");return}q(!0);try{const{data:Y,error:oe}=await Zc({name:l.name||"Test-Kampagne",subject:l.subject,body_html:l.body_html,filters:{}});if(oe)throw oe;await Ku(Y.id,{testEmail:K}),t.success(`Test-Mail an ${K} gesendet`)}catch(Y){t.error(Y.message||"Test-Mail fehlgeschlagen")}q(!1)}function Z(){return j>0}function ae(){return l.name&&l.subject&&l.body_html}return s(At,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/campaigns"),children:""}),s("h1",{class:"page-title",children:"Neue Kampagne"})]})}),s("div",{class:"page-body",children:[s("div",{style:"display:flex;align-items:center;gap:0;margin-bottom:1.5rem;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;",children:ff.map((Y,oe)=>s("button",{onClick:()=>{Y.num===2&&!Z()||Y.num===3&&(!Z()||!ae())||o(Y.num)},style:`
                flex:1;padding:0.875rem 1rem;border:none;cursor:pointer;
                font-size:0.875rem;font-weight:${i===Y.num?"600":"500"};
                background:${i===Y.num?"var(--primary)":i>Y.num?"rgba(26,92,107,0.08)":"transparent"};
                color:${i===Y.num?"#fff":i>Y.num?"var(--primary)":"var(--text-muted)"};
                border-right:${oe<ff.length-1?"1px solid var(--border)":"none"};
                transition:all 0.15s;
                display:flex;align-items:center;justify-content:center;gap:0.5rem;
              `,children:[s("span",{style:`
                width:24px;height:24px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;
                font-size:0.75rem;font-weight:700;
                background:${i===Y.num?"rgba(255,255,255,0.2)":i>Y.num?"var(--primary)":"var(--border)"};
                color:${i===Y.num||i>Y.num?"#fff":"var(--text-muted)"};
              `,children:i>Y.num?"":Y.num}),s("span",{class:"hide-mobile-sm",children:Y.label})]},Y.num))}),i===1&&s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Empfaenger waehlen"}),s("span",{style:"font-size:0.85rem;color:var(--text-muted)",children:[k.length," Kontakte verfuegbar"]})]}),s("div",{style:"display:flex;gap:0.75rem;margin-bottom:1rem;flex-wrap:wrap;align-items:end;",children:[s("div",{style:"flex:1;min-width:200px;",children:[s("label",{children:"Suche"}),s("input",{value:m,onInput:Y=>b(Y.target.value),placeholder:"Name, E-Mail oder Firma..."})]}),s("div",{style:"min-width:180px;",children:[s("label",{children:"Firma"}),s("select",{value:p,onChange:Y=>_(Y.target.value),children:[s("option",{value:"",children:"Alle Firmen"}),r.map(Y=>s("option",{value:Y.id,children:Y.name},Y.id))]})]}),s("div",{style:"display:flex;gap:0.5rem;",children:[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:re,children:"Alle waehlen"}),s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:ce,children:"Keine"})]})]}),n?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):M.length===0?s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:k.length===0?"Keine Kontakte mit E-Mail-Adresse vorhanden":"Keine Treffer fuer diese Suche"})}):s("div",{style:"border:1px solid var(--border);border-radius:var(--radius);max-height:500px;overflow-y:auto;",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem;padding:0.6rem 0.75rem;border-bottom:1px solid var(--border);background:var(--bg-hover);font-size:0.75rem;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.05em;position:sticky;top:0;z-index:1;",children:[s("input",{type:"checkbox",checked:se,onChange:fe,style:"width:16px;height:16px;flex-shrink:0;cursor:pointer;"}),s("span",{style:"flex:1;",children:"Name"}),s("span",{style:"flex:1;",class:"hide-mobile-sm",children:"E-Mail"}),s("span",{style:"width:140px;",class:"hide-mobile-sm",children:"Firma"})]}),M.map(Y=>{var Ce;const oe=!!d[Y.id],be=`${Y.first_name||""} ${Y.last_name||""}`.trim()||Y.email;return s("label",{style:`display:flex;align-items:center;gap:0.75rem;padding:0.6rem 0.75rem;border-bottom:1px solid var(--border);cursor:pointer;font-size:0.875rem;transition:background 0.1s;${oe?"background:rgba(26,92,107,0.06);":""}`,children:[s("input",{type:"checkbox",checked:oe,onChange:()=>U(Y.id),style:"width:16px;height:16px;flex-shrink:0;cursor:pointer;"}),s("span",{style:"flex:1;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;",children:be}),s("span",{style:"flex:1;color:var(--text-muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;",class:"hide-mobile-sm",children:Y.email}),s("span",{style:"width:140px;color:var(--text-muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;",class:"hide-mobile-sm",children:((Ce=Y.company)==null?void 0:Ce.name)||""})]},Y.id)})]}),s("div",{style:"display:flex;align-items:center;justify-content:space-between;margin-top:1rem;flex-wrap:wrap;gap:0.75rem;",children:[s("div",{style:"padding:0.5rem 1rem;background:var(--bg-hover);border-radius:var(--radius);font-size:0.875rem;",children:[s("strong",{children:j})," von ",k.length," Empfaenger ausgewaehlt"]}),s("button",{class:"btn btn-primary",onClick:()=>o(2),disabled:!Z(),children:"Weiter "})]})]}),i===2&&s("div",{style:"display:flex;flex-direction:column;gap:1.5rem;",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Kampagne"})}),s("div",{class:"form-group",style:"margin:0;",children:[s("label",{children:"Name (intern)"}),s("input",{value:l.name,onInput:Y=>F("name",Y.target.value),placeholder:"z.B. Follow-up Februar 2026"})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Vorlage waehlen"})}),s("div",{style:"display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:0.75rem;",children:Zh.map(Y=>s("button",{onClick:()=>C(Y.id),style:`
                      display:flex;flex-direction:column;align-items:center;gap:0.5rem;
                      padding:1rem;border-radius:var(--radius);border:1px solid var(--border);
                      background:var(--bg-card);cursor:pointer;transition:all 0.15s;text-align:center;
                    `,onMouseEnter:oe=>{oe.currentTarget.style.borderColor="var(--primary)",oe.currentTarget.style.background="rgba(26,92,107,0.04)"},onMouseLeave:oe=>{oe.currentTarget.style.borderColor="var(--border)",oe.currentTarget.style.background="var(--bg-card)"},children:[s("span",{style:"font-size:1.5rem;",children:Y.icon||""}),s("span",{style:"font-weight:600;font-size:0.85rem;color:var(--text);",children:Y.name}),Y.preview&&s("span",{style:"font-size:0.75rem;color:var(--text-muted);line-height:1.3;",children:Y.preview})]},Y.id))})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Betreff"})}),s("input",{value:l.subject,onInput:Y=>F("subject",Y.target.value),placeholder:"Betreff der E-Mail"})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"Inhalt (HTML)"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>T(!x),children:x?"Editor":"Vorschau"})]}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.75rem;",children:[s("span",{style:"font-size:0.75rem;color:var(--text-dim);display:flex;align-items:center;",children:"Platzhalter:"}),ab.map(Y=>s("button",{type:"button",onClick:()=>A(Y.tag),style:"padding:0.2rem 0.6rem;border-radius:999px;font-size:0.75rem;font-weight:500;background:rgba(26,92,107,0.08);color:var(--primary);border:1px solid rgba(26,92,107,0.2);cursor:pointer;transition:all 0.15s;",onMouseEnter:oe=>{oe.currentTarget.style.background="rgba(26,92,107,0.15)"},onMouseLeave:oe=>{oe.currentTarget.style.background="rgba(26,92,107,0.08)"},children:Y.label},Y.tag))]}),x?s("div",{style:"border:1px solid var(--border);border-radius:8px;padding:1rem;background:#fff;min-height:300px;",dangerouslySetInnerHTML:{__html:Jl.sanitize(I)}}):s("textarea",{ref:a,value:l.body_html,onInput:Y=>F("body_html",Y.target.value),style:"width:100%;min-height:350px;font-family:monospace;font-size:0.8rem;border:1px solid var(--border);border-radius:8px;padding:0.75rem;",placeholder:"HTML-Inhalt der E-Mail..."})]}),s("div",{style:"display:flex;justify-content:space-between;",children:[s("button",{class:"btn btn-secondary",onClick:()=>o(1),children:" Zurueck"}),s("button",{class:"btn btn-primary",onClick:()=>o(3),disabled:!ae(),children:"Weiter "})]})]}),i===3&&s("div",{style:"display:flex;flex-direction:column;gap:1.5rem;",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Zusammenfassung"})}),s("div",{style:"display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;",children:[s("div",{style:"padding:1rem;background:var(--bg-hover);border-radius:var(--radius);text-align:center;",children:[s("div",{style:"font-size:1.75rem;font-weight:700;",children:j}),s("div",{style:"font-size:0.8rem;color:var(--text-muted);",children:"Empfaenger"})]}),s("div",{style:"padding:1rem;background:var(--bg-hover);border-radius:var(--radius);",children:[s("div",{style:"font-size:0.7rem;font-weight:600;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.25rem;",children:"Kampagne"}),s("div",{style:"font-weight:500;",children:l.name})]}),s("div",{style:"padding:1rem;background:var(--bg-hover);border-radius:var(--radius);",children:[s("div",{style:"font-size:0.7rem;font-weight:600;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.25rem;",children:"Betreff"}),s("div",{style:"font-weight:500;",children:l.subject})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:[s("span",{class:"card-title",children:"E-Mail-Vorschau"}),xe.length>0&&s("span",{style:"font-size:0.75rem;color:var(--text-dim);",children:["Personalisiert fuer: ",ge.vorname," ",ge.nachname]})]}),s("div",{style:"border:1px solid var(--border);border-radius:8px;padding:1rem;background:#fff;max-height:500px;overflow:auto;",dangerouslySetInnerHTML:{__html:Jl.sanitize(I)}})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Test-Mail senden"})}),s("div",{style:"display:flex;gap:0.75rem;align-items:end;flex-wrap:wrap;",children:[s("div",{style:"flex:1;min-width:200px;",children:[s("label",{children:"E-Mail-Adresse"}),s("input",{type:"email",value:K,onInput:Y=>te(Y.target.value),placeholder:"rundgang@beck360.de"})]}),s("button",{class:"btn btn-secondary",onClick:X,disabled:V,style:"white-space:nowrap;",children:V?"Sende...":"Test senden"})]})]}),s("div",{style:"display:flex;justify-content:space-between;flex-wrap:wrap;gap:0.75rem;",children:[s("button",{class:"btn btn-secondary",onClick:()=>o(2),children:" Zurueck"}),s("div",{style:"display:flex;gap:0.75rem;",children:[s("button",{class:"btn btn-secondary",onClick:z,disabled:w,children:w?"Speichere...":"Als Entwurf speichern"}),s("button",{class:"btn btn-primary",onClick:()=>L(!0),disabled:w||j===0,children:"Jetzt senden"})]})]})]})]}),O&&s(Ua,{title:"Kampagne senden?",onClose:()=>L(!1),children:[s("p",{style:"margin-bottom:1rem;",children:['Die Kampagne "',s("strong",{children:l.name}),'" wird an ',s("strong",{children:[j," Empfaenger"]})," gesendet. Dieser Vorgang kann nicht rueckgaengig gemacht werden."]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary",onClick:()=>L(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary",onClick:J,disabled:w,children:w?"Sende...":"Jetzt senden"})]})]})]})}const au={pending:{label:"Ausstehend",color:"#6366f1"},sent:{label:"Gesendet",color:"#3b82f6"},opened:{label:"Geoeffnet",color:"#10b981"},clicked:{label:"Geklickt",color:"#059669"},bounced:{label:"Bounce",color:"#ef4444"},unsubscribed:{label:"Abgemeldet",color:"#94a3b8"}};function ob({id:t}){var C,A,k,M;const{campaign:e,loading:n,update:r,refetch:a,remove:i}=O2(t),{recipients:o,loading:l,refetch:c}=R2(t),d=Qn(),[h,m]=me(!1),[b,p]=me({}),[_,w]=me(!1),[S,x]=me(!1),[T,O]=me(!1);if(n)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Kampagne"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Nicht gefunden"})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Kampagne nicht gefunden"})})})]});function L(){p({name:e.name||"",subject:e.subject||"",body_html:e.body_html||""}),m(!0)}async function K(){const{error:j}=await r(b);j?d.error("Fehler beim Speichern"):(d.success("Kampagne aktualisiert"),m(!1))}async function te(){x(!0);try{const j=await Ku(e.id);d.success(`Kampagne gesendet an ${j.total_sent} Empfaenger`),a(),c()}catch(j){d.error(j.message||"Senden fehlgeschlagen")}x(!1),w(!1)}async function V(){const{error:j}=await i();j?d.error("Fehler beim Loeschen"):(d.success("Kampagne geloescht"),ze("/crm/campaigns"))}const q=e.total_sent>0?Math.round(e.total_opened/e.total_sent*100):0,F=e.total_sent>0?Math.round(e.total_clicked/e.total_sent*100):0;return s(At,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/campaigns"),children:""}),s("h1",{class:"page-title",children:e.name}),s("span",{class:"stage-badge",style:`background:${((C=la[e.status])==null?void 0:C.color)||"#6366f1"}15;color:${((A=la[e.status])==null?void 0:A.color)||"#6366f1"};`,children:((k=la[e.status])==null?void 0:k.label)||e.status})]}),s("div",{style:"display:flex;gap:0.5rem",children:e.status==="draft"&&s(At,{children:[!h&&s("button",{class:"btn btn-secondary btn-sm",onClick:L,children:"Bearbeiten"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>w(!0),children:"Senden"}),s("button",{class:"btn btn-danger btn-sm",onClick:()=>O(!0),children:"Loeschen"})]})})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[e.status==="sent"&&s("div",{style:"display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1rem;",children:[s("div",{class:"card",style:"text-align:center;padding:1.25rem;",children:[s("div",{class:"kpi-value",children:e.total_sent}),s("div",{class:"kpi-label",children:"Gesendet"})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem;",children:[s("div",{class:"kpi-value",children:[e.total_opened," ",s("span",{style:"font-size:0.85rem;color:var(--text-dim)",children:["(",q,"%)"]})]}),s("div",{class:"kpi-label",children:"Geoeffnet"})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem;",children:[s("div",{class:"kpi-value",children:[e.total_clicked," ",s("span",{style:"font-size:0.85rem;color:var(--text-dim)",children:["(",F,"%)"]})]}),s("div",{class:"kpi-label",children:"Geklickt"})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Kampagnen-Details"})}),h?s("div",{children:[s("div",{class:"form-grid",children:[s("div",{class:"form-group form-group-full",children:[s("label",{children:"Name"}),s("input",{value:b.name,onInput:j=>p({...b,name:j.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Betreff"}),s("input",{value:b.subject,onInput:j=>p({...b,subject:j.target.value})})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Inhalt (HTML)"}),s("textarea",{value:b.body_html,onInput:j=>p({...b,body_html:j.target.value}),style:"width:100%;min-height:200px;font-family:monospace;font-size:0.8rem;"})]})]}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>m(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary btn-sm",onClick:K,children:"Speichern"})]})]}):s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Betreff"}),s("span",{class:"detail-value",children:e.subject})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:bl(e.created_at)})]}),e.sent_at&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Gesendet am"}),s("span",{class:"detail-value",children:bl(e.sent_at)})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"E-Mail-Vorschau"})}),s("div",{style:"border:1px solid var(--border);border-radius:8px;padding:1rem;background:#fff;max-height:400px;overflow:auto;",dangerouslySetInnerHTML:{__html:Jl.sanitize(e.body_html)}})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Empfaenger (",o.length,")"]})}),l?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):o.length===0?s("div",{style:"color:var(--text-dim);font-size:0.85rem",children:"Keine Empfaenger"}):s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Name"}),s("th",{children:"E-Mail"}),s("th",{children:"Status"}),s("th",{children:"Geoeffnet"}),s("th",{children:"Geklickt"})]})}),s("tbody",{children:o.map(j=>{var U,re,ce;return s("tr",{children:[s("td",{children:j.contact?s("a",{href:"#",onClick:se=>{se.preventDefault(),ze(`/crm/contacts/${j.contact_id}`)},children:`${j.contact.first_name||""} ${j.contact.last_name||""}`.trim()||j.email}):j.email}),s("td",{children:j.email}),s("td",{children:s("span",{class:"stage-badge",style:`background:${((U=au[j.status])==null?void 0:U.color)||"#6366f1"}15;color:${((re=au[j.status])==null?void 0:re.color)||"#6366f1"};`,children:((ce=au[j.status])==null?void 0:ce.label)||j.status})}),s("td",{style:"color:var(--text-dim)",children:j.opened_at?bl(j.opened_at):""}),s("td",{style:"color:var(--text-dim)",children:j.clicked_at?bl(j.clicked_at):""})]},j.id)})})]})})]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Status"}),s("span",{class:"detail-value",children:(M=la[e.status])==null?void 0:M.label})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt"}),s("span",{class:"detail-value",children:Cn(e.created_at)})]}),e.sent_at&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Gesendet"}),s("span",{class:"detail-value",children:Cn(e.sent_at)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Empfaenger"}),s("span",{class:"detail-value",children:o.length})]})]})})]})}),_&&s(Ua,{title:"Kampagne senden?",onClose:()=>w(!1),children:[s("p",{style:"margin-bottom:1rem;",children:['Die Kampagne "',s("strong",{children:e.name}),'" wird jetzt versendet. Nur Kontakte mit DSGVO-Einwilligung erhalten die E-Mail.']}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary",onClick:()=>w(!1),children:"Abbrechen"}),s("button",{class:"btn btn-primary",onClick:te,disabled:S,children:S?"Sende...":"Jetzt senden"})]})]}),T&&s(Ua,{title:"Kampagne loeschen?",onClose:()=>O(!1),children:[s("p",{style:"margin-bottom:1rem;",children:['Die Kampagne "',s("strong",{children:e.name}),'" wird unwiderruflich geloescht.']}),s("div",{class:"form-actions",children:[s("button",{class:"btn btn-secondary",onClick:()=>O(!1),children:"Abbrechen"}),s("button",{class:"btn btn-danger",onClick:V,children:"Loeschen"})]})]})]})}function lb(){const[t,e]=me(null),[n,r]=me(null),{invoices:a,loading:i,refetch:o}=vd({type:t,status:n}),[l,c]=me(new Set),[d,h]=me(!1),m=Qn();function b(w,S){S.stopPropagation(),c(x=>{const T=new Set(x);return T.has(w)?T.delete(w):T.add(w),T})}function p(){l.size===a.length?c(new Set):c(new Set(a.map(w=>w.id)))}async function _(){if(l.size===0||!confirm(`${l.size} Dokument${l.size>1?"e":""} wirklich loeschen?`))return;h(!0);let w=0;for(const S of l){const{error:x}=await mg(S);x&&w++}h(!1),c(new Set),await o(),w?m.error(`${w} Fehler beim Loeschen`):m.success(`${l.size===0?"":"Geloescht"}`)}return s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Rechnungen & Angebote"}),s("div",{style:"display:flex;gap:0.5rem;align-items:center",children:[l.size>0&&s("button",{class:"btn btn-danger btn-sm",onClick:_,disabled:d,children:d?"Loesche...":`${l.size} loeschen`}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze("/crm/invoices/new?type=invoice"),children:"+ Rechnung"}),s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/invoices/new?type=quote"),children:"+ Angebot"})]})]}),s("div",{class:"page-body",children:[s("div",{class:"search-bar",children:[s("div",{class:"filter-pills",children:[s("button",{class:`filter-pill ${t?"":"active"}`,onClick:()=>e(null),children:"Alle"}),Object.entries(ks).map(([w,S])=>s("button",{class:`filter-pill ${t===w?"active":""}`,onClick:()=>e(t===w?null:w),children:S.label},w))]}),s("div",{class:"filter-pills",children:Object.entries(Zn).map(([w,S])=>s("button",{class:`filter-pill ${n===w?"active":""}`,onClick:()=>r(n===w?null:w),children:S.label},w))})]}),i?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):a.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Rechnungen oder Angebote"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{style:"width:2.5rem;padding-right:0",children:s("input",{type:"checkbox",checked:l.size===a.length,onChange:p,style:"cursor:pointer"})}),s("th",{children:"Nummer"}),s("th",{children:"Typ"}),s("th",{children:"Kunde"}),s("th",{children:"Datum"}),s("th",{children:"Status"}),s("th",{style:"text-align:right",children:"Betrag"})]})}),s("tbody",{children:a.map(w=>{var S,x,T,O;return s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/invoices/${w.id}`),style:l.has(w.id)?"background:var(--brand-light, rgba(26,92,107,0.08))":"",children:[s("td",{style:"padding-right:0",onClick:L=>L.stopPropagation(),children:s("input",{type:"checkbox",checked:l.has(w.id),onChange:L=>b(w.id,L),style:"cursor:pointer"})}),s("td",{"data-label":"Nummer",style:"font-weight:600",children:w.invoice_number}),s("td",{"data-label":"Typ",children:s("span",{style:`font-size:0.75rem;padding:0.15rem 0.5rem;border-radius:999px;background:${w.type==="quote"?"rgba(139,92,246,0.15);color:#a78bfa":"rgba(59,130,246,0.15);color:#60a5fa"}`,children:(S=ks[w.type])==null?void 0:S.label})}),s("td",{"data-label":"Kunde",children:w.customer_company||w.customer_name||""}),s("td",{"data-label":"Datum",children:Cn(w.invoice_date)}),s("td",{"data-label":"Status",children:s("span",{class:"stage-badge",style:`color:${(x=Zn[w.status])==null?void 0:x.color};background:${(T=Zn[w.status])==null?void 0:T.color}20`,children:(O=Zn[w.status])==null?void 0:O.label})}),s("td",{"data-label":"Betrag",style:"text-align:right;font-weight:600",children:De(w.total_amount)})]},w.id)})})]})})})]})]})}function cb({items:t,onChange:e}){function n(o,l,c){const d=t.map((h,m)=>m===o?{...h,[l]:c}:h);e(d)}function r(){e([...t,{description:"",sub_description:"",quantity:1,unit_price:0}])}function a(o){e(t.filter((l,c)=>c!==o))}function i(o){return(parseFloat(o)||0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})+" "}return s("div",{children:[s("div",{class:"table-wrapper",children:s("table",{class:"line-items-table",children:[s("thead",{children:s("tr",{children:[s("th",{style:"width:40%",children:"Bezeichnung"}),s("th",{style:"width:15%",children:"Menge"}),s("th",{style:"width:20%",children:"Einzelpreis"}),s("th",{style:"width:15%;text-align:right",children:"Gesamt"}),s("th",{style:"width:10%"})]})}),s("tbody",{children:t.map((o,l)=>{const c=(parseFloat(o.quantity)||0)*(parseFloat(o.unit_price)||0);return s("tr",{children:[s("td",{children:[s("input",{value:o.description,onInput:d=>n(l,"description",d.target.value),placeholder:"Leistung / Produkt",required:!0}),s("input",{value:o.sub_description||"",onInput:d=>n(l,"sub_description",d.target.value),placeholder:"Zusatzinfo (optional)",style:"margin-top:0.25rem;font-size:0.8rem;color:var(--text-muted)"})]}),s("td",{children:s("input",{type:"number",step:"0.01",min:"0",value:o.quantity,onInput:d=>n(l,"quantity",d.target.value),style:"text-align:right"})}),s("td",{children:s("input",{type:"number",step:"0.01",min:"0",value:o.unit_price,onInput:d=>n(l,"unit_price",d.target.value),style:"text-align:right"})}),s("td",{style:"text-align:right;white-space:nowrap;font-weight:500",children:i(c)}),s("td",{style:"text-align:center",children:s("button",{type:"button",class:"btn btn-danger btn-sm",onClick:()=>a(l),title:"Entfernen",children:"x"})})]},l)})})]})}),s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:r,style:"margin-top:0.75rem",children:"+ Position"})]})}function ub(){const t=Qn(),{settings:e}=sc(),n=new URLSearchParams(window.location.search),r=n.get("type")||"invoice",a=n.get("deal_id"),i=n.get("quote_id"),o=n.get("edit"),{invoice:l,items:c,loading:d}=gg(o),[h,m]=me(!1),[b,p]=me([]),[_,w]=me([]),[S,x]=me({type:r,invoice_number:"",invoice_date:new Date().toISOString().slice(0,10),due_date:"",company_id:"",contact_id:"",deal_id:a||"",customer_company:"",customer_name:"",customer_street:"",customer_zip:"",customer_city:"",customer_number:"",discount_percent:0,vat_rate:19,payment_terms:"Diese Rechnung ist zahlbar innerhalb von 14 Tagen ohne Abzug auf das unten angegebene Bankkonto.",closing_message:"",intro_text:"",notes:""}),[T,O]=me([{description:"",sub_description:"",quantity:1,unit_price:0}]);Mt(()=>{Le.from("companies").select("id, name, address, city").is("deleted_at",null).order("name").then(({data:C})=>p(C||[])),Le.from("contacts").select("id, first_name, last_name, email, company_id").is("deleted_at",null).order("last_name").then(({data:C})=>w(C||[]))},[]),Mt(()=>{if(e&&!o&&!i){const C=new Date;C.setDate(C.getDate()+(e.default_payment_days||14)),x(A=>{const M=A.type==="quote"?e.default_quote_intro||"Vielen Dank fuer Ihr Interesse. Gerne unterbreite ich Ihnen folgendes Angebot:":e.default_invoice_intro||"Vielen Dank fuer Ihren Auftrag. Ich berechne Ihnen fuer folgende Leistungen:";return{...A,vat_rate:parseFloat(e.vat_rate)||19,due_date:A.due_date||C.toISOString().slice(0,10),closing_message:A.closing_message||e.default_closing_text||"",intro_text:A.intro_text||M}})}},[e,o,i]),Mt(()=>{!a||o||Le.from("deals").select("*, contact:contacts(id, first_name, last_name), company:companies(id, name, address, city)").eq("id",a).single().then(({data:C})=>{if(!C)return;const A=C.contact?`${C.contact.first_name||""} ${C.contact.last_name||""}`.trim():"";x(k=>{var M,j,U,re,ce,se;return{...k,deal_id:C.id,company_id:((M=C.company)==null?void 0:M.id)||"",contact_id:((j=C.contact)==null?void 0:j.id)||"",customer_company:((U=C.company)==null?void 0:U.name)||"",customer_name:A,customer_street:((re=C.company)==null?void 0:re.address)||"",customer_city:((ce=C.company)==null?void 0:ce.city)||"",invoice_number:Pl(r,(se=C.company)==null?void 0:se.name,A)}})})},[a,r,o]),Mt(()=>{i&&Promise.all([Le.from("invoices").select("*").eq("id",i).single(),Le.from("invoice_items").select("*").eq("invoice_id",i).order("position")]).then(([{data:C},{data:A}])=>{C&&(x(k=>({...k,type:"invoice",invoice_number:Pl("invoice",C.customer_company,C.customer_name),company_id:C.company_id||"",contact_id:C.contact_id||"",deal_id:C.deal_id||"",customer_company:C.customer_company||"",customer_name:C.customer_name||"",customer_street:C.customer_street||"",customer_zip:C.customer_zip||"",customer_city:C.customer_city||"",customer_number:C.customer_number||"",discount_percent:C.discount_percent||0,vat_rate:C.vat_rate||19,payment_terms:C.payment_terms||k.payment_terms,closing_message:C.closing_message||k.closing_message,intro_text:C.intro_text||"",notes:C.notes||""})),A&&A.length>0&&O(A.map(k=>({description:k.description,sub_description:k.sub_description||"",quantity:k.quantity,unit_price:k.unit_price}))))})},[i]),Mt(()=>{!o||d||!l||(x({type:l.type,invoice_number:l.invoice_number,invoice_date:l.invoice_date,due_date:l.due_date||"",company_id:l.company_id||"",contact_id:l.contact_id||"",deal_id:l.deal_id||"",customer_company:l.customer_company||"",customer_name:l.customer_name||"",customer_street:l.customer_street||"",customer_zip:l.customer_zip||"",customer_city:l.customer_city||"",customer_number:l.customer_number||"",discount_percent:l.discount_percent||0,vat_rate:l.vat_rate||19,payment_terms:l.payment_terms||"",closing_message:l.closing_message||"",intro_text:l.intro_text||"",notes:l.notes||""}),c.length>0&&O(c.map(C=>({description:C.description,sub_description:C.sub_description||"",quantity:C.quantity,unit_price:C.unit_price}))))},[o,d,l,c]),Mt(()=>{o||i||!S.customer_name&&!S.customer_company||x(C=>({...C,invoice_number:Pl(C.type,C.customer_company,C.customer_name)}))},[S.type,S.customer_name,S.customer_company,o,i]);function L(C){const A=b.find(k=>k.id===C);x(k=>({...k,company_id:C,customer_company:(A==null?void 0:A.name)||k.customer_company,customer_street:(A==null?void 0:A.address)||k.customer_street,customer_city:(A==null?void 0:A.city)||k.customer_city}))}function K(C){const A=_.find(M=>M.id===C);if(!A)return;const k=`${A.first_name||""} ${A.last_name||""}`.trim();x(M=>({...M,contact_id:C,customer_name:k,company_id:A.company_id||M.company_id})),A.company_id&&!S.company_id&&L(A.company_id)}const te=r2(T,S.discount_percent,S.vat_rate),V=S.type==="quote",q=o?`${V?"Angebot":"Rechnung"} bearbeiten`:i?"Rechnung aus Angebot erstellen":`Neue${V?"s Angebot":" Rechnung"} erstellen`;async function F(C){var A;if(C.preventDefault(),T.length===0||!T.some(k=>k.description)){t.error("Mindestens eine Position erforderlich");return}m(!0);try{const k={...S,company_id:S.company_id||null,contact_id:S.contact_id||null,deal_id:S.deal_id||null,subtotal:te.subtotal,net_amount:te.net_amount,vat_amount:te.vat_amount,total_amount:te.total_amount,due_date:S.due_date||null};let M;o?(M=await a2(o,k,T),M.error||(t.success("Gespeichert"),ze(`/crm/invoices/${o}`))):(i&&(k.converted_from_quote_id=i),M=await i2(k,T),!M.error&&((A=M.data)!=null&&A.id)?(t.success(`${V?"Angebot":"Rechnung"} erstellt`),ze(`/crm/invoices/${M.data.id}`)):M.error||t.error("Rechnung konnte nicht erstellt werden")),M.error&&t.error("Fehler: "+(M.error.message||JSON.stringify(M.error)))}catch(k){console.error("Invoice submit error:",k),t.error("Unerwarteter Fehler: "+k.message)}m(!1)}return o&&d?s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Laden..."})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]}):s(At,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/invoices"),children:""}),s("h1",{class:"page-title",children:q})]})}),s("div",{class:"page-body",children:s("form",{onSubmit:F,style:"max-width:900px",children:[s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Dokument"})}),s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Typ"}),s("select",{value:S.type,onChange:C=>x({...S,type:C.target.value}),disabled:!!o||!!i,children:[s("option",{value:"invoice",children:"Rechnung"}),s("option",{value:"quote",children:"Angebot"})]})]}),s("div",{class:"form-group",children:[s("label",{children:V?"Angebotsnr.":"Rechnungsnr."}),s("input",{value:S.invoice_number,onInput:C=>x({...S,invoice_number:C.target.value}),required:!0})]}),s("div",{class:"form-group",children:[s("label",{children:"Datum"}),s("input",{type:"date",value:S.invoice_date,onInput:C=>x({...S,invoice_date:C.target.value}),required:!0})]}),s("div",{class:"form-group",children:[s("label",{children:V?"Gueltig bis":"Faellig am"}),s("input",{type:"date",value:S.due_date,onInput:C=>x({...S,due_date:C.target.value})})]})]})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Kunde"})}),s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Firma (CRM)"}),s("select",{value:S.company_id,onChange:C=>L(C.target.value),children:[s("option",{value:"",children:" Firma waehlen "}),b.map(C=>s("option",{value:C.id,children:C.name},C.id))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Kontakt (CRM)"}),s("select",{value:S.contact_id,onChange:C=>K(C.target.value),children:[s("option",{value:"",children:" Kontakt waehlen "}),_.map(C=>s("option",{value:C.id,children:`${C.first_name||""} ${C.last_name||""}`.trim()||C.email},C.id))]})]}),s("div",{class:"form-group",children:[s("label",{children:"Firmenname (Rechnung)"}),s("input",{value:S.customer_company,onInput:C=>x({...S,customer_company:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Ansprechpartner"}),s("input",{value:S.customer_name,onInput:C=>x({...S,customer_name:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Strasse"}),s("input",{value:S.customer_street,onInput:C=>x({...S,customer_street:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"PLZ"}),s("input",{value:S.customer_zip,onInput:C=>x({...S,customer_zip:C.target.value}),style:"max-width:120px"})]}),s("div",{class:"form-group",children:[s("label",{children:"Stadt"}),s("input",{value:S.customer_city,onInput:C=>x({...S,customer_city:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Kundennummer"}),s("input",{value:S.customer_number,onInput:C=>x({...S,customer_number:C.target.value}),placeholder:"Optional"})]})]})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Positionen"})}),s(cb,{items:T,onChange:O})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Betraege"})}),s("div",{style:"display:flex;gap:1.5rem;align-items:flex-start",children:[s("div",{style:"flex:1",children:[s("div",{class:"form-group",style:"max-width:200px",children:[s("label",{children:"Rabatt (%)"}),s("input",{type:"number",step:"0.01",min:"0",max:"100",value:S.discount_percent,onInput:C=>x({...S,discount_percent:C.target.value}),style:"text-align:right"})]}),s("div",{class:"form-group",style:"max-width:200px",children:[s("label",{children:"MwSt. (%)"}),s("input",{type:"number",step:"0.01",min:"0",value:S.vat_rate,onInput:C=>x({...S,vat_rate:C.target.value}),style:"text-align:right"})]})]}),s("div",{class:"invoice-totals",children:[s("div",{class:"invoice-totals-row",children:[s("span",{children:"Zwischensumme"}),s("span",{children:De(te.subtotal)})]}),parseFloat(S.discount_percent)>0&&s("div",{class:"invoice-totals-row",children:[s("span",{children:["Rabatt (-",S.discount_percent,"%)"]}),s("span",{children:["-",De(te.discount_amount)]})]}),s("div",{class:"invoice-totals-row",children:[s("span",{children:"Nettobetrag"}),s("span",{children:De(te.net_amount)})]}),s("div",{class:"invoice-totals-row",children:[s("span",{children:[S.vat_rate,"% MwSt."]}),s("span",{children:De(te.vat_amount)})]}),s("div",{class:"invoice-totals-row",style:"font-weight:700;font-size:1.1rem;border-top:2px solid var(--border);padding-top:0.5rem",children:[s("span",{children:"Gesamtbetrag"}),s("span",{children:De(te.total_amount)})]})]})]})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Texte"})}),s("div",{class:"form-group",children:[s("label",{children:"Einleitungstext"}),s("textarea",{value:S.intro_text,onInput:C=>x({...S,intro_text:C.target.value}),rows:2,placeholder:V?"Angebots-Einleitung...":"Rechnungs-Einleitung..."})]}),s("div",{class:"form-group",children:[s("label",{children:"Zahlungsbedingungen"}),s("textarea",{value:S.payment_terms,onInput:C=>x({...S,payment_terms:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Schlussnachricht"}),s("textarea",{value:S.closing_message,onInput:C=>x({...S,closing_message:C.target.value})})]}),s("div",{class:"form-group",children:[s("label",{children:"Interne Notizen"}),s("textarea",{value:S.notes,onInput:C=>x({...S,notes:C.target.value}),placeholder:"Nur intern sichtbar"})]})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>ze("/crm/invoices"),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",disabled:h,children:h?"Speichern...":o?"Speichern":"Erstellen"})]})]})})]})}const db="modulepreload",hb=function(t){return"/crm/"+t},pf={},su=function(e,n,r){let a=Promise.resolve();if(n&&n.length>0){let o=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=o(n.map(d=>{if(d=hb(d),d in pf)return;pf[d]=!0;const h=d.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const b=document.createElement("link");if(b.rel=h?"stylesheet":db,h||(b.as="script"),b.crossOrigin="",b.href=d,c&&b.setAttribute("nonce",c),document.head.appendChild(b),h)return new Promise((p,_)=>{b.addEventListener("load",p),b.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};function Ht(t){"@babel/helpers - typeof";return Ht=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ht(t)}var ti=Uint8Array,Cr=Uint16Array,kd=Int32Array,Nd=new ti([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ed=new ti([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gf=new ti([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Sg=function(t,e){for(var n=new Cr(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var a=new kd(n[30]),r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)a[i]=i-n[r]<<5|r;return{b:n,r:a}},Ag=Sg(Nd,2),fb=Ag.b,Zu=Ag.r;fb[28]=258,Zu[258]=28;var pb=Sg(Ed,0),mf=pb.r,Qu=new Cr(32768);for(var nn=0;nn<32768;++nn){var ra=(nn&43690)>>1|(nn&21845)<<1;ra=(ra&52428)>>2|(ra&13107)<<2,ra=(ra&61680)>>4|(ra&3855)<<4,Qu[nn]=((ra&65280)>>8|(ra&255)<<8)>>1}var mo=(function(t,e,n){for(var r=t.length,a=0,i=new Cr(e);a<r;++a)t[a]&&++i[t[a]-1];var o=new Cr(e);for(a=1;a<e;++a)o[a]=o[a-1]+i[a-1]<<1;var l;if(n){l=new Cr(1<<e);var c=15-e;for(a=0;a<r;++a)if(t[a])for(var d=a<<4|t[a],h=e-t[a],m=o[t[a]-1]++<<h,b=m|(1<<h)-1;m<=b;++m)l[Qu[m]>>c]=d}else for(l=new Cr(r),a=0;a<r;++a)t[a]&&(l[a]=Qu[o[t[a]-1]++]>>15-t[a]);return l}),$a=new ti(288);for(var nn=0;nn<144;++nn)$a[nn]=8;for(var nn=144;nn<256;++nn)$a[nn]=9;for(var nn=256;nn<280;++nn)$a[nn]=7;for(var nn=280;nn<288;++nn)$a[nn]=8;var Yl=new ti(32);for(var nn=0;nn<32;++nn)Yl[nn]=5;var gb=mo($a,9,0),mb=mo(Yl,5,0),kg=function(t){return(t+7)/8|0},vb=function(t,e,n){return(n==null||n>t.length)&&(n=t.length),new ti(t.subarray(e,n))},Fi=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8},so=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8,t[r+2]|=n>>16},ou=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var a=n.length,i=n.slice();if(!a)return{t:Eg,l:0};if(a==1){var o=new ti(n[0].s+1);return o[n[0].s]=1,{t:o,l:1}}n.sort(function(K,te){return K.f-te.f}),n.push({s:-1,f:25001});var l=n[0],c=n[1],d=0,h=1,m=2;for(n[0]={s:-1,f:l.f+c.f,l,r:c};h!=a-1;)l=n[n[d].f<n[m].f?d++:m++],c=n[d!=h&&n[d].f<n[m].f?d++:m++],n[h++]={s:-1,f:l.f+c.f,l,r:c};for(var b=i[0].s,r=1;r<a;++r)i[r].s>b&&(b=i[r].s);var p=new Cr(b+1),_=ed(n[h-1],p,0);if(_>e){var r=0,w=0,S=_-e,x=1<<S;for(i.sort(function(te,V){return p[V.s]-p[te.s]||te.f-V.f});r<a;++r){var T=i[r].s;if(p[T]>e)w+=x-(1<<_-p[T]),p[T]=e;else break}for(w>>=S;w>0;){var O=i[r].s;p[O]<e?w-=1<<e-p[O]++-1:++r}for(;r>=0&&w;--r){var L=i[r].s;p[L]==e&&(--p[L],++w)}_=e}return{t:new ti(p),l:_}},ed=function(t,e,n){return t.s==-1?Math.max(ed(t.l,e,n+1),ed(t.r,e,n+1)):e[t.s]=n},vf=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new Cr(++e),r=0,a=t[0],i=1,o=function(c){n[r++]=c},l=1;l<=e;++l)if(t[l]==a&&l!=e)++i;else{if(!a&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(a),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(a);i=1,a=t[l]}return{c:n.subarray(0,r),n:e}},oo=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},Ng=function(t,e,n){var r=n.length,a=kg(e+2);t[a]=r&255,t[a+1]=r>>8,t[a+2]=t[a]^255,t[a+3]=t[a+1]^255;for(var i=0;i<r;++i)t[a+i+4]=n[i];return(a+4+r)*8},bf=function(t,e,n,r,a,i,o,l,c,d,h){Fi(e,h++,n),++a[256];for(var m=ou(a,15),b=m.t,p=m.l,_=ou(i,15),w=_.t,S=_.l,x=vf(b),T=x.c,O=x.n,L=vf(w),K=L.c,te=L.n,V=new Cr(19),q=0;q<T.length;++q)++V[T[q]&31];for(var q=0;q<K.length;++q)++V[K[q]&31];for(var F=ou(V,7),C=F.t,A=F.l,k=19;k>4&&!C[gf[k-1]];--k);var M=d+5<<3,j=oo(a,$a)+oo(i,Yl)+o,U=oo(a,b)+oo(i,w)+o+14+3*k+oo(V,C)+2*V[16]+3*V[17]+7*V[18];if(c>=0&&M<=j&&M<=U)return Ng(e,h,t.subarray(c,c+d));var re,ce,se,fe;if(Fi(e,h,1+(U<j)),h+=2,U<j){re=mo(b,p,0),ce=b,se=mo(w,S,0),fe=w;var xe=mo(C,A,0);Fi(e,h,O-257),Fi(e,h+5,te-1),Fi(e,h+10,k-4),h+=14;for(var q=0;q<k;++q)Fi(e,h+3*q,C[gf[q]]);h+=3*k;for(var ge=[T,K],I=0;I<2;++I)for(var z=ge[I],q=0;q<z.length;++q){var J=z[q]&31;Fi(e,h,xe[J]),h+=C[J],J>15&&(Fi(e,h,z[q]>>5&127),h+=z[q]>>12)}}else re=gb,ce=$a,se=mb,fe=Yl;for(var q=0;q<l;++q){var X=r[q];if(X>255){var J=X>>18&31;so(e,h,re[J+257]),h+=ce[J+257],J>7&&(Fi(e,h,X>>23&31),h+=Nd[J]);var Z=X&31;so(e,h,se[Z]),h+=fe[Z],Z>3&&(so(e,h,X>>5&8191),h+=Ed[Z])}else so(e,h,re[X]),h+=ce[X]}return so(e,h,re[256]),h+ce[256]},bb=new kd([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Eg=new ti(0),yb=function(t,e,n,r,a,i){var o=i.z||t.length,l=new ti(r+o+5*(1+Math.ceil(o/7e3))+a),c=l.subarray(r,l.length-a),d=i.l,h=(i.r||0)&7;if(e){h&&(c[0]=i.r>>3);for(var m=bb[e-1],b=m>>13,p=m&8191,_=(1<<n)-1,w=i.p||new Cr(32768),S=i.h||new Cr(_+1),x=Math.ceil(n/3),T=2*x,O=function(je){return(t[je]^t[je+1]<<x^t[je+2]<<T)&_},L=new kd(25e3),K=new Cr(288),te=new Cr(32),V=0,q=0,F=i.i||0,C=0,A=i.w||0,k=0;F+2<o;++F){var M=O(F),j=F&32767,U=S[M];if(w[j]=U,S[M]=j,A<=F){var re=o-F;if((V>7e3||C>24576)&&(re>423||!d)){h=bf(t,c,0,L,K,te,q,C,k,F-k,h),C=V=q=0,k=F;for(var ce=0;ce<286;++ce)K[ce]=0;for(var ce=0;ce<30;++ce)te[ce]=0}var se=2,fe=0,xe=p,ge=j-U&32767;if(re>2&&M==O(F-ge))for(var I=Math.min(b,re)-1,z=Math.min(32767,F),J=Math.min(258,re);ge<=z&&--xe&&j!=U;){if(t[F+se]==t[F+se-ge]){for(var X=0;X<J&&t[F+X]==t[F+X-ge];++X);if(X>se){if(se=X,fe=ge,X>I)break;for(var Z=Math.min(ge,X-2),ae=0,ce=0;ce<Z;++ce){var pe=F-ge+ce&32767,Y=w[pe],oe=pe-Y&32767;oe>ae&&(ae=oe,U=pe)}}}j=U,U=w[j],ge+=j-U&32767}if(fe){L[C++]=268435456|Zu[se]<<18|mf[fe];var be=Zu[se]&31,Ce=mf[fe]&31;q+=Nd[be]+Ed[Ce],++K[257+be],++te[Ce],A=F+se,++V}else L[C++]=t[F],++K[t[F]]}}for(F=Math.max(F,A);F<o;++F)L[C++]=t[F],++K[t[F]];h=bf(t,c,d,L,K,te,q,C,k,F-k,h),d||(i.r=h&7|c[h/8|0]<<3,h-=7,i.h=S,i.p=w,i.i=F,i.w=A)}else{for(var F=i.w||0;F<o+d;F+=65535){var Te=F+65535;Te>=o&&(c[h/8|0]=d,Te=o),h=Ng(c,h+1,t.subarray(F,Te))}i.i=o}return vb(l,0,r+kg(h)+a)},Lg=function(){var t=1,e=0;return{p:function(n){for(var r=t,a=e,i=n.length|0,o=0;o!=i;){for(var l=Math.min(o+2655,i);o<l;++o)a+=r+=n[o];r=(r&65535)+15*(r>>16),a=(a&65535)+15*(a>>16)}t=r,e=a},d:function(){return t%=65521,e%=65521,(t&255)<<24|(t&65280)<<8|(e&255)<<8|e>>8}}},_b=function(t,e,n,r,a){if(!a&&(a={l:1},e.dictionary)){var i=e.dictionary.subarray(-32768),o=new ti(i.length+t.length);o.set(i),o.set(t,i.length),t=o,a.w=i.length}return yb(t,e.level==null?6:e.level,e.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,n,r,a)},Cg=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},wb=function(t,e){var n=e.level,r=n==0?0:n<6?1:n==9?3:2;if(t[0]=120,t[1]=r<<6|(e.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var a=Lg();a.p(e.dictionary),Cg(t,2,a.d())}};function td(t,e){e||(e={});var n=Lg();n.p(t);var r=_b(t,e,e.dictionary?6:2,4);return wb(r,e),Cg(r,r.length-4,n.d()),r}var xb=typeof TextDecoder<"u"&&new TextDecoder,Sb=0;try{xb.decode(Eg,{stream:!0}),Sb=1}catch{}function Ab(t){if(Array.isArray(t))return t}function kb(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,a,i,o,l=[],c=!0,d=!1;try{if(i=(n=n.call(t)).next,e!==0)for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(h){d=!0,a=h}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(d)throw a}}return l}}function yf(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Nb(t,e){if(t){if(typeof t=="string")return yf(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yf(t,e):void 0}}function Eb(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _f(t,e){return Ab(t)||kb(t,e)||Nb(t,e)||Eb()}function wf(t,e="utf8"){return new TextDecoder(e).decode(t)}const Lb=new TextEncoder;function Cb(t){return Lb.encode(t)}const Tb=1024*8,Pb=(()=>{const t=new Uint8Array(4),e=new Uint32Array(t.buffer);return!((e[0]=1)&t[0])})(),lu={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Ld{constructor(e=Tb,n={}){zt(this,"buffer");zt(this,"byteLength");zt(this,"byteOffset");zt(this,"length");zt(this,"offset");zt(this,"lastWrittenByte");zt(this,"littleEndian");zt(this,"_data");zt(this,"_mark");zt(this,"_marks");let r=!1;typeof e=="number"?e=new ArrayBuffer(e):(r=!0,this.lastWrittenByte=e.byteLength);const a=n.offset?n.offset>>>0:0,i=e.byteLength-a;let o=a;(ArrayBuffer.isView(e)||e instanceof Ld)&&(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+a),e=e.buffer),r?this.lastWrittenByte=i:this.lastWrittenByte=0,this.buffer=e,this.length=i,this.byteLength=i,this.byteOffset=o,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,o,i),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const r=(this.offset+e)*2,a=new Uint8Array(r);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=r,this.byteLength=r,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,n){const r=lu[n].BYTES_PER_ELEMENT*e,a=this.byteOffset+this.offset,i=this.buffer.slice(a,a+r);if(this.littleEndian===Pb&&n!=="uint8"&&n!=="int8"){const l=new Uint8Array(this.buffer.slice(a,a+r));l.reverse();const c=new lu[n](l.buffer);return this.offset+=r,c.reverse(),c}const o=new lu[n](i);return this.offset+=r,o}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let n="";for(let r=0;r<e;r++)n+=this.readChar();return n}readUtf8(e=1){return wf(this.readBytes(e))}decodeText(e=1,n="utf8"){return wf(this.readBytes(e),n)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let n=0;n<e.length;n++)this._data.setUint8(this.offset++,e[n]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let n=0;n<e.length;n++)this.writeUint8(e.charCodeAt(n));return this}writeUtf8(e){return this.writeBytes(Cb(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function Es(t){let e=t.length;for(;--e>=0;)t[e]=0}const Ib=3,Ob=258,Tg=29,Rb=256,Fb=Rb+1+Tg,Pg=30,Db=512,jb=new Array((Fb+2)*2);Es(jb);const Bb=new Array(Pg*2);Es(Bb);const Mb=new Array(Db);Es(Mb);const Ub=new Array(Ob-Ib+1);Es(Ub);const $b=new Array(Tg);Es($b);const qb=new Array(Pg);Es(qb);const zb=(t,e,n,r)=>{let a=t&65535|0,i=t>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do a=a+e[r++]|0,i=i+a|0;while(--o);a%=65521,i%=65521}return a|i<<16|0};var nd=zb;const Hb=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e},Wb=new Uint32Array(Hb()),Gb=(t,e,n,r)=>{const a=Wb,i=r+n;t^=-1;for(let o=r;o<i;o++)t=t>>>8^a[(t^e[o])&255];return t^-1};var hi=Gb,rd={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ig={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const Vb=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Kb=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)Vb(n,r)&&(t[r]=n[r])}}return t},Jb=t=>{let e=0;for(let r=0,a=t.length;r<a;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,a=0,i=t.length;r<i;r++){let o=t[r];n.set(o,a),a+=o.length}return n},Og={assign:Kb,flattenChunks:Jb};let Rg=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Rg=!1}const No=new Uint8Array(256);for(let t=0;t<256;t++)No[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;No[254]=No[254]=1;var Yb=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,a,i,o=t.length,l=0;for(a=0;a<o;a++)n=t.charCodeAt(a),(n&64512)===55296&&a+1<o&&(r=t.charCodeAt(a+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),a++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(l),i=0,a=0;i<l;a++)n=t.charCodeAt(a),(n&64512)===55296&&a+1<o&&(r=t.charCodeAt(a+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),a++)),n<128?e[i++]=n:n<2048?(e[i++]=192|n>>>6,e[i++]=128|n&63):n<65536?(e[i++]=224|n>>>12,e[i++]=128|n>>>6&63,e[i++]=128|n&63):(e[i++]=240|n>>>18,e[i++]=128|n>>>12&63,e[i++]=128|n>>>6&63,e[i++]=128|n&63);return e};const Xb=(t,e)=>{if(e<65534&&t.subarray&&Rg)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n};var Zb=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,a;const i=new Array(n*2);for(a=0,r=0;r<n;){let o=t[r++];if(o<128){i[a++]=o;continue}let l=No[o];if(l>4){i[a++]=65533,r+=l-1;continue}for(o&=l===2?31:l===3?15:7;l>1&&r<n;)o=o<<6|t[r++]&63,l--;if(l>1){i[a++]=65533;continue}o<65536?i[a++]=o:(o-=65536,i[a++]=55296|o>>10&1023,i[a++]=56320|o&1023)}return Xb(i,a)},Qb=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(t[n]&192)===128;)n--;return n<0||n===0?e:n+No[t[n]]>e?n:e},id={string2buf:Yb,buf2string:Zb,utf8border:Qb};function e5(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var t5=e5;const wl=16209,n5=16191;var r5=function(e,n){let r,a,i,o,l,c,d,h,m,b,p,_,w,S,x,T,O,L,K,te,V,q,F,C;const A=e.state;r=e.next_in,F=e.input,a=r+(e.avail_in-5),i=e.next_out,C=e.output,o=i-(n-e.avail_out),l=i+(e.avail_out-257),c=A.dmax,d=A.wsize,h=A.whave,m=A.wnext,b=A.window,p=A.hold,_=A.bits,w=A.lencode,S=A.distcode,x=(1<<A.lenbits)-1,T=(1<<A.distbits)-1;e:do{_<15&&(p+=F[r++]<<_,_+=8,p+=F[r++]<<_,_+=8),O=w[p&x];t:for(;;){if(L=O>>>24,p>>>=L,_-=L,L=O>>>16&255,L===0)C[i++]=O&65535;else if(L&16){K=O&65535,L&=15,L&&(_<L&&(p+=F[r++]<<_,_+=8),K+=p&(1<<L)-1,p>>>=L,_-=L),_<15&&(p+=F[r++]<<_,_+=8,p+=F[r++]<<_,_+=8),O=S[p&T];n:for(;;){if(L=O>>>24,p>>>=L,_-=L,L=O>>>16&255,L&16){if(te=O&65535,L&=15,_<L&&(p+=F[r++]<<_,_+=8,_<L&&(p+=F[r++]<<_,_+=8)),te+=p&(1<<L)-1,te>c){e.msg="invalid distance too far back",A.mode=wl;break e}if(p>>>=L,_-=L,L=i-o,te>L){if(L=te-L,L>h&&A.sane){e.msg="invalid distance too far back",A.mode=wl;break e}if(V=0,q=b,m===0){if(V+=d-L,L<K){K-=L;do C[i++]=b[V++];while(--L);V=i-te,q=C}}else if(m<L){if(V+=d+m-L,L-=m,L<K){K-=L;do C[i++]=b[V++];while(--L);if(V=0,m<K){L=m,K-=L;do C[i++]=b[V++];while(--L);V=i-te,q=C}}}else if(V+=m-L,L<K){K-=L;do C[i++]=b[V++];while(--L);V=i-te,q=C}for(;K>2;)C[i++]=q[V++],C[i++]=q[V++],C[i++]=q[V++],K-=3;K&&(C[i++]=q[V++],K>1&&(C[i++]=q[V++]))}else{V=i-te;do C[i++]=C[V++],C[i++]=C[V++],C[i++]=C[V++],K-=3;while(K>2);K&&(C[i++]=C[V++],K>1&&(C[i++]=C[V++]))}}else if((L&64)===0){O=S[(O&65535)+(p&(1<<L)-1)];continue n}else{e.msg="invalid distance code",A.mode=wl;break e}break}}else if((L&64)===0){O=w[(O&65535)+(p&(1<<L)-1)];continue t}else if(L&32){A.mode=n5;break e}else{e.msg="invalid literal/length code",A.mode=wl;break e}break}}while(r<a&&i<l);K=_>>3,r-=K,_-=K<<3,p&=(1<<_)-1,e.next_in=r,e.next_out=i,e.avail_in=r<a?5+(a-r):5-(r-a),e.avail_out=i<l?257+(l-i):257-(i-l),A.hold=p,A.bits=_};const ls=15,xf=852,Sf=592,Af=0,cu=1,kf=2,i5=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),a5=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),s5=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),o5=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),l5=(t,e,n,r,a,i,o,l)=>{const c=l.bits;let d=0,h=0,m=0,b=0,p=0,_=0,w=0,S=0,x=0,T=0,O,L,K,te,V,q=null,F;const C=new Uint16Array(ls+1),A=new Uint16Array(ls+1);let k=null,M,j,U;for(d=0;d<=ls;d++)C[d]=0;for(h=0;h<r;h++)C[e[n+h]]++;for(p=c,b=ls;b>=1&&C[b]===0;b--);if(p>b&&(p=b),b===0)return a[i++]=1<<24|64<<16|0,a[i++]=1<<24|64<<16|0,l.bits=1,0;for(m=1;m<b&&C[m]===0;m++);for(p<m&&(p=m),S=1,d=1;d<=ls;d++)if(S<<=1,S-=C[d],S<0)return-1;if(S>0&&(t===Af||b!==1))return-1;for(A[1]=0,d=1;d<ls;d++)A[d+1]=A[d]+C[d];for(h=0;h<r;h++)e[n+h]!==0&&(o[A[e[n+h]]++]=h);if(t===Af?(q=k=o,F=20):t===cu?(q=i5,k=a5,F=257):(q=s5,k=o5,F=0),T=0,h=0,d=m,V=i,_=p,w=0,K=-1,x=1<<p,te=x-1,t===cu&&x>xf||t===kf&&x>Sf)return 1;for(;;){M=d-w,o[h]+1<F?(j=0,U=o[h]):o[h]>=F?(j=k[o[h]-F],U=q[o[h]-F]):(j=96,U=0),O=1<<d-w,L=1<<_,m=L;do L-=O,a[V+(T>>w)+L]=M<<24|j<<16|U|0;while(L!==0);for(O=1<<d-1;T&O;)O>>=1;if(O!==0?(T&=O-1,T+=O):T=0,h++,--C[d]===0){if(d===b)break;d=e[n+o[h]]}if(d>p&&(T&te)!==K){for(w===0&&(w=p),V+=m,_=d-w,S=1<<_;_+w<b&&(S-=C[_+w],!(S<=0));)_++,S<<=1;if(x+=1<<_,t===cu&&x>xf||t===kf&&x>Sf)return 1;K=T&te,a[K]=p<<24|_<<16|V-i|0}}return T!==0&&(a[V+T]=d-w<<24|64<<16|0),l.bits=p,0};var vo=l5;const c5=0,Fg=1,Dg=2,{Z_FINISH:Nf,Z_BLOCK:u5,Z_TREES:xl,Z_OK:qa,Z_STREAM_END:d5,Z_NEED_DICT:h5,Z_STREAM_ERROR:qr,Z_DATA_ERROR:jg,Z_MEM_ERROR:Bg,Z_BUF_ERROR:f5,Z_DEFLATED:Ef}=Ig,dc=16180,Lf=16181,Cf=16182,Tf=16183,Pf=16184,If=16185,Of=16186,Rf=16187,Ff=16188,Df=16189,Xl=16190,Di=16191,uu=16192,jf=16193,du=16194,Bf=16195,Mf=16196,Uf=16197,$f=16198,Sl=16199,Al=16200,qf=16201,zf=16202,Hf=16203,Wf=16204,Gf=16205,hu=16206,Vf=16207,Kf=16208,an=16209,Mg=16210,Ug=16211,p5=852,g5=592,m5=15,v5=m5,Jf=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function b5(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ha=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<dc||e.mode>Ug?1:0},$g=t=>{if(Ha(t))return qr;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=dc,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(p5),e.distcode=e.distdyn=new Int32Array(g5),e.sane=1,e.back=-1,qa},qg=t=>{if(Ha(t))return qr;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,$g(t)},zg=(t,e)=>{let n;if(Ha(t))return qr;const r=t.state;return e<0?(n=0,e=-e):(n=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?qr:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,qg(t))},Hg=(t,e)=>{if(!t)return qr;const n=new b5;t.state=n,n.strm=t,n.window=null,n.mode=dc;const r=zg(t,e);return r!==qa&&(t.state=null),r},y5=t=>Hg(t,v5);let Yf=!0,fu,pu;const _5=t=>{if(Yf){fu=new Int32Array(512),pu=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(vo(Fg,t.lens,0,288,fu,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;vo(Dg,t.lens,0,32,pu,0,t.work,{bits:5}),Yf=!1}t.lencode=fu,t.lenbits=9,t.distcode=pu,t.distbits=5},Wg=(t,e,n,r)=>{let a;const i=t.state;return i.window===null&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),r>=i.wsize?(i.window.set(e.subarray(n-i.wsize,n),0),i.wnext=0,i.whave=i.wsize):(a=i.wsize-i.wnext,a>r&&(a=r),i.window.set(e.subarray(n-r,n-r+a),i.wnext),r-=a,r?(i.window.set(e.subarray(n-r,n),0),i.wnext=r,i.whave=i.wsize):(i.wnext+=a,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=a))),0},w5=(t,e)=>{let n,r,a,i,o,l,c,d,h,m,b,p,_,w,S=0,x,T,O,L,K,te,V,q;const F=new Uint8Array(4);let C,A;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ha(t)||!t.output||!t.input&&t.avail_in!==0)return qr;n=t.state,n.mode===Di&&(n.mode=uu),o=t.next_out,a=t.output,c=t.avail_out,i=t.next_in,r=t.input,l=t.avail_in,d=n.hold,h=n.bits,m=l,b=c,q=qa;e:for(;;)switch(n.mode){case dc:if(n.wrap===0){n.mode=uu;break}for(;h<16;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}if(n.wrap&2&&d===35615){n.wbits===0&&(n.wbits=15),n.check=0,F[0]=d&255,F[1]=d>>>8&255,n.check=hi(n.check,F,2,0),d=0,h=0,n.mode=Lf;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((d&255)<<8)+(d>>8))%31){t.msg="incorrect header check",n.mode=an;break}if((d&15)!==Ef){t.msg="unknown compression method",n.mode=an;break}if(d>>>=4,h-=4,V=(d&15)+8,n.wbits===0&&(n.wbits=V),V>15||V>n.wbits){t.msg="invalid window size",n.mode=an;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=d&512?Df:Di,d=0,h=0;break;case Lf:for(;h<16;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}if(n.flags=d,(n.flags&255)!==Ef){t.msg="unknown compression method",n.mode=an;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=an;break}n.head&&(n.head.text=d>>8&1),n.flags&512&&n.wrap&4&&(F[0]=d&255,F[1]=d>>>8&255,n.check=hi(n.check,F,2,0)),d=0,h=0,n.mode=Cf;case Cf:for(;h<32;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}n.head&&(n.head.time=d),n.flags&512&&n.wrap&4&&(F[0]=d&255,F[1]=d>>>8&255,F[2]=d>>>16&255,F[3]=d>>>24&255,n.check=hi(n.check,F,4,0)),d=0,h=0,n.mode=Tf;case Tf:for(;h<16;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}n.head&&(n.head.xflags=d&255,n.head.os=d>>8),n.flags&512&&n.wrap&4&&(F[0]=d&255,F[1]=d>>>8&255,n.check=hi(n.check,F,2,0)),d=0,h=0,n.mode=Pf;case Pf:if(n.flags&1024){for(;h<16;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}n.length=d,n.head&&(n.head.extra_len=d),n.flags&512&&n.wrap&4&&(F[0]=d&255,F[1]=d>>>8&255,n.check=hi(n.check,F,2,0)),d=0,h=0}else n.head&&(n.head.extra=null);n.mode=If;case If:if(n.flags&1024&&(p=n.length,p>l&&(p=l),p&&(n.head&&(V=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(i,i+p),V)),n.flags&512&&n.wrap&4&&(n.check=hi(n.check,r,p,i)),l-=p,i+=p,n.length-=p),n.length))break e;n.length=0,n.mode=Of;case Of:if(n.flags&2048){if(l===0)break e;p=0;do V=r[i+p++],n.head&&V&&n.length<65536&&(n.head.name+=String.fromCharCode(V));while(V&&p<l);if(n.flags&512&&n.wrap&4&&(n.check=hi(n.check,r,p,i)),l-=p,i+=p,V)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=Rf;case Rf:if(n.flags&4096){if(l===0)break e;p=0;do V=r[i+p++],n.head&&V&&n.length<65536&&(n.head.comment+=String.fromCharCode(V));while(V&&p<l);if(n.flags&512&&n.wrap&4&&(n.check=hi(n.check,r,p,i)),l-=p,i+=p,V)break e}else n.head&&(n.head.comment=null);n.mode=Ff;case Ff:if(n.flags&512){for(;h<16;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}if(n.wrap&4&&d!==(n.check&65535)){t.msg="header crc mismatch",n.mode=an;break}d=0,h=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Di;break;case Df:for(;h<32;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}t.adler=n.check=Jf(d),d=0,h=0,n.mode=Xl;case Xl:if(n.havedict===0)return t.next_out=o,t.avail_out=c,t.next_in=i,t.avail_in=l,n.hold=d,n.bits=h,h5;t.adler=n.check=1,n.mode=Di;case Di:if(e===u5||e===xl)break e;case uu:if(n.last){d>>>=h&7,h-=h&7,n.mode=hu;break}for(;h<3;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}switch(n.last=d&1,d>>>=1,h-=1,d&3){case 0:n.mode=jf;break;case 1:if(_5(n),n.mode=Sl,e===xl){d>>>=2,h-=2;break e}break;case 2:n.mode=Mf;break;case 3:t.msg="invalid block type",n.mode=an}d>>>=2,h-=2;break;case jf:for(d>>>=h&7,h-=h&7;h<32;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}if((d&65535)!==(d>>>16^65535)){t.msg="invalid stored block lengths",n.mode=an;break}if(n.length=d&65535,d=0,h=0,n.mode=du,e===xl)break e;case du:n.mode=Bf;case Bf:if(p=n.length,p){if(p>l&&(p=l),p>c&&(p=c),p===0)break e;a.set(r.subarray(i,i+p),o),l-=p,i+=p,c-=p,o+=p,n.length-=p;break}n.mode=Di;break;case Mf:for(;h<14;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}if(n.nlen=(d&31)+257,d>>>=5,h-=5,n.ndist=(d&31)+1,d>>>=5,h-=5,n.ncode=(d&15)+4,d>>>=4,h-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=an;break}n.have=0,n.mode=Uf;case Uf:for(;n.have<n.ncode;){for(;h<3;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}n.lens[k[n.have++]]=d&7,d>>>=3,h-=3}for(;n.have<19;)n.lens[k[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},q=vo(c5,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,q){t.msg="invalid code lengths set",n.mode=an;break}n.have=0,n.mode=$f;case $f:for(;n.have<n.nlen+n.ndist;){for(;S=n.lencode[d&(1<<n.lenbits)-1],x=S>>>24,T=S>>>16&255,O=S&65535,!(x<=h);){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}if(O<16)d>>>=x,h-=x,n.lens[n.have++]=O;else{if(O===16){for(A=x+2;h<A;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}if(d>>>=x,h-=x,n.have===0){t.msg="invalid bit length repeat",n.mode=an;break}V=n.lens[n.have-1],p=3+(d&3),d>>>=2,h-=2}else if(O===17){for(A=x+3;h<A;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}d>>>=x,h-=x,V=0,p=3+(d&7),d>>>=3,h-=3}else{for(A=x+7;h<A;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}d>>>=x,h-=x,V=0,p=11+(d&127),d>>>=7,h-=7}if(n.have+p>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=an;break}for(;p--;)n.lens[n.have++]=V}}if(n.mode===an)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=an;break}if(n.lenbits=9,C={bits:n.lenbits},q=vo(Fg,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,q){t.msg="invalid literal/lengths set",n.mode=an;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},q=vo(Dg,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,q){t.msg="invalid distances set",n.mode=an;break}if(n.mode=Sl,e===xl)break e;case Sl:n.mode=Al;case Al:if(l>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=i,t.avail_in=l,n.hold=d,n.bits=h,r5(t,b),o=t.next_out,a=t.output,c=t.avail_out,i=t.next_in,r=t.input,l=t.avail_in,d=n.hold,h=n.bits,n.mode===Di&&(n.back=-1);break}for(n.back=0;S=n.lencode[d&(1<<n.lenbits)-1],x=S>>>24,T=S>>>16&255,O=S&65535,!(x<=h);){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}if(T&&(T&240)===0){for(L=x,K=T,te=O;S=n.lencode[te+((d&(1<<L+K)-1)>>L)],x=S>>>24,T=S>>>16&255,O=S&65535,!(L+x<=h);){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}d>>>=L,h-=L,n.back+=L}if(d>>>=x,h-=x,n.back+=x,n.length=O,T===0){n.mode=Gf;break}if(T&32){n.back=-1,n.mode=Di;break}if(T&64){t.msg="invalid literal/length code",n.mode=an;break}n.extra=T&15,n.mode=qf;case qf:if(n.extra){for(A=n.extra;h<A;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}n.length+=d&(1<<n.extra)-1,d>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=zf;case zf:for(;S=n.distcode[d&(1<<n.distbits)-1],x=S>>>24,T=S>>>16&255,O=S&65535,!(x<=h);){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}if((T&240)===0){for(L=x,K=T,te=O;S=n.distcode[te+((d&(1<<L+K)-1)>>L)],x=S>>>24,T=S>>>16&255,O=S&65535,!(L+x<=h);){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}d>>>=L,h-=L,n.back+=L}if(d>>>=x,h-=x,n.back+=x,T&64){t.msg="invalid distance code",n.mode=an;break}n.offset=O,n.extra=T&15,n.mode=Hf;case Hf:if(n.extra){for(A=n.extra;h<A;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}n.offset+=d&(1<<n.extra)-1,d>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=an;break}n.mode=Wf;case Wf:if(c===0)break e;if(p=b-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=an;break}p>n.wnext?(p-=n.wnext,_=n.wsize-p):_=n.wnext-p,p>n.length&&(p=n.length),w=n.window}else w=a,_=o-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do a[o++]=w[_++];while(--p);n.length===0&&(n.mode=Al);break;case Gf:if(c===0)break e;a[o++]=n.length,c--,n.mode=Al;break;case hu:if(n.wrap){for(;h<32;){if(l===0)break e;l--,d|=r[i++]<<h,h+=8}if(b-=c,t.total_out+=b,n.total+=b,n.wrap&4&&b&&(t.adler=n.check=n.flags?hi(n.check,a,b,o-b):nd(n.check,a,b,o-b)),b=c,n.wrap&4&&(n.flags?d:Jf(d))!==n.check){t.msg="incorrect data check",n.mode=an;break}d=0,h=0}n.mode=Vf;case Vf:if(n.wrap&&n.flags){for(;h<32;){if(l===0)break e;l--,d+=r[i++]<<h,h+=8}if(n.wrap&4&&d!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=an;break}d=0,h=0}n.mode=Kf;case Kf:q=d5;break e;case an:q=jg;break e;case Mg:return Bg;case Ug:default:return qr}return t.next_out=o,t.avail_out=c,t.next_in=i,t.avail_in=l,n.hold=d,n.bits=h,(n.wsize||b!==t.avail_out&&n.mode<an&&(n.mode<hu||e!==Nf))&&Wg(t,t.output,t.next_out,b-t.avail_out),m-=t.avail_in,b-=t.avail_out,t.total_in+=m,t.total_out+=b,n.total+=b,n.wrap&4&&b&&(t.adler=n.check=n.flags?hi(n.check,a,b,t.next_out-b):nd(n.check,a,b,t.next_out-b)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Di?128:0)+(n.mode===Sl||n.mode===du?256:0),(m===0&&b===0||e===Nf)&&q===qa&&(q=f5),q},x5=t=>{if(Ha(t))return qr;let e=t.state;return e.window&&(e.window=null),t.state=null,qa},S5=(t,e)=>{if(Ha(t))return qr;const n=t.state;return(n.wrap&2)===0?qr:(n.head=e,e.done=!1,qa)},A5=(t,e)=>{const n=e.length;let r,a,i;return Ha(t)||(r=t.state,r.wrap!==0&&r.mode!==Xl)?qr:r.mode===Xl&&(a=1,a=nd(a,e,n,0),a!==r.check)?jg:(i=Wg(t,e,n,n),i?(r.mode=Mg,Bg):(r.havedict=1,qa))};var k5=qg,N5=zg,E5=$g,L5=y5,C5=Hg,T5=w5,P5=x5,I5=S5,O5=A5,R5="pako inflate (from Nodeca project)",Bi={inflateReset:k5,inflateReset2:N5,inflateResetKeep:E5,inflateInit:L5,inflateInit2:C5,inflate:T5,inflateEnd:P5,inflateGetHeader:I5,inflateSetDictionary:O5,inflateInfo:R5};function F5(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var D5=F5;const Gg=Object.prototype.toString,{Z_NO_FLUSH:j5,Z_FINISH:B5,Z_OK:Eo,Z_STREAM_END:gu,Z_NEED_DICT:mu,Z_STREAM_ERROR:M5,Z_DATA_ERROR:Xf,Z_MEM_ERROR:U5}=Ig;function Po(t){this.options=Og.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new t5,this.strm.avail_out=0;let n=Bi.inflateInit2(this.strm,e.windowBits);if(n!==Eo)throw new Error(rd[n]);if(this.header=new D5,Bi.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=id.string2buf(e.dictionary):Gg.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Bi.inflateSetDictionary(this.strm,e.dictionary),n!==Eo)))throw new Error(rd[n])}Po.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,a=this.options.dictionary;let i,o,l;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?B5:j5,Gg.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),i=Bi.inflate(n,o),i===mu&&a&&(i=Bi.inflateSetDictionary(n,a),i===Eo?i=Bi.inflate(n,o):i===Xf&&(i=mu));n.avail_in>0&&i===gu&&n.state.wrap>0&&t[n.next_in]!==0;)Bi.inflateReset(n),i=Bi.inflate(n,o);switch(i){case M5:case Xf:case mu:case U5:return this.onEnd(i),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||i===gu))if(this.options.to==="string"){let c=id.utf8border(n.output,n.next_out),d=n.next_out-c,h=id.buf2string(n.output,c);n.next_out=d,n.avail_out=r-d,d&&n.output.set(n.output.subarray(c,c+d),0),this.onData(h)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(i===Eo&&l===0)){if(i===gu)return i=Bi.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(n.avail_in===0)break}}return!0};Po.prototype.onData=function(t){this.chunks.push(t)};Po.prototype.onEnd=function(t){t===Eo&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Og.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function $5(t,e){const n=new Po(e);if(n.push(t),n.err)throw n.msg||rd[n.err];return n.result}var q5=Po,z5=$5,H5={Inflate:q5,inflate:z5};const{Inflate:W5,inflate:G5}=H5;var Zf=W5,V5=G5;const Vg=[];for(let t=0;t<256;t++){let e=t;for(let n=0;n<8;n++)e&1?e=3988292384^e>>>1:e=e>>>1;Vg[t]=e}const Qf=4294967295;function K5(t,e,n){let r=t;for(let a=0;a<n;a++)r=Vg[(r^e[a])&255]^r>>>8;return r}function J5(t,e){return(K5(Qf,t,e)^Qf)>>>0}function ep(t,e,n){const r=t.readUint32(),a=J5(new Uint8Array(t.buffer,t.byteOffset+t.offset-e-4,e),e);if(a!==r)throw new Error(`CRC mismatch for chunk ${n}. Expected ${r}, found ${a}`)}function Kg(t,e,n){for(let r=0;r<n;r++)e[r]=t[r]}function Jg(t,e,n,r){let a=0;for(;a<r;a++)e[a]=t[a];for(;a<n;a++)e[a]=t[a]+e[a-r]&255}function Yg(t,e,n,r){let a=0;if(n.length===0)for(;a<r;a++)e[a]=t[a];else for(;a<r;a++)e[a]=t[a]+n[a]&255}function Xg(t,e,n,r,a){let i=0;if(n.length===0){for(;i<a;i++)e[i]=t[i];for(;i<r;i++)e[i]=t[i]+(e[i-a]>>1)&255}else{for(;i<a;i++)e[i]=t[i]+(n[i]>>1)&255;for(;i<r;i++)e[i]=t[i]+(e[i-a]+n[i]>>1)&255}}function Zg(t,e,n,r,a){let i=0;if(n.length===0){for(;i<a;i++)e[i]=t[i];for(;i<r;i++)e[i]=t[i]+e[i-a]&255}else{for(;i<a;i++)e[i]=t[i]+n[i]&255;for(;i<r;i++)e[i]=t[i]+Y5(e[i-a],n[i],n[i-a])&255}}function Y5(t,e,n){const r=t+e-n,a=Math.abs(r-t),i=Math.abs(r-e),o=Math.abs(r-n);return a<=i&&a<=o?t:i<=o?e:n}function X5(t,e,n,r,a,i){switch(t){case 0:Kg(e,n,a);break;case 1:Jg(e,n,a,i);break;case 2:Yg(e,n,r,a);break;case 3:Xg(e,n,r,a,i);break;case 4:Zg(e,n,r,a,i);break;default:throw new Error(`Unsupported filter: ${t}`)}}const Z5=new Uint16Array([255]),Q5=new Uint8Array(Z5.buffer),ey=Q5[0]===255;function ty(t){const{data:e,width:n,height:r,channels:a,depth:i}=t,o=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],l=Math.ceil(i/8)*a,c=new Uint8Array(r*n*l);let d=0;for(let h=0;h<7;h++){const m=o[h],b=Math.ceil((n-m.x)/m.xStep),p=Math.ceil((r-m.y)/m.yStep);if(b<=0||p<=0)continue;const _=b*l,w=new Uint8Array(_);for(let S=0;S<p;S++){const x=e[d++],T=e.subarray(d,d+_);d+=_;const O=new Uint8Array(_);X5(x,T,O,w,_,l),w.set(O);for(let L=0;L<b;L++){const K=m.x+L*m.xStep,te=m.y+S*m.yStep;if(!(K>=n||te>=r))for(let V=0;V<l;V++)c[(te*n+K)*l+V]=O[L*l+V]}}}if(i===16){const h=new Uint16Array(c.buffer);if(ey)for(let m=0;m<h.length;m++)h[m]=ny(h[m]);return h}else return c}function ny(t){return(t&255)<<8|t>>8&255}const ry=new Uint16Array([255]),iy=new Uint8Array(ry.buffer),ay=iy[0]===255,sy=new Uint8Array(0);function tp(t){const{data:e,width:n,height:r,channels:a,depth:i}=t,o=Math.ceil(i/8)*a,l=Math.ceil(i/8*a*n),c=new Uint8Array(r*l);let d=sy,h=0,m,b;for(let p=0;p<r;p++){switch(m=e.subarray(h+1,h+1+l),b=c.subarray(p*l,(p+1)*l),e[h]){case 0:Kg(m,b,l);break;case 1:Jg(m,b,l,o);break;case 2:Yg(m,b,d,l);break;case 3:Xg(m,b,d,l,o);break;case 4:Zg(m,b,d,l,o);break;default:throw new Error(`Unsupported filter: ${e[h]}`)}d=b,h+=l+1}if(i===16){const p=new Uint16Array(c.buffer);if(ay)for(let _=0;_<p.length;_++)p[_]=oy(p[_]);return p}else return c}function oy(t){return(t&255)<<8|t>>8&255}const Rl=Uint8Array.of(137,80,78,71,13,10,26,10);function np(t){if(!ly(t.readBytes(Rl.length)))throw new Error("wrong PNG signature")}function ly(t){if(t.length<Rl.length)return!1;for(let e=0;e<Rl.length;e++)if(t[e]!==Rl[e])return!1;return!0}const cy="tEXt",uy=0,Qg=new TextDecoder("latin1");function dy(t){if(fy(t),t.length===0||t.length>79)throw new Error("keyword length must be between 1 and 79")}const hy=/^[\u0000-\u00FF]*$/;function fy(t){if(!hy.test(t))throw new Error("invalid latin1 text")}function py(t,e,n){const r=em(e);t[r]=gy(e,n-r.length-1)}function em(t){for(t.mark();t.readByte()!==uy;);const e=t.offset;t.reset();const n=Qg.decode(t.readBytes(e-t.offset-1));return t.skip(1),dy(n),n}function gy(t,e){return Qg.decode(t.readBytes(e))}const kr={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},vu={UNKNOWN:-1,DEFLATE:0},rp={UNKNOWN:-1,ADAPTIVE:0},bu={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},kl={NONE:0,BACKGROUND:1,PREVIOUS:2},yu={SOURCE:0,OVER:1};class my extends Ld{constructor(n,r={}){super(n);zt(this,"_checkCrc");zt(this,"_inflator");zt(this,"_png");zt(this,"_apng");zt(this,"_end");zt(this,"_hasPalette");zt(this,"_palette");zt(this,"_hasTransparency");zt(this,"_transparency");zt(this,"_compressionMethod");zt(this,"_filterMethod");zt(this,"_interlaceMethod");zt(this,"_colorType");zt(this,"_isAnimated");zt(this,"_numberOfFrames");zt(this,"_numberOfPlays");zt(this,"_frames");zt(this,"_writingDataChunks");const{checkCrc:a=!1}=r;this._checkCrc=a,this._inflator=new Zf,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=vu.UNKNOWN,this._filterMethod=rp.UNKNOWN,this._interlaceMethod=bu.UNKNOWN,this._colorType=kr.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(np(this);!this._end;){const n=this.readUint32(),r=this.readChars(4);this.decodeChunk(n,r)}return this.decodeImage(),this._png}decodeApng(){for(np(this);!this._end;){const n=this.readUint32(),r=this.readChars(4);this.decodeApngChunk(n,r)}return this.decodeApngImage(),this._apng}decodeChunk(n,r){const a=this.offset;switch(r){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(n);break;case"IDAT":this.decodeIDAT(n);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(n);break;case"iCCP":this.decodeiCCP(n);break;case cy:py(this._png.text,this,n);break;case"pHYs":this.decodepHYs();break;default:this.skip(n);break}if(this.offset-a!==n)throw new Error(`Length mismatch while decoding chunk ${r}`);this._checkCrc?ep(this,n+4,r):this.skip(4)}decodeApngChunk(n,r){const a=this.offset;switch(r!=="fdAT"&&r!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),r){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(n);break;default:this.decodeChunk(n,r),this.offset=a+n;break}if(this.offset-a!==n)throw new Error(`Length mismatch while decoding chunk ${r}`);this._checkCrc?ep(this,n+4,r):this.skip(4)}decodeIHDR(){const n=this._png;n.width=this.readUint32(),n.height=this.readUint32(),n.depth=vy(this.readUint8());const r=this.readUint8();this._colorType=r;let a;switch(r){case kr.GREYSCALE:a=1;break;case kr.TRUECOLOUR:a=3;break;case kr.INDEXED_COLOUR:a=1;break;case kr.GREYSCALE_ALPHA:a=2;break;case kr.TRUECOLOUR_ALPHA:a=4;break;case kr.UNKNOWN:default:throw new Error(`Unknown color type: ${r}`)}if(this._png.channels=a,this._compressionMethod=this.readUint8(),this._compressionMethod!==vu.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const n={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(n)}decodePLTE(n){if(n%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${n}`);const r=n/3;this._hasPalette=!0;const a=[];this._palette=a;for(let i=0;i<r;i++)a.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(n){this._writingDataChunks=!0;const r=n,a=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,a,r)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(n)}decodeFDAT(n){this._writingDataChunks=!0;let r=n,a=this.offset+this.byteOffset;if(a+=4,r-=4,this._inflator.push(new Uint8Array(this.buffer,a,r)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(n)}decodetRNS(n){switch(this._colorType){case kr.GREYSCALE:case kr.TRUECOLOUR:{if(n%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${n}`);if(n/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${n/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(n/2);for(let r=0;r<n/2;r++)this._transparency[r]=this.readUint16();break}case kr.INDEXED_COLOUR:{if(n>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${n} vs ${this._palette.length})`);let r=0;for(;r<n;r++){const a=this.readByte();this._palette[r].push(a)}for(;r<this._palette.length;r++)this._palette[r].push(255);break}case kr.UNKNOWN:case kr.GREYSCALE_ALPHA:case kr.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(n){const r=em(this),a=this.readUint8();if(a!==vu.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${a}`);const i=this.readBytes(n-r.length-2);this._png.iccEmbeddedProfile={name:r,profile:V5(i)}}decodepHYs(){const n=this.readUint32(),r=this.readUint32(),a=this.readByte();this._png.resolution={x:n,y:r,unit:a}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let n=0;n<this._numberOfFrames;n++){const r={sequenceNumber:this._frames[n].sequenceNumber,delayNumber:this._frames[n].delayNumber,delayDenominator:this._frames[n].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},a=this._frames.at(n);if(a){if(a.data=tp({data:a.data,width:a.width,height:a.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),n===0||a.xOffset===0&&a.yOffset===0&&a.width===this._png.width&&a.height===this._png.height)r.data=a.data;else{const i=this._apng.frames.at(n-1);this.disposeFrame(a,i,r),this.addFrameDataToCanvas(r,a)}this._apng.frames.push(r)}}return this._apng}disposeFrame(n,r,a){switch(n.disposeOp){case kl.NONE:break;case kl.BACKGROUND:for(let i=0;i<this._png.height;i++)for(let o=0;o<this._png.width;o++){const l=(i*n.width+o)*this._png.channels;for(let c=0;c<this._png.channels;c++)a.data[l+c]=0}break;case kl.PREVIOUS:a.data.set(r.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(n,r){const a=1<<this._png.depth,i=(o,l)=>{const c=((o+r.yOffset)*this._png.width+r.xOffset+l)*this._png.channels,d=(o*r.width+l)*this._png.channels;return{index:c,frameIndex:d}};switch(r.blendOp){case yu.SOURCE:for(let o=0;o<r.height;o++)for(let l=0;l<r.width;l++){const{index:c,frameIndex:d}=i(o,l);for(let h=0;h<this._png.channels;h++)n.data[c+h]=r.data[d+h]}break;case yu.OVER:for(let o=0;o<r.height;o++)for(let l=0;l<r.width;l++){const{index:c,frameIndex:d}=i(o,l);for(let h=0;h<this._png.channels;h++){const m=r.data[d+this._png.channels-1]/a,b=h%(this._png.channels-1)===0?1:r.data[d+h],p=Math.floor(m*b+(1-m)*n.data[c+h]);n.data[c+h]+=p}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var r;if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const n=this._isAnimated?((r=this._frames)==null?void 0:r.at(0)).data:this._inflator.result;if(this._filterMethod!==rp.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===bu.NO_INTERLACE)this._png.data=tp({data:n,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===bu.ADAM7)this._png.data=ty({data:n,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const n=this._inflator.result,r=this._frames.at(-1);r?r.data=n:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:kl.NONE,blendOp:yu.SOURCE,data:n}),this._inflator=new Zf,this._writingDataChunks=!1}}function vy(t){if(t!==1&&t!==2&&t!==4&&t!==8&&t!==16)throw new Error(`invalid bit depth: ${t}`);return t}var ip;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"})(ip||(ip={}));function by(t,e){return new my(t,e).decode()}var ft=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function _u(){ft.console&&typeof ft.console.log=="function"&&ft.console.log.apply(ft.console,arguments)}var Kt={log:_u,warn:function(t){ft.console&&(typeof ft.console.warn=="function"?ft.console.warn.apply(ft.console,arguments):_u.call(null,arguments))},error:function(t){ft.console&&(typeof ft.console.error=="function"?ft.console.error.apply(ft.console,arguments):_u(t))}};function wu(t,e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){Pa(r.response,e,n)},r.onerror=function(){Kt.error("could not download file")},r.send()}function ap(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function Nl(t){try{t.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var Pa=ft.saveAs||((typeof window>"u"?"undefined":Ht(window))!=="object"||window!==ft?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(t,e,n){var r=ft.URL||ft.webkitURL,a=document.createElement("a");e=e||t.name||"download",a.download=e,a.rel="noopener",typeof t=="string"?(a.href=t,a.origin!==location.origin?ap(a.href)?wu(t,e,n):Nl(a,a.target="_blank"):Nl(a)):(a.href=r.createObjectURL(t),setTimeout(function(){r.revokeObjectURL(a.href)},4e4),setTimeout(function(){Nl(a)},0))}:"msSaveOrOpenBlob"in navigator?function(t,e,n){if(e=e||t.name||"download",typeof t=="string")if(ap(t))wu(t,e,n);else{var r=document.createElement("a");r.href=t,r.target="_blank",setTimeout(function(){Nl(r)})}else navigator.msSaveOrOpenBlob((function(a,i){return i===void 0?i={autoBom:!1}:Ht(i)!=="object"&&(Kt.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a})(t,n),e)}:function(t,e,n,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),typeof t=="string")return wu(t,e,n);var a=t.type==="application/octet-stream",i=/constructor/i.test(ft.HTMLElement)||ft.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent);if((o||a&&i)&&(typeof FileReader>"u"?"undefined":Ht(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var h=l.result;h=o?h:h.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=h:location=h,r=null},l.readAsDataURL(t)}else{var c=ft.URL||ft.webkitURL,d=c.createObjectURL(t);r?r.location=d:location.href=d,r=null,setTimeout(function(){c.revokeObjectURL(d)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function tm(t){var e;t=t||"",this.ok=!1,t.charAt(0)=="#"&&(t=t.substr(1,6)),t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[t=(t=t.replace(/ /g,"")).toLowerCase()]||t;for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],r=0;r<n.length;r++){var a=n[r].re,i=n[r].process,o=a.exec(t);o&&(e=i(o),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),c=this.g.toString(16),d=this.b.toString(16);return l.length==1&&(l="0"+l),c.length==1&&(c="0"+c),d.length==1&&(d="0"+d),"#"+l+c+d}}var Fl=ft.atob.bind(ft),sp=ft.btoa.bind(ft);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function xu(t,e){var n=t[0],r=t[1],a=t[2],i=t[3];n=Kn(n,r,a,i,e[0],7,-680876936),i=Kn(i,n,r,a,e[1],12,-389564586),a=Kn(a,i,n,r,e[2],17,606105819),r=Kn(r,a,i,n,e[3],22,-1044525330),n=Kn(n,r,a,i,e[4],7,-176418897),i=Kn(i,n,r,a,e[5],12,1200080426),a=Kn(a,i,n,r,e[6],17,-1473231341),r=Kn(r,a,i,n,e[7],22,-45705983),n=Kn(n,r,a,i,e[8],7,1770035416),i=Kn(i,n,r,a,e[9],12,-1958414417),a=Kn(a,i,n,r,e[10],17,-42063),r=Kn(r,a,i,n,e[11],22,-1990404162),n=Kn(n,r,a,i,e[12],7,1804603682),i=Kn(i,n,r,a,e[13],12,-40341101),a=Kn(a,i,n,r,e[14],17,-1502002290),n=Jn(n,r=Kn(r,a,i,n,e[15],22,1236535329),a,i,e[1],5,-165796510),i=Jn(i,n,r,a,e[6],9,-1069501632),a=Jn(a,i,n,r,e[11],14,643717713),r=Jn(r,a,i,n,e[0],20,-373897302),n=Jn(n,r,a,i,e[5],5,-701558691),i=Jn(i,n,r,a,e[10],9,38016083),a=Jn(a,i,n,r,e[15],14,-660478335),r=Jn(r,a,i,n,e[4],20,-405537848),n=Jn(n,r,a,i,e[9],5,568446438),i=Jn(i,n,r,a,e[14],9,-1019803690),a=Jn(a,i,n,r,e[3],14,-187363961),r=Jn(r,a,i,n,e[8],20,1163531501),n=Jn(n,r,a,i,e[13],5,-1444681467),i=Jn(i,n,r,a,e[2],9,-51403784),a=Jn(a,i,n,r,e[7],14,1735328473),n=Yn(n,r=Jn(r,a,i,n,e[12],20,-1926607734),a,i,e[5],4,-378558),i=Yn(i,n,r,a,e[8],11,-2022574463),a=Yn(a,i,n,r,e[11],16,1839030562),r=Yn(r,a,i,n,e[14],23,-35309556),n=Yn(n,r,a,i,e[1],4,-1530992060),i=Yn(i,n,r,a,e[4],11,1272893353),a=Yn(a,i,n,r,e[7],16,-155497632),r=Yn(r,a,i,n,e[10],23,-1094730640),n=Yn(n,r,a,i,e[13],4,681279174),i=Yn(i,n,r,a,e[0],11,-358537222),a=Yn(a,i,n,r,e[3],16,-722521979),r=Yn(r,a,i,n,e[6],23,76029189),n=Yn(n,r,a,i,e[9],4,-640364487),i=Yn(i,n,r,a,e[12],11,-421815835),a=Yn(a,i,n,r,e[15],16,530742520),n=Xn(n,r=Yn(r,a,i,n,e[2],23,-995338651),a,i,e[0],6,-198630844),i=Xn(i,n,r,a,e[7],10,1126891415),a=Xn(a,i,n,r,e[14],15,-1416354905),r=Xn(r,a,i,n,e[5],21,-57434055),n=Xn(n,r,a,i,e[12],6,1700485571),i=Xn(i,n,r,a,e[3],10,-1894986606),a=Xn(a,i,n,r,e[10],15,-1051523),r=Xn(r,a,i,n,e[1],21,-2054922799),n=Xn(n,r,a,i,e[8],6,1873313359),i=Xn(i,n,r,a,e[15],10,-30611744),a=Xn(a,i,n,r,e[6],15,-1560198380),r=Xn(r,a,i,n,e[13],21,1309151649),n=Xn(n,r,a,i,e[4],6,-145523070),i=Xn(i,n,r,a,e[11],10,-1120210379),a=Xn(a,i,n,r,e[2],15,718787259),r=Xn(r,a,i,n,e[9],21,-343485551),t[0]=ca(n,t[0]),t[1]=ca(r,t[1]),t[2]=ca(a,t[2]),t[3]=ca(i,t[3])}function hc(t,e,n,r,a,i){return e=ca(ca(e,t),ca(r,i)),ca(e<<a|e>>>32-a,n)}function Kn(t,e,n,r,a,i,o){return hc(e&n|~e&r,t,e,a,i,o)}function Jn(t,e,n,r,a,i,o){return hc(e&r|n&~r,t,e,a,i,o)}function Yn(t,e,n,r,a,i,o){return hc(e^n^r,t,e,a,i,o)}function Xn(t,e,n,r,a,i,o){return hc(n^(e|~r),t,e,a,i,o)}function nm(t){var e,n=t.length,r=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)xu(r,yy(t.substring(e-64,e)));t=t.substring(e-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)a[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(a[e>>2]|=128<<(e%4<<3),e>55)for(xu(r,a),e=0;e<16;e++)a[e]=0;return a[14]=8*n,xu(r,a),r}function yy(t){var e,n=[];for(e=0;e<64;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}var op="0123456789abcdef".split("");function _y(t){for(var e="",n=0;n<4;n++)e+=op[t>>8*n+4&15]+op[t>>8*n&15];return e}function wy(t){return String.fromCharCode(255&t,(65280&t)>>8,(16711680&t)>>16,(4278190080&t)>>24)}function ad(t){return nm(t).map(wy).join("")}var xy=(function(t){for(var e=0;e<t.length;e++)t[e]=_y(t[e]);return t.join("")})(nm("hello"))!="5d41402abc4b2a76b9719d911017c592";function ca(t,e){if(xy){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}return t+e&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function sd(t,e){var n,r,a,i;if(t!==n){for(var o=(a=t,i=1+(256/t.length|0),new Array(i+1).join(a)),l=[],c=0;c<256;c++)l[c]=c;var d=0;for(c=0;c<256;c++){var h=l[c];d=(d+h+o.charCodeAt(c))%256,l[c]=l[d],l[d]=h}n=t,r=l}else l=r;var m=e.length,b=0,p=0,_="";for(c=0;c<m;c++)p=(p+(h=l[b=(b+1)%256]))%256,l[b]=l[p],l[p]=h,o=l[(l[b]+l[p])%256],_+=String.fromCharCode(e.charCodeAt(c)^o);return _}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var lp={print:4,modify:8,copy:16,"annot-forms":32};function ps(t,e,n,r){this.v=1,this.r=2;var a=192;t.forEach(function(l){if(lp.perm!==void 0)throw new Error("Invalid permission: "+l);a+=lp[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var i=(e+this.padding).substr(0,32),o=(n+this.padding).substr(0,32);this.O=this.processOwnerPassword(i,o),this.P=-(1+(255^a)),this.encryptionKey=ad(i+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=sd(this.encryptionKey,this.padding)}function gs(t){if(/[^\u0000-\u00ff]/.test(t))throw new Error("Invalid PDF Name Object: "+t+", Only accept ASCII characters.");for(var e="",n=t.length,r=0;r<n;r++){var a=t.charCodeAt(r);e+=a<33||a===35||a===37||a===40||a===41||a===47||a===60||a===62||a===91||a===93||a===123||a===125||a>126?"#"+("0"+a.toString(16)).slice(-2):t[r]}return e}function cp(t){if(Ht(t)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(n,r,a){if(a=a||!1,typeof n!="string"||typeof r!="function"||typeof a!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(n)||(e[n]={});var i=Math.random().toString(35);return e[n][i]=[r,!!a],i},this.unsubscribe=function(n){for(var r in e)if(e[r][n])return delete e[r][n],Object.keys(e[r]).length===0&&delete e[r],!0;return!1},this.publish=function(n){if(e.hasOwnProperty(n)){var r=Array.prototype.slice.call(arguments,1),a=[];for(var i in e[n]){var o=e[n][i];try{o[0].apply(t,r)}catch(l){ft.console&&Kt.error("jsPDF PubSub Error",l.message,l)}o[1]&&a.push(i)}a.length&&a.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function Zl(t){if(!(this instanceof Zl))return new Zl(t);var e="opacity,stroke-opacity".split(",");for(var n in t)t.hasOwnProperty(n)&&e.indexOf(n)>=0&&(this[n]=t[n]);this.id="",this.objectNumber=-1}function rm(t,e){this.gState=t,this.matrix=e,this.id="",this.objectNumber=-1}function Fa(t,e,n,r,a){if(!(this instanceof Fa))return new Fa(t,e,n,r,a);this.type=t==="axial"?2:3,this.coords=e,this.colors=n,rm.call(this,r,a)}function vs(t,e,n,r,a){if(!(this instanceof vs))return new vs(t,e,n,r,a);this.boundingBox=t,this.xStep=e,this.yStep=n,this.stream="",this.cloneIndex=0,rm.call(this,r,a)}function Xe(t){var e,n=typeof arguments[0]=="string"?arguments[0]:"p",r=arguments[1],a=arguments[2],i=arguments[3],o=[],l=1,c=16,d="S",h=null;Ht(t=t||{})==="object"&&(n=t.orientation,r=t.unit||r,a=t.format||a,i=t.compress||t.compressPdf||i,(h=t.encryption||null)!==null&&(h.userPassword=h.userPassword||"",h.ownerPassword=h.ownerPassword||"",h.userPermissions=h.userPermissions||[]),l=typeof t.userUnit=="number"?Math.abs(t.userUnit):1,t.precision!==void 0&&(e=t.precision),t.floatPrecision!==void 0&&(c=t.floatPrecision),d=t.defaultPathOperation||"S"),o=t.filters||(i===!0?["FlateEncode"]:o),r=r||"mm",n=(""+(n||"P")).toLowerCase();var m=t.putOnlyUsedFonts||!1,b={},p={internal:{},__private__:{}};p.__private__.PubSub=cp;var _="1.3",w=p.__private__.getPdfVersion=function(){return _};p.__private__.setPdfVersion=function(g){_=g};var S={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};p.__private__.getPageFormats=function(){return S};var x=p.__private__.getPageFormat=function(g){return S[g]};a=a||"a4";var T="compat",O="advanced",L=T;function K(){this.saveGraphicsState(),$(new rt(mt,0,0,-mt,0,va()*mt).toString()+" cm"),this.setFontSize(this.getFontSize()/mt),d="n",L=O}function te(){this.restoreGraphicsState(),d="S",L=T}var V=p.__private__.combineFontStyleAndFontWeight=function(g,N){if(g=="bold"&&N=="normal"||g=="bold"&&N==400||g=="normal"&&N=="italic"||g=="bold"&&N=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return N&&(g=N==400||N==="normal"?g==="italic"?"italic":"normal":N!=700&&N!=="bold"||g!=="normal"?(N==700?"bold":N)+""+g:"bold"),g};p.advancedAPI=function(g){var N=L===T;return N&&K.call(this),typeof g!="function"||(g(this),N&&te.call(this)),this},p.compatAPI=function(g){var N=L===O;return N&&te.call(this),typeof g!="function"||(g(this),N&&K.call(this)),this},p.isAdvancedAPI=function(){return L===O};var q,F=function(g){if(L!==O)throw new Error(g+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},C=p.roundToPrecision=p.__private__.roundToPrecision=function(g,N){var G=e||N;if(isNaN(g)||isNaN(G))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return g.toFixed(G).replace(/0+$/,"")};q=p.hpf=p.__private__.hpf=typeof c=="number"?function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.hpf");return C(g,c)}:c==="smart"?function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.hpf");return C(g,g>-1&&g<1?16:5)}:function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.hpf");return C(g,16)};var A=p.f2=p.__private__.f2=function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.f2");return C(g,2)},k=p.__private__.f3=function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.f3");return C(g,3)},M=p.scale=p.__private__.scale=function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.scale");return L===T?g*mt:L===O?g:void 0},j=function(g){return M((function(N){return L===T?va()-N:L===O?N:void 0})(g))};p.__private__.setPrecision=p.setPrecision=function(g){typeof parseInt(g,10)=="number"&&(e=parseInt(g,10))};var U,re="00000000000000000000000000000000",ce=p.__private__.getFileId=function(){return re},se=p.__private__.setFileId=function(g){return re=g!==void 0&&/^[a-fA-F0-9]{32}$/.test(g)?g.toUpperCase():re.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),h!==null&&(Pn=new ps(h.userPermissions,h.userPassword,h.ownerPassword,re)),re};p.setFileId=function(g){return se(g),this},p.getFileId=function(){return ce()};var fe=p.__private__.convertDateToPDFDate=function(g){var N=g.getTimezoneOffset(),G=N<0?"+":"-",Q=Math.floor(Math.abs(N/60)),le=Math.abs(N%60),_e=[G,J(Q),"'",J(le),"'"].join("");return["D:",g.getFullYear(),J(g.getMonth()+1),J(g.getDate()),J(g.getHours()),J(g.getMinutes()),J(g.getSeconds()),_e].join("")},xe=p.__private__.convertPDFDateToDate=function(g){var N=parseInt(g.substr(2,4),10),G=parseInt(g.substr(6,2),10)-1,Q=parseInt(g.substr(8,2),10),le=parseInt(g.substr(10,2),10),_e=parseInt(g.substr(12,2),10),Ae=parseInt(g.substr(14,2),10);return new Date(N,G,Q,le,_e,Ae,0)},ge=p.__private__.setCreationDate=function(g){var N;if(g===void 0&&(g=new Date),g instanceof Date)N=fe(g);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(g))throw new Error("Invalid argument passed to jsPDF.setCreationDate");N=g}return U=N},I=p.__private__.getCreationDate=function(g){var N=U;return g==="jsDate"&&(N=xe(U)),N};p.setCreationDate=function(g){return ge(g),this},p.getCreationDate=function(g){return I(g)};var z,J=p.__private__.padd2=function(g){return("0"+parseInt(g)).slice(-2)},X=p.__private__.padd2Hex=function(g){return("00"+(g=g.toString())).substr(g.length)},Z=0,ae=[],pe=[],Y=0,oe=[],be=[],Ce=!1,Te=pe;p.__private__.setCustomOutputDestination=function(g){Ce=!0,Te=g};var je=function(g){Ce||(Te=g)};p.__private__.resetCustomOutputDestination=function(){Ce=!1,Te=pe};var $=p.__private__.out=function(g){return g=g.toString(),Y+=g.length+1,Te.push(g),Te},Pe=p.__private__.write=function(g){return $(arguments.length===1?g.toString():Array.prototype.join.call(arguments," "))},ht=p.__private__.getArrayBuffer=function(g){for(var N=g.length,G=new ArrayBuffer(N),Q=new Uint8Array(G);N--;)Q[N]=g.charCodeAt(N);return G},He=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];p.__private__.getStandardFonts=function(){return He};var Se=t.fontSize||16;p.__private__.setFontSize=p.setFontSize=function(g){return Se=L===O?g/mt:g,this};var Ke,Re=p.__private__.getFontSize=p.getFontSize=function(){return L===T?Se:Se*mt},Qe=t.R2L||!1;p.__private__.setR2L=p.setR2L=function(g){return Qe=g,this},p.__private__.getR2L=p.getR2L=function(){return Qe};var Ie,it=p.__private__.setZoomMode=function(g){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(g))Ke=g;else if(isNaN(g)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(g)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+g+'" is not recognized.');Ke=g}else Ke=parseInt(g,10)};p.__private__.getZoomMode=function(){return Ke};var nt,at=p.__private__.setPageMode=function(g){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(g)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+g+'" is not recognized.');Ie=g};p.__private__.getPageMode=function(){return Ie};var ut=p.__private__.setLayoutMode=function(g){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(g)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+g+'" is not recognized.');nt=g};p.__private__.getLayoutMode=function(){return nt},p.__private__.setDisplayMode=p.setDisplayMode=function(g,N,G){return it(g),ut(N),at(G),this};var pt={title:"",subject:"",author:"",keywords:"",creator:""};p.__private__.getDocumentProperty=function(g){if(Object.keys(pt).indexOf(g)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return pt[g]},p.__private__.getDocumentProperties=function(){return pt},p.__private__.setDocumentProperties=p.setProperties=p.setDocumentProperties=function(g){for(var N in pt)pt.hasOwnProperty(N)&&g[N]&&(pt[N]=g[N]);return this},p.__private__.setDocumentProperty=function(g,N){if(Object.keys(pt).indexOf(g)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return pt[g]=N};var qe,mt,We,rn,Et,bt={},ct={},Dt=[],et={},jt={},st={},dt={},Ut=null,kt=0,tt=[],Ft=new cp(p),yi=t.hotfixes||[],Ct={},Gn={},Tr=[],rt=function g(N,G,Q,le,_e,Ae){if(!(this instanceof g))return new g(N,G,Q,le,_e,Ae);isNaN(N)&&(N=1),isNaN(G)&&(G=0),isNaN(Q)&&(Q=0),isNaN(le)&&(le=1),isNaN(_e)&&(_e=0),isNaN(Ae)&&(Ae=0),this._matrix=[N,G,Q,le,_e,Ae]};Object.defineProperty(rt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(g){this._matrix[0]=g}}),Object.defineProperty(rt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(g){this._matrix[1]=g}}),Object.defineProperty(rt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(g){this._matrix[2]=g}}),Object.defineProperty(rt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(g){this._matrix[3]=g}}),Object.defineProperty(rt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(g){this._matrix[4]=g}}),Object.defineProperty(rt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(g){this._matrix[5]=g}}),Object.defineProperty(rt.prototype,"a",{get:function(){return this._matrix[0]},set:function(g){this._matrix[0]=g}}),Object.defineProperty(rt.prototype,"b",{get:function(){return this._matrix[1]},set:function(g){this._matrix[1]=g}}),Object.defineProperty(rt.prototype,"c",{get:function(){return this._matrix[2]},set:function(g){this._matrix[2]=g}}),Object.defineProperty(rt.prototype,"d",{get:function(){return this._matrix[3]},set:function(g){this._matrix[3]=g}}),Object.defineProperty(rt.prototype,"e",{get:function(){return this._matrix[4]},set:function(g){this._matrix[4]=g}}),Object.defineProperty(rt.prototype,"f",{get:function(){return this._matrix[5]},set:function(g){this._matrix[5]=g}}),Object.defineProperty(rt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(rt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(rt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(rt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),rt.prototype.join=function(g){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(q).join(g)},rt.prototype.multiply=function(g){var N=g.sx*this.sx+g.shy*this.shx,G=g.sx*this.shy+g.shy*this.sy,Q=g.shx*this.sx+g.sy*this.shx,le=g.shx*this.shy+g.sy*this.sy,_e=g.tx*this.sx+g.ty*this.shx+this.tx,Ae=g.tx*this.shy+g.ty*this.sy+this.ty;return new rt(N,G,Q,le,_e,Ae)},rt.prototype.decompose=function(){var g=this.sx,N=this.shy,G=this.shx,Q=this.sy,le=this.tx,_e=this.ty,Ae=Math.sqrt(g*g+N*N),$e=(g/=Ae)*G+(N/=Ae)*Q;G-=g*$e,Q-=N*$e;var Je=Math.sqrt(G*G+Q*Q);return $e/=Je,g*(Q/=Je)<N*(G/=Je)&&(g=-g,N=-N,$e=-$e,Ae=-Ae),{scale:new rt(Ae,0,0,Je,0,0),translate:new rt(1,0,0,1,le,_e),rotate:new rt(g,N,-N,g,0,0),skew:new rt(1,0,$e,1,0,0)}},rt.prototype.toString=function(g){return this.join(" ")},rt.prototype.inversed=function(){var g=this.sx,N=this.shy,G=this.shx,Q=this.sy,le=this.tx,_e=this.ty,Ae=1/(g*Q-N*G),$e=Q*Ae,Je=-N*Ae,gt=-G*Ae,wt=g*Ae;return new rt($e,Je,gt,wt,-$e*le-gt*_e,-Je*le-wt*_e)},rt.prototype.applyToPoint=function(g){var N=g.x*this.sx+g.y*this.shx+this.tx,G=g.x*this.shy+g.y*this.sy+this.ty;return new Ai(N,G)},rt.prototype.applyToRectangle=function(g){var N=this.applyToPoint(g),G=this.applyToPoint(new Ai(g.x+g.w,g.y+g.h));return new Os(N.x,N.y,G.x-N.x,G.y-N.y)},rt.prototype.clone=function(){var g=this.sx,N=this.shy,G=this.shx,Q=this.sy,le=this.tx,_e=this.ty;return new rt(g,N,G,Q,le,_e)},p.Matrix=rt;var mr=p.matrixMult=function(g,N){return N.multiply(g)},Pr=new rt(1,0,0,1,0,0);p.unitMatrix=p.identityMatrix=Pr;var er=function(g,N){if(!jt[g]){var G=(N instanceof Fa?"Sh":"P")+(Object.keys(et).length+1).toString(10);N.id=G,jt[g]=G,et[G]=N,Ft.publish("addPattern",N)}};p.ShadingPattern=Fa,p.TilingPattern=vs,p.addShadingPattern=function(g,N){return F("addShadingPattern()"),er(g,N),this},p.beginTilingPattern=function(g){F("beginTilingPattern()"),Rs(g.boundingBox[0],g.boundingBox[1],g.boundingBox[2]-g.boundingBox[0],g.boundingBox[3]-g.boundingBox[1],g.matrix)},p.endTilingPattern=function(g,N){F("endTilingPattern()"),N.stream=be[z].join(`
`),er(g,N),Ft.publish("endTilingPattern",N),Tr.pop().restore()};var cr,It=p.__private__.newObject=function(){var g=Yt();return xn(g,!0),g},Yt=p.__private__.newObjectDeferred=function(){return Z++,ae[Z]=function(){return Y},Z},xn=function(g,N){return N=typeof N=="boolean"&&N,ae[g]=Y,N&&$(g+" 0 obj"),g},ii=p.__private__.newAdditionalObject=function(){var g={objId:Yt(),content:""};return oe.push(g),g},Ir=Yt(),ur=Yt(),Sn=p.__private__.decodeColorString=function(g){var N=g.split(" ");if(N.length!==2||N[1]!=="g"&&N[1]!=="G")N.length!==5||N[4]!=="k"&&N[4]!=="K"||(N=[(1-N[0])*(1-N[3]),(1-N[1])*(1-N[3]),(1-N[2])*(1-N[3]),"r"]);else{var G=parseFloat(N[0]);N=[G,G,G,"r"]}for(var Q="#",le=0;le<3;le++)Q+=("0"+Math.floor(255*parseFloat(N[le])).toString(16)).slice(-2);return Q},dr=p.__private__.encodeColorString=function(g){var N;typeof g=="string"&&(g={ch1:g});var G=g.ch1,Q=g.ch2,le=g.ch3,_e=g.ch4,Ae=g.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof G=="string"&&G.charAt(0)!=="#"){var $e=new tm(G);if($e.ok)G=$e.toHex();else if(!/^\d*\.?\d*$/.test(G))throw new Error('Invalid color "'+G+'" passed to jsPDF.encodeColorString.')}if(typeof G=="string"&&/^#[0-9A-Fa-f]{3}$/.test(G)&&(G="#"+G[1]+G[1]+G[2]+G[2]+G[3]+G[3]),typeof G=="string"&&/^#[0-9A-Fa-f]{6}$/.test(G)){var Je=parseInt(G.substr(1),16);G=Je>>16&255,Q=Je>>8&255,le=255&Je}if(Q===void 0||_e===void 0&&G===Q&&Q===le)N=typeof G=="string"?G+" "+Ae[0]:g.precision===2?A(G/255)+" "+Ae[0]:k(G/255)+" "+Ae[0];else if(_e===void 0||Ht(_e)==="object"){if(_e&&!isNaN(_e.a)&&_e.a===0)return["1.","1.","1.",Ae[1]].join(" ");N=typeof G=="string"?[G,Q,le,Ae[1]].join(" "):g.precision===2?[A(G/255),A(Q/255),A(le/255),Ae[1]].join(" "):[k(G/255),k(Q/255),k(le/255),Ae[1]].join(" ")}else N=typeof G=="string"?[G,Q,le,_e,Ae[2]].join(" "):g.precision===2?[A(G),A(Q),A(le),A(_e),Ae[2]].join(" "):[k(G),k(Q),k(le),k(_e),Ae[2]].join(" ");return N},hr=p.__private__.getFilters=function(){return o},tr=p.__private__.putStream=function(g){var N=(g=g||{}).data||"",G=g.filters||hr(),Q=g.alreadyAppliedFilters||[],le=g.addLength1||!1,_e=N.length,Ae=g.objectId,$e=function(In){return In};if(h!==null&&Ae===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");h!==null&&($e=Pn.encryptor(Ae,0));var Je={};G===!0&&(G=["FlateEncode"]);var gt=g.additionalKeyValues||[],wt=(Je=Xe.API.processDataByFilters!==void 0?Xe.API.processDataByFilters(N,G):{data:N,reverseChain:[]}).reverseChain+(Array.isArray(Q)?Q.join(" "):Q.toString());if(Je.data.length!==0&&(gt.push({key:"Length",value:Je.data.length}),le===!0&&gt.push({key:"Length1",value:_e})),wt.length!=0)if(wt.split("/").length-1==1)gt.push({key:"Filter",value:wt});else{gt.push({key:"Filter",value:"["+wt+"]"});for(var Ot=0;Ot<gt.length;Ot+=1)if(gt[Ot].key==="DecodeParms"){for(var on=[],kn=0;kn<Je.reverseChain.split("/").length-1;kn+=1)on.push("null");on.push(gt[Ot].value),gt[Ot].value="["+on.join(" ")+"]"}}$("<<");for(var Xt=0;Xt<gt.length;Xt++)$("/"+gt[Xt].key+" "+gt[Xt].value);$(">>"),Je.data.length!==0&&($("stream"),$($e(Je.data)),$("endstream"))},ai=p.__private__.putPage=function(g){var N=g.number,G=g.data,Q=g.objId,le=g.contentsObjId;xn(Q,!0),$("<</Type /Page"),$("/Parent "+g.rootDictionaryObjId+" 0 R"),$("/Resources "+g.resourceDictionaryObjId+" 0 R"),$("/MediaBox ["+parseFloat(q(g.mediaBox.bottomLeftX))+" "+parseFloat(q(g.mediaBox.bottomLeftY))+" "+q(g.mediaBox.topRightX)+" "+q(g.mediaBox.topRightY)+"]"),g.cropBox!==null&&$("/CropBox ["+q(g.cropBox.bottomLeftX)+" "+q(g.cropBox.bottomLeftY)+" "+q(g.cropBox.topRightX)+" "+q(g.cropBox.topRightY)+"]"),g.bleedBox!==null&&$("/BleedBox ["+q(g.bleedBox.bottomLeftX)+" "+q(g.bleedBox.bottomLeftY)+" "+q(g.bleedBox.topRightX)+" "+q(g.bleedBox.topRightY)+"]"),g.trimBox!==null&&$("/TrimBox ["+q(g.trimBox.bottomLeftX)+" "+q(g.trimBox.bottomLeftY)+" "+q(g.trimBox.topRightX)+" "+q(g.trimBox.topRightY)+"]"),g.artBox!==null&&$("/ArtBox ["+q(g.artBox.bottomLeftX)+" "+q(g.artBox.bottomLeftY)+" "+q(g.artBox.topRightX)+" "+q(g.artBox.topRightY)+"]"),typeof g.userUnit=="number"&&g.userUnit!==1&&$("/UserUnit "+g.userUnit),Ft.publish("putPage",{objId:Q,pageContext:tt[N],pageNumber:N,page:G}),$("/Contents "+le+" 0 R"),$(">>"),$("endobj");var _e=G.join(`
`);return L===O&&(_e+=`
Q`),xn(le,!0),tr({data:_e,filters:hr(),objectId:le}),$("endobj"),Q},Or=p.__private__.putPages=function(){var g,N,G=[];for(g=1;g<=kt;g++)tt[g].objId=Yt(),tt[g].contentsObjId=Yt();for(g=1;g<=kt;g++)G.push(ai({number:g,data:be[g],objId:tt[g].objId,contentsObjId:tt[g].contentsObjId,mediaBox:tt[g].mediaBox,cropBox:tt[g].cropBox,bleedBox:tt[g].bleedBox,trimBox:tt[g].trimBox,artBox:tt[g].artBox,userUnit:tt[g].userUnit,rootDictionaryObjId:Ir,resourceDictionaryObjId:ur}));xn(Ir,!0),$("<</Type /Pages");var Q="/Kids [";for(N=0;N<kt;N++)Q+=G[N]+" 0 R ";$(Q+"]"),$("/Count "+kt),$(">>"),$("endobj"),Ft.publish("postPutPages")},Ue=function(g){Ft.publish("putFont",{font:g,out:$,newObject:It,putStream:tr}),g.isAlreadyPutted!==!0&&(g.objectNumber=It(),$("<<"),$("/Type /Font"),$("/BaseFont /"+gs(g.postScriptName)),$("/Subtype /Type1"),typeof g.encoding=="string"&&$("/Encoding /"+g.encoding),$("/FirstChar 32"),$("/LastChar 255"),$(">>"),$("endobj"))},ee=function(g){g.objectNumber=It();var N=[];N.push({key:"Type",value:"/XObject"}),N.push({key:"Subtype",value:"/Form"}),N.push({key:"BBox",value:"["+[q(g.x),q(g.y),q(g.x+g.width),q(g.y+g.height)].join(" ")+"]"}),N.push({key:"Matrix",value:"["+g.matrix.toString()+"]"});var G=g.pages[1].join(`
`);tr({data:G,additionalKeyValues:N,objectId:g.objectNumber}),$("endobj")},Ne=function(g,N){N||(N=21);var G=It(),Q=(function(Ae,$e){var Je,gt=[],wt=1/($e-1);for(Je=0;Je<1;Je+=wt)gt.push(Je);if(gt.push(1),Ae[0].offset!=0){var Ot={offset:0,color:Ae[0].color};Ae.unshift(Ot)}if(Ae[Ae.length-1].offset!=1){var on={offset:1,color:Ae[Ae.length-1].color};Ae.push(on)}for(var kn="",Xt=0,In=0;In<gt.length;In++){for(Je=gt[In];Je>Ae[Xt+1].offset;)Xt++;var Nn=Ae[Xt].offset,Mn=(Je-Nn)/(Ae[Xt+1].offset-Nn),Ei=Ae[Xt].color,Hr=Ae[Xt+1].color;kn+=X(Math.round((1-Mn)*Ei[0]+Mn*Hr[0]).toString(16))+X(Math.round((1-Mn)*Ei[1]+Mn*Hr[1]).toString(16))+X(Math.round((1-Mn)*Ei[2]+Mn*Hr[2]).toString(16))}return kn.trim()})(g.colors,N),le=[];le.push({key:"FunctionType",value:"0"}),le.push({key:"Domain",value:"[0.0 1.0]"}),le.push({key:"Size",value:"["+N+"]"}),le.push({key:"BitsPerSample",value:"8"}),le.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),le.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),tr({data:Q,additionalKeyValues:le,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:G}),$("endobj"),g.objectNumber=It(),$("<< /ShadingType "+g.type),$("/ColorSpace /DeviceRGB");var _e="/Coords ["+q(parseFloat(g.coords[0]))+" "+q(parseFloat(g.coords[1]))+" ";g.type===2?_e+=q(parseFloat(g.coords[2]))+" "+q(parseFloat(g.coords[3])):_e+=q(parseFloat(g.coords[2]))+" "+q(parseFloat(g.coords[3]))+" "+q(parseFloat(g.coords[4]))+" "+q(parseFloat(g.coords[5])),$(_e+="]"),g.matrix&&$("/Matrix ["+g.matrix.toString()+"]"),$("/Function "+G+" 0 R"),$("/Extend [true true]"),$(">>"),$("endobj")},Fe=function(g,N){var G=Yt(),Q=It();N.push({resourcesOid:G,objectOid:Q}),g.objectNumber=Q;var le=[];le.push({key:"Type",value:"/Pattern"}),le.push({key:"PatternType",value:"1"}),le.push({key:"PaintType",value:"1"}),le.push({key:"TilingType",value:"1"}),le.push({key:"BBox",value:"["+g.boundingBox.map(q).join(" ")+"]"}),le.push({key:"XStep",value:q(g.xStep)}),le.push({key:"YStep",value:q(g.yStep)}),le.push({key:"Resources",value:G+" 0 R"}),g.matrix&&le.push({key:"Matrix",value:"["+g.matrix.toString()+"]"}),tr({data:g.stream,additionalKeyValues:le,objectId:g.objectNumber}),$("endobj")},Wt=function(g){for(var N in g.objectNumber=It(),$("<<"),g)switch(N){case"opacity":$("/ca "+A(g[N]));break;case"stroke-opacity":$("/CA "+A(g[N]))}$(">>"),$("endobj")},cn=function(g){xn(g.resourcesOid,!0),$("<<"),$("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var N in $("/Font <<"),bt)bt.hasOwnProperty(N)&&(m===!1||m===!0&&b.hasOwnProperty(N))&&$("/"+N+" "+bt[N].objectNumber+" 0 R");$(">>")})(),(function(){if(Object.keys(et).length>0){for(var N in $("/Shading <<"),et)et.hasOwnProperty(N)&&et[N]instanceof Fa&&et[N].objectNumber>=0&&$("/"+N+" "+et[N].objectNumber+" 0 R");Ft.publish("putShadingPatternDict"),$(">>")}})(),(function(N){if(Object.keys(et).length>0){for(var G in $("/Pattern <<"),et)et.hasOwnProperty(G)&&et[G]instanceof p.TilingPattern&&et[G].objectNumber>=0&&et[G].objectNumber<N&&$("/"+G+" "+et[G].objectNumber+" 0 R");Ft.publish("putTilingPatternDict"),$(">>")}})(g.objectOid),(function(){if(Object.keys(st).length>0){var N;for(N in $("/ExtGState <<"),st)st.hasOwnProperty(N)&&st[N].objectNumber>=0&&$("/"+N+" "+st[N].objectNumber+" 0 R");Ft.publish("putGStateDict"),$(">>")}})(),(function(){for(var N in $("/XObject <<"),Ct)Ct.hasOwnProperty(N)&&Ct[N].objectNumber>=0&&$("/"+N+" "+Ct[N].objectNumber+" 0 R");Ft.publish("putXobjectDict"),$(">>")})(),$(">>"),$("endobj")},en=function(g){ct[g.fontName]=ct[g.fontName]||{},ct[g.fontName][g.fontStyle]=g.id},Tn=function(g,N,G,Q,le){var _e={id:"F"+(Object.keys(bt).length+1).toString(10),postScriptName:g,fontName:N,fontStyle:G,encoding:Q,isStandardFont:le||!1,metadata:{}};return Ft.publish("addFont",{font:_e,instance:this}),bt[_e.id]=_e,en(_e),_e.id},un=p.__private__.pdfEscape=p.pdfEscape=function(g,N){return(function(G,Q){var le,_e,Ae,$e,Je,gt,wt,Ot,on;if(Ae=(Q=Q||{}).sourceEncoding||"Unicode",Je=Q.outputEncoding,(Q.autoencode||Je)&&bt[qe].metadata&&bt[qe].metadata[Ae]&&bt[qe].metadata[Ae].encoding&&($e=bt[qe].metadata[Ae].encoding,!Je&&bt[qe].encoding&&(Je=bt[qe].encoding),!Je&&$e.codePages&&(Je=$e.codePages[0]),typeof Je=="string"&&(Je=$e[Je]),Je)){for(wt=!1,gt=[],le=0,_e=G.length;le<_e;le++)(Ot=Je[G.charCodeAt(le)])?gt.push(String.fromCharCode(Ot)):gt.push(G[le]),gt[le].charCodeAt(0)>>8&&(wt=!0);G=gt.join("")}for(le=G.length;wt===void 0&&le!==0;)G.charCodeAt(le-1)>>8&&(wt=!0),le--;if(!wt)return G;for(gt=Q.noBOM?[]:[254,255],le=0,_e=G.length;le<_e;le++){if((on=(Ot=G.charCodeAt(le))>>8)>>8)throw new Error("Character at position "+le+" of string '"+G+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");gt.push(on),gt.push(Ot-(on<<8))}return String.fromCharCode.apply(void 0,gt)})(g,N).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Rr=p.__private__.beginPage=function(g){be[++kt]=[],tt[kt]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(g[0]),topRightY:Number(g[1])}},da(kt),je(be[z])},$i=function(g,N){var G,Q,le;switch(n=N||n,typeof g=="string"&&(G=x(g.toLowerCase()),Array.isArray(G)&&(Q=G[0],le=G[1])),Array.isArray(g)&&(Q=g[0]*mt,le=g[1]*mt),isNaN(Q)&&(Q=a[0],le=a[1]),(Q>14400||le>14400)&&(Kt.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Q=Math.min(14400,Q),le=Math.min(14400,le)),a=[Q,le],n.substr(0,1)){case"l":le>Q&&(a=[le,Q]);break;case"p":Q>le&&(a=[le,Q])}Rr(a),vt(Cs),$(Ja),Ps!==0&&$(Ps+" J"),Is!==0&&$(Is+" j"),Ft.publish("addPage",{pageNumber:kt})},sn=function(g){g>0&&g<=kt&&(be.splice(g,1),tt.splice(g,1),kt--,z>kt&&(z=kt),this.setPage(z))},da=function(g){g>0&&g<=kt&&(z=g)},ha=p.__private__.getNumberOfPages=p.getNumberOfPages=function(){return be.length-1},Io=function(g,N,G){var Q,le=void 0;return G=G||{},g=g!==void 0?g:bt[qe].fontName,N=N!==void 0?N:bt[qe].fontStyle,Q=g.toLowerCase(),ct[Q]!==void 0&&ct[Q][N]!==void 0?le=ct[Q][N]:ct[g]!==void 0&&ct[g][N]!==void 0?le=ct[g][N]:G.disableWarning===!1&&Kt.warn("Unable to look up font label for font '"+g+"', '"+N+"'. Refer to getFontList() for available fonts."),le||G.noFallback||(le=ct.times[N])==null&&(le=ct.times.normal),le},si=p.__private__.putInfo=function(){var g=It(),N=function(Q){return Q};for(var G in h!==null&&(N=Pn.encryptor(g,0)),$("<<"),$("/Producer ("+un(N("jsPDF "+Xe.version))+")"),pt)pt.hasOwnProperty(G)&&pt[G]&&$("/"+G.substr(0,1).toUpperCase()+G.substr(1)+" ("+un(N(pt[G]))+")");$("/CreationDate ("+un(N(U))+")"),$(">>"),$("endobj")},Ga=p.__private__.putCatalog=function(g){var N=(g=g||{}).rootDictionaryObjId||Ir;switch(It(),$("<<"),$("/Type /Catalog"),$("/Pages "+N+" 0 R"),Ke||(Ke="fullwidth"),Ke){case"fullwidth":$("/OpenAction [3 0 R /FitH null]");break;case"fullheight":$("/OpenAction [3 0 R /FitV null]");break;case"fullpage":$("/OpenAction [3 0 R /Fit]");break;case"original":$("/OpenAction [3 0 R /XYZ null null 1]");break;default:var G=""+Ke;G.substr(G.length-1)==="%"&&(Ke=parseInt(Ke)/100),typeof Ke=="number"&&$("/OpenAction [3 0 R /XYZ null null "+A(Ke)+"]")}switch(nt||(nt="continuous"),nt){case"continuous":$("/PageLayout /OneColumn");break;case"single":$("/PageLayout /SinglePage");break;case"two":case"twoleft":$("/PageLayout /TwoColumnLeft");break;case"tworight":$("/PageLayout /TwoColumnRight")}Ie&&$("/PageMode /"+Ie),Ft.publish("putCatalog"),$(">>"),$("endobj")},fc=p.__private__.putTrailer=function(){$("trailer"),$("<<"),$("/Size "+(Z+1)),$("/Root "+Z+" 0 R"),$("/Info "+(Z-1)+" 0 R"),h!==null&&$("/Encrypt "+Pn.oid+" 0 R"),$("/ID [ <"+re+"> <"+re+"> ]"),$(">>")},An=p.__private__.putHeader=function(){$("%PDF-"+_),$("%")},Oo=p.__private__.putXRef=function(){var g="0000000000";$("xref"),$("0 "+(Z+1)),$("0000000000 65535 f ");for(var N=1;N<=Z;N++)typeof ae[N]=="function"?$((g+ae[N]()).slice(-10)+" 00000 n "):ae[N]!==void 0?$((g+ae[N]).slice(-10)+" 00000 n "):$("0000000000 00000 n ")},oi=p.__private__.buildDocument=function(){var g;Z=0,Y=0,pe=[],ae=[],oe=[],Ir=Yt(),ur=Yt(),je(pe),Ft.publish("buildDocument"),An(),Or(),(function(){Ft.publish("putAdditionalObjects");for(var G=0;G<oe.length;G++){var Q=oe[G];xn(Q.objId,!0),$(Q.content),$("endobj")}Ft.publish("postPutAdditionalObjects")})(),g=[],(function(){for(var G in bt)bt.hasOwnProperty(G)&&(m===!1||m===!0&&b.hasOwnProperty(G))&&Ue(bt[G])})(),(function(){var G;for(G in st)st.hasOwnProperty(G)&&Wt(st[G])})(),(function(){for(var G in Ct)Ct.hasOwnProperty(G)&&ee(Ct[G])})(),(function(G){var Q;for(Q in et)et.hasOwnProperty(Q)&&(et[Q]instanceof Fa?Ne(et[Q]):et[Q]instanceof vs&&Fe(et[Q],G))})(g),Ft.publish("putResources"),g.forEach(cn),cn({resourcesOid:ur,objectOid:Number.MAX_SAFE_INTEGER}),Ft.publish("postPutResources"),h!==null&&(Pn.oid=It(),$("<<"),$("/Filter /Standard"),$("/V "+Pn.v),$("/R "+Pn.r),$("/U <"+Pn.toHexString(Pn.U)+">"),$("/O <"+Pn.toHexString(Pn.O)+">"),$("/P "+Pn.P),$(">>"),$("endobj")),si(),Ga();var N=Y;return Oo(),fc(),$("startxref"),$(""+N),$("%%EOF"),je(be[z]),pe.join(`
`)},Va=p.__private__.getBlob=function(g){return new Blob([ht(g)],{type:"application/pdf"})},Ro=p.output=p.__private__.output=(cr=function(g,N){switch(typeof(N=N||{})=="string"?N={filename:N}:N.filename=N.filename||"generated.pdf",g){case void 0:return oi();case"save":p.save(N.filename);break;case"arraybuffer":return ht(oi());case"blob":return Va(oi());case"bloburi":case"bloburl":if(ft.URL!==void 0&&typeof ft.URL.createObjectURL=="function")return ft.URL&&ft.URL.createObjectURL(Va(oi()))||void 0;Kt.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var G="",Q=oi();try{G=sp(Q)}catch{G=sp(unescape(encodeURIComponent(Q)))}return"data:application/pdf;filename="+N.filename+";base64,"+G;case"pdfobjectnewwindow":if(Object.prototype.toString.call(ft)==="[object Window]"){var le="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",_e=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';N.pdfObjectUrl&&(le=N.pdfObjectUrl,_e="");var Ae='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+le+'"'+_e+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(N)+");<\/script></body></html>",$e=ft.open();return $e!==null&&$e.document.write(Ae),$e}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(ft)==="[object Window]"){var Je='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(N.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+N.filename+'" width="500px" height="400px" /></body></html>',gt=ft.open();if(gt!==null){gt.document.write(Je);var wt=this;gt.document.documentElement.querySelector("#pdfViewer").onload=function(){gt.document.title=N.filename,gt.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(wt.output("bloburl"))}}return gt}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(ft)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Ot='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",N)+'"></iframe></body></html>',on=ft.open();if(on!==null&&(on.document.write(Ot),on.document.title=N.filename),on||typeof safari>"u")return on;break;case"datauri":case"dataurl":return ft.document.location.href=this.output("datauristring",N);default:return null}},cr.foo=function(){try{return cr.apply(this,arguments)}catch(G){var g=G.stack||"";~g.indexOf(" at ")&&(g=g.split(" at ")[1]);var N="Error in function "+g.split(`
`)[0].split("<")[0]+": "+G.message;if(!ft.console)throw new Error(N);ft.console.error(N,G),ft.alert&&alert(N)}},cr.foo.bar=cr,cr.foo),Fr=function(g){return Array.isArray(yi)===!0&&yi.indexOf(g)>-1};switch(r){case"pt":mt=1;break;case"mm":mt=72/25.4;break;case"cm":mt=72/2.54;break;case"in":mt=72;break;case"px":mt=Fr("px_scaling")==1?.75:96/72;break;case"pc":case"em":mt=12;break;case"ex":mt=6;break;default:if(typeof r!="number")throw new Error("Invalid unit: "+r);mt=r}var Pn=null;ge(),se();var _i=p.__private__.getPageInfo=p.getPageInfo=function(g){if(isNaN(g)||g%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:tt[g].objId,pageNumber:g,pageContext:tt[g]}},Fo=p.__private__.getPageInfoByObjId=function(g){if(isNaN(g)||g%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var N in tt)if(tt[N].objId===g)break;return _i(N)},pc=p.__private__.getCurrentPageInfo=p.getCurrentPageInfo=function(){return{objId:tt[z].objId,pageNumber:z,pageContext:tt[z]}};p.addPage=function(){return $i.apply(this,arguments),this},p.setPage=function(){return da.apply(this,arguments),je.call(this,be[z]),this},p.insertPage=function(g){return this.addPage(),this.movePage(z,g),this},p.movePage=function(g,N){var G,Q;if(g>N){G=be[g],Q=tt[g];for(var le=g;le>N;le--)be[le]=be[le-1],tt[le]=tt[le-1];be[N]=G,tt[N]=Q,this.setPage(N)}else if(g<N){G=be[g],Q=tt[g];for(var _e=g;_e<N;_e++)be[_e]=be[_e+1],tt[_e]=tt[_e+1];be[N]=G,tt[N]=Q,this.setPage(N)}return this},p.deletePage=function(){return sn.apply(this,arguments),this},p.__private__.text=p.text=function(g,N,G,Q,le){var _e,Ae,$e,Je,gt,wt,Ot,on,kn,Xt=(Q=Q||{}).scope||this;if(typeof g=="number"&&typeof N=="number"&&(typeof G=="string"||Array.isArray(G))){var In=G;G=N,N=g,g=In}if(arguments[3]instanceof rt==0?($e=arguments[4],Je=arguments[5],Ht(Ot=arguments[3])==="object"&&Ot!==null||(typeof $e=="string"&&(Je=$e,$e=null),typeof Ot=="string"&&(Je=Ot,Ot=null),typeof Ot=="number"&&($e=Ot,Ot=null),Q={flags:Ot,angle:$e,align:Je})):(F("The transform parameter of text() with a Matrix value"),kn=le),isNaN(N)||isNaN(G)||g==null)throw new Error("Invalid arguments passed to jsPDF.text");if(g.length===0)return Xt;var Nn,Mn="",Ei=typeof Q.lineHeightFactor=="number"?Q.lineHeightFactor:pa,Hr=Xt.internal.scaleFactor;function Li(Bt){return Bt=Bt.split("	").join(Array(Q.TabLen||9).join(" ")),un(Bt,Ot)}function Ds(Bt){for(var Gt,mn=Bt.concat(),On=[],Pi=mn.length;Pi--;)typeof(Gt=mn.shift())=="string"?On.push(Gt):Array.isArray(Bt)&&(Gt.length===1||Gt[1]===void 0&&Gt[2]===void 0)?On.push(Gt[0]):On.push([Gt[0],Gt[1],Gt[2]]);return On}function Xa(Bt,Gt){var mn;if(typeof Bt=="string")mn=Gt(Bt)[0];else if(Array.isArray(Bt)){for(var On,Pi,Gs=Bt.concat(),es=[],Go=Gs.length;Go--;)typeof(On=Gs.shift())=="string"?es.push(Gt(On)[0]):Array.isArray(On)&&typeof On[0]=="string"&&(Pi=Gt(On[0],On[1],On[2]),es.push([Pi[0],Pi[1],Pi[2]]));mn=es}return mn}var qi=!1,ba=!0;if(typeof g=="string")qi=!0;else if(Array.isArray(g)){var ya=g.concat();Ae=[];for(var zi,Un=ya.length;Un--;)(typeof(zi=ya.shift())!="string"||Array.isArray(zi)&&typeof zi[0]!="string")&&(ba=!1);qi=ba}if(qi===!1)throw new Error('Type of text must be string or Array. "'+g+'" is not recognized.');typeof g=="string"&&(g=g.match(/[\r?\n]/)?g.split(/\r\n|\r|\n/g):[g]);var _a=Se/Xt.internal.scaleFactor,wa=_a*(Ei-1);switch(Q.baseline){case"bottom":G-=wa;break;case"top":G+=_a-wa;break;case"hanging":G+=_a-2*wa;break;case"middle":G+=_a/2-wa}if((wt=Q.maxWidth||0)>0&&(typeof g=="string"?g=Xt.splitTextToSize(g,wt):Object.prototype.toString.call(g)==="[object Array]"&&(g=g.reduce(function(Bt,Gt){return Bt.concat(Xt.splitTextToSize(Gt,wt))},[]))),_e={text:g,x:N,y:G,options:Q,mutex:{pdfEscape:un,activeFontKey:qe,fonts:bt,activeFontSize:Se}},Ft.publish("preProcessText",_e),g=_e.text,$e=(Q=_e.options).angle,kn instanceof rt==0&&$e&&typeof $e=="number"){$e*=Math.PI/180,Q.rotationDirection===0&&($e=-$e),L===O&&($e=-$e);var js=Math.cos($e),Bs=Math.sin($e);kn=new rt(js,Bs,-Bs,js,0,0)}else $e&&$e instanceof rt&&(kn=$e);L!==O||kn||(kn=Pr),(gt=Q.charSpace||Si)!==void 0&&(Mn+=q(M(gt))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(on=Q.horizontalScale)!==void 0&&(Mn+=q(100*on)+` Tz
`),Q.lang;var nr=-1,Ci=Q.renderingMode!==void 0?Q.renderingMode:Q.stroke,Za=Xt.internal.getCurrentPageInfo().pageContext;switch(Ci){case 0:case!1:case"fill":nr=0;break;case 1:case!0:case"stroke":nr=1;break;case 2:case"fillThenStroke":nr=2;break;case 3:case"invisible":nr=3;break;case 4:case"fillAndAddForClipping":nr=4;break;case 5:case"strokeAndAddPathForClipping":nr=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":nr=6;break;case 7:case"addToPathForClipping":nr=7}var Ho=Za.usedRenderingMode!==void 0?Za.usedRenderingMode:-1;nr!==-1?Mn+=nr+` Tr
`:Ho!==-1&&(Mn+=`0 Tr
`),nr!==-1&&(Za.usedRenderingMode=nr),Je=Q.align||"left";var Dr,xa=Se*Ei,Ms=Xt.internal.pageSize.getWidth(),Us=bt[qe];gt=Q.charSpace||Si,wt=Q.maxWidth||0,Ot=Object.assign({autoencode:!0,noBOM:!0},Q.flags);var Hi=[],Sa=function(Bt){return Xt.getStringUnitWidth(Bt,{font:Us,charSpace:gt,fontSize:Se,doKerning:!1})*Se/Hr};if(Object.prototype.toString.call(g)==="[object Array]"){var vr;Ae=Ds(g),Je!=="left"&&(Dr=Ae.map(Sa));var br,Wi=0;if(Je==="right"){N-=Dr[0],g=[],Un=Ae.length;for(var Ti=0;Ti<Un;Ti++)Ti===0?(br=wi(N),vr=xi(G)):(br=M(Wi-Dr[Ti]),vr=-xa),g.push([Ae[Ti],br,vr]),Wi=Dr[Ti]}else if(Je==="center"){N-=Dr[0]/2,g=[],Un=Ae.length;for(var Gi=0;Gi<Un;Gi++)Gi===0?(br=wi(N),vr=xi(G)):(br=M((Wi-Dr[Gi])/2),vr=-xa),g.push([Ae[Gi],br,vr]),Wi=Dr[Gi]}else if(Je==="left"){g=[],Un=Ae.length;for(var $s=0;$s<Un;$s++)g.push(Ae[$s])}else if(Je==="justify"&&Us.encoding==="Identity-H"){g=[],Un=Ae.length,wt=wt!==0?wt:Ms;for(var Qa=0,gn=0;gn<Un;gn++)if(vr=gn===0?xi(G):-xa,br=gn===0?wi(N):Qa,gn<Un-1){var Wo=M((wt-Dr[gn])/(Ae[gn].split(" ").length-1)),ci=Ae[gn].split(" ");g.push([ci[0]+" ",br,vr]),Qa=0;for(var ui=1;ui<ci.length;ui++){var qs=(Sa(ci[ui-1]+" "+ci[ui])-Sa(ci[ui]))*Hr+Wo;ui==ci.length-1?g.push([ci[ui],qs,0]):g.push([ci[ui]+" ",qs,0]),Qa-=qs}}else g.push([Ae[gn],br,vr]);g.push(["",Qa,0])}else{if(Je!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(g=[],Un=Ae.length,wt=wt!==0?wt:Ms,gn=0;gn<Un;gn++){vr=gn===0?xi(G):-xa,br=gn===0?wi(N):0;var zs=Ae[gn].split(" ").length-1,Hs=zs>0?(wt-Dr[gn])/zs:0;gn<Un-1?Hi.push(q(M(Hs))):Hi.push(0),g.push([Ae[gn],br,vr])}}}(typeof Q.R2L=="boolean"?Q.R2L:Qe)===!0&&(g=Xa(g,function(Bt,Gt,mn){return[Bt.split("").reverse().join(""),Gt,mn]})),_e={text:g,x:N,y:G,options:Q,mutex:{pdfEscape:un,activeFontKey:qe,fonts:bt,activeFontSize:Se}},Ft.publish("postProcessText",_e),g=_e.text,Nn=_e.mutex.isHex||!1;var Ws=bt[qe].encoding;Ws!=="WinAnsiEncoding"&&Ws!=="StandardEncoding"||(g=Xa(g,function(Bt,Gt,mn){return[Li(Bt),Gt,mn]})),Ae=Ds(g),g=[];for(var Vi,Ki,Ji,Aa=Array.isArray(Ae[0])?1:0,Yi="",ka=function(Bt,Gt,mn){var On="";return mn instanceof rt?(mn=typeof Q.angle=="number"?mr(mn,new rt(1,0,0,1,Bt,Gt)):mr(new rt(1,0,0,1,Bt,Gt),mn),L===O&&(mn=mr(new rt(1,0,0,-1,0,0),mn)),On=mn.join(" ")+` Tm
`):On=q(Bt)+" "+q(Gt)+` Td
`,On},jr=0;jr<Ae.length;jr++){switch(Yi="",Aa){case 1:Ji=(Nn?"<":"(")+Ae[jr][0]+(Nn?">":")"),Vi=parseFloat(Ae[jr][1]),Ki=parseFloat(Ae[jr][2]);break;case 0:Ji=(Nn?"<":"(")+Ae[jr]+(Nn?">":")"),Vi=wi(N),Ki=xi(G)}Hi!==void 0&&Hi[jr]!==void 0&&(Yi=Hi[jr]+` Tw
`),jr===0?g.push(Yi+ka(Vi,Ki,kn)+Ji):Aa===0?g.push(Yi+Ji):Aa===1&&g.push(Yi+ka(Vi,Ki,kn)+Ji)}g=Aa===0?g.join(` Tj
T* `):g.join(` Tj
`),g+=` Tj
`;var di=`BT
/`;return di+=qe+" "+Se+` Tf
`,di+=q(Se*Ei)+` TL
`,di+=ga+`
`,di+=Mn,di+=g,$(di+="ET"),b[qe]=!0,Xt};var gc=p.__private__.clip=p.clip=function(g){return $(g==="evenodd"?"W*":"W"),this};p.clipEvenOdd=function(){return gc("evenodd")},p.__private__.discardPath=p.discardPath=function(){return $("n"),this};var li=p.__private__.isValidStyle=function(g){var N=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(g)!==-1&&(N=!0),N};p.__private__.setDefaultPathOperation=p.setDefaultPathOperation=function(g){return li(g)&&(d=g),this};var Do=p.__private__.getStyle=p.getStyle=function(g){var N=d;switch(g){case"D":case"S":N="S";break;case"F":N="f";break;case"FD":case"DF":N="B";break;case"f":case"f*":case"B":case"B*":N=g}return N},jo=p.close=function(){return $("h"),this};p.stroke=function(){return $("S"),this},p.fill=function(g){return Ka("f",g),this},p.fillEvenOdd=function(g){return Ka("f*",g),this},p.fillStroke=function(g){return Ka("B",g),this},p.fillStrokeEvenOdd=function(g){return Ka("B*",g),this};var Ka=function(g,N){Ht(N)==="object"?vc(N,g):$(g)},fa=function(g){g===null||L===O&&g===void 0||(g=Do(g),$(g))};function mc(g,N,G,Q,le){var _e=new vs(N||this.boundingBox,G||this.xStep,Q||this.yStep,this.gState,le||this.matrix);_e.stream=this.stream;var Ae=g+"$$"+this.cloneIndex+++"$$";return er(Ae,_e),_e}var vc=function(g,N){var G=jt[g.key],Q=et[G];if(Q instanceof Fa)$("q"),$(bc(N)),Q.gState&&p.setGState(Q.gState),$(g.matrix.toString()+" cm"),$("/"+G+" sh"),$("Q");else if(Q instanceof vs){var le=new rt(1,0,0,-1,0,va());g.matrix&&(le=le.multiply(g.matrix||Pr),G=mc.call(Q,g.key,g.boundingBox,g.xStep,g.yStep,le).id),$("q"),$("/Pattern cs"),$("/"+G+" scn"),Q.gState&&p.setGState(Q.gState),$(N),$("Q")}},bc=function(g){switch(g){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Ls=p.moveTo=function(g,N){return $(q(M(g))+" "+q(j(N))+" m"),this},Bo=p.lineTo=function(g,N){return $(q(M(g))+" "+q(j(N))+" l"),this},zr=p.curveTo=function(g,N,G,Q,le,_e){return $([q(M(g)),q(j(N)),q(M(G)),q(j(Q)),q(M(le)),q(j(_e)),"c"].join(" ")),this};p.__private__.line=p.line=function(g,N,G,Q,le){if(isNaN(g)||isNaN(N)||isNaN(G)||isNaN(Q)||!li(le))throw new Error("Invalid arguments passed to jsPDF.line");return L===T?this.lines([[G-g,Q-N]],g,N,[1,1],le||"S"):this.lines([[G-g,Q-N]],g,N,[1,1]).stroke()},p.__private__.lines=p.lines=function(g,N,G,Q,le,_e){var Ae,$e,Je,gt,wt,Ot,on,kn,Xt,In,Nn,Mn;if(typeof g=="number"&&(Mn=G,G=N,N=g,g=Mn),Q=Q||[1,1],_e=_e||!1,isNaN(N)||isNaN(G)||!Array.isArray(g)||!Array.isArray(Q)||!li(le)||typeof _e!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Ls(N,G),Ae=Q[0],$e=Q[1],gt=g.length,In=N,Nn=G,Je=0;Je<gt;Je++)(wt=g[Je]).length===2?(In=wt[0]*Ae+In,Nn=wt[1]*$e+Nn,Bo(In,Nn)):(Ot=wt[0]*Ae+In,on=wt[1]*$e+Nn,kn=wt[2]*Ae+In,Xt=wt[3]*$e+Nn,In=wt[4]*Ae+In,Nn=wt[5]*$e+Nn,zr(Ot,on,kn,Xt,In,Nn));return _e&&jo(),fa(le),this},p.path=function(g){for(var N=0;N<g.length;N++){var G=g[N],Q=G.c;switch(G.op){case"m":Ls(Q[0],Q[1]);break;case"l":Bo(Q[0],Q[1]);break;case"c":zr.apply(this,Q);break;case"h":jo()}}return this},p.__private__.rect=p.rect=function(g,N,G,Q,le){if(isNaN(g)||isNaN(N)||isNaN(G)||isNaN(Q)||!li(le))throw new Error("Invalid arguments passed to jsPDF.rect");return L===T&&(Q=-Q),$([q(M(g)),q(j(N)),q(M(G)),q(M(Q)),"re"].join(" ")),fa(le),this},p.__private__.triangle=p.triangle=function(g,N,G,Q,le,_e,Ae){if(isNaN(g)||isNaN(N)||isNaN(G)||isNaN(Q)||isNaN(le)||isNaN(_e)||!li(Ae))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[G-g,Q-N],[le-G,_e-Q],[g-le,N-_e]],g,N,[1,1],Ae,!0),this},p.__private__.roundedRect=p.roundedRect=function(g,N,G,Q,le,_e,Ae){if(isNaN(g)||isNaN(N)||isNaN(G)||isNaN(Q)||isNaN(le)||isNaN(_e)||!li(Ae))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var $e=4/3*(Math.SQRT2-1);return le=Math.min(le,.5*G),_e=Math.min(_e,.5*Q),this.lines([[G-2*le,0],[le*$e,0,le,_e-_e*$e,le,_e],[0,Q-2*_e],[0,_e*$e,-le*$e,_e,-le,_e],[2*le-G,0],[-le*$e,0,-le,-_e*$e,-le,-_e],[0,2*_e-Q],[0,-_e*$e,le*$e,-_e,le,-_e]],g+le,N,[1,1],Ae,!0),this},p.__private__.ellipse=p.ellipse=function(g,N,G,Q,le){if(isNaN(g)||isNaN(N)||isNaN(G)||isNaN(Q)||!li(le))throw new Error("Invalid arguments passed to jsPDF.ellipse");var _e=4/3*(Math.SQRT2-1)*G,Ae=4/3*(Math.SQRT2-1)*Q;return Ls(g+G,N),zr(g+G,N-Ae,g+_e,N-Q,g,N-Q),zr(g-_e,N-Q,g-G,N-Ae,g-G,N),zr(g-G,N+Ae,g-_e,N+Q,g,N+Q),zr(g+_e,N+Q,g+G,N+Ae,g+G,N),fa(le),this},p.__private__.circle=p.circle=function(g,N,G,Q){if(isNaN(g)||isNaN(N)||isNaN(G)||!li(Q))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(g,N,G,G,Q)},p.setFont=function(g,N,G){return G&&(N=V(N,G)),qe=Io(g,N,{disableWarning:!1}),this};var yc=p.__private__.getFont=p.getFont=function(){return bt[Io.apply(p,arguments)]};p.__private__.getFontList=p.getFontList=function(){var g,N,G={};for(g in ct)if(ct.hasOwnProperty(g))for(N in G[g]=[],ct[g])ct[g].hasOwnProperty(N)&&G[g].push(N);return G},p.addFont=function(g,N,G,Q,le){var _e=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&_e.indexOf(arguments[3])!==-1?le=arguments[3]:arguments[3]&&_e.indexOf(arguments[3])==-1&&(G=V(G,Q)),Tn.call(this,g,N,G,le=le||"Identity-H")};var pa,Cs=t.lineWidth||.200025,_c=p.__private__.getLineWidth=p.getLineWidth=function(){return Cs},vt=p.__private__.setLineWidth=p.setLineWidth=function(g){return Cs=g,$(q(M(g))+" w"),this};p.__private__.setLineDash=Xe.API.setLineDash=Xe.API.setLineDashPattern=function(g,N){if(g=g||[],N=N||0,isNaN(N)||!Array.isArray(g))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return g=g.map(function(G){return q(M(G))}).join(" "),N=q(M(N)),$("["+g+"] "+N+" d"),this};var wc=p.__private__.getLineHeight=p.getLineHeight=function(){return Se*pa};p.__private__.getLineHeight=p.getLineHeight=function(){return Se*pa};var xc=p.__private__.setLineHeightFactor=p.setLineHeightFactor=function(g){return typeof(g=g||1.15)=="number"&&(pa=g),this},Sc=p.__private__.getLineHeightFactor=p.getLineHeightFactor=function(){return pa};xc(t.lineHeight);var wi=p.__private__.getHorizontalCoordinate=function(g){return M(g)},xi=p.__private__.getVerticalCoordinate=function(g){return L===O?g:tt[z].mediaBox.topRightY-tt[z].mediaBox.bottomLeftY-M(g)},Ac=p.__private__.getHorizontalCoordinateString=p.getHorizontalCoordinateString=function(g){return q(wi(g))},kc=p.__private__.getVerticalCoordinateString=p.getVerticalCoordinateString=function(g){return q(xi(g))},Ja=t.strokeColor||"0 G";p.__private__.getStrokeColor=p.getDrawColor=function(){return Sn(Ja)},p.__private__.setStrokeColor=p.setDrawColor=function(g,N,G,Q){return Ja=dr({ch1:g,ch2:N,ch3:G,ch4:Q,pdfColorType:"draw",precision:2}),$(Ja),this};var Ts=t.fillColor||"0 g";p.__private__.getFillColor=p.getFillColor=function(){return Sn(Ts)},p.__private__.setFillColor=p.setFillColor=function(g,N,G,Q){return Ts=dr({ch1:g,ch2:N,ch3:G,ch4:Q,pdfColorType:"fill",precision:2}),$(Ts),this};var ga=t.textColor||"0 g",Nc=p.__private__.getTextColor=p.getTextColor=function(){return Sn(ga)};p.__private__.setTextColor=p.setTextColor=function(g,N,G,Q){return ga=dr({ch1:g,ch2:N,ch3:G,ch4:Q,pdfColorType:"text",precision:3}),this};var Si=t.charSpace,Ec=p.__private__.getCharSpace=p.getCharSpace=function(){return parseFloat(Si||0)};p.__private__.setCharSpace=p.setCharSpace=function(g){if(isNaN(g))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Si=g,this};var Ps=0;p.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},p.__private__.setLineCap=p.setLineCap=function(g){var N=p.CapJoinStyles[g];if(N===void 0)throw new Error("Line cap style of '"+g+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Ps=N,$(N+" J"),this};var Is=0;p.__private__.setLineJoin=p.setLineJoin=function(g){var N=p.CapJoinStyles[g];if(N===void 0)throw new Error("Line join style of '"+g+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Is=N,$(N+" j"),this},p.__private__.setLineMiterLimit=p.__private__.setMiterLimit=p.setLineMiterLimit=p.setMiterLimit=function(g){if(g=g||0,isNaN(g))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return $(q(M(g))+" M"),this},p.GState=Zl,p.setGState=function(g){(g=typeof g=="string"?st[dt[g]]:Mo(null,g)).equals(Ut)||($("/"+g.id+" gs"),Ut=g)};var Mo=function(g,N){if(!g||!dt[g]){var G=!1;for(var Q in st)if(st.hasOwnProperty(Q)&&st[Q].equals(N)){G=!0;break}if(G)N=st[Q];else{var le="GS"+(Object.keys(st).length+1).toString(10);st[le]=N,N.id=le}return g&&(dt[g]=N.id),Ft.publish("addGState",N),N}};p.addGState=function(g,N){return Mo(g,N),this},p.saveGraphicsState=function(){return $("q"),Dt.push({key:qe,size:Se,color:ga}),this},p.restoreGraphicsState=function(){$("Q");var g=Dt.pop();return qe=g.key,Se=g.size,ga=g.color,Ut=null,this},p.setCurrentTransformationMatrix=function(g){return $(g.toString()+" cm"),this},p.comment=function(g){return $("#"+g),this};var Ai=function(g,N){var G=g||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return G},set:function(_e){isNaN(_e)||(G=parseFloat(_e))}});var Q=N||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Q},set:function(_e){isNaN(_e)||(Q=parseFloat(_e))}});var le="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return le},set:function(_e){le=_e.toString()}}),this},Os=function(g,N,G,Q){Ai.call(this,g,N),this.type="rect";var le=G||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return le},set:function(Ae){isNaN(Ae)||(le=parseFloat(Ae))}});var _e=Q||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return _e},set:function(Ae){isNaN(Ae)||(_e=parseFloat(Ae))}}),this},Ya=function(){this.page=kt,this.currentPage=z,this.pages=be.slice(0),this.pagesContext=tt.slice(0),this.x=We,this.y=rn,this.matrix=Et,this.width=Fs(z),this.height=$o(z),this.outputDestination=Te,this.id="",this.objectNumber=-1};Ya.prototype.restore=function(){kt=this.page,z=this.currentPage,tt=this.pagesContext,be=this.pages,We=this.x,rn=this.y,Et=this.matrix,Uo(z,this.width),ki(z,this.height),Te=this.outputDestination};var Rs=function(g,N,G,Q,le){Tr.push(new Ya),kt=z=0,be=[],We=g,rn=N,Et=le,Rr([G,Q])};for(var ma in p.beginFormObject=function(g,N,G,Q,le){return Rs(g,N,G,Q,le),this},p.endFormObject=function(g){return(function(N){if(Gn[N])Tr.pop().restore();else{var G=new Ya,Q="Xo"+(Object.keys(Ct).length+1).toString(10);G.id=Q,Gn[N]=Q,Ct[Q]=G,Ft.publish("addFormObject",G),Tr.pop().restore()}})(g),this},p.doFormObject=function(g,N){var G=Ct[Gn[g]];return $("q"),$(N.toString()+" cm"),$("/"+G.id+" Do"),$("Q"),this},p.getFormObject=function(g){var N=Ct[Gn[g]];return{x:N.x,y:N.y,width:N.width,height:N.height,matrix:N.matrix}},p.save=function(g,N){return g=g||"generated.pdf",(N=N||{}).returnPromise=N.returnPromise||!1,N.returnPromise===!1?(Pa(Va(oi()),g),typeof Pa.unload=="function"&&ft.setTimeout&&setTimeout(Pa.unload,911),this):new Promise(function(G,Q){try{var le=Pa(Va(oi()),g);typeof Pa.unload=="function"&&ft.setTimeout&&setTimeout(Pa.unload,911),G(le)}catch(_e){Q(_e.message)}})},Xe.API)Xe.API.hasOwnProperty(ma)&&(ma==="events"&&Xe.API.events.length?(function(g,N){var G,Q,le;for(le=N.length-1;le!==-1;le--)G=N[le][0],Q=N[le][1],g.subscribe.apply(g,[G].concat(typeof Q=="function"?[Q]:Q))})(Ft,Xe.API.events):p[ma]=Xe.API[ma]);function Fs(g){return tt[g].mediaBox.topRightX-tt[g].mediaBox.bottomLeftX}function Uo(g,N){tt[g].mediaBox.topRightX=N+tt[g].mediaBox.bottomLeftX}function $o(g){return tt[g].mediaBox.topRightY-tt[g].mediaBox.bottomLeftY}function ki(g,N){tt[g].mediaBox.topRightY=N+tt[g].mediaBox.bottomLeftY}var Ni=p.getPageWidth=function(g){return Fs(g=g||z)/mt},qo=p.setPageWidth=function(g,N){Uo(g,N*mt)},va=p.getPageHeight=function(g){return $o(g=g||z)/mt},zo=p.setPageHeight=function(g,N){ki(g,N*mt)};return p.internal={pdfEscape:un,getStyle:Do,getFont:yc,getFontSize:Re,getCharSpace:Ec,getTextColor:Nc,getLineHeight:wc,getLineHeightFactor:Sc,getLineWidth:_c,write:Pe,getHorizontalCoordinate:wi,getVerticalCoordinate:xi,getCoordinateString:Ac,getVerticalCoordinateString:kc,collections:{},newObject:It,newAdditionalObject:ii,newObjectDeferred:Yt,newObjectDeferredBegin:xn,getFilters:hr,putStream:tr,events:Ft,scaleFactor:mt,pageSize:{getWidth:function(){return Ni(z)},setWidth:function(g){qo(z,g)},getHeight:function(){return va(z)},setHeight:function(g){zo(z,g)}},encryptionOptions:h,encryption:Pn,getEncryptor:function(g){return h!==null?Pn.encryptor(g,0):function(N){return N}},output:Ro,getNumberOfPages:ha,get pages(){return be},out:$,f2:A,f3:k,getPageInfo:_i,getPageInfoByObjId:Fo,getCurrentPageInfo:pc,getPDFVersion:w,Point:Ai,Rectangle:Os,Matrix:rt,hasHotfix:Fr},Object.defineProperty(p.internal.pageSize,"width",{get:function(){return Ni(z)},set:function(g){qo(z,g)},enumerable:!0,configurable:!0}),Object.defineProperty(p.internal.pageSize,"height",{get:function(){return va(z)},set:function(g){zo(z,g)},enumerable:!0,configurable:!0}),(function(g){for(var N=0,G=He.length;N<G;N++){var Q=Tn.call(this,g[N][0],g[N][1],g[N][2],He[N][3],!0);m===!1&&(b[Q]=!0);var le=g[N][0].split("-");en({id:Q,fontName:le[0],fontStyle:le[1]||""})}Ft.publish("addFonts",{fonts:bt,dictionary:ct})}).call(p,He),qe="F1",$i(a,n),Ft.publish("initialized"),p}ps.prototype.lsbFirstWord=function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)},ps.prototype.toHexString=function(t){return t.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},ps.prototype.hexToBytes=function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(String.fromCharCode(parseInt(t.substr(n,2),16)));return e.join("")},ps.prototype.processOwnerPassword=function(t,e){return sd(ad(e).substr(0,5),t)},ps.prototype.encryptor=function(t,e){var n=ad(this.encryptionKey+String.fromCharCode(255&t,t>>8&255,t>>16&255,255&e,e>>8&255)).substr(0,10);return function(r){return sd(n,r)}},Zl.prototype.equals=function(t){var e,n="id,objectNumber,equals";if(!t||Ht(t)!==Ht(this))return!1;var r=0;for(e in this)if(!(n.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!t.hasOwnProperty(e)||this[e]!==t[e])return!1;r++}for(e in t)t.hasOwnProperty(e)&&n.indexOf(e)<0&&r--;return r===0},Xe.API={events:[]},Xe.version="4.2.0";var fn=Xe.API,Cd=1,Wa=function(t){return t.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},cs=function(t){return t.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},za=function(t){return t.toString().replace(/#/g,"#23").replace(/[\s\n\r()<>[\]{}\/%]/g,function(e){var n=e.charCodeAt(0).toString(16).toUpperCase();return"#"+(n.length===1?"0"+n:n)})},yt=function(t){return t.toFixed(2)},ia=function(t){return t.toFixed(5)};fn.__acroform__={};var gr=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},up=function(t){return t*Cd},pi=function(t){var e=new am,n=Me.internal.getHeight(t)||0,r=Me.internal.getWidth(t)||0;return e.BBox=[0,0,Number(yt(r)),Number(yt(n))],e},Sy=fn.__acroform__.setBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return t|1<<e},Ay=fn.__acroform__.clearBit=function(t,e){if(t=t||0,e=e||0,isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return t&~(1<<e)},ky=fn.__acroform__.getBit=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return t&1<<e?1:0},yn=fn.__acroform__.getBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return ky(t,e-1)},_n=fn.__acroform__.setBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Sy(t,e-1)},wn=fn.__acroform__.clearBitForPdf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Ay(t,e-1)},Ny=fn.__acroform__.calculateCoordinates=function(t,e){var n=e.internal.getHorizontalCoordinate,r=e.internal.getVerticalCoordinate,a=t[0],i=t[1],o=t[2],l=t[3],c={};return c.lowerLeft_X=n(a)||0,c.lowerLeft_Y=r(i+l)||0,c.upperRight_X=n(a+o)||0,c.upperRight_Y=r(i)||0,[Number(yt(c.lowerLeft_X)),Number(yt(c.lowerLeft_Y)),Number(yt(c.upperRight_X)),Number(yt(c.upperRight_Y))]},Ey=function(t){if(t.appearanceStreamContent)return t.appearanceStreamContent;if(t.V||t.DV){var e=[],n=t._V||t.DV,r=od(t,n),a=t.scope.internal.getFont(t.fontName,t.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(t.scope.__private__.encodeColorString(t.color)),e.push("/"+a+" "+yt(r.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(r.text),e.push("ET"),e.push("Q"),e.push("EMC");var i=pi(t);return i.scope=t.scope,i.stream=e.join(`
`),i}},od=function(t,e){var n=t.fontSize===0?t.maxFontSize:t.fontSize,r={text:"",fontSize:""},a=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");a=t.multiline?a.map(function(A){return A.split(`
`)}):a.map(function(A){return[A]});var i=n,o=Me.internal.getHeight(t)||0;o=o<0?-o:o;var l=Me.internal.getWidth(t)||0;l=l<0?-l:l;var c=function(A,k,M){if(A+1<a.length){var j=k+" "+a[A+1][0];return El(j,t,M).width<=l-4}return!1};i++;e:for(;i>0;){e="",i--;var d,h,m=El("3",t,i).height,b=t.multiline?o-i:(o-m)/2,p=b+=2,_=0,w=0,S=0;if(i<=0){e=`(...) Tj
`,e+="% Width of Text: "+El(e,t,i=12).width+", FieldWidth:"+l+`
`;break}for(var x="",T=0,O=0;O<a.length;O++)if(a.hasOwnProperty(O)){var L=!1;if(a[O].length!==1&&S!==a[O].length-1){if((m+2)*(T+2)+2>o)continue e;x+=a[O][S],L=!0,w=O,O--}else{x=(x+=a[O][S]+" ").substr(x.length-1)==" "?x.substr(0,x.length-1):x;var K=parseInt(O),te=c(K,x,i),V=O>=a.length-1;if(te&&!V){x+=" ",S=0;continue}if(te||V){if(V)w=K;else if(t.multiline&&(m+2)*(T+2)+2>o)continue e}else{if(!t.multiline||(m+2)*(T+2)+2>o)continue e;w=K}}for(var q="",F=_;F<=w;F++){var C=a[F];if(t.multiline){if(F===w){q+=C[S]+" ",S=(S+1)%C.length;continue}if(F===_){q+=C[C.length-1]+" ";continue}}q+=C[0]+" "}switch(q=q.substr(q.length-1)==" "?q.substr(0,q.length-1):q,h=El(q,t,i).width,t.textAlign){case"right":d=l-h-2;break;case"center":d=(l-h)/2;break;default:d=2}e+=yt(d)+" "+yt(p)+` Td
`,e+="("+Wa(q)+`) Tj
`,e+=-yt(d)+` 0 Td
`,p=-(i+2),h=0,_=L?w:w+1,T++,x=""}break}return r.text=e,r.fontSize=i,r},El=function(t,e,n){var r=e.scope.internal.getFont(e.fontName,e.fontStyle),a=e.scope.getStringUnitWidth(t,{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n);return{height:e.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n)*1.5,width:a}},Ly={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Cy=function(t,e){var n={type:"reference",object:t};e.internal.getPageInfo(t.page).pageContext.annotations.find(function(r){return r.type===n.type&&r.object===n.object})===void 0&&e.internal.getPageInfo(t.page).pageContext.annotations.push(n)},Ty=function(t,e){if(e.scope=t,t.internal!==void 0&&(t.internal.acroformPlugin===void 0||t.internal.acroformPlugin.isInitialized===!1)){if(ni.FieldNum=0,t.internal.acroformPlugin=JSON.parse(JSON.stringify(Ly)),t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Cd=t.internal.scaleFactor,t.internal.acroformPlugin.acroFormDictionaryRoot=new sm,t.internal.acroformPlugin.acroFormDictionaryRoot.scope=t,t.internal.acroformPlugin.acroFormDictionaryRoot._eventID=t.internal.events.subscribe("postPutResources",function(){(function(n){n.internal.events.unsubscribe(n.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete n.internal.acroformPlugin.acroFormDictionaryRoot._eventID,n.internal.acroformPlugin.printedOut=!0})(t)}),t.internal.events.subscribe("buildDocument",function(){(function(n){n.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var r=n.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var a in r)if(r.hasOwnProperty(a)){var i=r[a];i.objId=void 0,i.hasAnnotation&&Cy(i,n)}})(t)}),t.internal.events.subscribe("putCatalog",function(){(function(n){if(n.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");n.internal.write("/AcroForm "+n.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(t)}),t.internal.events.subscribe("postPutPages",function(n){(function(r,a){var i=!r;for(var o in r||(a.internal.newObjectDeferredBegin(a.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),a.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),r=r||a.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(r.hasOwnProperty(o)){var l=r[o],c=[],d=l.Rect;if(l.Rect&&(l.Rect=Ny(l.Rect,a)),a.internal.newObjectDeferredBegin(l.objId,!0),l.DA=Me.createDefaultAppearanceStream(l),Ht(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(c=l.getKeyValueListForStream()),l.Rect=d,l.hasAppearanceStream&&!l.appearanceStreamContent){var h=Ey(l);c.push({key:"AP",value:"<</N "+h+">>"}),a.internal.acroformPlugin.xForms.push(h)}if(l.appearanceStreamContent){var m="";for(var b in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(b)){var p=l.appearanceStreamContent[b];if(m+="/"+b+" ",m+="<<",Object.keys(p).length>=1||Array.isArray(p)){for(var o in p)if(p.hasOwnProperty(o)){var _=p[o];typeof _=="function"&&(_=_.call(a,l)),m+="/"+o+" "+_+" ",a.internal.acroformPlugin.xForms.indexOf(_)>=0||a.internal.acroformPlugin.xForms.push(_)}}else typeof(_=p)=="function"&&(_=_.call(a,l)),m+="/"+o+" "+_,a.internal.acroformPlugin.xForms.indexOf(_)>=0||a.internal.acroformPlugin.xForms.push(_);m+=">>"}c.push({key:"AP",value:`<<
`+m+">>"})}a.internal.putStream({additionalKeyValues:c,objectId:l.objId}),a.internal.out("endobj")}i&&(function(w,S){for(var x in w)if(w.hasOwnProperty(x)){var T=x,O=w[x];S.internal.newObjectDeferredBegin(O.objId,!0),Ht(O)==="object"&&typeof O.putStream=="function"&&O.putStream(),delete w[T]}})(a.internal.acroformPlugin.xForms,a)})(n,t)}),t.internal.acroformPlugin.isInitialized=!0}},im=fn.__acroform__.arrayToPdfArray=function(t,e,n){var r=function(o){return o};if(Array.isArray(t)){for(var a="[",i=0;i<t.length;i++)switch(i!==0&&(a+=" "),Ht(t[i])){case"boolean":case"number":case"object":a+=t[i].toString();break;case"string":t[i].substr(0,1)==="/"?a+="/"+za(t[i].substr(1)):(e!==void 0&&n&&(r=n.internal.getEncryptor(e)),a+="("+Wa(r(t[i].toString()))+")")}return a+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Su=function(t,e,n){var r=function(a){return a};return e!==void 0&&n&&(r=n.internal.getEncryptor(e)),(t=t||"").toString(),"("+Wa(r(t))+")"},vi=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(t){this._objId=t}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};vi.prototype.toString=function(){return this.objId+" 0 R"},vi.prototype.putStream=function(){var t=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:t,objectId:this.objId}),this.scope.internal.out("endobj")},vi.prototype.getKeyValueListForStream=function(){var t=[],e=Object.getOwnPropertyNames(this).filter(function(i){return i!="content"&&i!="appearanceStreamContent"&&i!="scope"&&i!="objId"&&i.substring(0,1)!="_"});for(var n in e)if(Object.getOwnPropertyDescriptor(this,e[n]).configurable===!1){var r=e[n],a=this[r];a&&(Array.isArray(a)?t.push({key:r,value:im(a,this.objId,this.scope)}):a instanceof vi?(a.scope=this.scope,t.push({key:r,value:a.objId+" 0 R"})):typeof a!="function"&&t.push({key:r,value:a}))}return t};var am=function(){vi.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var t,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(n){e=n}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(n){t=n.trim()},get:function(){return t||null}})};gr(am,vi);var sm=function(){vi.call(this);var t,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(t){var n=function(r){return r};return this.scope&&(n=this.scope.internal.getEncryptor(this.objId)),"("+Wa(n(t))+")"}},set:function(n){t=n}})};gr(sm,vi);var ni=function t(){vi.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(x){if(isNaN(x))throw new Error('Invalid value "'+x+'" for attribute F supplied.');e=x}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!yn(e,3)},set:function(x){x?this.F=_n(e,3):this.F=wn(e,3)}});var n=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return n},set:function(x){if(isNaN(x))throw new Error('Invalid value "'+x+'" for attribute Ff supplied.');n=x}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(r.length!==0)return r},set:function(x){r=x!==void 0?x:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(x){r[0]=x}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(x){r[1]=x}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(x){r[2]=x}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(x){r[3]=x}});var a="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return a},set:function(x){switch(x){case"/Btn":case"/Tx":case"/Ch":case"/Sig":a=x;break;default:throw new Error('Invalid value "'+x+'" for attribute FT supplied.')}}});var i=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!i||i.length<1){if(this instanceof Ql)return;i="FieldObject"+t.FieldNum++}var x=function(T){return T};return this.scope&&(x=this.scope.internal.getEncryptor(this.objId)),"("+Wa(x(i))+")"},set:function(x){i=x.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return i},set:function(x){i=x}});var o="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return o},set:function(x){o=x}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(x){l=x}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(x){c=x}});var d=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return d===void 0?50/Cd:d},set:function(x){d=x}});var h="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return h},set:function(x){h=x}});var m="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!m||this instanceof Ql||this instanceof Ma))return Su(m,this.objId,this.scope)},set:function(x){x=x.toString(),m=x}});var b=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(b)return this instanceof Bn==0?Su(b,this.objId,this.scope):b},set:function(x){x=x.toString(),b=this instanceof Bn==0?x.substr(0,1)==="("?cs(x.substr(1,x.length-2)):cs(x):x}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Bn==1?cs(b.substr(1,b.length-1)):b},set:function(x){x=x.toString(),b=this instanceof Bn==1?"/"+za(x):x}});var p=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(p)return p},set:function(x){this.V=x}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(p)return this instanceof Bn==0?Su(p,this.objId,this.scope):p},set:function(x){x=x.toString(),p=this instanceof Bn==0?x.substr(0,1)==="("?cs(x.substr(1,x.length-2)):cs(x):x}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Bn==1?cs(p.substr(1,p.length-1)):p},set:function(x){x=x.toString(),p=this instanceof Bn==1?"/"+za(x):x}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var _,w=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return w},set:function(x){x=!!x,w=x}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(_)return _},set:function(x){_=x}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,1)},set:function(x){x?this.Ff=_n(this.Ff,1):this.Ff=wn(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,2)},set:function(x){x?this.Ff=_n(this.Ff,2):this.Ff=wn(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,3)},set:function(x){x?this.Ff=_n(this.Ff,3):this.Ff=wn(this.Ff,3)}});var S=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(S!==null)return S},set:function(x){if([0,1,2].indexOf(x)===-1)throw new Error('Invalid value "'+x+'" for attribute Q supplied.');S=x}}),Object.defineProperty(this,"textAlign",{get:function(){var x;switch(S){case 0:default:x="left";break;case 1:x="center";break;case 2:x="right"}return x},configurable:!0,enumerable:!0,set:function(x){switch(x){case"right":case 2:S=2;break;case"center":case 1:S=1;break;default:S=0}}})};gr(ni,vi);var ys=function(){ni.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var t=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return t},set:function(n){t=n}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return t},set:function(n){t=n}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return im(e,this.objId,this.scope)},set:function(n){var r,a;a=[],typeof(r=n)=="string"&&(a=(function(i,o,l){l||(l=1);for(var c,d=[];c=o.exec(i);)d.push(c[l]);return d})(r,/\((.*?)\)/g)),e=a}}),this.getOptions=function(){return e},this.setOptions=function(n){e=n,this.sort&&e.sort()},this.addOption=function(n){n=(n=n||"").toString(),e.push(n),this.sort&&e.sort()},this.removeOption=function(n,r){for(r=r||!1,n=(n=n||"").toString();e.indexOf(n)!==-1&&(e.splice(e.indexOf(n),1),r!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,18)},set:function(n){n?this.Ff=_n(this.Ff,18):this.Ff=wn(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,19)},set:function(n){this.combo===!0&&(n?this.Ff=_n(this.Ff,19):this.Ff=wn(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,20)},set:function(n){n?(this.Ff=_n(this.Ff,20),e.sort()):this.Ff=wn(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,22)},set:function(n){n?this.Ff=_n(this.Ff,22):this.Ff=wn(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,23)},set:function(n){n?this.Ff=_n(this.Ff,23):this.Ff=wn(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,27)},set:function(n){n?this.Ff=_n(this.Ff,27):this.Ff=wn(this.Ff,27)}}),this.hasAppearanceStream=!1};gr(ys,ni);var _s=function(){ys.call(this),this.fontName="helvetica",this.combo=!1};gr(_s,ys);var ws=function(){_s.call(this),this.combo=!0};gr(ws,_s);var Dl=function(){ws.call(this),this.edit=!0};gr(Dl,ws);var Bn=function(){ni.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,15)},set:function(n){n?this.Ff=_n(this.Ff,15):this.Ff=wn(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,16)},set:function(n){n?this.Ff=_n(this.Ff,16):this.Ff=wn(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,17)},set:function(n){n?this.Ff=_n(this.Ff,17):this.Ff=wn(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,26)},set:function(n){n?this.Ff=_n(this.Ff,26):this.Ff=wn(this.Ff,26)}});var t,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var n=function(i){return i};if(this.scope&&(n=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var r,a=[];for(r in a.push("<<"),e)a.push("/"+r+" ("+Wa(n(e[r]))+")");return a.push(">>"),a.join(`
`)}},set:function(n){Ht(n)==="object"&&(e=n)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(n){typeof n=="string"&&(e.CA=n)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(n){var r=n==null?"":n.toString();r.substr(0,1)==="/"&&(r=r.substr(1)),t="/"+za(r)}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(n){t="/"+za(n)}})};gr(Bn,ni);var jl=function(){Bn.call(this),this.pushButton=!0};gr(jl,Bn);var xs=function(){Bn.call(this),this.radio=!0,this.pushButton=!1;var t=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e!==void 0?e:[]}})};gr(xs,Bn);var Ql=function(){var t,e;ni.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return t},set:function(a){t=a}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(a){e=a}});var n,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var a=function(l){return l};this.scope&&(a=this.scope.internal.getEncryptor(this.objId));var i,o=[];for(i in o.push("<<"),r)o.push("/"+i+" ("+Wa(a(r[i]))+")");return o.push(">>"),o.join(`
`)},set:function(a){Ht(a)==="object"&&(r=a)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(a){typeof a=="string"&&(r.CA=a)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(a){var i=a==null?"":a.toString();i.substr(0,1)==="/"&&(i=i.substr(1)),n="/"+za(i)}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(a){var i=a==null?"":a.toString();i.substr(0,1)==="/"&&(i=i.substr(1)),n="/"+za(i)}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Me.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};gr(Ql,ni),xs.prototype.setAppearance=function(t){if(!("createAppearanceStream"in t)||!("getCA"in t))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var n=this.Kids[e];n.appearanceStreamContent=t.createAppearanceStream(n.optionName),n.caption=t.getCA()}},xs.prototype.createOption=function(t){var e=new Ql;return e.Parent=this,e.optionName=t,this.Kids.push(e),Py.call(this.scope,e),e};var Bl=function(){Bn.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Me.CheckBox.createAppearanceStream()};gr(Bl,Bn);var Ma=function(){ni.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,13)},set:function(e){e?this.Ff=_n(this.Ff,13):this.Ff=wn(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,21)},set:function(e){e?this.Ff=_n(this.Ff,21):this.Ff=wn(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,23)},set:function(e){e?this.Ff=_n(this.Ff,23):this.Ff=wn(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,24)},set:function(e){e?this.Ff=_n(this.Ff,24):this.Ff=wn(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,25)},set:function(e){e?this.Ff=_n(this.Ff,25):this.Ff=wn(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,26)},set:function(e){e?this.Ff=_n(this.Ff,26):this.Ff=wn(this.Ff,26)}});var t=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){Number.isInteger(e)&&(t=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};gr(Ma,ni);var Ml=function(){Ma.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!yn(this.Ff,14)},set:function(t){t?this.Ff=_n(this.Ff,14):this.Ff=wn(this.Ff,14)}}),this.password=!0};gr(Ml,Ma);var Me={CheckBox:{createAppearanceStream:function(){return{N:{On:Me.CheckBox.YesNormal},D:{On:Me.CheckBox.YesPushDown,Off:Me.CheckBox.OffPushDown}}},YesPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=t.scope.internal.getFont(t.fontName,t.fontStyle).id,a=t.scope.__private__.encodeColorString(t.color),i=od(t,t.caption);return n.push("0.749023 g"),n.push("0 0 "+yt(Me.internal.getWidth(t))+" "+yt(Me.internal.getHeight(t))+" re"),n.push("f"),n.push("BMC"),n.push("q"),n.push("0 0 1 rg"),n.push("/"+r+" "+yt(i.fontSize)+" Tf "+a),n.push("BT"),n.push(i.text),n.push("ET"),n.push("Q"),n.push("EMC"),e.stream=n.join(`
`),e},YesNormal:function(t){var e=pi(t);e.scope=t.scope;var n=t.scope.internal.getFont(t.fontName,t.fontStyle).id,r=t.scope.__private__.encodeColorString(t.color),a=[],i=Me.internal.getHeight(t),o=Me.internal.getWidth(t),l=od(t,t.caption);return a.push("1 g"),a.push("0 0 "+yt(o)+" "+yt(i)+" re"),a.push("f"),a.push("q"),a.push("0 0 1 rg"),a.push("0 0 "+yt(o-1)+" "+yt(i-1)+" re"),a.push("W"),a.push("n"),a.push("0 g"),a.push("BT"),a.push("/"+n+" "+yt(l.fontSize)+" Tf "+r),a.push(l.text),a.push("ET"),a.push("Q"),e.stream=a.join(`
`),e},OffPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+yt(Me.internal.getWidth(t))+" "+yt(Me.internal.getHeight(t))+" re"),n.push("f"),e.stream=n.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(t){var e={D:{Off:Me.RadioButton.Circle.OffPushDown},N:{}};return e.N[t]=Me.RadioButton.Circle.YesNormal,e.D[t]=Me.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=Me.internal.getWidth(t)<=Me.internal.getHeight(t)?Me.internal.getWidth(t)/4:Me.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var a=Me.internal.Bezier_C,i=Number((r*a).toFixed(5));return n.push("q"),n.push("1 0 0 1 "+ia(Me.internal.getWidth(t)/2)+" "+ia(Me.internal.getHeight(t)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+i+" "+i+" "+r+" 0 "+r+" c"),n.push("-"+i+" "+r+" -"+r+" "+i+" -"+r+" 0 c"),n.push("-"+r+" -"+i+" -"+i+" -"+r+" 0 -"+r+" c"),n.push(i+" -"+r+" "+r+" -"+i+" "+r+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join(`
`),e},YesPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=Me.internal.getWidth(t)<=Me.internal.getHeight(t)?Me.internal.getWidth(t)/4:Me.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var a=Number((2*r).toFixed(5)),i=Number((a*Me.internal.Bezier_C).toFixed(5)),o=Number((r*Me.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+ia(Me.internal.getWidth(t)/2)+" "+ia(Me.internal.getHeight(t)/2)+" cm"),n.push(a+" 0 m"),n.push(a+" "+i+" "+i+" "+a+" 0 "+a+" c"),n.push("-"+i+" "+a+" -"+a+" "+i+" -"+a+" 0 c"),n.push("-"+a+" -"+i+" -"+i+" -"+a+" 0 -"+a+" c"),n.push(i+" -"+a+" "+a+" -"+i+" "+a+" 0 c"),n.push("f"),n.push("Q"),n.push("0 g"),n.push("q"),n.push("1 0 0 1 "+ia(Me.internal.getWidth(t)/2)+" "+ia(Me.internal.getHeight(t)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+o+" "+o+" "+r+" 0 "+r+" c"),n.push("-"+o+" "+r+" -"+r+" "+o+" -"+r+" 0 c"),n.push("-"+r+" -"+o+" -"+o+" -"+r+" 0 -"+r+" c"),n.push(o+" -"+r+" "+r+" -"+o+" "+r+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=Me.internal.getWidth(t)<=Me.internal.getHeight(t)?Me.internal.getWidth(t)/4:Me.internal.getHeight(t)/4;r=Number((.9*r).toFixed(5));var a=Number((2*r).toFixed(5)),i=Number((a*Me.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+ia(Me.internal.getWidth(t)/2)+" "+ia(Me.internal.getHeight(t)/2)+" cm"),n.push(a+" 0 m"),n.push(a+" "+i+" "+i+" "+a+" 0 "+a+" c"),n.push("-"+i+" "+a+" -"+a+" "+i+" -"+a+" 0 c"),n.push("-"+a+" -"+i+" -"+i+" -"+a+" 0 -"+a+" c"),n.push(i+" -"+a+" "+a+" -"+i+" "+a+" 0 c"),n.push("f"),n.push("Q"),e.stream=n.join(`
`),e}},Cross:{createAppearanceStream:function(t){var e={D:{Off:Me.RadioButton.Cross.OffPushDown},N:{}};return e.N[t]=Me.RadioButton.Cross.YesNormal,e.D[t]=Me.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(t){var e=pi(t);e.scope=t.scope;var n=[],r=Me.internal.calculateCross(t);return n.push("q"),n.push("1 1 "+yt(Me.internal.getWidth(t)-2)+" "+yt(Me.internal.getHeight(t)-2)+" re"),n.push("W"),n.push("n"),n.push(yt(r.x1.x)+" "+yt(r.x1.y)+" m"),n.push(yt(r.x2.x)+" "+yt(r.x2.y)+" l"),n.push(yt(r.x4.x)+" "+yt(r.x4.y)+" m"),n.push(yt(r.x3.x)+" "+yt(r.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join(`
`),e},YesPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=Me.internal.calculateCross(t),r=[];return r.push("0.749023 g"),r.push("0 0 "+yt(Me.internal.getWidth(t))+" "+yt(Me.internal.getHeight(t))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+yt(Me.internal.getWidth(t)-2)+" "+yt(Me.internal.getHeight(t)-2)+" re"),r.push("W"),r.push("n"),r.push(yt(n.x1.x)+" "+yt(n.x1.y)+" m"),r.push(yt(n.x2.x)+" "+yt(n.x2.y)+" l"),r.push(yt(n.x4.x)+" "+yt(n.x4.y)+" m"),r.push(yt(n.x3.x)+" "+yt(n.x3.y)+" l"),r.push("s"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(t){var e=pi(t);e.scope=t.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+yt(Me.internal.getWidth(t))+" "+yt(Me.internal.getHeight(t))+" re"),n.push("f"),e.stream=n.join(`
`),e}}},createDefaultAppearanceStream:function(t){var e=t.scope.internal.getFont(t.fontName,t.fontStyle).id,n=t.scope.__private__.encodeColorString(t.color);return"/"+e+" "+t.fontSize+" Tf "+n}};Me.internal={Bezier_C:.551915024494,calculateCross:function(t){var e=Me.internal.getWidth(t),n=Me.internal.getHeight(t),r=Math.min(e,n);return{x1:{x:(e-r)/2,y:(n-r)/2+r},x2:{x:(e-r)/2+r,y:(n-r)/2},x3:{x:(e-r)/2,y:(n-r)/2},x4:{x:(e-r)/2+r,y:(n-r)/2+r}}}},Me.internal.getWidth=function(t){var e=0;return Ht(t)==="object"&&(e=up(t.Rect[2])),e},Me.internal.getHeight=function(t){var e=0;return Ht(t)==="object"&&(e=up(t.Rect[3])),e};var Py=fn.addField=function(t){if(Ty(this,t),!(t instanceof ni))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=t).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),t.page=t.scope.internal.getCurrentPageInfo().pageNumber,this};fn.AcroFormChoiceField=ys,fn.AcroFormListBox=_s,fn.AcroFormComboBox=ws,fn.AcroFormEditBox=Dl,fn.AcroFormButton=Bn,fn.AcroFormPushButton=jl,fn.AcroFormRadioButton=xs,fn.AcroFormCheckBox=Bl,fn.AcroFormTextField=Ma,fn.AcroFormPasswordField=Ml,fn.AcroFormAppearance=Me,fn.AcroForm={ChoiceField:ys,ListBox:_s,ComboBox:ws,EditBox:Dl,Button:Bn,PushButton:jl,RadioButton:xs,CheckBox:Bl,TextField:Ma,PasswordField:Ml,Appearance:Me},Xe.AcroForm={ChoiceField:ys,ListBox:_s,ComboBox:ws,EditBox:Dl,Button:Bn,PushButton:jl,RadioButton:xs,CheckBox:Bl,TextField:Ma,PasswordField:Ml,Appearance:Me};Xe.AcroForm;function om(t){return t.reduce(function(e,n,r){return e[n]=r,e},{})}(function(t){var e="addImage_";t.__addimage__={};var n="UNKNOWN",r={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},a=t.__addimage__.getImageFileTypeByImageData=function(A,k){var M,j,U,re,ce,se=n;if((k=k||n)==="RGBA"||A.data!==void 0&&A.data instanceof Uint8ClampedArray&&"height"in A&&"width"in A)return"RGBA";if(te(A))for(ce in r)for(U=r[ce],M=0;M<U.length;M+=1){for(re=!0,j=0;j<U[M].length;j+=1)if(U[M][j]!==void 0&&U[M][j]!==A[j]){re=!1;break}if(re===!0){se=ce;break}}else for(ce in r)for(U=r[ce],M=0;M<U.length;M+=1){for(re=!0,j=0;j<U[M].length;j+=1)if(U[M][j]!==void 0&&U[M][j]!==A.charCodeAt(j)){re=!1;break}if(re===!0){se=ce;break}}return se===n&&k!==n&&(se=k),se},i=function A(k){for(var M=this.internal.write,j=this.internal.putStream,U=(0,this.internal.getFilters)();U.indexOf("FlateEncode")!==-1;)U.splice(U.indexOf("FlateEncode"),1);k.objectId=this.internal.newObject();var re=[];if(re.push({key:"Type",value:"/XObject"}),re.push({key:"Subtype",value:"/Image"}),re.push({key:"Width",value:k.width}),re.push({key:"Height",value:k.height}),k.colorSpace===x.INDEXED?re.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(k.palette.length/3-1)+" "+("sMask"in k&&k.sMask!==void 0?k.objectId+2:k.objectId+1)+" 0 R]"}):(re.push({key:"ColorSpace",value:"/"+k.colorSpace}),k.colorSpace===x.DEVICE_CMYK&&re.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),re.push({key:"BitsPerComponent",value:k.bitsPerComponent}),"decodeParameters"in k&&k.decodeParameters!==void 0&&re.push({key:"DecodeParms",value:"<<"+k.decodeParameters+">>"}),"transparency"in k&&Array.isArray(k.transparency)&&k.transparency.length>0){for(var ce="",se=0,fe=k.transparency.length;se<fe;se++)ce+=k.transparency[se]+" "+k.transparency[se]+" ";re.push({key:"Mask",value:"["+ce+"]"})}k.sMask!==void 0&&re.push({key:"SMask",value:k.objectId+1+" 0 R"});var xe=k.filter!==void 0?["/"+k.filter]:void 0;if(j({data:k.data,additionalKeyValues:re,alreadyAppliedFilters:xe,objectId:k.objectId}),M("endobj"),"sMask"in k&&k.sMask!==void 0){var ge,I=(ge=k.sMaskBitsPerComponent)!==null&&ge!==void 0?ge:k.bitsPerComponent,z={width:k.width,height:k.height,colorSpace:"DeviceGray",bitsPerComponent:I,data:k.sMask};"filter"in k&&(z.decodeParameters="/Predictor ".concat(k.predictor," /Colors 1 /BitsPerComponent ").concat(I," /Columns ").concat(k.width),z.filter=k.filter),A.call(this,z)}if(k.colorSpace===x.INDEXED){var J=this.internal.newObject();j({data:q(new Uint8Array(k.palette)),objectId:J}),M("endobj")}},o=function(){var A=this.internal.collections[e+"images"];for(var k in A)i.call(this,A[k])},l=function(){var A,k=this.internal.collections[e+"images"],M=this.internal.write;for(var j in k)M("/I"+(A=k[j]).index,A.objectId,"0","R")},c=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",l))},d=function(){var A=this.internal.collections[e+"images"];return c.call(this),A},h=function(){return Object.keys(this.internal.collections[e+"images"]).length},m=function(A){return typeof t["process"+A.toUpperCase()]=="function"},b=function(A){return Ht(A)==="object"&&A.nodeType===1},p=function(A,k){if(A.nodeName==="IMG"&&A.hasAttribute("src")){var M=""+A.getAttribute("src");if(M.indexOf("data:image/")===0)return Fl(unescape(M).split("base64,").pop());var j=t.loadFile(M,!0);if(j!==void 0)return j}if(A.nodeName==="CANVAS"){if(A.width===0||A.height===0)throw new Error("Given canvas must have data. Canvas width: "+A.width+", height: "+A.height);var U;switch(k){case"PNG":U="image/png";break;case"WEBP":U="image/webp";break;default:U="image/jpeg"}return Fl(A.toDataURL(U,1).split("base64,").pop())}},_=function(A){var k=this.internal.collections[e+"images"];if(k){for(var M in k)if(A===k[M].alias)return k[M]}},w=function(A,k,M){return A||k||(A=-96,k=-96),A<0&&(A=-1*M.width*72/A/this.internal.scaleFactor),k<0&&(k=-1*M.height*72/k/this.internal.scaleFactor),A===0&&(A=k*M.width/M.height),k===0&&(k=A*M.height/M.width),[A,k]},S=function(A,k,M,j,U,re){var ce=w.call(this,M,j,U),se=this.internal.getCoordinateString,fe=this.internal.getVerticalCoordinateString,xe=d.call(this);if(M=ce[0],j=ce[1],xe[U.index]=U,re){re*=Math.PI/180;var ge=Math.cos(re),I=Math.sin(re),z=function(X){return X.toFixed(4)},J=[z(ge),z(I),z(-1*I),z(ge),0,0,"cm"]}this.internal.write("q"),re?(this.internal.write([1,"0","0",1,se(A),fe(k+j),"cm"].join(" ")),this.internal.write(J.join(" ")),this.internal.write([se(M),"0","0",se(j),"0","0","cm"].join(" "))):this.internal.write([se(M),"0","0",se(j),se(A),fe(k+j),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+U.index+" Do"),this.internal.write("Q")},x=t.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};t.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var T=t.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},O=t.__addimage__.sHashCode=function(A){var k,M,j=0;if(typeof A=="string")for(M=A.length,k=0;k<M;k++)j=(j<<5)-j+A.charCodeAt(k),j|=0;else if(te(A))for(M=A.byteLength/2,k=0;k<M;k++)j=(j<<5)-j+A[k],j|=0;return j},L=t.__addimage__.validateStringAsBase64=function(A){(A=A||"").toString().trim();var k=!0;return A.length===0&&(k=!1),A.length%4!=0&&(k=!1),/^[A-Za-z0-9+/]+$/.test(A.substr(0,A.length-2))===!1&&(k=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(A.substr(-2))===!1&&(k=!1),k},K=t.__addimage__.extractImageFromDataUrl=function(A){if(A==null||!(A=A.trim()).startsWith("data:"))return null;var k=A.indexOf(",");return k<0?null:A.substring(0,k).trim().endsWith("base64")?A.substring(k+1):null};t.__addimage__.isArrayBuffer=function(A){return A instanceof ArrayBuffer};var te=t.__addimage__.isArrayBufferView=function(A){return A instanceof Int8Array||A instanceof Uint8Array||A instanceof Uint8ClampedArray||A instanceof Int16Array||A instanceof Uint16Array||A instanceof Int32Array||A instanceof Uint32Array||A instanceof Float32Array||A instanceof Float64Array},V=t.__addimage__.binaryStringToUint8Array=function(A){for(var k=A.length,M=new Uint8Array(k),j=0;j<k;j++)M[j]=A.charCodeAt(j);return M},q=t.__addimage__.arrayBufferToBinaryString=function(A){for(var k="",M=te(A)?A:new Uint8Array(A),j=0;j<M.length;j+=8192)k+=String.fromCharCode.apply(null,M.subarray(j,j+8192));return k};t.addImage=function(){var A,k,M,j,U,re,ce,se,fe;if(typeof arguments[1]=="number"?(k=n,M=arguments[1],j=arguments[2],U=arguments[3],re=arguments[4],ce=arguments[5],se=arguments[6],fe=arguments[7]):(k=arguments[1],M=arguments[2],j=arguments[3],U=arguments[4],re=arguments[5],ce=arguments[6],se=arguments[7],fe=arguments[8]),Ht(A=arguments[0])==="object"&&!b(A)&&"imageData"in A){var xe=A;A=xe.imageData,k=xe.format||k||n,M=xe.x||M||0,j=xe.y||j||0,U=xe.w||xe.width||U,re=xe.h||xe.height||re,ce=xe.alias||ce,se=xe.compression||se,fe=xe.rotation||xe.angle||fe}var ge=this.internal.getFilters();if(se===void 0&&ge.indexOf("FlateEncode")!==-1&&(se="SLOW"),isNaN(M)||isNaN(j))throw new Error("Invalid coordinates passed to jsPDF.addImage");c.call(this);var I=F.call(this,A,k,ce,se);return S.call(this,M,j,U,re,I,fe),this};var F=function(A,k,M,j){var U,re,ce;if(typeof A=="string"&&a(A)===n){A=unescape(A);var se=C(A,!1);(se!==""||(se=t.loadFile(A,!0))!==void 0)&&(A=se)}if(b(A)&&(A=p(A,k)),k=a(A,k),!m(k))throw new Error("addImage does not support files of type '"+k+"', please ensure that a plugin for '"+k+"' support is added.");if(((ce=M)==null||ce.length===0)&&(M=(function(fe){return typeof fe=="string"||te(fe)?O(fe):te(fe.data)?O(fe.data):null})(A)),(U=_.call(this,M))||(A instanceof Uint8Array||k==="RGBA"||(re=A,A=V(A)),U=this["process"+k.toUpperCase()](A,h.call(this),M,(function(fe){return fe&&typeof fe=="string"&&(fe=fe.toUpperCase()),fe in t.image_compression?fe:T.NONE})(j),re)),!U)throw new Error("An unknown error occurred whilst processing the image.");return U},C=t.__addimage__.convertBase64ToBinaryString=function(A,k){k=typeof k!="boolean"||k;var M,j="";if(typeof A=="string"){var U;M=(U=K(A))!==null&&U!==void 0?U:A;try{j=Fl(M)}catch(re){if(k)throw L(M)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+re.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return j};t.getImageProperties=function(A){var k,M,j="";if(b(A)&&(A=p(A)),typeof A=="string"&&a(A)===n&&((j=C(A,!1))===""&&(j=t.loadFile(A)||""),A=j),M=a(A),!m(M))throw new Error("addImage does not support files of type '"+M+"', please ensure that a plugin for '"+M+"' support is added.");if(A instanceof Uint8Array||(A=V(A)),!(k=this["process"+M.toUpperCase()](A)))throw new Error("An unknown error occurred whilst processing the image");return k.fileType=M,k}})(Xe.API),(function(t){var e=function(n){if(n!==void 0&&n!="")return!0};Xe.API.events.push(["addPage",function(n){this.internal.getPageInfo(n.pageNumber).pageContext.annotations=[]}]),t.events.push(["putPage",function(n){for(var r,a,i,o=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,c=this.internal.getPageInfoByObjId(n.objId),d=n.pageContext.annotations,h=!1,m=0;m<d.length&&!h;m++)switch((r=d[m]).type){case"link":(e(r.options.url)||e(r.options.pageNumber))&&(h=!0);break;case"reference":case"text":case"freetext":h=!0}if(h!=0){this.internal.write("/Annots [");for(var b=0;b<d.length;b++){r=d[b];var p=this.internal.pdfEscape,_=this.internal.getEncryptor(n.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var w=this.internal.newAdditionalObject(),S=this.internal.newAdditionalObject(),x=this.internal.getEncryptor(w.objId),T=r.title||"Note";i="<</Type /Annot /Subtype /Text "+(a="/Rect ["+o(r.bounds.x)+" "+l(r.bounds.y+r.bounds.h)+" "+o(r.bounds.x+r.bounds.w)+" "+l(r.bounds.y)+"] ")+"/Contents ("+p(x(r.contents))+")",i+=" /Popup "+S.objId+" 0 R",i+=" /P "+c.objId+" 0 R",i+=" /T ("+p(x(T))+") >>",w.content=i;var O=w.objId+" 0 R";i="<</Type /Annot /Subtype /Popup "+(a="/Rect ["+o(r.bounds.x+30)+" "+l(r.bounds.y+r.bounds.h)+" "+o(r.bounds.x+r.bounds.w+30)+" "+l(r.bounds.y)+"] ")+" /Parent "+O,r.open&&(i+=" /Open true"),i+=" >>",S.content=i,this.internal.write(w.objId,"0 R",S.objId,"0 R");break;case"freetext":a="/Rect ["+o(r.bounds.x)+" "+l(r.bounds.y)+" "+o(r.bounds.x+r.bounds.w)+" "+l(r.bounds.y+r.bounds.h)+"] ";var L=r.color||"#000000";i="<</Type /Annot /Subtype /FreeText "+a+"/Contents ("+p(_(r.contents))+")",i+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+L+")",i+=" /Border [0 0 0]",i+=" >>",this.internal.write(i);break;case"link":if(r.options.name){var K=this.annotations._nameMap[r.options.name];r.options.pageNumber=K.page,r.options.top=K.y}else r.options.top||(r.options.top=0);if(a="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",i="",r.options.url)i="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /A <</S /URI /URI ("+p(_(r.options.url))+") >>";else if(r.options.pageNumber)switch(i="<</Type /Annot /Subtype /Link "+a+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":i+=" /Fit]";break;case"FitH":i+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,i+=" /FitV "+r.options.left+"]";break;default:var te=l(r.options.top);r.options.left=r.options.left||0,r.options.zoom===void 0&&(r.options.zoom=0),i+=" /XYZ "+r.options.left+" "+te+" "+r.options.zoom+"]"}i!=""&&(i+=" >>",this.internal.write(i))}}this.internal.write("]")}}]),t.createAnnotation=function(n){var r=this.internal.getCurrentPageInfo();switch(n.type){case"link":this.link(n.bounds.x,n.bounds.y,n.bounds.w,n.bounds.h,n);break;case"text":case"freetext":r.pageContext.annotations.push(n)}},t.link=function(n,r,a,i,o){var l=this.internal.getCurrentPageInfo(),c=this.internal.getCoordinateString,d=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:c(n),y:d(r),w:c(n+a),h:d(r+i)},options:o,type:"link"})},t.textWithLink=function(n,r,a,i){var o,l,c=this.getTextWidth(n),d=this.internal.getLineHeight()/this.internal.scaleFactor;if(i.maxWidth!==void 0){l=i.maxWidth;var h=this.splitTextToSize(n,l).length;o=Math.ceil(d*h)}else l=c,o=d;return this.text(n,r,a,i),a+=.2*d,i.align==="center"&&(r-=c/2),i.align==="right"&&(r-=c),this.link(r,a-d,l,o,i),c},t.getTextWidth=function(n){var r=this.internal.getFontSize();return this.getStringUnitWidth(n)*r/this.internal.scaleFactor}})(Xe.API),(function(t){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},n={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},a=[1570,1571,1573,1575];t.__arabicParser__={};var i=t.__arabicParser__.isInArabicSubstitutionA=function(w){return e[w.charCodeAt(0)]!==void 0},o=t.__arabicParser__.isArabicLetter=function(w){return typeof w=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(w)},l=t.__arabicParser__.isArabicEndLetter=function(w){return o(w)&&i(w)&&e[w.charCodeAt(0)].length<=2},c=t.__arabicParser__.isArabicAlfLetter=function(w){return o(w)&&a.indexOf(w.charCodeAt(0))>=0};t.__arabicParser__.arabicLetterHasIsolatedForm=function(w){return o(w)&&i(w)&&e[w.charCodeAt(0)].length>=1};var d=t.__arabicParser__.arabicLetterHasFinalForm=function(w){return o(w)&&i(w)&&e[w.charCodeAt(0)].length>=2};t.__arabicParser__.arabicLetterHasInitialForm=function(w){return o(w)&&i(w)&&e[w.charCodeAt(0)].length>=3};var h=t.__arabicParser__.arabicLetterHasMedialForm=function(w){return o(w)&&i(w)&&e[w.charCodeAt(0)].length==4},m=t.__arabicParser__.resolveLigatures=function(w){var S=0,x=n,T="",O=0;for(S=0;S<w.length;S+=1)x[w.charCodeAt(S)]!==void 0?(O++,typeof(x=x[w.charCodeAt(S)])=="number"&&(T+=String.fromCharCode(x),x=n,O=0),S===w.length-1&&(x=n,T+=w.charAt(S-(O-1)),S-=O-1,O=0)):(x=n,T+=w.charAt(S-O),S-=O,O=0);return T};t.__arabicParser__.isArabicDiacritic=function(w){return w!==void 0&&r[w.charCodeAt(0)]!==void 0};var b=t.__arabicParser__.getCorrectForm=function(w,S,x){return o(w)?i(w)===!1?-1:!d(w)||!o(S)&&!o(x)||!o(x)&&l(S)||l(w)&&!o(S)||l(w)&&c(S)||l(w)&&l(S)?0:h(w)&&o(S)&&!l(S)&&o(x)&&d(x)?3:l(w)||!o(x)?1:2:-1},p=function(w){var S=0,x=0,T=0,O="",L="",K="",te=(w=w||"").split("\\s+"),V=[];for(S=0;S<te.length;S+=1){for(V.push(""),x=0;x<te[S].length;x+=1)O=te[S][x],L=te[S][x-1],K=te[S][x+1],o(O)?(T=b(O,L,K),V[S]+=T!==-1?String.fromCharCode(e[O.charCodeAt(0)][T]):O):V[S]+=O;V[S]=m(V[S])}return V.join(" ")},_=t.__arabicParser__.processArabic=t.processArabic=function(){var w,S=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,x=[];if(Array.isArray(S)){var T=0;for(x=[],T=0;T<S.length;T+=1)Array.isArray(S[T])?x.push([p(S[T][0]),S[T][1],S[T][2]]):x.push([p(S[T])]);w=x}else w=p(S);return typeof arguments[0]=="string"?w:(arguments[0].text=w,arguments[0])};t.events.push(["preProcessText",_])})(Xe.API),Xe.API.autoPrint=function(t){var e;return(t=t||{}).variant=t.variant||"non-conform",t.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},(function(t){var e=function(){var n=void 0;Object.defineProperty(this,"pdf",{get:function(){return n},set:function(l){n=l}});var r=150;Object.defineProperty(this,"width",{get:function(){return r},set:function(l){r=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=r+1)}});var a=300;Object.defineProperty(this,"height",{get:function(){return a},set:function(l){a=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=a+1)}});var i=[];Object.defineProperty(this,"childNodes",{get:function(){return i},set:function(l){i=l}});var o={};Object.defineProperty(this,"style",{get:function(){return o},set:function(l){o=l}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(n,r){var a;if((n=n||"2d")!=="2d")return null;for(a in r)this.pdf.context2d.hasOwnProperty(a)&&(this.pdf.context2d[a]=r[a]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},t.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])})(Xe.API),(function(t){var e={left:0,top:0,bottom:0,right:0},n=!1,r=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),a.call(this))},a=function(){this.internal.__cell__.lastCell=new i,this.internal.__cell__.pages=1},i=function(){var c=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return c},set:function(w){c=w}});var d=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return d},set:function(w){d=w}});var h=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return h},set:function(w){h=w}});var m=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return m},set:function(w){m=w}});var b=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return b},set:function(w){b=w}});var p=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return p},set:function(w){p=w}});var _=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return _},set:function(w){_=w}}),this};i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},i.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},t.setHeaderFunction=function(c){return r.call(this),this.internal.__cell__.headerFunction=typeof c=="function"?c:void 0,this},t.getTextDimensions=function(c,d){r.call(this);var h=(d=d||{}).fontSize||this.getFontSize(),m=d.font||this.getFont(),b=d.scaleFactor||this.internal.scaleFactor,p=0,_=0,w=0,S=this;if(!Array.isArray(c)&&typeof c!="string"){if(typeof c!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");c=String(c)}var x=d.maxWidth;x>0?typeof c=="string"?c=this.splitTextToSize(c,x):Object.prototype.toString.call(c)==="[object Array]"&&(c=c.reduce(function(O,L){return O.concat(S.splitTextToSize(L,x))},[])):c=Array.isArray(c)?c:[c];for(var T=0;T<c.length;T++)p<(w=this.getStringUnitWidth(c[T],{font:m})*h)&&(p=w);return p!==0&&(_=c.length),{w:p/=b,h:Math.max((_*h*this.getLineHeightFactor()-h*(this.getLineHeightFactor()-1))/b,0)}},t.cellAddPage=function(){r.call(this),this.addPage();var c=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new i(c.left,c.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var o=t.cell=function(){var c;c=arguments[0]instanceof i?arguments[0]:new i(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),r.call(this);var d=this.internal.__cell__.lastCell,h=this.internal.__cell__.padding,m=this.internal.__cell__.margins||e,b=this.internal.__cell__.tableHeaderRow,p=this.internal.__cell__.printHeaders;return d.lineNumber!==void 0&&(d.lineNumber===c.lineNumber?(c.x=(d.x||0)+(d.width||0),c.y=d.y||0):d.y+d.height+c.height+m.bottom>this.getPageHeight()?(this.cellAddPage(),c.y=m.top,p&&b&&(this.printHeaderRow(c.lineNumber,!0),c.y+=b[0].height)):c.y=d.y+d.height||c.y),c.text[0]!==void 0&&(this.rect(c.x,c.y,c.width,c.height,n===!0?"FD":void 0),c.align==="right"?this.text(c.text,c.x+c.width-h,c.y+h,{align:"right",baseline:"top"}):c.align==="center"?this.text(c.text,c.x+c.width/2,c.y+h,{align:"center",baseline:"top",maxWidth:c.width-h-h}):this.text(c.text,c.x+h,c.y+h,{align:"left",baseline:"top",maxWidth:c.width-h-h})),this.internal.__cell__.lastCell=c,this};t.table=function(c,d,h,m,b){if(r.call(this),!h)throw new Error("No data for PDF table.");var p,_,w,S,x=[],T=[],O=[],L={},K={},te=[],V=[],q=(b=b||{}).autoSize||!1,F=b.printHeaders!==!1,C=b.css&&b.css["font-size"]!==void 0?16*b.css["font-size"]:b.fontSize||12,A=b.margins||Object.assign({width:this.getPageWidth()},e),k=typeof b.padding=="number"?b.padding:3,M=b.headerBackgroundColor||"#c8c8c8",j=b.headerTextColor||"#000";if(a.call(this),this.internal.__cell__.printHeaders=F,this.internal.__cell__.margins=A,this.internal.__cell__.table_font_size=C,this.internal.__cell__.padding=k,this.internal.__cell__.headerBackgroundColor=M,this.internal.__cell__.headerTextColor=j,this.setFontSize(C),m==null)T=x=Object.keys(h[0]),O=x.map(function(){return"left"});else if(Array.isArray(m)&&Ht(m[0])==="object")for(x=m.map(function(xe){return xe.name}),T=m.map(function(xe){return xe.prompt||xe.name||""}),O=m.map(function(xe){return xe.align||"left"}),p=0;p<m.length;p+=1)K[m[p].name]=.7499990551181103*m[p].width;else Array.isArray(m)&&typeof m[0]=="string"&&(T=x=m,O=x.map(function(){return"left"}));if(q||Array.isArray(m)&&typeof m[0]=="string")for(p=0;p<x.length;p+=1){for(L[S=x[p]]=h.map(function(xe){return xe[S]}),this.setFont(void 0,"bold"),te.push(this.getTextDimensions(T[p],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),_=L[S],this.setFont(void 0,"normal"),w=0;w<_.length;w+=1)te.push(this.getTextDimensions(_[w],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);K[S]=Math.max.apply(null,te)+k+k,te=[]}if(F){var U={};for(p=0;p<x.length;p+=1)U[x[p]]={},U[x[p]].text=T[p],U[x[p]].align=O[p];var re=l.call(this,U,K);V=x.map(function(xe){return new i(c,d,K[xe],re,U[xe].text,void 0,U[xe].align)}),this.setTableHeaderRow(V),this.printHeaderRow(1,!1)}var ce=m.reduce(function(xe,ge){return xe[ge.name]=ge.align,xe},{});for(p=0;p<h.length;p+=1){"rowStart"in b&&b.rowStart instanceof Function&&b.rowStart({row:p,data:h[p]},this);var se=l.call(this,h[p],K);for(w=0;w<x.length;w+=1){var fe=h[p][x[w]];"cellStart"in b&&b.cellStart instanceof Function&&b.cellStart({row:p,col:w,data:fe},this),o.call(this,new i(c,d,K[x[w]],se,fe,p+2,ce[x[w]]))}}return this.internal.__cell__.table_x=c,this.internal.__cell__.table_y=d,this};var l=function(c,d){var h=this.internal.__cell__.padding,m=this.internal.__cell__.table_font_size,b=this.internal.scaleFactor;return Object.keys(c).map(function(p){var _=c[p];return this.splitTextToSize(_.hasOwnProperty("text")?_.text:_,d[p]-h-h)},this).map(function(p){return this.getLineHeightFactor()*p.length*m/b+h+h},this).reduce(function(p,_){return Math.max(p,_)},0)};t.setTableHeaderRow=function(c){r.call(this),this.internal.__cell__.tableHeaderRow=c},t.printHeaderRow=function(c,d){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var h;if(n=!0,typeof this.internal.__cell__.headerFunction=="function"){var m=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new i(m[0],m[1],m[2],m[3],void 0,-1)}this.setFont(void 0,"bold");for(var b=[],p=0;p<this.internal.__cell__.tableHeaderRow.length;p+=1){h=this.internal.__cell__.tableHeaderRow[p].clone(),d&&(h.y=this.internal.__cell__.margins.top||0,b.push(h)),h.lineNumber=c;var _=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),o.call(this,h),this.setTextColor(_)}b.length>0&&this.setTableHeaderRow(b),this.setFont(void 0,"normal"),n=!1}})(Xe.API);var lm={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},cm=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],ld=om(cm),um=[100,200,300,400,500,600,700,800,900],Iy=om(um);function Au(t){var e=t.family.replace(/"|'/g,"").toLowerCase(),n=(function(i){return lm[i=i||"normal"]?i:"normal"})(t.style),r=(function(i){return i?typeof i=="number"?i>=100&&i<=900&&i%100==0?i:400:/^\d00$/.test(i)?parseInt(i):i==="bold"?700:400:400})(t.weight),a=(function(i){return typeof ld[i=i||"normal"]=="number"?i:"normal"})(t.stretch);return{family:e,style:n,weight:r,stretch:a,src:t.src||[],ref:t.ref||{name:e,style:[a,n,r].join(" ")}}}function dp(t,e,n,r){var a;for(a=n;a>=0&&a<e.length;a+=r)if(t[e[a]])return t[e[a]];for(a=n;a>=0&&a<e.length;a-=r)if(t[e[a]])return t[e[a]]}var Oy={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},hp={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function fp(t){return[t.stretch,t.style,t.weight,t.family].join(" ")}function pp(t){return t.trimLeft()}function Ry(t,e){for(var n=0;n<t.length;){if(t.charAt(n)===e)return[t.substring(0,n),t.substring(n+1)];n+=1}return null}function Fy(t){var e=t.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],t.substring(e[0].length)]}var us,Ll,gp,mp,vp,ku=["times"];function bp(t,e,n,r,a){var i=4,o=_p;switch(a){case Xe.API.image_compression.FAST:i=1,o=yp;break;case Xe.API.image_compression.MEDIUM:i=6,o=wp;break;case Xe.API.image_compression.SLOW:i=9,o=xp}t=(function(c,d,h,m){for(var b,p=c.length/d,_=new Uint8Array(c.length+p),w=[Dy,yp,_p,wp,xp],S=0;S<p;S+=1){var x=S*d,T=c.subarray(x,x+d);if(m)_.set(m(T,h,b),x+S);else{for(var O=w.length,L=[],K=0;K<O;K+=1)L[K]=w[K](T,h,b);var te=By(L.concat());_.set(L[te],x+S)}b=T}return _})(t,e,Math.ceil(n*r/8),o);var l=td(t,{level:i});return Xe.API.__addimage__.arrayBufferToBinaryString(l)}function Dy(t){var e=Array.apply([],t);return e.unshift(0),e}function yp(t,e){var n=t.length,r=[];r[0]=1;for(var a=0;a<n;a+=1){var i=t[a-e]||0;r[a+1]=t[a]-i+256&255}return r}function _p(t,e,n){var r=t.length,a=[];a[0]=2;for(var i=0;i<r;i+=1){var o=n&&n[i]||0;a[i+1]=t[i]-o+256&255}return a}function wp(t,e,n){var r=t.length,a=[];a[0]=3;for(var i=0;i<r;i+=1){var o=t[i-e]||0,l=n&&n[i]||0;a[i+1]=t[i]+256-(o+l>>>1)&255}return a}function xp(t,e,n){var r=t.length,a=[];a[0]=4;for(var i=0;i<r;i+=1){var o=jy(t[i-e]||0,n&&n[i]||0,n&&n[i-e]||0);a[i+1]=t[i]-o+256&255}return a}function jy(t,e,n){if(t===e&&e===n)return t;var r=Math.abs(e-n),a=Math.abs(t-n),i=Math.abs(t+e-n-n);return r<=a&&r<=i?t:a<=i?e:n}function By(t){var e=t.map(function(n){return n.reduce(function(r,a){return r+Math.abs(a)},0)});return e.indexOf(Math.min.apply(null,e))}function Nu(t,e,n){var r=e*n,a=Math.floor(r/8),i=16-(r-8*a+n),o=(1<<n)-1;return dm(t,a)>>i&o}function Sp(t,e,n,r){var a=n*r,i=Math.floor(a/8),o=16-(a-8*i+r),l=(1<<r)-1,c=(e&l)<<o;(function(d,h,m){if(h+1<d.byteLength)d.setUint16(h,m,!1);else{var b=m>>8&255;d.setUint8(h,b)}})(t,i,dm(t,i)&~(l<<o)&65535|c)}function dm(t,e){return e+1<t.byteLength?t.getUint16(e,!1):t.getUint8(e)<<8}function My(t){var e=0;if(t[e++]!==71||t[e++]!==73||t[e++]!==70||t[e++]!==56||(t[e++]+1&253)!=56||t[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var n=t[e++]|t[e++]<<8,r=t[e++]|t[e++]<<8,a=t[e++],i=a>>7,o=1<<1+(7&a);t[e++],t[e++];var l=null,c=null;i&&(l=e,c=o,e+=3*o);var d=!0,h=[],m=0,b=null,p=0,_=null;for(this.width=n,this.height=r;d&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(t[e]!==11||t[e+1]==78&&t[e+2]==69&&t[e+3]==84&&t[e+4]==83&&t[e+5]==67&&t[e+6]==65&&t[e+7]==80&&t[e+8]==69&&t[e+9]==50&&t[e+10]==46&&t[e+11]==48&&t[e+12]==3&&t[e+13]==1&&t[e+16]==0)e+=14,_=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((A=t[e++])>=0))throw Error("Invalid block size");if(A===0)break;e+=A}break;case 249:if(t[e++]!==4||t[e+4]!==0)throw new Error("Invalid graphics extension block.");var w=t[e++];m=t[e++]|t[e++]<<8,b=t[e++],1&w||(b=null),p=w>>2&7,e++;break;case 254:for(;;){if(!((A=t[e++])>=0))throw Error("Invalid block size");if(A===0)break;e+=A}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var S=t[e++]|t[e++]<<8,x=t[e++]|t[e++]<<8,T=t[e++]|t[e++]<<8,O=t[e++]|t[e++]<<8,L=t[e++],K=L>>6&1,te=1<<1+(7&L),V=l,q=c,F=!1;L>>7&&(F=!0,V=e,q=te,e+=3*te);var C=e;for(e++;;){var A;if(!((A=t[e++])>=0))throw Error("Invalid block size");if(A===0)break;e+=A}h.push({x:S,y:x,width:T,height:O,has_local_palette:F,palette_offset:V,palette_size:q,data_offset:C,data_length:e-C,transparent_index:b,interlaced:!!K,delay:m,disposal:p});break;case 59:d=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return h.length},this.loopCount=function(){return _},this.frameInfo=function(k){if(k<0||k>=h.length)throw new Error("Frame index out of range.");return h[k]},this.decodeAndBlitFrameBGRA=function(k,M){var j=this.frameInfo(k),U=j.width*j.height;if(U>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");var re=new Uint8Array(U);Ap(t,j.data_offset,re,U);var ce=j.palette_offset,se=j.transparent_index;se===null&&(se=256);var fe=j.width,xe=n-fe,ge=fe,I=4*(j.y*n+j.x),z=4*((j.y+j.height)*n+j.x),J=I,X=4*xe;j.interlaced===!0&&(X+=4*n*7);for(var Z=8,ae=0,pe=re.length;ae<pe;++ae){var Y=re[ae];if(ge===0&&(ge=fe,(J+=X)>=z&&(X=4*xe+4*n*(Z-1),J=I+(fe+xe)*(Z<<1),Z>>=1)),Y===se)J+=4;else{var oe=t[ce+3*Y],be=t[ce+3*Y+1],Ce=t[ce+3*Y+2];M[J++]=Ce,M[J++]=be,M[J++]=oe,M[J++]=255}--ge}},this.decodeAndBlitFrameRGBA=function(k,M){var j=this.frameInfo(k),U=j.width*j.height;if(U>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");var re=new Uint8Array(U);Ap(t,j.data_offset,re,U);var ce=j.palette_offset,se=j.transparent_index;se===null&&(se=256);var fe=j.width,xe=n-fe,ge=fe,I=4*(j.y*n+j.x),z=4*((j.y+j.height)*n+j.x),J=I,X=4*xe;j.interlaced===!0&&(X+=4*n*7);for(var Z=8,ae=0,pe=re.length;ae<pe;++ae){var Y=re[ae];if(ge===0&&(ge=fe,(J+=X)>=z&&(X=4*xe+4*n*(Z-1),J=I+(fe+xe)*(Z<<1),Z>>=1)),Y===se)J+=4;else{var oe=t[ce+3*Y],be=t[ce+3*Y+1],Ce=t[ce+3*Y+2];M[J++]=oe,M[J++]=be,M[J++]=Ce,M[J++]=255}--ge}}}function Ap(t,e,n,r){for(var a=t[e++],i=1<<a,o=i+1,l=o+1,c=a+1,d=(1<<c)-1,h=0,m=0,b=0,p=t[e++],_=new Int32Array(4096),w=null;;){for(;h<16&&p!==0;)m|=t[e++]<<h,h+=8,p===1?p=t[e++]:--p;if(h<c)break;var S=m&d;if(m>>=c,h-=c,S!==i){if(S===o)break;for(var x=S<l?S:w,T=0,O=x;O>i;)O=_[O]>>8,++T;var L=O;if(b+T+(x!==S?1:0)>r)return void Kt.log("Warning, gif stream longer than expected.");n[b++]=L;var K=b+=T;for(x!==S&&(n[b++]=L),O=x;T--;)O=_[O],n[--K]=255&O,O>>=8;w!==null&&l<4096&&(_[l++]=w<<8|L,l>=d+1&&c<12&&(++c,d=d<<1|1)),w=S}else l=o+1,d=(1<<(c=a+1))-1,w=null}return b!==r&&Kt.log("Warning, gif stream shorter than expected."),n}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function Eu(t){var e,n,r,a,i,o=Math.floor,l=new Array(64),c=new Array(64),d=new Array(64),h=new Array(64),m=new Array(65535),b=new Array(65535),p=new Array(64),_=new Array(64),w=[],S=0,x=7,T=new Array(64),O=new Array(64),L=new Array(64),K=new Array(256),te=new Array(2048),V=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],q=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],F=[0,1,2,3,4,5,6,7,8,9,10,11],C=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],A=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],k=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],M=[0,1,2,3,4,5,6,7,8,9,10,11],j=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],U=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function re(I,z){for(var J=0,X=0,Z=new Array,ae=1;ae<=16;ae++){for(var pe=1;pe<=I[ae];pe++)Z[z[X]]=[],Z[z[X]][0]=J,Z[z[X]][1]=ae,X++,J++;J*=2}return Z}function ce(I){for(var z=I[0],J=I[1]-1;J>=0;)z&1<<J&&(S|=1<<x),J--,--x<0&&(S==255?(se(255),se(0)):se(S),x=7,S=0)}function se(I){w.push(I)}function fe(I){se(I>>8&255),se(255&I)}function xe(I,z,J,X,Z){for(var ae,pe=Z[0],Y=Z[240],oe=(function(Se,Ke){var Re,Qe,Ie,it,nt,at,ut,pt,qe,mt,We=0;for(qe=0;qe<8;++qe){Re=Se[We],Qe=Se[We+1],Ie=Se[We+2],it=Se[We+3],nt=Se[We+4],at=Se[We+5],ut=Se[We+6];var rn=Re+(pt=Se[We+7]),Et=Re-pt,bt=Qe+ut,ct=Qe-ut,Dt=Ie+at,et=Ie-at,jt=it+nt,st=it-nt,dt=rn+jt,Ut=rn-jt,kt=bt+Dt,tt=bt-Dt;Se[We]=dt+kt,Se[We+4]=dt-kt;var Ft=.707106781*(tt+Ut);Se[We+2]=Ut+Ft,Se[We+6]=Ut-Ft;var yi=.382683433*((dt=st+et)-(tt=ct+Et)),Ct=.5411961*dt+yi,Gn=1.306562965*tt+yi,Tr=.707106781*(kt=et+ct),rt=Et+Tr,mr=Et-Tr;Se[We+5]=mr+Ct,Se[We+3]=mr-Ct,Se[We+1]=rt+Gn,Se[We+7]=rt-Gn,We+=8}for(We=0,qe=0;qe<8;++qe){Re=Se[We],Qe=Se[We+8],Ie=Se[We+16],it=Se[We+24],nt=Se[We+32],at=Se[We+40],ut=Se[We+48];var Pr=Re+(pt=Se[We+56]),er=Re-pt,cr=Qe+ut,It=Qe-ut,Yt=Ie+at,xn=Ie-at,ii=it+nt,Ir=it-nt,ur=Pr+ii,Sn=Pr-ii,dr=cr+Yt,hr=cr-Yt;Se[We]=ur+dr,Se[We+32]=ur-dr;var tr=.707106781*(hr+Sn);Se[We+16]=Sn+tr,Se[We+48]=Sn-tr;var ai=.382683433*((ur=Ir+xn)-(hr=It+er)),Or=.5411961*ur+ai,Ue=1.306562965*hr+ai,ee=.707106781*(dr=xn+It),Ne=er+ee,Fe=er-ee;Se[We+40]=Fe+Or,Se[We+24]=Fe-Or,Se[We+8]=Ne+Ue,Se[We+56]=Ne-Ue,We++}for(qe=0;qe<64;++qe)mt=Se[qe]*Ke[qe],p[qe]=mt>0?mt+.5|0:mt-.5|0;return p})(I,z),be=0;be<64;++be)_[V[be]]=oe[be];var Ce=_[0]-J;J=_[0],Ce==0?ce(X[0]):(ce(X[b[ae=32767+Ce]]),ce(m[ae]));for(var Te=63;Te>0&&_[Te]==0;)Te--;if(Te==0)return ce(pe),J;for(var je,$=1;$<=Te;){for(var Pe=$;_[$]==0&&$<=Te;)++$;var ht=$-Pe;if(ht>=16){je=ht>>4;for(var He=1;He<=je;++He)ce(Y);ht&=15}ae=32767+_[$],ce(Z[(ht<<4)+b[ae]]),ce(m[ae]),$++}return Te!=63&&ce(pe),J}function ge(I){I=Math.min(Math.max(I,1),100),i!=I&&((function(z){for(var J=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],X=0;X<64;X++){var Z=o((J[X]*z+50)/100);Z=Math.min(Math.max(Z,1),255),l[V[X]]=Z}for(var ae=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],pe=0;pe<64;pe++){var Y=o((ae[pe]*z+50)/100);Y=Math.min(Math.max(Y,1),255),c[V[pe]]=Y}for(var oe=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],be=0,Ce=0;Ce<8;Ce++)for(var Te=0;Te<8;Te++)d[be]=1/(l[V[be]]*oe[Ce]*oe[Te]*8),h[be]=1/(c[V[be]]*oe[Ce]*oe[Te]*8),be++})(I<50?Math.floor(5e3/I):Math.floor(200-2*I)),i=I)}this.encode=function(I,z){z&&ge(z),w=new Array,S=0,x=7,fe(65496),fe(65504),fe(16),se(74),se(70),se(73),se(70),se(0),se(1),se(1),se(0),fe(1),fe(1),se(0),se(0),(function(){fe(65499),fe(132),se(0);for(var Qe=0;Qe<64;Qe++)se(l[Qe]);se(1);for(var Ie=0;Ie<64;Ie++)se(c[Ie])})(),(function(Qe,Ie){fe(65472),fe(17),se(8),fe(Ie),fe(Qe),se(3),se(1),se(17),se(0),se(2),se(17),se(1),se(3),se(17),se(1)})(I.width,I.height),(function(){fe(65476),fe(418),se(0);for(var Qe=0;Qe<16;Qe++)se(q[Qe+1]);for(var Ie=0;Ie<=11;Ie++)se(F[Ie]);se(16);for(var it=0;it<16;it++)se(C[it+1]);for(var nt=0;nt<=161;nt++)se(A[nt]);se(1);for(var at=0;at<16;at++)se(k[at+1]);for(var ut=0;ut<=11;ut++)se(M[ut]);se(17);for(var pt=0;pt<16;pt++)se(j[pt+1]);for(var qe=0;qe<=161;qe++)se(U[qe])})(),fe(65498),fe(12),se(3),se(1),se(0),se(2),se(17),se(3),se(17),se(0),se(63),se(0);var J=0,X=0,Z=0;S=0,x=7,this.encode.displayName="_encode_";for(var ae,pe,Y,oe,be,Ce,Te,je,$,Pe=I.data,ht=I.width,He=I.height,Se=4*ht,Ke=0;Ke<He;){for(ae=0;ae<Se;){for(be=Se*Ke+ae,Te=-1,je=0,$=0;$<64;$++)Ce=be+(je=$>>3)*Se+(Te=4*(7&$)),Ke+je>=He&&(Ce-=Se*(Ke+1+je-He)),ae+Te>=Se&&(Ce-=ae+Te-Se+4),pe=Pe[Ce++],Y=Pe[Ce++],oe=Pe[Ce++],T[$]=(te[pe]+te[Y+256|0]+te[oe+512|0]>>16)-128,O[$]=(te[pe+768|0]+te[Y+1024|0]+te[oe+1280|0]>>16)-128,L[$]=(te[pe+1280|0]+te[Y+1536|0]+te[oe+1792|0]>>16)-128;J=xe(T,d,J,e,r),X=xe(O,h,X,n,a),Z=xe(L,h,Z,n,a),ae+=32}Ke+=8}if(x>=0){var Re=[];Re[1]=x+1,Re[0]=(1<<x+1)-1,ce(Re)}return fe(65497),new Uint8Array(w)},t=t||50,(function(){for(var I=String.fromCharCode,z=0;z<256;z++)K[z]=I(z)})(),e=re(q,F),n=re(k,M),r=re(C,A),a=re(j,U),(function(){for(var I=1,z=2,J=1;J<=15;J++){for(var X=I;X<z;X++)b[32767+X]=J,m[32767+X]=[],m[32767+X][1]=J,m[32767+X][0]=X;for(var Z=-(z-1);Z<=-I;Z++)b[32767+Z]=J,m[32767+Z]=[],m[32767+Z][1]=J,m[32767+Z][0]=z-1+Z;I<<=1,z<<=1}})(),(function(){for(var I=0;I<256;I++)te[I]=19595*I,te[I+256|0]=38470*I,te[I+512|0]=7471*I+32768,te[I+768|0]=-11059*I,te[I+1024|0]=-21709*I,te[I+1280|0]=32768*I+8421375,te[I+1536|0]=-27439*I,te[I+1792|0]=-5329*I})(),ge(t)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Kr(t,e){if(this.pos=0,this.buffer=t,this.datav=new DataView(t.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function kp(t){function e(F){if(!F)throw Error("assert :P")}function n(F,C,A){for(var k=0;4>k;k++)if(F[C+k]!=A.charCodeAt(k))return!0;return!1}function r(F,C,A,k,M){for(var j=0;j<M;j++)F[C+j]=A[k+j]}function a(F,C,A,k){for(var M=0;M<k;M++)F[C+M]=A}function i(F){return new Int32Array(F)}function o(F,C){for(var A=[],k=0;k<F;k++)A.push(new C);return A}function l(F,C){var A=[];return(function k(M,j,U){for(var re=U[j],ce=0;ce<re&&(M.push(U.length>j+1?[]:new C),!(U.length<j+1));ce++)k(M[ce],j+1,U)})(A,0,F),A}var c=function(){var F=this;function C(u,f){for(var v=1<<f-1>>>0;u&v;)v>>>=1;return v?(u&v-1)+v:u}function A(u,f,v,y,E){e(!(y%v));do u[f+(y-=v)]=E;while(0<y)}function k(u,f,v,y,E){if(e(2328>=E),512>=E)var P=i(512);else if((P=i(E))==null)return 0;return(function(R,D,B,H,ne,he){var W,ie,ue=D,ve=1<<B,de=i(16),ye=i(16);for(e(ne!=0),e(H!=null),e(R!=null),e(0<B),ie=0;ie<ne;++ie){if(15<H[ie])return 0;++de[H[ie]]}if(de[0]==ne)return 0;for(ye[1]=0,W=1;15>W;++W){if(de[W]>1<<W)return 0;ye[W+1]=ye[W]+de[W]}for(ie=0;ie<ne;++ie)W=H[ie],0<H[ie]&&(he[ye[W]++]=ie);if(ye[15]==1)return(H=new M).g=0,H.value=he[0],A(R,ue,1,ve,H),ve;var we,Ee=-1,ke=ve-1,Ze=0,Be=1,xt=1,Ge=1<<B;for(ie=0,W=1,ne=2;W<=B;++W,ne<<=1){if(Be+=xt<<=1,0>(xt-=de[W]))return 0;for(;0<de[W];--de[W])(H=new M).g=W,H.value=he[ie++],A(R,ue+Ze,ne,Ge,H),Ze=C(Ze,W)}for(W=B+1,ne=2;15>=W;++W,ne<<=1){if(Be+=xt<<=1,0>(xt-=de[W]))return 0;for(;0<de[W];--de[W]){if(H=new M,(Ze&ke)!=Ee){for(ue+=Ge,we=1<<(Ee=W)-B;15>Ee&&!(0>=(we-=de[Ee]));)++Ee,we<<=1;ve+=Ge=1<<(we=Ee-B),R[D+(Ee=Ze&ke)].g=we+B,R[D+Ee].value=ue-D-Ee}H.g=W-B,H.value=he[ie++],A(R,ue+(Ze>>B),ne,Ge,H),Ze=C(Ze,W)}}return Be!=2*ye[15]-1?0:ve})(u,f,v,y,E,P)}function M(){this.value=this.g=0}function j(){this.value=this.g=0}function U(){this.G=o(5,M),this.H=i(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=o(Sa,j)}function re(u,f,v,y){e(u!=null),e(f!=null),e(2147483648>y),u.Ca=254,u.I=0,u.b=-8,u.Ka=0,u.oa=f,u.pa=v,u.Jd=f,u.Yc=v+y,u.Zc=4<=y?v+y-4+1:v,pe(u)}function ce(u,f){for(var v=0;0<f--;)v|=oe(u,128)<<f;return v}function se(u,f){var v=ce(u,f);return Y(u)?-v:v}function fe(u,f,v,y){var E,P=0;for(e(u!=null),e(f!=null),e(4294967288>y),u.Sb=y,u.Ra=0,u.u=0,u.h=0,4<y&&(y=4),E=0;E<y;++E)P+=f[v+E]<<8*E;u.Ra=P,u.bb=y,u.oa=f,u.pa=v}function xe(u){for(;8<=u.u&&u.bb<u.Sb;)u.Ra>>>=8,u.Ra+=u.oa[u.pa+u.bb]<<Wi-8>>>0,++u.bb,u.u-=8;X(u)&&(u.h=1,u.u=0)}function ge(u,f){if(e(0<=f),!u.h&&f<=br){var v=J(u)&vr[f];return u.u+=f,xe(u),v}return u.h=1,u.u=0}function I(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function z(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function J(u){return u.Ra>>>(u.u&Wi-1)>>>0}function X(u){return e(u.bb<=u.Sb),u.h||u.bb==u.Sb&&u.u>Wi}function Z(u,f){u.u=f,u.h=X(u)}function ae(u){u.u>=Ti&&(e(u.u>=Ti),xe(u))}function pe(u){e(u!=null&&u.oa!=null),u.pa<u.Zc?(u.I=(u.oa[u.pa++]|u.I<<8)>>>0,u.b+=8):(e(u!=null&&u.oa!=null),u.pa<u.Yc?(u.b+=8,u.I=u.oa[u.pa++]|u.I<<8):u.Ka?u.b=0:(u.I<<=8,u.b+=8,u.Ka=1))}function Y(u){return ce(u,1)}function oe(u,f){var v=u.Ca;0>u.b&&pe(u);var y=u.b,E=v*f>>>8,P=(u.I>>>y>E)+0;for(P?(v-=E,u.I-=E+1<<y>>>0):v=E+1,y=v,E=0;256<=y;)E+=8,y>>=8;return y=7^E+Gi[y],u.b-=y,u.Ca=(v<<y)-1,P}function be(u,f,v){u[f+0]=v>>24&255,u[f+1]=v>>16&255,u[f+2]=v>>8&255,u[f+3]=255&v}function Ce(u,f){return u[f+0]|u[f+1]<<8}function Te(u,f){return Ce(u,f)|u[f+2]<<16}function je(u,f){return Ce(u,f)|Ce(u,f+2)<<16}function $(u,f){var v=1<<f;return e(u!=null),e(0<f),u.X=i(v),u.X==null?0:(u.Mb=32-f,u.Xa=f,1)}function Pe(u,f){e(u!=null),e(f!=null),e(u.Xa==f.Xa),r(f.X,0,u.X,0,1<<f.Xa)}function ht(){this.X=[],this.Xa=this.Mb=0}function He(u,f,v,y){e(v!=null),e(y!=null);var E=v[0],P=y[0];return E==0&&(E=(u*P+f/2)/f),P==0&&(P=(f*E+u/2)/u),0>=E||0>=P?0:(v[0]=E,y[0]=P,1)}function Se(u,f){return u+(1<<f)-1>>>f}function Ke(u,f){return((4278255360&u)+(4278255360&f)>>>0&4278255360)+((16711935&u)+(16711935&f)>>>0&16711935)>>>0}function Re(u,f){F[f]=function(v,y,E,P,R,D,B){var H;for(H=0;H<R;++H){var ne=F[u](D[B+H-1],E,P+H);D[B+H]=Ke(v[y+H],ne)}}}function Qe(){this.ud=this.hd=this.jd=0}function Ie(u,f){return((4278124286&(u^f))>>>1)+(u&f)>>>0}function it(u){return 0<=u&&256>u?u:0>u?0:255<u?255:void 0}function nt(u,f){return it(u+(u-f+.5>>1))}function at(u,f,v){return Math.abs(f-v)-Math.abs(u-v)}function ut(u,f,v,y,E,P,R){for(y=P[R-1],v=0;v<E;++v)P[R+v]=y=Ke(u[f+v],y)}function pt(u,f,v,y,E){var P;for(P=0;P<v;++P){var R=u[f+P],D=R>>8&255,B=16711935&(B=(B=16711935&R)+((D<<16)+D));y[E+P]=(4278255360&R)+B>>>0}}function qe(u,f){f.jd=255&u,f.hd=u>>8&255,f.ud=u>>16&255}function mt(u,f,v,y,E,P){var R;for(R=0;R<y;++R){var D=f[v+R],B=D>>>8,H=D,ne=255&(ne=(ne=D>>>16)+((u.jd<<24>>24)*(B<<24>>24)>>>5));H=255&(H=(H+=(u.hd<<24>>24)*(B<<24>>24)>>>5)+((u.ud<<24>>24)*(ne<<24>>24)>>>5)),E[P+R]=(4278255360&D)+(ne<<16)+H}}function We(u,f,v,y,E){F[f]=function(P,R,D,B,H,ne,he,W,ie){for(B=he;B<W;++B)for(he=0;he<ie;++he)H[ne++]=E(D[y(P[R++])])},F[u]=function(P,R,D,B,H,ne,he){var W=8>>P.b,ie=P.Ea,ue=P.K[0],ve=P.w;if(8>W)for(P=(1<<P.b)-1,ve=(1<<W)-1;R<D;++R){var de,ye=0;for(de=0;de<ie;++de)de&P||(ye=y(B[H++])),ne[he++]=E(ue[ye&ve]),ye>>=W}else F["VP8LMapColor"+v](B,H,ue,ve,ne,he,R,D,ie)}}function rn(u,f,v,y,E){for(v=f+v;f<v;){var P=u[f++];y[E++]=P>>16&255,y[E++]=P>>8&255,y[E++]=255&P}}function Et(u,f,v,y,E){for(v=f+v;f<v;){var P=u[f++];y[E++]=P>>16&255,y[E++]=P>>8&255,y[E++]=255&P,y[E++]=P>>24&255}}function bt(u,f,v,y,E){for(v=f+v;f<v;){var P=(R=u[f++])>>16&240|R>>12&15,R=240&R|R>>28&15;y[E++]=P,y[E++]=R}}function ct(u,f,v,y,E){for(v=f+v;f<v;){var P=(R=u[f++])>>16&248|R>>13&7,R=R>>5&224|R>>3&31;y[E++]=P,y[E++]=R}}function Dt(u,f,v,y,E){for(v=f+v;f<v;){var P=u[f++];y[E++]=255&P,y[E++]=P>>8&255,y[E++]=P>>16&255}}function et(u,f,v,y,E,P){if(P==0)for(v=f+v;f<v;)be(y,((P=u[f++])[0]>>24|P[1]>>8&65280|P[2]<<8&16711680|P[3]<<24)>>>0),E+=32;else r(y,E,u,f,v)}function jt(u,f){F[f][0]=F[u+"0"],F[f][1]=F[u+"1"],F[f][2]=F[u+"2"],F[f][3]=F[u+"3"],F[f][4]=F[u+"4"],F[f][5]=F[u+"5"],F[f][6]=F[u+"6"],F[f][7]=F[u+"7"],F[f][8]=F[u+"8"],F[f][9]=F[u+"9"],F[f][10]=F[u+"10"],F[f][11]=F[u+"11"],F[f][12]=F[u+"12"],F[f][13]=F[u+"13"],F[f][14]=F[u+"0"],F[f][15]=F[u+"0"]}function st(u){return u==Tc||u==Pc||u==Zo||u==Ic}function dt(){this.eb=[],this.size=this.A=this.fb=0}function Ut(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function kt(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new dt,this.f.kb=new Ut,this.sd=null}function tt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Ft(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function yi(u){return alert("todo:WebPSamplerProcessPlane"),u.T}function Ct(u,f){var v=u.T,y=f.ba.f.RGBA,E=y.eb,P=y.fb+u.ka*y.A,R=Mr[f.ba.S],D=u.y,B=u.O,H=u.f,ne=u.N,he=u.ea,W=u.W,ie=f.cc,ue=f.dc,ve=f.Mc,de=f.Nc,ye=u.ka,we=u.ka+u.T,Ee=u.U,ke=Ee+1>>1;for(ye==0?R(D,B,null,null,H,ne,he,W,H,ne,he,W,E,P,null,null,Ee):(R(f.ec,f.fc,D,B,ie,ue,ve,de,H,ne,he,W,E,P-y.A,E,P,Ee),++v);ye+2<we;ye+=2)ie=H,ue=ne,ve=he,de=W,ne+=u.Rc,W+=u.Rc,P+=2*y.A,R(D,(B+=2*u.fa)-u.fa,D,B,ie,ue,ve,de,H,ne,he,W,E,P-y.A,E,P,Ee);return B+=u.fa,u.j+we<u.o?(r(f.ec,f.fc,D,B,Ee),r(f.cc,f.dc,H,ne,ke),r(f.Mc,f.Nc,he,W,ke),v--):1&we||R(D,B,null,null,H,ne,he,W,H,ne,he,W,E,P+y.A,null,null,Ee),v}function Gn(u,f,v){var y=u.F,E=[u.J];if(y!=null){var P=u.U,R=f.ba.S,D=R==Xo||R==Zo;f=f.ba.f.RGBA;var B=[0],H=u.ka;B[0]=u.T,u.Kb&&(H==0?--B[0]:(--H,E[0]-=u.width),u.j+u.ka+u.T==u.o&&(B[0]=u.o-u.j-H));var ne=f.eb;H=f.fb+H*f.A,u=jd(y,E[0],u.width,P,B,ne,H+(D?0:3),f.A),e(v==B),u&&st(R)&&Vs(ne,H,D,P,B,f.A)}return 0}function Tr(u){var f=u.ma,v=f.ba.S,y=11>v,E=v==Jo||v==Yo||v==Xo||v==Cc||v==12||st(v);if(f.memory=null,f.Ib=null,f.Jb=null,f.Nd=null,!Ms(f.Oa,u,E?11:12))return 0;if(E&&st(v)&&Ds(),u.da)alert("todo:use_scaling");else{if(y){if(f.Ib=yi,u.Kb){if(v=u.U+1>>1,f.memory=i(u.U+2*v),f.memory==null)return 0;f.ec=f.memory,f.fc=0,f.cc=f.ec,f.dc=f.fc+u.U,f.Mc=f.cc,f.Nc=f.dc+v,f.Ib=Ct,Ds()}}else alert("todo:EmitYUV");E&&(f.Jb=Gn,y&&Hr())}if(y&&!Qd){for(u=0;256>u;++u)Im[u]=89858*(u-128)+el>>Qo,Fm[u]=-22014*(u-128)+el,Rm[u]=-45773*(u-128),Om[u]=113618*(u-128)+el>>Qo;for(u=Js;u<Fc;++u)f=76283*(u-16)+el>>Qo,Dm[u-Js]=si(f,255),jm[u-Js]=si(f+8>>4,15);Qd=1}return 1}function rt(u){var f=u.ma,v=u.U,y=u.T;return e(!(1&u.ka)),0>=v||0>=y?0:(v=f.Ib(u,f),f.Jb!=null&&f.Jb(u,f,v),f.Dc+=v,1)}function mr(u){u.ma.memory=null}function Pr(u,f,v,y){return ge(u,8)!=47?0:(f[0]=ge(u,14)+1,v[0]=ge(u,14)+1,y[0]=ge(u,1),ge(u,3)!=0?0:!u.h)}function er(u,f){if(4>u)return u+1;var v=u-2>>1;return(2+(1&u)<<v)+ge(f,v)+1}function cr(u,f){return 120<f?f-120:1<=(v=((v=bm[f-1])>>4)*u+(8-(15&v)))?v:1;var v}function It(u,f,v){var y=J(v),E=u[f+=255&y].g-8;return 0<E&&(Z(v,v.u+8),y=J(v),f+=u[f].value,f+=y&(1<<E)-1),Z(v,v.u+u[f].g),u[f].value}function Yt(u,f,v){return v.g+=u.g,v.value+=u.value<<f>>>0,e(8>=v.g),u.g}function xn(u,f,v){var y=u.xc;return e((f=y==0?0:u.vc[u.md*(v>>y)+(f>>y)])<u.Wb),u.Ya[f]}function ii(u,f,v,y){var E=u.ab,P=u.c*f,R=u.C;f=R+f;var D=v,B=y;for(y=u.Ta,v=u.Ua;0<E--;){var H=u.gc[E],ne=R,he=f,W=D,ie=B,ue=(B=y,D=v,H.Ea);switch(e(ne<he),e(he<=H.nc),H.hc){case 2:gn(W,ie,(he-ne)*ue,B,D);break;case 0:var ve=ne,de=he,ye=B,we=D,Ee=(Ge=H).Ea;ve==0&&($s(W,ie,null,null,1,ye,we),ut(W,ie+1,0,0,Ee-1,ye,we+1),ie+=Ee,we+=Ee,++ve);for(var ke=1<<Ge.b,Ze=ke-1,Be=Se(Ee,Ge.b),xt=Ge.K,Ge=Ge.w+(ve>>Ge.b)*Be;ve<de;){var Tt=xt,Rn=Ge,St=1;for(Qa(W,ie,ye,we-Ee,1,ye,we);St<Ee;){var Ve=(St&~Ze)+ke;Ve>Ee&&(Ve=Ee),(0,zs[Tt[Rn++]>>8&15])(W,ie+ +St,ye,we+St-Ee,Ve-St,ye,we+St),St=Ve}ie+=Ee,we+=Ee,++ve&Ze||(Ge+=Be)}he!=H.nc&&r(B,D-ue,B,D+(he-ne-1)*ue,ue);break;case 1:for(ue=W,de=ie,Ee=(W=H.Ea)-(we=W&~(ye=(ie=1<<H.b)-1)),ve=Se(W,H.b),ke=H.K,H=H.w+(ne>>H.b)*ve;ne<he;){for(Ze=ke,Be=H,xt=new Qe,Ge=de+we,Tt=de+W;de<Ge;)qe(Ze[Be++],xt),Hs(xt,ue,de,ie,B,D),de+=ie,D+=ie;de<Tt&&(qe(Ze[Be++],xt),Hs(xt,ue,de,Ee,B,D),de+=Ee,D+=Ee),++ne&ye||(H+=ve)}break;case 3:if(W==B&&ie==D&&0<H.b){for(de=B,W=ue=D+(he-ne)*ue-(we=(he-ne)*Se(H.Ea,H.b)),ie=B,ye=D,ve=[],we=(Ee=we)-1;0<=we;--we)ve[we]=ie[ye+we];for(we=Ee-1;0<=we;--we)de[W+we]=ve[we];Wo(H,ne,he,B,ue,B,D)}else Wo(H,ne,he,W,ie,B,D)}D=y,B=v}B!=v&&r(y,v,D,B,P)}function Ir(u,f){var v=u.V,y=u.Ba+u.c*u.C,E=f-u.C;if(e(f<=u.l.o),e(16>=E),0<E){var P=u.l,R=u.Ta,D=u.Ua,B=P.width;if(ii(u,E,v,y),E=D=[D],e((v=u.C)<(y=f)),e(P.v<P.va),y>P.o&&(y=P.o),v<P.j){var H=P.j-v;v=P.j,E[0]+=H*B}if(v>=y?v=0:(E[0]+=4*P.v,P.ka=v-P.j,P.U=P.va-P.v,P.T=y-v,v=1),v){if(D=D[0],11>(v=u.ca).S){var ne=v.f.RGBA,he=(y=v.S,E=P.U,P=P.T,H=ne.eb,ne.A),W=P;for(ne=ne.fb+u.Ma*ne.A;0<W--;){var ie=R,ue=D,ve=E,de=H,ye=ne;switch(y){case Ko:Ws(ie,ue,ve,de,ye);break;case Jo:Vi(ie,ue,ve,de,ye);break;case Tc:Vi(ie,ue,ve,de,ye),Vs(de,ye,0,ve,1,0);break;case Hd:Aa(ie,ue,ve,de,ye);break;case Yo:et(ie,ue,ve,de,ye,1);break;case Pc:et(ie,ue,ve,de,ye,1),Vs(de,ye,0,ve,1,0);break;case Xo:et(ie,ue,ve,de,ye,0);break;case Zo:et(ie,ue,ve,de,ye,0),Vs(de,ye,1,ve,1,0);break;case Cc:Ki(ie,ue,ve,de,ye);break;case Ic:Ki(ie,ue,ve,de,ye),Dd(de,ye,ve,1,0);break;case Wd:Ji(ie,ue,ve,de,ye);break;default:e(0)}D+=B,ne+=he}u.Ma+=P}else alert("todo:EmitRescaledRowsYUVA");e(u.Ma<=v.height)}}u.C=f,e(u.C<=u.i)}function ur(u){var f;if(0<u.ua)return 0;for(f=0;f<u.Wb;++f){var v=u.Ya[f].G,y=u.Ya[f].H;if(0<v[1][y[1]+0].g||0<v[2][y[2]+0].g||0<v[3][y[3]+0].g)return 0}return 1}function Sn(u,f,v,y,E,P){if(u.Z!=0){var R=u.qd,D=u.rd;for(e(Zi[u.Z]!=null);f<v;++f)Zi[u.Z](R,D,y,E,y,E,P),R=y,D=E,E+=P;u.qd=R,u.rd=D}}function dr(u,f){var v=u.l.ma,y=v.Z==0||v.Z==1?u.l.j:u.C;if(y=u.C<y?y:u.C,e(f<=u.l.o),f>y){var E=u.l.width,P=v.ca,R=v.tb+E*y,D=u.V,B=u.Ba+u.c*y,H=u.gc;e(u.ab==1),e(H[0].hc==3),ui(H[0],y,f,D,B,P,R),Sn(v,y,f,P,R,E)}u.C=u.Ma=f}function hr(u,f,v,y,E,P,R){var D=u.$/y,B=u.$%y,H=u.m,ne=u.s,he=v+u.$,W=he;E=v+y*E;var ie=v+y*P,ue=280+ne.ua,ve=u.Pb?D:16777216,de=0<ne.ua?ne.Wa:null,ye=ne.wc,we=he<ie?xn(ne,B,D):null;e(u.C<P),e(ie<=E);var Ee=!1;e:for(;;){for(;Ee||he<ie;){var ke=0;if(D>=ve){var Ze=he-v;e((ve=u).Pb),ve.wd=ve.m,ve.xd=Ze,0<ve.s.ua&&Pe(ve.s.Wa,ve.s.vb),ve=D+_m}if(B&ye||(we=xn(ne,B,D)),e(we!=null),we.Qb&&(f[he]=we.qb,Ee=!0),!Ee)if(ae(H),we.jc){ke=H,Ze=f;var Be=he,xt=we.pd[J(ke)&Sa-1];e(we.jc),256>xt.g?(Z(ke,ke.u+xt.g),Ze[Be]=xt.value,ke=0):(Z(ke,ke.u+xt.g-256),e(256<=xt.value),ke=xt.value),ke==0&&(Ee=!0)}else ke=It(we.G[0],we.H[0],H);if(H.h)break;if(Ee||256>ke){if(!Ee)if(we.nd)f[he]=(we.qb|ke<<8)>>>0;else{if(ae(H),Ee=It(we.G[1],we.H[1],H),ae(H),Ze=It(we.G[2],we.H[2],H),Be=It(we.G[3],we.H[3],H),H.h)break;f[he]=(Be<<24|Ee<<16|ke<<8|Ze)>>>0}if(Ee=!1,++he,++B>=y&&(B=0,++D,R!=null&&D<=P&&!(D%16)&&R(u,D),de!=null))for(;W<he;)ke=f[W++],de.X[(506832829*ke&4294967295)>>>de.Mb]=ke}else if(280>ke){if(ke=er(ke-256,H),Ze=It(we.G[4],we.H[4],H),ae(H),Ze=cr(y,Ze=er(Ze,H)),H.h)break;if(he-v<Ze||E-he<ke)break e;for(Be=0;Be<ke;++Be)f[he+Be]=f[he+Be-Ze];for(he+=ke,B+=ke;B>=y;)B-=y,++D,R!=null&&D<=P&&!(D%16)&&R(u,D);if(e(he<=E),B&ye&&(we=xn(ne,B,D)),de!=null)for(;W<he;)ke=f[W++],de.X[(506832829*ke&4294967295)>>>de.Mb]=ke}else{if(!(ke<ue))break e;for(Ee=ke-280,e(de!=null);W<he;)ke=f[W++],de.X[(506832829*ke&4294967295)>>>de.Mb]=ke;ke=he,e(!(Ee>>>(Ze=de).Xa)),f[ke]=Ze.X[Ee],Ee=!0}Ee||e(H.h==X(H))}if(u.Pb&&H.h&&he<E)e(u.m.h),u.a=5,u.m=u.wd,u.$=u.xd,0<u.s.ua&&Pe(u.s.vb,u.s.Wa);else{if(H.h)break e;R!=null&&R(u,D>P?P:D),u.a=0,u.$=he-v}return 1}return u.a=3,0}function tr(u){e(u!=null),u.vc=null,u.yc=null,u.Ya=null;var f=u.Wa;f!=null&&(f.X=null),u.vb=null,e(u!=null)}function ai(){var u=new gt;return u==null?null:(u.a=0,u.xb=Kd,jt("Predictor","VP8LPredictors"),jt("Predictor","VP8LPredictors_C"),jt("PredictorAdd","VP8LPredictorsAdd"),jt("PredictorAdd","VP8LPredictorsAdd_C"),gn=pt,Hs=mt,Ws=rn,Vi=Et,Ki=bt,Ji=ct,Aa=Dt,F.VP8LMapColor32b=ci,F.VP8LMapColor8b=qs,u)}function Or(u,f,v,y,E){var P=1,R=[u],D=[f],B=y.m,H=y.s,ne=null,he=0;e:for(;;){if(v)for(;P&&ge(B,1);){var W=R,ie=D,ue=y,ve=1,de=ue.m,ye=ue.gc[ue.ab],we=ge(de,2);if(ue.Oc&1<<we)P=0;else{switch(ue.Oc|=1<<we,ye.hc=we,ye.Ea=W[0],ye.nc=ie[0],ye.K=[null],++ue.ab,e(4>=ue.ab),we){case 0:case 1:ye.b=ge(de,3)+2,ve=Or(Se(ye.Ea,ye.b),Se(ye.nc,ye.b),0,ue,ye.K),ye.K=ye.K[0];break;case 3:var Ee,ke=ge(de,8)+1,Ze=16<ke?0:4<ke?1:2<ke?2:3;if(W[0]=Se(ye.Ea,Ze),ye.b=Ze,Ee=ve=Or(ke,1,0,ue,ye.K)){var Be,xt=ke,Ge=ye,Tt=1<<(8>>Ge.b),Rn=i(Tt);if(Rn==null)Ee=0;else{var St=Ge.K[0],Ve=Ge.w;for(Rn[0]=Ge.K[0][0],Be=1;Be<1*xt;++Be)Rn[Be]=Ke(St[Ve+Be],Rn[Be-1]);for(;Be<4*Tt;++Be)Rn[Be]=0;Ge.K[0]=null,Ge.K[0]=Rn,Ee=1}}ve=Ee;break;case 2:break;default:e(0)}P=ve}}if(R=R[0],D=D[0],P&&ge(B,1)&&!(P=1<=(he=ge(B,4))&&11>=he)){y.a=3;break e}var Oe;if(Oe=P)t:{var vn,_t,Pt,tn=y,$n=R,rr=D,dn=he,Vn=v,ir=tn.m,Fn=tn.s,Rt=[null],$t=1,hn=0,qt=ym[dn];n:for(;;){if(Vn&&ge(ir,1)){var qn=ge(ir,3)+2,Gr=Se($n,qn),bn=Se(rr,qn),fr=Gr*bn;if(!Or(Gr,bn,0,tn,Rt))break n;for(Rt=Rt[0],Fn.xc=qn,vn=0;vn<fr;++vn){var Vt=Rt[vn]>>8&65535;Rt[vn]=Vt,Vt>=$t&&($t=Vt+1)}}if(ir.h)break n;for(_t=0;5>_t;++_t){var Dn=Gd[_t];!_t&&0<dn&&(Dn+=1<<dn),hn<Dn&&(hn=Dn)}var _r=o($t*qt,M),ar=$t,wr=o(ar,U);if(wr==null)var xr=null;else e(65536>=ar),xr=wr;var pr=i(hn);if(xr==null||pr==null||_r==null){tn.a=1;break n}var Sr=_r;for(vn=Pt=0;vn<$t;++vn){var Zt=xr[vn],Ar=Zt.G,Vr=Zt.H,Na=0,Oi=1,zn=0;for(_t=0;5>_t;++_t){Dn=Gd[_t],Ar[_t]=Sr,Vr[_t]=Pt,!_t&&0<dn&&(Dn+=1<<dn);i:{var nl,Dc=Dn,rl=tn,Ys=pr,Um=Sr,$m=Pt,jc=0,Qi=rl.m,qm=ge(Qi,1);if(a(Ys,0,0,Dc),qm){var zm=ge(Qi,1)+1,Hm=ge(Qi,1),nh=ge(Qi,Hm==0?1:8);Ys[nh]=1,zm==2&&(Ys[nh=ge(Qi,8)]=1);var il=1}else{var rh=i(19),ih=ge(Qi,4)+4;if(19<ih){rl.a=3;var al=0;break i}for(nl=0;nl<ih;++nl)rh[vm[nl]]=ge(Qi,3);var Bc=void 0,Xs=void 0,ah=rl,Wm=rh,sl=Dc,sh=Ys,Mc=0,ea=ah.m,oh=8,lh=o(128,M);r:for(;k(lh,0,7,Wm,19);){if(ge(ea,1)){var Gm=2+2*ge(ea,3);if((Bc=2+ge(ea,Gm))>sl)break r}else Bc=sl;for(Xs=0;Xs<sl&&Bc--;){ae(ea);var ch=lh[0+(127&J(ea))];Z(ea,ea.u+ch.g);var ts=ch.value;if(16>ts)sh[Xs++]=ts,ts!=0&&(oh=ts);else{var Vm=ts==16,uh=ts-16,Km=gm[uh],dh=ge(ea,pm[uh])+Km;if(Xs+dh>sl)break r;for(var Jm=Vm?oh:0;0<dh--;)sh[Xs++]=Jm}}Mc=1;break r}Mc||(ah.a=3),il=Mc}(il=il&&!Qi.h)&&(jc=k(Um,$m,8,Ys,Dc)),il&&jc!=0?al=jc:(rl.a=3,al=0)}if(al==0)break n;if(Oi&&mm[_t]==1&&(Oi=Sr[Pt].g==0),Na+=Sr[Pt].g,Pt+=al,3>=_t){var Zs,Uc=pr[0];for(Zs=1;Zs<Dn;++Zs)pr[Zs]>Uc&&(Uc=pr[Zs]);zn+=Uc}}if(Zt.nd=Oi,Zt.Qb=0,Oi&&(Zt.qb=(Ar[3][Vr[3]+0].value<<24|Ar[1][Vr[1]+0].value<<16|Ar[2][Vr[2]+0].value)>>>0,Na==0&&256>Ar[0][Vr[0]+0].value&&(Zt.Qb=1,Zt.qb+=Ar[0][Vr[0]+0].value<<8)),Zt.jc=!Zt.Qb&&6>zn,Zt.jc){var ol,Ri=Zt;for(ol=0;ol<Sa;++ol){var ta=ol,na=Ri.pd[ta],ll=Ri.G[0][Ri.H[0]+ta];256<=ll.value?(na.g=ll.g+256,na.value=ll.value):(na.g=0,na.value=0,ta>>=Yt(ll,8,na),ta>>=Yt(Ri.G[1][Ri.H[1]+ta],16,na),ta>>=Yt(Ri.G[2][Ri.H[2]+ta],0,na),Yt(Ri.G[3][Ri.H[3]+ta],24,na))}}}Fn.vc=Rt,Fn.Wb=$t,Fn.Ya=xr,Fn.yc=_r,Oe=1;break t}Oe=0}if(!(P=Oe)){y.a=3;break e}if(0<he){if(H.ua=1<<he,!$(H.Wa,he)){y.a=1,P=0;break e}}else H.ua=0;var $c=y,hh=R,Ym=D,qc=$c.s,zc=qc.xc;if($c.c=hh,$c.i=Ym,qc.md=Se(hh,zc),qc.wc=zc==0?-1:(1<<zc)-1,v){y.xb=Em;break e}if((ne=i(R*D))==null){y.a=1,P=0;break e}P=(P=hr(y,ne,0,R,D,D,null))&&!B.h;break e}return P?(E!=null?E[0]=ne:(e(ne==null),e(v)),y.$=0,v||tr(H)):tr(H),P}function Ue(u,f){var v=u.c*u.i,y=v+f+16*f;return e(u.c<=f),u.V=i(y),u.V==null?(u.Ta=null,u.Ua=0,u.a=1,0):(u.Ta=u.V,u.Ua=u.Ba+v+f,1)}function ee(u,f){var v=u.C,y=f-v,E=u.V,P=u.Ba+u.c*v;for(e(f<=u.l.o);0<y;){var R=16<y?16:y,D=u.l.ma,B=u.l.width,H=B*R,ne=D.ca,he=D.tb+B*v,W=u.Ta,ie=u.Ua;ii(u,R,E,P),Bd(W,ie,ne,he,H),Sn(D,v,v+R,ne,he,B),y-=R,E+=R*u.c,v+=R}e(v==f),u.C=u.Ma=f}function Ne(){this.ub=this.yd=this.td=this.Rb=0}function Fe(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Wt(){this.Fb=this.Bb=this.Cb=0,this.Zb=i(4),this.Lb=i(4)}function cn(){this.Yb=(function(){var u=[];return(function f(v,y,E){for(var P=E[y],R=0;R<P&&(v.push(E.length>y+1?[]:0),!(E.length<y+1));R++)f(v[R],y+1,E)})(u,0,[3,11]),u})()}function en(){this.jb=i(3),this.Wc=l([4,8],cn),this.Xc=l([4,17],cn)}function Tn(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new i(4),this.od=new i(4)}function un(){this.ld=this.La=this.dd=this.tc=0}function Rr(){this.Na=this.la=0}function $i(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function sn(){this.ad=i(384),this.Za=0,this.Ob=i(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function da(){this.uc=this.M=this.Nb=0,this.wa=Array(new un),this.Y=0,this.ya=Array(new sn),this.aa=0,this.l=new Ga}function ha(){this.y=i(16),this.f=i(8),this.ea=i(8)}function Io(){this.cb=this.a=0,this.sc="",this.m=new I,this.Od=new Ne,this.Kc=new Fe,this.ed=new Tn,this.Qa=new Wt,this.Ic=this.$c=this.Aa=0,this.D=new da,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=o(8,I),this.ia=0,this.pb=o(4,$i),this.Pa=new en,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new ha),this.Hd=0,this.rb=Array(new Rr),this.sb=0,this.wa=Array(new un),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new sn),this.L=this.aa=0,this.gd=l([4,2],un),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function si(u,f){return 0>u?0:u>f?f:u}function Ga(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function fc(){var u=new Io;return u!=null&&(u.a=0,u.sc="OK",u.cb=0,u.Xb=0,Ks||(Ks=Va)),u}function An(u,f,v){return u.a==0&&(u.a=f,u.sc=v,u.cb=0),0}function Oo(u,f,v){return 3<=v&&u[f+0]==157&&u[f+1]==1&&u[f+2]==42}function oi(u,f){if(u==null)return 0;if(u.a=0,u.sc="OK",f==null)return An(u,2,"null VP8Io passed to VP8GetHeaders()");var v=f.data,y=f.w,E=f.ha;if(4>E)return An(u,7,"Truncated header.");var P=v[y+0]|v[y+1]<<8|v[y+2]<<16,R=u.Od;if(R.Rb=!(1&P),R.td=P>>1&7,R.yd=P>>4&1,R.ub=P>>5,3<R.td)return An(u,3,"Incorrect keyframe parameters.");if(!R.yd)return An(u,4,"Frame not displayable.");y+=3,E-=3;var D=u.Kc;if(R.Rb){if(7>E)return An(u,7,"cannot parse picture header");if(!Oo(v,y,E))return An(u,3,"Bad code word");D.c=16383&(v[y+4]<<8|v[y+3]),D.Td=v[y+4]>>6,D.i=16383&(v[y+6]<<8|v[y+5]),D.Ud=v[y+6]>>6,y+=7,E-=7,u.za=D.c+15>>4,u.Ub=D.i+15>>4,f.width=D.c,f.height=D.i,f.Da=0,f.j=0,f.v=0,f.va=f.width,f.o=f.height,f.da=0,f.ib=f.width,f.hb=f.height,f.U=f.width,f.T=f.height,a((P=u.Pa).jb,0,255,P.jb.length),e((P=u.Qa)!=null),P.Cb=0,P.Bb=0,P.Fb=1,a(P.Zb,0,0,P.Zb.length),a(P.Lb,0,0,P.Lb)}if(R.ub>E)return An(u,7,"bad partition length");re(P=u.m,v,y,R.ub),y+=R.ub,E-=R.ub,R.Rb&&(D.Ld=Y(P),D.Kd=Y(P)),D=u.Qa;var B,H=u.Pa;if(e(P!=null),e(D!=null),D.Cb=Y(P),D.Cb){if(D.Bb=Y(P),Y(P)){for(D.Fb=Y(P),B=0;4>B;++B)D.Zb[B]=Y(P)?se(P,7):0;for(B=0;4>B;++B)D.Lb[B]=Y(P)?se(P,6):0}if(D.Bb)for(B=0;3>B;++B)H.jb[B]=Y(P)?ce(P,8):255}else D.Bb=0;if(P.Ka)return An(u,3,"cannot parse segment header");if((D=u.ed).zd=Y(P),D.Tb=ce(P,6),D.wb=ce(P,3),D.Pc=Y(P),D.Pc&&Y(P)){for(H=0;4>H;++H)Y(P)&&(D.vd[H]=se(P,6));for(H=0;4>H;++H)Y(P)&&(D.od[H]=se(P,6))}if(u.L=D.Tb==0?0:D.zd?1:2,P.Ka)return An(u,3,"cannot parse filter header");var ne=E;if(E=B=y,y=B+ne,D=ne,u.Xb=(1<<ce(u.m,2))-1,ne<3*(H=u.Xb))v=7;else{for(B+=3*H,D-=3*H,ne=0;ne<H;++ne){var he=v[E+0]|v[E+1]<<8|v[E+2]<<16;he>D&&(he=D),re(u.Jc[+ne],v,B,he),B+=he,D-=he,E+=3}re(u.Jc[+H],v,B,D),v=B<y?0:5}if(v!=0)return An(u,v,"cannot parse partitions");for(v=ce(B=u.m,7),E=Y(B)?se(B,4):0,y=Y(B)?se(B,4):0,D=Y(B)?se(B,4):0,H=Y(B)?se(B,4):0,B=Y(B)?se(B,4):0,ne=u.Qa,he=0;4>he;++he){if(ne.Cb){var W=ne.Zb[he];ne.Fb||(W+=v)}else{if(0<he){u.pb[he]=u.pb[0];continue}W=v}var ie=u.pb[he];ie.Sc[0]=Oc[si(W+E,127)],ie.Sc[1]=Rc[si(W+0,127)],ie.Eb[0]=2*Oc[si(W+y,127)],ie.Eb[1]=101581*Rc[si(W+D,127)]>>16,8>ie.Eb[1]&&(ie.Eb[1]=8),ie.Qc[0]=Oc[si(W+H,117)],ie.Qc[1]=Rc[si(W+B,127)],ie.lc=W+B}if(!R.Rb)return An(u,4,"Not a key frame.");for(Y(P),R=u.Pa,v=0;4>v;++v){for(E=0;8>E;++E)for(y=0;3>y;++y)for(D=0;11>D;++D)H=oe(P,km[v][E][y][D])?ce(P,8):Sm[v][E][y][D],R.Wc[v][E].Yb[y][D]=H;for(E=0;17>E;++E)R.Xc[v][E]=R.Wc[v][Nm[E]]}return u.kc=Y(P),u.kc&&(u.Bd=ce(P,8)),u.cb=1}function Va(u,f,v,y,E,P,R){var D=f[E].Yb[v];for(v=0;16>E;++E){if(!oe(u,D[v+0]))return E;for(;!oe(u,D[v+1]);)if(D=f[++E].Yb[0],v=0,E==16)return 16;var B=f[E+1].Yb;if(oe(u,D[v+2])){var H=u,ne=0;if(oe(H,(W=D)[(he=v)+3]))if(oe(H,W[he+6])){for(D=0,he=2*(ne=oe(H,W[he+8]))+(W=oe(H,W[he+9+ne])),ne=0,W=wm[he];W[D];++D)ne+=ne+oe(H,W[D]);ne+=3+(8<<he)}else oe(H,W[he+7])?(ne=7+2*oe(H,165),ne+=oe(H,145)):ne=5+oe(H,159);else ne=oe(H,W[he+4])?3+oe(H,W[he+5]):2;D=B[2]}else ne=1,D=B[1];B=R+xm[E],0>(H=u).b&&pe(H);var he,W=H.b,ie=(he=H.Ca>>1)-(H.I>>W)>>31;--H.b,H.Ca+=ie,H.Ca|=1,H.I-=(he+1&ie)<<W,P[B]=((ne^ie)-ie)*y[(0<E)+0]}return 16}function Ro(u){var f=u.rb[u.sb-1];f.la=0,f.Na=0,a(u.zc,0,0,u.zc.length),u.ja=0}function Fr(u,f,v,y,E){E=u[f+v+32*y]+(E>>3),u[f+v+32*y]=-256&E?0>E?0:255:E}function Pn(u,f,v,y,E,P){Fr(u,f,0,v,y+E),Fr(u,f,1,v,y+P),Fr(u,f,2,v,y-P),Fr(u,f,3,v,y-E)}function _i(u){return(20091*u>>16)+u}function Fo(u,f,v,y){var E,P=0,R=i(16);for(E=0;4>E;++E){var D=u[f+0]+u[f+8],B=u[f+0]-u[f+8],H=(35468*u[f+4]>>16)-_i(u[f+12]),ne=_i(u[f+4])+(35468*u[f+12]>>16);R[P+0]=D+ne,R[P+1]=B+H,R[P+2]=B-H,R[P+3]=D-ne,P+=4,f++}for(E=P=0;4>E;++E)D=(u=R[P+0]+4)+R[P+8],B=u-R[P+8],H=(35468*R[P+4]>>16)-_i(R[P+12]),Fr(v,y,0,0,D+(ne=_i(R[P+4])+(35468*R[P+12]>>16))),Fr(v,y,1,0,B+H),Fr(v,y,2,0,B-H),Fr(v,y,3,0,D-ne),P++,y+=32}function pc(u,f,v,y){var E=u[f+0]+4,P=35468*u[f+4]>>16,R=_i(u[f+4]),D=35468*u[f+1]>>16;Pn(v,y,0,E+R,u=_i(u[f+1]),D),Pn(v,y,1,E+P,u,D),Pn(v,y,2,E-P,u,D),Pn(v,y,3,E-R,u,D)}function gc(u,f,v,y,E){Fo(u,f,v,y),E&&Fo(u,f+16,v,y+4)}function li(u,f,v,y){ka(u,f+0,v,y,1),ka(u,f+32,v,y+128,1)}function Do(u,f,v,y){var E;for(u=u[f+0]+4,E=0;4>E;++E)for(f=0;4>f;++f)Fr(v,y,f,E,u)}function jo(u,f,v,y){u[f+0]&&Bt(u,f+0,v,y),u[f+16]&&Bt(u,f+16,v,y+4),u[f+32]&&Bt(u,f+32,v,y+128),u[f+48]&&Bt(u,f+48,v,y+128+4)}function Ka(u,f,v,y){var E,P=i(16);for(E=0;4>E;++E){var R=u[f+0+E]+u[f+12+E],D=u[f+4+E]+u[f+8+E],B=u[f+4+E]-u[f+8+E],H=u[f+0+E]-u[f+12+E];P[0+E]=R+D,P[8+E]=R-D,P[4+E]=H+B,P[12+E]=H-B}for(E=0;4>E;++E)R=(u=P[0+4*E]+3)+P[3+4*E],D=P[1+4*E]+P[2+4*E],B=P[1+4*E]-P[2+4*E],H=u-P[3+4*E],v[y+0]=R+D>>3,v[y+16]=H+B>>3,v[y+32]=R-D>>3,v[y+48]=H-B>>3,y+=64}function fa(u,f,v){var y,E=f-32,P=yr,R=255-u[E-1];for(y=0;y<v;++y){var D,B=P,H=R+u[f-1];for(D=0;D<v;++D)u[f+D]=B[H+u[E+D]];f+=32}}function mc(u,f){fa(u,f,4)}function vc(u,f){fa(u,f,8)}function bc(u,f){fa(u,f,16)}function Ls(u,f){var v;for(v=0;16>v;++v)r(u,f+32*v,u,f-32,16)}function Bo(u,f){var v;for(v=16;0<v;--v)a(u,f,u[f-1],16),f+=32}function zr(u,f,v){var y;for(y=0;16>y;++y)a(f,v+32*y,u,16)}function yc(u,f){var v,y=16;for(v=0;16>v;++v)y+=u[f-1+32*v]+u[f+v-32];zr(y>>5,u,f)}function pa(u,f){var v,y=8;for(v=0;16>v;++v)y+=u[f-1+32*v];zr(y>>4,u,f)}function Cs(u,f){var v,y=8;for(v=0;16>v;++v)y+=u[f+v-32];zr(y>>4,u,f)}function _c(u,f){zr(128,u,f)}function vt(u,f,v){return u+2*f+v+2>>2}function wc(u,f){var v,y=f-32;for(y=new Uint8Array([vt(u[y-1],u[y+0],u[y+1]),vt(u[y+0],u[y+1],u[y+2]),vt(u[y+1],u[y+2],u[y+3]),vt(u[y+2],u[y+3],u[y+4])]),v=0;4>v;++v)r(u,f+32*v,y,0,y.length)}function xc(u,f){var v=u[f-1],y=u[f-1+32],E=u[f-1+64],P=u[f-1+96];be(u,f+0,16843009*vt(u[f-1-32],v,y)),be(u,f+32,16843009*vt(v,y,E)),be(u,f+64,16843009*vt(y,E,P)),be(u,f+96,16843009*vt(E,P,P))}function Sc(u,f){var v,y=4;for(v=0;4>v;++v)y+=u[f+v-32]+u[f-1+32*v];for(y>>=3,v=0;4>v;++v)a(u,f+32*v,y,4)}function wi(u,f){var v=u[f-1+0],y=u[f-1+32],E=u[f-1+64],P=u[f-1-32],R=u[f+0-32],D=u[f+1-32],B=u[f+2-32],H=u[f+3-32];u[f+0+96]=vt(y,E,u[f-1+96]),u[f+1+96]=u[f+0+64]=vt(v,y,E),u[f+2+96]=u[f+1+64]=u[f+0+32]=vt(P,v,y),u[f+3+96]=u[f+2+64]=u[f+1+32]=u[f+0+0]=vt(R,P,v),u[f+3+64]=u[f+2+32]=u[f+1+0]=vt(D,R,P),u[f+3+32]=u[f+2+0]=vt(B,D,R),u[f+3+0]=vt(H,B,D)}function xi(u,f){var v=u[f+1-32],y=u[f+2-32],E=u[f+3-32],P=u[f+4-32],R=u[f+5-32],D=u[f+6-32],B=u[f+7-32];u[f+0+0]=vt(u[f+0-32],v,y),u[f+1+0]=u[f+0+32]=vt(v,y,E),u[f+2+0]=u[f+1+32]=u[f+0+64]=vt(y,E,P),u[f+3+0]=u[f+2+32]=u[f+1+64]=u[f+0+96]=vt(E,P,R),u[f+3+32]=u[f+2+64]=u[f+1+96]=vt(P,R,D),u[f+3+64]=u[f+2+96]=vt(R,D,B),u[f+3+96]=vt(D,B,B)}function Ac(u,f){var v=u[f-1+0],y=u[f-1+32],E=u[f-1+64],P=u[f-1-32],R=u[f+0-32],D=u[f+1-32],B=u[f+2-32],H=u[f+3-32];u[f+0+0]=u[f+1+64]=P+R+1>>1,u[f+1+0]=u[f+2+64]=R+D+1>>1,u[f+2+0]=u[f+3+64]=D+B+1>>1,u[f+3+0]=B+H+1>>1,u[f+0+96]=vt(E,y,v),u[f+0+64]=vt(y,v,P),u[f+0+32]=u[f+1+96]=vt(v,P,R),u[f+1+32]=u[f+2+96]=vt(P,R,D),u[f+2+32]=u[f+3+96]=vt(R,D,B),u[f+3+32]=vt(D,B,H)}function kc(u,f){var v=u[f+0-32],y=u[f+1-32],E=u[f+2-32],P=u[f+3-32],R=u[f+4-32],D=u[f+5-32],B=u[f+6-32],H=u[f+7-32];u[f+0+0]=v+y+1>>1,u[f+1+0]=u[f+0+64]=y+E+1>>1,u[f+2+0]=u[f+1+64]=E+P+1>>1,u[f+3+0]=u[f+2+64]=P+R+1>>1,u[f+0+32]=vt(v,y,E),u[f+1+32]=u[f+0+96]=vt(y,E,P),u[f+2+32]=u[f+1+96]=vt(E,P,R),u[f+3+32]=u[f+2+96]=vt(P,R,D),u[f+3+64]=vt(R,D,B),u[f+3+96]=vt(D,B,H)}function Ja(u,f){var v=u[f-1+0],y=u[f-1+32],E=u[f-1+64],P=u[f-1+96];u[f+0+0]=v+y+1>>1,u[f+2+0]=u[f+0+32]=y+E+1>>1,u[f+2+32]=u[f+0+64]=E+P+1>>1,u[f+1+0]=vt(v,y,E),u[f+3+0]=u[f+1+32]=vt(y,E,P),u[f+3+32]=u[f+1+64]=vt(E,P,P),u[f+3+64]=u[f+2+64]=u[f+0+96]=u[f+1+96]=u[f+2+96]=u[f+3+96]=P}function Ts(u,f){var v=u[f-1+0],y=u[f-1+32],E=u[f-1+64],P=u[f-1+96],R=u[f-1-32],D=u[f+0-32],B=u[f+1-32],H=u[f+2-32];u[f+0+0]=u[f+2+32]=v+R+1>>1,u[f+0+32]=u[f+2+64]=y+v+1>>1,u[f+0+64]=u[f+2+96]=E+y+1>>1,u[f+0+96]=P+E+1>>1,u[f+3+0]=vt(D,B,H),u[f+2+0]=vt(R,D,B),u[f+1+0]=u[f+3+32]=vt(v,R,D),u[f+1+32]=u[f+3+64]=vt(y,v,R),u[f+1+64]=u[f+3+96]=vt(E,y,v),u[f+1+96]=vt(P,E,y)}function ga(u,f){var v;for(v=0;8>v;++v)r(u,f+32*v,u,f-32,8)}function Nc(u,f){var v;for(v=0;8>v;++v)a(u,f,u[f-1],8),f+=32}function Si(u,f,v){var y;for(y=0;8>y;++y)a(f,v+32*y,u,8)}function Ec(u,f){var v,y=8;for(v=0;8>v;++v)y+=u[f+v-32]+u[f-1+32*v];Si(y>>4,u,f)}function Ps(u,f){var v,y=4;for(v=0;8>v;++v)y+=u[f+v-32];Si(y>>3,u,f)}function Is(u,f){var v,y=4;for(v=0;8>v;++v)y+=u[f-1+32*v];Si(y>>3,u,f)}function Mo(u,f){Si(128,u,f)}function Ai(u,f,v){var y=u[f-v],E=u[f+0],P=3*(E-y)+Lc[1020+u[f-2*v]-u[f+v]],R=Vo[112+(P+4>>3)];u[f-v]=yr[255+y+Vo[112+(P+3>>3)]],u[f+0]=yr[255+E-R]}function Os(u,f,v,y){var E=u[f+0],P=u[f+v];return Br[255+u[f-2*v]-u[f-v]]>y||Br[255+P-E]>y}function Ya(u,f,v,y){return 4*Br[255+u[f-v]-u[f+0]]+Br[255+u[f-2*v]-u[f+v]]<=y}function Rs(u,f,v,y,E){var P=u[f-3*v],R=u[f-2*v],D=u[f-v],B=u[f+0],H=u[f+v],ne=u[f+2*v],he=u[f+3*v];return 4*Br[255+D-B]+Br[255+R-H]>y?0:Br[255+u[f-4*v]-P]<=E&&Br[255+P-R]<=E&&Br[255+R-D]<=E&&Br[255+he-ne]<=E&&Br[255+ne-H]<=E&&Br[255+H-B]<=E}function ma(u,f,v,y){var E=2*y+1;for(y=0;16>y;++y)Ya(u,f+y,v,E)&&Ai(u,f+y,v)}function Fs(u,f,v,y){var E=2*y+1;for(y=0;16>y;++y)Ya(u,f+y*v,1,E)&&Ai(u,f+y*v,1)}function Uo(u,f,v,y){var E;for(E=3;0<E;--E)ma(u,f+=4*v,v,y)}function $o(u,f,v,y){var E;for(E=3;0<E;--E)Fs(u,f+=4,v,y)}function ki(u,f,v,y,E,P,R,D){for(P=2*P+1;0<E--;){if(Rs(u,f,v,P,R))if(Os(u,f,v,D))Ai(u,f,v);else{var B=u,H=f,ne=v,he=B[H-2*ne],W=B[H-ne],ie=B[H+0],ue=B[H+ne],ve=B[H+2*ne],de=27*(we=Lc[1020+3*(ie-W)+Lc[1020+he-ue]])+63>>7,ye=18*we+63>>7,we=9*we+63>>7;B[H-3*ne]=yr[255+B[H-3*ne]+we],B[H-2*ne]=yr[255+he+ye],B[H-ne]=yr[255+W+de],B[H+0]=yr[255+ie-de],B[H+ne]=yr[255+ue-ye],B[H+2*ne]=yr[255+ve-we]}f+=y}}function Ni(u,f,v,y,E,P,R,D){for(P=2*P+1;0<E--;){if(Rs(u,f,v,P,R))if(Os(u,f,v,D))Ai(u,f,v);else{var B=u,H=f,ne=v,he=B[H-ne],W=B[H+0],ie=B[H+ne],ue=Vo[112+(4+(ve=3*(W-he))>>3)],ve=Vo[112+(ve+3>>3)],de=ue+1>>1;B[H-2*ne]=yr[255+B[H-2*ne]+de],B[H-ne]=yr[255+he+ve],B[H+0]=yr[255+W-ue],B[H+ne]=yr[255+ie-de]}f+=y}}function qo(u,f,v,y,E,P){ki(u,f,v,1,16,y,E,P)}function va(u,f,v,y,E,P){ki(u,f,1,v,16,y,E,P)}function zo(u,f,v,y,E,P){var R;for(R=3;0<R;--R)Ni(u,f+=4*v,v,1,16,y,E,P)}function g(u,f,v,y,E,P){var R;for(R=3;0<R;--R)Ni(u,f+=4,1,v,16,y,E,P)}function N(u,f,v,y,E,P,R,D){ki(u,f,E,1,8,P,R,D),ki(v,y,E,1,8,P,R,D)}function G(u,f,v,y,E,P,R,D){ki(u,f,1,E,8,P,R,D),ki(v,y,1,E,8,P,R,D)}function Q(u,f,v,y,E,P,R,D){Ni(u,f+4*E,E,1,8,P,R,D),Ni(v,y+4*E,E,1,8,P,R,D)}function le(u,f,v,y,E,P,R,D){Ni(u,f+4,1,E,8,P,R,D),Ni(v,y+4,1,E,8,P,R,D)}function _e(){this.ba=new kt,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Ft,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Ae(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function $e(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Je(){this.ua=0,this.Wa=new ht,this.vb=new ht,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new U,this.yc=new M}function gt(){this.xb=this.a=0,this.l=new Ga,this.ca=new kt,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new z,this.Pb=0,this.wd=new z,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Je,this.ab=0,this.gc=o(4,$e),this.Oc=0}function wt(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Ga,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Ot(u,f,v,y,E,P,R){for(u=u==null?0:u[f+0],f=0;f<R;++f)E[P+f]=u+v[y+f]&255,u=E[P+f]}function on(u,f,v,y,E,P,R){var D;if(u==null)Ot(null,null,v,y,E,P,R);else for(D=0;D<R;++D)E[P+D]=u[f+D]+v[y+D]&255}function kn(u,f,v,y,E,P,R){if(u==null)Ot(null,null,v,y,E,P,R);else{var D,B=u[f+0],H=B,ne=B;for(D=0;D<R;++D)H=ne+(B=u[f+D])-H,ne=v[y+D]+(-256&H?0>H?0:255:H)&255,H=B,E[P+D]=ne}}function Xt(u,f,v,y){var E=f.width,P=f.o;if(e(u!=null&&f!=null),0>v||0>=y||v+y>P)return null;if(!u.Cc){if(u.ga==null){var R;if(u.ga=new wt,(R=u.ga==null)||(R=f.width*f.o,e(u.Gb.length==0),u.Gb=i(R),u.Uc=0,u.Gb==null?R=0:(u.mb=u.Gb,u.nb=u.Uc,u.rc=null,R=1),R=!R),!R){R=u.ga;var D=u.Fa,B=u.P,H=u.qc,ne=u.mb,he=u.nb,W=B+1,ie=H-1,ue=R.l;if(e(D!=null&&ne!=null&&f!=null),Zi[0]=null,Zi[1]=Ot,Zi[2]=on,Zi[3]=kn,R.ca=ne,R.tb=he,R.c=f.width,R.i=f.height,e(0<R.c&&0<R.i),1>=H)f=0;else if(R.$a=3&D[B+0],R.Z=D[B+0]>>2&3,R.Lc=D[B+0]>>4&3,B=D[B+0]>>6&3,0>R.$a||1<R.$a||4<=R.Z||1<R.Lc||B)f=0;else if(ue.put=rt,ue.ac=Tr,ue.bc=mr,ue.ma=R,ue.width=f.width,ue.height=f.height,ue.Da=f.Da,ue.v=f.v,ue.va=f.va,ue.j=f.j,ue.o=f.o,R.$a)e:{e(R.$a==1),f=ai();t:for(;;){if(f==null){f=0;break e}if(e(R!=null),R.mc=f,f.c=R.c,f.i=R.i,f.l=R.l,f.l.ma=R,f.l.width=R.c,f.l.height=R.i,f.a=0,fe(f.m,D,W,ie),!Or(R.c,R.i,1,f,null)||(f.ab==1&&f.gc[0].hc==3&&ur(f.s)?(R.ic=1,D=f.c*f.i,f.Ta=null,f.Ua=0,f.V=i(D),f.Ba=0,f.V==null?(f.a=1,f=0):f=1):(R.ic=0,f=Ue(f,R.c)),!f))break t;f=1;break e}R.mc=null,f=0}else f=ie>=R.c*R.i;R=!f}if(R)return null;u.ga.Lc!=1?u.Ga=0:y=P-v}e(u.ga!=null),e(v+y<=P);e:{if(f=(D=u.ga).c,P=D.l.o,D.$a==0){if(W=u.rc,ie=u.Vc,ue=u.Fa,B=u.P+1+v*f,H=u.mb,ne=u.nb+v*f,e(B<=u.P+u.qc),D.Z!=0)for(e(Zi[D.Z]!=null),R=0;R<y;++R)Zi[D.Z](W,ie,ue,B,H,ne,f),W=H,ie=ne,ne+=f,B+=f;else for(R=0;R<y;++R)r(H,ne,ue,B,f),W=H,ie=ne,ne+=f,B+=f;u.rc=W,u.Vc=ie}else{if(e(D.mc!=null),f=v+y,e((R=D.mc)!=null),e(f<=R.i),R.C>=f)f=1;else if(D.ic||Hr(),D.ic){D=R.V,W=R.Ba,ie=R.c;var ve=R.i,de=(ue=1,B=R.$/ie,H=R.$%ie,ne=R.m,he=R.s,R.$),ye=ie*ve,we=ie*f,Ee=he.wc,ke=de<we?xn(he,H,B):null;e(de<=ye),e(f<=ve),e(ur(he));t:for(;;){for(;!ne.h&&de<we;){if(H&Ee||(ke=xn(he,H,B)),e(ke!=null),ae(ne),256>(ve=It(ke.G[0],ke.H[0],ne)))D[W+de]=ve,++de,++H>=ie&&(H=0,++B<=f&&!(B%16)&&dr(R,B));else{if(!(280>ve)){ue=0;break t}ve=er(ve-256,ne);var Ze,Be=It(ke.G[4],ke.H[4],ne);if(ae(ne),!(de>=(Be=cr(ie,Be=er(Be,ne)))&&ye-de>=ve)){ue=0;break t}for(Ze=0;Ze<ve;++Ze)D[W+de+Ze]=D[W+de+Ze-Be];for(de+=ve,H+=ve;H>=ie;)H-=ie,++B<=f&&!(B%16)&&dr(R,B);de<we&&H&Ee&&(ke=xn(he,H,B))}e(ne.h==X(ne))}dr(R,B>f?f:B);break t}!ue||ne.h&&de<ye?(ue=0,R.a=ne.h?5:3):R.$=de,f=ue}else f=hr(R,R.V,R.Ba,R.c,R.i,f,ee);if(!f){y=0;break e}}v+y>=P&&(u.Cc=1),y=1}if(!y)return null;if(u.Cc&&((y=u.ga)!=null&&(y.mc=null),u.ga=null,0<u.Ga))return alert("todo:WebPDequantizeLevels"),null}return u.nb+v*E}function In(u,f,v,y,E,P){for(;0<E--;){var R,D=u,B=f+(v?1:0),H=u,ne=f+(v?0:3);for(R=0;R<y;++R){var he=H[ne+4*R];he!=255&&(he*=32897,D[B+4*R+0]=D[B+4*R+0]*he>>23,D[B+4*R+1]=D[B+4*R+1]*he>>23,D[B+4*R+2]=D[B+4*R+2]*he>>23)}f+=P}}function Nn(u,f,v,y,E){for(;0<y--;){var P;for(P=0;P<v;++P){var R=u[f+2*P+0],D=15&(H=u[f+2*P+1]),B=4369*D,H=(240&H|H>>4)*B>>16;u[f+2*P+0]=(240&R|R>>4)*B>>16&240|(15&R|R<<4)*B>>16>>4&15,u[f+2*P+1]=240&H|D}f+=E}}function Mn(u,f,v,y,E,P,R,D){var B,H,ne=255;for(H=0;H<E;++H){for(B=0;B<y;++B){var he=u[f+B];P[R+4*B]=he,ne&=he}f+=v,R+=D}return ne!=255}function Ei(u,f,v,y,E){var P;for(P=0;P<E;++P)v[y+P]=u[f+P]>>8}function Hr(){Vs=In,Dd=Nn,jd=Mn,Bd=Ei}function Li(u,f,v){F[u]=function(y,E,P,R,D,B,H,ne,he,W,ie,ue,ve,de,ye,we,Ee){var ke,Ze=Ee-1>>1,Be=D[B+0]|H[ne+0]<<16,xt=he[W+0]|ie[ue+0]<<16;e(y!=null);var Ge=3*Be+xt+131074>>2;for(f(y[E+0],255&Ge,Ge>>16,ve,de),P!=null&&(Ge=3*xt+Be+131074>>2,f(P[R+0],255&Ge,Ge>>16,ye,we)),ke=1;ke<=Ze;++ke){var Tt=D[B+ke]|H[ne+ke]<<16,Rn=he[W+ke]|ie[ue+ke]<<16,St=Be+Tt+xt+Rn+524296,Ve=St+2*(Tt+xt)>>3;Ge=Ve+Be>>1,Be=(St=St+2*(Be+Rn)>>3)+Tt>>1,f(y[E+2*ke-1],255&Ge,Ge>>16,ve,de+(2*ke-1)*v),f(y[E+2*ke-0],255&Be,Be>>16,ve,de+(2*ke-0)*v),P!=null&&(Ge=St+xt>>1,Be=Ve+Rn>>1,f(P[R+2*ke-1],255&Ge,Ge>>16,ye,we+(2*ke-1)*v),f(P[R+2*ke+0],255&Be,Be>>16,ye,we+(2*ke+0)*v)),Be=Tt,xt=Rn}1&Ee||(Ge=3*Be+xt+131074>>2,f(y[E+Ee-1],255&Ge,Ge>>16,ve,de+(Ee-1)*v),P!=null&&(Ge=3*xt+Be+131074>>2,f(P[R+Ee-1],255&Ge,Ge>>16,ye,we+(Ee-1)*v)))}}function Ds(){Mr[Ko]=Lm,Mr[Jo]=Jd,Mr[Hd]=Cm,Mr[Yo]=Yd,Mr[Xo]=Xd,Mr[Cc]=Zd,Mr[Wd]=Tm,Mr[Tc]=Jd,Mr[Pc]=Yd,Mr[Zo]=Xd,Mr[Ic]=Zd}function Xa(u){return u&-16384?0>u?0:255:u>>Pm}function qi(u,f){return Xa((19077*u>>8)+(26149*f>>8)-14234)}function ba(u,f,v){return Xa((19077*u>>8)-(6419*f>>8)-(13320*v>>8)+8708)}function ya(u,f){return Xa((19077*u>>8)+(33050*f>>8)-17685)}function zi(u,f,v,y,E){y[E+0]=qi(u,v),y[E+1]=ba(u,f,v),y[E+2]=ya(u,f)}function Un(u,f,v,y,E){y[E+0]=ya(u,f),y[E+1]=ba(u,f,v),y[E+2]=qi(u,v)}function _a(u,f,v,y,E){var P=ba(u,f,v);f=P<<3&224|ya(u,f)>>3,y[E+0]=248&qi(u,v)|P>>5,y[E+1]=f}function wa(u,f,v,y,E){var P=240&ya(u,f)|15;y[E+0]=240&qi(u,v)|ba(u,f,v)>>4,y[E+1]=P}function js(u,f,v,y,E){y[E+0]=255,zi(u,f,v,y,E+1)}function Bs(u,f,v,y,E){Un(u,f,v,y,E),y[E+3]=255}function nr(u,f,v,y,E){zi(u,f,v,y,E),y[E+3]=255}function Ci(u,f,v){F[u]=function(y,E,P,R,D,B,H,ne,he){for(var W=ne+(-2&he)*v;ne!=W;)f(y[E+0],P[R+0],D[B+0],H,ne),f(y[E+1],P[R+0],D[B+0],H,ne+v),E+=2,++R,++B,ne+=2*v;1&he&&f(y[E+0],P[R+0],D[B+0],H,ne)}}function Za(u,f,v){return v==0?u==0?f==0?6:5:f==0?4:0:v}function Ho(u,f,v,y,E){switch(u>>>30){case 3:ka(f,v,y,E,0);break;case 2:jr(f,v,y,E);break;case 1:Bt(f,v,y,E)}}function Dr(u,f){var v,y,E=f.M,P=f.Nb,R=u.oc,D=u.pc+40,B=u.oc,H=u.pc+584,ne=u.oc,he=u.pc+600;for(v=0;16>v;++v)R[D+32*v-1]=129;for(v=0;8>v;++v)B[H+32*v-1]=129,ne[he+32*v-1]=129;for(0<E?R[D-1-32]=B[H-1-32]=ne[he-1-32]=129:(a(R,D-32-1,127,21),a(B,H-32-1,127,9),a(ne,he-32-1,127,9)),y=0;y<u.za;++y){var W=f.ya[f.aa+y];if(0<y){for(v=-1;16>v;++v)r(R,D+32*v-4,R,D+32*v+12,4);for(v=-1;8>v;++v)r(B,H+32*v-4,B,H+32*v+4,4),r(ne,he+32*v-4,ne,he+32*v+4,4)}var ie=u.Gd,ue=u.Hd+y,ve=W.ad,de=W.Hc;if(0<E&&(r(R,D-32,ie[ue].y,0,16),r(B,H-32,ie[ue].f,0,8),r(ne,he-32,ie[ue].ea,0,8)),W.Za){var ye=R,we=D-32+16;for(0<E&&(y>=u.za-1?a(ye,we,ie[ue].y[15],4):r(ye,we,ie[ue+1].y,0,4)),v=0;4>v;v++)ye[we+128+v]=ye[we+256+v]=ye[we+384+v]=ye[we+0+v];for(v=0;16>v;++v,de<<=2)ye=R,we=D+eh[v],Wr[W.Ob[v]](ye,we),Ho(de,ve,16*+v,ye,we)}else if(ye=Za(y,E,W.Ob[0]),Xi[ye](R,D),de!=0)for(v=0;16>v;++v,de<<=2)Ho(de,ve,16*+v,R,D+eh[v]);for(v=W.Gc,ye=Za(y,E,W.Dd),Ii[ye](B,H),Ii[ye](ne,he),de=ve,ye=B,we=H,255&(W=0|v)&&(170&W?di(de,256,ye,we):Gt(de,256,ye,we)),W=ne,de=he,255&(v>>=8)&&(170&v?di(ve,320,W,de):Gt(ve,320,W,de)),E<u.Ub-1&&(r(ie[ue].y,0,R,D+480,16),r(ie[ue].f,0,B,H+224,8),r(ie[ue].ea,0,ne,he+224,8)),v=8*P*u.B,ie=u.sa,ue=u.ta+16*y+16*P*u.R,ve=u.qa,W=u.ra+8*y+v,de=u.Ha,ye=u.Ia+8*y+v,v=0;16>v;++v)r(ie,ue+v*u.R,R,D+32*v,16);for(v=0;8>v;++v)r(ve,W+v*u.B,B,H+32*v,8),r(de,ye+v*u.B,ne,he+32*v,8)}}function xa(u,f,v,y,E,P,R,D,B){var H=[0],ne=[0],he=0,W=B!=null?B.kd:0,ie=B??new Ae;if(u==null||12>v)return 7;ie.data=u,ie.w=f,ie.ha=v,f=[f],v=[v],ie.gb=[ie.gb];e:{var ue=f,ve=v,de=ie.gb;if(e(u!=null),e(ve!=null),e(de!=null),de[0]=0,12<=ve[0]&&!n(u,ue[0],"RIFF")){if(n(u,ue[0]+8,"WEBP")){de=3;break e}var ye=je(u,ue[0]+4);if(12>ye||4294967286<ye){de=3;break e}if(W&&ye>ve[0]-8){de=7;break e}de[0]=ye,ue[0]+=12,ve[0]-=12}de=0}if(de!=0)return de;for(ye=0<ie.gb[0],v=v[0];;){e:{var we=u;ve=f,de=v;var Ee=H,ke=ne,Ze=ue=[0];if((Ge=he=[he])[0]=0,8>de[0])de=7;else{if(!n(we,ve[0],"VP8X")){if(je(we,ve[0]+4)!=10){de=3;break e}if(18>de[0]){de=7;break e}var Be=je(we,ve[0]+8),xt=1+Te(we,ve[0]+12);if(2147483648<=xt*(we=1+Te(we,ve[0]+15))){de=3;break e}Ze!=null&&(Ze[0]=Be),Ee!=null&&(Ee[0]=xt),ke!=null&&(ke[0]=we),ve[0]+=18,de[0]-=18,Ge[0]=1}de=0}}if(he=he[0],ue=ue[0],de!=0)return de;if(ve=!!(2&ue),!ye&&he)return 3;if(P!=null&&(P[0]=!!(16&ue)),R!=null&&(R[0]=ve),D!=null&&(D[0]=0),R=H[0],ue=ne[0],he&&ve&&B==null){de=0;break}if(4>v){de=7;break}if(ye&&he||!ye&&!he&&!n(u,f[0],"ALPH")){v=[v],ie.na=[ie.na],ie.P=[ie.P],ie.Sa=[ie.Sa];e:{Be=u,de=f,ye=v;var Ge=ie.gb;Ee=ie.na,ke=ie.P,Ze=ie.Sa,xt=22,e(Be!=null),e(ye!=null),we=de[0];var Tt=ye[0];for(e(Ee!=null),e(Ze!=null),Ee[0]=null,ke[0]=null,Ze[0]=0;;){if(de[0]=we,ye[0]=Tt,8>Tt){de=7;break e}var Rn=je(Be,we+4);if(4294967286<Rn){de=3;break e}var St=8+Rn+1&-2;if(xt+=St,0<Ge&&xt>Ge){de=3;break e}if(!n(Be,we,"VP8 ")||!n(Be,we,"VP8L")){de=0;break e}if(Tt[0]<St){de=7;break e}n(Be,we,"ALPH")||(Ee[0]=Be,ke[0]=we+8,Ze[0]=Rn),we+=St,Tt-=St}}if(v=v[0],ie.na=ie.na[0],ie.P=ie.P[0],ie.Sa=ie.Sa[0],de!=0)break}v=[v],ie.Ja=[ie.Ja],ie.xa=[ie.xa];e:if(Ge=u,de=f,ye=v,Ee=ie.gb[0],ke=ie.Ja,Ze=ie.xa,Be=de[0],we=!n(Ge,Be,"VP8 "),xt=!n(Ge,Be,"VP8L"),e(Ge!=null),e(ye!=null),e(ke!=null),e(Ze!=null),8>ye[0])de=7;else{if(we||xt){if(Ge=je(Ge,Be+4),12<=Ee&&Ge>Ee-12){de=3;break e}if(W&&Ge>ye[0]-8){de=7;break e}ke[0]=Ge,de[0]+=8,ye[0]-=8,Ze[0]=xt}else Ze[0]=5<=ye[0]&&Ge[Be+0]==47&&!(Ge[Be+4]>>5),ke[0]=ye[0];de=0}if(v=v[0],ie.Ja=ie.Ja[0],ie.xa=ie.xa[0],f=f[0],de!=0)break;if(4294967286<ie.Ja)return 3;if(D==null||ve||(D[0]=ie.xa?2:1),R=[R],ue=[ue],ie.xa){if(5>v){de=7;break}D=R,W=ue,ve=P,u==null||5>v?u=0:5<=v&&u[f+0]==47&&!(u[f+4]>>5)?(ye=[0],Ge=[0],Ee=[0],fe(ke=new z,u,f,v),Pr(ke,ye,Ge,Ee)?(D!=null&&(D[0]=ye[0]),W!=null&&(W[0]=Ge[0]),ve!=null&&(ve[0]=Ee[0]),u=1):u=0):u=0}else{if(10>v){de=7;break}D=ue,u==null||10>v||!Oo(u,f+3,v-3)?u=0:(W=u[f+0]|u[f+1]<<8|u[f+2]<<16,ve=16383&(u[f+7]<<8|u[f+6]),u=16383&(u[f+9]<<8|u[f+8]),1&W||3<(W>>1&7)||!(W>>4&1)||W>>5>=ie.Ja||!ve||!u?u=0:(R&&(R[0]=ve),D&&(D[0]=u),u=1))}if(!u||(R=R[0],ue=ue[0],he&&(H[0]!=R||ne[0]!=ue)))return 3;B!=null&&(B[0]=ie,B.offset=f-B.w,e(4294967286>f-B.w),e(B.offset==B.ha-v));break}return de==0||de==7&&he&&B==null?(P!=null&&(P[0]|=ie.na!=null&&0<ie.na.length),y!=null&&(y[0]=R),E!=null&&(E[0]=ue),0):de}function Ms(u,f,v){var y=f.width,E=f.height,P=0,R=0,D=y,B=E;if(f.Da=u!=null&&0<u.Da,f.Da&&(D=u.cd,B=u.bd,P=u.v,R=u.j,11>v||(P&=-2,R&=-2),0>P||0>R||0>=D||0>=B||P+D>y||R+B>E))return 0;if(f.v=P,f.j=R,f.va=P+D,f.o=R+B,f.U=D,f.T=B,f.da=u!=null&&0<u.da,f.da){if(!He(D,B,v=[u.ib],P=[u.hb]))return 0;f.ib=v[0],f.hb=P[0]}return f.ob=u!=null&&u.ob,f.Kb=u==null||!u.Sd,f.da&&(f.ob=f.ib<3*y/4&&f.hb<3*E/4,f.Kb=0),1}function Us(u){if(u==null)return 2;if(11>u.S){var f=u.f.RGBA;f.fb+=(u.height-1)*f.A,f.A=-f.A}else f=u.f.kb,u=u.height,f.O+=(u-1)*f.fa,f.fa=-f.fa,f.N+=(u-1>>1)*f.Ab,f.Ab=-f.Ab,f.W+=(u-1>>1)*f.Db,f.Db=-f.Db,f.F!=null&&(f.J+=(u-1)*f.lb,f.lb=-f.lb);return 0}function Hi(u,f,v,y){if(y==null||0>=u||0>=f)return 2;if(v!=null){if(v.Da){var E=v.cd,P=v.bd,R=-2&v.v,D=-2&v.j;if(0>R||0>D||0>=E||0>=P||R+E>u||D+P>f)return 2;u=E,f=P}if(v.da){if(!He(u,f,E=[v.ib],P=[v.hb]))return 2;u=E[0],f=P[0]}}y.width=u,y.height=f;e:{var B=y.width,H=y.height;if(u=y.S,0>=B||0>=H||!(u>=Ko&&13>u))u=2;else{if(0>=y.Rd&&y.sd==null){R=P=E=f=0;var ne=(D=B*th[u])*H;if(11>u||(P=(H+1)/2*(f=(B+1)/2),u==12&&(R=(E=B)*H)),(H=i(ne+2*P+R))==null){u=1;break e}y.sd=H,11>u?((B=y.f.RGBA).eb=H,B.fb=0,B.A=D,B.size=ne):((B=y.f.kb).y=H,B.O=0,B.fa=D,B.Fd=ne,B.f=H,B.N=0+ne,B.Ab=f,B.Cd=P,B.ea=H,B.W=0+ne+P,B.Db=f,B.Ed=P,u==12&&(B.F=H,B.J=0+ne+2*P),B.Tc=R,B.lb=E)}if(f=1,E=y.S,P=y.width,R=y.height,E>=Ko&&13>E)if(11>E)u=y.f.RGBA,f&=(D=Math.abs(u.A))*(R-1)+P<=u.size,f&=D>=P*th[E],f&=u.eb!=null;else{u=y.f.kb,D=(P+1)/2,ne=(R+1)/2,B=Math.abs(u.fa),H=Math.abs(u.Ab);var he=Math.abs(u.Db),W=Math.abs(u.lb),ie=W*(R-1)+P;f&=B*(R-1)+P<=u.Fd,f&=H*(ne-1)+D<=u.Cd,f=(f&=he*(ne-1)+D<=u.Ed)&B>=P&H>=D&he>=D,f&=u.y!=null,f&=u.f!=null,f&=u.ea!=null,E==12&&(f&=W>=P,f&=ie<=u.Tc,f&=u.F!=null)}else f=0;u=f?0:2}}return u!=0||v!=null&&v.fd&&(u=Us(y)),u}var Sa=64,vr=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],br=24,Wi=32,Ti=8,Gi=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Re("Predictor0","PredictorAdd0"),F.Predictor0=function(){return 4278190080},F.Predictor1=function(u){return u},F.Predictor2=function(u,f,v){return f[v+0]},F.Predictor3=function(u,f,v){return f[v+1]},F.Predictor4=function(u,f,v){return f[v-1]},F.Predictor5=function(u,f,v){return Ie(Ie(u,f[v+1]),f[v+0])},F.Predictor6=function(u,f,v){return Ie(u,f[v-1])},F.Predictor7=function(u,f,v){return Ie(u,f[v+0])},F.Predictor8=function(u,f,v){return Ie(f[v-1],f[v+0])},F.Predictor9=function(u,f,v){return Ie(f[v+0],f[v+1])},F.Predictor10=function(u,f,v){return Ie(Ie(u,f[v-1]),Ie(f[v+0],f[v+1]))},F.Predictor11=function(u,f,v){var y=f[v+0];return 0>=at(y>>24&255,u>>24&255,(f=f[v-1])>>24&255)+at(y>>16&255,u>>16&255,f>>16&255)+at(y>>8&255,u>>8&255,f>>8&255)+at(255&y,255&u,255&f)?y:u},F.Predictor12=function(u,f,v){var y=f[v+0];return(it((u>>24&255)+(y>>24&255)-((f=f[v-1])>>24&255))<<24|it((u>>16&255)+(y>>16&255)-(f>>16&255))<<16|it((u>>8&255)+(y>>8&255)-(f>>8&255))<<8|it((255&u)+(255&y)-(255&f)))>>>0},F.Predictor13=function(u,f,v){var y=f[v-1];return(nt((u=Ie(u,f[v+0]))>>24&255,y>>24&255)<<24|nt(u>>16&255,y>>16&255)<<16|nt(u>>8&255,y>>8&255)<<8|nt(255&u,255&y))>>>0};var $s=F.PredictorAdd0;F.PredictorAdd1=ut,Re("Predictor2","PredictorAdd2"),Re("Predictor3","PredictorAdd3"),Re("Predictor4","PredictorAdd4"),Re("Predictor5","PredictorAdd5"),Re("Predictor6","PredictorAdd6"),Re("Predictor7","PredictorAdd7"),Re("Predictor8","PredictorAdd8"),Re("Predictor9","PredictorAdd9"),Re("Predictor10","PredictorAdd10"),Re("Predictor11","PredictorAdd11"),Re("Predictor12","PredictorAdd12"),Re("Predictor13","PredictorAdd13");var Qa=F.PredictorAdd2;We("ColorIndexInverseTransform","MapARGB","32b",function(u){return u>>8&255},function(u){return u}),We("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(u){return u},function(u){return u>>8&255});var gn,Wo=F.ColorIndexInverseTransform,ci=F.MapARGB,ui=F.VP8LColorIndexInverseTransformAlpha,qs=F.MapAlpha,zs=F.VP8LPredictorsAdd=[];zs.length=16,(F.VP8LPredictors=[]).length=16,(F.VP8LPredictorsAdd_C=[]).length=16,(F.VP8LPredictors_C=[]).length=16;var Hs,Ws,Vi,Ki,Ji,Aa,Yi,ka,jr,di,Bt,Gt,mn,On,Pi,Gs,es,Go,Td,Pd,Id,Od,Rd,Fd,Vs,Dd,jd,Bd,Md=i(511),Ud=i(2041),$d=i(225),qd=i(767),zd=0,Lc=Ud,Vo=$d,yr=qd,Br=Md,Ko=0,Jo=1,Hd=2,Yo=3,Xo=4,Cc=5,Wd=6,Tc=7,Pc=8,Zo=9,Ic=10,pm=[2,3,7],gm=[3,3,11],Gd=[280,256,256,256,40],mm=[0,1,1,1,0],vm=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],bm=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],ym=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],_m=8,Oc=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Rc=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Ks=null,wm=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],xm=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Vd=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Sm=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Am=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],km=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Nm=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Xi=[],Wr=[],Ii=[],Em=1,Kd=2,Zi=[],Mr=[];Li("UpsampleRgbLinePair",zi,3),Li("UpsampleBgrLinePair",Un,3),Li("UpsampleRgbaLinePair",nr,4),Li("UpsampleBgraLinePair",Bs,4),Li("UpsampleArgbLinePair",js,4),Li("UpsampleRgba4444LinePair",wa,2),Li("UpsampleRgb565LinePair",_a,2);var Lm=F.UpsampleRgbLinePair,Cm=F.UpsampleBgrLinePair,Jd=F.UpsampleRgbaLinePair,Yd=F.UpsampleBgraLinePair,Xd=F.UpsampleArgbLinePair,Zd=F.UpsampleRgba4444LinePair,Tm=F.UpsampleRgb565LinePair,Qo=16,el=1<<Qo-1,Js=-227,Fc=482,Pm=6,Qd=0,Im=i(256),Om=i(256),Rm=i(256),Fm=i(256),Dm=i(Fc-Js),jm=i(Fc-Js);Ci("YuvToRgbRow",zi,3),Ci("YuvToBgrRow",Un,3),Ci("YuvToRgbaRow",nr,4),Ci("YuvToBgraRow",Bs,4),Ci("YuvToArgbRow",js,4),Ci("YuvToRgba4444Row",wa,2),Ci("YuvToRgb565Row",_a,2);var eh=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],tl=[0,2,8],Bm=[8,7,6,4,4,2,2,2,1,1,1,1],Mm=1;this.WebPDecodeRGBA=function(u,f,v,y,E){var P=Jo,R=new _e,D=new kt;R.ba=D,D.S=P,D.width=[D.width],D.height=[D.height];var B=D.width,H=D.height,ne=new tt;if(ne==null||u==null)var he=2;else e(ne!=null),he=xa(u,f,v,ne.width,ne.height,ne.Pd,ne.Qd,ne.format,null);if(he!=0?B=0:(B!=null&&(B[0]=ne.width[0]),H!=null&&(H[0]=ne.height[0]),B=1),B){D.width=D.width[0],D.height=D.height[0],y!=null&&(y[0]=D.width),E!=null&&(E[0]=D.height);e:{if(y=new Ga,(E=new Ae).data=u,E.w=f,E.ha=v,E.kd=1,f=[0],e(E!=null),((u=xa(E.data,E.w,E.ha,null,null,null,f,null,E))==0||u==7)&&f[0]&&(u=4),(f=u)==0){if(e(R!=null),y.data=E.data,y.w=E.w+E.offset,y.ha=E.ha-E.offset,y.put=rt,y.ac=Tr,y.bc=mr,y.ma=R,E.xa){if((u=ai())==null){R=1;break e}if((function(W,ie){var ue=[0],ve=[0],de=[0];t:for(;;){if(W==null)return 0;if(ie==null)return W.a=2,0;if(W.l=ie,W.a=0,fe(W.m,ie.data,ie.w,ie.ha),!Pr(W.m,ue,ve,de)){W.a=3;break t}if(W.xb=Kd,ie.width=ue[0],ie.height=ve[0],!Or(ue[0],ve[0],1,W,null))break t;return 1}return e(W.a!=0),0})(u,y)){if(y=(f=Hi(y.width,y.height,R.Oa,R.ba))==0){t:{y=u;n:for(;;){if(y==null){y=0;break t}if(e(y.s.yc!=null),e(y.s.Ya!=null),e(0<y.s.Wb),e((v=y.l)!=null),e((E=v.ma)!=null),y.xb!=0){if(y.ca=E.ba,y.tb=E.tb,e(y.ca!=null),!Ms(E.Oa,v,Yo)){y.a=2;break n}if(!Ue(y,v.width)||v.da)break n;if((v.da||st(y.ca.S))&&Hr(),11>y.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),y.ca.f.kb.F!=null&&Hr()),y.Pb&&0<y.s.ua&&y.s.vb.X==null&&!$(y.s.vb,y.s.Wa.Xa)){y.a=1;break n}y.xb=0}if(!hr(y,y.V,y.Ba,y.c,y.i,v.o,Ir))break n;E.Dc=y.Ma,y=1;break t}e(y.a!=0),y=0}y=!y}y&&(f=u.a)}else f=u.a}else{if((u=new fc)==null){R=1;break e}if(u.Fa=E.na,u.P=E.P,u.qc=E.Sa,oi(u,y)){if((f=Hi(y.width,y.height,R.Oa,R.ba))==0){if(u.Aa=0,v=R.Oa,e((E=u)!=null),v!=null){if(0<(B=0>(B=v.Md)?0:100<B?255:255*B/100)){for(H=ne=0;4>H;++H)12>(he=E.pb[H]).lc&&(he.ia=B*Bm[0>he.lc?0:he.lc]>>3),ne|=he.ia;ne&&(alert("todo:VP8InitRandom"),E.ia=1)}E.Ga=v.Id,100<E.Ga?E.Ga=100:0>E.Ga&&(E.Ga=0)}(function(W,ie){if(W==null)return 0;if(ie==null)return An(W,2,"NULL VP8Io parameter in VP8Decode().");if(!W.cb&&!oi(W,ie))return 0;if(e(W.cb),ie.ac==null||ie.ac(ie)){ie.ob&&(W.L=0);var ue=tl[W.L];if(W.L==2?(W.yb=0,W.zb=0):(W.yb=ie.v-ue>>4,W.zb=ie.j-ue>>4,0>W.yb&&(W.yb=0),0>W.zb&&(W.zb=0)),W.Va=ie.o+15+ue>>4,W.Hb=ie.va+15+ue>>4,W.Hb>W.za&&(W.Hb=W.za),W.Va>W.Ub&&(W.Va=W.Ub),0<W.L){var ve=W.ed;for(ue=0;4>ue;++ue){var de;if(W.Qa.Cb){var ye=W.Qa.Lb[ue];W.Qa.Fb||(ye+=ve.Tb)}else ye=ve.Tb;for(de=0;1>=de;++de){var we=W.gd[ue][de],Ee=ye;if(ve.Pc&&(Ee+=ve.vd[0],de&&(Ee+=ve.od[0])),0<(Ee=0>Ee?0:63<Ee?63:Ee)){var ke=Ee;0<ve.wb&&(ke=4<ve.wb?ke>>2:ke>>1)>9-ve.wb&&(ke=9-ve.wb),1>ke&&(ke=1),we.dd=ke,we.tc=2*Ee+ke,we.ld=40<=Ee?2:15<=Ee?1:0}else we.tc=0;we.La=de}}}ue=0}else An(W,6,"Frame setup failed"),ue=W.a;if(ue=ue==0){if(ue){W.$c=0,0<W.Aa||(W.Ic=Mm);t:{ue=W.Ic,ve=4*(ke=W.za);var Ze=32*ke,Be=ke+1,xt=0<W.L?ke*(0<W.Aa?2:1):0,Ge=(W.Aa==2?2:1)*ke;if((we=ve+832+(de=3*(16*ue+tl[W.L])/2*Ze)+(ye=W.Fa!=null&&0<W.Fa.length?W.Kc.c*W.Kc.i:0))!=we)ue=0;else{if(we>W.Vb){if(W.Vb=0,W.Ec=i(we),W.Fc=0,W.Ec==null){ue=An(W,1,"no memory during frame initialization.");break t}W.Vb=we}we=W.Ec,Ee=W.Fc,W.Ac=we,W.Bc=Ee,Ee+=ve,W.Gd=o(Ze,ha),W.Hd=0,W.rb=o(Be+1,Rr),W.sb=1,W.wa=xt?o(xt,un):null,W.Y=0,W.D.Nb=0,W.D.wa=W.wa,W.D.Y=W.Y,0<W.Aa&&(W.D.Y+=ke),e(!0),W.oc=we,W.pc=Ee,Ee+=832,W.ya=o(Ge,sn),W.aa=0,W.D.ya=W.ya,W.D.aa=W.aa,W.Aa==2&&(W.D.aa+=ke),W.R=16*ke,W.B=8*ke,ke=(Ze=tl[W.L])*W.R,Ze=Ze/2*W.B,W.sa=we,W.ta=Ee+ke,W.qa=W.sa,W.ra=W.ta+16*ue*W.R+Ze,W.Ha=W.qa,W.Ia=W.ra+8*ue*W.B+Ze,W.$c=0,Ee+=de,W.mb=ye?we:null,W.nb=ye?Ee:null,e(Ee+ye<=W.Fc+W.Vb),Ro(W),a(W.Ac,W.Bc,0,ve),ue=1}}if(ue){if(ie.ka=0,ie.y=W.sa,ie.O=W.ta,ie.f=W.qa,ie.N=W.ra,ie.ea=W.Ha,ie.Vd=W.Ia,ie.fa=W.R,ie.Rc=W.B,ie.F=null,ie.J=0,!zd){for(ue=-255;255>=ue;++ue)Md[255+ue]=0>ue?-ue:ue;for(ue=-1020;1020>=ue;++ue)Ud[1020+ue]=-128>ue?-128:127<ue?127:ue;for(ue=-112;112>=ue;++ue)$d[112+ue]=-16>ue?-16:15<ue?15:ue;for(ue=-255;510>=ue;++ue)qd[255+ue]=0>ue?0:255<ue?255:ue;zd=1}Yi=Ka,ka=gc,di=li,Bt=Do,Gt=jo,jr=pc,mn=qo,On=va,Pi=N,Gs=G,es=zo,Go=g,Td=Q,Pd=le,Id=ma,Od=Fs,Rd=Uo,Fd=$o,Wr[0]=Sc,Wr[1]=mc,Wr[2]=wc,Wr[3]=xc,Wr[4]=wi,Wr[5]=Ac,Wr[6]=xi,Wr[7]=kc,Wr[8]=Ts,Wr[9]=Ja,Xi[0]=yc,Xi[1]=bc,Xi[2]=Ls,Xi[3]=Bo,Xi[4]=pa,Xi[5]=Cs,Xi[6]=_c,Ii[0]=Ec,Ii[1]=vc,Ii[2]=ga,Ii[3]=Nc,Ii[4]=Is,Ii[5]=Ps,Ii[6]=Mo,ue=1}else ue=0}ue&&(ue=(function(Tt,Rn){for(Tt.M=0;Tt.M<Tt.Va;++Tt.M){var St,Ve=Tt.Jc[Tt.M&Tt.Xb],Oe=Tt.m,vn=Tt;for(St=0;St<vn.za;++St){var _t=Oe,Pt=vn,tn=Pt.Ac,$n=Pt.Bc+4*St,rr=Pt.zc,dn=Pt.ya[Pt.aa+St];if(Pt.Qa.Bb?dn.$b=oe(_t,Pt.Pa.jb[0])?2+oe(_t,Pt.Pa.jb[2]):oe(_t,Pt.Pa.jb[1]):dn.$b=0,Pt.kc&&(dn.Ad=oe(_t,Pt.Bd)),dn.Za=!oe(_t,145)+0,dn.Za){var Vn=dn.Ob,ir=0;for(Pt=0;4>Pt;++Pt){var Fn,Rt=rr[0+Pt];for(Fn=0;4>Fn;++Fn){Rt=Am[tn[$n+Fn]][Rt];for(var $t=Vd[oe(_t,Rt[0])];0<$t;)$t=Vd[2*$t+oe(_t,Rt[$t])];Rt=-$t,tn[$n+Fn]=Rt}r(Vn,ir,tn,$n,4),ir+=4,rr[0+Pt]=Rt}}else Rt=oe(_t,156)?oe(_t,128)?1:3:oe(_t,163)?2:0,dn.Ob[0]=Rt,a(tn,$n,Rt,4),a(rr,0,Rt,4);dn.Dd=oe(_t,142)?oe(_t,114)?oe(_t,183)?1:3:2:0}if(vn.m.Ka)return An(Tt,7,"Premature end-of-partition0 encountered.");for(;Tt.ja<Tt.za;++Tt.ja){if(vn=Ve,_t=(Oe=Tt).rb[Oe.sb-1],tn=Oe.rb[Oe.sb+Oe.ja],St=Oe.ya[Oe.aa+Oe.ja],$n=Oe.kc?St.Ad:0)_t.la=tn.la=0,St.Za||(_t.Na=tn.Na=0),St.Hc=0,St.Gc=0,St.ia=0;else{var hn,qt;if(_t=tn,tn=vn,$n=Oe.Pa.Xc,rr=Oe.ya[Oe.aa+Oe.ja],dn=Oe.pb[rr.$b],Pt=rr.ad,Vn=0,ir=Oe.rb[Oe.sb-1],Rt=Fn=0,a(Pt,Vn,0,384),rr.Za)var qn=0,Gr=$n[3];else{$t=i(16);var bn=_t.Na+ir.Na;if(bn=Ks(tn,$n[1],bn,dn.Eb,0,$t,0),_t.Na=ir.Na=(0<bn)+0,1<bn)Yi($t,0,Pt,Vn);else{var fr=$t[0]+3>>3;for($t=0;256>$t;$t+=16)Pt[Vn+$t]=fr}qn=1,Gr=$n[0]}var Vt=15&_t.la,Dn=15&ir.la;for($t=0;4>$t;++$t){var _r=1&Dn;for(fr=qt=0;4>fr;++fr)Vt=Vt>>1|(_r=(bn=Ks(tn,Gr,bn=_r+(1&Vt),dn.Sc,qn,Pt,Vn))>qn)<<7,qt=qt<<2|(3<bn?3:1<bn?2:Pt[Vn+0]!=0),Vn+=16;Vt>>=4,Dn=Dn>>1|_r<<7,Fn=(Fn<<8|qt)>>>0}for(Gr=Vt,qn=Dn>>4,hn=0;4>hn;hn+=2){for(qt=0,Vt=_t.la>>4+hn,Dn=ir.la>>4+hn,$t=0;2>$t;++$t){for(_r=1&Dn,fr=0;2>fr;++fr)bn=_r+(1&Vt),Vt=Vt>>1|(_r=0<(bn=Ks(tn,$n[2],bn,dn.Qc,0,Pt,Vn)))<<3,qt=qt<<2|(3<bn?3:1<bn?2:Pt[Vn+0]!=0),Vn+=16;Vt>>=2,Dn=Dn>>1|_r<<5}Rt|=qt<<4*hn,Gr|=Vt<<4<<hn,qn|=(240&Dn)<<hn}_t.la=Gr,ir.la=qn,rr.Hc=Fn,rr.Gc=Rt,rr.ia=43690&Rt?0:dn.ia,$n=!(Fn|Rt)}if(0<Oe.L&&(Oe.wa[Oe.Y+Oe.ja]=Oe.gd[St.$b][St.Za],Oe.wa[Oe.Y+Oe.ja].La|=!$n),vn.Ka)return An(Tt,7,"Premature end-of-file encountered.")}if(Ro(Tt),Oe=Rn,vn=1,St=(Ve=Tt).D,_t=0<Ve.L&&Ve.M>=Ve.zb&&Ve.M<=Ve.Va,Ve.Aa==0)t:{if(St.M=Ve.M,St.uc=_t,Dr(Ve,St),vn=1,St=(qt=Ve.D).Nb,_t=(Rt=tl[Ve.L])*Ve.R,tn=Rt/2*Ve.B,$t=16*St*Ve.R,fr=8*St*Ve.B,$n=Ve.sa,rr=Ve.ta-_t+$t,dn=Ve.qa,Pt=Ve.ra-tn+fr,Vn=Ve.Ha,ir=Ve.Ia-tn+fr,Dn=(Vt=qt.M)==0,Fn=Vt>=Ve.Va-1,Ve.Aa==2&&Dr(Ve,qt),qt.uc)for(_r=(bn=Ve).D.M,e(bn.D.uc),qt=bn.yb;qt<bn.Hb;++qt){qn=qt,Gr=_r;var ar=(wr=(zn=bn).D).Nb;hn=zn.R;var wr=wr.wa[wr.Y+qn],xr=zn.sa,pr=zn.ta+16*ar*hn+16*qn,Sr=wr.dd,Zt=wr.tc;if(Zt!=0)if(e(3<=Zt),zn.L==1)0<qn&&Od(xr,pr,hn,Zt+4),wr.La&&Fd(xr,pr,hn,Zt),0<Gr&&Id(xr,pr,hn,Zt+4),wr.La&&Rd(xr,pr,hn,Zt);else{var Ar=zn.B,Vr=zn.qa,Na=zn.ra+8*ar*Ar+8*qn,Oi=zn.Ha,zn=zn.Ia+8*ar*Ar+8*qn;ar=wr.ld,0<qn&&(On(xr,pr,hn,Zt+4,Sr,ar),Gs(Vr,Na,Oi,zn,Ar,Zt+4,Sr,ar)),wr.La&&(Go(xr,pr,hn,Zt,Sr,ar),Pd(Vr,Na,Oi,zn,Ar,Zt,Sr,ar)),0<Gr&&(mn(xr,pr,hn,Zt+4,Sr,ar),Pi(Vr,Na,Oi,zn,Ar,Zt+4,Sr,ar)),wr.La&&(es(xr,pr,hn,Zt,Sr,ar),Td(Vr,Na,Oi,zn,Ar,Zt,Sr,ar))}}if(Ve.ia&&alert("todo:DitherRow"),Oe.put!=null){if(qt=16*Vt,Vt=16*(Vt+1),Dn?(Oe.y=Ve.sa,Oe.O=Ve.ta+$t,Oe.f=Ve.qa,Oe.N=Ve.ra+fr,Oe.ea=Ve.Ha,Oe.W=Ve.Ia+fr):(qt-=Rt,Oe.y=$n,Oe.O=rr,Oe.f=dn,Oe.N=Pt,Oe.ea=Vn,Oe.W=ir),Fn||(Vt-=Rt),Vt>Oe.o&&(Vt=Oe.o),Oe.F=null,Oe.J=null,Ve.Fa!=null&&0<Ve.Fa.length&&qt<Vt&&(Oe.J=Xt(Ve,Oe,qt,Vt-qt),Oe.F=Ve.mb,Oe.F==null&&Oe.F.length==0)){vn=An(Ve,3,"Could not decode alpha data.");break t}qt<Oe.j&&(Rt=Oe.j-qt,qt=Oe.j,e(!(1&Rt)),Oe.O+=Ve.R*Rt,Oe.N+=Ve.B*(Rt>>1),Oe.W+=Ve.B*(Rt>>1),Oe.F!=null&&(Oe.J+=Oe.width*Rt)),qt<Vt&&(Oe.O+=Oe.v,Oe.N+=Oe.v>>1,Oe.W+=Oe.v>>1,Oe.F!=null&&(Oe.J+=Oe.v),Oe.ka=qt-Oe.j,Oe.U=Oe.va-Oe.v,Oe.T=Vt-qt,vn=Oe.put(Oe))}St+1!=Ve.Ic||Fn||(r(Ve.sa,Ve.ta-_t,$n,rr+16*Ve.R,_t),r(Ve.qa,Ve.ra-tn,dn,Pt+8*Ve.B,tn),r(Ve.Ha,Ve.Ia-tn,Vn,ir+8*Ve.B,tn))}if(!vn)return An(Tt,6,"Output aborted.")}return 1})(W,ie)),ie.bc!=null&&ie.bc(ie),ue&=1}return ue?(W.cb=0,ue):0})(u,y)||(f=u.a)}}else f=u.a}f==0&&R.Oa!=null&&R.Oa.fd&&(f=Us(R.ba))}R=f}P=R!=0?null:11>P?D.f.RGBA.eb:D.f.kb.y}else P=null;return P};var th=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function d(F,C){for(var A="",k=0;k<4;k++)A+=String.fromCharCode(F[C++]);return A}function h(F,C){return F[C+0]|F[C+1]<<8}function m(F,C){return(F[C+0]|F[C+1]<<8|F[C+2]<<16)>>>0}function b(F,C){return(F[C+0]|F[C+1]<<8|F[C+2]<<16|F[C+3]<<24)>>>0}new c;var p=[0],_=[0],w=[],S=new c,x=t,T=(function(F,C){var A={},k=0,M=!1,j=0,U=0;if(A.frames=[],!(function(I,z){for(var J=0;J<4;J++)if(I[z+J]!="RIFF".charCodeAt(J))return!0;return!1})(F,C)){for(b(F,C+=4),C+=8;C<F.length;){var re=d(F,C),ce=b(F,C+=4);C+=4;var se=ce+(1&ce);switch(re){case"VP8 ":case"VP8L":A.frames[k]===void 0&&(A.frames[k]={}),(ge=A.frames[k]).src_off=M?U:C-8,ge.src_size=j+ce+8,k++,M&&(M=!1,j=0,U=0);break;case"VP8X":(ge=A.header={}).feature_flags=F[C];var fe=C+4;ge.canvas_width=1+m(F,fe),fe+=3,ge.canvas_height=1+m(F,fe),fe+=3;break;case"ALPH":M=!0,j=se+8,U=C-8;break;case"ANIM":(ge=A.header).bgcolor=b(F,C),fe=C+4,ge.loop_count=h(F,fe),fe+=2;break;case"ANMF":var xe,ge;(ge=A.frames[k]={}).offset_x=2*m(F,C),C+=3,ge.offset_y=2*m(F,C),C+=3,ge.width=1+m(F,C),C+=3,ge.height=1+m(F,C),C+=3,ge.duration=m(F,C),C+=3,xe=F[C++],ge.dispose=1&xe,ge.blend=xe>>1&1}re!="ANMF"&&(C+=se)}return A}})(x,0);T.response=x,T.rgbaoutput=!0,T.dataurl=!1;var O=T.header?T.header:null,L=T.frames?T.frames:null;if(O){O.loop_counter=O.loop_count,p=[O.canvas_height],_=[O.canvas_width];for(var K=0;K<L.length&&L[K].blend!=0;K++);}var te=L[0],V=S.WebPDecodeRGBA(x,te.src_off,te.src_size,_,p);te.rgba=V,te.imgwidth=_[0],te.imgheight=p[0];for(var q=0;q<_[0]*p[0]*4;q++)w[q]=V[q];return this.width=_,this.height=p,this.data=w,this}/** ====================================================================
 * @license
 * jsPDF XMP metadata plugin
 * Copyright (c) 2016 Jussi Utunen, u-jussi@suomi24.fi
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */function Uy(){var t,e=this.internal.__metadata__.metadata,n=unescape(encodeURIComponent(e));t=this.internal.__metadata__.rawXml?n:'<x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceUri+'"><jspdf:metadata>'+n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")+"</jspdf:metadata></rdf:Description></rdf:RDF></x:xmpmeta>",this.internal.__metadata__.metadataObjectNumber=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+t.length+" >>"),this.internal.write("stream"),this.internal.write(t),this.internal.write("endstream"),this.internal.write("endobj")}function $y(){this.internal.__metadata__.metadataObjectNumber&&this.internal.write("/Metadata "+this.internal.__metadata__.metadataObjectNumber+" 0 R")}(function(t){var e,n,r,a,i,o,l,c,d,h=function(I){return I=I||{},this.isStrokeTransparent=I.isStrokeTransparent||!1,this.strokeOpacity=I.strokeOpacity||1,this.strokeStyle=I.strokeStyle||"#000000",this.fillStyle=I.fillStyle||"#000000",this.isFillTransparent=I.isFillTransparent||!1,this.fillOpacity=I.fillOpacity||1,this.font=I.font||"10px sans-serif",this.textBaseline=I.textBaseline||"alphabetic",this.textAlign=I.textAlign||"left",this.lineWidth=I.lineWidth||1,this.lineJoin=I.lineJoin||"miter",this.lineCap=I.lineCap||"butt",this.path=I.path||[],this.transform=I.transform!==void 0?I.transform.clone():new c,this.globalCompositeOperation=I.globalCompositeOperation||"normal",this.globalAlpha=I.globalAlpha||1,this.clip_path=I.clip_path||[],this.currentPoint=I.currentPoint||new o,this.miterLimit=I.miterLimit||10,this.lastPoint=I.lastPoint||new o,this.lineDashOffset=I.lineDashOffset||0,this.lineDash=I.lineDash||[],this.margin=I.margin||[0,0,0,0],this.prevPageLastElemOffset=I.prevPageLastElemOffset||0,this.ignoreClearRect=typeof I.ignoreClearRect!="boolean"||I.ignoreClearRect,this};t.events.push(["initialized",function(){this.context2d=new m(this),e=this.internal.f2,n=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,a=this.internal.getHorizontalCoordinate,i=this.internal.getVerticalCoordinate,o=this.internal.Point,l=this.internal.Rectangle,c=this.internal.Matrix,d=new h}]);var m=function(I){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var z=I;Object.defineProperty(this,"pdf",{get:function(){return z}});var J=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return J},set:function($){J=!!$}});var X=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return X},set:function($){X=!!$}});var Z=0;Object.defineProperty(this,"posX",{get:function(){return Z},set:function($){isNaN($)||(Z=$)}});var ae=0;Object.defineProperty(this,"posY",{get:function(){return ae},set:function($){isNaN($)||(ae=$)}}),Object.defineProperty(this,"margin",{get:function(){return d.margin},set:function($){var Pe;typeof $=="number"?Pe=[$,$,$,$]:((Pe=new Array(4))[0]=$[0],Pe[1]=$.length>=2?$[1]:Pe[0],Pe[2]=$.length>=3?$[2]:Pe[0],Pe[3]=$.length>=4?$[3]:Pe[1]),d.margin=Pe}});var pe=!1;Object.defineProperty(this,"autoPaging",{get:function(){return pe},set:function($){pe=$}});var Y=0;Object.defineProperty(this,"lastBreak",{get:function(){return Y},set:function($){Y=$}});var oe=[];Object.defineProperty(this,"pageBreaks",{get:function(){return oe},set:function($){oe=$}}),Object.defineProperty(this,"ctx",{get:function(){return d},set:function($){$ instanceof h&&(d=$)}}),Object.defineProperty(this,"path",{get:function(){return d.path},set:function($){d.path=$}});var be=[];Object.defineProperty(this,"ctxStack",{get:function(){return be},set:function($){be=$}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function($){var Pe;Pe=b($),this.ctx.fillStyle=Pe.style,this.ctx.isFillTransparent=Pe.a===0,this.ctx.fillOpacity=Pe.a,this.pdf.setFillColor(Pe.r,Pe.g,Pe.b,{a:Pe.a}),this.pdf.setTextColor(Pe.r,Pe.g,Pe.b,{a:Pe.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function($){var Pe=b($);this.ctx.strokeStyle=Pe.style,this.ctx.isStrokeTransparent=Pe.a===0,this.ctx.strokeOpacity=Pe.a,Pe.a===0?this.pdf.setDrawColor(255,255,255):(Pe.a,this.pdf.setDrawColor(Pe.r,Pe.g,Pe.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function($){["butt","round","square"].indexOf($)!==-1&&(this.ctx.lineCap=$,this.pdf.setLineCap($))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function($){isNaN($)||(this.ctx.lineWidth=$,this.pdf.setLineWidth($))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function($){["bevel","round","miter"].indexOf($)!==-1&&(this.ctx.lineJoin=$,this.pdf.setLineJoin($))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function($){isNaN($)||(this.ctx.miterLimit=$,this.pdf.setMiterLimit($))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function($){this.ctx.textBaseline=$}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function($){["right","end","center","left","start"].indexOf($)!==-1&&(this.ctx.textAlign=$)}});var Ce=null,Te=null,je=null;Object.defineProperty(this,"fontFaces",{get:function(){return je},set:function($){Ce=null,Te=null,je=$}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function($){var Pe;if(this.ctx.font=$,(Pe=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec($))!==null){var ht=Pe[1];Pe[2];var He=Pe[3],Se=Pe[4];Pe[5];var Ke=Pe[6],Re=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Se)[2];Se=Math.floor(Re==="px"?parseFloat(Se)*this.pdf.internal.scaleFactor:Re==="em"?parseFloat(Se)*this.pdf.getFontSize():parseFloat(Se)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Se);var Qe=(function(We){var rn,Et,bt=[],ct=We.trim();if(ct==="")return ku;if(ct in hp)return[hp[ct]];for(;ct!=="";){switch(Et=null,rn=(ct=pp(ct)).charAt(0)){case'"':case"'":Et=Ry(ct.substring(1),rn);break;default:Et=Fy(ct)}if(Et===null||(bt.push(Et[0]),(ct=pp(Et[1]))!==""&&ct.charAt(0)!==","))return ku;ct=ct.replace(/^,/,"")}return bt})(Ke);if(this.fontFaces){var Ie=(function(We,rn){var Et=We.getFontList(),bt=JSON.stringify(Et);if(Ce===null||Te!==bt){var ct=(function(Dt){var et=[];return Object.keys(Dt).forEach(function(jt){Dt[jt].forEach(function(st){var dt=null;switch(st){case"bold":dt={family:jt,weight:"bold"};break;case"italic":dt={family:jt,style:"italic"};break;case"bolditalic":dt={family:jt,weight:"bold",style:"italic"};break;case"":case"normal":dt={family:jt}}dt!==null&&(dt.ref={name:jt,style:st},et.push(dt))})}),et})(Et);Ce=(function(Dt){for(var et={},jt=0;jt<Dt.length;++jt){var st=Au(Dt[jt]),dt=st.family,Ut=st.stretch,kt=st.style,tt=st.weight;et[dt]=et[dt]||{},et[dt][Ut]=et[dt][Ut]||{},et[dt][Ut][kt]=et[dt][Ut][kt]||{},et[dt][Ut][kt][tt]=st}return et})(ct.concat(rn)),Te=bt}return Ce})(this.pdf,this.fontFaces),it=Qe.map(function(We){return{family:We,stretch:"normal",weight:He,style:ht}}),nt=(function(We,rn,Et){for(var bt=(Et=Et||{}).defaultFontFamily||"times",ct=Object.assign({},Oy,Et.genericFontFamilies||{}),Dt=null,et=null,jt=0;jt<rn.length;++jt)if(ct[(Dt=Au(rn[jt])).family]&&(Dt.family=ct[Dt.family]),We.hasOwnProperty(Dt.family)){et=We[Dt.family];break}if(!(et=et||We[bt]))throw new Error("Could not find a font-family for the rule '"+fp(Dt)+"' and default family '"+bt+"'.");if(et=(function(st,dt){if(dt[st])return dt[st];var Ut=ld[st],kt=Ut<=ld.normal?-1:1,tt=dp(dt,cm,Ut,kt);if(!tt)throw new Error("Could not find a matching font-stretch value for "+st);return tt})(Dt.stretch,et),et=(function(st,dt){if(dt[st])return dt[st];for(var Ut=lm[st],kt=0;kt<Ut.length;++kt)if(dt[Ut[kt]])return dt[Ut[kt]];throw new Error("Could not find a matching font-style for "+st)})(Dt.style,et),!(et=(function(st,dt){if(dt[st])return dt[st];if(st===400&&dt[500])return dt[500];if(st===500&&dt[400])return dt[400];var Ut=Iy[st],kt=dp(dt,um,Ut,st<400?-1:1);if(!kt)throw new Error("Could not find a matching font-weight for value "+st);return kt})(Dt.weight,et)))throw new Error("Failed to resolve a font for the rule '"+fp(Dt)+"'.");return et})(Ie,it);this.pdf.setFont(nt.ref.name,nt.ref.style)}else{var at="";(He==="bold"||parseInt(He,10)>=700||ht==="bold")&&(at="bold"),ht==="italic"&&(at+="italic"),at.length===0&&(at="normal");for(var ut="",pt={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},qe=0;qe<Qe.length;qe++){if(this.pdf.internal.getFont(Qe[qe],at,{noFallback:!0,disableWarning:!0})!==void 0){ut=Qe[qe];break}if(at==="bolditalic"&&this.pdf.internal.getFont(Qe[qe],"bold",{noFallback:!0,disableWarning:!0})!==void 0)ut=Qe[qe],at="bold";else if(this.pdf.internal.getFont(Qe[qe],"normal",{noFallback:!0,disableWarning:!0})!==void 0){ut=Qe[qe],at="normal";break}}if(ut===""){for(var mt=0;mt<Qe.length;mt++)if(pt[Qe[mt]]){ut=pt[Qe[mt]];break}}ut=ut===""?"Times":ut,this.pdf.setFont(ut,at)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function($){this.ctx.globalCompositeOperation=$}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function($){this.ctx.globalAlpha=$}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function($){this.ctx.lineDashOffset=$,ge.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function($){this.ctx.lineDash=$,ge.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function($){this.ctx.ignoreClearRect=!!$}})};m.prototype.setLineDash=function(I){this.lineDash=I},m.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},m.prototype.fill=function(){L.call(this,"fill",!1)},m.prototype.stroke=function(){L.call(this,"stroke",!1)},m.prototype.beginPath=function(){this.path=[{type:"begin"}]},m.prototype.moveTo=function(I,z){if(isNaN(I)||isNaN(z))throw Kt.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var J=this.ctx.transform.applyToPoint(new o(I,z));this.path.push({type:"mt",x:J.x,y:J.y}),this.ctx.lastPoint=new o(I,z)},m.prototype.closePath=function(){var I=new o(0,0),z=0;for(z=this.path.length-1;z!==-1;z--)if(this.path[z].type==="begin"&&Ht(this.path[z+1])==="object"&&typeof this.path[z+1].x=="number"){I=new o(this.path[z+1].x,this.path[z+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new o(I.x,I.y)},m.prototype.lineTo=function(I,z){if(isNaN(I)||isNaN(z))throw Kt.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var J=this.ctx.transform.applyToPoint(new o(I,z));this.path.push({type:"lt",x:J.x,y:J.y}),this.ctx.lastPoint=new o(J.x,J.y)},m.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),L.call(this,null,!0)},m.prototype.quadraticCurveTo=function(I,z,J,X){if(isNaN(J)||isNaN(X)||isNaN(I)||isNaN(z))throw Kt.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var Z=this.ctx.transform.applyToPoint(new o(J,X)),ae=this.ctx.transform.applyToPoint(new o(I,z));this.path.push({type:"qct",x1:ae.x,y1:ae.y,x:Z.x,y:Z.y}),this.ctx.lastPoint=new o(Z.x,Z.y)},m.prototype.bezierCurveTo=function(I,z,J,X,Z,ae){if(isNaN(Z)||isNaN(ae)||isNaN(I)||isNaN(z)||isNaN(J)||isNaN(X))throw Kt.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var pe=this.ctx.transform.applyToPoint(new o(Z,ae)),Y=this.ctx.transform.applyToPoint(new o(I,z)),oe=this.ctx.transform.applyToPoint(new o(J,X));this.path.push({type:"bct",x1:Y.x,y1:Y.y,x2:oe.x,y2:oe.y,x:pe.x,y:pe.y}),this.ctx.lastPoint=new o(pe.x,pe.y)},m.prototype.arc=function(I,z,J,X,Z,ae){if(isNaN(I)||isNaN(z)||isNaN(J)||isNaN(X)||isNaN(Z))throw Kt.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(ae=!!ae,!this.ctx.transform.isIdentity){var pe=this.ctx.transform.applyToPoint(new o(I,z));I=pe.x,z=pe.y;var Y=this.ctx.transform.applyToPoint(new o(0,J)),oe=this.ctx.transform.applyToPoint(new o(0,0));J=Math.sqrt(Math.pow(Y.x-oe.x,2)+Math.pow(Y.y-oe.y,2))}Math.abs(Z-X)>=2*Math.PI&&(X=0,Z=2*Math.PI),this.path.push({type:"arc",x:I,y:z,radius:J,startAngle:X,endAngle:Z,counterclockwise:ae})},m.prototype.arcTo=function(I,z,J,X,Z){throw new Error("arcTo not implemented.")},m.prototype.rect=function(I,z,J,X){if(isNaN(I)||isNaN(z)||isNaN(J)||isNaN(X))throw Kt.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(I,z),this.lineTo(I+J,z),this.lineTo(I+J,z+X),this.lineTo(I,z+X),this.lineTo(I,z),this.lineTo(I+J,z),this.lineTo(I,z)},m.prototype.fillRect=function(I,z,J,X){if(isNaN(I)||isNaN(z)||isNaN(J)||isNaN(X))throw Kt.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!p.call(this)){var Z={};this.lineCap!=="butt"&&(Z.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(Z.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(I,z,J,X),this.fill(),Z.hasOwnProperty("lineCap")&&(this.lineCap=Z.lineCap),Z.hasOwnProperty("lineJoin")&&(this.lineJoin=Z.lineJoin)}},m.prototype.strokeRect=function(I,z,J,X){if(isNaN(I)||isNaN(z)||isNaN(J)||isNaN(X))throw Kt.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");_.call(this)||(this.beginPath(),this.rect(I,z,J,X),this.stroke())},m.prototype.clearRect=function(I,z,J,X){if(isNaN(I)||isNaN(z)||isNaN(J)||isNaN(X))throw Kt.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(I,z,J,X))},m.prototype.save=function(I){I=typeof I!="boolean"||I;for(var z=this.pdf.internal.getCurrentPageInfo().pageNumber,J=0;J<this.pdf.internal.getNumberOfPages();J++)this.pdf.setPage(J+1),this.pdf.internal.out("q");if(this.pdf.setPage(z),I){this.ctx.fontSize=this.pdf.internal.getFontSize();var X=new h(this.ctx);this.ctxStack.push(this.ctx),this.ctx=X}},m.prototype.restore=function(I){I=typeof I!="boolean"||I;for(var z=this.pdf.internal.getCurrentPageInfo().pageNumber,J=0;J<this.pdf.internal.getNumberOfPages();J++)this.pdf.setPage(J+1),this.pdf.internal.out("Q");this.pdf.setPage(z),I&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},m.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var b=function(I){var z,J,X,Z;if(I.isCanvasGradient===!0&&(I=I.getColor()),!I)return{r:0,g:0,b:0,a:0,style:I};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(I))z=0,J=0,X=0,Z=0;else{var ae=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(I);if(ae!==null)z=parseInt(ae[1]),J=parseInt(ae[2]),X=parseInt(ae[3]),Z=1;else if((ae=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(I))!==null)z=parseInt(ae[1]),J=parseInt(ae[2]),X=parseInt(ae[3]),Z=parseFloat(ae[4]);else{if(Z=1,typeof I=="string"&&I.charAt(0)!=="#"){var pe=new tm(I);I=pe.ok?pe.toHex():"#000000"}I.length===4?(z=I.substring(1,2),z+=z,J=I.substring(2,3),J+=J,X=I.substring(3,4),X+=X):(z=I.substring(1,3),J=I.substring(3,5),X=I.substring(5,7)),z=parseInt(z,16),J=parseInt(J,16),X=parseInt(X,16)}}return{r:z,g:J,b:X,a:Z,style:I}},p=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},_=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};m.prototype.fillText=function(I,z,J,X){if(isNaN(z)||isNaN(J)||typeof I!="string")throw Kt.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(X=isNaN(X)?void 0:X,!p.call(this)){var Z=se(this.ctx.transform.rotation),ae=this.ctx.transform.scaleX;k.call(this,{text:I,x:z,y:J,scale:ae,angle:Z,align:this.textAlign,maxWidth:X})}},m.prototype.strokeText=function(I,z,J,X){if(isNaN(z)||isNaN(J)||typeof I!="string")throw Kt.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!_.call(this)){X=isNaN(X)?void 0:X;var Z=se(this.ctx.transform.rotation),ae=this.ctx.transform.scaleX;k.call(this,{text:I,x:z,y:J,scale:ae,renderingMode:"stroke",angle:Z,align:this.textAlign,maxWidth:X})}},m.prototype.measureText=function(I){if(typeof I!="string")throw Kt.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var z=this.pdf,J=this.pdf.internal.scaleFactor,X=z.internal.getFontSize(),Z=z.getStringUnitWidth(I)*X/z.internal.scaleFactor;return new function(ae){var pe=(ae=ae||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return pe}}),this}({width:Z*=Math.round(96*J/72*1e4)/1e4})},m.prototype.scale=function(I,z){if(isNaN(I)||isNaN(z))throw Kt.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var J=new c(I,0,0,z,0,0);this.ctx.transform=this.ctx.transform.multiply(J)},m.prototype.rotate=function(I){if(isNaN(I))throw Kt.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var z=new c(Math.cos(I),Math.sin(I),-Math.sin(I),Math.cos(I),0,0);this.ctx.transform=this.ctx.transform.multiply(z)},m.prototype.translate=function(I,z){if(isNaN(I)||isNaN(z))throw Kt.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var J=new c(1,0,0,1,I,z);this.ctx.transform=this.ctx.transform.multiply(J)},m.prototype.transform=function(I,z,J,X,Z,ae){if(isNaN(I)||isNaN(z)||isNaN(J)||isNaN(X)||isNaN(Z)||isNaN(ae))throw Kt.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var pe=new c(I,z,J,X,Z,ae);this.ctx.transform=this.ctx.transform.multiply(pe)},m.prototype.setTransform=function(I,z,J,X,Z,ae){I=isNaN(I)?1:I,z=isNaN(z)?0:z,J=isNaN(J)?0:J,X=isNaN(X)?1:X,Z=isNaN(Z)?0:Z,ae=isNaN(ae)?0:ae,this.ctx.transform=new c(I,z,J,X,Z,ae)};var w=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};m.prototype.drawImage=function(I,z,J,X,Z,ae,pe,Y,oe){var be=this.pdf.getImageProperties(I),Ce=1,Te=1,je=1,$=1;X!==void 0&&Y!==void 0&&(je=Y/X,$=oe/Z,Ce=be.width/X*Y/X,Te=be.height/Z*oe/Z),ae===void 0&&(ae=z,pe=J,z=0,J=0),X!==void 0&&Y===void 0&&(Y=X,oe=Z),X===void 0&&Y===void 0&&(Y=be.width,oe=be.height);var Pe=this.ctx.transform.decompose(),ht=se(Pe.rotate.shx),He=new c,Se=(He=(He=(He=He.multiply(Pe.translate)).multiply(Pe.skew)).multiply(Pe.scale)).applyToRectangle(new l(ae-z*je,pe-J*$,X*Ce,Z*Te));if(this.autoPaging){for(var Ke,Re=S.call(this,Se),Qe=[],Ie=0;Ie<Re.length;Ie+=1)Qe.indexOf(Re[Ie])===-1&&Qe.push(Re[Ie]);O(Qe);for(var it=Qe[0],nt=Qe[Qe.length-1],at=it;at<nt+1;at++){this.pdf.setPage(at);var ut=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],pt=at===1?this.posY+this.margin[0]:this.margin[0],qe=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],mt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],We=at===1?0:qe+(at-2)*mt;if(this.ctx.clip_path.length!==0){var rn=this.path;Ke=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=T(Ke,this.posX+this.margin[3],-We+pt+this.ctx.prevPageLastElemOffset),K.call(this,"fill",!0),this.path=rn}var Et=JSON.parse(JSON.stringify(Se));Et=T([Et],this.posX+this.margin[3],-We+pt+this.ctx.prevPageLastElemOffset)[0];var bt=(at>it||at<nt)&&w.call(this);bt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ut,mt,null).clip().discardPath()),this.pdf.addImage(I,"JPEG",Et.x,Et.y,Et.w,Et.h,null,null,ht),bt&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(I,"JPEG",Se.x,Se.y,Se.w,Se.h,null,null,ht)};var S=function(I,z,J){var X=[];z=z||this.pdf.internal.pageSize.width,J=J||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var Z=this.posY+this.ctx.prevPageLastElemOffset;switch(I.type){default:case"mt":case"lt":X.push(Math.floor((I.y+Z)/J)+1);break;case"arc":X.push(Math.floor((I.y+Z-I.radius)/J)+1),X.push(Math.floor((I.y+Z+I.radius)/J)+1);break;case"qct":var ae=fe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,I.x1,I.y1,I.x,I.y);X.push(Math.floor((ae.y+Z)/J)+1),X.push(Math.floor((ae.y+ae.h+Z)/J)+1);break;case"bct":var pe=xe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,I.x1,I.y1,I.x2,I.y2,I.x,I.y);X.push(Math.floor((pe.y+Z)/J)+1),X.push(Math.floor((pe.y+pe.h+Z)/J)+1);break;case"rect":X.push(Math.floor((I.y+Z)/J)+1),X.push(Math.floor((I.y+I.h+Z)/J)+1)}for(var Y=0;Y<X.length;Y+=1)for(;this.pdf.internal.getNumberOfPages()<X[Y];)x.call(this);return X},x=function(){var I=this.fillStyle,z=this.strokeStyle,J=this.font,X=this.lineCap,Z=this.lineWidth,ae=this.lineJoin;this.pdf.addPage(),this.fillStyle=I,this.strokeStyle=z,this.font=J,this.lineCap=X,this.lineWidth=Z,this.lineJoin=ae},T=function(I,z,J){for(var X=0;X<I.length;X++)switch(I[X].type){case"bct":I[X].x2+=z,I[X].y2+=J;case"qct":I[X].x1+=z,I[X].y1+=J;default:I[X].x+=z,I[X].y+=J}return I},O=function(I){return I.sort(function(z,J){return z-J})},L=function(I,z){var J=this.fillStyle,X=this.strokeStyle,Z=this.lineCap,ae=this.lineWidth,pe=Math.abs(ae*this.ctx.transform.scaleX),Y=this.lineJoin;if(this.autoPaging){for(var oe,be,Ce=JSON.parse(JSON.stringify(this.path)),Te=JSON.parse(JSON.stringify(this.path)),je=[],$=0;$<Te.length;$++)if(Te[$].x!==void 0)for(var Pe=S.call(this,Te[$]),ht=0;ht<Pe.length;ht+=1)je.indexOf(Pe[ht])===-1&&je.push(Pe[ht]);for(var He=0;He<je.length;He++)for(;this.pdf.internal.getNumberOfPages()<je[He];)x.call(this);O(je);for(var Se=je[0],Ke=je[je.length-1],Re=Se;Re<Ke+1;Re++){this.pdf.setPage(Re),this.fillStyle=J,this.strokeStyle=X,this.lineCap=Z,this.lineWidth=pe,this.lineJoin=Y;var Qe=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Ie=Re===1?this.posY+this.margin[0]:this.margin[0],it=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],nt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],at=Re===1?0:it+(Re-2)*nt;if(this.ctx.clip_path.length!==0){var ut=this.path;oe=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=T(oe,this.posX+this.margin[3],-at+Ie+this.ctx.prevPageLastElemOffset),K.call(this,I,!0),this.path=ut}if(be=JSON.parse(JSON.stringify(Ce)),this.path=T(be,this.posX+this.margin[3],-at+Ie+this.ctx.prevPageLastElemOffset),z===!1||Re===0){var pt=(Re>Se||Re<Ke)&&w.call(this);pt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Qe,nt,null).clip().discardPath()),K.call(this,I,z),pt&&this.pdf.restoreGraphicsState()}this.lineWidth=ae}this.path=Ce}else this.lineWidth=pe,K.call(this,I,z),this.lineWidth=ae},K=function(I,z){if((I!=="stroke"||z||!_.call(this))&&(I==="stroke"||z||!p.call(this))){for(var J,X,Z=[],ae=this.path,pe=0;pe<ae.length;pe++){var Y=ae[pe];switch(Y.type){case"begin":Z.push({begin:!0});break;case"close":Z.push({close:!0});break;case"mt":Z.push({start:Y,deltas:[],abs:[]});break;case"lt":var oe=Z.length;if(ae[pe-1]&&!isNaN(ae[pe-1].x)&&(J=[Y.x-ae[pe-1].x,Y.y-ae[pe-1].y],oe>0)){for(;oe>=0;oe--)if(Z[oe-1].close!==!0&&Z[oe-1].begin!==!0){Z[oe-1].deltas.push(J),Z[oe-1].abs.push(Y);break}}break;case"bct":J=[Y.x1-ae[pe-1].x,Y.y1-ae[pe-1].y,Y.x2-ae[pe-1].x,Y.y2-ae[pe-1].y,Y.x-ae[pe-1].x,Y.y-ae[pe-1].y],Z[Z.length-1].deltas.push(J);break;case"qct":var be=ae[pe-1].x+2/3*(Y.x1-ae[pe-1].x),Ce=ae[pe-1].y+2/3*(Y.y1-ae[pe-1].y),Te=Y.x+2/3*(Y.x1-Y.x),je=Y.y+2/3*(Y.y1-Y.y),$=Y.x,Pe=Y.y;J=[be-ae[pe-1].x,Ce-ae[pe-1].y,Te-ae[pe-1].x,je-ae[pe-1].y,$-ae[pe-1].x,Pe-ae[pe-1].y],Z[Z.length-1].deltas.push(J);break;case"arc":Z.push({deltas:[],abs:[],arc:!0}),Array.isArray(Z[Z.length-1].abs)&&Z[Z.length-1].abs.push(Y)}}X=z?null:I==="stroke"?"stroke":"fill";for(var ht=!1,He=0;He<Z.length;He++)if(Z[He].arc)for(var Se=Z[He].abs,Ke=0;Ke<Se.length;Ke++){var Re=Se[Ke];Re.type==="arc"?q.call(this,Re.x,Re.y,Re.radius,Re.startAngle,Re.endAngle,Re.counterclockwise,void 0,z,!ht):M.call(this,Re.x,Re.y),ht=!0}else if(Z[He].close===!0)this.pdf.internal.out("h"),ht=!1;else if(Z[He].begin!==!0){var Qe=Z[He].start.x,Ie=Z[He].start.y;j.call(this,Z[He].deltas,Qe,Ie),ht=!0}X&&F.call(this,X),z&&C.call(this)}},te=function(I){var z=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,J=z*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return I-J;case"top":return I+z-J;case"hanging":return I+z-2*J;case"middle":return I+z/2-J;default:return I}},V=function(I){return I+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};m.prototype.createLinearGradient=function(){var I=function(){};return I.colorStops=[],I.addColorStop=function(z,J){this.colorStops.push([z,J])},I.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},I.isCanvasGradient=!0,I},m.prototype.createPattern=function(){return this.createLinearGradient()},m.prototype.createRadialGradient=function(){return this.createLinearGradient()};var q=function(I,z,J,X,Z,ae,pe,Y,oe){for(var be=re.call(this,J,X,Z,ae),Ce=0;Ce<be.length;Ce++){var Te=be[Ce];Ce===0&&(oe?A.call(this,Te.x1+I,Te.y1+z):M.call(this,Te.x1+I,Te.y1+z)),U.call(this,I,z,Te.x2,Te.y2,Te.x3,Te.y3,Te.x4,Te.y4)}Y?C.call(this):F.call(this,pe)},F=function(I){switch(I){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},C=function(){this.pdf.clip(),this.pdf.discardPath()},A=function(I,z){this.pdf.internal.out(n(I)+" "+r(z)+" m")},k=function(I){var z;switch(I.align){case"right":case"end":z="right";break;case"center":z="center";break;default:z="left"}var J,X,Z,ae=this.pdf.getTextDimensions(I.text),pe=te.call(this,I.y),Y=V.call(this,pe)-ae.h,oe=this.ctx.transform.applyToPoint(new o(I.x,pe));if(this.autoPaging){var be=this.ctx.transform.decompose(),Ce=new c;Ce=(Ce=(Ce=Ce.multiply(be.translate)).multiply(be.skew)).multiply(be.scale);for(var Te=this.ctx.transform.applyToRectangle(new l(I.x,pe,ae.w,ae.h)),je=Ce.applyToRectangle(new l(I.x,Y,ae.w,ae.h)),$=S.call(this,je),Pe=[],ht=0;ht<$.length;ht+=1)Pe.indexOf($[ht])===-1&&Pe.push($[ht]);O(Pe);for(var He=Pe[0],Se=Pe[Pe.length-1],Ke=He;Ke<Se+1;Ke++){this.pdf.setPage(Ke);var Re=Ke===1?this.posY+this.margin[0]:this.margin[0],Qe=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ie=this.pdf.internal.pageSize.height-this.margin[2],it=Ie-this.margin[0],nt=this.pdf.internal.pageSize.width-this.margin[1],at=nt-this.margin[3],ut=Ke===1?0:Qe+(Ke-2)*it;if(this.ctx.clip_path.length!==0){var pt=this.path;J=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=T(J,this.posX+this.margin[3],-1*ut+Re),K.call(this,"fill",!0),this.path=pt}var qe=T([JSON.parse(JSON.stringify(je))],this.posX+this.margin[3],-ut+Re+this.ctx.prevPageLastElemOffset)[0];I.scale>=.01&&(X=this.pdf.internal.getFontSize(),this.pdf.setFontSize(X*I.scale),Z=this.lineWidth,this.lineWidth=Z*I.scale);var mt=this.autoPaging!=="text";if(mt||qe.y+qe.h<=Ie){if(mt||qe.y>=Re&&qe.x<=nt){var We=mt?I.text:this.pdf.splitTextToSize(I.text,I.maxWidth||nt-qe.x)[0],rn=T([JSON.parse(JSON.stringify(Te))],this.posX+this.margin[3],-ut+Re+this.ctx.prevPageLastElemOffset)[0],Et=mt&&(Ke>He||Ke<Se)&&w.call(this);Et&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],at,it,null).clip().discardPath()),this.pdf.text(We,rn.x,rn.y,{angle:I.angle,align:z,renderingMode:I.renderingMode}),Et&&this.pdf.restoreGraphicsState()}}else qe.y<Ie&&(this.ctx.prevPageLastElemOffset+=Ie-qe.y);I.scale>=.01&&(this.pdf.setFontSize(X),this.lineWidth=Z)}}else I.scale>=.01&&(X=this.pdf.internal.getFontSize(),this.pdf.setFontSize(X*I.scale),Z=this.lineWidth,this.lineWidth=Z*I.scale),this.pdf.text(I.text,oe.x+this.posX,oe.y+this.posY,{angle:I.angle,align:z,renderingMode:I.renderingMode,maxWidth:I.maxWidth}),I.scale>=.01&&(this.pdf.setFontSize(X),this.lineWidth=Z)},M=function(I,z,J,X){J=J||0,X=X||0,this.pdf.internal.out(n(I+J)+" "+r(z+X)+" l")},j=function(I,z,J){return this.pdf.lines(I,z,J,null,null)},U=function(I,z,J,X,Z,ae,pe,Y){this.pdf.internal.out([e(a(J+I)),e(i(X+z)),e(a(Z+I)),e(i(ae+z)),e(a(pe+I)),e(i(Y+z)),"c"].join(" "))},re=function(I,z,J,X){for(var Z=2*Math.PI,ae=Math.PI/2;z>J;)z-=Z;var pe=Math.abs(J-z);pe<Z&&X&&(pe=Z-pe);for(var Y=[],oe=X?-1:1,be=z;pe>1e-5;){var Ce=be+oe*Math.min(pe,ae);Y.push(ce.call(this,I,be,Ce)),pe-=Math.abs(Ce-be),be=Ce}return Y},ce=function(I,z,J){var X=(J-z)/2,Z=I*Math.cos(X),ae=I*Math.sin(X),pe=Z,Y=-ae,oe=pe*pe+Y*Y,be=oe+pe*Z+Y*ae,Ce=4/3*(Math.sqrt(2*oe*be)-be)/(pe*ae-Y*Z),Te=pe-Ce*Y,je=Y+Ce*pe,$=Te,Pe=-je,ht=X+z,He=Math.cos(ht),Se=Math.sin(ht);return{x1:I*Math.cos(z),y1:I*Math.sin(z),x2:Te*He-je*Se,y2:Te*Se+je*He,x3:$*He-Pe*Se,y3:$*Se+Pe*He,x4:I*Math.cos(J),y4:I*Math.sin(J)}},se=function(I){return 180*I/Math.PI},fe=function(I,z,J,X,Z,ae){var pe=I+.5*(J-I),Y=z+.5*(X-z),oe=Z+.5*(J-Z),be=ae+.5*(X-ae),Ce=Math.min(I,Z,pe,oe),Te=Math.max(I,Z,pe,oe),je=Math.min(z,ae,Y,be),$=Math.max(z,ae,Y,be);return new l(Ce,je,Te-Ce,$-je)},xe=function(I,z,J,X,Z,ae,pe,Y){var oe,be,Ce,Te,je,$,Pe,ht,He,Se,Ke,Re,Qe,Ie,it=J-I,nt=X-z,at=Z-J,ut=ae-X,pt=pe-Z,qe=Y-ae;for(be=0;be<41;be++)He=(Pe=(Ce=I+(oe=be/40)*it)+oe*((je=J+oe*at)-Ce))+oe*(je+oe*(Z+oe*pt-je)-Pe),Se=(ht=(Te=z+oe*nt)+oe*(($=X+oe*ut)-Te))+oe*($+oe*(ae+oe*qe-$)-ht),be==0?(Ke=He,Re=Se,Qe=He,Ie=Se):(Ke=Math.min(Ke,He),Re=Math.min(Re,Se),Qe=Math.max(Qe,He),Ie=Math.max(Ie,Se));return new l(Math.round(Ke),Math.round(Re),Math.round(Qe-Ke),Math.round(Ie-Re))},ge=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var I,z,J=(I=this.ctx.lineDash,z=this.ctx.lineDashOffset,JSON.stringify({lineDash:I,lineDashOffset:z}));this.prevLineDash!==J&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=J)}}})(Xe.API),(function(t){var e=function(o){var l,c,d,h,m,b,p,_,w,S;for(c=[],d=0,h=(o+=l="\0\0\0\0".slice(o.length%4||4)).length;h>d;d+=4)(m=(o.charCodeAt(d)<<24)+(o.charCodeAt(d+1)<<16)+(o.charCodeAt(d+2)<<8)+o.charCodeAt(d+3))!==0?(b=(m=((m=((m=((m=(m-(S=m%85))/85)-(w=m%85))/85)-(_=m%85))/85)-(p=m%85))/85)%85,c.push(b+33,p+33,_+33,w+33,S+33)):c.push(122);return(function(x,T){for(var O=T;O>0;O--)x.pop()})(c,l.length),String.fromCharCode.apply(String,c)+"~>"},n=function(o){var l,c,d,h,m,b=String,p="length",_=255,w="charCodeAt",S="slice",x="replace";for(o[S](-2),o=o[S](0,-2)[x](/\s/g,"")[x]("z","!!!!!"),d=[],h=0,m=(o+=l="uuuuu"[S](o[p]%5||5))[p];m>h;h+=5)c=52200625*(o[w](h)-33)+614125*(o[w](h+1)-33)+7225*(o[w](h+2)-33)+85*(o[w](h+3)-33)+(o[w](h+4)-33),d.push(_&c>>24,_&c>>16,_&c>>8,_&c);return(function(T,O){for(var L=O;L>0;L--)T.pop()})(d,l[p]),b.fromCharCode.apply(b,d)},r=function(o){return o.split("").map(function(l){return("0"+l.charCodeAt().toString(16)).slice(-2)}).join("")+">"},a=function(o){var l=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),l.test(o)===!1)return"";for(var c="",d=0;d<o.length;d+=2)c+=String.fromCharCode("0x"+(o[d]+o[d+1]));return c},i=function(o){for(var l=new Uint8Array(o.length),c=o.length;c--;)l[c]=o.charCodeAt(c);return(l=td(l)).reduce(function(d,h){return d+String.fromCharCode(h)},"")};t.processDataByFilters=function(o,l){var c=0,d=o||"",h=[];for(typeof(l=l||[])=="string"&&(l=[l]),c=0;c<l.length;c+=1)switch(l[c]){case"ASCII85Decode":case"/ASCII85Decode":d=n(d),h.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":d=e(d),h.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":d=a(d),h.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":d=r(d),h.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":d=i(d),h.push("/FlateDecode");break;default:throw new Error('The filter: "'+l[c]+'" is not implemented')}return{data:d,reverseChain:h.reverse().join(" ")}}})(Xe.API),(function(t){t.loadFile=function(e,n,r){return(function(a,i,o){i=i!==!1,o=typeof o=="function"?o:function(){};var l=void 0;try{l=(function(c,d,h){var m=new XMLHttpRequest,b=0,p=function(_){var w=_.length,S=[],x=String.fromCharCode;for(b=0;b<w;b+=1)S.push(x(255&_.charCodeAt(b)));return S.join("")};if(m.open("GET",c,!d),m.overrideMimeType("text/plain; charset=x-user-defined"),d===!1&&(m.onload=function(){m.status===200?h(p(this.responseText)):h(void 0)}),m.send(null),d&&m.status===200)return p(m.responseText)})(a,i,o)}catch{}return l})(e,n,r)},t.allowFsRead=void 0,t.loadImageFile=t.loadFile})(Xe.API),(function(t){function e(){return(ft.html2canvas?Promise.resolve(ft.html2canvas):su(()=>import("./html2canvas.esm-QH1iLAAe.js"),[])).catch(function(l){return Promise.reject(new Error("Could not load html2canvas: "+l))}).then(function(l){return l.default?l.default:l})}function n(){return(ft.DOMPurify?Promise.resolve(ft.DOMPurify):su(()=>Promise.resolve().then(()=>ib),void 0)).catch(function(l){return Promise.reject(new Error("Could not load dompurify: "+l))}).then(function(l){return l.default?l.default:l})}var r=function(l){var c=Ht(l);return c==="undefined"?"undefined":c==="string"||l instanceof String?"string":c==="number"||l instanceof Number?"number":c==="function"||l instanceof Function?"function":l&&l.constructor===Array?"array":l&&l.nodeType===1?"element":c==="object"?"object":"unknown"},a=function(l,c){var d=document.createElement(l);for(var h in c.className&&(d.className=c.className),c.innerHTML&&c.dompurify&&(d.innerHTML=c.dompurify.sanitize(c.innerHTML)),c.style)d.style[h]=c.style[h];return d},i=function l(c,d){for(var h=c.nodeType===3?document.createTextNode(c.nodeValue):c.cloneNode(!1),m=c.firstChild;m;m=m.nextSibling)d!==!0&&m.nodeType===1&&m.nodeName==="SCRIPT"||h.appendChild(l(m,d));return c.nodeType===1&&(c.nodeName==="CANVAS"?(h.width=c.width,h.height=c.height,h.getContext("2d").drawImage(c,0,0)):c.nodeName!=="TEXTAREA"&&c.nodeName!=="SELECT"||(h.value=c.value),h.addEventListener("load",function(){h.scrollTop=c.scrollTop,h.scrollLeft=c.scrollLeft},!0)),h},o=function l(c){var d=Object.assign(l.convert(Promise.resolve()),JSON.parse(JSON.stringify(l.template))),h=l.convert(Promise.resolve(),d);return(h=h.setProgress(1,l,1,[l])).set(c)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(l,c){return l.__proto__=c||o.prototype,l},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(l,c){return this.then(function(){switch(c=c||(function(d){switch(r(d)){case"string":return"string";case"element":return d.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(l),c){case"string":return this.then(n).then(function(d){return this.set({src:a("div",{innerHTML:l,dompurify:d})})});case"element":return this.set({src:l});case"canvas":return this.set({canvas:l});case"img":return this.set({img:l});default:return this.error("Unknown source type.")}})},o.prototype.to=function(l){switch(l){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var l={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},c=i(this.prop.src,this.opt.html2canvas.javascriptEnabled);c.tagName==="BODY"&&(l.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=a("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=a("div",{className:"html2pdf__container",style:l}),this.prop.container.appendChild(c),this.prop.container.firstChild.appendChild(a("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(c){var d=Object.assign({},this.opt.html2canvas);return delete d.onrendered,c(this.prop.container,d)}).then(function(c){(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(c){var d=this.opt.jsPDF,h=this.opt.fontFaces,m=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,b=Object.assign({async:!0,allowTaint:!0,scale:m,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete b.onrendered,d.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,d.context2d.posX=this.opt.x,d.context2d.posY=this.opt.y,d.context2d.margin=this.opt.margin,d.context2d.fontFaces=h,h)for(var p=0;p<h.length;++p){var _=h[p],w=_.src.find(function(S){return S.format==="truetype"});w&&d.addFont(w.url,_.ref.name,_.ref.style)}return b.windowHeight=b.windowHeight||0,b.windowHeight=b.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):b.windowHeight,d.context2d.save(!0),c(this.prop.container,b)}).then(function(c){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var l=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=l})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(l,c,d){return(d=d||"pdf").toLowerCase()==="img"||d.toLowerCase()==="image"?this.outputImg(l,c):this.outputPdf(l,c)},o.prototype.outputPdf=function(l,c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(l,c)})},o.prototype.outputImg=function(l){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(l){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+l+'" is not supported.'}})},o.prototype.save=function(l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(l?{filename:l}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(l){if(r(l)!=="object")return this;var c=Object.keys(l||{}).map(function(d){if(d in o.template.prop)return function(){this.prop[d]=l[d]};switch(d){case"margin":return this.setMargin.bind(this,l.margin);case"jsPDF":return function(){return this.opt.jsPDF=l.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,l.pageSize);default:return function(){this.opt[d]=l[d]}}},this);return this.then(function(){return this.thenList(c)})},o.prototype.get=function(l,c){return this.then(function(){var d=l in o.template.prop?this.prop[l]:this.opt[l];return c?c(d):d})},o.prototype.setMargin=function(l){return this.then(function(){switch(r(l)){case"number":l=[l,l,l,l];case"array":if(l.length===2&&(l=[l[0],l[1],l[0],l[1]]),l.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=l}).then(this.setPageSize)},o.prototype.setPageSize=function(l){function c(d,h){return Math.floor(d*h/72*96)}return this.then(function(){(l=l||Xe.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(l.inner={width:l.width-this.opt.margin[1]-this.opt.margin[3],height:l.height-this.opt.margin[0]-this.opt.margin[2]},l.inner.px={width:c(l.inner.width,l.k),height:c(l.inner.height,l.k)},l.inner.ratio=l.inner.height/l.inner.width),this.prop.pageSize=l})},o.prototype.setProgress=function(l,c,d,h){return l!=null&&(this.progress.val=l),c!=null&&(this.progress.state=c),d!=null&&(this.progress.n=d),h!=null&&(this.progress.stack=h),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(l,c,d,h){return this.setProgress(l?this.progress.val+l:null,c||null,d?this.progress.n+d:null,h?this.progress.stack.concat(h):null)},o.prototype.then=function(l,c){var d=this;return this.thenCore(l,c,function(h,m){return d.updateProgress(null,null,1,[h]),Promise.prototype.then.call(this,function(b){return d.updateProgress(null,h),b}).then(h,m).then(function(b){return d.updateProgress(1),b})})},o.prototype.thenCore=function(l,c,d){d=d||Promise.prototype.then;var h=this;l&&(l=l.bind(h)),c&&(c=c.bind(h));var m=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?h:o.convert(Object.assign({},h),Promise.prototype),b=d.call(m,l,c);return o.convert(b,h.__proto__)},o.prototype.thenExternal=function(l,c){return Promise.prototype.then.call(this,l,c)},o.prototype.thenList=function(l){var c=this;return l.forEach(function(d){c=c.thenCore(d)}),c},o.prototype.catch=function(l){l&&(l=l.bind(this));var c=Promise.prototype.catch.call(this,l);return o.convert(c,this)},o.prototype.catchExternal=function(l){return Promise.prototype.catch.call(this,l)},o.prototype.error=function(l){return this.then(function(){throw new Error(l)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,Xe.getPageSize=function(l,c,d){if(Ht(l)==="object"){var h=l;l=h.orientation,c=h.unit||c,d=h.format||d}c=c||"mm",d=d||"a4",l=(""+(l||"P")).toLowerCase();var m,b=(""+d).toLowerCase(),p={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(c){case"pt":m=1;break;case"mm":m=72/25.4;break;case"cm":m=72/2.54;break;case"in":m=72;break;case"px":m=.75;break;case"pc":case"em":m=12;break;case"ex":m=6;break;default:throw"Invalid unit: "+c}var _,w=0,S=0;if(p.hasOwnProperty(b))w=p[b][1]/m,S=p[b][0]/m;else try{w=d[1],S=d[0]}catch{throw new Error("Invalid format: "+d)}if(l==="p"||l==="portrait")l="p",S>w&&(_=S,S=w,w=_);else{if(l!=="l"&&l!=="landscape")throw"Invalid orientation: "+l;l="l",w>S&&(_=S,S=w,w=_)}return{width:S,height:w,unit:c,k:m,orientation:l}},t.html=function(l,c){(c=c||{}).callback=c.callback||function(){},c.html2canvas=c.html2canvas||{},c.html2canvas.canvas=c.html2canvas.canvas||this.canvas,c.jsPDF=c.jsPDF||this,c.fontFaces=c.fontFaces?c.fontFaces.map(Au):null;var d=new o(c);return c.worker?d:d.from(l).doCallback()}})(Xe.API),Xe.API.addJS=function(t){var e,n,r=(function(a){for(var i="",o=0;o<a.length;o++){var l=a[o];if(l==="("||l===")"){for(var c=0,d=o-1;d>=0&&a[d]==="\\";d--)c++;i+=c%2==0?"\\"+l:l}else i+=l}return i})(t);return this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(e+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),n=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+r+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){e!==void 0&&n!==void 0&&this.internal.out("/Names <</JavaScript "+e+" 0 R>>")}),this},(function(t){var e;t.events.push(["postPutResources",function(){var n=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var a=n.outline.render().split(/\r\n/),i=0;i<a.length;i++){var o=a[i],l=r.exec(o);if(l!=null){var c=l[1];n.internal.newObjectDeferredBegin(c,!1)}n.internal.write(o)}if(this.outline.createNamedDestinations){var d=this.internal.pages.length,h=[];for(i=0;i<d;i++){var m=n.internal.newObject();h.push(m);var b=n.internal.getPageInfo(i+1);n.internal.write("<< /D["+b.objId+" 0 R /XYZ null null null]>> endobj")}var p=n.internal.newObject();for(n.internal.write("<< /Names [ "),i=0;i<h.length;i++)n.internal.write("(page_"+(i+1)+")"+h[i]+" 0 R");n.internal.write(" ] >>","endobj"),e=n.internal.newObject(),n.internal.write("<< /Dests "+p+" 0 R"),n.internal.write(">>","endobj")}}]),t.events.push(["putCatalog",function(){var n=this;n.outline.root.children.length>0&&(n.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&n.internal.write("/Names "+e+" 0 R"))}]),t.events.push(["initialized",function(){var n=this;n.outline={createNamedDestinations:!1,root:{children:[]}},n.outline.add=function(r,a,i){var o={title:a,options:i,children:[]};return r==null&&(r=this.root),r.children.push(o),o},n.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=n,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},n.outline.genIds_r=function(r){r.id=n.internal.newObjectDeferred();for(var a=0;a<r.children.length;a++)this.genIds_r(r.children[a])},n.outline.renderRoot=function(r){this.objStart(r),this.line("/Type /Outlines"),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1]))),this.line("/Count "+this.count_r({count:0},r)),this.objEnd()},n.outline.renderItems=function(r){for(var a=this.ctx.pdf.internal.getVerticalCoordinateString,i=0;i<r.children.length;i++){var o=r.children[i];this.objStart(o),this.line("/Title "+this.makeString(o.title)),this.line("/Parent "+this.makeRef(r)),i>0&&this.line("/Prev "+this.makeRef(r.children[i-1])),i<r.children.length-1&&this.line("/Next "+this.makeRef(r.children[i+1])),o.children.length>0&&(this.line("/First "+this.makeRef(o.children[0])),this.line("/Last "+this.makeRef(o.children[o.children.length-1])));var l=this.count=this.count_r({count:0},o);if(l>0&&this.line("/Count "+l),o.options&&o.options.pageNumber){var c=n.internal.getPageInfo(o.options.pageNumber);this.line("/Dest ["+c.objId+" 0 R /XYZ 0 "+a(0)+" 0]")}this.objEnd()}for(var d=0;d<r.children.length;d++)this.renderItems(r.children[d])},n.outline.line=function(r){this.ctx.val+=r+`\r
`},n.outline.makeRef=function(r){return r.id+" 0 R"},n.outline.makeString=function(r){return"("+n.internal.pdfEscape(r)+")"},n.outline.objStart=function(r){this.ctx.val+=`\r
`+r.id+` 0 obj\r
<<\r
`},n.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},n.outline.count_r=function(r,a){for(var i=0;i<a.children.length;i++)r.count++,this.count_r(r,a.children[i]);return r.count}}])})(Xe.API),(function(t){var e=[192,193,194,195,196,197,198,199];t.processJPEG=function(n,r,a,i,o,l){var c,d=this.decode.DCT_DECODE,h=null;if(typeof n=="string"||this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n)){switch(n=o||n,n=this.__addimage__.isArrayBuffer(n)?new Uint8Array(n):n,c=(function(m){for(var b,p=256*m.charCodeAt(4)+m.charCodeAt(5),_=m.length,w={width:0,height:0,numcomponents:1},S=4;S<_;S+=2){if(S+=p,e.indexOf(m.charCodeAt(S+1))!==-1){b=256*m.charCodeAt(S+5)+m.charCodeAt(S+6),w={width:256*m.charCodeAt(S+7)+m.charCodeAt(S+8),height:b,numcomponents:m.charCodeAt(S+9)};break}p=256*m.charCodeAt(S+2)+m.charCodeAt(S+3)}return w})(n=this.__addimage__.isArrayBufferView(n)?this.__addimage__.arrayBufferToBinaryString(n):n),c.numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}h={data:n,width:c.width,height:c.height,colorSpace:l,bitsPerComponent:8,filter:d,index:r,alias:a}}return h}})(Xe.API),Xe.API.processPNG=function(t,e,n,r){if(this.__addimage__.isArrayBuffer(t)&&(t=new Uint8Array(t)),this.__addimage__.isArrayBufferView(t)){var a,i=by(t,{checkCrc:!0}),o=i.width,l=i.height,c=i.channels,d=i.palette,h=i.depth;a=d&&c===1?(function(q){for(var F=q.width,C=q.height,A=q.data,k=q.palette,M=q.depth,j=!1,U=[],re=[],ce=void 0,se=!1,fe=0,xe=0;xe<k.length;xe++){var ge=_f(k[xe],4),I=ge[0],z=ge[1],J=ge[2],X=ge[3];U.push(I,z,J),X!=null&&(X===0?(fe++,re.length<1&&re.push(xe)):X<255&&(se=!0))}if(se||fe>1){j=!0,re=void 0;var Z=F*C;ce=new Uint8Array(Z);for(var ae=new DataView(A.buffer),pe=0;pe<Z;pe++){var Y=Nu(ae,pe,M),oe=_f(k[Y],4)[3];ce[pe]=oe}}else fe===0&&(re=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:j?8:void 0,colorBytes:A,alphaBytes:ce,needSMask:j,palette:U,mask:re}})(i):c===2||c===4?(function(q){for(var F=q.data,C=q.width,A=q.height,k=q.channels,M=q.depth,j=k===2?"DeviceGray":"DeviceRGB",U=k-1,re=C*A,ce=U,se=re*ce,fe=1*re,xe=Math.ceil(se*M/8),ge=Math.ceil(fe*M/8),I=new Uint8Array(xe),z=new Uint8Array(ge),J=new DataView(F.buffer),X=new DataView(I.buffer),Z=new DataView(z.buffer),ae=!1,pe=0;pe<re;pe++){for(var Y=pe*k,oe=0;oe<ce;oe++)Sp(X,Nu(J,Y+oe,M),pe*ce+oe,M);var be=Nu(J,Y+ce,M);be<(1<<M)-1&&(ae=!0),Sp(Z,be,1*pe,M)}return{colorSpace:j,colorsPerPixel:U,sMaskBitsPerComponent:ae?M:void 0,colorBytes:I,alphaBytes:z,needSMask:ae}})(i):(function(q){var F=q.data,C=q.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:C,colorsPerPixel:C==="DeviceGray"?1:3,colorBytes:F instanceof Uint16Array?(function(A){for(var k=A.length,M=new Uint8Array(2*k),j=new DataView(M.buffer,M.byteOffset,M.byteLength),U=0;U<k;U++)j.setUint16(2*U,A[U],!1);return M})(F):F,needSMask:!1}})(i);var m,b,p,_=a,w=_.colorSpace,S=_.colorsPerPixel,x=_.sMaskBitsPerComponent,T=_.colorBytes,O=_.alphaBytes,L=_.needSMask,K=_.palette,te=_.mask,V=null;return r!==Xe.API.image_compression.NONE&&typeof td=="function"?(V=(function(q){var F;switch(q){case Xe.API.image_compression.FAST:F=11;break;case Xe.API.image_compression.MEDIUM:F=13;break;case Xe.API.image_compression.SLOW:F=14;break;default:F=12}return F})(r),m=this.decode.FLATE_DECODE,b="/Predictor ".concat(V," /Colors ").concat(S," /BitsPerComponent ").concat(h," /Columns ").concat(o),t=bp(T,Math.ceil(o*S*h/8),S,h,r),L&&(p=bp(O,Math.ceil(o*x/8),1,x,r))):(m=void 0,b=void 0,t=T,L&&(p=O)),(this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t))&&(t=this.__addimage__.arrayBufferToBinaryString(t)),(p&&this.__addimage__.isArrayBuffer(p)||this.__addimage__.isArrayBufferView(p))&&(p=this.__addimage__.arrayBufferToBinaryString(p)),{alias:n,data:t,index:e,filter:m,decodeParameters:b,transparency:te,palette:K,sMask:p,predictor:V,width:o,height:l,bitsPerComponent:h,sMaskBitsPerComponent:x,colorSpace:w}}},(function(t){t.processGIF89A=function(e,n,r,a){var i=new My(e),o=i.width,l=i.height,c=[];i.decodeAndBlitFrameRGBA(0,c);var d={data:c,width:o,height:l},h=new Eu(100).encode(d,100);return t.processJPEG.call(this,h,n,r,a)},t.processGIF87A=t.processGIF89A})(Xe.API),Kr.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var t=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var e=0;e<t;e++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:a,green:r,blue:n,quad:i}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Kr.prototype.parseBGR=function(){this.pos=this.offset;var t="bit"+this.bitPP,e=this.width*this.height*4;if(e>536870912)throw new Error("Image dimensions exceed 512MB, which is too large.");this.data=new Uint8Array(e);try{this[t]()}catch(n){Kt.log("bit decode error:"+n)}},Kr.prototype.bit1=function(){var t,e=Math.ceil(this.width/8),n=e%4;for(t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,a=0;a<e;a++)for(var i=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+8*a*4,l=0;l<8&&8*a+l<this.width;l++){var c=this.palette[i>>7-l&1];this.data[o+4*l]=c.blue,this.data[o+4*l+1]=c.green,this.data[o+4*l+2]=c.red,this.data[o+4*l+3]=255}n!==0&&(this.pos+=4-n)}},Kr.prototype.bit4=function(){for(var t=Math.ceil(this.width/2),e=t%4,n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,a=0;a<t;a++){var i=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+2*a*4,l=i>>4,c=15&i,d=this.palette[l];if(this.data[o]=d.blue,this.data[o+1]=d.green,this.data[o+2]=d.red,this.data[o+3]=255,2*a+1>=this.width)break;d=this.palette[c],this.data[o+4]=d.blue,this.data[o+4+1]=d.green,this.data[o+4+2]=d.red,this.data[o+4+3]=255}e!==0&&(this.pos+=4-e)}},Kr.prototype.bit8=function(){for(var t=this.width%4,e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var a=this.datav.getUint8(this.pos++,!0),i=n*this.width*4+4*r;if(a<this.palette.length){var o=this.palette[a];this.data[i]=o.red,this.data[i+1]=o.green,this.data[i+2]=o.blue,this.data[i+3]=255}else this.data[i]=255,this.data[i+1]=255,this.data[i+2]=255,this.data[i+3]=255}t!==0&&(this.pos+=4-t)}},Kr.prototype.bit15=function(){for(var t=this.width%3,e=parseInt("11111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,a=0;a<this.width;a++){var i=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(i&e)/e*255|0,l=(i>>5&e)/e*255|0,c=(i>>10&e)/e*255|0,d=i>>15?255:0,h=r*this.width*4+4*a;this.data[h]=c,this.data[h+1]=l,this.data[h+2]=o,this.data[h+3]=d}this.pos+=t}},Kr.prototype.bit16=function(){for(var t=this.width%3,e=parseInt("11111",2),n=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var a=this.bottom_up?r:this.height-1-r,i=0;i<this.width;i++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(o&e)/e*255|0,c=(o>>5&n)/n*255|0,d=(o>>11)/e*255|0,h=a*this.width*4+4*i;this.data[h]=d,this.data[h+1]=c,this.data[h+2]=l,this.data[h+3]=255}this.pos+=t}},Kr.prototype.bit24=function(){for(var t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*n;this.data[o]=i,this.data[o+1]=a,this.data[o+2]=r,this.data[o+3]=255}this.pos+=this.width%4}},Kr.prototype.bit32=function(){for(var t=this.height-1;t>=0;t--)for(var e=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),l=e*this.width*4+4*n;this.data[l]=i,this.data[l+1]=a,this.data[l+2]=r,this.data[l+3]=o}},Kr.prototype.getData=function(){return this.data},(function(t){t.processBMP=function(e,n,r,a){var i=new Kr(e,!1),o=i.width,l=i.height,c={data:i.getData(),width:o,height:l},d=new Eu(100).encode(c,100);return t.processJPEG.call(this,d,n,r,a)}})(Xe.API),kp.prototype.getData=function(){return this.data},(function(t){t.processWEBP=function(e,n,r,a){var i=new kp(e),o=i.width,l=i.height,c={data:i.getData(),width:o,height:l},d=new Eu(100).encode(c,100);return t.processJPEG.call(this,d,n,r,a)}})(Xe.API),Xe.API.processRGBA=function(t,e,n){for(var r=t.data,a=r.length,i=new Uint8Array(a/4*3),o=new Uint8Array(a/4),l=0,c=0,d=0;d<a;d+=4){var h=r[d],m=r[d+1],b=r[d+2],p=r[d+3];i[l++]=h,i[l++]=m,i[l++]=b,o[c++]=p}var _=this.__addimage__.arrayBufferToBinaryString(i);return{alpha:this.__addimage__.arrayBufferToBinaryString(o),data:_,index:e,alias:n,colorSpace:"DeviceRGB",bitsPerComponent:8,width:t.width,height:t.height}},Xe.API.setLanguage=function(t){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[t]!==void 0&&(this.internal.languageSettings.languageCode=t,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},us=Xe.API,Ll=us.getCharWidthsArray=function(t,e){var n,r,a=(e=e||{}).font||this.internal.getFont(),i=e.fontSize||this.internal.getFontSize(),o=e.charSpace||this.internal.getCharSpace(),l=e.widths?e.widths:a.metadata.Unicode.widths,c=l.fof?l.fof:1,d=e.kerning?e.kerning:a.metadata.Unicode.kerning,h=d.fof?d.fof:1,m=e.doKerning!==!1,b=0,p=t.length,_=0,w=l[0]||c,S=[];for(n=0;n<p;n++)r=t.charCodeAt(n),typeof a.metadata.widthOfString=="function"?S.push((a.metadata.widthOfGlyph(a.metadata.characterToGlyph(r))+o*(1e3/i)||0)/1e3):(b=m&&Ht(d[r])==="object"&&!isNaN(parseInt(d[r][_],10))?d[r][_]/h:0,S.push((l[r]||w)/c+b)),_=r;return S},gp=us.getStringUnitWidth=function(t,e){var n=(e=e||{}).fontSize||this.internal.getFontSize(),r=e.font||this.internal.getFont(),a=e.charSpace||this.internal.getCharSpace();return us.processArabic&&(t=us.processArabic(t)),typeof r.metadata.widthOfString=="function"?r.metadata.widthOfString(t,n,a)/n:Ll.apply(this,arguments).reduce(function(i,o){return i+o},0)},mp=function(t,e,n,r){for(var a=[],i=0,o=t.length,l=0;i!==o&&l+e[i]<n;)l+=e[i],i++;a.push(t.slice(0,i));var c=i;for(l=0;i!==o;)l+e[i]>r&&(a.push(t.slice(c,i)),l=0,c=i),l+=e[i],i++;return c!==i&&a.push(t.slice(c,i)),a},vp=function(t,e,n){n||(n={});var r,a,i,o,l,c,d,h=[],m=[h],b=n.textIndent||0,p=0,_=0,w=t.split(" "),S=Ll.apply(this,[" ",n])[0];if(c=n.lineIndent===-1?w[0].length+2:n.lineIndent||0){var x=Array(c).join(" "),T=[];w.map(function(L){(L=L.split(/\s*\n/)).length>1?T=T.concat(L.map(function(K,te){return(te&&K.length?`
`:"")+K})):T.push(L[0])}),w=T,c=gp.apply(this,[x,n])}for(i=0,o=w.length;i<o;i++){var O=0;if(r=w[i],c&&r[0]==`
`&&(r=r.substr(1),O=1),b+p+(_=(a=Ll.apply(this,[r,n])).reduce(function(L,K){return L+K},0))>e||O){if(_>e){for(l=mp.apply(this,[r,a,e-(b+p),e]),h.push(l.shift()),h=[l.pop()];l.length;)m.push([l.shift()]);_=a.slice(r.length-(h[0]?h[0].length:0)).reduce(function(L,K){return L+K},0)}else h=[r];m.push(h),b=_+c,p=S}else h.push(r),b+=p+_,p=S}return d=c?function(L,K){return(K?x:"")+L.join(" ")}:function(L){return L.join(" ")},m.map(d)},us.splitTextToSize=function(t,e,n){var r,a=(n=n||{}).fontSize||this.internal.getFontSize(),i=(function(h){if(h.widths&&h.kerning)return{widths:h.widths,kerning:h.kerning};var m=this.internal.getFont(h.fontName,h.fontStyle),b="Unicode";return m.metadata[b]?{widths:m.metadata[b].widths||{0:1},kerning:m.metadata[b].kerning||{}}:{font:m.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,n);r=Array.isArray(t)?t:String(t).split(/\r?\n/);var o=1*this.internal.scaleFactor*e/a;i.textIndent=n.textIndent?1*n.textIndent*this.internal.scaleFactor/a:0,i.lineIndent=n.lineIndent;var l,c,d=[];for(l=0,c=r.length;l<c;l++)d=d.concat(vp.apply(this,[r[l],o,i]));return d},(function(t){t.__fontmetrics__=t.__fontmetrics__||{};for(var e="0123456789abcdef",n="klmnopqrstuvwxyz",r={},a={},i=0;i<16;i++)r[n[i]]=e[i],a[e[i]]=n[i];var o=function(b){return"0x"+parseInt(b,10).toString(16)},l=t.__fontmetrics__.compress=function(b){var p,_,w,S,x=["{"];for(var T in b){if(p=b[T],isNaN(parseInt(T,10))?_="'"+T+"'":(T=parseInt(T,10),_=(_=o(T).slice(2)).slice(0,-1)+a[_.slice(-1)]),typeof p=="number")p<0?(w=o(p).slice(3),S="-"):(w=o(p).slice(2),S=""),w=S+w.slice(0,-1)+a[w.slice(-1)];else{if(Ht(p)!=="object")throw new Error("Don't know what to do with value type "+Ht(p)+".");w=l(p)}x.push(_+w)}return x.push("}"),x.join("")},c=t.__fontmetrics__.uncompress=function(b){if(typeof b!="string")throw new Error("Invalid argument passed to uncompress.");for(var p,_,w,S,x={},T=1,O=x,L=[],K="",te="",V=b.length-1,q=1;q<V;q+=1)(S=b[q])=="'"?p?(w=p.join(""),p=void 0):p=[]:p?p.push(S):S=="{"?(L.push([O,w]),O={},w=void 0):S=="}"?((_=L.pop())[0][_[1]]=O,w=void 0,O=_[0]):S=="-"?T=-1:w===void 0?r.hasOwnProperty(S)?(K+=r[S],w=parseInt(K,16)*T,T=1,K=""):K+=S:r.hasOwnProperty(S)?(te+=r[S],O[w]=parseInt(te,16)*T,T=1,w=void 0,te=""):te+=S;return x},d={codePages:["WinAnsiEncoding"],WinAnsiEncoding:c("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},h={Unicode:{Courier:d,"Courier-Bold":d,"Courier-BoldOblique":d,"Courier-Oblique":d,Helvetica:d,"Helvetica-Bold":d,"Helvetica-BoldOblique":d,"Helvetica-Oblique":d,"Times-Roman":d,"Times-Bold":d,"Times-BoldItalic":d,"Times-Italic":d}},m={Unicode:{"Courier-Oblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":c("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":c("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:c("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:c("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":c("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":c("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};t.events.push(["addFont",function(b){var p=b.font,_=m.Unicode[p.postScriptName];_&&(p.metadata.Unicode={},p.metadata.Unicode.widths=_.widths,p.metadata.Unicode.kerning=_.kerning);var w=h.Unicode[p.postScriptName];w&&(p.metadata.Unicode.encoding=w,p.encoding=w.codePages[0])}])})(Xe.API),(function(t){var e=function(n){for(var r=n.length,a=new Uint8Array(r),i=0;i<r;i++)a[i]=n.charCodeAt(i);return a};t.API.events.push(["addFont",function(n){var r=void 0,a=n.font,i=n.instance;if(!a.isStandardFont){if(i===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");if(typeof(r=i.existsFileInVFS(a.postScriptName)===!1?i.loadFile(a.postScriptName):i.getFileFromVFS(a.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+a.postScriptName+"').");(function(o,l){l=/^\x00\x01\x00\x00/.test(l)?e(l):e(Fl(l)),o.metadata=t.API.TTFFont.open(l),o.metadata.Unicode=o.metadata.Unicode||{encoding:{},kerning:{},widths:[]},o.metadata.glyIdsUsed=[0]})(a,r)}}])})(Xe),Xe.API.addSvgAsImage=function(t,e,n,r,a,i,o,l){if(isNaN(e)||isNaN(n))throw Kt.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(r)||isNaN(a))throw Kt.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=r,c.height=a;var d=c.getContext("2d");d.fillStyle="#fff",d.fillRect(0,0,c.width,c.height);var h={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},m=this;return(ft.canvg?Promise.resolve(ft.canvg):su(()=>import("./index.es-D4xIGdTr.js"),[])).catch(function(b){return Promise.reject(new Error("Could not load canvg: "+b))}).then(function(b){return b.default?b.default:b}).then(function(b){return b.fromString(d,t,h)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(b){return b.render(h)}).then(function(){m.addImage(c.toDataURL("image/jpeg",1),e,n,r,a,o,l)})},Xe.API.putTotalPages=function(t){var e,n=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(t,"g"),n=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(t,this.internal.getFont()),"g"),n=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var a=0;a<this.internal.pages[r].length;a++)this.internal.pages[r][a]=this.internal.pages[r][a].replace(e,n);return this},Xe.API.viewerPreferences=function(t,e){var n;t=t||{},e=e||!1;var r,a,i,o={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(o),c=[],d=0,h=0,m=0;function b(_,w){var S,x=!1;for(S=0;S<_.length;S+=1)_[S]===w&&(x=!0);return x}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(o)),this.internal.viewerpreferences.isSubscribed=!1),n=this.internal.viewerpreferences.configuration,t==="reset"||e===!0){var p=l.length;for(m=0;m<p;m+=1)n[l[m]].value=n[l[m]].defaultValue,n[l[m]].explicitSet=!1}if(Ht(t)==="object"){for(a in t)if(i=t[a],b(l,a)&&i!==void 0){if(n[a].type==="boolean"&&typeof i=="boolean")n[a].value=i;else if(n[a].type==="name"&&b(n[a].valueSet,i))n[a].value=i;else if(n[a].type==="integer"&&Number.isInteger(i))n[a].value=i;else if(n[a].type==="array"){for(d=0;d<i.length;d+=1)if(r=!0,i[d].length===1&&typeof i[d][0]=="number")c.push(String(i[d]-1));else if(i[d].length>1){for(h=0;h<i[d].length;h+=1)typeof i[d][h]!="number"&&(r=!1);r===!0&&c.push([i[d][0]-1,i[d][1]-1].join(" "))}n[a].value="["+c.join(" ")+"]"}else n[a].value=n[a].defaultValue;n[a].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var _,w=[];for(_ in n)n[_].explicitSet===!0&&(n[_].type==="name"?w.push("/"+_+" /"+n[_].value):w.push("/"+_+" "+n[_].value));w.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+w.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=n,this},Xe.API.addMetadata=function(t,e){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:t,namespaceUri:e??"http://jspdf.default.namespaceuri/",rawXml:typeof e=="boolean"&&e},this.internal.events.subscribe("putCatalog",$y),this.internal.events.subscribe("postPutResources",Uy)),this},(function(t){var e=t.API,n=e.pdfEscape16=function(i,o){for(var l,c=o.metadata.Unicode.widths,d=["","0","00","000","0000"],h=[""],m=0,b=i.length;m<b;++m){if(l=o.metadata.characterToGlyph(i.charCodeAt(m)),o.metadata.glyIdsUsed.push(l),o.metadata.toUnicode[l]=i.charCodeAt(m),c.indexOf(l)==-1&&(c.push(l),c.push([parseInt(o.metadata.widthOfGlyph(l),10)])),l=="0")return h.join("");l=l.toString(16),h.push(d[4-l.length],l)}return h.join("")},r=function(i){var o,l,c,d,h,m,b;for(h=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,c=[],m=0,b=(l=Object.keys(i).sort(function(p,_){return p-_})).length;m<b;m++)o=l[m],c.length>=100&&(h+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar`,c=[]),i[o]!==void 0&&i[o]!==null&&typeof i[o].toString=="function"&&(d=("0000"+i[o].toString(16)).slice(-4),o=("0000"+(+o).toString(16)).slice(-4),c.push("<"+o+"><"+d+">"));return c.length&&(h+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar
`),h+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(i){(function(o){var l=o.font,c=o.out,d=o.newObject,h=o.putStream;if(l.metadata instanceof t.API.TTFFont&&l.encoding==="Identity-H"){for(var m=l.metadata.Unicode.widths,b=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),p="",_=0;_<b.length;_++)p+=String.fromCharCode(b[_]);var w=d();h({data:p,addLength1:!0,objectId:w}),c("endobj");var S=d();h({data:r(l.metadata.toUnicode),addLength1:!0,objectId:S}),c("endobj");var x=d();c("<<"),c("/Type /FontDescriptor"),c("/FontName /"+gs(l.fontName)),c("/FontFile2 "+w+" 0 R"),c("/FontBBox "+t.API.PDFObject.convert(l.metadata.bbox)),c("/Flags "+l.metadata.flags),c("/StemV "+l.metadata.stemV),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c(">>"),c("endobj");var T=d();c("<<"),c("/Type /Font"),c("/BaseFont /"+gs(l.fontName)),c("/FontDescriptor "+x+" 0 R"),c("/W "+t.API.PDFObject.convert(m)),c("/CIDToGIDMap /Identity"),c("/DW 1000"),c("/Subtype /CIDFontType2"),c("/CIDSystemInfo"),c("<<"),c("/Supplement 0"),c("/Registry (Adobe)"),c("/Ordering ("+l.encoding+")"),c(">>"),c(">>"),c("endobj"),l.objectNumber=d(),c("<<"),c("/Type /Font"),c("/Subtype /Type0"),c("/ToUnicode "+S+" 0 R"),c("/BaseFont /"+gs(l.fontName)),c("/Encoding /"+l.encoding),c("/DescendantFonts ["+T+" 0 R]"),c(">>"),c("endobj"),l.isAlreadyPutted=!0}})(i)}]),e.events.push(["putFont",function(i){(function(o){var l=o.font,c=o.out,d=o.newObject,h=o.putStream;if(l.metadata instanceof t.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var m=l.metadata.rawData,b="",p=0;p<m.length;p++)b+=String.fromCharCode(m[p]);var _=d();h({data:b,addLength1:!0,objectId:_}),c("endobj");var w=d();h({data:r(l.metadata.toUnicode),addLength1:!0,objectId:w}),c("endobj");var S=d();c("<<"),c("/Descent "+l.metadata.decender),c("/CapHeight "+l.metadata.capHeight),c("/StemV "+l.metadata.stemV),c("/Type /FontDescriptor"),c("/FontFile2 "+_+" 0 R"),c("/Flags 96"),c("/FontBBox "+t.API.PDFObject.convert(l.metadata.bbox)),c("/FontName /"+gs(l.fontName)),c("/ItalicAngle "+l.metadata.italicAngle),c("/Ascent "+l.metadata.ascender),c(">>"),c("endobj"),l.objectNumber=d();for(var x=0;x<l.metadata.hmtx.widths.length;x++)l.metadata.hmtx.widths[x]=parseInt(l.metadata.hmtx.widths[x]*(1e3/l.metadata.head.unitsPerEm));c("<</Subtype/TrueType/Type/Font/ToUnicode "+w+" 0 R/BaseFont/"+gs(l.fontName)+"/FontDescriptor "+S+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+t.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),c("endobj"),l.isAlreadyPutted=!0}})(i)}]);var a=function(i){var o,l=i.text||"",c=i.x,d=i.y,h=i.options||{},m=i.mutex||{},b=m.pdfEscape,p=m.activeFontKey,_=m.fonts,w=p,S="",x=0,T="",O=_[w].encoding;if(_[w].encoding!=="Identity-H")return{text:l,x:c,y:d,options:h,mutex:m};for(T=l,w=p,Array.isArray(l)&&(T=l[0]),x=0;x<T.length;x+=1)_[w].metadata.hasOwnProperty("cmap")&&(o=_[w].metadata.cmap.unicode.codeMap[T[x].charCodeAt(0)]),o||T[x].charCodeAt(0)<256&&_[w].metadata.hasOwnProperty("Unicode")?S+=T[x]:S+="";var L="";return parseInt(w.slice(1))<14||O==="WinAnsiEncoding"?L=b(S,w).split("").map(function(K){return K.charCodeAt(0).toString(16)}).join(""):O==="Identity-H"&&(L=n(S,_[w])),m.isHex=!0,{text:L,x:c,y:d,options:h,mutex:m}};e.events.push(["postProcessText",function(i){var o=i.text||"",l=[],c={text:o,x:i.x,y:i.y,options:i.options,mutex:i.mutex};if(Array.isArray(o)){var d=0;for(d=0;d<o.length;d+=1)Array.isArray(o[d])&&o[d].length===3?l.push([a(Object.assign({},c,{text:o[d][0]})).text,o[d][1],o[d][2]]):l.push(a(Object.assign({},c,{text:o[d]})).text);i.text=l}else i.text=a(Object.assign({},c,{text:o})).text}])})(Xe),(function(t){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};t.existsFileInVFS=function(n){return e.call(this),this.internal.vFS[n]!==void 0},t.addFileToVFS=function(n,r){return e.call(this),this.internal.vFS[n]=r,this},t.getFileFromVFS=function(n){return e.call(this),this.internal.vFS[n]!==void 0?this.internal.vFS[n]:null}})(Xe.API),(function(t){t.__bidiEngine__=t.prototype.__bidiEngine__=function(r){var a,i,o,l,c,d,h,m=e,b=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],p=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],_={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},w={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},S=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],x=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),T=!1,O=0;this.__bidiEngine__={};var L=function(A){var k=A.charCodeAt(),M=k>>8,j=w[M];return j!==void 0?m[256*j+(255&k)]:M===252||M===253?"AL":x.test(M)?"L":M===8?"R":"N"},K=function(A){for(var k,M=0;M<A.length;M++){if((k=L(A.charAt(M)))==="L")return!1;if(k==="R")return!0}return!1},te=function(A,k,M,j){var U,re,ce,se,fe=k[j];switch(fe){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":T=!1;break;case"N":case"AN":break;case"EN":T&&(fe="AN");break;case"AL":T=!0,fe="R";break;case"WS":case"BN":fe="N";break;case"CS":j<1||j+1>=k.length||(U=M[j-1])!=="EN"&&U!=="AN"||(re=k[j+1])!=="EN"&&re!=="AN"?fe="N":T&&(re="AN"),fe=re===U?re:"N";break;case"ES":fe=(U=j>0?M[j-1]:"B")==="EN"&&j+1<k.length&&k[j+1]==="EN"?"EN":"N";break;case"ET":if(j>0&&M[j-1]==="EN"){fe="EN";break}if(T){fe="N";break}for(ce=j+1,se=k.length;ce<se&&k[ce]==="ET";)ce++;fe=ce<se&&k[ce]==="EN"?"EN":"N";break;case"NSM":if(o&&!l){for(se=k.length,ce=j+1;ce<se&&k[ce]==="NSM";)ce++;if(ce<se){var xe=A[j],ge=xe>=1425&&xe<=2303||xe===64286;if(U=k[ce],ge&&(U==="R"||U==="AL")){fe="R";break}}}fe=j<1||(U=k[j-1])==="B"?"N":M[j-1];break;case"B":T=!1,a=!0,fe=O;break;case"S":i=!0,fe="N"}return fe},V=function(A,k,M){var j=A.split("");return M&&q(j,M,{hiLevel:O}),j.reverse(),k&&k.reverse(),j.join("")},q=function(A,k,M){var j,U,re,ce,se,fe=-1,xe=A.length,ge=0,I=[],z=O?p:b,J=[];for(T=!1,a=!1,i=!1,U=0;U<xe;U++)J[U]=L(A[U]);for(re=0;re<xe;re++){if(se=ge,I[re]=te(A,J,I,re),j=240&(ge=z[se][_[I[re]]]),ge&=15,k[re]=ce=z[ge][5],j>0)if(j===16){for(U=fe;U<re;U++)k[U]=1;fe=-1}else fe=-1;if(z[ge][6])fe===-1&&(fe=re);else if(fe>-1){for(U=fe;U<re;U++)k[U]=ce;fe=-1}J[re]==="B"&&(k[re]=0),M.hiLevel|=ce}i&&(function(X,Z,ae){for(var pe=0;pe<ae;pe++)if(X[pe]==="S"){Z[pe]=O;for(var Y=pe-1;Y>=0&&X[Y]==="WS";Y--)Z[Y]=O}})(J,k,xe)},F=function(A,k,M,j,U){if(!(U.hiLevel<A)){if(A===1&&O===1&&!a)return k.reverse(),void(M&&M.reverse());for(var re,ce,se,fe,xe=k.length,ge=0;ge<xe;){if(j[ge]>=A){for(se=ge+1;se<xe&&j[se]>=A;)se++;for(fe=ge,ce=se-1;fe<ce;fe++,ce--)re=k[fe],k[fe]=k[ce],k[ce]=re,M&&(re=M[fe],M[fe]=M[ce],M[ce]=re);ge=se}ge++}}},C=function(A,k,M){var j=A.split(""),U={hiLevel:O};return M||(M=[]),q(j,M,U),(function(re,ce,se){if(se.hiLevel!==0&&h)for(var fe,xe=0;xe<re.length;xe++)ce[xe]===1&&(fe=S.indexOf(re[xe]))>=0&&(re[xe]=S[fe+1])})(j,M,U),F(2,j,k,M,U),F(1,j,k,M,U),j.join("")};return this.__bidiEngine__.doBidiReorder=function(A,k,M){if((function(U,re){if(re)for(var ce=0;ce<U.length;ce++)re[ce]=ce;l===void 0&&(l=K(U)),d===void 0&&(d=K(U))})(A,k),o||!c||d)if(o&&c&&l^d)O=l?1:0,A=V(A,k,M);else if(!o&&c&&d)O=l?1:0,A=C(A,k,M),A=V(A,k);else if(!o||l||c||d){if(o&&!c&&l^d)A=V(A,k),l?(O=0,A=C(A,k,M)):(O=1,A=C(A,k,M),A=V(A,k));else if(o&&l&&!c&&d)O=1,A=C(A,k,M),A=V(A,k);else if(!o&&!c&&l^d){var j=h;l?(O=1,A=C(A,k,M),O=0,h=!1,A=C(A,k,M),h=j):(O=0,A=C(A,k,M),A=V(A,k),O=1,h=!1,A=C(A,k,M),h=j,A=V(A,k))}}else O=0,A=C(A,k,M);else O=l?1:0,A=C(A,k,M);return A},this.__bidiEngine__.setOptions=function(A){A&&(o=A.isInputVisual,c=A.isOutputVisual,l=A.isInputRtl,d=A.isOutputRtl,h=A.isSymmetricSwapping)},this.__bidiEngine__.setOptions(r),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],n=new t.__bidiEngine__({isInputVisual:!0});t.API.events.push(["postProcessText",function(r){var a=r.text;r.x,r.y;var i=r.options||{};r.mutex,i.lang;var o=[];if(i.isInputVisual=typeof i.isInputVisual!="boolean"||i.isInputVisual,n.setOptions(i),Object.prototype.toString.call(a)==="[object Array]"){var l=0;for(o=[],l=0;l<a.length;l+=1)Object.prototype.toString.call(a[l])==="[object Array]"?o.push([n.doBidiReorder(a[l][0]),a[l][1],a[l][2]]):o.push([n.doBidiReorder(a[l])]);r.text=o}else r.text=n.doBidiReorder(a);n.setOptions({isInputVisual:!0})}])})(Xe),Xe.API.TTFFont=(function(){function t(e){var n;if(this.rawData=e,n=this.contents=new ua(e),this.contents.pos=4,n.readString(4)==="ttcf")throw new Error("TTCF not supported.");n.pos=0,this.parse(),this.subset=new n_(this),this.registerTTF()}return t.open=function(e){return new t(e)},t.prototype.parse=function(){return this.directory=new qy(this.contents),this.head=new Hy(this),this.name=new Jy(this),this.cmap=new hm(this),this.toUnicode={},this.hhea=new Wy(this),this.maxp=new Yy(this),this.hmtx=new Xy(this),this.post=new Vy(this),this.os2=new Gy(this),this.loca=new t_(this),this.glyf=new Zy(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},t.prototype.registerTTF=function(){var e,n,r,a,i;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var o,l,c,d;for(d=[],o=0,l=(c=this.bbox).length;o<l;o++)e=c[o],d.push(Math.round(e*this.scaleFactor));return d}).call(this),this.stemV=0,this.post.exists?(r=255&(a=this.post.italic_angle),32768&(n=a>>16)&&(n=-(1+(65535^n))),this.italicAngle=+(n+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(i=this.familyClass)===1||i===2||i===3||i===4||i===5||i===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},t.prototype.characterToGlyph=function(e){var n;return((n=this.cmap.unicode)!=null?n.codeMap[e]:void 0)||0},t.prototype.widthOfGlyph=function(e){var n;return n=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*n},t.prototype.widthOfString=function(e,n,r){var a,i,o,l;for(o=0,i=0,l=(e=""+e).length;0<=l?i<l:i>l;i=0<=l?++i:--i)a=e.charCodeAt(i),o+=this.widthOfGlyph(this.characterToGlyph(a))+r*(1e3/n)||0;return o*(n/1e3)},t.prototype.lineHeight=function(e,n){var r;return n==null&&(n=!1),r=n?this.lineGap:0,(this.ascender+r-this.decender)/1e3*e},t})();var ri,ua=(function(){function t(e){this.data=e??[],this.pos=0,this.length=this.data.length}return t.prototype.readByte=function(){return this.data[this.pos++]},t.prototype.writeByte=function(e){return this.data[this.pos++]=e},t.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},t.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},t.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},t.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},t.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},t.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},t.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},t.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},t.prototype.readString=function(e){var n,r;for(r=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)r[n]=String.fromCharCode(this.readByte());return r.join("")},t.prototype.writeString=function(e){var n,r,a;for(a=[],n=0,r=e.length;0<=r?n<r:n>r;n=0<=r?++n:--n)a.push(this.writeByte(e.charCodeAt(n)));return a},t.prototype.readShort=function(){return this.readInt16()},t.prototype.writeShort=function(e){return this.writeInt16(e)},t.prototype.readLongLong=function(){var e,n,r,a,i,o,l,c;return e=this.readByte(),n=this.readByte(),r=this.readByte(),a=this.readByte(),i=this.readByte(),o=this.readByte(),l=this.readByte(),c=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^n)+1099511627776*(255^r)+4294967296*(255^a)+16777216*(255^i)+65536*(255^o)+256*(255^l)+(255^c)+1):72057594037927940*e+281474976710656*n+1099511627776*r+4294967296*a+16777216*i+65536*o+256*l+c},t.prototype.writeLongLong=function(e){var n,r;return n=Math.floor(e/4294967296),r=4294967295&e,this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},t.prototype.readInt=function(){return this.readInt32()},t.prototype.writeInt=function(e){return this.writeInt32(e)},t.prototype.read=function(e){var n,r;for(n=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)n.push(this.readByte());return n},t.prototype.write=function(e){var n,r,a,i;for(i=[],r=0,a=e.length;r<a;r++)n=e[r],i.push(this.writeByte(n));return i},t})(),qy=(function(){var t;function e(n){var r,a,i;for(this.scalarType=n.readInt(),this.tableCount=n.readShort(),this.searchRange=n.readShort(),this.entrySelector=n.readShort(),this.rangeShift=n.readShort(),this.tables={},a=0,i=this.tableCount;0<=i?a<i:a>i;a=0<=i?++a:--a)r={tag:n.readString(4),checksum:n.readInt(),offset:n.readInt(),length:n.readInt()},this.tables[r.tag]=r}return e.prototype.encode=function(n){var r,a,i,o,l,c,d,h,m,b,p,_,w;for(w in p=Object.keys(n).length,c=Math.log(2),m=16*Math.floor(Math.log(p)/c),o=Math.floor(m/c),h=16*p-m,(a=new ua).writeInt(this.scalarType),a.writeShort(p),a.writeShort(m),a.writeShort(o),a.writeShort(h),i=16*p,d=a.pos+i,l=null,_=[],n)for(b=n[w],a.writeString(w),a.writeInt(t(b)),a.writeInt(d),a.writeInt(b.length),_=_.concat(b),w==="head"&&(l=d),d+=b.length;d%4;)_.push(0),d++;return a.write(_),r=2981146554-t(a.data),a.pos=l+8,a.writeUInt32(r),a.data},t=function(n){var r,a,i,o;for(n=fm.call(n);n.length%4;)n.push(0);for(i=new ua(n),a=0,r=0,o=n.length;r<o;r=r+=4)a+=i.readUInt32();return 4294967295&a},e})(),zy={}.hasOwnProperty,bi=function(t,e){for(var n in e)zy.call(e,n)&&(t[n]=e[n]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};ri=(function(){function t(e){var n;this.file=e,n=this.file.directory.tables[this.tag],this.exists=!!n,n&&(this.offset=n.offset,this.length=n.length,this.parse(this.file.contents))}return t.prototype.parse=function(){},t.prototype.encode=function(){},t.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},t})();var Hy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="head",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},t.prototype.encode=function(e){var n;return(n=new ua).writeInt(this.version),n.writeInt(this.revision),n.writeInt(this.checkSumAdjustment),n.writeInt(this.magicNumber),n.writeShort(this.flags),n.writeShort(this.unitsPerEm),n.writeLongLong(this.created),n.writeLongLong(this.modified),n.writeShort(this.xMin),n.writeShort(this.yMin),n.writeShort(this.xMax),n.writeShort(this.yMax),n.writeShort(this.macStyle),n.writeShort(this.lowestRecPPEM),n.writeShort(this.fontDirectionHint),n.writeShort(e),n.writeShort(this.glyphDataFormat),n.data},t})(),Np=(function(){function t(e,n){var r,a,i,o,l,c,d,h,m,b,p,_,w,S,x,T,O;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=n+e.readInt(),m=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(c=0;c<256;++c)this.codeMap[c]=e.readByte();break;case 4:for(p=e.readUInt16(),b=p/2,e.pos+=6,i=(function(){var L,K;for(K=[],c=L=0;0<=b?L<b:L>b;c=0<=b?++L:--L)K.push(e.readUInt16());return K})(),e.pos+=2,w=(function(){var L,K;for(K=[],c=L=0;0<=b?L<b:L>b;c=0<=b?++L:--L)K.push(e.readUInt16());return K})(),d=(function(){var L,K;for(K=[],c=L=0;0<=b?L<b:L>b;c=0<=b?++L:--L)K.push(e.readUInt16());return K})(),h=(function(){var L,K;for(K=[],c=L=0;0<=b?L<b:L>b;c=0<=b?++L:--L)K.push(e.readUInt16());return K})(),a=(this.length-e.pos+this.offset)/2,l=(function(){var L,K;for(K=[],c=L=0;0<=a?L<a:L>a;c=0<=a?++L:--L)K.push(e.readUInt16());return K})(),c=x=0,O=i.length;x<O;c=++x)for(S=i[c],r=T=_=w[c];_<=S?T<=S:T>=S;r=_<=S?++T:--T)h[c]===0?o=r+d[c]:(o=l[h[c]/2+(r-_)-(b-c)]||0)!==0&&(o+=d[c]),this.codeMap[r]=65535&o}e.pos=m}return t.encode=function(e,n){var r,a,i,o,l,c,d,h,m,b,p,_,w,S,x,T,O,L,K,te,V,q,F,C,A,k,M,j,U,re,ce,se,fe,xe,ge,I,z,J,X,Z,ae,pe,Y,oe,be,Ce;switch(j=new ua,o=Object.keys(e).sort(function(Te,je){return Te-je}),n){case"macroman":for(w=0,S=(function(){var Te=[];for(_=0;_<256;++_)Te.push(0);return Te})(),T={0:0},i={},U=0,fe=o.length;U<fe;U++)T[Y=e[a=o[U]]]==null&&(T[Y]=++w),i[a]={old:e[a],new:T[e[a]]},S[a]=T[e[a]];return j.writeUInt16(1),j.writeUInt16(0),j.writeUInt32(12),j.writeUInt16(0),j.writeUInt16(262),j.writeUInt16(0),j.write(S),{charMap:i,subtable:j.data,maxGlyphID:w+1};case"unicode":for(k=[],m=[],O=0,T={},r={},x=d=null,re=0,xe=o.length;re<xe;re++)T[K=e[a=o[re]]]==null&&(T[K]=++O),r[a]={old:K,new:T[K]},l=T[K]-a,x!=null&&l===d||(x&&m.push(x),k.push(a),d=l),x=a;for(x&&m.push(x),m.push(65535),k.push(65535),C=2*(F=k.length),q=2*Math.pow(Math.log(F)/Math.LN2,2),b=Math.log(q/2)/Math.LN2,V=2*F-q,c=[],te=[],p=[],_=ce=0,ge=k.length;ce<ge;_=++ce){if(A=k[_],h=m[_],A===65535){c.push(0),te.push(0);break}if(A-(M=r[A].new)>=32768)for(c.push(0),te.push(2*(p.length+F-_)),a=se=A;A<=h?se<=h:se>=h;a=A<=h?++se:--se)p.push(r[a].new);else c.push(M-A),te.push(0)}for(j.writeUInt16(3),j.writeUInt16(1),j.writeUInt32(12),j.writeUInt16(4),j.writeUInt16(16+8*F+2*p.length),j.writeUInt16(0),j.writeUInt16(C),j.writeUInt16(q),j.writeUInt16(b),j.writeUInt16(V),ae=0,I=m.length;ae<I;ae++)a=m[ae],j.writeUInt16(a);for(j.writeUInt16(0),pe=0,z=k.length;pe<z;pe++)a=k[pe],j.writeUInt16(a);for(oe=0,J=c.length;oe<J;oe++)l=c[oe],j.writeUInt16(l);for(be=0,X=te.length;be<X;be++)L=te[be],j.writeUInt16(L);for(Ce=0,Z=p.length;Ce<Z;Ce++)w=p[Ce],j.writeUInt16(w);return{charMap:r,subtable:j.data,maxGlyphID:O+1}}},t})(),hm=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="cmap",t.prototype.parse=function(e){var n,r,a;for(e.pos=this.offset,this.version=e.readUInt16(),a=e.readUInt16(),this.tables=[],this.unicode=null,r=0;0<=a?r<a:r>a;r=0<=a?++r:--r)n=new Np(e,this.offset),this.tables.push(n),n.isUnicode&&this.unicode==null&&(this.unicode=n);return!0},t.encode=function(e,n){var r,a;return n==null&&(n="macroman"),r=Np.encode(e,n),(a=new ua).writeUInt16(0),a.writeUInt16(1),r.table=a.data.concat(r.subtable),r},t})(),Wy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="hhea",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},t})(),Gy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="OS/2",t.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=(function(){var n,r;for(r=[],n=0;n<10;++n)r.push(e.readByte());return r})(),this.charRange=(function(){var n,r;for(r=[],n=0;n<4;++n)r.push(e.readInt());return r})(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=(function(){var n,r;for(r=[],n=0;n<2;n=++n)r.push(e.readInt());return r})(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},t})(),Vy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="post",t.prototype.parse=function(e){var n,r,a;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var i;for(r=e.readUInt16(),this.glyphNameIndex=[],i=0;0<=r?i<r:i>r;i=0<=r?++i:--i)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],a=[];e.pos<this.offset+this.length;)n=e.readByte(),a.push(this.names.push(e.readString(n)));return a;case 151552:return r=e.readUInt16(),this.offsets=e.read(r);case 262144:return this.map=(function(){var o,l,c;for(c=[],i=o=0,l=this.file.maxp.numGlyphs;0<=l?o<l:o>l;i=0<=l?++o:--o)c.push(e.readUInt32());return c}).call(this)}},t})(),Ky=function(t,e){this.raw=t,this.length=t.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},Jy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="name",t.prototype.parse=function(e){var n,r,a,i,o,l,c,d,h,m,b;for(e.pos=this.offset,e.readShort(),n=e.readShort(),l=e.readShort(),r=[],i=0;0<=n?i<n:i>n;i=0<=n?++i:--i)r.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+l+e.readShort()});for(c={},i=h=0,m=r.length;h<m;i=++h)a=r[i],e.pos=a.offset,d=e.readString(a.length),o=new Ky(d,a),c[b=a.nameID]==null&&(c[b]=[]),c[a.nameID].push(o);this.strings=c,this.copyright=c[0],this.fontFamily=c[1],this.fontSubfamily=c[2],this.uniqueSubfamily=c[3],this.fontName=c[4],this.version=c[5];try{this.postscriptName=c[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=c[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=c[7],this.manufacturer=c[8],this.designer=c[9],this.description=c[10],this.vendorUrl=c[11],this.designerUrl=c[12],this.license=c[13],this.licenseUrl=c[14],this.preferredFamily=c[15],this.preferredSubfamily=c[17],this.compatibleFull=c[18],this.sampleText=c[19]},t})(),Yy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="maxp",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},t})(),Xy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="hmtx",t.prototype.parse=function(e){var n,r,a,i,o,l,c;for(e.pos=this.offset,this.metrics=[],n=0,l=this.file.hhea.numberOfMetrics;0<=l?n<l:n>l;n=0<=l?++n:--n)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(a=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var d,h;for(h=[],n=d=0;0<=a?d<a:d>a;n=0<=a?++d:--d)h.push(e.readInt16());return h})(),this.widths=(function(){var d,h,m,b;for(b=[],d=0,h=(m=this.metrics).length;d<h;d++)i=m[d],b.push(i.advance);return b}).call(this),r=this.widths[this.widths.length-1],c=[],n=o=0;0<=a?o<a:o>a;n=0<=a?++o:--o)c.push(this.widths.push(r));return c},t.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},t})(),fm=[].slice,Zy=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(e){var n,r,a,i,o,l,c,d,h,m;return e in this.cache?this.cache[e]:(i=this.file.loca,n=this.file.contents,r=i.indexOf(e),(a=i.lengthOf(e))===0?this.cache[e]=null:(n.pos=this.offset+r,o=(l=new ua(n.read(a))).readShort(),d=l.readShort(),m=l.readShort(),c=l.readShort(),h=l.readShort(),this.cache[e]=o===-1?new e_(l,d,m,c,h):new Qy(l,o,d,m,c,h),this.cache[e]))},t.prototype.encode=function(e,n,r){var a,i,o,l,c;for(o=[],i=[],l=0,c=n.length;l<c;l++)a=e[n[l]],i.push(o.length),a&&(o=o.concat(a.encode(r)));return i.push(o.length),{table:o,offsets:i}},t})(),Qy=(function(){function t(e,n,r,a,i,o){this.raw=e,this.numberOfContours=n,this.xMin=r,this.yMin=a,this.xMax=i,this.yMax=o,this.compound=!1}return t.prototype.encode=function(){return this.raw.data},t})(),e_=(function(){function t(e,n,r,a,i){var o,l;for(this.raw=e,this.xMin=n,this.yMin=r,this.xMax=a,this.yMax=i,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],o=this.raw;l=o.readShort(),this.glyphOffsets.push(o.pos),this.glyphIDs.push(o.readUInt16()),32&l;)o.pos+=1&l?4:2,128&l?o.pos+=8:64&l?o.pos+=4:8&l&&(o.pos+=2)}return t.prototype.encode=function(){var e,n,r;for(n=new ua(fm.call(this.raw.data)),e=0,r=this.glyphIDs.length;e<r;++e)n.pos=this.glyphOffsets[e];return n.data},t})(),t_=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return bi(t,ri),t.prototype.tag="loca",t.prototype.parse=function(e){var n,r;return e.pos=this.offset,n=this.file.head.indexToLocFormat,this.offsets=n===0?(function(){var a,i;for(i=[],r=0,a=this.length;r<a;r+=2)i.push(2*e.readUInt16());return i}).call(this):(function(){var a,i;for(i=[],r=0,a=this.length;r<a;r+=4)i.push(e.readUInt32());return i}).call(this)},t.prototype.indexOf=function(e){return this.offsets[e]},t.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},t.prototype.encode=function(e,n){for(var r=new Uint32Array(this.offsets.length),a=0,i=0,o=0;o<r.length;++o)if(r[o]=a,i<n.length&&n[i]==o){++i,r[o]=a;var l=this.offsets[o],c=this.offsets[o+1]-l;c>0&&(a+=c)}for(var d=new Array(4*r.length),h=0;h<r.length;++h)d[4*h+3]=255&r[h],d[4*h+2]=(65280&r[h])>>8,d[4*h+1]=(16711680&r[h])>>16,d[4*h]=(4278190080&r[h])>>24;return d},t})(),n_=(function(){function t(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return t.prototype.generateCmap=function(){var e,n,r,a,i;for(n in a=this.font.cmap.tables[0].codeMap,e={},i=this.subset)r=i[n],e[n]=a[r];return e},t.prototype.glyphsFor=function(e){var n,r,a,i,o,l,c;for(a={},o=0,l=e.length;o<l;o++)a[i=e[o]]=this.font.glyf.glyphFor(i);for(i in n=[],a)(r=a[i])!=null&&r.compound&&n.push.apply(n,r.glyphIDs);if(n.length>0)for(i in c=this.glyphsFor(n))r=c[i],a[i]=r;return a},t.prototype.encode=function(e,n){var r,a,i,o,l,c,d,h,m,b,p,_,w,S,x;for(a in r=hm.encode(this.generateCmap(),"unicode"),o=this.glyphsFor(e),p={0:0},x=r.charMap)p[(c=x[a]).old]=c.new;for(_ in b=r.maxGlyphID,o)_ in p||(p[_]=b++);return h=(function(T){var O,L;for(O in L={},T)L[T[O]]=O;return L})(p),m=Object.keys(h).sort(function(T,O){return T-O}),w=(function(){var T,O,L;for(L=[],T=0,O=m.length;T<O;T++)l=m[T],L.push(h[l]);return L})(),i=this.font.glyf.encode(o,w,p),d=this.font.loca.encode(i.offsets,w),S={cmap:this.font.cmap.raw(),glyf:i.table,loca:d,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(n)},this.font.os2.exists&&(S["OS/2"]=this.font.os2.raw()),this.font.directory.encode(S)},t})();Xe.API.PDFObject=(function(){var t;function e(){}return t=function(n,r){return(Array(r+1).join("0")+n).slice(-r)},e.convert=function(n){var r,a,i,o;if(Array.isArray(n))return"["+(function(){var l,c,d;for(d=[],l=0,c=n.length;l<c;l++)r=n[l],d.push(e.convert(r));return d})().join(" ")+"]";if(typeof n=="string")return"/"+n;if(n!=null&&n.isString)return"("+n+")";if(n instanceof Date)return"(D:"+t(n.getUTCFullYear(),4)+t(n.getUTCMonth(),2)+t(n.getUTCDate(),2)+t(n.getUTCHours(),2)+t(n.getUTCMinutes(),2)+t(n.getUTCSeconds(),2)+"Z)";if({}.toString.call(n)==="[object Object]"){for(a in i=["<<"],n)o=n[a],i.push("/"+a+" "+e.convert(o));return i.push(">>"),i.join(`
`)}return""+n},e})();const Zr=[26,92,107],r_=[240,247,248],Ur=[0,0,0],gi=[100,100,100],Ep=[200,200,200],i_=[248,249,250],Lp=[255,255,255];function aa(t){return(parseFloat(t)||0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})+" "}function Lu(t){return t?new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):""}function Cp(t,e,n,r){const a=new Xe("p","mm","a4"),i=210,o=25,l=25,c=i-o-l,d=n||{},h=d.company_name||"BECK360",m=d.owner_name||"Eugen Beck",b=d.address_line1||"Eichenweg 1",p=d.address_zip||"76275",_=d.address_city||"Ettlingen",w=d.phone||"0173-4682501",S=d.email||"rundgang@beck360.de",x=d.website||"www.beck360.de",T=d.tax_id||"31205/27003",O=d.vat_id||"DE321274049",L=d.bank_name||"VR Bank Suedpfalz",K=d.bank_iban||"DE92 5486 2500 0001 1389 95",te=d.bank_bic||"GEN0DE61SUW",V=d.payment_reference_note||"Bitte verwenden Sie die Rechnungsnummer als Verwendungszweck.",q=d.default_invoice_intro||"Vielen Dank fuer Ihren Auftrag. Ich berechne Ihnen fuer folgende Leistungen:",F=d.default_quote_intro||"Vielen Dank fuer Ihr Interesse. Gerne unterbreite ich Ihnen folgendes Angebot:",C=t.type==="quote",A=C?"ANGEBOT":"RECHNUNG",k=C?"Angebotsnr.":"Rechnungsnr.",M=C?"Angebotsdatum":"Rechnungsdatum",j=C?"Gueltig bis":"Faellig am";a.setFillColor(...Zr),a.rect(0,0,i,4,"F");let U=16;a.setFont("helvetica","bold"),a.setFontSize(18),a.setTextColor(...Zr),a.text("Beck360",o,U),a.setFontSize(22),a.setTextColor(...Ur),a.text(A,i-l,U,{align:"right"}),U+=14,a.setFontSize(7),a.setTextColor(...gi),a.setFont("helvetica","normal");const re=`${h}  ${m}  ${b}  ${p} ${_}`;a.text(re,o,U);const ce=a.getTextWidth(re);a.setDrawColor(...Ep),a.setLineWidth(.2),a.line(o,U+1,o+ce,U+1),U+=8;const se=U;a.setFontSize(10),a.setTextColor(...Ur),t.customer_company&&(a.setFont("helvetica","bold"),a.text(t.customer_company,o,U),U+=5),t.customer_name&&(a.setFont("helvetica",t.customer_company?"normal":"bold"),a.text(t.customer_name,o,U),U+=5),a.setFont("helvetica","normal"),t.customer_street&&(a.text(t.customer_street,o,U),U+=5);const fe=`${t.customer_zip||""} ${t.customer_city||""}`.trim();fe&&(a.text(fe,o,U),U+=5);const xe=65,ge=i-l-xe,I=4,z=5.5,J=[[k,t.invoice_number],[M,Lu(t.invoice_date)]];t.due_date&&J.push([j,Lu(t.due_date)]),t.customer_number&&J.push(["Kundennr.",t.customer_number]),t.service_date&&J.push(["Leistungsdatum",Lu(t.service_date)]);const X=I*2+J.length*z,Z=se-2;a.setFillColor(...r_),a.roundedRect(ge,Z,xe,X,1.5,1.5,"F"),a.setFillColor(...Zr),a.rect(ge,Z,1,X,"F"),a.setFontSize(8.5);let ae=Z+I+4;for(const[Ie,it]of J)a.setFont("helvetica","normal"),a.setTextColor(...gi),a.text(Ie,ge+I+2,ae),a.setFont("helvetica","bold"),a.setTextColor(...Ur),a.text(it||"",ge+xe-I,ae,{align:"right"}),ae+=z;U=Math.max(U,Z+X+8),U+=4;const pe=t.intro_text||(C?F:q);{a.setFont("helvetica","normal"),a.setFontSize(9.5),a.setTextColor(...Ur);const Ie=a.splitTextToSize(pe,c);a.text(Ie,o,U),U+=Ie.length*4.5+6}const Y=o,oe=o+12,be=o+c*.58,Ce=o+c*.76,Te=i-l,je=6,$=8;a.setFillColor(...Zr),a.rect(o,U,c,$,"F"),a.setFont("helvetica","bold"),a.setFontSize(8.5),a.setTextColor(...Lp);const Pe=U+5.5;a.text("Pos.",Y+2,Pe),a.text("Bezeichnung",oe,Pe),a.text("Menge",be,Pe,{align:"right"}),a.text("Einzelpreis",Ce,Pe,{align:"right"}),a.text("Gesamt",Te-2,Pe,{align:"right"}),U+=$,a.setFont("helvetica","normal"),a.setFontSize(9);for(let Ie=0;Ie<e.length;Ie++){const it=e[Ie];let nt=je;it.sub_description&&(nt+=4.5),U+nt>245&&(Cl(a,i,o,l,h,m,b,p,_,w,S,x,T,O,K,te,L),a.addPage(),a.setFillColor(...Zr),a.rect(0,0,i,4,"F"),U=16),Ie%2===1&&(a.setFillColor(...i_),a.rect(o,U,c,nt,"F"));const at=(parseFloat(it.quantity)||0)*(parseFloat(it.unit_price)||0),ut=parseFloat(it.quantity)%1===0?`${parseInt(it.quantity)} Stk.`:`${parseFloat(it.quantity).toLocaleString("de-DE")}`,pt=U+4.5;a.setTextColor(...Ur),a.setFont("helvetica","normal"),a.setFontSize(9),a.setTextColor(...gi),a.text(`${Ie+1}`,Y+2,pt),a.setTextColor(...Ur),a.text(it.description||"",oe,pt),a.text(ut,be,pt,{align:"right"}),a.text(aa(it.unit_price),Ce,pt,{align:"right"}),a.setFont("helvetica","bold"),a.text(aa(at),Te-2,pt,{align:"right"}),U+=je,it.sub_description&&(a.setFont("helvetica","italic"),a.setFontSize(8),a.setTextColor(...gi),a.text(it.sub_description,oe,U+1),U+=4.5)}a.setDrawColor(...Zr),a.setLineWidth(.4),a.line(o,U,i-l,U),U+=10;const ht=75,He=i-l-ht,Se=He+3,Ke=i-l-3;function Re(Ie,it,nt={}){if(nt.highlight){a.setFillColor(...Zr),a.roundedRect(He,U-4,ht,9,1,1,"F"),a.setFont("helvetica","bold"),a.setFontSize(10),a.setTextColor(...Lp),a.text(Ie,Se,U+1),a.text(it,Ke,U+1,{align:"right"}),U+=10;return}a.setFont("helvetica",nt.bold?"bold":"normal"),nt.italic&&a.setFont("helvetica","italic"),a.setFontSize(nt.size||9),a.setTextColor(...nt.color||Ur),a.text(Ie,Se,U),a.text(it,Ke,U,{align:"right"}),U+=nt.spacing||6}if(a.setDrawColor(...Ep),a.setLineWidth(.2),Re("Zwischensumme",aa(t.subtotal)),parseFloat(t.discount_percent)>0){const Ie=parseFloat(t.subtotal)-parseFloat(t.net_amount);Re(`Rabatt (- ${t.discount_percent}%)`,`-${aa(Ie)}`,{color:gi})}if(Re("Nettobetrag",aa(t.net_amount)),Re(`${t.vat_rate} % MwSt.`,aa(t.vat_amount),{italic:!0,color:gi}),Re("Gesamtbetrag",aa(t.total_amount),{highlight:!0}),t.status==="paid"&&Re("Bezahlt",aa(t.paid_amount||t.total_amount),{bold:!0,size:10,color:[22,163,74]}),U+=4,t.payment_terms){U>245&&(Cl(a,i,o,l,h,m,b,p,_,w,S,x,T,O,K,te,L),a.addPage(),a.setFillColor(...Zr),a.rect(0,0,i,4,"F"),U=16),a.setFont("helvetica","normal"),a.setFontSize(9),a.setTextColor(...Ur);const Ie=a.splitTextToSize(t.payment_terms,c);a.text(Ie,o,U),U+=Ie.length*4.5+3}if(!C&&V&&(a.setFont("helvetica","normal"),a.setFontSize(8.5),a.setTextColor(...gi),a.text(V,o,U),U+=8),t.closing_message){U>250&&(Cl(a,i,o,l,h,m,b,p,_,w,S,x,T,O,K,te,L),a.addPage(),a.setFillColor(...Zr),a.rect(0,0,i,4,"F"),U=16),a.setFont("helvetica","normal"),a.setFontSize(9),a.setTextColor(...Ur);const Ie=a.splitTextToSize(t.closing_message,c);a.text(Ie,o,U),U+=Ie.length*4.5}if(Cl(a,i,o,l,h,m,b,p,_,w,S,x,T,O,K,te,L),r!=null&&r.preview){const Ie=a.output("blob"),it=URL.createObjectURL(Ie);window.open(it,"_blank");return}const Qe=`${t.invoice_number}.pdf`;a.save(Qe)}function Cl(t,e,n,r,a,i,o,l,c,d,h,m,b,p,_,w,S){t.setDrawColor(...Zr),t.setLineWidth(.3),t.line(n,268,e-r,268),t.setFontSize(7);const T=n;t.setFont("helvetica","bold"),t.setTextColor(...Zr),t.text(a,T,272),t.setTextColor(...Ur),t.text(i,T,272+3.5),t.setFont("helvetica","normal"),t.setTextColor(...gi),t.text(o,T,279),t.text(`${l} ${c}`,T,272+10.5),t.text(m,T,286),t.text(`St.-Nr.: ${b}`,T,272+17.5);const O=n+55;t.setFont("helvetica","bold"),t.setTextColor(...Ur),t.text("Kontakt",O,272),t.setFont("helvetica","normal"),t.setTextColor(...gi),t.text(`Tel.: ${d}`,O,272+3.5),t.text(`E-Mail: ${h}`,O,279),t.text(`USt-IdNr.: ${p}`,O,272+10.5);const L=n+110;t.setFont("helvetica","bold"),t.setTextColor(...Ur),t.text("Bankverbindung",L,272),t.setFont("helvetica","normal"),t.setTextColor(...gi),t.text(S,L,272+3.5),t.text(`IBAN: ${_}`,L,279),t.text(`BIC: ${w}`,L,272+10.5)}function a_({id:t}){var S,x,T,O,L,K,te;const{invoice:e,items:n,loading:r,update:a}=gg(t),{settings:i}=sc(),o=Qn();if(r)return s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Rechnung"})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]});if(!e)return s(At,{children:[s("div",{class:"page-header",children:s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/invoices"),children:""}),s("h1",{class:"page-title",children:"Nicht gefunden"})]})}),s("div",{class:"page-body",children:s("div",{class:"empty-state",children:s("div",{class:"empty-state-text",children:"Dokument nicht gefunden"})})})]});const l=e.type==="quote",c=((S=ks[e.type])==null?void 0:S.label)||"Dokument";async function d(){const{error:V}=await a({status:"sent"});V?o.error("Fehler"):o.success("Als versendet markiert")}async function h(){const{error:V}=await a({status:"paid",paid_date:new Date().toISOString().slice(0,10),paid_amount:e.total_amount});V?o.error("Fehler"):o.success("Als bezahlt markiert")}async function m(){const{data:V,error:q}=await s2(t);q?o.error("Fehler: "+q.message):(o.success("In Rechnung umgewandelt"),ze(`/crm/invoices/${V.id}`))}async function b(){if(!confirm(`${c} "${e.invoice_number}" wirklich loeschen?`))return;const{error:V}=await mg(t);V?o.error("Fehler"):(o.success("Geloescht"),ze("/crm/invoices"))}function p(){Cp(e,n,i)}function _(){Cp(e,n,i,{preview:!0})}function w(){ze(`/crm/invoices/new?edit=${t}`)}return s(At,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/invoices"),children:""}),s("h1",{class:"page-title",children:e.invoice_number}),s("span",{class:"stage-badge",style:`color:${(x=Zn[e.status])==null?void 0:x.color};background:${(T=Zn[e.status])==null?void 0:T.color}20`,children:(O=Zn[e.status])==null?void 0:O.label})]}),s("div",{style:"display:flex;gap:0.5rem;flex-wrap:wrap",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:_,children:"Vorschau"}),s("button",{class:"btn btn-primary btn-sm",onClick:p,children:"PDF herunterladen"}),e.status==="draft"&&s(At,{children:[s("button",{class:"btn btn-secondary btn-sm",onClick:w,children:"Bearbeiten"}),s("button",{class:"btn btn-secondary btn-sm",onClick:d,children:"Als versendet markieren"}),l&&s("button",{class:"btn btn-primary btn-sm",onClick:m,children:"In Rechnung umwandeln"}),s("button",{class:"btn btn-danger btn-sm",onClick:b,children:"Loeschen"})]}),e.status==="sent"&&!l&&s("button",{class:"btn btn-primary btn-sm",onClick:h,children:"Als bezahlt markieren"})]})]}),s("div",{class:"page-body",children:s("div",{class:"detail-grid",children:[s("div",{class:"detail-main",children:[s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:c})}),s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:l?"Angebotsnr.":"Rechnungsnr."}),s("span",{class:"detail-value",children:e.invoice_number})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Typ"}),s("span",{class:"detail-value",children:c})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Datum"}),s("span",{class:"detail-value",children:Cn(e.invoice_date)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:l?"Gueltig bis":"Faellig am"}),s("span",{class:"detail-value",children:Cn(e.due_date)})]}),e.paid_date&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Bezahlt am"}),s("span",{class:"detail-value",children:Cn(e.paid_date)})]}),e.converted_from_quote_id&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt aus Angebot"}),s("span",{class:"detail-value",children:s("a",{href:"#",onClick:V=>{V.preventDefault(),ze(`/crm/invoices/${e.converted_from_quote_id}`)},children:"Angebot anzeigen"})})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Kunde"})}),s("div",{class:"form-grid",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Firma"}),s("span",{class:"detail-value",children:e.company_id?s("a",{href:"#",onClick:V=>{V.preventDefault(),ze(`/crm/companies/${e.company_id}`)},children:e.customer_company||""}):e.customer_company||""})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Ansprechpartner"}),s("span",{class:"detail-value",children:e.customer_name||""})]}),s("div",{class:"detail-field form-group-full",children:[s("span",{class:"detail-label",children:"Adresse"}),s("span",{class:"detail-value",children:[e.customer_street,`${e.customer_zip||""} ${e.customer_city||""}`.trim()].filter(Boolean).join(", ")||""})]})]})]}),s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Positionen"})}),s("div",{class:"table-wrapper",children:s("table",{class:"line-items-table",children:[s("thead",{children:s("tr",{children:[s("th",{children:"Bezeichnung"}),s("th",{style:"text-align:right",children:"Menge"}),s("th",{style:"text-align:right",children:"Einzelpreis"}),s("th",{style:"text-align:right",children:"Gesamt"})]})}),s("tbody",{children:n.map(V=>s("tr",{children:[s("td",{"data-label":"Bezeichnung",children:[s("div",{children:V.description}),V.sub_description&&s("div",{style:"font-size:0.8rem;color:var(--text-muted)",children:V.sub_description})]}),s("td",{"data-label":"Menge",children:V.quantity}),s("td",{"data-label":"Einzelpreis",children:De(V.unit_price)}),s("td",{"data-label":"Gesamt",style:"font-weight:500",children:De(V.total)})]},V.id))})]})}),s("div",{class:"invoice-totals",style:"margin-top:1rem",children:[s("div",{class:"invoice-totals-row",children:[s("span",{children:"Zwischensumme"}),s("span",{children:De(e.subtotal)})]}),parseFloat(e.discount_percent)>0&&s("div",{class:"invoice-totals-row",children:[s("span",{children:["Rabatt (-",e.discount_percent,"%)"]}),s("span",{children:["-",De(e.subtotal-e.net_amount)]})]}),s("div",{class:"invoice-totals-row",children:[s("span",{children:"Nettobetrag"}),s("span",{children:De(e.net_amount)})]}),s("div",{class:"invoice-totals-row",children:[s("span",{children:[e.vat_rate,"% MwSt."]}),s("span",{children:De(e.vat_amount)})]}),s("div",{class:"invoice-totals-row",style:"font-weight:700;font-size:1.1rem;border-top:2px solid var(--border);padding-top:0.5rem",children:[s("span",{children:"Gesamtbetrag"}),s("span",{children:De(e.total_amount)})]}),e.status==="paid"&&s("div",{class:"invoice-totals-row",style:"font-weight:700;color:var(--success)",children:[s("span",{children:"Bezahlt"}),s("span",{children:De(e.paid_amount)})]})]})]}),(e.payment_terms||e.closing_message)&&s("div",{class:"card",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Texte"})}),e.payment_terms&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Zahlungsbedingungen"}),s("span",{class:"detail-value",style:"white-space:pre-wrap",children:e.payment_terms})]}),e.closing_message&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Schlussnachricht"}),s("span",{class:"detail-value",style:"white-space:pre-wrap",children:e.closing_message})]})]})]}),s("div",{class:"detail-sidebar",children:s("div",{class:"card",children:[s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Status"}),s("span",{class:"detail-value",children:s("span",{class:"stage-badge",style:`color:${(L=Zn[e.status])==null?void 0:L.color};background:${(K=Zn[e.status])==null?void 0:K.color}20`,children:(te=Zn[e.status])==null?void 0:te.label})})]}),e.deal_id&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Deal"}),s("span",{class:"detail-value",children:s("a",{href:"#",onClick:V=>{V.preventDefault(),ze(`/crm/deals/${e.deal_id}`)},children:"Deal anzeigen"})})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Erstellt am"}),s("span",{class:"detail-value",children:Cn(e.created_at)})]}),s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Aktualisiert"}),s("span",{class:"detail-value",children:Cn(e.updated_at)})]}),e.notes&&s("div",{class:"detail-field",children:[s("span",{class:"detail-label",children:"Interne Notizen"}),s("span",{class:"detail-value",style:"white-space:pre-wrap;font-size:0.8rem",children:e.notes})]})]})})]})})]})}function s_({month:t=null,year:e=null,category:n=null}={}){const[r,a]=me([]),[i,o]=me(!0),l=Nt(async()=>{o(!0);let c=Le.from("expenses").select("*").is("deleted_at",null).order("date",{ascending:!1});if(e&&(c=c.gte("date",`${e}-01-01`).lte("date",`${e}-12-31`)),t){const m=String(t).padStart(2,"0"),b=e||new Date().getFullYear();c=c.gte("date",`${b}-${m}-01`).lte("date",`${b}-${m}-31`)}n&&(c=c.eq("category",n));const{data:d,error:h}=await c;h||a(d||[]),o(!1)},[t,e,n]);return Mt(()=>{l()},[l]),{expenses:r,loading:i,refetch:l}}function o_(t){const[e,n]=me(null),[r,a]=me(!0),i=Nt(async()=>{if(!t)return;a(!0);const{data:o}=await Le.from("expenses").select("*").eq("id",t).single();n(o),a(!1)},[t]);return Mt(()=>{i()},[i]),{expense:e,loading:r,refetch:i}}async function l_(t){const{data:e}=await Le.auth.getUser(),n=e.user.id,{data:r,error:a}=await Le.from("expenses").insert({...t,owner_id:n}).select().single();return{data:r,error:a}}async function c_(t,e){const{error:n}=await Le.from("expenses").update({...e,updated_at:new Date().toISOString()}).eq("id",t);return{error:n}}async function u_(t){const{error:e}=await Le.from("expenses").update({deleted_at:new Date().toISOString()}).eq("id",t);return{error:e}}function d_(){const t=new Date,[e,n]=me(t.getFullYear()),[r,a]=me(null),[i,o]=me(null),{expenses:l,loading:c}=s_({year:e,month:r,category:i}),d=l.reduce((p,_)=>p+(parseFloat(_.amount)||0),0),h=l.reduce((p,_)=>p+(parseFloat(_.amount)||0),0),m=l.length,b=[];for(let p=t.getFullYear();p>=t.getFullYear()-5;p--)b.push(p);return s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Ausgaben"}),s("button",{class:"btn btn-primary btn-sm",onClick:()=>ze("/crm/expenses/new"),children:"+ Ausgabe"})]}),s("div",{class:"page-body",children:[s("div",{class:"search-bar",style:"flex-wrap:wrap;gap:0.75rem",children:[s("select",{value:e,onChange:p=>n(parseInt(p.target.value)),style:"width:auto",children:b.map(p=>s("option",{value:p,children:p},p))}),s("select",{value:r||"",onChange:p=>a(p.target.value?parseInt(p.target.value):null),style:"width:auto",children:[s("option",{value:"",children:"Alle Monate"}),Kl.map((p,_)=>s("option",{value:_+1,children:p},_))]}),s("div",{class:"filter-pills",children:[s("button",{class:`filter-pill ${i?"":"active"}`,onClick:()=>o(null),children:"Alle"}),Object.entries(Vl).map(([p,_])=>s("button",{class:`filter-pill ${i===p?"active":""}`,onClick:()=>o(i===p?null:p),children:_},p))]})]}),s("div",{class:"grid-3",style:"margin-bottom:1.5rem",children:[s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:["Ausgaben ",r?Kl[r-1]:"Zeitraum"]}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#ef4444",children:De(d)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:["Ausgaben ",e]}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#ef4444",children:De(h)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Anzahl Belege"}),s("div",{style:"font-size:1.5rem;font-weight:700",children:m})]})]}),c?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):l.length===0?s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Ausgaben gefunden"})]}):s("div",{class:"card",children:s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Datum"}),s("th",{children:"Kategorie"}),s("th",{children:"Beschreibung"}),s("th",{children:"Lieferant"}),s("th",{style:"text-align:right",children:"Betrag"})]})}),s("tbody",{children:l.map(p=>s("tr",{class:"clickable-row",onClick:()=>ze(`/crm/expenses/new?edit=${p.id}`),children:[s("td",{"data-label":"Datum",children:Cn(p.date)}),s("td",{"data-label":"Kategorie",children:s("span",{style:"font-size:0.75rem;padding:0.15rem 0.5rem;border-radius:999px;background:rgba(239,68,68,0.12);color:#ef4444",children:Vl[p.category]||p.category})}),s("td",{"data-label":"Beschreibung",children:p.description}),s("td",{"data-label":"Lieferant",children:p.vendor||""}),s("td",{"data-label":"Betrag",style:"text-align:right;font-weight:600",children:De(p.amount)})]},p.id))})]})})})]})]})}function h_(){const t=Qn(),n=new URLSearchParams(window.location.search).get("edit"),{expense:r,loading:a}=o_(n),[i,o]=me(!1),[l,c]=me({date:new Date().toISOString().slice(0,10),category:"other",description:"",amount:"",vat_rate:19,vendor:"",receipt_ref:"",payment_method:"bank_transfer",notes:""});Mt(()=>{!n||a||!r||c({date:r.date||"",category:r.category||"other",description:r.description||"",amount:r.amount||"",vat_rate:r.vat_rate!=null?r.vat_rate:19,vendor:r.vendor||"",receipt_ref:r.receipt_ref||"",payment_method:r.payment_method||"bank_transfer",notes:r.notes||""})},[n,a,r]);const d=parseFloat(l.amount)||0,h=parseFloat(l.vat_rate)||0,m=h>0?d/(1+h/100):d,b=d-m;async function p(w){if(w.preventDefault(),!l.description||!l.amount){t.error("Beschreibung und Betrag sind Pflichtfelder");return}o(!0);const S={date:l.date,category:l.category,description:l.description,amount:parseFloat(l.amount)||0,net_amount:Math.round(m*100)/100,vat_amount:Math.round(b*100)/100,vat_rate:parseFloat(l.vat_rate)||0,vendor:l.vendor||null,receipt_ref:l.receipt_ref||null,payment_method:l.payment_method,notes:l.notes||null};let x;n?(x=await c_(n,S),x.error||(t.success("Ausgabe gespeichert"),ze("/crm/expenses"))):(x=await l_(S),x.error||(t.success("Ausgabe erstellt"),ze("/crm/expenses"))),x.error&&t.error("Fehler: "+x.error.message),o(!1)}async function _(){if(!confirm("Ausgabe wirklich loeschen?"))return;const{error:w}=await u_(n);w?t.error("Fehler: "+w.message):(t.success("Ausgabe geloescht"),ze("/crm/expenses"))}return n&&a?s(At,{children:[s("div",{class:"page-header",children:s("h1",{class:"page-title",children:"Laden..."})}),s("div",{class:"page-body",children:s("div",{class:"loading-center",children:s("div",{class:"spinner"})})})]}):s(At,{children:[s("div",{class:"page-header",children:[s("div",{style:"display:flex;align-items:center;gap:0.75rem",children:[s("button",{class:"btn btn-secondary btn-sm",onClick:()=>ze("/crm/expenses"),children:""}),s("h1",{class:"page-title",children:n?"Ausgabe bearbeiten":"Neue Ausgabe"})]}),n&&s("button",{class:"btn btn-danger btn-sm",onClick:_,children:"Loeschen"})]}),s("div",{class:"page-body",children:s("form",{onSubmit:p,style:"max-width:640px",children:[s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Ausgabe"})}),s("div",{class:"form-grid",children:[s("div",{class:"form-group",children:[s("label",{children:"Datum"}),s("input",{type:"date",value:l.date,onInput:w=>c({...l,date:w.target.value}),required:!0})]}),s("div",{class:"form-group",children:[s("label",{children:"Kategorie"}),s("select",{value:l.category,onChange:w=>c({...l,category:w.target.value}),children:Object.entries(Vl).map(([w,S])=>s("option",{value:w,children:S},w))})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Beschreibung"}),s("input",{value:l.description,onInput:w=>c({...l,description:w.target.value}),required:!0,placeholder:"z.B. Matterport-Lizenz, Bueroeinrichtung..."})]}),s("div",{class:"form-group",children:[s("label",{children:"Betrag brutto"}),s("input",{type:"number",step:"0.01",min:"0",value:l.amount,onInput:w=>c({...l,amount:w.target.value}),required:!0,style:"text-align:right"})]}),s("div",{class:"form-group",children:[s("label",{children:"MwSt-Satz (%)"}),s("input",{type:"number",step:"0.01",min:"0",value:l.vat_rate,onInput:w=>c({...l,vat_rate:w.target.value}),style:"max-width:100px;text-align:right"})]}),s("div",{class:"form-group",children:[s("label",{children:"Lieferant"}),s("input",{value:l.vendor,onInput:w=>c({...l,vendor:w.target.value}),placeholder:"Optional"})]}),s("div",{class:"form-group",children:[s("label",{children:"Belegnummer"}),s("input",{value:l.receipt_ref,onInput:w=>c({...l,receipt_ref:w.target.value}),placeholder:"Optional"})]}),s("div",{class:"form-group",children:[s("label",{children:"Zahlungsart"}),s("select",{value:l.payment_method,onChange:w=>c({...l,payment_method:w.target.value}),children:Object.entries(u2).map(([w,S])=>s("option",{value:w,children:S},w))})]}),s("div",{class:"form-group form-group-full",children:[s("label",{children:"Notizen"}),s("textarea",{value:l.notes,onInput:w=>c({...l,notes:w.target.value}),placeholder:"Optional"})]})]}),d>0&&s("div",{style:"margin-top:1rem;padding:1rem;background:var(--bg-secondary);border-radius:8px",children:[s("div",{style:"display:flex;justify-content:space-between;font-size:0.85rem;margin-bottom:0.25rem",children:[s("span",{children:"Nettobetrag"}),s("span",{children:De(m)})]}),s("div",{style:"display:flex;justify-content:space-between;font-size:0.85rem;margin-bottom:0.25rem",children:[s("span",{children:[l.vat_rate,"% MwSt."]}),s("span",{children:De(b)})]}),s("div",{style:"display:flex;justify-content:space-between;font-size:0.95rem;font-weight:700;border-top:1px solid var(--border);padding-top:0.5rem;margin-top:0.25rem",children:[s("span",{children:"Bruttobetrag"}),s("span",{children:De(d)})]})]})]}),s("div",{class:"form-actions",children:[s("button",{type:"button",class:"btn btn-secondary",onClick:()=>ze("/crm/expenses"),children:"Abbrechen"}),s("button",{type:"submit",class:"btn btn-primary",disabled:i,children:i?"Speichern...":n?"Speichern":"Erstellen"})]})]})})]})}function f_({year:t}={}){const[e,n]=me(null),[r,a]=me([]),[i,o]=me([]),[l,c]=me({}),[d,h]=me(!0),m=Nt(async()=>{if(!t)return;h(!0);const b=`${t}-01-01`,p=`${t}-12-31`,[{data:_},{data:w},{data:S}]=await Promise.all([Le.from("invoices").select("total_amount, net_amount, vat_amount, paid_date").eq("type","invoice").eq("status","paid").gte("paid_date",b).lte("paid_date",p),Le.from("invoices").select("total_amount").eq("type","invoice").in("status",["sent","overdue"]),Le.from("expenses").select("date, category, amount, net_amount, vat_amount").is("deleted_at",null).gte("date",b).lte("date",p)]),x=_||[],T=S||[],O=Array.from({length:12},(M,j)=>{const U=j+1,re=String(U).padStart(2,"0"),ce=`${t}-${re}`,se=x.filter(Z=>Z.paid_date&&Z.paid_date.startsWith(ce)),fe=T.filter(Z=>Z.date&&Z.date.startsWith(ce)),xe=se.reduce((Z,ae)=>Z+(parseFloat(ae.total_amount)||0),0),ge=se.reduce((Z,ae)=>Z+(parseFloat(ae.net_amount)||0),0),I=se.reduce((Z,ae)=>Z+(parseFloat(ae.vat_amount)||0),0),z=fe.reduce((Z,ae)=>Z+(parseFloat(ae.amount)||0),0),J=fe.reduce((Z,ae)=>Z+(parseFloat(ae.net_amount)||0),0),X=fe.reduce((Z,ae)=>Z+(parseFloat(ae.vat_amount)||0),0);return{month:U,incomeBrutto:xe,incomeNetto:ge,vatCollected:I,expensesBrutto:z,expensesNetto:J,vatPaid:X,profit:ge-J}});a(O);const L=[0,1,2,3].map(M=>{const j=O.slice(M*3,M*3+3);return{quarter:M+1,incomeBrutto:j.reduce((U,re)=>U+re.incomeBrutto,0),incomeNetto:j.reduce((U,re)=>U+re.incomeNetto,0),vatCollected:j.reduce((U,re)=>U+re.vatCollected,0),expensesBrutto:j.reduce((U,re)=>U+re.expensesBrutto,0),expensesNetto:j.reduce((U,re)=>U+re.expensesNetto,0),vatPaid:j.reduce((U,re)=>U+re.vatPaid,0),profit:j.reduce((U,re)=>U+re.profit,0)}});o(L);const K={};T.forEach(M=>{const j=M.category||"other";K[j]=(K[j]||0)+(parseFloat(M.amount)||0)}),c(K);const te=x.reduce((M,j)=>M+(parseFloat(j.total_amount)||0),0),V=x.reduce((M,j)=>M+(parseFloat(j.net_amount)||0),0),q=T.reduce((M,j)=>M+(parseFloat(j.amount)||0),0),F=T.reduce((M,j)=>M+(parseFloat(j.net_amount)||0),0),C=x.reduce((M,j)=>M+(parseFloat(j.vat_amount)||0),0),A=T.reduce((M,j)=>M+(parseFloat(j.vat_amount)||0),0),k=(w||[]).reduce((M,j)=>M+(parseFloat(j.total_amount)||0),0);n({yearRevenue:te,yearRevenueNetto:V,yearExpenses:q,yearExpensesNetto:F,yearProfit:V-F,openInvoices:k,vatCollected:C,vatPaid:A,vatPayable:C-A}),h(!1)},[t]);return Mt(()=>{m()},[m]),{stats:e,monthlyData:r,quarterlyData:i,expensesByCategory:l,loading:d,refetch:m}}const Cu=[26,92,107],lo=[0,0,0],Tu=[100,100,100],Tp=[200,200,200];function Jr(t){return(parseFloat(t)||0).toLocaleString("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2})+" "}const p_=["Januar","Februar","Maerz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"];function g_({year:t,monthlyData:e,quarterlyData:n,stats:r,settings:a}){const i=new Xe("p","mm","a4"),o=210,l=25,c=25,d=a||{},h=d.company_name||"BECK360",m=d.owner_name||"Eugen Beck",b=d.address_line1||"Eichenweg 1",p=d.address_zip||"76275",_=d.address_city||"Ettlingen",w=d.phone||"0173-4682501",S=d.email||"rundgang@beck360.de",x=d.website||"www.beck360.de",T=d.tax_id||"31205/27003",O=d.vat_id||"DE321274049",L=d.bank_name||"VR Bank Suedpfalz",K=d.bank_iban||"DE92 5486 2500 0001 1389 95",te=d.bank_bic||"GEN0DE61SUW";let V=20;i.setFont("helvetica","bold"),i.setFontSize(18),i.setTextColor(...Cu),i.text("Beck360",l,V),i.setFontSize(16),i.setTextColor(...lo),i.text("EINNAHMEN-UEBERSCHUSS-RECHNUNG",o-c,V,{align:"right"}),V+=8,i.setFontSize(12),i.setTextColor(...Tu),i.text(`Geschaeftsjahr ${t}`,o-c,V,{align:"right"}),V+=5,i.setFontSize(7),i.setTextColor(...Tu);const q=`${h} - ${m} - ${b} - ${p} ${_}`;i.text(q,l,V);const F=i.getTextWidth(q);i.setDrawColor(...Tu),i.setLineWidth(.2),i.line(l,V+.5,l+F,V+.5),V+=12,i.setFont("helvetica","bold"),i.setFontSize(11),i.setTextColor(...Cu),i.text("Monatsuebersicht",l,V),V+=6;const C=[{label:"Monat",x:l,align:"left",w:28},{label:"Einnahmen",x:l+30,align:"right"},{label:"Ausg. netto",x:l+58,align:"right"},{label:"MwSt erh.",x:l+84,align:"right"},{label:"MwSt gez.",x:l+108,align:"right"},{label:"Gewinn",x:l+136,align:"right"}];i.setFont("helvetica","bold"),i.setFontSize(7.5),i.setTextColor(...lo),i.setDrawColor(...lo),i.setLineWidth(.3),i.line(l,V,o-c,V),V+=4,C.forEach(ce=>{const se=ce.align==="right"?{align:"right"}:{};i.text(ce.label,ce.x,V,se)}),V+=2,i.line(l,V,o-c,V),V+=4,i.setFont("helvetica","normal"),i.setFontSize(7.5);const A={incomeNetto:0,expensesNetto:0,vatCollected:0,vatPaid:0,profit:0};e.forEach(ce=>{i.text(p_[ce.month-1],C[0].x,V),i.text(Jr(ce.incomeNetto),C[1].x,V,{align:"right"}),i.text(Jr(ce.expensesNetto),C[2].x,V,{align:"right"}),i.text(Jr(ce.vatCollected),C[3].x,V,{align:"right"}),i.text(Jr(ce.vatPaid),C[4].x,V,{align:"right"}),i.text(Jr(ce.profit),C[5].x,V,{align:"right"}),A.incomeNetto+=ce.incomeNetto,A.expensesNetto+=ce.expensesNetto,A.vatCollected+=ce.vatCollected,A.vatPaid+=ce.vatPaid,A.profit+=ce.profit,V+=4.5}),i.line(l,V-1,o-c,V-1),V+=2,i.setFont("helvetica","bold"),i.text("Summe",C[0].x,V),i.text(Jr(A.incomeNetto),C[1].x,V,{align:"right"}),i.text(Jr(A.expensesNetto),C[2].x,V,{align:"right"}),i.text(Jr(A.vatCollected),C[3].x,V,{align:"right"}),i.text(Jr(A.vatPaid),C[4].x,V,{align:"right"}),i.text(Jr(A.profit),C[5].x,V,{align:"right"}),V+=3,i.line(l,V,o-c,V),V+=15,i.setFont("helvetica","bold"),i.setFontSize(11),i.setTextColor(...Cu),i.text("EUER-Zusammenfassung",l,V),V+=8,i.setFontSize(9),i.setTextColor(...lo);function k(ce,se,fe={}){fe.bold?i.setFont("helvetica","bold"):i.setFont("helvetica","normal"),i.text(ce,l,V),i.text(Jr(se),o-c,V,{align:"right"}),V+=fe.spacing||6}k("Betriebseinnahmen (netto)",r.yearRevenueNetto),k("Betriebsausgaben (netto)",r.yearExpensesNetto),i.setDrawColor(...Tp),i.setLineWidth(.3),i.line(l,V-2,o-c,V-2),k("Gewinn vor Steuern",r.yearProfit,{bold:!0,spacing:10}),k("MwSt. erhalten",r.vatCollected),k("MwSt. gezahlt (Vorsteuer)",r.vatPaid),i.line(l,V-2,o-c,V-2),k("MwSt.-Zahllast",r.vatPayable,{bold:!0});const M=270;i.setDrawColor(...Tp),i.setLineWidth(.3),i.line(l,M-3,o-c,M-3),i.setFontSize(7),i.setTextColor(...lo);const j=l;i.setFont("helvetica","bold"),i.text(h,j,M),i.text(m,j,M+3.5),i.setFont("helvetica","normal"),i.text(b,j,M+7),i.text(`${p} ${_}`,j,M+10.5),i.text(x,j,M+14),i.text(`Steuernummer: ${T}`,j,M+17.5),i.text(`USt-IdNr.: ${O}`,j,M+21);const U=l+55;i.setFont("helvetica","bold"),i.text("Kontakt:",U,M),i.setFont("helvetica","normal"),i.text(`Tel.: ${w}`,U,M+3.5),i.text(`E-Mail: ${S}`,U,M+7);const re=l+110;i.setFont("helvetica","bold"),i.text("Zahlungsinformationen:",re,M),i.setFont("helvetica","normal"),i.text(`IBAN: ${K}`,re,M+3.5),i.text(`BIC: ${te}`,re,M+7),i.text(L,re,M+10.5),i.save(`EUER-${t}-Beck360.pdf`)}function m_(){const t=Qn(),e=new Date,[n,r]=me(e.getFullYear()),{stats:a,monthlyData:i,quarterlyData:o,expensesByCategory:l,loading:c}=f_({year:n}),{settings:d}=sc(),h=[];for(let _=e.getFullYear();_>=e.getFullYear()-5;_--)h.push(_);function m(){a&&(g_({year:n,monthlyData:i,quarterlyData:o,stats:a,settings:d}),t.success("PDF erstellt"))}function b(){if(!i.length)return;const _="Monat,Einnahmen Brutto,Einnahmen Netto,MwSt erhalten,Ausgaben Brutto,Ausgaben Netto,MwSt gezahlt,Gewinn",w=i.map(K=>[Kl[K.month-1],K.incomeBrutto.toFixed(2).replace(".",","),K.incomeNetto.toFixed(2).replace(".",","),K.vatCollected.toFixed(2).replace(".",","),K.expensesBrutto.toFixed(2).replace(".",","),K.expensesNetto.toFixed(2).replace(".",","),K.vatPaid.toFixed(2).replace(".",","),K.profit.toFixed(2).replace(".",",")].map(te=>`"${te}"`).join(";")),S=i.reduce((K,te)=>({ib:K.ib+te.incomeBrutto,in_:K.in_+te.incomeNetto,vc:K.vc+te.vatCollected,eb:K.eb+te.expensesBrutto,en:K.en+te.expensesNetto,vp:K.vp+te.vatPaid,p:K.p+te.profit}),{ib:0,in_:0,vc:0,eb:0,en:0,vp:0,p:0});w.push(["Summe",S.ib.toFixed(2).replace(".",","),S.in_.toFixed(2).replace(".",","),S.vc.toFixed(2).replace(".",","),S.eb.toFixed(2).replace(".",","),S.en.toFixed(2).replace(".",","),S.vp.toFixed(2).replace(".",","),S.p.toFixed(2).replace(".",",")].map(K=>`"${K}"`).join(";"));const x=[_.split(",").map(K=>`"${K}"`).join(";"),...w].join(`
`),T=new Blob(["\uFEFF"+x],{type:"text/csv;charset=utf-8"}),O=URL.createObjectURL(T),L=document.createElement("a");L.href=O,L.download=`EUER-${n}-Beck360.csv`,L.click(),URL.revokeObjectURL(O),t.success("CSV erstellt")}const p=Object.values(l).reduce((_,w)=>_+w,0);return s(At,{children:[s("div",{class:"page-header",children:[s("h1",{class:"page-title",children:"Berichte"}),s("div",{style:"display:flex;gap:0.5rem;align-items:center;flex-wrap:wrap",children:[s("select",{value:n,onChange:_=>r(parseInt(_.target.value)),style:"width:auto",children:h.map(_=>s("option",{value:_,children:_},_))}),s("button",{class:"btn btn-primary btn-sm",onClick:m,disabled:c,children:"PDF Export"}),s("button",{class:"btn btn-secondary btn-sm",onClick:b,disabled:c,children:"CSV Export"})]})]}),s("div",{class:"page-body",children:c?s("div",{class:"loading-center",children:s("div",{class:"spinner"})}):a?s(At,{children:[s("div",{class:"grid-4",style:"margin-bottom:1.5rem",children:[s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Jahresumsatz brutto"}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#10b981",children:De(a.yearRevenue)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Ausgaben gesamt"}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#ef4444",children:De(a.yearExpenses)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Gewinn (netto)"}),s("div",{style:"font-size:1.5rem;font-weight:700;color:var(--brand)",children:De(a.yearProfit)})]}),s("div",{class:"card",style:"text-align:center;padding:1.25rem",children:[s("div",{style:"font-size:0.8rem;color:var(--text-dim);margin-bottom:0.25rem",children:"Offene Rechnungen"}),s("div",{style:"font-size:1.5rem;font-weight:700;color:#f59e0b",children:De(a.openInvoices)})]})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Monatsuebersicht ",n]})}),s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Monat"}),s("th",{style:"text-align:right",children:"Einnahmen brutto"}),s("th",{style:"text-align:right",children:"Einnahmen netto"}),s("th",{style:"text-align:right",children:"Ausgaben brutto"}),s("th",{style:"text-align:right",children:"MwSt erh."}),s("th",{style:"text-align:right",children:"MwSt gez."}),s("th",{style:"text-align:right",children:"Gewinn"})]})}),s("tbody",{children:[i.map(_=>s("tr",{children:[s("td",{"data-label":"Monat",style:"font-weight:600",children:Kl[_.month-1]}),s("td",{"data-label":"Einnahmen brutto",children:De(_.incomeBrutto)}),s("td",{"data-label":"Einnahmen netto",children:De(_.incomeNetto)}),s("td",{"data-label":"Ausgaben brutto",children:De(_.expensesBrutto)}),s("td",{"data-label":"MwSt erh.",children:De(_.vatCollected)}),s("td",{"data-label":"MwSt gez.",children:De(_.vatPaid)}),s("td",{"data-label":"Gewinn",style:`font-weight:600;color:${_.profit>=0?"#10b981":"#ef4444"}`,children:De(_.profit)})]},_.month)),s("tr",{style:"font-weight:700;border-top:2px solid var(--border)",children:[s("td",{"data-label":"Monat",children:"Summe"}),s("td",{"data-label":"Einnahmen brutto",children:De(i.reduce((_,w)=>_+w.incomeBrutto,0))}),s("td",{"data-label":"Einnahmen netto",children:De(i.reduce((_,w)=>_+w.incomeNetto,0))}),s("td",{"data-label":"Ausgaben brutto",children:De(i.reduce((_,w)=>_+w.expensesBrutto,0))}),s("td",{"data-label":"MwSt erh.",children:De(i.reduce((_,w)=>_+w.vatCollected,0))}),s("td",{"data-label":"MwSt gez.",children:De(i.reduce((_,w)=>_+w.vatPaid,0))}),s("td",{"data-label":"Gewinn",style:`color:${a.yearProfit>=0?"#10b981":"#ef4444"}`,children:De(a.yearProfit)})]})]})]})})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["Quartalsuebersicht ",n]})}),s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Quartal"}),s("th",{style:"text-align:right",children:"Einnahmen brutto"}),s("th",{style:"text-align:right",children:"Einnahmen netto"}),s("th",{style:"text-align:right",children:"Ausgaben brutto"}),s("th",{style:"text-align:right",children:"MwSt erh."}),s("th",{style:"text-align:right",children:"MwSt gez."}),s("th",{style:"text-align:right",children:"Gewinn"})]})}),s("tbody",{children:[o.map(_=>s("tr",{children:[s("td",{"data-label":"Quartal",style:"font-weight:600",children:["Q",_.quarter]}),s("td",{"data-label":"Einnahmen brutto",children:De(_.incomeBrutto)}),s("td",{"data-label":"Einnahmen netto",children:De(_.incomeNetto)}),s("td",{"data-label":"Ausgaben brutto",children:De(_.expensesBrutto)}),s("td",{"data-label":"MwSt erh.",children:De(_.vatCollected)}),s("td",{"data-label":"MwSt gez.",children:De(_.vatPaid)}),s("td",{"data-label":"Gewinn",style:`font-weight:600;color:${_.profit>=0?"#10b981":"#ef4444"}`,children:De(_.profit)})]},_.quarter)),s("tr",{style:"font-weight:700;border-top:2px solid var(--border)",children:[s("td",{"data-label":"Quartal",children:"Summe"}),s("td",{"data-label":"Einnahmen brutto",children:De(a.yearRevenue)}),s("td",{"data-label":"Einnahmen netto",children:De(a.yearRevenueNetto)}),s("td",{"data-label":"Ausgaben brutto",children:De(a.yearExpenses)}),s("td",{"data-label":"MwSt erh.",children:De(a.vatCollected)}),s("td",{"data-label":"MwSt gez.",children:De(a.vatPaid)}),s("td",{"data-label":"Gewinn",style:`color:${a.yearProfit>=0?"#10b981":"#ef4444"}`,children:De(a.yearProfit)})]})]})]})})]}),Object.keys(l).length>0&&s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:"Ausgaben nach Kategorie"})}),s("div",{class:"table-wrapper",children:s("table",{children:[s("thead",{children:s("tr",{children:[s("th",{children:"Kategorie"}),s("th",{style:"text-align:right",children:"Betrag"}),s("th",{style:"text-align:right",children:"Anteil"})]})}),s("tbody",{children:[Object.entries(l).sort(([,_],[,w])=>w-_).map(([_,w])=>s("tr",{children:[s("td",{"data-label":"Kategorie",style:"font-weight:500",children:Vl[_]||_}),s("td",{"data-label":"Betrag",children:De(w)}),s("td",{"data-label":"Anteil",children:[p>0?(w/p*100).toFixed(1):0," %"]})]},_)),s("tr",{style:"font-weight:700;border-top:2px solid var(--border)",children:[s("td",{"data-label":"Kategorie",children:"Gesamt"}),s("td",{"data-label":"Betrag",children:De(p)}),s("td",{"data-label":"Anteil",children:"100 %"})]})]})]})})]}),s("div",{class:"card",style:"margin-bottom:1.5rem",children:[s("div",{class:"card-header",children:s("span",{class:"card-title",children:["EUER-Zusammenfassung ",n]})}),s("div",{style:"padding:0.5rem 0",children:[s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--border)",children:[s("span",{children:"Betriebseinnahmen (netto)"}),s("span",{style:"font-weight:600",children:De(a.yearRevenueNetto)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--border)",children:[s("span",{children:"Betriebsausgaben (netto)"}),s("span",{style:"font-weight:600;color:#ef4444",children:De(a.yearExpensesNetto)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:2px solid var(--border);font-weight:700;font-size:1.1rem",children:[s("span",{children:"Gewinn vor Steuern"}),s("span",{style:`color:${a.yearProfit>=0?"#10b981":"#ef4444"}`,children:De(a.yearProfit)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--border);margin-top:0.5rem",children:[s("span",{children:"MwSt. erhalten"}),s("span",{children:De(a.vatCollected)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;border-bottom:1px solid var(--border)",children:[s("span",{children:"MwSt. gezahlt (Vorsteuer)"}),s("span",{children:De(a.vatPaid)})]}),s("div",{style:"display:flex;justify-content:space-between;padding:0.75rem 0;font-weight:700",children:[s("span",{children:"MwSt.-Zahllast"}),s("span",{children:De(a.vatPayable)})]})]})]})]}):s("div",{class:"empty-state",children:[s("div",{class:"empty-state-icon",children:""}),s("div",{class:"empty-state-text",children:"Keine Daten verfuegbar"})]})})]})}function v_(){const{user:t,loading:e}=ac();return e?s("div",{class:"loading-center",style:"min-height: 100vh",children:s("div",{class:"spinner"})}):t?s(e2,{children:s(pg,{children:[s(Qh,{path:"/crm/"}),s(g2,{path:"/crm/pipeline"}),s(S2,{path:"/crm/contacts"}),s(k2,{path:"/crm/contacts/new"}),s(A2,{path:"/crm/contacts/:id"}),s(E2,{path:"/crm/companies"}),s(L2,{path:"/crm/companies/:id"}),s(T2,{path:"/crm/deals/new"}),s(C2,{path:"/crm/deals/:id"}),s(lb,{path:"/crm/invoices"}),s(ub,{path:"/crm/invoices/new"}),s(a_,{path:"/crm/invoices/:id"}),s(d_,{path:"/crm/expenses"}),s(h_,{path:"/crm/expenses/new"}),s(m_,{path:"/crm/reports"}),s(D2,{path:"/crm/campaigns"}),s(sb,{path:"/crm/campaigns/new"}),s(ob,{path:"/crm/campaigns/:id"}),s(P2,{path:"/crm/settings"}),s(Qh,{default:!0})]})}):s(t2,{})}a0(s(qv,{children:s(zv,{children:s(v_,{})})}),document.getElementById("app"));export{Ht as _};
